[{"title":"Redis-Redisearch","url":"/posts/882398087/","content":"<blockquote>\n<p>RediSearch 是一个高性能的全文搜索引擎，它可以作为一个 Redis Module（扩展模块）运行在 Redis 服务器上。</p>\n</blockquote>\n<h2 id=\"RediSearch\"><a href=\"#RediSearch\" class=\"headerlink\" title=\"RediSearch\"></a>RediSearch</h2><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211228011936.png\"></p>\n<ul>\n<li>Redis 哈希中多个字段的全文索引</li>\n<li>无性能损失的增量索引</li>\n<li>文档排名（使用<a href=\"https://en.wikipedia.org/wiki/Tf%E2%80%93idf\" target=\"_blank\" rel=\"noopener\">tf-idf</a>，具有可选的用户提供的权重）</li>\n<li>场加权</li>\n<li>使用 AND、OR 和 NOT 运算符的复杂布尔查询</li>\n<li>前缀匹配、模糊匹配和精确短语查询</li>\n<li>支持<a href=\"https://oss.redislabs.com/redisearch/Phonetic_Matching/\" target=\"_blank\" rel=\"noopener\">双变音拼音匹配</a></li>\n<li>自动完成建议（带有模糊前缀建议）</li>\n<li><a href=\"https://oss.redislabs.com/redisearch/Stemming/\" target=\"_blank\" rel=\"noopener\">多种语言中</a>基于词干的查询扩展（使用<a href=\"http://snowballstem.org/\" target=\"_blank\" rel=\"noopener\">Snowball</a>）</li>\n<li>支持中文标记化和查询（使用<a href=\"https://github.com/lionsoul2014/friso\" target=\"_blank\" rel=\"noopener\">Friso</a>）</li>\n<li>数字过滤器和范围</li>\n<li>使用<a href=\"https://redis.io/commands/georadius\" target=\"_blank\" rel=\"noopener\">Redis 地理空间索引</a>进行<a href=\"https://redis.io/commands/georadius\" target=\"_blank\" rel=\"noopener\">地理</a>空间搜索</li>\n<li>强大的聚合引擎</li>\n<li>支持所有 utf-8 编码文本</li>\n<li>检索完整文档、选定字段或仅检索文档 ID</li>\n<li>排序结果（例如，按创建日期）</li>\n</ul>\n<h3 id=\"官方文档\"><a href=\"#官方文档\" class=\"headerlink\" title=\"官方文档\"></a>官方文档</h3><ul>\n<li><a href=\"https://oss.redis.com/redisearch/Commands/#\" target=\"_blank\" rel=\"noopener\">Commands</a></li>\n</ul>\n<h3 id=\"运行环境\"><a href=\"#运行环境\" class=\"headerlink\" title=\"运行环境\"></a>运行环境</h3><ul>\n<li>docker</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mkdir -p redisearch/data</span><br><span class=\"line\">docker run -p 6379:6379 -v <span class=\"variable\">$PWD</span>/redisearch/data:/data  -d redislabs/redisearch:latest</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>检查安装</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">➜  docker-run redis-cli </span><br><span class=\"line\">127.0.0.1:6379&gt; MODULE LIST</span><br><span class=\"line\">1) 1) <span class=\"string\">\"name\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"search\"</span></span><br><span class=\"line\">   3) <span class=\"string\">\"ver\"</span></span><br><span class=\"line\">   4) (<span class=\"built_in\">integer</span>) 20015</span><br><span class=\"line\">127.0.0.1:6379&gt; <span class=\"built_in\">exit</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>测试下</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; FT.ADD idx docCn 1.0 LANGUAGE chinese FIELDS txt <span class=\"string\">\"Redis支持主从同步。数据可以从主服务器向任意数量的从服务器上同步，从服务器可以是关联其他从服务器的主服务器。这使得Redis可执行单层树复制。从盘可以有意无意的对数据进行写操作。由于完全实现了发布/订阅机制，使得从数据库在任何地方同步树时，可订阅一个频道并接收主服务器完整的消息发布记录。同步对读取操作的可扩展性和数据冗余很有帮助。[8]\"</span></span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; FT.SEARCH idx <span class=\"string\">\"数据\"</span> LANGUAGE chinese HIGHLIGHT SUMMARIZE</span><br><span class=\"line\">1) (<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">2) <span class=\"string\">\"docCn\"</span></span><br><span class=\"line\">3) 1) <span class=\"string\">\"txt\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"&lt;b&gt;\\xe6\\x95\\xb0\\xe6\\x8d\\xae&lt;/b&gt;\\xe5... &lt;b&gt;\\xe6\\x95\\xb0\\xe6\\x8d\\xae&lt;/b&gt;\\xe8\\xbf\\x9b\\xe8\\xa1\\x8c\\xe5\\x86\\x99\\xe6\\x93\\x8d\\xe4\\xbd\\x9c\\xe3\\x80\\x82\\xe7\\x94\\xb1\\xe4\\xba\\x8e\\xe5\\xae\\x8c\\xe5\\x85\\xa8\\xe5\\xae\\x9e\\xe7\\x8e\\xb0\\xe4\\xba\\x86\\xe5\\x8f\\x91\\xe5\\xb8\\x83... &lt;b&gt;\\xe6\\x95\\xb0\\xe6\\x8d\\xae&lt;/b&gt;\\xe5\\x86\\x97\\xe4\\xbd\\x99\\xe5\\xbe\\x88\\xe6\\x9c\\x89\\xe5\\xb8\\xae\\xe5\\x8a\\xa9\\xe3\\x80\\x82[8... \"</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>对中文支持不够好</li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"代码演示\"><a href=\"#代码演示\" class=\"headerlink\" title=\"代码演示\"></a>代码演示</h3><ul>\n<li><p>Spring boot 2.6.0</p>\n</li>\n<li><p>spring-lettucemod 1.8.1 </p>\n</li>\n<li><p>注意这里需要排除commons-pool2</p>\n</li>\n</ul>\n<h4 id=\"项目依赖\"><a href=\"#项目依赖\" class=\"headerlink\" title=\"项目依赖\"></a>项目依赖</h4><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">   &lt;parent&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;2.6.0&lt;&#x2F;version&gt;</span><br><span class=\"line\">        &lt;relativePath&#x2F;&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class=\"line\">    &lt;&#x2F;parent&gt;</span><br><span class=\"line\">    </span><br><span class=\"line\">&lt;dependencies&gt;</span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">        &lt;&#x2F;dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">        &lt;&#x2F;dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.redis&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-lettucemod&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">            &lt;version&gt;1.8.1&lt;&#x2F;version&gt;</span><br><span class=\"line\">        &lt;&#x2F;dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">            &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class=\"line\">        &lt;&#x2F;dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;dependency&gt;</span><br><span class=\"line\">            &lt;groupId&gt;com.google.code.gson&lt;&#x2F;groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;gson&lt;&#x2F;artifactId&gt;</span><br><span class=\"line\">        &lt;&#x2F;dependency&gt;</span><br><span class=\"line\">&lt;&#x2F;dependencies&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>单元测试</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\">StatefulRedisModulesConnection&lt;String, String&gt; connection;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\">RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">search</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Set&lt;String&gt; keys = redisTemplate.keys(<span class=\"string\">\"*\"</span>);</span><br><span class=\"line\">    keys.forEach(item -&gt; &#123;</span><br><span class=\"line\">                redisTemplate.delete(item);</span><br><span class=\"line\">                log.info(<span class=\"string\">\" keys - &gt; &#123;&#125; \"</span>, item);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">    String searchIndexName = <span class=\"string\">\"doc-idx\"</span>;</span><br><span class=\"line\">    Gson gson = <span class=\"keyword\">new</span> GsonBuilder().setPrettyPrinting().create();</span><br><span class=\"line\">    RediSearchCommands&lt;String, String&gt; commands = connection.sync();</span><br><span class=\"line\">    RedisCommands redisCommands = connection.sync();</span><br><span class=\"line\">    List&lt;String&gt; list = commands.list();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (String s : list) &#123;</span><br><span class=\"line\">        commands.dropindex(s);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    CreateOptions&lt;String, String&gt; options = CreateOptions.&lt;String, String&gt;builder()</span><br><span class=\"line\">            .on(CreateOptions.DataType.HASH)</span><br><span class=\"line\">            .languageField(Language.CHINESE.getId())</span><br><span class=\"line\">            .prefix(String.format(<span class=\"string\">\"%s:\"</span>, DocumentDto<span class=\"class\">.<span class=\"keyword\">class</span>.<span class=\"title\">getName</span>()))</span></span><br><span class=\"line\"><span class=\"class\">            .<span class=\"title\">build</span>()</span>;</span><br><span class=\"line\">    log.info(<span class=\"string\">\"&#123;&#125;\"</span>,gson.toJson(options));</span><br><span class=\"line\">    Field title = Field.text(<span class=\"string\">\"title\"</span>).build();</span><br><span class=\"line\">    Field subtitle = Field.text(<span class=\"string\">\"subtitle\"</span>).build();</span><br><span class=\"line\">    Field description = Field.text(<span class=\"string\">\"description\"</span>).build();</span><br><span class=\"line\">    Field author = Field.text(<span class=\"string\">\"authors\"</span>).build();</span><br><span class=\"line\">    commands.create(</span><br><span class=\"line\">            searchIndexName, <span class=\"comment\">//</span></span><br><span class=\"line\">            options, <span class=\"comment\">//</span></span><br><span class=\"line\">            title,</span><br><span class=\"line\">            subtitle,</span><br><span class=\"line\">            description, <span class=\"comment\">//</span></span><br><span class=\"line\">            author</span><br><span class=\"line\">    );</span><br><span class=\"line\">    String key = String.format(\"%s:%s\", DocumentDto.class.getName(), \"1\");</span><br><span class=\"line\">    Map&lt;String,String&gt; map = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">    map.put(<span class=\"string\">\"title\"</span>,<span class=\"string\">\"标题\"</span>);</span><br><span class=\"line\">    map.put(<span class=\"string\">\"subtitle\"</span>,<span class=\"string\">\"副标题\"</span>);</span><br><span class=\"line\">    map.put(<span class=\"string\">\"description\"</span>,<span class=\"string\">\"描述\"</span>);</span><br><span class=\"line\">    map.put(<span class=\"string\">\"authors\"</span>,<span class=\"string\">\"作者\"</span>);</span><br><span class=\"line\">    Boolean result = redisHash.hMSet(key,map);</span><br><span class=\"line\">    log.info(<span class=\"string\">\" \\n key &#123;&#125; \\n data &#123;&#125; result &#123;&#125; \"</span>, key,gson.toJson(map),result);</span><br><span class=\"line\">    map = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">    map.put(<span class=\"string\">\"title\"</span>,<span class=\"string\">\"标题1\"</span>);</span><br><span class=\"line\">    map.put(<span class=\"string\">\"subtitle\"</span>,<span class=\"string\">\"副标题2\"</span>);</span><br><span class=\"line\">    map.put(<span class=\"string\">\"description\"</span>,<span class=\"string\">\"描述3\"</span>);</span><br><span class=\"line\">    map.put(<span class=\"string\">\"authors\"</span>,<span class=\"string\">\"作者4\"</span>);</span><br><span class=\"line\">    key = String.format(\"%s:%s\", DocumentDto.class.getName(), \"2\");</span><br><span class=\"line\">    result = redisHash.hMSet(key,map);</span><br><span class=\"line\">    log.info(<span class=\"string\">\" \\n key &#123;&#125; \\n data &#123;&#125; result &#123;&#125; \"</span>, key,gson.toJson(map),result);</span><br><span class=\"line\">    List&lt;String&gt; fields = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">    fields.add(<span class=\"string\">\"title\"</span>);</span><br><span class=\"line\">    fields.add(<span class=\"string\">\"subtitle\"</span>);</span><br><span class=\"line\">    fields.add(<span class=\"string\">\"description\"</span>);</span><br><span class=\"line\">    fields.add(<span class=\"string\">\"authors\"</span>);</span><br><span class=\"line\">    SearchOptions.Summarize summarize = <span class=\"keyword\">new</span> SearchOptions.Summarize();</span><br><span class=\"line\">    summarize.setFields(fields);</span><br><span class=\"line\">    SearchOptions searchOptions = SearchOptions.builder()</span><br><span class=\"line\">            .language(Language.CHINESE)</span><br><span class=\"line\">            .limit(SearchOptions.Limit.of(<span class=\"number\">0</span>,<span class=\"number\">10</span>))</span><br><span class=\"line\">            .summarize(summarize)</span><br><span class=\"line\">            .build();</span><br><span class=\"line\">    log.info(<span class=\"string\">\" searchOptions &#123;&#125;\"</span>,gson.toJson(searchOptions));</span><br><span class=\"line\">    SearchResults&lt;String, String&gt; results = commands.search(searchIndexName, <span class=\"string\">\"标\"</span>, searchOptions);</span><br><span class=\"line\">    log.info(<span class=\"string\">\"&#123;&#125;\"</span>, gson.toJson(results));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">key cn.z201.learning.redis.operating.DocumentDto:1 </span><br><span class=\"line\"> data &#123;</span><br><span class=\"line\">  &quot;subtitle&quot;: &quot;副标题&quot;,</span><br><span class=\"line\">  &quot;description&quot;: &quot;描述&quot;,</span><br><span class=\"line\">  &quot;title&quot;: &quot;标题&quot;,</span><br><span class=\"line\">  &quot;authors&quot;: &quot;作者&quot;</span><br><span class=\"line\">&#125; result true </span><br><span class=\"line\"></span><br><span class=\"line\"> key cn.z201.learning.redis.operating.DocumentDto:2 </span><br><span class=\"line\"> data &#123;</span><br><span class=\"line\">  &quot;subtitle&quot;: &quot;副标题2&quot;,</span><br><span class=\"line\">  &quot;description&quot;: &quot;描述3&quot;,</span><br><span class=\"line\">  &quot;title&quot;: &quot;标题1&quot;,</span><br><span class=\"line\">  &quot;authors&quot;: &quot;作者4&quot;</span><br><span class=\"line\">&#125; result true </span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; 结果</span><br><span class=\"line\">[</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    &quot;title&quot;: &quot;标题1... &quot;,</span><br><span class=\"line\">    &quot;subtitle&quot;: &quot;�&quot;,</span><br><span class=\"line\">    &quot;description&quot;: &quot;�&quot;,</span><br><span class=\"line\">    &quot;authors&quot;: &quot;�&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    &quot;title&quot;: &quot;标题... &quot;,</span><br><span class=\"line\">    &quot;subtitle&quot;: &quot;�&quot;,</span><br><span class=\"line\">    &quot;description&quot;: &quot;�&quot;,</span><br><span class=\"line\">    &quot;authors&quot;: &quot;�&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>结果很不友好，对中文支持一般般。</li>\n</ul>\n","categories":["Redis"],"tags":["Redisearch","搜索引擎"]},{"title":"Hexo博客优化","url":"/posts/2485590586/","content":"<blockquote>\n<p>简单优化的下博客。</p>\n</blockquote>\n<h3 id=\"优化内容\"><a href=\"#优化内容\" class=\"headerlink\" title=\"优化内容\"></a>优化内容</h3><ul>\n<li>SEO优化</li>\n<li>增加站内搜索</li>\n<li>增加网站地图</li>\n<li>添加字数统计和阅读时长</li>\n<li>GitHub Fork Me</li>\n<li>允许复制代码</li>\n<li>图片懒加载</li>\n</ul>\n<h4 id=\"SEO优化\"><a href=\"#SEO优化\" class=\"headerlink\" title=\"SEO优化\"></a>SEO优化</h4><blockquote>\n<p>hexo 默认生成文章命名方式，在中文标题下很不友好。可以选择生成永久的链接。</p>\n</blockquote>\n<ul>\n<li>使用abbrlink插件</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-abbrlink --save</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置_config.yml</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#permalink: :year/:month/:day/:title/</span></span><br><span class=\"line\"><span class=\"comment\">#permalink_defaults:</span></span><br><span class=\"line\"><span class=\"attr\">permalink:</span> <span class=\"string\">posts/:abbrlink/</span></span><br><span class=\"line\"><span class=\"attr\">abbrlink:</span></span><br><span class=\"line\">  <span class=\"attr\">alg:</span> <span class=\"string\">crc32</span> <span class=\"comment\">#support crc16(default) and crc32</span></span><br><span class=\"line\">  <span class=\"attr\">rep:</span> <span class=\"string\">dec</span>   <span class=\"comment\">#support dec(default) and hex</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>生成的链接将会是这样的(官方样例)：</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">crc16 &amp; hex</span><br><span class=\"line\">https:&#x2F;&#x2F;post.x.com&#x2F;posts&#x2F;66c8.html</span><br><span class=\"line\"></span><br><span class=\"line\">crc16 &amp; dec</span><br><span class=\"line\">https:&#x2F;&#x2F;post.x.com&#x2F;posts&#x2F;65535.html</span><br><span class=\"line\">crc32 &amp; hex</span><br><span class=\"line\">https:&#x2F;&#x2F;post.x.com&#x2F;posts&#x2F;8ddf18fb.html</span><br><span class=\"line\"></span><br><span class=\"line\">crc32 &amp; dec</span><br><span class=\"line\">https:&#x2F;&#x2F;post.x.com&#x2F;posts&#x2F;1690090958.html</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h4 id=\"增加站内搜索\"><a href=\"#增加站内搜索\" class=\"headerlink\" title=\"增加站内搜索\"></a>增加站内搜索</h4><blockquote>\n<p>增加站内搜索</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置_config.yml</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">search:</span></span><br><span class=\"line\">  <span class=\"attr\">path:</span> <span class=\"string\">search.json</span>  <span class=\"comment\">#支持 json 或者 xml，默认 xml，但我用的有问题，推荐 json</span></span><br><span class=\"line\">  <span class=\"attr\">field:</span> <span class=\"string\">post</span></span><br><span class=\"line\">  <span class=\"attr\">format:</span> <span class=\"string\">html</span></span><br><span class=\"line\">  <span class=\"attr\">limit:</span> <span class=\"number\">10000</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置主题中的_config.yml</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">local_search:</span></span><br><span class=\"line\">   <span class=\"attr\">enable:</span> <span class=\"literal\">false</span> <span class=\"string\">//</span> <span class=\"string\">改成true</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"增加网站地图\"><a href=\"#增加网站地图\" class=\"headerlink\" title=\"增加网站地图\"></a>增加网站地图</h4><blockquote>\n<p>站点的SEO</p>\n</blockquote>\n<ul>\n<li>主要针对百度、谷歌</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-generator-sitemap --save</span><br><span class=\"line\">npm install hexo-generator-baidu-sitemap --save</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置_config.yml</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">baidusitemap:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">baidusitemap.xml</span></span><br><span class=\"line\"><span class=\"attr\">sitemap:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">sitemap.xml</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>增加robots.txt</li>\n</ul>\n<blockquote>\n<p>网站根目录source下新建robots.txt</p>\n</blockquote>\n<figure class=\"highlight tex\"><table><tr><td class=\"code\"><pre><span class=\"line\">User-agent: *</span><br><span class=\"line\">Allow: /</span><br><span class=\"line\">Allow: /archives/ </span><br><span class=\"line\"></span><br><span class=\"line\">Disallow: /js/</span><br><span class=\"line\">Disallow: /css/</span><br><span class=\"line\">Disallow: /fonts/</span><br><span class=\"line\">Disallow: /vendors/</span><br><span class=\"line\">Disallow: /fancybox/</span><br><span class=\"line\"></span><br><span class=\"line\">Sitemap: https://z201.com/sitemap.xml</span><br><span class=\"line\">Sitemap: https://z201.com/baidusitemap.xml</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"增加字数统计阅读时长\"><a href=\"#增加字数统计阅读时长\" class=\"headerlink\" title=\"增加字数统计阅读时长\"></a>增加字数统计阅读时长</h4><blockquote>\n<p>简单的优化</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-symbols-count-time --save</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置_config.yml</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\"> <span class=\"comment\">#文章内是否显示</span></span><br><span class=\"line\">  <span class=\"attr\">symbols:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">time:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"> <span class=\"comment\"># 网页底部是否显示</span></span><br><span class=\"line\">  <span class=\"attr\">total_symbols:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">total_time:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"attr\">post_wordcount:</span></span><br><span class=\"line\">  <span class=\"attr\">item_text:</span> <span class=\"literal\">true</span>       </span><br><span class=\"line\">  <span class=\"attr\">wordcount:</span> <span class=\"literal\">true</span>       <span class=\"comment\"># 单篇 字数统计</span></span><br><span class=\"line\">  <span class=\"attr\">min2read:</span> <span class=\"literal\">true</span>        <span class=\"comment\"># 单篇 阅读时长</span></span><br><span class=\"line\">  <span class=\"attr\">totalcount:</span> <span class=\"literal\">false</span>     <span class=\"comment\"># 网站 字数统计</span></span><br><span class=\"line\">  <span class=\"attr\">separated_meta:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置主题中的_config.yml</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">symbols_count_time:</span></span><br><span class=\"line\">  <span class=\"attr\">separated_meta:</span> <span class=\"literal\">true</span>  <span class=\"comment\"># 是否换行显示 字数统计 及 阅读时长</span></span><br><span class=\"line\">  <span class=\"attr\">item_text_post:</span> <span class=\"literal\">true</span>  <span class=\"comment\"># 文章 字数统计 阅读时长 使用图标 还是 文本表示</span></span><br><span class=\"line\">  <span class=\"attr\">item_text_total:</span> <span class=\"literal\">true</span> <span class=\"comment\"># 博客底部统计 字数统计 阅读时长 使用图标 还是 文本表示</span></span><br><span class=\"line\">  <span class=\"attr\">awl:</span> <span class=\"number\">4</span></span><br><span class=\"line\">  <span class=\"attr\">wpm:</span> <span class=\"number\">275</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"GitHub-Fork-Me\"><a href=\"#GitHub-Fork-Me\" class=\"headerlink\" title=\"GitHub Fork Me\"></a>GitHub Fork Me</h4><blockquote>\n<p>在网站的右上角增加githu仓库信息</p>\n</blockquote>\n<ul>\n<li>修改主题中的_config.yml</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># `Follow me on GitHub` banner in the top-right corner.</span></span><br><span class=\"line\"><span class=\"attr\">github_banner:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">permalink:</span> <span class=\"string\">https://github.com/z201</span></span><br><span class=\"line\">  <span class=\"attr\">title:</span> <span class=\"string\">Follow</span> <span class=\"string\">me</span> <span class=\"string\">on</span> <span class=\"string\">GitHub</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"允许复制代码\"><a href=\"#允许复制代码\" class=\"headerlink\" title=\"允许复制代码\"></a>允许复制代码</h4><blockquote>\n<p>增加代码复制功能</p>\n</blockquote>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">codeblock:</span></span><br><span class=\"line\">  <span class=\"comment\"># Code Highlight theme</span></span><br><span class=\"line\">  <span class=\"comment\"># Available values: normal | night | night eighties | night blue | night bright | solarized | solarized dark | galactic</span></span><br><span class=\"line\">  <span class=\"comment\"># See: https://github.com/chriskempson/tomorrow-theme</span></span><br><span class=\"line\">  <span class=\"attr\">highlight_theme:</span> <span class=\"string\">night</span> <span class=\"string\">eighties</span></span><br><span class=\"line\">  <span class=\"comment\"># Add copy button on codeblock</span></span><br><span class=\"line\">  <span class=\"attr\">copy_button:</span></span><br><span class=\"line\">    <span class=\"attr\">enable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\"># Show text copy result.</span></span><br><span class=\"line\">    <span class=\"attr\">show_result:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\"># Available values: default | flat | mac</span></span><br><span class=\"line\">    <span class=\"attr\">style:</span> <span class=\"string\">mac</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"图片懒加载\"><a href=\"#图片懒加载\" class=\"headerlink\" title=\"图片懒加载\"></a>图片懒加载</h4><blockquote>\n<p>提高博客访问速度</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install hexo-lazyload-image --save</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置_config.yml</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># image lazyload</span></span><br><span class=\"line\"><span class=\"attr\">lazyload:</span></span><br><span class=\"line\">  <span class=\"attr\">enable:</span> <span class=\"literal\">true</span> </span><br><span class=\"line\">  <span class=\"attr\">onlypost:</span> <span class=\"literal\">false</span>  <span class=\"comment\"># 是否只对文章的图片做懒加载</span></span><br><span class=\"line\">  <span class=\"attr\">loadingImg:</span> <span class=\"comment\"># eg ./images/loading.gif</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"noopener\">Writing</a></p>\n<h3 id=\"Create-a-new-draft\"><a href=\"#Create-a-new-draft\" class=\"headerlink\" title=\"Create a new draft\"></a>Create a new draft</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo new draft <span class=\"string\">\"new draft\"</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Crete-a-new-page\"><a href=\"#Crete-a-new-page\" class=\"headerlink\" title=\"Crete a new page\"></a>Crete a new page</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo <span class=\"keyword\">new</span> page <span class=\"string\">\"new page\"</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"noopener\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br><span class=\"line\">$ hexo g</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"noopener\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br><span class=\"line\">$ hexo d</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"noopener\">Deployment</a></p>\n<h3 id=\"Localization-testing\"><a href=\"#Localization-testing\" class=\"headerlink\" title=\"Localization testing\"></a>Localization testing</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo server -g</span><br></pre></td></tr></table></figure>\n\n<p>visit website : <a href=\"http://localhost:4000/\" target=\"_blank\" rel=\"noopener\">http://localhost:4000</a> </p>\n","categories":["Hexo"],"tags":["Hexo"]},{"title":"Rust第一个CLI程序","url":"/posts/750520263/","content":"<blockquote>\n<p>编写第一个CLI小程序练手。</p>\n</blockquote>\n<h3 id=\"项目需求\"><a href=\"#项目需求\" class=\"headerlink\" title=\"项目需求\"></a>项目需求</h3><ul>\n<li>访问一个网站,输出页面内容成md文件。</li>\n</ul>\n<h3 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">cargo new learning-05</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用vs code 打开项目。</li>\n</ul>\n<h4 id=\"添加依赖\"><a href=\"#添加依赖\" class=\"headerlink\" title=\"添加依赖\"></a>添加依赖</h4><ul>\n<li>修改Cargo.toml </li>\n<li>引入 reqwest 和 html2md<ul>\n<li>reqwest 是一个http客户端</li>\n<li>html2md 顾名思义就是html转markdown</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight toml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">reqwest</span> = &#123; version = <span class=\"string\">\"0.11\"</span>, features = [<span class=\"string\">\"blocking\"</span>]&#125;</span><br><span class=\"line\"><span class=\"attr\">html2md</span> = <span class=\"string\">\"0.2\"</span>%</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"编写代码\"><a href=\"#编写代码\" class=\"headerlink\" title=\"编写代码\"></a>编写代码</h3><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fs;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> url = <span class=\"string\">\"https://z201.vip\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> output = <span class=\"string\">\"z201.md\"</span>;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"url &#123;&#125; output &#123;&#125;\"</span>,url,output);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> body = reqwest::blocking::get(url).unwrap().text().unwrap();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"Converting html to markdown...\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> md = html2md::parse_html(&amp;body);</span><br><span class=\"line\">    </span><br><span class=\"line\">    fs::write(output, md.as_bytes()).unwrap();</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"Converted markdown has been saved in &#123;&#125;.\"</span>, output);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">url https:&#x2F;&#x2F;z201.vip output z201.md</span><br><span class=\"line\">Converting html to markdown...</span><br><span class=\"line\">Converted markdown has been saved in z201.md.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"迭代代码\"><a href=\"#迭代代码\" class=\"headerlink\" title=\"迭代代码\"></a>迭代代码</h3><h4 id=\"版本一\"><a href=\"#版本一\" class=\"headerlink\" title=\"版本一\"></a>版本一</h4><ul>\n<li>这里将url 和 output作为参数。</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fs;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::env;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> args: <span class=\"built_in\">Vec</span>&lt;<span class=\"built_in\">String</span>&gt; = env::args().collect();</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"args &#123;:?&#125; \"</span>,args);</span><br><span class=\"line\">    <span class=\"comment\">// 获取第一个参数</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> url = &amp;args[<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"comment\">// 获取第二个参数</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> output = &amp;args[<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"comment\">// 判断参数是否为空,不知道这个是否有效。</span></span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(url.is_empty(),<span class=\"literal\">false</span>);</span><br><span class=\"line\">    <span class=\"built_in\">assert_eq!</span>(output.is_empty(),<span class=\"literal\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"url &#123;&#125; output &#123;&#125;\"</span>,url,output);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> body = reqwest::blocking::get(url).unwrap().text().unwrap();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"Converting html to markdown...\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> md = html2md::parse_html(&amp;body);</span><br><span class=\"line\">    </span><br><span class=\"line\">    fs::write(output, md.as_bytes()).unwrap();</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"Converted markdown has been saved in &#123;&#125;.\"</span>, output);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">➜  learning-05 git:(master) ✗ cargo run https://z201.vip z201.md</span><br><span class=\"line\">    Finished dev [unoptimized + debuginfo] target(s) <span class=\"keyword\">in</span> 0.09s</span><br><span class=\"line\">     Running `target/debug/learning-05 <span class=\"string\">'https://z201.vip'</span> z201.md`</span><br><span class=\"line\">args [<span class=\"string\">\"target/debug/learning-05\"</span>, <span class=\"string\">\"https://z201.vip\"</span>, <span class=\"string\">\"z201.md\"</span>] </span><br><span class=\"line\">url https://z201.vip output z201.md</span><br><span class=\"line\">Converting html to markdown...</span><br><span class=\"line\">Converted markdown has been saved <span class=\"keyword\">in</span> z201.md.</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"版本二\"><a href=\"#版本二\" class=\"headerlink\" title=\"版本二\"></a>版本二</h4><ul>\n<li>换一种方式来处理参数</li>\n<li>打包测试</li>\n</ul>\n<h5 id=\"增加依赖\"><a href=\"#增加依赖\" class=\"headerlink\" title=\"增加依赖\"></a>增加依赖</h5><figure class=\"highlight toml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">reqwest</span> = &#123; version = <span class=\"string\">\"0.11\"</span>, features = [<span class=\"string\">\"blocking\"</span>]&#125;</span><br><span class=\"line\"><span class=\"attr\">html2md</span> = <span class=\"string\">\"0.2\"</span></span><br><span class=\"line\"><span class=\"attr\">structopt</span> = <span class=\"string\">\"0.3.13\"</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>代码</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::fs;</span><br><span class=\"line\"><span class=\"keyword\">use</span> structopt::StructOpt; <span class=\"comment\">// 使用StructOpt传递参数</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#[derive(StructOpt, Debug)]</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Cli</span></span>&#123;</span><br><span class=\"line\">    url:<span class=\"built_in\">String</span>,</span><br><span class=\"line\">    output:<span class=\"built_in\">String</span>,</span><br><span class=\"line\">&#125;   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> args = Cli::from_args();</span><br><span class=\"line\">    <span class=\"comment\">// println!(\"args &#123;:?&#125; \",args);</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> url = &amp;args.url;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> output = &amp;args.output;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"url &#123;&#125;\\n output &#123;&#125;\"</span>,url,output);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> body = reqwest::blocking::get(url).unwrap().text().unwrap();</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"Converting html to markdown...\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> md = html2md::parse_html(&amp;body);</span><br><span class=\"line\">    fs::write(output, md.as_bytes()).unwrap();</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"Converted markdown has been saved in &#123;&#125;.\"</span>, output);</span><br><span class=\"line\">&#125;       </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#[test]</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">check</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"test\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"打包\"><a href=\"#打包\" class=\"headerlink\" title=\"打包\"></a>打包</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">cargo build --release</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>慢慢等待</li>\n</ul>\n<h4 id=\"测试下\"><a href=\"#测试下\" class=\"headerlink\" title=\"测试下\"></a>测试下</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> target/release</span><br><span class=\"line\">./learning-05 https://z201.vip z201.md</span><br><span class=\"line\">url https://z201.vip</span><br><span class=\"line\"> output z201.md</span><br><span class=\"line\">Converting html to markdown...</span><br><span class=\"line\">Converted markdown has been saved <span class=\"keyword\">in</span> z201.md.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["Rust"],"tags":["Rust","Cli"]},{"title":"Rust所有权","url":"/posts/3684915749/","content":"<blockquote>\n<p>Rust的核心功能之一 <strong>ownership</strong> ,运行的程序都需要使用计算机管理内存的方式，比如Java 具备垃圾回收，还有一些语言需要手动去释放内存。而Rust则是第三种方式，通过所有权管理内存，编译器在编译时会根据一些列规则检查，在运行时所有权系统的任务功能都不会减慢程序。</p>\n</blockquote>\n<ul>\n<li><strong>所有权和生命周期是 Rust 和其它编程语言的主要区别，也是 Rust 其它知识点的基础。</strong></li>\n</ul>\n<h3 id=\"所有权\"><a href=\"#所有权\" class=\"headerlink\" title=\"所有权\"></a>所有权</h3><h4 id=\"栈\"><a href=\"#栈\" class=\"headerlink\" title=\"栈\"></a>栈</h4><ul>\n<li><p><strong>栈是程序运行的基础。每当一个函数被调用时，一块连续的内存就会在栈顶被分配出来，这块内存被称为帧（frame）。</strong></p>\n</li>\n<li><p>栈以放入值的顺序存储并以相反的顺序取出值。这也被称为 <strong>后进先出</strong> (last in , first out) 。添加数据的时候加 <strong>进栈</strong> (pushing anto the stack) ，而移出数据叫 <strong>出栈</strong> (poping off th stack)。</p>\n</li>\n<li><p>在调用的过程中，一个新的帧会分配足够的空间存储寄存器的上下文。在函数里使用到的通用寄存器会在栈保存一个副本，当这个函数调用结束，通过副本，可以恢复出原本的寄存器的上下文，就像什么都没有经历一样。此外，函数所需要使用到的局部变量，也都会在帧分配的时候被预留出来。</p>\n</li>\n<li><p>栈的操作时非常快的，这主要得益于它存取数据的方式，数据的存取位置总时在栈顶，而不需要重新寻找一个位置去存放或者读取。另一个属性就是，<strong>栈中所有的数据都必须占据已知且固定的大小。</strong></p>\n</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211222143000.png\"></p>\n<ul>\n<li>但是工作中我们依然要避免大量数据存放栈中，<strong>避免栈溢出</strong>(stack overfow)，运行程序调用栈超出了系统运行的最大空间，就无法创建新的<strong>帧</strong>。就会出现<strong>溢出现象</strong>。</li>\n</ul>\n<h4 id=\"堆\"><a href=\"#堆\" class=\"headerlink\" title=\"堆\"></a>堆</h4><blockquote>\n<p>在编译时，一切无法确定大小或者大小可以改变的数据，都无法安全地放在栈上，最好放在堆上。</p>\n</blockquote>\n<ul>\n<li>堆主要存放大小未知，可能大小变化的数据，堆事缺乏组织的。<strong>当向堆中存放数据时，要申请一个空间，操作系统在堆的某处足够大的空间，把它标记为已经使用。</strong>并返回一个指针(pointer)，这个过程叫做<strong>堆上分配内存</strong>(<em>allocating on the heap</em>)。</li>\n<li>访问堆上的数据比访问栈上的数据慢,因为必须通过指针来访问。现代处理器在内存中跳转越少就越快（缓存）。当代码调用一个函数时，传递给函数的值（包括可能指向堆上数据的指针）和函数的局部变量被压入栈中。当函数结束时，这些值被移出栈。</li>\n</ul>\n<h5 id=\"案例一\"><a href=\"#案例一\" class=\"headerlink\" title=\"案例一\"></a>案例一</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">say</span></span>(name : <span class=\"built_in\">String</span>)&#123;</span><br><span class=\"line\">\t println(<span class=\"string\">\"name &#123;&#125;\"</span> , name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">say(<span class=\"string\">\"tomcat\"</span>.to_string());</span><br><span class=\"line\">say(<span class=\"string\">\"jetty\"</span>.to_string());</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>字符串的数据结构，在编译器是不确定的，运行期才代码才知道大小。比如<code>tomcat</code> 和 <code>jetty</code>，当say方法执行的时候才知道参数的具体长度。</li>\n</ul>\n<h5 id=\"案例二\"><a href=\"#案例二\" class=\"headerlink\" title=\"案例二\"></a>案例二</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut</span> arr = <span class=\"built_in\">Vec</span>::new();</span><br><span class=\"line\">arr.push(<span class=\"number\">1</span>);</span><br><span class=\"line\">arr.push(<span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>列表初始化长度是4，而不是2。在堆上内存分配会使用libc提供的mallo函数。系统调用的代价是昂贵的，所以我们要避免频繁地 malloc()。</li>\n</ul>\n<h5 id=\"内存泄漏\"><a href=\"#内存泄漏\" class=\"headerlink\" title=\"内存泄漏\"></a>内存泄漏</h5><blockquote>\n<p>如果手工管理堆内存的话，堆上内存分配后忘记释放，就会造成<strong>内存泄漏</strong>。一旦有内存泄漏，程序运行得越久，就越吃内存，最终会因为占满内存而被操作系统终止运行。</p>\n</blockquote>\n<h5 id=\"堆越界\"><a href=\"#堆越界\" class=\"headerlink\" title=\"堆越界\"></a>堆越界</h5><blockquote>\n<p>如果堆上内存被释放，但栈上指向堆上内存的相应指针没有被清空，就有可能发生使用已释放内存（use after free）的情况。</p>\n</blockquote>\n<h5 id=\"GC垃圾回收处理\"><a href=\"#GC垃圾回收处理\" class=\"headerlink\" title=\"GC垃圾回收处理\"></a>GC垃圾回收处理</h5><ul>\n<li>比如Java采用垃圾回收(<strong>GC</strong>)，来自动管理内存，定期标记(mark)找出不在被引用的对象，然后清理(sweep)掉。</li>\n<li>但是GC是不确定的，可能引起STW(Stop The World)。</li>\n</ul>\n<h5 id=\"ARC自动引用计数处理方式\"><a href=\"#ARC自动引用计数处理方式\" class=\"headerlink\" title=\"ARC自动引用计数处理方式\"></a>ARC自动引用计数处理方式</h5><ul>\n<li>在编译时，它为每个函数插入 retain/release 语句来自动维护堆上对象的引用计数，当引用计数为零的时候，release 语句就释放对象。</li>\n</ul>\n<h4 id=\"栈与堆\"><a href=\"#栈与堆\" class=\"headerlink\" title=\"栈与堆\"></a>栈与堆</h4><ul>\n<li><strong>栈上存放的数据是静态的，固定大小，固定生命周期；堆上存放的数据是动态的，不固定大小，不固定生命周期。</strong></li>\n</ul>\n<a id=\"more\"></a>\n\n<h4 id=\"所有权规则\"><a href=\"#所有权规则\" class=\"headerlink\" title=\"所有权规则\"></a>所有权规则</h4><ul>\n<li>Rust中每一个值都有一个被称为其<strong>所有者</strong>的变量。</li>\n<li>值有且只有一个所有者。当所有者（变量）离开作用域，这个值将被丢弃。</li>\n</ul>\n<h4 id=\"作用域\"><a href=\"#作用域\" class=\"headerlink\" title=\"作用域\"></a>作用域</h4><h4 id=\"变量作用域\"><a href=\"#变量作用域\" class=\"headerlink\" title=\"变量作用域\"></a>变量作用域</h4><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123; <span class=\"comment\">// 作用域开启， var无效，未声明。</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">let</span> var = <span class=\"string\">\"hello\"</span>;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 使用var </span></span><br><span class=\"line\">&#125; <span class=\"comment\">// 作用域结束, var不再有效。</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>当变量<code>var</code>离开作用域的时候，Rust会调用一个特殊的函数<code>drop</code>自动处理。</p>\n<blockquote>\n<p>在 C++ 中，这种 item 在生命周期结束时释放资源的模式有时被称作 <strong>资源获取即初始化</strong>（*Resource Acquisition Is Initialization (RAII)*）。</p>\n</blockquote>\n</li>\n</ul>\n<h4 id=\"内存分配\"><a href=\"#内存分配\" class=\"headerlink\" title=\"内存分配\"></a>内存分配</h4><blockquote>\n<p>定义某个变量且赋值，在编译期间就知道了具体内容。</p>\n</blockquote>\n<h5 id=\"案例一-1\"><a href=\"#案例一-1\" class=\"headerlink\" title=\"案例一\"></a>案例一</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> x = <span class=\"number\">5</span>;\t</span><br><span class=\"line\"><span class=\"keyword\">let</span> y = x;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>将<code>x</code>的值赋给<code>y</code>，这时候有了两个变量且值都等于5。此时栈中会存放两个5。</li>\n</ul>\n<h5 id=\"案例二-1\"><a href=\"#案例二-1\" class=\"headerlink\" title=\"案例二\"></a>案例二</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"Hello, world!\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> s1 = <span class=\"built_in\">String</span>::from(<span class=\"string\">\"hi\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> s2 = s1;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"s1 value &#123;&#125;\"</span>,s1);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"s2 value &#123;&#125;\"</span>,s2);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"code\"><pre><span class=\"line\">--&gt; src/main.rs:5:28</span><br><span class=\"line\">  |</span><br><span class=\"line\">3 |     let s1 = String::from(\"hi\");</span><br><span class=\"line\">  |         -- move occurs because `s1` has type `String`, which does not implement the `Copy` trait</span><br><span class=\"line\">4 |     let s2 = s1;</span><br><span class=\"line\">  |              -- value moved here</span><br><span class=\"line\">5 |     println!(\"s1 value &#123;&#125;\",s1);</span><br><span class=\"line\">  |                            ^^ value borrowed here after move</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>编译器会提示两个错误，将s1 赋值给 s2 后 s1 就不能被访问了。</li>\n<li>如果还想让s1 被访问就需要 clone复制一份堆数据出来。</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"Hello, world!\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> s1 = <span class=\"built_in\">String</span>::from(<span class=\"string\">\"hi\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> s2 = s1.clone();</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"s1 value &#123;&#125;\"</span>,s1);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"s2 value &#123;&#125;\"</span>,s2);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">Hello, world!</span><br><span class=\"line\">s1 value hi</span><br><span class=\"line\">s2 value hi</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Copy\"><a href=\"#Copy\" class=\"headerlink\" title=\"Copy\"></a>Copy</h4><blockquote>\n<p>Rust 有一个叫做 <code>Copy</code> trait 的特殊注解，可以用在类似整型这样的存储在栈上的类型上</p>\n</blockquote>\n<ul>\n<li>所有整数类型，比如 u32。</li>\n<li>布尔类型，bool，它的值是 true 和 false。<br>所有浮点数类型，比如 f64。</li>\n<li>字符类型，char。</li>\n<li>Tuple元组，当且仅当其包含的类型也都是 Copy 的时候。比如，(i32, i32) 是 Copy 的，但 (i32, String) 就不是。</li>\n</ul>\n<h4 id=\"所有权与函数\"><a href=\"#所有权与函数\" class=\"headerlink\" title=\"所有权与函数\"></a>所有权与函数</h4><blockquote>\n<p>将值传递给函数在语义上与给变量赋值相似。向函数传递值可能会移动或者复制，就像赋值语句一样。</p>\n</blockquote>\n<h5 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> s = <span class=\"built_in\">String</span>::from(<span class=\"string\">\"hi\"</span>);    <span class=\"comment\">// s 进入作用域</span></span><br><span class=\"line\">    hello(s);                    </span><br><span class=\"line\">                                    <span class=\"comment\">// s 到这里不再有效</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> x = <span class=\"number\">5</span>;                      <span class=\"comment\">// x 进入作用域</span></span><br><span class=\"line\">    hello_copy(x);                  <span class=\"comment\">// x 应该移动函数里，</span></span><br><span class=\"line\">                                    <span class=\"comment\">// 但 i32 是 Copy 的，所以在后面可继续使用 x</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">println!</span>(<span class=\"string\">\"x &#123;&#125;\"</span>, x);</span><br><span class=\"line\">&#125; <span class=\"comment\">// 这里, x 先移出了作用域，然后是 s。但因为 s 的值已被移走，</span></span><br><span class=\"line\">  <span class=\"comment\">// 所以不会有特殊操作</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">hello</span></span>(some_string: <span class=\"built_in\">String</span>) &#123; <span class=\"comment\">// some_string 进入作用域</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"&#123;&#125;\"</span>, some_string);</span><br><span class=\"line\">&#125; <span class=\"comment\">// 移出作用域并调用 `drop` 方法。占用的内存被释放</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">hello_copy</span></span>(some_integer: <span class=\"built_in\">i32</span>) &#123; <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"&#123;&#125;\"</span>, some_integer);</span><br><span class=\"line\">&#125; <span class=\"comment\">// 移出作用域并调用 `drop` 方法。占用的内存被释放</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"code\"><pre><span class=\"line\">hi</span><br><span class=\"line\">5</span><br><span class=\"line\">x 5</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"返回值与作用域\"><a href=\"#返回值与作用域\" class=\"headerlink\" title=\"返回值与作用域\"></a>返回值与作用域</h4><blockquote>\n<p>返回值也可以转移所有权</p>\n</blockquote>\n<h5 id=\"案例-1\"><a href=\"#案例-1\" class=\"headerlink\" title=\"案例\"></a>案例</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> s1 = gives();              <span class=\"comment\">// gives_ownership 将返回值移给 s1</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"s1 &#123;&#125;\"</span>,s1);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> s2 = <span class=\"built_in\">String</span>::from(<span class=\"string\">\"hello\"</span>); <span class=\"comment\">// s2 进入作用域</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"s2 &#123;&#125;\"</span>,s2);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> s3 = gives_back(s2);        <span class=\"comment\">// s2 gives_back 中,  它也将返回值移给 s3</span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"s3 &#123;&#125;\"</span>,s3);</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">gives</span></span>() -&gt; <span class=\"built_in\">String</span> &#123;             <span class=\"comment\">//  将返回值移动给</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> some_string = <span class=\"built_in\">String</span>::from(<span class=\"string\">\"hello\"</span>); <span class=\"comment\">// some_string 进入作用域.</span></span><br><span class=\"line\">    some_string                              <span class=\"comment\">// 返回 some_string 并移出给调用的函数</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">gives_back</span></span>(a_string: <span class=\"built_in\">String</span>) -&gt; <span class=\"built_in\">String</span> &#123; <span class=\"comment\">// a_string 进入作用域</span></span><br><span class=\"line\"></span><br><span class=\"line\">    a_string  <span class=\"comment\">// 返回 a_string 并移出给调用的函数</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">s1 hello</span><br><span class=\"line\">s2 hello</span><br><span class=\"line\">s3 hello</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h3>","categories":["Rust"],"tags":["Rust"]},{"title":"Rust函数与控制流","url":"/posts/1087924605/","content":"<h2 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a>函数</h2><blockquote>\n<p>函数遍布于 Rust 代码中,Rust 代码中的函数和变量名使用 <em>snake case</em> 规范风格。在 snake case 中，所有字母都是小写并使用下划线分隔单词。</p>\n</blockquote>\n<ul>\n<li>Rust 中的函数定义以 <code>fn</code> 开始并在函数名后跟一对圆括号。大括号告诉编译器哪里是函数体的开始和结尾。</li>\n<li>可以使用函数名后跟圆括号来调用我们定义过的任意函数。<strong>Rust 不关心函数定义于何处，只要定义了就行。</strong></li>\n</ul>\n<h3 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h3><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"Hello, world!\"</span>);</span><br><span class=\"line\">    hello();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">hello</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"built_in\">print!</span>(<span class=\"string\">\"hello function\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight tex\"><table><tr><td class=\"code\"><pre><span class=\"line\">Hello, world!</span><br><span class=\"line\">hello function</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"函数参数\"><a href=\"#函数参数\" class=\"headerlink\" title=\"函数参数\"></a>函数参数</h3><blockquote>\n<p>函数也可以被定义为拥有 参数（parameters），参数是特殊变量，是函数签名的一部分。当函数拥有参数（形参）时，可以为这些参数提供具体的值（实参）。</p>\n</blockquote>\n<ul>\n<li>在函数签名中，<strong>必须</strong> 声明每个参数的类型。这是 Rust 设计中一个经过慎重考虑的决定：要求在函数定义中提供类型注解，意味着编译器不需要你在代码的其他地方注明类型来指出你的意图。</li>\n<li>多个参数时，使用逗号分隔。</li>\n</ul>\n<h3 id=\"案例-1\"><a href=\"#案例-1\" class=\"headerlink\" title=\"案例\"></a>案例</h3><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">number</span></span>(x:<span class=\"built_in\">i8</span>)&#123;</span><br><span class=\"line\">    <span class=\"built_in\">print!</span>(<span class=\"string\">\"value &#123;&#125; \"</span>,x)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"Hello, world!\"</span>);</span><br><span class=\"line\">    number(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">Hello, world!</span><br><span class=\"line\">value 1</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>number函数声明一个<code>x</code>的参数，<code>x</code>的类型被指定为<code>i8</code>。</li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"函数体\"><a href=\"#函数体\" class=\"headerlink\" title=\"函数体\"></a>函数体</h3><blockquote>\n<p>Rust 是一门基于表达式（expression-based）的语言,函数体由一系列的语句和一个可选的结尾表达式构成</p>\n</blockquote>\n<ul>\n<li>函数可以向调用它的代码返回值。不需要对返回值命令，但要在箭头（<code>-&gt;</code>）后声明它的类型。在 Rust 中，函数的返回值等同于函数体最后一个表达式的值。使用 <code>return</code> 关键字和指定值，可从函数中提前返回。</li>\n</ul>\n<h3 id=\"案例一\"><a href=\"#案例一\" class=\"headerlink\" title=\"案例一\"></a>案例一</h3><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"Hello, world!\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// number(1);</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> x = <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> y = &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> x = <span class=\"number\">3</span>;</span><br><span class=\"line\">        x + <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"x &#123;&#125; y &#123;&#125;\"</span>, x,y);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">Hello, world!</span><br><span class=\"line\">x 5 y 4</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例二\"><a href=\"#案例二\" class=\"headerlink\" title=\"案例二\"></a>案例二</h3><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">i</span></span>() -&gt; <span class=\"built_in\">i8</span>&#123;</span><br><span class=\"line\">    <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> x = i();</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"value &#123;&#125;\"</span> , x);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">value 1</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例三\"><a href=\"#案例三\" class=\"headerlink\" title=\"案例三\"></a>案例三</h3><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">ii</span></span>(x : <span class=\"built_in\">i8</span>)-&gt; <span class=\"built_in\">i8</span> &#123;</span><br><span class=\"line\">    x + <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> x = ii(<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"value &#123;&#125;\"</span>,x);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">value 3</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"函数与变量\"><a href=\"#函数与变量\" class=\"headerlink\" title=\"函数与变量\"></a>函数与变量</h2><blockquote>\n<p>在 Rust 下，函数是一等公民，可以作为参数或者返回值。</p>\n</blockquote>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">one</span></span>(value: <span class=\"built_in\">i32</span>, f: <span class=\"function\"><span class=\"keyword\">fn</span></span>(<span class=\"built_in\">i32</span>) -&gt; <span class=\"built_in\">i32</span>) -&gt; <span class=\"built_in\">i32</span> &#123;</span><br><span class=\"line\">    f(value)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">two</span></span>(value: <span class=\"built_in\">i32</span>) -&gt; <span class=\"built_in\">i32</span> &#123;</span><br><span class=\"line\">    value * value</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">three</span></span>(value: <span class=\"built_in\">i32</span>) -&gt; <span class=\"built_in\">i32</span> &#123;</span><br><span class=\"line\">    value * value * value</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"apply square: &#123;&#125;\"</span>, apply(<span class=\"number\">2</span>, square));</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"apply cube: &#123;&#125;\"</span>, apply(<span class=\"number\">2</span>, cube));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">apply square: 4</span><br><span class=\"line\">apply cube: 8</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>fn(i32) -&gt; i32 是 three函数第二个参数，它表示可以接受一个函数作为参数。这个传入的函数必须是：参数只有一个，且类型为 i32，返回值类型也是 i32。</strong></li>\n<li><strong>Rust 函数参数的类型和返回值的类型都必须显式定义，如果没有返回值可以省略，返回 unit。函数内部如果提前返回，需要用 return 关键字</strong></li>\n</ul>\n<h2 id=\"控制流\"><a href=\"#控制流\" class=\"headerlink\" title=\"控制流\"></a>控制流</h2><blockquote>\n<p>根据条件是否为真来决定是否执行某些代码</p>\n</blockquote>\n<h3 id=\"if\"><a href=\"#if\" class=\"headerlink\" title=\"if\"></a>if</h3><h4 id=\"案例一-1\"><a href=\"#案例一-1\" class=\"headerlink\" title=\"案例一\"></a>案例一</h4><ul>\n<li>注意不需要()</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\">n ii(x : <span class=\"built_in\">i8</span>)-&gt; <span class=\"built_in\">i8</span> &#123;</span><br><span class=\"line\">    x + <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> number = <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> x = ii(<span class=\"number\">2</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> number &gt; x&#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"value &#123;&#125;\"</span>,x);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"value x &#123;&#125;\"</span>,x);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">value 3</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"案例二-1\"><a href=\"#案例二-1\" class=\"headerlink\" title=\"案例二\"></a>案例二</h4><blockquote>\n<p>在 let 语句中使用if</p>\n</blockquote>\n<ul>\n<li>将if 表达式中返回值赋给一个变量。这里需要注意返回类型需要一致。否则编译失败。</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> c = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> number = <span class=\"keyword\">if</span> c &#123;</span><br><span class=\"line\">        <span class=\"number\">5</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"number\">6</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"The value of c is: &#123;&#125;\"</span>, number);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"loop\"><a href=\"#loop\" class=\"headerlink\" title=\"loop\"></a>loop</h3><blockquote>\n<p>Rust 为此提供了多种 <strong>循环</strong>（<em>loops</em>）。一个循环执行循环体中的代码直到结尾并紧接着回到开头继续执行。</p>\n</blockquote>\n<h4 id=\"案例一-2\"><a href=\"#案例一-2\" class=\"headerlink\" title=\"案例一\"></a>案例一</h4><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"hello!\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console，需要手动停止。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">hello!</span><br><span class=\"line\">.....</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"案例二-2\"><a href=\"#案例二-2\" class=\"headerlink\" title=\"案例二\"></a>案例二</h4><blockquote>\n<p>使用break 关键字跳出循环。</p>\n</blockquote>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut</span> number = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> result = <span class=\"keyword\">loop</span> &#123;</span><br><span class=\"line\">        number += <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> number == <span class=\"number\">10</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">break</span> number;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"result &#123;&#125; value &#123;&#125;\"</span>,result ,number);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">result 10 value 10</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"while\"><a href=\"#while\" class=\"headerlink\" title=\"while\"></a>while</h3><blockquote>\n<p>当条件为真，执行循环。当条件不再为真。调用 <code>break</code> 停止循环。</p>\n</blockquote>\n<h4 id=\"案例-2\"><a href=\"#案例-2\" class=\"headerlink\" title=\"案例\"></a>案例</h4><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> <span class=\"keyword\">mut</span> number = <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> number &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"&#123;&#125;!\"</span>, number);</span><br><span class=\"line\">        number = number - <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"done &#123;&#125; \"</span>,number);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">3!</span><br><span class=\"line\">2!</span><br><span class=\"line\">1!</span><br><span class=\"line\">done 0</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"for\"><a href=\"#for\" class=\"headerlink\" title=\"for\"></a>for</h3><blockquote>\n<p>遍历集合</p>\n</blockquote>\n<h4 id=\"案例一-3\"><a href=\"#案例一-3\" class=\"headerlink\" title=\"案例一\"></a>案例一</h4><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>()&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">let</span> arr = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">let</span> <span class=\"keyword\">mut</span> index = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> index &lt; <span class=\"number\">3</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">println!</span>(<span class=\"string\">\"value &#123;&#125;\"</span>,arr[index]);</span><br><span class=\"line\">\t\tindex = index + <span class=\"number\">1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">for</span> element <span class=\"keyword\">in</span> arr.iter() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"value is: &#123;&#125;\"</span>, element);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">value 1</span><br><span class=\"line\">value 2</span><br><span class=\"line\">value 3</span><br><span class=\"line\">value is: 1</span><br><span class=\"line\">value is: 2</span><br><span class=\"line\">value is: 3</span><br><span class=\"line\">value is: 4</span><br><span class=\"line\">value is: 5</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"案例二-3\"><a href=\"#案例二-3\" class=\"headerlink\" title=\"案例二\"></a>案例二</h4><blockquote>\n<p>使用 <code>rev</code>来反转range</p>\n</blockquote>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> number <span class=\"keyword\">in</span> (<span class=\"number\">1</span>..<span class=\"number\">4</span>).rev() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"&#123;&#125;!\"</span>, number);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"done!!!\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">3!</span><br><span class=\"line\">2!</span><br><span class=\"line\">1!</span><br><span class=\"line\">done!!!</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h3>","categories":["Rust"],"tags":["Rust"]},{"title":"Rust变量与数据类型","url":"/posts/2633150323/","content":"<h2 id=\"Rust变量与数据类型\"><a href=\"#Rust变量与数据类型\" class=\"headerlink\" title=\"Rust变量与数据类型\"></a>Rust变量与数据类型</h2><blockquote>\n<p>Rust 是一种静态类型的语言。 Rust 中的每个值都是某种数据类型。 编译器可以根据分配给它的值自动推断变量的数据类型。</p>\n</blockquote>\n<h3 id=\"let\"><a href=\"#let\" class=\"headerlink\" title=\"let\"></a>let</h3><blockquote>\n<p>使用let关键字声明变量</p>\n</blockquote>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"Rust基础语法!\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> str_ = <span class=\"string\">\"String\"</span>; <span class=\"comment\">// string 类型</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> f_ = <span class=\"number\">1.1</span>; <span class=\"comment\">// float 类型</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> bool_ = <span class=\"literal\">true</span>; <span class=\"comment\">// boolean 类型</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> char_ = <span class=\"string\">'a'</span>; <span class=\"comment\">// unicode character </span></span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"string &#123;&#125;\"</span>,str_); </span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"float &#123;&#125;\"</span>,f_); </span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"boolean &#123;&#125;\"</span>,bool_); </span><br><span class=\"line\">    <span class=\"built_in\">println!</span>(<span class=\"string\">\"icon &#123;&#125;\"</span>,char_); </span><br><span class=\"line\">\t  </span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Rust基础语法!</span><br><span class=\"line\">string String</span><br><span class=\"line\"><span class=\"built_in\">float</span> 1.1</span><br><span class=\"line\">boolean <span class=\"literal\">true</span></span><br><span class=\"line\">icon a</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h3 id=\"println\"><a href=\"#println\" class=\"headerlink\" title=\"println!\"></a>println!</h3><blockquote>\n<p>打印控制台方法</p>\n</blockquote>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#[macro_export]</span></span><br><span class=\"line\"><span class=\"meta\">#[stable(feature = <span class=\"meta-string\">\"rust1\"</span>, since = <span class=\"meta-string\">\"1.0.0\"</span>)]</span></span><br><span class=\"line\"><span class=\"meta\">#[allow_internal_unstable(print_internals, format_args_nl)]</span></span><br><span class=\"line\"><span class=\"built_in\">macro_rules!</span> println &#123;</span><br><span class=\"line\">    () =&gt; ($crate::<span class=\"built_in\">print!</span>(<span class=\"string\">\"\\n\"</span>));</span><br><span class=\"line\">    ($($arg:tt)*) =&gt; (&#123;</span><br><span class=\"line\">        $crate::io::_print($crate::format_args_nl!($($arg)*));</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>一个参数是占位符 *{ }*，特别的语法</li>\n<li>一个参数是变量或者常量</li>\n</ul>\n<h3 id=\"scalar-Types\"><a href=\"#scalar-Types\" class=\"headerlink\" title=\"scalar Types\"></a>scalar Types</h3><blockquote>\n<p>Rust有四种标量类型 整型、浮点型、布尔型、字符型</p>\n</blockquote>\n<h4 id=\"整型\"><a href=\"#整型\" class=\"headerlink\" title=\"整型\"></a>整型</h4><blockquote>\n<p>整型是指没有小数部分的数字。也就是说，整型是用于表示整数的。整型可以进一步分为有符号（Signed）与无符号（Unsigned）的。可以存储正负值。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>大小</th>\n<th>有符号Signed</th>\n<th>无符号Unsigned</th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td>8bit</td>\n<td>i8</td>\n<td>u8</td>\n</tr>\n<tr>\n<td></td>\n<td>16bit</td>\n<td>i16</td>\n<td>u16</td>\n</tr>\n<tr>\n<td></td>\n<td>32bit</td>\n<td>i32</td>\n<td>u32</td>\n</tr>\n<tr>\n<td></td>\n<td>64bit</td>\n<td>i64</td>\n<td>u64</td>\n</tr>\n<tr>\n<td></td>\n<td>128bit</td>\n<td>i128</td>\n<td>u128</td>\n</tr>\n<tr>\n<td></td>\n<td>arch</td>\n<td>issize</td>\n<td>Size</td>\n</tr>\n</tbody></table>\n<h5 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> result = <span class=\"number\">1</span>;    <span class=\"comment\">// 默认类型为i32</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> u20:<span class=\"built_in\">u32</span> = <span class=\"number\">20</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"built_in\">i32</span>:<span class=\"built_in\">i32</span> = -<span class=\"number\">15</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> s:<span class=\"built_in\">isize</span> = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> count:<span class=\"built_in\">usize</span> = <span class=\"number\">30</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"result value is &#123;&#125;\"</span>,result);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"u20 is &#123;&#125; i32 is &#123;&#125;\"</span>,u20,<span class=\"built_in\">i32</span>);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"mark is &#123;&#125; and count is &#123;&#125;\"</span>,s,count);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">result value is 1</span><br><span class=\"line\">u20 is 20 i32 is -15</span><br><span class=\"line\">mark is 10 and count is 30</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"整型溢出\"><a href=\"#整型溢出\" class=\"headerlink\" title=\"整型溢出\"></a>整型溢出</h4><blockquote>\n<p>当分配给整型变量的值超出该整型在 Rust 中定义值的范围时，就会发生整型溢出</p>\n</blockquote>\n<h5 id=\"案例-1\"><a href=\"#案例-1\" class=\"headerlink\" title=\"案例\"></a>案例</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> u1:<span class=\"built_in\">u8</span> = <span class=\"number\">255</span>;</span><br><span class=\"line\"><span class=\"comment\">// u8数据范围为0~255</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> u2:<span class=\"built_in\">u8</span> = <span class=\"number\">256</span>;   <span class=\"comment\">//溢出值为 1</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> u3:<span class=\"built_in\">u8</span> = <span class=\"number\">257</span>;   <span class=\"comment\">//溢出值为 2</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> u4:<span class=\"built_in\">u8</span> = <span class=\"number\">258</span>;    <span class=\"comment\">//溢出值为 3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"1 is &#123;&#125; \"</span>,u1);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"2 is &#123;&#125;\"</span>,u2);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"3 is &#123;&#125;\"</span>,u3);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"4 is &#123;&#125;\"</span>,u4);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">error: literal out of range <span class=\"keyword\">for</span> `u8`</span><br><span class=\"line\">  --&gt; src/main.rs:24:16</span><br><span class=\"line\">   |</span><br><span class=\"line\">24 |    <span class=\"built_in\">let</span> u2:u8 = 256;   //溢出值为 1</span><br><span class=\"line\">   |                ^^^</span><br><span class=\"line\">   |</span><br><span class=\"line\">   = note: `<span class=\"comment\">#[deny(overflowing_literals)]` on by default</span></span><br><span class=\"line\">   = note: the literal `256` does not fit into the <span class=\"built_in\">type</span> `u8` whose range is `0..=255`</span><br><span class=\"line\"></span><br><span class=\"line\">error: literal out of range <span class=\"keyword\">for</span> `u8`</span><br><span class=\"line\">  --&gt; src/main.rs:25:16</span><br><span class=\"line\">   |</span><br><span class=\"line\">25 |    <span class=\"built_in\">let</span> u3:u8 = 257;   //溢出值为 2</span><br><span class=\"line\">   |                ^^^</span><br><span class=\"line\">   |</span><br><span class=\"line\">   = note: the literal `257` does not fit into the <span class=\"built_in\">type</span> `u8` whose range is `0..=255`</span><br><span class=\"line\"></span><br><span class=\"line\">error: literal out of range <span class=\"keyword\">for</span> `u8`</span><br><span class=\"line\">  --&gt; src/main.rs:26:16</span><br><span class=\"line\">   |</span><br><span class=\"line\">26 |    <span class=\"built_in\">let</span> u4:u8 = 258;    //溢出值为 3</span><br><span class=\"line\">   |                ^^^</span><br><span class=\"line\">   |</span><br><span class=\"line\">   = note: the literal `258` does not fit into the <span class=\"built_in\">type</span> `u8` whose range is `0..=255`</span><br><span class=\"line\"></span><br><span class=\"line\">error: could not compile `learning-02` due to 3 previous errors</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Rust的提示非常棒</li>\n</ul>\n<h4 id=\"浮点型\"><a href=\"#浮点型\" class=\"headerlink\" title=\"浮点型\"></a>浮点型</h4><blockquote>\n<p>Rust 中的浮点型可被分为 <strong>f32</strong> 和 <strong>f64</strong>。f32 是单精度浮点型，f64 是双精度浮点型。默认浮点型为 f64。</p>\n</blockquote>\n<h5 id=\"案例-2\"><a href=\"#案例-2\" class=\"headerlink\" title=\"案例\"></a>案例</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> f1 = <span class=\"number\">10.00</span>;        <span class=\"comment\">//默认为 f64 浮点型</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> f2:<span class=\"built_in\">f32</span> = <span class=\"number\">8.35</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> f3:<span class=\"built_in\">f64</span> = <span class=\"number\">15000.600</span>;  <span class=\"comment\">//双精度浮点型</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"f1 value is &#123;&#125;\"</span>,f1);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"f2 is &#123;&#125;\"</span>,f2);</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"f3 is &#123;&#125;\"</span>,f3);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">f1 value is 10</span><br><span class=\"line\">f2 is 8.35</span><br><span class=\"line\">f3 is 15000.6</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"自动类型转换\"><a href=\"#自动类型转换\" class=\"headerlink\" title=\"自动类型转换\"></a>自动类型转换</h4><blockquote>\n<p>Rust 中不支持自动类型转换</p>\n</blockquote>\n<h5 id=\"案例-3\"><a href=\"#案例-3\" class=\"headerlink\" title=\"案例\"></a>案例</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> interest:<span class=\"built_in\">f32</span> = <span class=\"number\">8</span>;   <span class=\"comment\">// 浮点型变量被赋予整型值</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"interest is &#123;&#125;\"</span>,interest);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">error[E0308]: mismatched types</span><br><span class=\"line\">  --&gt; src&#x2F;main.rs:41:23</span><br><span class=\"line\">   |</span><br><span class=\"line\">41 |    let interest:f32 &#x3D; 8;   &#x2F;&#x2F; 浮点型变量被赋予整型值</span><br><span class=\"line\">   |                 ---   ^</span><br><span class=\"line\">   |                 |     |</span><br><span class=\"line\">   |                 |     expected &#96;f32&#96;, found integer</span><br><span class=\"line\">   |                 |     help: use a float literal: &#96;8.0&#96;</span><br><span class=\"line\">   |                 expected due to this</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"布尔值\"><a href=\"#布尔值\" class=\"headerlink\" title=\"布尔值\"></a>布尔值</h4><blockquote>\n<p>布尔型有两种可能的值 ——<em>true</em> 或是 <em>false</em>。使用 <strong>bool</strong> 关键字可以声明布尔型变量。</p>\n</blockquote>\n<h5 id=\"案例-4\"><a href=\"#案例-4\" class=\"headerlink\" title=\"案例\"></a>案例</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> b:<span class=\"built_in\">bool</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"boolean &#123;&#125;\"</span>,b);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">boolean true</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"字符型\"><a href=\"#字符型\" class=\"headerlink\" title=\"字符型\"></a>字符型</h4><blockquote>\n<p>Rust 中的字符型支持数字，字母，Unicode 和特殊字符。使用 char 关键字可以声明字符型变量。Rust 中的字符型用 Unicode 标量值储存，即 Rust 中的字符型可以表示比 ASCII 更多的字符。Unicode 标量值的范围包括从 U+0000 到 U+D7FF 和从 U+E000 到 U+10FFFF。</p>\n</blockquote>\n<h5 id=\"案例-5\"><a href=\"#案例-5\" class=\"headerlink\" title=\"案例\"></a>案例</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> def_c = <span class=\"string\">'@'</span>; <span class=\"comment\">//默认为字符型</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> c:<span class=\"built_in\">char</span> = <span class=\"string\">'Z'</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> emoji:<span class=\"built_in\">char</span> = '😁';</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">character is @</span><br><span class=\"line\">alphabet is Z</span><br><span class=\"line\">emoji is 😁</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"类型转字符串\"><a href=\"#类型转字符串\" class=\"headerlink\" title=\"类型转字符串\"></a>类型转字符串</h5><blockquote>\n<p>to_String()</p>\n</blockquote>\n<h6 id=\"案例-6\"><a href=\"#案例-6\" class=\"headerlink\" title=\"案例\"></a>案例</h6><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> x: <span class=\"built_in\">u32</span> = <span class=\"number\">10</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> s: <span class=\"built_in\">String</span> = x.to_string();</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">\"&#123;&#125;\"</span>, s);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">10</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"let变量\"><a href=\"#let变量\" class=\"headerlink\" title=\"let变量\"></a>let变量</h4><blockquote>\n<p>变量是程序可以操纵的命名存储</p>\n</blockquote>\n<ul>\n<li><p>必须以字母或下划线开头。</p>\n</li>\n<li><p>变量的名称可以由字母，数字和下划线字符组成。</p>\n</li>\n<li><p>Rust区分大小写</p>\n</li>\n<li><p>不可变性</p>\n<ul>\n<li>变量默认是不可变的，只读的。也就是说，变量的值在初始化后不可再被改变。比如</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> var = <span class=\"number\">25_000</span>;</span><br><span class=\"line\"> <span class=\"built_in\">println!</span>(<span class=\"string\">\"var is &#123;&#125; \"</span>,var);</span><br><span class=\"line\"> var = <span class=\"number\">35_000</span>;</span><br><span class=\"line\"> <span class=\"built_in\">println!</span>(<span class=\"string\">\"var changed is &#123;&#125;\"</span>,var);</span><br></pre></td></tr></table></figure>\n\n<p>Console</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">  --&gt; src&#x2F;main.rs:57:5</span><br><span class=\"line\">   |</span><br><span class=\"line\">55 |     let var &#x3D; 25_000;</span><br><span class=\"line\">   |         ---</span><br><span class=\"line\">   |         |</span><br><span class=\"line\">   |         first assignment to &#96;var&#96;</span><br><span class=\"line\">   |         help: consider making this binding mutable: &#96;mut var&#96;</span><br><span class=\"line\">56 |     println!(&quot;var is &#123;&#125; &quot;,var);</span><br><span class=\"line\">57 |     var &#x3D; 35_000;</span><br><span class=\"line\">   |     ^^^^^^^^^^^^ cannot assign twice to immutable variable</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>可变性<ul>\n<li>在变量名前加上 <strong>mut</strong> 关键字可以使其可变。可变变量的值可以更改。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"keyword\">mut</span> var = <span class=\"number\">25_000</span>;</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">\"var is &#123;&#125; \"</span>,var);</span><br><span class=\"line\">  var = <span class=\"number\">35_000</span>;</span><br><span class=\"line\">  <span class=\"built_in\">println!</span>(<span class=\"string\">\"var changed is &#123;&#125;\"</span>,var);</span><br></pre></td></tr></table></figure>\n\n<p>Console</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">var is 25000 </span><br><span class=\"line\">var changed is 35000</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"const常量\"><a href=\"#const常量\" class=\"headerlink\" title=\"const常量\"></a>const常量</h4><blockquote>\n<p>常量一定要显式声明它的数据类型。以下是声明常量的语法：</p>\n</blockquote>\n<ul>\n<li>而声明常量时一定要声明它的数据类型。<code>const VARIABLE_NAME:dataType = value;</code></li>\n<li>使用 <strong>let</strong> 关键字声明的变量默认是不可变的。但是你可以选择使用 <strong>mut</strong> 关键字来使其可变。常量则<code>永远是不可变的</code>。</li>\n<li>常量可以在任何范围内声明，包括全局范围。</li>\n</ul>\n<h5 id=\"案例-7\"><a href=\"#案例-7\" class=\"headerlink\" title=\"案例\"></a>案例</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> VAR_NAME:<span class=\"built_in\">char</span> = <span class=\"string\">'A'</span>;</span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"VAR_NAME is &#123;&#125;\"</span>,VAR_NAME);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">VAR_NAME is A</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"shadowing-覆盖\"><a href=\"#shadowing-覆盖\" class=\"headerlink\" title=\"shadowing 覆盖\"></a>shadowing 覆盖</h4><blockquote>\n<p>Rust 支持不同数据类型的变量之间的覆盖（隐藏 shadowing）。</p>\n</blockquote>\n<ul>\n<li>变量可以被覆盖，常量不行。</li>\n</ul>\n<h5 id=\"案例一\"><a href=\"#案例一\" class=\"headerlink\" title=\"案例一\"></a>案例一</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> salary = <span class=\"number\">100.00</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> salary = <span class=\"number\">1.50</span> ; </span><br><span class=\"line\"><span class=\"comment\">// 读取salary变量的值</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"The value of salary is :&#123;&#125;\"</span>,salary);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">The value of salary is :1.5</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"案例二\"><a href=\"#案例二\" class=\"headerlink\" title=\"案例二\"></a>案例二</h5><figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> salary2 = <span class=\"number\">100.00</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> salary2 = <span class=\"number\">1.50</span> ; </span><br><span class=\"line\"><span class=\"comment\">// 读取salary变量的值</span></span><br><span class=\"line\"><span class=\"built_in\">println!</span>(<span class=\"string\">\"The value of salary is :&#123;&#125;\"</span>,salary2);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">  --&gt; src&#x2F;main.rs:68:11</span><br><span class=\"line\">   |</span><br><span class=\"line\">68 |     const salary2 &#x3D; 100.00;</span><br><span class=\"line\">   |           ^^^^^^^ help: provide a type for the constant: &#96;salary2: f64&#96;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"操作符\"><a href=\"#操作符\" class=\"headerlink\" title=\"操作符\"></a>操作符</h3><blockquote>\n<p>运算符（操作符）定义了对于数据的的处理。被运算符所作用的数据被称为运算数。</p>\n</blockquote>\n<h4 id=\"算数运算法\"><a href=\"#算数运算法\" class=\"headerlink\" title=\"算数运算法\"></a>算数运算法</h4><ul>\n<li>加 +</li>\n<li>减 -</li>\n<li>乘 *</li>\n<li>除 / </li>\n<li>取余 %</li>\n</ul>\n<h4 id=\"操作运算符\"><a href=\"#操作运算符\" class=\"headerlink\" title=\"操作运算符\"></a>操作运算符</h4><ul>\n<li><code>&gt;</code> 大于</li>\n<li><code>&lt;</code>小于</li>\n<li><code>&gt;=</code> 大于等于</li>\n<li><code>&lt;=</code> 小于等于</li>\n<li><code>==</code> 等于</li>\n<li><code>!=</code> 不等于</li>\n</ul>\n<h4 id=\"逻辑运算符\"><a href=\"#逻辑运算符\" class=\"headerlink\" title=\"逻辑运算符\"></a>逻辑运算符</h4><ul>\n<li><code>&amp;&amp;</code> 与</li>\n<li><code>||</code> 或</li>\n<li><code>! </code>非</li>\n</ul>\n<h4 id=\"位运算符\"><a href=\"#位运算符\" class=\"headerlink\" title=\"位运算符\"></a>位运算符</h4><ul>\n<li>&amp; （按位与）</li>\n<li>|（按位或）</li>\n<li>^（按位异或）</li>\n<li>!（按位非）</li>\n<li>&lt;&lt;（左移）</li>\n<li>&gt;&gt;（右移）</li>\n<li>&gt;&gt;&gt;（无符号右移）</li>\n</ul>\n<h2 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h2>","categories":["Rust"],"tags":["Rust"]},{"title":"Rust入门","url":"/posts/3684915742/","content":"<blockquote>\n<p>学习下Rust</p>\n</blockquote>\n<h2 id=\"为什么学习Rust\"><a href=\"#为什么学习Rust\" class=\"headerlink\" title=\"为什么学习Rust\"></a>为什么学习Rust</h2><blockquote>\n<p>在知乎上看到一个人对Rust的评论。</p>\n<p>首先，Rust 是有点反人类，否则不会一直都不火。然后，Rust 之所以反人类，是因为人类这玩意既愚蠢，又自大，破事还贼多。 你看 C++ 就很相信人类，它要求人类自己把自己 new 出来的东西给 delete 掉。 C++：“这点小事我相信你可以的！” 人类：“没问题！包在我身上！” 然后呢，内存泄漏、double free、野指针满世界飘…… C++：“……”</p>\n<p>Java 选择不相信人类，但替人类把事办好。 Java：“别动，让我来，我有gc！” 人类：“你怎么做事这么慢呀？你怎么还 stop the world 了呀？你是不是不爱我了呀？” Java：“……”</p>\n<p>Rust 发现唯一的办法就是既不相信人类，也不惯着人类。 Rust：“按老子说的做，不做就不编译！” 人类：“你反人类！” Rust：“滚！”</p>\n</blockquote>\n<ul>\n<li>C/C++ 完全相信而且惯着程序员，让大家自行管理内存，所以可以编写很自由的代码，但一个不小心就会造成内存泄漏等问题导致程序崩溃。</li>\n<li>Java/Golang 完全不相信程序员，但也惯着程序员。所有的内存生命周期都由 JVM 运行时统一管理。 在绝大部分场景下，你可以非常自由的写代码，而且不用关心内存到底是什么情况。 内存使用有问题的时候，我们可以通过 JVM 来信息相关的分析诊断和调整。</li>\n<li>Rust 语言选择既不相信程序员，也不惯着程序员。 让你在写代码的时候，必须清楚明白的用 Rust 的规则管理好你的变量，好让机器能明白高效地分析和管理内存。 但是这样会导致代码不利于人的理解，写代码很不自由，学习成本也很高。</li>\n</ul>\n<a id=\"more\"></a>\n\n<h2 id=\"安装Rust开发环境\"><a href=\"#安装Rust开发环境\" class=\"headerlink\" title=\"安装Rust开发环境\"></a>安装Rust开发环境</h2><h3 id=\"安装Rust\"><a href=\"#安装Rust\" class=\"headerlink\" title=\"安装Rust\"></a>安装Rust</h3><blockquote>\n<p>Rust在Mac系统上非常的友好</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl https://sh.rustup.rs -sSf | sh</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>脚本会检测你的操作系统，然后提示你是否安装</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211124031930.png\"></p>\n<ul>\n<li>默认选择1就好了</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211124032020.png\"></p>\n<ul>\n<li>这样就安装好了</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">source</span> <span class=\"variable\">$HOME</span>/.cargo/env</span><br><span class=\"line\"><span class=\"comment\"># 设置下Rust的环境变量</span></span><br><span class=\"line\">rustc --version </span><br><span class=\"line\"><span class=\"comment\"># 如果正常显示版本说明安装成功了</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建测试项目\"><a href=\"#创建测试项目\" class=\"headerlink\" title=\"创建测试项目\"></a>创建测试项目</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">mkdir learning</span><br><span class=\"line\"><span class=\"built_in\">cd</span> learning</span><br><span class=\"line\">cargo new learning-01</span><br><span class=\"line\"><span class=\"built_in\">cd</span> learning-01</span><br><span class=\"line\">cargo run</span><br><span class=\"line\"></span><br><span class=\"line\">Hello, world!</span><br><span class=\"line\"><span class=\"comment\"># 如果变成成功并输出消息则表示测试项目通过了。</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Rust\"><a href=\"#Rust\" class=\"headerlink\" title=\"Rust\"></a>Rust</h2><blockquote>\n<p>Rust 是一个系统级编程语言，被 Mozilla 员工 “Graydon Hoare” 于 2006 年 开发。他形容 Rust 是一种线程安全的支持并发的实用型的编程语言，支持函数式编程与命令式编程。</p>\n</blockquote>\n<h3 id=\"Cargo\"><a href=\"#Cargo\" class=\"headerlink\" title=\"Cargo\"></a>Cargo</h3><blockquote>\n<p>Cargo是Rust的构建系统和包管理工具，和Java中maven类似的功能。</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">// 查看版本</span><br><span class=\"line\">cargo --version</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>创建一个项目</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">cargo new new_project</span><br><span class=\"line\"><span class=\"built_in\">cd</span> new _project</span><br><span class=\"line\">➜  new_project git:(master) ✗ tree </span><br><span class=\"line\">.</span><br><span class=\"line\">├── Cargo.toml</span><br><span class=\"line\">└── src</span><br><span class=\"line\">    └── main.rs</span><br><span class=\"line\"></span><br><span class=\"line\">1 directory, 2 files</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>这里的Cargo.toml就是配置文件 <a href=\"https://github.com/toml-lang/toml\" target=\"_blank\" rel=\"noopener\"><em>TOML</em></a> (<em>Tom’s Obvious, Minimal Language</em>) 格式，这是 Cargo 配置文件的格式。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[package]</span><br><span class=\"line\">name &#x3D; &quot;new_project&quot;</span><br><span class=\"line\">version &#x3D; &quot;0.1.0&quot;</span><br><span class=\"line\">edition &#x3D; &quot;2021&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># See more keys and their definitions at https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;reference&#x2F;manifest.html</span><br><span class=\"line\"></span><br><span class=\"line\">[dependencies]</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>构建并运行</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">cargo build</span><br><span class=\"line\">➜  new_project git:(master) ✗ cargo build</span><br><span class=\"line\">   Compiling new_project v0.1.0 (/Users/z201/word/rust/learning-rust/new_project)</span><br><span class=\"line\">    Building [                             ] 0/1: new_project(bin)                                                                                                                                                                </span><br><span class=\"line\">    Finished dev [unoptimized + debuginfo] target(s) in 11.12s</span><br><span class=\"line\">    </span><br><span class=\"line\">➜  new_project git:(master) ✗ ./target/debug/new_project </span><br><span class=\"line\">Hello, world!</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>也可以直接编译加运行</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">cargo run</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>快速检查是否可以编译</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">cargo check</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用VS-Code作为开发工具\"><a href=\"#使用VS-Code作为开发工具\" class=\"headerlink\" title=\"使用VS Code作为开发工具\"></a>使用VS Code作为开发工具</h2><blockquote>\n<p>这里主要安装一些社区推荐的插件</p>\n</blockquote>\n<ol>\n<li>rust-analyzer：它会实时编译和分析你的 Rust 代码，提示代码中的错误，并对类型进行标注。你也可以使用官方的 rust 插件取代。</li>\n<li>rust syntax：为代码提供语法高亮。</li>\n<li>crates：帮助你分析当前项目的依赖是否是最新的版本。</li>\n<li>better toml：Rust 使用 toml 做项目的配置管理。可以帮你语法高亮，并展示 toml 文件中的错误。</li>\n<li>rust test lens：可以帮你快速运行某个 Rust 测试。</li>\n<li>Tabnine：基于 AI 的自动补全，可以帮助你更快地撰写代码。</li>\n</ol>\n<h3 id=\"使用国内的Rust镜像\"><a href=\"#使用国内的Rust镜像\" class=\"headerlink\" title=\"使用国内的Rust镜像\"></a>使用国内的Rust镜像</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 切换到cargo</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ~/.cargo/.</span><br><span class=\"line\"><span class=\"comment\"># 创建一个config文件</span></span><br><span class=\"line\">➜  .cargo touch config</span><br><span class=\"line\">➜  .cargo vim config </span><br><span class=\"line\">➜  .cargo chmod u+x config</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>往config写入内容</li>\n</ul>\n<figure class=\"highlight rust\"><table><tr><td class=\"code\"><pre><span class=\"line\">[source.crates-io]</span><br><span class=\"line\">registry = <span class=\"string\">\"https://github.com/rust-lang/crates.io-index\"</span></span><br><span class=\"line\"># 根据情况来切换</span><br><span class=\"line\">replace-with = <span class=\"symbol\">'ustc</span>'</span><br><span class=\"line\"># 清华大学</span><br><span class=\"line\">[source.tuna]</span><br><span class=\"line\">registry = <span class=\"string\">\"https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"># 中国科学技术大学</span><br><span class=\"line\">[source.ustc]</span><br><span class=\"line\">registry = <span class=\"string\">\"git://mirrors.ustc.edu.cn/crates.io-index\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"># 上海交通大学</span><br><span class=\"line\">[source.sjtu]</span><br><span class=\"line\">registry = <span class=\"string\">\"https://mirrors.sjtug.sjtu.edu.cn/git/crates.io-index\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"># rustcc社区</span><br><span class=\"line\">[source.rustcc]</span><br><span class=\"line\">registry = <span class=\"string\">\"git://crates.rustcc.cn/crates.io-index\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"># 字节跳动</span><br><span class=\"line\">[source.rsproxy]</span><br><span class=\"line\">registry = <span class=\"string\">\"https://rsproxy.cn/crates.io-index\"</span></span><br></pre></td></tr></table></figure>\n\n","categories":["Rust"],"tags":["Rust"]},{"title":"Permission-Design","url":"/posts/1449986837/","content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><blockquote>\n<p>权限管理是一个几乎所有大中型 B 端系统都会涉及的重要组成部分，其目的是对整个系统进行权限控制，避免造成误操作及数据泄露等风险问题。</p>\n</blockquote>\n<h2 id=\"权限与权限管理\"><a href=\"#权限与权限管理\" class=\"headerlink\" title=\"权限与权限管理\"></a>权限与权限管理</h2><h3 id=\"名词定义\"><a href=\"#名词定义\" class=\"headerlink\" title=\"名词定义\"></a>名词定义</h3><blockquote>\n<p>权限相关的基本概念：</p>\n</blockquote>\n<ul>\n<li>权限：用户可操作行为的最小单位。</li>\n<li>用户：每个用户都有唯一标识，并被授予一个或多个角色。</li>\n<li>角色：由不同的权限组合而成，最终分配给具体用户。</li>\n<li>权限管理：控制用户的权限，只能访问授权内容。</li>\n</ul>\n<h3 id=\"模型选择\"><a href=\"#模型选择\" class=\"headerlink\" title=\"模型选择\"></a>模型选择</h3><ul>\n<li>ACL（Access Control List）：基于用户级别的权限控制。<ul>\n<li>将系统的各种权限直接授予具体的用户。抽象来说，为每个用户维护了单独的权限列表，当需要分配权限、收回权限时，需要修改对应用户的权限信息。</li>\n</ul>\n</li>\n<li>RBAC（Role Base Access Control）：基于角色级别的权限控制。<ul>\n<li>与 ACL 对比，RBAC不用给用户单个分配权限，权限与用户之前通过角色关联。通过给不同的角色分配不同的权限，只需要将用户指向对应的角色就会有对应的权限。分配权限、收回权限只需要通过修改用户的角色即可。</li>\n</ul>\n</li>\n<li>ABAC（Attribute Base Access Control）：基于属性级别的权限控制。<ul>\n<li>不同于常见的将用户通过某种方式直接关联到权限的方式，ABAC 是通过动态计算一个或一组属性来是否满足某种条件来进行权限判断。属性一般分为四类：用户属性（自然人属性，如年龄、性别等），环境属性（物理环境，如时间、地点、气候），操作属性（读、写）和对象属性（操作对象，如资金、某张图片、某个特定的页面，又称资源属性）。</li>\n</ul>\n</li>\n<li>因此理论上能够实现灵活的权限控制、将在权限与用户之前通过一组或多组属性实现关联，几乎能满足所有类型的需求。</li>\n</ul>\n<h3 id=\"权限管控\"><a href=\"#权限管控\" class=\"headerlink\" title=\"权限管控\"></a>权限管控</h3><blockquote>\n<p>抽象来看权限体系可以分为如下两类：功能权限 与 数据权限 两部分。</p>\n</blockquote>\n<ul>\n<li>功能权限指的是在系统中的功能可否使用，通常我们将功能权限分为查看、编辑、删除等，同时编辑、删除权限又包含了查看。通过小的权限点拆分更精细的赋予了员工能否进入某个页面查看信息、编辑信息的能力。</li>\n<li>数据权限指数据中存在的数据是否能查看，是一个更细粒度的权限。比如一个页面，不同角色查看不同的数据就需要通过数据权限控制。<br>从管理对象维度又可以分为：企业能力 与 员工能力。</li>\n<li>企业能力店铺维度的权限，比如开通某服务，可以通过企业能力去体现。</li>\n<li>企业能力赋予用户的权限，比如收电子发票、资金管理等。</li>\n<li>企业能力优先级绝对高于员工能力，所有场景的权限判断，店铺能力必须先于员工能力。简单地说，企业能力决定了“企业能做什么”，员工能力决定了“用户能做什么”。</li>\n</ul>\n","categories":["系统设计"],"tags":["系统设计","权限设计"]},{"title":"Jvm-optimization","url":"/posts/3325845222/","content":"<blockquote>\n<p>jvm调优是日常工作中经常会使用的技巧，整理下。</p>\n</blockquote>\n<h3 id=\"项目启动的时候加上的参数都是些啥意思？\"><a href=\"#项目启动的时候加上的参数都是些啥意思？\" class=\"headerlink\" title=\"项目启动的时候加上的参数都是些啥意思？\"></a>项目启动的时候加上的参数都是些啥意思？</h3><blockquote>\n<p>刚开始工作的时候发现同事会在jar启动的命令上增加很多参数,很长一段时间都不清楚是干啥的。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">-XX:MetaspaceSize=<span class=\"number\">128</span>m -XX:MaxMetaspaceSize=<span class=\"number\">128</span>m -Xms1024m -Xmx1024m -Xmn256m -Xss256k -XX:SurvivorRatio=<span class=\"number\">8</span> -XX:+UseConcMarkSweepGC</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>简单介绍下参数</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">-XX:MetaspaceSize=128m （元空间默认大小）</span><br><span class=\"line\">-XX:MaxMetaspaceSize=128m （元空间最大大小）</span><br><span class=\"line\">-Xms1024m （堆最大大小）</span><br><span class=\"line\">-Xmx1024m （堆默认大小）</span><br><span class=\"line\">-Xmn256m （新生代大小）</span><br><span class=\"line\">-Xss256k （棧最大深度大小）</span><br><span class=\"line\">-XX:SurvivorRatio=8 （新生代分区比例 8:2）</span><br><span class=\"line\">-XX:+UseConcMarkSweepGC （指定使用的垃圾收集器，这里使用CMS收集器）</span><br><span class=\"line\">-XX:+PrintGCDetails （打印详细的GC日志）</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>虽然有了介绍但是依然不清楚具体是干啥的。并且Java虚拟机提供了非常多的参数命令。下面代码可以输出支持的参数数量</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">java -XX:+PrintFlagsFinal -XX:+UnlockDiagnosticVMOptions -version | wc -l</span><br><span class=\"line\">openjdk version <span class=\"string\">\"1.8.0_275\"</span></span><br><span class=\"line\"><span class=\"function\">OpenJDK Runtime <span class=\"title\">Environment</span> <span class=\"params\">(AdoptOpenJDK)</span><span class=\"params\">(build <span class=\"number\">1.8</span><span class=\"number\">.0</span>_275-b01)</span></span></span><br><span class=\"line\"><span class=\"function\">OpenJDK 64-Bit Server <span class=\"title\">VM</span> <span class=\"params\">(AdoptOpenJDK)</span><span class=\"params\">(build <span class=\"number\">25.275</span>-b01, mixed mode)</span></span></span><br><span class=\"line\"><span class=\"function\">     838</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>堆内存大小配置</li>\n</ul>\n<blockquote>\n<p>建议 -Xms = 最大内存 * [0.6. ~0.8] 这里需要考虑系统损耗内存、和实际物理内存。</p>\n</blockquote>\n<ul>\n<li><p>堆内存与堆外内存</p>\n<ul>\n<li>堆内存</li>\n</ul>\n<blockquote>\n<p>必须是1024的倍数，且不能低于2M。</p>\n<p>32位机器，最大1G/4G 64位机器最大可以超过 32G/64G</p>\n</blockquote>\n<ul>\n<li>堆外内存</li>\n</ul>\n<blockquote>\n<p>堆外内存一般指 Direct Memory ，不受GC控制，JVM、Netty都可能使用堆外内存。</p>\n</blockquote>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">-XX:MaxDirectMemorySize 限制</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"如何理解这些参数的含义？\"><a href=\"#如何理解这些参数的含义？\" class=\"headerlink\" title=\"如何理解这些参数的含义？\"></a>如何理解这些参数的含义？</h3><blockquote>\n<p>首先我们需要理解java是如何运行的，为什么需要java虚拟机？    </p>\n<p>我们常用方式一般是安装java运行环境(jre)用命令行的方式启动或者直接双击jar运行。jre包含的java运行的必要环境。</p>\n<p>Java 作为一门高级程序语言，它的语法非常复杂，抽象程度也很高。编译出来的也不是机器可以直接直接运行代码。所以使用面向Java语言的虚拟机运行Java编译以后的特定代码。这里的特定代码指的是Java字节指令码。</p>\n</blockquote>\n<h3 id=\"JVM-内存分配性能问题\"><a href=\"#JVM-内存分配性能问题\" class=\"headerlink\" title=\"JVM 内存分配性能问题\"></a>JVM 内存分配性能问题</h3><ul>\n<li>在应用服务的特定场景下，JVM 内存分配不合理带来的性能表现并不会像内存溢出问题这么突出。如果没有深入到各项性能指标中去，是很难发现其中隐藏的性能损耗。</li>\n<li>JVM 内存分配不合理最直接的表现就是频繁的 GC，这会导致上下文切换等性能问题，从而降低系统的吞吐量、增加系统的响应时间。</li>\n</ul>\n<h3 id=\"分析-GC-日志\"><a href=\"#分析-GC-日志\" class=\"headerlink\" title=\"分析 GC 日志\"></a>分析 GC 日志</h3><ul>\n<li>在进行压测的时候，我们需要对GC日志进行分析。</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">-XX:+PrintGCTimeStamps -XX:+PrintGCDetails -Xloggc:/log/heap.log</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>-XX:PrintGCTimeStamps：打印 GC 具体时间；</li>\n<li>-XX:PrintGCDetails ：打印出 GC 详细日志；</li>\n<li>-Xloggc: path：GC 日志生成路径。</li>\n<li>JVM 内存调优通常和 GC 调优是互补的，基于以上调优，可以对年轻代和堆内存的垃圾回收算法进行调优。</li>\n</ul>\n<a id=\"more\"></a>\n\n\n\n\n\n","categories":["Jvm"],"tags":["Jvm"]},{"title":"SpringBoot-Redis-Bloom","url":"/posts/539938723/","content":"<blockquote>\n<p>Redis 中不能直接使用布隆过滤器，Redis 4.0 版本之后提供的 modules（扩展模块）</p>\n</blockquote>\n<h3 id=\"布隆过滤器的原理\"><a href=\"#布隆过滤器的原理\" class=\"headerlink\" title=\"布隆过滤器的原理\"></a>布隆过滤器的原理</h3><ul>\n<li>数据结构使用一位的数组，每次存储键值的时候，不是直接把数据存储在数据结构中。而是经过hash运算。将此元素的 hash 值均匀的存储在位数组中。把这些位置设置成 1 就完成了添加操作。</li>\n<li>判断元素是否存在时，经过运算判断对应的位置是否为全部1即可。因此<strong>布隆过滤器查询此值存在时，此值不一定存在，但查询此值不存在时，此值一定不存在</strong>。</li>\n<li>但是存在一定的误差，并且当位数组存储值比较稀疏的时候，查询的准确率越高，而当位数组存储的值越来越多时，误差也会增大。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220110225523.png\"></p>\n<ul>\n<li>空间占用<ul>\n<li>布隆过滤器有两个参数，第一个是预计元素的数量n，第二个是误判率p。公式根据这两个输入得到两个输出，第一个输出是位数组的长度m，也就是需要的存储空间大小(bit)，第二个输出是hash函数的最佳数量k。hash函数的数量也会直接影响到误判率，最佳的数量会有最低的误判率。</li>\n</ul>\n</li>\n<li>计算公式</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">k≈0.7*(m&#x2F;n)    </span><br><span class=\"line\">p≈0.6185^(m&#x2F;n)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>位数组m越长，误判率p就越低；</li>\n<li>位数组m越长，hash函数最佳数量k就越多，影响计算效率；</li>\n</ul>\n<h3 id=\"演示代码\"><a href=\"#演示代码\" class=\"headerlink\" title=\"演示代码\"></a><a href=\"https://github.com/z201/code-example/tree/main/SpringBoot-Redis-Bloom\" target=\"_blank\" rel=\"noopener\">演示代码</a></h3><h3 id=\"安装Redis\"><a href=\"#安装Redis\" class=\"headerlink\" title=\"安装Redis\"></a>安装Redis</h3><blockquote>\n<p>演示情况直接使用docker来安装，免去下载编译过程。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run -p 6379:6379 -d redislabs/rebloom:latest</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用redis-cli或者客户端工具进入</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">➜  docker-run redis-cli </span><br><span class=\"line\">127.0.0.1:6379&gt; bf.add 1 1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br><span class=\"line\">127.0.0.1:6379&gt; bf.add 1 2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>如果没有提示错误则表示安装成功。</li>\n</ul>\n<h3 id=\"Bloom基础用法\"><a href=\"#Bloom基础用法\" class=\"headerlink\" title=\"Bloom基础用法\"></a>Bloom基础用法</h3><p>布隆过滤器的命令不是很多，主要包含以下几个</p>\n<ul>\n<li>bf.add：添加元素</li>\n<li>bf.exists：判断某个元素是否存在</li>\n<li>bf.madd：添加多个元素</li>\n<li>bf.mexists：判断多个元素是否存在</li>\n<li>bf.reserve：<strong>设置布隆过滤器的准确率</strong> 只能在未设置数据的时候设置，否则会报错</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; bf.exists 1 1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; bf.exists 1 2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; bf.reserve 1 0.01 100 <span class=\"comment\"># 已经存在集合在设置会报错</span></span><br><span class=\"line\">(error) ERR item exists</span><br><span class=\"line\">127.0.0.1:6379&gt; bf.reserve user 0.01 100 <span class=\"comment\"># 未设置数据的则可以正常设置。</span></span><br><span class=\"line\">OK</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"SprngBoot演示\"><a href=\"#SprngBoot演示\" class=\"headerlink\" title=\"SprngBoot演示\"></a>SprngBoot演示</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BloomTool</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 初始化</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> rate 准确度</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> size 大小</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">init</span><span class=\"params\">(String key, String rate, String size)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            String script = <span class=\"string\">\"return redis.call('bf.reserve', KEYS[1], ARGV[1], ARGV[2])\"</span>;</span><br><span class=\"line\">            DefaultRedisScript&lt;String&gt; defaultRedisScript = <span class=\"keyword\">new</span> DefaultRedisScript&lt;String&gt;();</span><br><span class=\"line\">            defaultRedisScript.setResultType(String<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">            defaultRedisScript.setScriptSource(<span class=\"keyword\">new</span> StaticScriptSource(script));</span><br><span class=\"line\">            String[] argv = <span class=\"keyword\">new</span> String[]&#123;rate,size&#125;;</span><br><span class=\"line\">            String result = (String) redisTemplate.execute(defaultRedisScript, Collections.singletonList(key), argv);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Objects.equals(result, <span class=\"string\">\"OK\"</span>)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (RedisSystemException redisSystemException)&#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">\"&#123;&#125;\"</span>,redisSystemException.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 添加元素</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">add</span><span class=\"params\">(String key, String value)</span> </span>&#123;</span><br><span class=\"line\">        String script = <span class=\"string\">\"return redis.call('bf.add', KEYS[1], ARGV[1])\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> lua(script, key, value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 是否存在</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">exists</span><span class=\"params\">(String key, Object value)</span> </span>&#123;</span><br><span class=\"line\">        String script = <span class=\"string\">\"return redis.call('bf.exists', KEYS[1], ARGV[1])\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> lua(script, key, value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Boolean <span class=\"title\">lua</span><span class=\"params\">(String script, String key, Object value)</span> </span>&#123;</span><br><span class=\"line\">        DefaultRedisScript&lt;Long&gt; defaultRedisScript = <span class=\"keyword\">new</span> DefaultRedisScript&lt;Long&gt;();</span><br><span class=\"line\">        defaultRedisScript.setResultType(Long<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">        defaultRedisScript.setScriptSource(<span class=\"keyword\">new</span> StaticScriptSource(script));</span><br><span class=\"line\">        Long result = (Long) redisTemplate.execute(defaultRedisScript, Collections.singletonList(key), value);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Objects.equals(result, <span class=\"number\">1L</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>单元测试</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.redis;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"meta\">@ExtendWith</span>(SpringExtension<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\">@<span class=\"title\">SpringBootTest</span>(<span class=\"title\">classes</span> </span>= AppApplication<span class=\"class\">.<span class=\"keyword\">class</span>, <span class=\"title\">webEnvironment</span> </span>= SpringBootTest.WebEnvironment.RANDOM_PORT)</span><br><span class=\"line\"><span class=\"meta\">@AutoConfigureMockMvc</span></span><br><span class=\"line\"><span class=\"comment\">// 指定单元测试方法顺序</span></span><br><span class=\"line\"><span class=\"meta\">@TestMethodOrder</span>(MethodOrderer.OrderAnnotation<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">public</span> <span class=\"title\">class</span> <span class=\"title\">AppApplicationTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    BloomTool bloomTool;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"meta\">@Disabled</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testBloom</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        Set&lt;String&gt; keys =  redisTemplate.keys(<span class=\"string\">\"*\"</span>);</span><br><span class=\"line\">        log.info(<span class=\"string\">\"&#123;&#125;\"</span>,keys);</span><br><span class=\"line\">        redisTemplate.delete(keys);</span><br><span class=\"line\">        String key = <span class=\"string\">\"u\"</span>;</span><br><span class=\"line\">        log.info(<span class=\"string\">\"init 异常或者错误都会报错 &#123;&#125;\"</span>, bloomTool.init(key, <span class=\"string\">\"0.001\"</span>, <span class=\"string\">\"10000000\"</span>));</span><br><span class=\"line\">        List&lt;String&gt; values = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">100</span>; i++) &#123;</span><br><span class=\"line\">            Integer value = RandomUtil.randomInt(<span class=\"number\">1000</span>, <span class=\"number\">20000000</span>);</span><br><span class=\"line\">            values.add(value.toString());</span><br><span class=\"line\">            Boolean result =  bloomTool.add(key, value.toString());</span><br><span class=\"line\">            log.info(<span class=\"string\">\"bf.add &#123;&#125; &#123;&#125; &#123;&#125; \"</span>, result, key, value);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Integer index = RandomUtil.randomInt(<span class=\"number\">0</span>, values.size());</span><br><span class=\"line\">        String value = values.get(index);</span><br><span class=\"line\">        Boolean result = bloomTool.exists(key, value);</span><br><span class=\"line\">        log.info(<span class=\"string\">\"bf.exists &#123;&#125; &#123;&#125; &#123;&#125; \"</span>, result, key, value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[main]  [u]</span><br><span class=\"line\">[main]  init 异常或者错误都会报错 <span class=\"literal\">true</span></span><br><span class=\"line\">[main]  bf.add <span class=\"literal\">true</span> u 11569209 </span><br><span class=\"line\">[main]  bf.add <span class=\"literal\">true</span> u 12786658 </span><br><span class=\"line\">[main]  bf.add <span class=\"literal\">true</span> u 16272560 </span><br><span class=\"line\">[main]  bf.add <span class=\"literal\">true</span> u 1212058 </span><br><span class=\"line\">[main]  bf.add <span class=\"literal\">true</span> u 4896410 </span><br><span class=\"line\">[main]  bf.add <span class=\"literal\">true</span> u 15218411 </span><br><span class=\"line\">[main]  bf.add <span class=\"literal\">true</span> u 13349975 </span><br><span class=\"line\">[main]  bf.add <span class=\"literal\">true</span> u 12544373 </span><br><span class=\"line\">[main]  bf.add <span class=\"literal\">true</span> u 4507958 </span><br><span class=\"line\">[main]  bf.add <span class=\"literal\">true</span> u 12143750 </span><br><span class=\"line\">[main]  bf.exists <span class=\"literal\">true</span> u 1212058</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["Spring"],"tags":["Redis","Spring","Bloom"]},{"title":"Centos7-jenkins-Deploy","url":"/posts/1108772964/","content":"<blockquote>\n<p>记录最近在Centos7上面部署jenkens。安装的方法有很多，下面采用最简单的方式安装。</p>\n</blockquote>\n<h2 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h2><ul>\n<li>在线文档 <a href=\"https://jenkins.io/doc/\" target=\"_blank\" rel=\"noopener\">https://jenkins.io/doc/</a></li>\n<li>名词解释：<ul>\n<li>CI</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>jenkins 是一个协调者的身份，管理和协调了代码库，代码仓库，代码运行环境等。</p>\n</blockquote>\n<h2 id=\"jenkins-简介\"><a href=\"#jenkins-简介\" class=\"headerlink\" title=\"jenkins 简介\"></a>jenkins 简介</h2><blockquote>\n<p>Jenkins是一个开源软件项目，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能。持续集成（CI）已成为当前许多软件开发团队在整个软件开发生命周期内侧重于保证代码质量的常见做法。它是一种实践，旨在缓和和稳固软件的构建过程。并且能够帮助您的开发团队应对如下挑战：</p>\n</blockquote>\n<ul>\n<li>持续、自动地构建/测试软件项目。</li>\n<li>监控一些定时执行的任务。</li>\n<li>高度可扩展性、全球大量团队使用，并共享代码。</li>\n<li>基于插件、可以做出非常多有趣的事情。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/jenkins/2.jpg\"> </p>\n<h2 id=\"安裝部署\"><a href=\"#安裝部署\" class=\"headerlink\" title=\"安裝部署\"></a>安裝部署</h2><a id=\"more\"></a>\n\n<blockquote>\n<p>单实例部署</p>\n</blockquote>\n<h3 id=\"检查当前系统环境\"><a href=\"#检查当前系统环境\" class=\"headerlink\" title=\"检查当前系统环境\"></a>检查当前系统环境</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost jenkins]<span class=\"comment\"># cat /etc/os-release </span></span><br><span class=\"line\">NAME=<span class=\"string\">\"CentOS Linux\"</span></span><br><span class=\"line\">VERSION=<span class=\"string\">\"7 (Core)\"</span></span><br><span class=\"line\">ID=<span class=\"string\">\"centos\"</span></span><br><span class=\"line\">ID_LIKE=<span class=\"string\">\"rhel fedora\"</span></span><br><span class=\"line\">VERSION_ID=<span class=\"string\">\"7\"</span></span><br><span class=\"line\">PRETTY_NAME=<span class=\"string\">\"CentOS Linux 7 (Core)\"</span></span><br><span class=\"line\">ANSI_COLOR=<span class=\"string\">\"0;31\"</span></span><br><span class=\"line\">CPE_NAME=<span class=\"string\">\"cpe:/o:centos:centos:7\"</span></span><br><span class=\"line\">HOME_URL=<span class=\"string\">\"https://www.centos.org/\"</span></span><br><span class=\"line\">BUG_REPORT_URL=<span class=\"string\">\"https://bugs.centos.org/\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">CENTOS_MANTISBT_PROJECT=<span class=\"string\">\"CentOS-7\"</span></span><br><span class=\"line\">CENTOS_MANTISBT_PROJECT_VERSION=<span class=\"string\">\"7\"</span></span><br><span class=\"line\">REDHAT_SUPPORT_PRODUCT=<span class=\"string\">\"centos\"</span></span><br><span class=\"line\">REDHAT_SUPPORT_PRODUCT_VERSION=<span class=\"string\">\"7\"</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"添加源以及公钥\"><a href=\"#添加源以及公钥\" class=\"headerlink\" title=\"添加源以及公钥\"></a>添加源以及公钥</h3><h4 id=\"更新安装jenkens源\"><a href=\"#更新安装jenkens源\" class=\"headerlink\" title=\"更新安装jenkens源\"></a>更新安装jenkens源</h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># yum 源导入</span></span><br><span class=\"line\">sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#导入密钥</span></span><br><span class=\"line\">sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#安装</span></span><br><span class=\"line\">sudo yum install jenkins</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 手动下载安装包安装</span></span><br><span class=\"line\">https://pkg.jenkins.io/redhat-stable/ <span class=\"comment\"># 这里面找</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#检查安装</span></span><br><span class=\"line\">whereis jenkins</span><br><span class=\"line\">&gt; jenkins: /usr/lib/jenkins</span><br><span class=\"line\"><span class=\"comment\"># 提示以上内容说明安装成功</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修改jenkens配置信息\"><a href=\"#修改jenkens配置信息\" class=\"headerlink\" title=\"修改jenkens配置信息\"></a>修改jenkens配置信息</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 编辑jenkins配置文件</span></span><br><span class=\"line\">vim /etc/sysconfig/jenkins</span><br><span class=\"line\"><span class=\"comment\"># 这里主要编辑两个参数 JENKINS_USER JENKINS_JAVA_OPTIONS</span></span><br><span class=\"line\"><span class=\"comment\"># JENKINS_USER jenkens权限用户</span></span><br><span class=\"line\"><span class=\"comment\"># JENKINS_JAVA_OPTIONS jenkens启动参数，这里主要设置启动内存。</span></span><br><span class=\"line\">JENKINS_USER=<span class=\"string\">\"root\"</span></span><br><span class=\"line\">JENKINS_JAVA_OPTIONS=<span class=\"string\">\"-server -Xms512m -Xmx1024m -XX:PermSize=256m -XX:MaxPermSize=512m  -Djava.awt.headless=true\"</span></span><br><span class=\"line\"><span class=\"comment\"># 修改目录权限 如果你不是使用root账号,我偷下懒。</span></span><br><span class=\"line\">chown -R root:root /var/lib/jenkins</span><br><span class=\"line\">chown -R root:root /var/cache/jenkins</span><br><span class=\"line\">chown -R root:root /var/<span class=\"built_in\">log</span>/jenkins</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动junkets检查\"><a href=\"#启动junkets检查\" class=\"headerlink\" title=\"启动junkets检查\"></a>启动junkets检查</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#重载所有修改过的配置文件</span></span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#启动Jenkins服务</span></span><br><span class=\"line\">sudo systemctl start jenkins</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#由于Jenkins不是Native Service，所以需要用chkconfig命令而不是systemctl命令</span></span><br><span class=\"line\">sudo /sbin/chkconfig jenkins on</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"第一次启动配置\"><a href=\"#第一次启动配置\" class=\"headerlink\" title=\"第一次启动配置\"></a>第一次启动配置</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看密码</span></span><br><span class=\"line\">cat /var/lib/jenkins/secrets/initialAdminPassword</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置jenkens-jdk-maven环境\"><a href=\"#配置jenkens-jdk-maven环境\" class=\"headerlink\" title=\"配置jenkens jdk maven环境\"></a>配置jenkens jdk maven环境</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 在系统环境中增加</span></span><br><span class=\"line\"><span class=\"comment\"># JAVA_HOME</span></span><br><span class=\"line\"><span class=\"comment\"># MAVEN_HOME </span></span><br><span class=\"line\"><span class=\"comment\"># 如果jdk是通过yum 安装需要通过ll找到jvm的安装地址</span></span><br><span class=\"line\"><span class=\"comment\"># ll /usr/bin/javac -&gt; /etc/alternatives/javac</span></span><br><span class=\"line\"><span class=\"comment\"># ll /etc/alternatives/javac -&gt; /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64/bin/javac</span></span><br><span class=\"line\"><span class=\"comment\">#举例子</span></span><br><span class=\"line\">JAVA_HOME</span><br><span class=\"line\">/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64</span><br><span class=\"line\">MAVEN_HOME</span><br><span class=\"line\">/opt/libhome/apache-maven-3.8.1</span><br><span class=\"line\">PATH</span><br><span class=\"line\"><span class=\"variable\">$PATH</span>:<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$MAVEN_HOME</span>/bin</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置企业微信通知\"><a href=\"#配置企业微信通知\" class=\"headerlink\" title=\"配置企业微信通知\"></a>配置企业微信通知</h2><blockquote>\n<p>安装插件 <a href=\"https://plugins.jenkins.io/qy-wechat-notification\" target=\"_blank\" rel=\"noopener\">Qy Wechat Notification Plugin</a></p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">如果无法发送通知提示javax.net.ssl.SSLHandshakeException: No appropriate protocol (protocol is disabled or cipher suites are inappropriate</span><br><span class=\"line\">需要修改$JRE&#x2F;lib&#x2F;security&#x2F;java.security</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>去掉两个配置信息 <code>TLSv1 TLSv1.1</code></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">jdk.tls.disabledAlgorithms&#x3D;SSLv3, TLSv1, RC4, DES, MD5withRSA, DH keySize &lt; 1024, \\</span><br><span class=\"line\">EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"友情提示\"><a href=\"#友情提示\" class=\"headerlink\" title=\"友情提示\"></a>友情提示</h4><blockquote>\n<p>不要选择社区推荐插件安装</p>\n</blockquote>\n<ul>\n<li><p>因为 <code>Jenkins</code> 插件服务器在国外，所以速度不太理想。我们需要更换为清华大学的 <code>Jenkins</code> 插件源后，再安装插件，<strong>所以先不要点安装插件。</strong></p>\n</li>\n<li><p>更换方法很简单。进入服务器，将 <code>/var/lib/jenkins/updates/default.json</code> 内的插件源地址替换成清华大学的源地址，将 google 替换为 baidu 即可。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">sed -i 's/http:\\/\\/updates.jenkins-ci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g' /var/lib/jenkins/updates/default.json &amp;&amp; sed -i 's/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g' /var/lib/jenkins/updates/default.json</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h2 id=\"修改运行端口\"><a href=\"#修改运行端口\" class=\"headerlink\" title=\"修改运行端口\"></a>修改运行端口</h2><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/sysconfig/jenkins</span><br><span class=\"line\"></span><br><span class=\"line\">JENKINS_PORT=<span class=\"string\">\"8080\"</span> //改成 JENKINS_PORT=<span class=\"string\">\"8088\"</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"基础命令\"><a href=\"#基础命令\" class=\"headerlink\" title=\"基础命令\"></a>基础命令</h2><ul>\n<li>启动、重启、关闭</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost jenkins]<span class=\"comment\">#  service jenkins start</span></span><br><span class=\"line\">[root@localhost jenkins]<span class=\"comment\">#  service jenkins restart</span></span><br><span class=\"line\">[root@localhost jenkins]<span class=\"comment\">#  service jenkins shutdown</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>错误提示</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">Starting jenkins (via systemctl):  Warning: jenkins.service changed on disk. Run <span class=\"string\">'systemctl daemon-reload'</span> to reload units.</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>若出现上述问题，执行。</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost jenkins]<span class=\"comment\"># systemctl daemon-reload</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>启动jenkins</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost jenkins]<span class=\"comment\"># sudo service jenkins start</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>进入jenkins 网站；一般是8080端口。界面会让你输入密码进入。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost jenkins]# cat &#x2F;var&#x2F;lib&#x2F;jenkins&#x2F;secrets&#x2F;initialAdminPassword</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>安装插件,如果出现下列错误。</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">An error occurred during installation: No such plugin: cloudbees-folder</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>可以直接跳过。直接创建管理帐号进入。这个时候插件列表是空的。在插件高中替换URL。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">http:&#x2F;&#x2F;mirror.xmission.com&#x2F;jenkins&#x2F;updates&#x2F;update-center.json</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>end.</li>\n</ul>\n<h2 id=\"修改Jenkins-工作空間目錄\"><a href=\"#修改Jenkins-工作空間目錄\" class=\"headerlink\" title=\"修改Jenkins 工作空間目錄\"></a>修改Jenkins 工作空間目錄</h2><ul>\n<li>系统设置</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/jenkins/3.png\"></p>\n<ul>\n<li>这里的工作空间目录有一个环境配置变量。${JENKINS_HOME}</li>\n<li>在系统环境变量中配置JENKINS_HOME 指向新的工作空间。</li>\n</ul>\n<h2 id=\"Jenkins-shell权限问题。\"><a href=\"#Jenkins-shell权限问题。\" class=\"headerlink\" title=\"Jenkins shell权限问题。\"></a>Jenkins shell权限问题。</h2><ul>\n<li>在执行shell 脚本的时候需要修改权限，如果不修改会导致部分权限问题。</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost jenkins]<span class=\"comment\"># vim /etc/sysconfig/jenkins</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改配置文件的 JENKINS_USER = “root”</li>\n</ul>\n<h2 id=\"插件\"><a href=\"#插件\" class=\"headerlink\" title=\"插件\"></a>插件</h2><h3 id=\"Maven-Integration-plugin\"><a href=\"#Maven-Integration-plugin\" class=\"headerlink\" title=\"Maven Integration plugin\"></a>Maven Integration plugin</h3><blockquote>\n<p>用于Maven项目构建。</p>\n</blockquote>\n<h3 id=\"Monitoring\"><a href=\"#Monitoring\" class=\"headerlink\" title=\"Monitoring\"></a>Monitoring</h3><blockquote>\n<p>监控Jenkins所消耗的系统资源，如内存使用等</p>\n</blockquote>\n<h3 id=\"Publish-Over-SSH\"><a href=\"#Publish-Over-SSH\" class=\"headerlink\" title=\"Publish Over SSH\"></a>Publish Over SSH</h3><blockquote>\n<p>远程Shell</p>\n</blockquote>\n<h3 id=\"Email-Extersion-Plugin\"><a href=\"#Email-Extersion-Plugin\" class=\"headerlink\" title=\"Email Extersion Plugin\"></a><a href=\"https://wiki.jenkins-ci.org/display/JENKINS/Email-ext+plugin\" target=\"_blank\" rel=\"noopener\">Email Extersion Plugin</a></h3><blockquote>\n<p>邮件通知</p>\n</blockquote>\n<h4 id=\"邮箱配置\"><a href=\"#邮箱配置\" class=\"headerlink\" title=\"邮箱配置\"></a>邮箱配置</h4><blockquote>\n<p>jenkins 自带邮箱功能，可以通过邮箱发送任务构建时的信息。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/jenkins/email.png\"> </p>\n<ul>\n<li>Jenkins URL 是当前jenkins访问地址 可以是内网也可以是外网。</li>\n</ul>\n<h4 id=\"邮件通知\"><a href=\"#邮件通知\" class=\"headerlink\" title=\"邮件通知\"></a>邮件通知</h4><ul>\n<li>SMTP服务器<ul>\n<li>这个邮件帐号的运营商配置</li>\n<li>配置完后可以测试。</li>\n<li>如果收到邮件说明配置成功。</li>\n</ul>\n</li>\n</ul>\n","categories":["Dev"],"tags":["Centos7","Linux","Jenkins"]},{"title":"Mybatis-Snowflake","url":"/posts/496266781/","content":"<h2 id=\"Mybatis使用Snowflake生成主键\"><a href=\"#Mybatis使用Snowflake生成主键\" class=\"headerlink\" title=\"Mybatis使用Snowflake生成主键\"></a>Mybatis使用Snowflake生成主键</h2><h3 id=\"源码地址\"><a href=\"#源码地址\" class=\"headerlink\" title=\"源码地址\"></a><a href=\"https://github.com/z201/code-example/tree/main/Mybatis-Snowflake\" target=\"_blank\" rel=\"noopener\">源码地址</a></h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211228012034.png\"><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211228012132.png\"></p>\n<ul>\n<li>在某些业务中为了安全已经扩展性需要弃用mysql自增id。采用Snowflake生成方式。</li>\n<li>全局唯一性，不能出现重复的id。</li>\n<li>趋势递增，MysqlInnoDB引擎使用的是是聚集索引，使用B-tree的数据结构来存储索引数据。尽量使用有序的主键保证写入性能。</li>\n<li>单调递增：保证下一个ID一定大于上一个ID，例如事务版本号、排序等特殊需求。</li>\n<li>id是无序的，连续的id容易被社会工程。</li>\n</ul>\n<h3 id=\"开发思路\"><a href=\"#开发思路\" class=\"headerlink\" title=\"开发思路\"></a>开发思路</h3><ul>\n<li>创建BaseEntity，将基础字段存放此处。实体基类。</li>\n<li>Snowflake工具类，生成SnowflakeId。</li>\n<li>MybatisInterceptor,用于拦截sql执行，根据Insert、update语句拦截。并修改BaseEntity参数。</li>\n</ul>\n<h3 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h3><ul>\n<li><code>http://localhost:9002/mybatis/ </code> 每次刷新这个地址都会新增一条记录</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220108051521.png\"></p>\n<h3 id=\"Java实现代码\"><a href=\"#Java实现代码\" class=\"headerlink\" title=\"Java实现代码\"></a>Java实现代码</h3><ul>\n<li>目录</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">Dockerfile</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">docker-compose.yml</span> <span class=\"comment\"># docker-compose 文件 测试环境使用</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">docker-config</span> </span><br><span class=\"line\"><span class=\"string\">│</span>   <span class=\"string\">├──</span> <span class=\"string\">mysql</span></span><br><span class=\"line\"><span class=\"string\">│</span>   <span class=\"string\">│</span>   <span class=\"string\">├──</span> <span class=\"string\">init</span></span><br><span class=\"line\"><span class=\"string\">│</span>   <span class=\"string\">│</span>   <span class=\"string\">│</span>   <span class=\"string\">└──</span> <span class=\"string\">1_init.sql</span> <span class=\"comment\"># 数据库初始化文件</span></span><br><span class=\"line\"><span class=\"string\">│</span>   <span class=\"string\">│</span>   <span class=\"string\">└──</span> <span class=\"string\">my.cnf</span> </span><br><span class=\"line\"><span class=\"string\">│</span>   <span class=\"string\">└──</span> <span class=\"string\">pwd.txt</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">pom.xml</span></span><br><span class=\"line\"><span class=\"string\">└──</span> <span class=\"string\">src</span></span><br><span class=\"line\">    <span class=\"string\">├──</span> <span class=\"string\">main</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">├──</span> <span class=\"string\">java</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>   <span class=\"string\">└──</span> <span class=\"string\">cn</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>       <span class=\"string\">└──</span> <span class=\"string\">z201</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>           <span class=\"string\">└──</span> <span class=\"string\">mybatis</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>               <span class=\"string\">├──</span> <span class=\"string\">AccountToolService.java</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>               <span class=\"string\">├──</span> <span class=\"string\">AppApplication.java</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>               <span class=\"string\">├──</span> <span class=\"string\">AppApplicationController.java</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>               <span class=\"string\">├──</span> <span class=\"string\">dao</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>               <span class=\"string\">│</span>   <span class=\"string\">└──</span> <span class=\"string\">AccountDao.java</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>               <span class=\"string\">├──</span> <span class=\"string\">entity</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>               <span class=\"string\">│</span>   <span class=\"string\">└──</span> <span class=\"string\">Account.java</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>               <span class=\"string\">└──</span> <span class=\"string\">mybatis</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>                   <span class=\"string\">├──</span> <span class=\"string\">BaseEntity.java</span> <span class=\"comment\"># 实体基类</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>                   <span class=\"string\">├──</span> <span class=\"string\">MybatisConfig.java</span> <span class=\"comment\"># mybatis配置</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>                   <span class=\"string\">├──</span> <span class=\"string\">MybatisInterceptor.java</span> <span class=\"comment\"># mybatis拦截器</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>                   <span class=\"string\">└──</span> <span class=\"string\">SnowflakeTool.java</span> <span class=\"comment\"># 雪花算法生成器</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">└──</span> <span class=\"string\">resources</span></span><br><span class=\"line\">    <span class=\"string\">│</span>       <span class=\"string\">├──</span> <span class=\"string\">application-dev.yml</span></span><br><span class=\"line\">    <span class=\"string\">│</span>       <span class=\"string\">├──</span> <span class=\"string\">application-test.yml</span></span><br><span class=\"line\">    <span class=\"string\">│</span>       <span class=\"string\">├──</span> <span class=\"string\">application.yml</span></span><br><span class=\"line\">    <span class=\"string\">│</span>       <span class=\"string\">├──</span> <span class=\"string\">logback.xml</span></span><br><span class=\"line\">    <span class=\"string\">│</span>       <span class=\"string\">└──</span> <span class=\"string\">mapper</span></span><br><span class=\"line\">    <span class=\"string\">└──</span> <span class=\"string\">test</span></span><br><span class=\"line\">        <span class=\"string\">└──</span> <span class=\"string\">java</span></span><br><span class=\"line\">            <span class=\"string\">└──</span> <span class=\"string\">cn</span></span><br><span class=\"line\">                <span class=\"string\">└──</span> <span class=\"string\">z201</span></span><br><span class=\"line\">                    <span class=\"string\">└──</span> <span class=\"string\">mybatis</span></span><br><span class=\"line\">                        <span class=\"string\">├──</span> <span class=\"string\">AppApplicationTest.java</span></span><br><span class=\"line\">                        <span class=\"string\">└──</span> <span class=\"string\">CodeGeneratorTest.java</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"pom-xml依赖\"><a href=\"#pom-xml依赖\" class=\"headerlink\" title=\"pom.xml依赖\"></a>pom.xml依赖</h4><ul>\n<li>Spring boot 2.4.*</li>\n<li>Mybatis plus 3.*</li>\n</ul>\n<a id=\"more\"></a>\n\n<h4 id=\"BaseEntity基础类\"><a href=\"#BaseEntity基础类\" class=\"headerlink\" title=\"BaseEntity基础类\"></a>BaseEntity基础类</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.quick.dev.app.config.mybatis;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BaseEntity</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Entity基类字段,这里是数据库的字段</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String[] BASE_ENTITY = &#123;<span class=\"string\">\"id\"</span>, <span class=\"string\">\"is_enable\"</span>, <span class=\"string\">\"create_time\"</span>, <span class=\"string\">\"update_time\"</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 主键</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Long id;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 数据是否有效 1 有效 0 无效</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@TableField</span>(<span class=\"string\">\"is_enable\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Boolean isEnable;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 创建时间</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@TableField</span>(<span class=\"string\">\"create_time\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Long createTime;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 更新时间</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@TableField</span>(<span class=\"string\">\"update_time\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Long updateTime;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"SnowflakeTool工具类\"><a href=\"#SnowflakeTool工具类\" class=\"headerlink\" title=\"SnowflakeTool工具类\"></a>SnowflakeTool工具类</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.time.Clock;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnowflakeTool</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 开始时间截，这里用系统的时间戳</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> startTime = <span class=\"number\">1420041600000L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 机器id所占的位数 5 位</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> WORKER_ID_BITS = <span class=\"number\">5L</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 序列在id中占的位数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> SEQUENCE_BITS = <span class=\"number\">12L</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 数据标识id所占的位数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> DATA_CENTER_ID_BITS = <span class=\"number\">5L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 数据中心最大数量。支持的最大机器id，结果是31 (这个移位算法可以很快计算出几位二进制数所能表示的最大十进制数)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> maxWorkerId = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; WORKER_ID_BITS); <span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 支持的最大数据标识id，结果是31</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> maxDatacenterId = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; DATA_CENTER_ID_BITS);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 机器ID向左移12位</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> workerIdShift = SEQUENCE_BITS;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 数据标识id向左移17位(12+5)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> datacenterIdShift = SEQUENCE_BITS + WORKER_ID_BITS;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间截向左移22位(5+5+12)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> timestampLeftShift = SEQUENCE_BITS + WORKER_ID_BITS + DATA_CENTER_ID_BITS;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生成序列的掩码，这里为4095 (0b111111111111=0xfff=4095)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> sequenceMask = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; SEQUENCE_BITS);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 工作机器ID(0~31)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> workerId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 数据中心ID(0~31)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> datacenterId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 毫秒内序列(0~4095)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> sequence = <span class=\"number\">0L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 上次生成ID的时间截</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> lastTimestamp = -<span class=\"number\">1L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 禁止参的构造，规避创建对象时候使用默认的机器码</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">SnowflakeTool</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SingletonHolder</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> SnowflakeTool INSTANCE = <span class=\"keyword\">new</span> SnowflakeTool(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> SnowflakeTool <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> SingletonHolder.INSTANCE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> workerId     工作ID (0~31)</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> datacenterId 数据中心ID (0~31)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">SnowflakeTool</span><span class=\"params\">(<span class=\"keyword\">long</span> workerId, <span class=\"keyword\">long</span> datacenterId)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (workerId &gt; maxWorkerId || workerId &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(String.format(<span class=\"string\">\"worker Id can't be greater than %d or less than 0\"</span>, maxWorkerId));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (datacenterId &gt; maxDatacenterId || datacenterId &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(String.format(<span class=\"string\">\"datacenter Id can't be greater than %d or less than 0\"</span>, maxDatacenterId));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.workerId = workerId;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.datacenterId = datacenterId;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获得下一个ID (该方法是线程安全的)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> SnowflakeId</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">long</span> <span class=\"title\">nextId</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">long</span> timestamp = Clock.systemDefaultZone().millis();</span><br><span class=\"line\">        <span class=\"comment\">//如果当前时间小于上一次ID生成的时间戳，说明系统时钟回退过这个时候应当抛出异常</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (timestamp &lt; lastTimestamp) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(</span><br><span class=\"line\">                    String.format(<span class=\"string\">\"Clock moved backwards.  Refusing to generate id for %d milliseconds\"</span>, lastTimestamp - timestamp));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//如果是同一时间生成的，则进行毫秒内序列</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (lastTimestamp == timestamp) &#123;</span><br><span class=\"line\">            sequence = (sequence + <span class=\"number\">1</span>) &amp; sequenceMask;</span><br><span class=\"line\">            <span class=\"comment\">//毫秒内序列溢出,序列数已经达到最大</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (sequence == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//阻塞到下一个毫秒,获得新的时间戳</span></span><br><span class=\"line\">                timestamp = tilNextMillis(lastTimestamp);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//时间戳改变，毫秒内序列重置</span></span><br><span class=\"line\">            sequence = <span class=\"number\">0L</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//上次生成ID的时间截</span></span><br><span class=\"line\">        lastTimestamp = timestamp;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//移位并通过或运算拼到一起组成64位的ID</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ((timestamp - startTime) &lt;&lt; timestampLeftShift) <span class=\"comment\">// 时间戳部分</span></span><br><span class=\"line\">                | (datacenterId &lt;&lt; datacenterIdShift) <span class=\"comment\">// 数据中心部分</span></span><br><span class=\"line\">                | (workerId &lt;&lt; workerIdShift) <span class=\"comment\">// 机器标识符部分</span></span><br><span class=\"line\">                | sequence; <span class=\"comment\">// 序列号部分</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 阻塞到下一个毫秒，直到获得新的时间戳</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> lastTimestamp 上次生成ID的时间截</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 当前时间戳</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">long</span> <span class=\"title\">tilNextMillis</span><span class=\"params\">(<span class=\"keyword\">long</span> lastTimestamp)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">long</span> timestamp = Clock.systemDefaultZone().millis();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (timestamp &lt;= lastTimestamp) &#123;</span><br><span class=\"line\">            timestamp = Clock.systemDefaultZone().millis();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> timestamp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"MybatisInterceptor-拦截器\"><a href=\"#MybatisInterceptor-拦截器\" class=\"headerlink\" title=\"MybatisInterceptor 拦截器\"></a>MybatisInterceptor 拦截器</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.hutool.core.lang.Validator;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.quick.dev.app.utils.SnowflakeTool;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.baomidou.mybatisplus.core.plugins.InterceptorIgnoreHelper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.baomidou.mybatisplus.core.toolkit.EncryptUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.baomidou.mybatisplus.core.toolkit.PluginUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.baomidou.mybatisplus.extension.plugins.inner.InnerInterceptor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.executor.Executor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.executor.statement.StatementHandler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.mapping.MappedStatement;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.mapping.SqlCommandType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.plugin.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.sql.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.time.Clock;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"meta\">@Intercepts</span>(&#123;</span><br><span class=\"line\">        <span class=\"meta\">@Signature</span>(type = Executor<span class=\"class\">.<span class=\"keyword\">class</span>, <span class=\"title\">method</span> </span>= <span class=\"string\">\"update\"</span>, args = &#123;</span><br><span class=\"line\">                MappedStatement<span class=\"class\">.<span class=\"keyword\">class</span>, <span class=\"title\">Object</span>.<span class=\"title\">class</span></span></span><br><span class=\"line\"><span class=\"class\">        &#125;),</span></span><br><span class=\"line\"><span class=\"class\">&#125;)</span></span><br><span class=\"line\"><span class=\"class\">@<span class=\"title\">Component</span> // 可以直接在插件上增加<span class=\"title\">Component</span> </span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">public</span> <span class=\"title\">class</span> <span class=\"title\">MybatisInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title\">Interceptor</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">intercept</span><span class=\"params\">(Invocation invocation)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">        Long startTime = Clock.systemDefaultZone().millis();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Object[] args = invocation.getArgs();</span><br><span class=\"line\">            MappedStatement mappedStatement = (MappedStatement) args[<span class=\"number\">0</span>];</span><br><span class=\"line\">            Object entity = args[<span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (SqlCommandType.INSERT.name().equalsIgnoreCase(mappedStatement.getSqlCommandType().name())) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 获取实体集合</span></span><br><span class=\"line\">                List&lt;Object&gt; entitySet = getEntitySet(entity);</span><br><span class=\"line\">                <span class=\"comment\">// 批量设置id</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> (Object object : entitySet) &#123;</span><br><span class=\"line\">                    insertProcess(object);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (SqlCommandType.UPDATE.name().equalsIgnoreCase(mappedStatement.getSqlCommandType().name())) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 获取实体集合</span></span><br><span class=\"line\">                List&lt;Object&gt; entitySet = getEntitySet(entity);</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (Object object : entitySet) &#123;</span><br><span class=\"line\">                    updateProcess(object);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> invocation.proceed();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            Long timeConsuming = Clock.systemDefaultZone().millis() - startTime;</span><br><span class=\"line\">            log.info(<span class=\"string\">\"SQL RunTime &#123;&#125; ms\"</span>, timeConsuming);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * object是需要插入的实体数据,它可能是对象,也可能是批量插入的对象。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果是单个对象,那么object就是当前对象</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果是批量插入对象，那么object就是一个map集合,key值为\"list\",value为ArrayList集合对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> List&lt;Object&gt; <span class=\"title\">getEntitySet</span><span class=\"params\">(Object object)</span> </span>&#123;</span><br><span class=\"line\">        List&lt;Object&gt; set = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (object <span class=\"keyword\">instanceof</span> Map) &#123;</span><br><span class=\"line\">            Iterator entries = ((Map&lt;?, ?&gt;) object).entrySet().iterator();</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (entries.hasNext()) &#123;</span><br><span class=\"line\">                Map.Entry entry = (Map.Entry) entries.next();</span><br><span class=\"line\">                Object value = entry.getValue();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (value <span class=\"keyword\">instanceof</span> Collection) &#123;</span><br><span class=\"line\">                    set.addAll((Collection&lt;?&gt;) value);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    set.add(value);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//单个插入对象</span></span><br><span class=\"line\">            set.add(object);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> set;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">insertProcess</span><span class=\"params\">(Object object)</span> </span>&#123;</span><br><span class=\"line\">        Long time = Clock.systemDefaultZone().millis();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (object <span class=\"keyword\">instanceof</span> BaseEntity) &#123;</span><br><span class=\"line\">            BaseEntity baseEntity = (BaseEntity) object;</span><br><span class=\"line\">            baseEntity.setId(SnowflakeTool.getInstance().nextId());</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Validator.isNull(baseEntity.getIsEnable())) &#123;</span><br><span class=\"line\">                baseEntity.setIsEnable(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Validator.isNull(baseEntity.getCreateTime())) &#123;</span><br><span class=\"line\">                baseEntity.setCreateTime(time);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Validator.isNull(baseEntity.getUpdateTime())) &#123;</span><br><span class=\"line\">                baseEntity.setUpdateTime(time);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">updateProcess</span><span class=\"params\">(Object object)</span> </span>&#123;</span><br><span class=\"line\">        Long time = Clock.systemDefaultZone().millis();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (object <span class=\"keyword\">instanceof</span> BaseEntity) &#123;</span><br><span class=\"line\">            BaseEntity baseEntity = (BaseEntity) object;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Validator.isNull(baseEntity.getUpdateTime())) &#123;</span><br><span class=\"line\">                baseEntity.setUpdateTime(time);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"编码启用拦截器\"><a href=\"#编码启用拦截器\" class=\"headerlink\" title=\"编码启用拦截器\"></a>编码启用拦截器</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.mybatis.mybatis;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.baomidou.mybatisplus.autoconfigure.ConfigurationCustomizer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.baomidou.mybatisplus.extension.MybatisMapWrapperFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.baomidou.mybatisplus.extension.plugins.inner.BlockAttackInnerInterceptor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MybatisConfig</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * #开启返回map结果集的下划线转驼峰</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ConfigurationCustomizer <span class=\"title\">mybatisConfigurationCustomizer</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> configuration -&gt; configuration.setObjectWrapperFactory(<span class=\"keyword\">new</span> MybatisMapWrapperFactory());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> MybatisPlusInterceptor <span class=\"title\">mybatisPlusInterceptor</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        MybatisPlusInterceptor interceptor = <span class=\"keyword\">new</span> MybatisPlusInterceptor();</span><br><span class=\"line\">        interceptor.addInnerInterceptor(<span class=\"keyword\">new</span> BlockAttackInnerInterceptor());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> interceptor;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//     可以直接在插件上增加Component 也可以在此处声明</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">localInterceptor</span><span class=\"params\">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//实例化插件</span></span><br><span class=\"line\">        MybatisInterceptor sqlInterceptor = <span class=\"keyword\">new</span> MybatisInterceptor();</span><br><span class=\"line\">        sqlSessionFactory.getConfiguration().addInterceptor(sqlInterceptor);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"interceptor\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"测试入口\"><a href=\"#测试入口\" class=\"headerlink\" title=\"测试入口\"></a>测试入口</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.mybatis;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.mybatis.dao.AccountDao;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.mybatis.entity.Account;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.Resource;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppApplicationController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    AccountDao accountDao;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    AccountToolService accountToolService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">index</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        accountDao.insert(accountToolService.create());</span><br><span class=\"line\">        QueryWrapper&lt;Account&gt; accountQueryWrapper = <span class=\"keyword\">new</span> QueryWrapper&lt;&gt;();</span><br><span class=\"line\">        accountQueryWrapper.last(<span class=\"string\">\"ORDER BY id DESC  LIMIT 0 , 5\"</span>);</span><br><span class=\"line\">        Map&lt;String, Object&gt; data = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        data.put(<span class=\"string\">\"code\"</span>, <span class=\"string\">\"200\"</span>);</span><br><span class=\"line\">        data.put(<span class=\"string\">\"data\"</span>, accountDao.selectList(accountQueryWrapper));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["Mybatis"],"tags":["Mysql","Mybatis","Snowflake"]},{"title":"差缺补漏-Netty","url":"/posts/3959611604/","content":"<blockquote>\n<p>Netty是一款用于快速开发高性能的网络应用程序的Java框架，正是因为有 Netty 的存在，网络编程领域 Java 才得以与 C++ 并肩而立。</p>\n</blockquote>\n<ul>\n<li>Netty 官网给出了有关 Netty 的整体功能模块结构</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211116220629.png\"></p>\n<ul>\n<li>Core核心层</li>\n</ul>\n<blockquote>\n<p>提供底层网络通信抽象和实现，其中包括了可扩展的时间模型、通信API、支持零拷贝的buf等。</p>\n</blockquote>\n<ul>\n<li>Protocol Support 协议支持层</li>\n</ul>\n<blockquote>\n<p>协议支持层基本上覆盖了主流协议的编解码实现，比如HTTP、SSL、WebSocket</p>\n</blockquote>\n<ul>\n<li>Transport Service 传输服务层</li>\n</ul>\n<blockquote>\n<p>传输服务层提供了网络传输能力的定义和实现方法，支持 Socket、HTTP 隧道等。Netty 对 TCP、UDP 等数据传输做了抽象和封装</p>\n</blockquote>\n<h3 id=\"Netty流程\"><a href=\"#Netty流程\" class=\"headerlink\" title=\"Netty流程\"></a>Netty流程</h3><blockquote>\n<p>从功能上理解顺序</p>\n</blockquote>\n<ul>\n<li>启动服务 -&gt; 构建连接 -&gt; 接受数据 -&gt; 业务处理 -&gt; 发送数据 -&gt; 断开连接 -&gt; 关闭服务</li>\n</ul>\n<h4 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h4><ul>\n<li>初始化线程池</li>\n<li>初始化channel</li>\n<li>绑定端口并启动</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Sharable</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EchoServerHandler</span> <span class=\"keyword\">extends</span> <span class=\"title\">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">channelRead</span><span class=\"params\">(ChannelHandlerContext ctx, Object msg)</span> </span>&#123;</span><br><span class=\"line\">        ctx.write(msg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">channelReadComplete</span><span class=\"params\">(ChannelHandlerContext ctx)</span> </span>&#123;</span><br><span class=\"line\">        ctx.flush();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">exceptionCaught</span><span class=\"params\">(ChannelHandlerContext ctx, Throwable cause)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// Close the connection when an exception is raised.</span></span><br><span class=\"line\">        cause.printStackTrace();</span><br><span class=\"line\">        ctx.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Echoes back any received data from a client.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EchoServer</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> SSL = System.getProperty(<span class=\"string\">\"ssl\"</span>) != <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> PORT = Integer.parseInt(System.getProperty(<span class=\"string\">\"port\"</span>, <span class=\"string\">\"8007\"</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// Configure SSL.</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> SslContext sslCtx;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (SSL) &#123;</span><br><span class=\"line\">            SelfSignedCertificate ssc = <span class=\"keyword\">new</span> SelfSignedCertificate();</span><br><span class=\"line\">            sslCtx = SslContextBuilder.forServer(ssc.certificate(), ssc.privateKey()).build();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            sslCtx = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Configure the server.</span></span><br><span class=\"line\">        <span class=\"comment\">// 在官方的example中默认是Reactor主从多线程模式</span></span><br><span class=\"line\">        <span class=\"comment\">// 1.配置线程池</span></span><br><span class=\"line\">        EventLoopGroup bossGroup = <span class=\"keyword\">new</span> NioEventLoopGroup(<span class=\"number\">1</span>);</span><br><span class=\"line\">        EventLoopGroup workerGroup = <span class=\"keyword\">new</span> NioEventLoopGroup();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> EchoServerHandler serverHandler = <span class=\"keyword\">new</span> EchoServerHandler();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            ServerBootstrap b = <span class=\"keyword\">new</span> ServerBootstrap();</span><br><span class=\"line\">            b.group(bossGroup, workerGroup)</span><br><span class=\"line\">             .channel(NioServerSocketChannel<span class=\"class\">.<span class=\"keyword\">class</span>) // 2.初始化<span class=\"title\">channel</span>类型</span></span><br><span class=\"line\"><span class=\"class\">             .<span class=\"title\">option</span>(<span class=\"title\">ChannelOption</span>.<span class=\"title\">SO_BACKLOG</span>, 100) // 2.1.设置<span class=\"title\">channel</span>参数</span></span><br><span class=\"line\"><span class=\"class\">             .<span class=\"title\">handler</span>(<span class=\"title\">new</span> <span class=\"title\">LoggingHandler</span>(<span class=\"title\">LogLevel</span>.<span class=\"title\">INFO</span>))</span></span><br><span class=\"line\"><span class=\"class\">              // 注册<span class=\"title\">channelhandler</span>，在<span class=\"title\">netty</span>中通过<span class=\"title\">ChannelPipeline</span> 去注册多个 <span class=\"title\">ChannelHandler</span></span></span><br><span class=\"line\"><span class=\"class\">             .<span class=\"title\">childHandler</span>(<span class=\"title\">new</span> <span class=\"title\">ChannelInitializer</span>&lt;<span class=\"title\">SocketChannel</span>&gt;() </span>&#123;</span><br><span class=\"line\">                 <span class=\"meta\">@Override</span></span><br><span class=\"line\">                 <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">initChannel</span><span class=\"params\">(SocketChannel ch)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">                     ChannelPipeline p = ch.pipeline();</span><br><span class=\"line\">                     <span class=\"keyword\">if</span> (sslCtx != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                         p.addLast(sslCtx.newHandler(ch.alloc()));</span><br><span class=\"line\">                     &#125;</span><br><span class=\"line\">                     <span class=\"comment\">//p.addLast(new LoggingHandler(LogLevel.INFO));</span></span><br><span class=\"line\">                     p.addLast(serverHandler);</span><br><span class=\"line\">                 &#125;</span><br><span class=\"line\">             &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Start the server. </span></span><br><span class=\"line\">            <span class=\"comment\">// 3.启动 通过bind() 方法会真正触发启动，sync() 方法则会阻塞</span></span><br><span class=\"line\">            ChannelFuture f = b.bind(PORT).sync();</span><br><span class=\"line\">            <span class=\"comment\">// Wait until the server socket is closed.</span></span><br><span class=\"line\">            f.channel().closeFuture().sync();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Shut down all event loops to terminate all threads.</span></span><br><span class=\"line\">            bossGroup.shutdownGracefully();</span><br><span class=\"line\">            workerGroup.shutdownGracefully();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h4 id=\"bind方法\"><a href=\"#bind方法\" class=\"headerlink\" title=\"bind方法\"></a>bind方法</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> ChannelFuture <span class=\"title\">doBind</span><span class=\"params\">(<span class=\"keyword\">final</span> SocketAddress localAddress)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 1.调用 initAndRegister()方法初始化Channel,接受返回到ChannelFuture。</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> ChannelFuture regFuture = initAndRegister();</span><br><span class=\"line\">  <span class=\"comment\">// 2.调用 ChannelFuture.channel方法，返回Channel。</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Channel channel = regFuture.channel();</span><br><span class=\"line\">  <span class=\"comment\">// 3.调用 ChannelFuture.cause方法判断 initAndRegister()是否存在异常。存在异常则直接返回</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (regFuture.cause() != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> regFuture;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 4.调用 ChannelFuture.isDone方法，判断initAndRegister()方法是否执行完成。</span></span><br><span class=\"line\">    <span class=\"comment\">// \t 如果执行完成则调用bind0方法，如果没有执行完成，ChannelFuture 添加一个ChannelFutureListener回调监听，当initAndRegister()方法执行完成后回调operationComplete方法，调用调用 ChannelFuture.cause()方法判断initAndRegister()是否存在异常，无异常在执行bind0方法。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (regFuture.isDone()) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// At this point we know that the registration was complete and successful.</span></span><br><span class=\"line\">        ChannelPromise promise = channel.newPromise();</span><br><span class=\"line\">        doBind0(regFuture, channel, localAddress, promise);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> promise;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Registration future is almost always fulfilled already, but just in case it's not.</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> PendingRegistrationPromise promise = <span class=\"keyword\">new</span> PendingRegistrationPromise(channel);</span><br><span class=\"line\">        regFuture.addListener(<span class=\"keyword\">new</span> ChannelFutureListener() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">operationComplete</span><span class=\"params\">(ChannelFuture future)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">                Throwable cause = future.cause();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (cause != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// Registration on the EventLoop failed so fail the ChannelPromise directly to not cause an</span></span><br><span class=\"line\">                    <span class=\"comment\">// IllegalStateException once we try to access the EventLoop of the Channel.</span></span><br><span class=\"line\">                    promise.setFailure(cause);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// Registration was successful, so set the correct executor to use.</span></span><br><span class=\"line\">                    <span class=\"comment\">// See https://github.com/netty/netty/issues/2586</span></span><br><span class=\"line\">                    promise.registered();</span><br><span class=\"line\"></span><br><span class=\"line\">                    doBind0(regFuture, channel, localAddress, promise);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> promise;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Channel\"><a href=\"#Channel\" class=\"headerlink\" title=\"Channel\"></a>Channel</h4><blockquote>\n<p>Netty网络通信组件、用于执行网络I/O操作。</p>\n</blockquote>\n<ul>\n<li><p>提供网络相关配置信息</p>\n</li>\n<li><p>Channel参数</p>\n<ul>\n<li><p>SO_KEEPALIVE </p>\n<ul>\n<li>设置为 true 代表启用了 TCP SO_KEEPALIVE 属性，TCP 会主动探测连接状态，即连接保活</li>\n</ul>\n</li>\n<li><p>SO_BACKLOG </p>\n<ul>\n<li>已完成三次握手的请求队列最大长度，同一时刻服务端可能会处理多个连接，在高并发海量连接的场景下，该参数应适当调大</li>\n</ul>\n</li>\n<li><p>TCP_NODELAY </p>\n<ul>\n<li>Netty 默认是 true，表示立即发送数据。如果设置为 false 表示启用 Nagle 算法，该算法会将 TCP 网络数据包累积到一定量才会发送，虽然可以减少报文发送的数量，但是会造成一定的数据延迟。Netty 为了最小化数据传输的延迟，默认禁用了 Nagle 算法</li>\n</ul>\n</li>\n<li><p>SO_SNDBUF TCP </p>\n<ul>\n<li>数据发送缓冲区大小</li>\n</ul>\n</li>\n<li><p>SO_RCVBUF </p>\n<ul>\n<li>TCP数据接收缓冲区大小，TCP数据接收缓冲区大小</li>\n</ul>\n</li>\n<li><p>SO_LINGER </p>\n<ul>\n<li>设置延迟关闭的时间，等待缓冲区中的数据发送完成 </li>\n</ul>\n</li>\n<li><p>CONNECT_TIMEOUT_MILLIS  </p>\n<ul>\n<li>连接超时时间</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>常用的Channel类型</p>\n<ul>\n<li><p>NioSocketChannel，异步的客户端 TCP Socket 连接。</p>\n</li>\n<li><p>NioServerSocketChannel，异步的服务器端 TCP Socket 连接。</p>\n</li>\n<li><p>NioDatagramChannel，异步的 UDP 连接。</p>\n</li>\n<li><p>NioSctpChannel，异步的客户端 Sctp 连接。</p>\n</li>\n<li><p>NioSctpServerChannel，异步的 Sctp 服务器端连接，这些通道涵盖了 UDP 和 TCP 网络 IO 以及文件 IO。</p>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"EventLoop\"><a href=\"#EventLoop\" class=\"headerlink\" title=\"EventLoop\"></a>EventLoop</h4><blockquote>\n<p>EventLoop并不是Netty独有的，它是一种<strong>事件等待和处理的程序模型</strong>，可以解决多线程资源消耗高的问题。</p>\n</blockquote>\n<ul>\n<li>在 Netty 中 EventLoop 可以理解为 Reactor 线程模型的事件处理引擎，每个 EventLoop 线程都维护一个 Selector 选择器和任务队列 taskQueue。它主要负责处理 I/O 事件、普通任务和定时任务。Netty 中推荐使用 NioEventLoop 作为实现类。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211213143517.png\"></p>\n<ul>\n<li>上图是EventLoop常见模型<ul>\n<li>每次出现事件的时候，Eventloop会将事件存放在Event Queue事件队列中，通过轮询取出事件执行或者将事件分发给响应的事件监听执行，事件执行的方式通常分为立即执行、延后执行、定期执行几种。</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"run方法\"><a href=\"#run方法\" class=\"headerlink\" title=\"run方法\"></a>run方法</h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">switch</span> (selectStrategy.calculateStrategy(selectNowSupplier, hasTasks())) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">case</span> SelectStrategy.CONTINUE:</span><br><span class=\"line\">                        <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">case</span> SelectStrategy.BUSY_WAIT:</span><br><span class=\"line\">                        <span class=\"comment\">// fall-through to SELECT since the busy-wait is not supported with NIO</span></span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">case</span> SelectStrategy.SELECT: <span class=\"comment\">// 处理select事件</span></span><br><span class=\"line\">                        <span class=\"comment\">// 轮训io事件</span></span><br><span class=\"line\">                        select(wakenUp.getAndSet(<span class=\"keyword\">false</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"comment\">// 'wakenUp.compareAndSet(false, true)' is always evaluated</span></span><br><span class=\"line\">                        <span class=\"comment\">// before calling 'selector.wakeup()' to reduce the wake-up</span></span><br><span class=\"line\">                        <span class=\"comment\">// overhead. (Selector.wakeup() is an expensive operation.)</span></span><br><span class=\"line\">                        <span class=\"comment\">//</span></span><br><span class=\"line\">                        <span class=\"comment\">// However, there is a race condition in this approach.</span></span><br><span class=\"line\">                        <span class=\"comment\">// The race condition is triggered when 'wakenUp' is set to</span></span><br><span class=\"line\">                        <span class=\"comment\">// true too early.</span></span><br><span class=\"line\">                        <span class=\"comment\">//</span></span><br><span class=\"line\">                        <span class=\"comment\">// 'wakenUp' is set to true too early if:</span></span><br><span class=\"line\">                        <span class=\"comment\">// 1) Selector is waken up between 'wakenUp.set(false)' and</span></span><br><span class=\"line\">                        <span class=\"comment\">//    'selector.select(...)'. (BAD)</span></span><br><span class=\"line\">                        <span class=\"comment\">// 2) Selector is waken up between 'selector.select(...)' and</span></span><br><span class=\"line\">                        <span class=\"comment\">//    'if (wakenUp.get()) &#123; ... &#125;'. (OK)</span></span><br><span class=\"line\">                        <span class=\"comment\">//</span></span><br><span class=\"line\">                        <span class=\"comment\">// In the first case, 'wakenUp' is set to true and the</span></span><br><span class=\"line\">                        <span class=\"comment\">// following 'selector.select(...)' will wake up immediately.</span></span><br><span class=\"line\">                        <span class=\"comment\">// Until 'wakenUp' is set to false again in the next round,</span></span><br><span class=\"line\">                        <span class=\"comment\">// 'wakenUp.compareAndSet(false, true)' will fail, and therefore</span></span><br><span class=\"line\">                        <span class=\"comment\">// any attempt to wake up the Selector will fail, too, causing</span></span><br><span class=\"line\">                        <span class=\"comment\">// the following 'selector.select(...)' call to block</span></span><br><span class=\"line\">                        <span class=\"comment\">// unnecessarily.</span></span><br><span class=\"line\">                        <span class=\"comment\">//</span></span><br><span class=\"line\">                        <span class=\"comment\">// To fix this problem, we wake up the selector again if wakenUp</span></span><br><span class=\"line\">                        <span class=\"comment\">// is true immediately after selector.select(...).</span></span><br><span class=\"line\">                        <span class=\"comment\">// It is inefficient in that it wakes up the selector for both</span></span><br><span class=\"line\">                        <span class=\"comment\">// the first case (BAD - wake-up required) and the second case</span></span><br><span class=\"line\">                        <span class=\"comment\">// (OK - no wake-up required).</span></span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (wakenUp.get()) &#123;</span><br><span class=\"line\">                            selector.wakeup();</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"comment\">// fall through</span></span><br><span class=\"line\">                    <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// If we receive an IOException here its because the Selector is messed up. Let's rebuild</span></span><br><span class=\"line\">                    <span class=\"comment\">// the selector and retry. https://github.com/netty/netty/issues/8566</span></span><br><span class=\"line\">                    rebuildSelector0();</span><br><span class=\"line\">                    handleLoopException(e);</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                cancelledKeys = <span class=\"number\">0</span>;</span><br><span class=\"line\">                needsToSelectAgain = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> ioRatio = <span class=\"keyword\">this</span>.ioRatio;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (ioRatio == <span class=\"number\">100</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        processSelectedKeys(); <span class=\"comment\">// 处理io事件</span></span><br><span class=\"line\">                    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// Ensure we always run tasks.</span></span><br><span class=\"line\">                        runAllTasks(); <span class=\"comment\">// 处理所有任务</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> ioStartTime = System.nanoTime();</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        processSelectedKeys(); <span class=\"comment\">// 处理io事件</span></span><br><span class=\"line\">                    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// Ensure we always run tasks.</span></span><br><span class=\"line\">                        <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> ioTime = System.nanoTime() - ioStartTime;</span><br><span class=\"line\">                        runAllTasks(ioTime * (<span class=\"number\">100</span> - ioRatio) / ioRatio);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable t) &#123;</span><br><span class=\"line\">                handleLoopException(t);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// Always handle shutdown even if the loop processing threw an exception.</span></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (isShuttingDown()) &#123;</span><br><span class=\"line\">                    closeAll();</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (confirmShutdown()) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable t) &#123;</span><br><span class=\"line\">                handleLoopException(t);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"EventLoop良好的实践\"><a href=\"#EventLoop良好的实践\" class=\"headerlink\" title=\"EventLoop良好的实践\"></a>EventLoop良好的实践</h5><ul>\n<li>网络连接建立过程中三次握手、安全认证的过程会消耗不少时间。建议使用Reactor混合模式采用 Boss 和 Worker 两个 EventLoopGroup。</li>\n<li>Reactor 线程模式适合处理耗时短的任务场景，耗时较长的 ChannelHandler 可以考虑维护一个业务线程池。避免 ChannelHandler 阻塞而造成 EventLoop 不可用。</li>\n<li>如果业务逻辑执行时间较短，建议直接在 ChannelHandler 中执行。减少系统复杂度。</li>\n<li>尽量少的ChannelHandler，尽量将业务独立出去。</li>\n</ul>\n<h4 id=\"ChannelPipeline\"><a href=\"#ChannelPipeline\" class=\"headerlink\" title=\"ChannelPipeline\"></a>ChannelPipeline</h4><blockquote>\n<p>实际编码过程中，业务处理逻辑是 ChannelPipeline 中所定义的 ChannelHandler 完成的，Netty 服务编排层的核心组件 ChannelPipeline 和 ChannelHandler 为用户提供了 I/O 事件管理。</p>\n</blockquote>\n<ul>\n<li>从ChannelPipeline注释上面抓的图</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211213213842.png\"></p>\n<ul>\n<li>channelPipeline采用责任链没事，Inbound入站、outbound出站。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211213220334.png\"></p>\n<ul>\n<li>每个 Channel 会绑定一个 ChannelPipeline，每一个 ChannelPipeline 都包含多个ChannelHandlerContext，所有 ChannelHandlerContext 之间组成了双向链表。ChannelPipeline 的双向链表分别维护了 HeadContext 和 TailContext 的头尾节点。自定义的 ChannelHandler 会插入到 Head 和 Tail 之间。</li>\n<li>ChannelHandlerContext包含了ChannelHandler 生命周期的所有事件。入站的时候是从headContext往tailContext执行，出站的时候tailContext往headContext执行。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">serverBootstrap.childHandler(<span class=\"keyword\">new</span> ChannelInitializer&lt;NioSocketChannel&gt;() &#123;</span><br><span class=\"line\">         <span class=\"meta\">@Override</span></span><br><span class=\"line\">         <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">initChannel</span><span class=\"params\">(NioSocketChannel ch)</span></span>&#123;</span><br><span class=\"line\">             ChannelPipeline channelPipeline = ch.pipeline();</span><br><span class=\"line\">             channelPipeline.addLast(<span class=\"string\">\"idleHandler\"</span>, <span class=\"keyword\">new</span> ServerIdleCheckHandler());</span><br><span class=\"line\">             channelPipeline.addLast(<span class=\"string\">\"frameDecoder\"</span>,<span class=\"keyword\">new</span> FrameDecoder());</span><br><span class=\"line\">             channelPipeline.addLast(<span class=\"string\">\"frameEncoder\"</span>,<span class=\"keyword\">new</span> FrameEncoder());</span><br><span class=\"line\">             channelPipeline.addLast(<span class=\"string\">\"protocolDecoder\"</span>,<span class=\"keyword\">new</span> ProtocolDecoder());</span><br><span class=\"line\">             channelPipeline.addLast(<span class=\"string\">\"protocolEncoder\"</span>,<span class=\"keyword\">new</span> ProtocolEncoder());</span><br><span class=\"line\">             channelPipeline.addLast(<span class=\"string\">\"loggingHandler\"</span>,<span class=\"keyword\">new</span> LoggingHandler(LogLevel.INFO));</span><br><span class=\"line\">             channelPipeline.addLast(<span class=\"string\">\"protocolProcessHandler\"</span>,<span class=\"keyword\">new</span> ServerProtocolProcessHandler());</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>运行效果</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">22:10:57 [work-3-1] FrameDecoder: running</span><br><span class=\"line\">22:10:57 [work-3-1] FrameEncoder: running</span><br><span class=\"line\">22:10:57 [work-3-1] ProtocolDecoder: running</span><br><span class=\"line\">22:10:57 [work-3-1] ServerProtocolProcessHandler: running</span><br><span class=\"line\">22:10:57 [work-3-1] ProtocolEncoder: running</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"ChannelPipeline异常处理\"><a href=\"#ChannelPipeline异常处理\" class=\"headerlink\" title=\"ChannelPipeline异常处理\"></a>ChannelPipeline异常处理</h5><ul>\n<li>pipleline是责任链模式，推荐在自定义handler末端添加同一的异常处理器。根据异常信息处理逻辑。</li>\n</ul>\n<h4 id=\"ByteBuf\"><a href=\"#ByteBuf\" class=\"headerlink\" title=\"ByteBuf\"></a>ByteBuf</h4><blockquote>\n<p>Netty中的数据容器，Java Nio中也提供了ByteBuffer但是使用复杂。</p>\n</blockquote>\n<h4 id=\"Zero-Copy\"><a href=\"#Zero-Copy\" class=\"headerlink\" title=\"Zero-Copy\"></a>Zero-Copy</h4><blockquote>\n<p><strong>Netty</strong> 的<code>Zero-copy</code> ,零拷贝是一个耳熟能详的词语，在 Linux、Kafka、RocketMQ 等知名的产品中都有使用，通常用于提升 I/O 性能。</p>\n</blockquote>\n<ul>\n<li>Netty 这样的类库，往往对性能有着偏执的追求。为了避免 Java 垃圾收集器不可预测的行为以及额外的性能开销，这些产品一般倾向于使用 JVM 之外的内存来存储和管理数据。这样的数据，就是我们常说的堆外数据（off-heap data）。</li>\n<li>使用堆外存储最常用的办法，就是使用 ByteBuffer 这个类来分配直接存储空间（direct buffer）。JVM 虚拟机会尽最大努力直接在直接存储空间上执行 IO 操作，避免数据在本地和 JVM 之间的拷贝。</li>\n<li><strong>频繁的内存拷贝是性能的主要障碍之一。所以为了极致的性能，应用程序通常也会尽量避免内存的拷贝。理想的状况下，一份数据只需要一份内存空间，这就是我们常说的零拷贝。</strong></li>\n</ul>\n<h4 id=\"Keepalive\"><a href=\"#Keepalive\" class=\"headerlink\" title=\"Keepalive\"></a>Keepalive</h4><blockquote>\n<p>keepalive就是心跳，一个人的心跳证明人还活着，那么在网络通信的双方如何证明对端还活着着，两个服务之间使用心跳来检测对方是否还活着。</p>\n</blockquote>\n<h4 id=\"Netty中的设计模式\"><a href=\"#Netty中的设计模式\" class=\"headerlink\" title=\"Netty中的设计模式\"></a>Netty中的设计模式</h4><ul>\n<li>单例  ReadTimeoutException#INSTANCE</li>\n<li>工厂 ReflectiveChannelFactory</li>\n<li>策略 EventExecutorChooserFactory</li>\n<li>装饰器 WrappedByteBuf</li>\n<li>模版 AbstractTrafficShapingHandler</li>\n<li>责任链 ChannelPipeline  ChannelHandler</li>\n<li>观察者 ChannelFuture#addListener</li>\n</ul>\n<h3 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h3><h4 id=\"良好的实践\"><a href=\"#良好的实践\" class=\"headerlink\" title=\"良好的实践\"></a>良好的实践</h4><ul>\n<li>通过修改<code>线程名</code>方便我们在debug或者异常追踪,通过NioEventLoopGroup的构造方法来修改名称</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">EventLoopGroup bossGroup = <span class=\"keyword\">new</span> NioEventLoopGroup(<span class=\"number\">0</span>,<span class=\"keyword\">new</span> DefaultThreadFactory(<span class=\"string\">\"boss\"</span>));</span><br><span class=\"line\">EventLoopGroup workerGroup = <span class=\"keyword\">new</span> NioEventLoopGroup(,<span class=\"keyword\">new</span> DefaultThreadFactory(<span class=\"string\">\"work\"</span>));</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改<code>Handler</code>名称，如果不设置Handler的名称，会使用默认的类名。添加到pipleline到时候指定名字。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"> channelPipeline.addLast(<span class=\"string\">\"idleHandler\"</span>, <span class=\"keyword\">new</span> ServerIdleCheckHandler());</span><br><span class=\"line\">channelPipeline.addLast(<span class=\"string\">\"frameDecoder\"</span>,<span class=\"keyword\">new</span> FrameDecoder());</span><br><span class=\"line\"> channelPipeline.addLast(<span class=\"string\">\"frameEncoder\"</span>,<span class=\"keyword\">new</span> FrameEncoder());</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>日志,这里从Netty自带的LoggingHandler跟踪源码,这里可以看到优先使用的是SLF4J。但是需要手动引入相应的jar依赖。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> InternalLoggerFactory <span class=\"title\">newDefaultFactory</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">        InternalLoggerFactory f;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            f = <span class=\"keyword\">new</span> Slf4JLoggerFactory(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">            f.newInstance(name).debug(<span class=\"string\">\"Using SLF4J as the default logging framework\"</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable ignore1) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                f = Log4JLoggerFactory.INSTANCE;</span><br><span class=\"line\">                f.newInstance(name).debug(<span class=\"string\">\"Using Log4J as the default logging framework\"</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable ignore2) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    f = Log4J2LoggerFactory.INSTANCE;</span><br><span class=\"line\">                    f.newInstance(name).debug(<span class=\"string\">\"Using Log4J2 as the default logging framework\"</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Throwable ignore3) &#123;</span><br><span class=\"line\">                    f = JdkLoggerFactory.INSTANCE;</span><br><span class=\"line\">                    f.newInstance(name).debug(<span class=\"string\">\"Using java.util.logging as the default logging framework\"</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> f;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>在不同的平台切换Nio native实现,这里需要注意开发环境和生产环境。在生产环境还需要注意权限问题、并且准好号native的库。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// mac </span></span><br><span class=\"line\">EventLoopGroup bossGroup = <span class=\"keyword\">new</span> KQueueEventLoopGroup(<span class=\"number\">0</span>,<span class=\"keyword\">new</span> DefaultThreadFactory(<span class=\"string\">\"boss\"</span>));</span><br><span class=\"line\">EventLoopGroup workerGroup = <span class=\"keyword\">new</span> KQueueEventLoopGroup(<span class=\"number\">0</span>,<span class=\"keyword\">new</span> DefaultThreadFactory(<span class=\"string\">\"work\"</span>));</span><br><span class=\"line\"><span class=\"comment\">// linxu </span></span><br><span class=\"line\">EventLoopGroup bossGroup = <span class=\"keyword\">new</span> EpollEventLoopGroup(<span class=\"number\">0</span>,<span class=\"keyword\">new</span> DefaultThreadFactory(<span class=\"string\">\"boss\"</span>));</span><br><span class=\"line\">EventLoopGroup workerGroup = <span class=\"keyword\">new</span> EpollEventLoopGroup(<span class=\"number\">0</span>,<span class=\"keyword\">new</span> DefaultThreadFactory(<span class=\"string\">\"work\"</span>));</span><br><span class=\"line\"><span class=\"comment\">// 注意开发环境与生产环境,</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"为什么要使用netty而不使用Jdk自带的NIO\"><a href=\"#为什么要使用netty而不使用Jdk自带的NIO\" class=\"headerlink\" title=\"为什么要使用netty而不使用Jdk自带的NIO\"></a>为什么要使用netty而不使用Jdk自带的NIO</h4><blockquote>\n<p>更好的api、更加稳定、可扩展性</p>\n</blockquote>\n<ul>\n<li>相比nio,netty做的更多，做的更好。</li>\n<li>使用jdk nio，我们使用 JDK NIO 编程需要了解很多复杂的概念，比如 Channels、Selectors、Sockets、Buffers 等、还需要解决沾包、半包的问题，还需要做大量的定制化需求。网络本身就很复杂，比如短线重连、心跳。</li>\n<li>netty解决了大量nio的bug,比如select空转导致cpu 100%，使用netty可以很好的规避大量存在的问题，毕竟jdk也是人写的。</li>\n<li>netty在扩展性上，在线程模型可以通过参数配置选择线程模型。</li>\n<li>JDK的NIO默认是水平触发，Netty是边缘触发（默认）和水平触发可以切换。</li>\n<li>Netty实现的垃圾回收更少、性能更好。</li>\n</ul>\n<h4 id=\"经典的三种I-O模式\"><a href=\"#经典的三种I-O模式\" class=\"headerlink\" title=\"经典的三种I/O模式\"></a>经典的三种I/O模式</h4><blockquote>\n<p>BIO（阻塞I/O）、NIO(非阻塞I/O)、AIO(异步I/O)</p>\n</blockquote>\n<ul>\n<li>阻塞于非阻塞<ul>\n<li>阻塞情况下，没有数据传输过来时，读操作会阻塞一直等待到有数据，缓冲区写满的时候，写做操也会阻塞。非阻塞遇到这种情况都是直接返回。</li>\n</ul>\n</li>\n<li>同步于异步<ul>\n<li>数据准备就绪需要自己去读取就是同步，数据就绪直接读取好回调给程序就是异步。</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"netty如何实现三种I-O模式\"><a href=\"#netty如何实现三种I-O模式\" class=\"headerlink\" title=\"netty如何实现三种I/O模式\"></a>netty如何实现三种I/O模式</h5><ul>\n<li>BIO在netty中也叫OIO和AIO一起曾经都支持过。现在Netty仅支持NIO。</li>\n</ul>\n<h5 id=\"nio一定优于bio吗\"><a href=\"#nio一定优于bio吗\" class=\"headerlink\" title=\"nio一定优于bio吗\"></a>nio一定优于bio吗</h5><ul>\n<li>在连接数少、并发低的场景下，BIO性能并不输NIO。</li>\n</ul>\n<h5 id=\"什么是水平触发、什么是边缘触发\"><a href=\"#什么是水平触发、什么是边缘触发\" class=\"headerlink\" title=\"什么是水平触发、什么是边缘触发\"></a>什么是水平触发、什么是边缘触发</h5><blockquote>\n<p>边缘触发相当于高速模式，理论上效率更高，但是复杂度也高，所以现在大多应用（Redis等）还是默认水平触发，如果追求要更好的性能、同时有信心编码好，可以尝试使用边缘触发，例如nginx。边缘触发只支持非阻塞模式。</p>\n</blockquote>\n<ul>\n<li>当被监控的文件有可读写事件发生时，epoll_wait()会通知处理程序去读写，如果这次没有把数据一次性全部读写完的话，水平触发：那么下次调用 epoll_wait()时通知你上次没读写完，如果一直不处理它会一直通知你；边缘触发：下次调用 epoll_wait()的时候不会通知你，也就是只通知一次，知道该文件上出现第二次可读写事件才会通知，效率比水平触发要高</li>\n</ul>\n<h4 id=\"Netty对Reactor的支持\"><a href=\"#Netty对Reactor的支持\" class=\"headerlink\" title=\"Netty对Reactor的支持\"></a>Netty对Reactor的支持</h4><blockquote>\n<p>nio在netty中的是由reactor实现的，Reactor是一种开发模式,在netty中Reactor有三种模式。</p>\n</blockquote>\n<ul>\n<li><strong>单线程模型</strong>：EventLoopGroup只包含一个EventLoop，Boss和Worker使用同一个EventLoopGroup</li>\n<li><strong>多线程模型</strong>：EventLoopGroup包含多个EventLoop，Boss和Worker使用同一个EventLoopGroup</li>\n<li><strong>主从多线程模型</strong>：EventLoopGroup包含多个EventLoop，Boss是主Reactor，Worker是从Reactor，它们分别使用不同的EventLoopGroup，主Reactor负责新的网络连接Channel创建，然后把Channel注册到从Reactor</li>\n</ul>\n<h5 id=\"Reactor单线程模式\"><a href=\"#Reactor单线程模式\" class=\"headerlink\" title=\"Reactor单线程模式\"></a>Reactor单线程模式</h5><ul>\n<li>Reactor单线程模式所有的I/O操作都由一个线程完成。仅需要启动一个NioEventLoopGroup。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">EventLoopGroup group = <span class=\"keyword\">new</span> NioEventLoopGroup(<span class=\"number\">1</span>);</span><br><span class=\"line\">ServerBootstrap b = <span class=\"keyword\">new</span> ServerBootstrap();</span><br><span class=\"line\">b.group(group)</span><br></pre></td></tr></table></figure>\n\n<p>![image-20211120161222982](/Users/zengqingfeng/Library/Application Support/typora-user-images/image-20211120161222982.png)</p>\n<ul>\n<li>一个线程支持的连接数是有限的，性能方面cpu容易跑满。</li>\n<li>当多个事件同时触发的时候，容易出现柱塞的情况，会导致消息的积压、客户端请求超时。</li>\n<li>线程在处理I/O事件，Select无法处理其他操作，比如建立连接、事件分发等操作。长时间的线程满负载，容易导致服务节点不可用。</li>\n</ul>\n<h5 id=\"非主从Reactor多线程模式\"><a href=\"#非主从Reactor多线程模式\" class=\"headerlink\" title=\"非主从Reactor多线程模式\"></a>非主从Reactor多线程模式</h5><ul>\n<li>由于Reactor出现的严重的性能问题，因此出现了多线程模型，在创建NioEventLoopGroup的时候可以不指定大小，默认是2 * cpu的线程数量，也可以手动设置固定的线程数。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">EventLoopGroup group = <span class=\"keyword\">new</span> NioEventLoopGroup();</span><br><span class=\"line\">ServerBootstrap b = <span class=\"keyword\">new</span> ServerBootstrap();</span><br><span class=\"line\">b.group(group)</span><br></pre></td></tr></table></figure>\n\n<p>![image-20211120161554909](/Users/zengqingfeng/Library/Application Support/typora-user-images/image-20211120161554909.png)</p>\n<h5 id=\"主从Reactor多线程模式\"><a href=\"#主从Reactor多线程模式\" class=\"headerlink\" title=\"主从Reactor多线程模式\"></a>主从Reactor多线程模式</h5><ul>\n<li>现在主流的开发主要采用主从多线程模式,Boos是主Reactor,worker是从Reactor。它们分别使用不同的NioEventLoopGroup，主Reactor负责处理ON_ACCEPT,然后把Channel注册到Reactor上面，从Reactor负责Channel生命周期内的IO事件。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">EventLoopGroup bossGroup &#x3D; new NioEventLoopGroup();</span><br><span class=\"line\">EventLoopGroup workerGroup &#x3D; new NioEventLoopGroup();</span><br><span class=\"line\">ServerBootstrap b &#x3D; new ServerBootstrap();</span><br><span class=\"line\">b.group(bossGroup, workerGroup)</span><br></pre></td></tr></table></figure>\n\n<p>![image-20211120161838884](/Users/zengqingfeng/Library/Application Support/typora-user-images/image-20211120161838884.png)</p>\n<h4 id=\"c10k\"><a href=\"#c10k\" class=\"headerlink\" title=\"c10k\"></a>c10k</h4><blockquote>\n<p>它的意思是一台机器要维护 1 万个连接，就要创建 1 万个进程或者线程，那么操作系统是无法承受的。</p>\n</blockquote>\n<h4 id=\"select、poll、epoll\"><a href=\"#select、poll、epoll\" class=\"headerlink\" title=\"select、poll、epoll\"></a>select、poll、epoll</h4><table>\n<thead>\n<tr>\n<th></th>\n<th>Select</th>\n<th>Poll</th>\n<th>Poll</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>底层实现</td>\n<td>数组</td>\n<td>链表</td>\n<td>哈希表</td>\n</tr>\n<tr>\n<td>I/O</td>\n<td>每次调用线性遍历、时间复杂度O(n)</td>\n<td>每次调用线性遍历、时间复杂度O(n)</td>\n<td>时间通知方式、时间复杂度O(1)</td>\n</tr>\n<tr>\n<td>最大连接数</td>\n<td>1024(x86)、2048(x64)</td>\n<td>无上限</td>\n<td>无上限</td>\n</tr>\n</tbody></table>\n<h4 id=\"Netty通用模式下NIO实现多路复用器是如何跨平台的\"><a href=\"#Netty通用模式下NIO实现多路复用器是如何跨平台的\" class=\"headerlink\" title=\"Netty通用模式下NIO实现多路复用器是如何跨平台的\"></a>Netty通用模式下NIO实现多路复用器是如何跨平台的</h4><blockquote>\n<p>netty在不同平台单独实现了NIO，据说性能更好。windows iocp 、mac kqueue 、linux epool</p>\n</blockquote>\n<ul>\n<li>Netty通用模式一般指的是NioEnventLoopGroup、NioEventLoop、NioSelectSocketChannel、NioSocketChannel的使用场景下，实际上针对Linux和mac单独做了NIO的实现。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 该方法在不同的平台上返回不同的类型。</span></span><br><span class=\"line\">sun.nio.ch.DefaultSelectorProvider.create()</span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">package</span> sun.nio.ch;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.channels.spi.SelectorProvider;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DefaultSelectorProvider</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">DefaultSelectorProvider</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SelectorProvider <span class=\"title\">create</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 在mac/bsd的环境下返回KQueue</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> KQueueSelectorProvider();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Netty-是如何解决-epoll-空轮询的-Bug\"><a href=\"#Netty-是如何解决-epoll-空轮询的-Bug\" class=\"headerlink\" title=\"Netty 是如何解决 epoll 空轮询的 Bug\"></a>Netty 是如何解决 epoll 空轮询的 Bug</h4><blockquote>\n<p>在 JDK 中， Epoll 的实现是存在漏洞的，即使 Selector 轮询的事件列表为空，NIO 线程一样可以被唤醒，导致 CPU 100% 占用。这就是臭名昭著的 JDK epoll 空轮询的 Bug</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 每次执行 Select 操作之前记录当前时间 currentTimeNanos。</span></span><br><span class=\"line\">           <span class=\"keyword\">long</span> time = System.nanoTime();</span><br><span class=\"line\">           <span class=\"comment\">// time - TimeUnit.MILLISECONDS.toNanos(timeoutMillis) &gt;= currentTimeNanos，</span></span><br><span class=\"line\">           <span class=\"comment\">// 如果事件轮询的持续时间大于等于 timeoutMillis，那么说明是正常的，否则表明阻塞时间并未达到预期，可能触发了空轮询的 Bug。</span></span><br><span class=\"line\">           <span class=\"keyword\">if</span> (time - TimeUnit.MILLISECONDS.toNanos(timeoutMillis) &gt;= currentTimeNanos) &#123;</span><br><span class=\"line\">               <span class=\"comment\">// timeoutMillis elapsed without anything selected.</span></span><br><span class=\"line\">               selectCnt = <span class=\"number\">1</span>;</span><br><span class=\"line\">               <span class=\"comment\">// 计数变量 selectCnt。在正常情况下，selectCnt 会重置，</span></span><br><span class=\"line\">               <span class=\"comment\">// 否则会对 selectCnt 自增计数。当 selectCnt 达到 SELECTOR_AUTO_REBUILD_THRESHOLD（默认512） 阈值时，</span></span><br><span class=\"line\">               <span class=\"comment\">// 会触发重建 Selector 对象。</span></span><br><span class=\"line\">           &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (SELECTOR_AUTO_REBUILD_THRESHOLD &gt; <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">                   selectCnt &gt;= SELECTOR_AUTO_REBUILD_THRESHOLD) &#123;</span><br><span class=\"line\">               <span class=\"comment\">// The code exists in an extra method to ensure the method is not too big to inline as this</span></span><br><span class=\"line\">               <span class=\"comment\">// branch is not very likely to get hit very frequently.</span></span><br><span class=\"line\">               selector = selectRebuildSelector(selectCnt);</span><br><span class=\"line\">               selectCnt = <span class=\"number\">1</span>;</span><br><span class=\"line\">               <span class=\"keyword\">break</span>;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           currentTimeNanos = time;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"TCP-IP中粘包、半包\"><a href=\"#TCP-IP中粘包、半包\" class=\"headerlink\" title=\"TCP/IP中粘包、半包\"></a>TCP/IP中粘包、半包</h4><blockquote>\n<p>TCP是流式协议，数据是无清晰边界的。拆包/粘包问题的存在，数据接收方很难界定数据包的边界在哪里，很难识别出一个完整的数据包。所以需要提供一种机制来识别数据包的界限，这也是解决拆包/粘包的唯一方法：定义应用层的通信协议。</p>\n</blockquote>\n<h5 id=\"粘包\"><a href=\"#粘包\" class=\"headerlink\" title=\"粘包\"></a>粘包</h5><ul>\n<li>数据发送方每次写入数据大小小于套接字缓存区大小。合并发送数据的时候。</li>\n</ul>\n<h5 id=\"半包\"><a href=\"#半包\" class=\"headerlink\" title=\"半包\"></a>半包</h5><ul>\n<li>发送方时写入数据大小小于套接字缓存区大小。(发送的数据大于TCP协议中MTU最大传输单位)必须拆包。</li>\n</ul>\n<h5 id=\"如何解决\"><a href=\"#如何解决\" class=\"headerlink\" title=\"如何解决\"></a>如何解决</h5><blockquote>\n<p>封装成帧(framing)</p>\n</blockquote>\n<ul>\n<li><p>消息长度固定</p>\n<ul>\n<li>每个数据报文都需要一个固定的长度。当接收方累计读取到固定长度的报文后，就认为已经获得一个完整的消息。当发送方的数据小于固定长度时，则需要空位补齐。</li>\n</ul>\n</li>\n<li><p>特定分隔符</p>\n<ul>\n<li>发送报文时尾部需要添加特定分隔符，推荐的做法是将消息进行编码，例如 base64 编码，然后可以选择 64 个编码字符之外的字符作为特定分隔符。Redis 在通信过程中采用的就是换行分隔符 <code>\\n </code>、<code>\\r\\n</code>。</li>\n</ul>\n</li>\n<li><p>消息长度 + 消息内容</p>\n<ul>\n<li>先解析固定长度的字段获取长度，然后读取后续的内容。长度理论上有限制，需要提前预知可能的最大长度。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"Netty-对三种常用封帧方式的支持\"><a href=\"#Netty-对三种常用封帧方式的支持\" class=\"headerlink\" title=\"Netty 对三种常用封帧方式的支持\"></a>Netty 对三种常用封帧方式的支持</h4><blockquote>\n<p>Netty中解决粘包半包的编解码叫做一次解码器。</p>\n</blockquote>\n<ul>\n<li><p>固定长度  <code>FixedLengthFrameDecoder</code> </p>\n</li>\n<li><p>分隔符   <code>DelimiterBasedFrameDecoder</code></p>\n</li>\n<li><p>固定长度字段存个内容的长度信息 <code>LengthFieldBasedFrameDecoder</code> <code>LengthFieldPrepender</code></p>\n<ul>\n<li>LengthFieldBasedFrameDecoder按照指定的包长度偏移量对接受的数据进行编码。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211123154642.png\"></p>\n<ul>\n<li>LengthFieldPrepender 在响应数据的时候从封装数据，在数据前面增加数据的长度。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211123154934.png\"></p>\n</li>\n</ul>\n<h4 id=\"二次编解码方式\"><a href=\"#二次编解码方式\" class=\"headerlink\" title=\"二次编解码方式\"></a>二次编解码方式</h4><blockquote>\n<p>Netty内置编解码器在实际工作中需要二次编解码，比如我们业务数据是json格式，就需要将原始数据转换成用户数据</p>\n</blockquote>\n<ul>\n<li>在netty源码中内置了很多二次解码器java序列化、XML、JSON等等，都在codec包下。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211122162837.png\"></p>\n<ul>\n<li>比如使用protobuf二次解码器</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">ch.pipeline().addLast(<span class=\"keyword\">new</span> ProtobufVarint32FrameDecoder());</span><br><span class=\"line\">ch.pipeline().addLast(<span class=\"keyword\">new</span> ProtobufDecoder(PersonOuterClass.Person.getDefaultInstance()));</span><br><span class=\"line\">ch.pipeline().addLast(<span class=\"keyword\">new</span> ProtobufVarint32LengthFieldPrepender());</span><br><span class=\"line\">ch.pipeline().addLast(<span class=\"keyword\">new</span> ProtobufEncoder());</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Linux系统参数\"><a href=\"#Linux系统参数\" class=\"headerlink\" title=\"Linux系统参数\"></a>Linux系统参数</h4><ul>\n<li>修改linux对单一进程打开的文件句柄数量限制<ul>\n<li><code>ulimit -n [xxx]</code>尽量不要做临时的设置。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"有TCP的keepalive，为什么还需要应用层的keepalive\"><a href=\"#有TCP的keepalive，为什么还需要应用层的keepalive\" class=\"headerlink\" title=\"有TCP的keepalive，为什么还需要应用层的keepalive\"></a>有TCP的keepalive，为什么还需要应用层的keepalive</h4><blockquote>\n<p>TCP中的keepalive默认是关闭，因此探测包在传递中可能丢失，默认的超时时间太长，默认是7200+9*75秒，也就是2个多小时。TCP是一个传输层的协议，传输层的数据畅通并不一定操作系统进程所对应的服务畅通。</p>\n</blockquote>\n","categories":["Netty"],"tags":["Netty","NIO","Reactor"]},{"title":"Jenkins-local-deployment-level","url":"/posts/1708465251/","content":"<blockquote>\n<p>整理下Jenkins本地部署程序的过程。</p>\n</blockquote>\n<ul>\n<li><p>在开发阶段，许多编译工具会将我们的源码编译可使用的文件。例如 <code>vue-cli</code> 的项目会被 <code>webpack</code> 打包编译为浏览器的文件，<code>Java</code> 项目会被编译为 <code>.class/jar</code> 文件以供服务器使用。</p>\n<ol>\n<li><p>开发人员将源代码，经过编译、压缩等一系列流程打包</p>\n</li>\n<li><p>上传到服务器。</p>\n</li>\n<li><p>在服务器将编译后的文件，手动可用的容器服务内（例如 <code>Nginx，Tomcat，Apache</code> 等服务）</p>\n</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"单机部署\"><a href=\"#单机部署\" class=\"headerlink\" title=\"单机部署\"></a>单机部署</h3><blockquote>\n<p>在jenkins所在的机器上部署程序</p>\n</blockquote>\n<ol>\n<li><a href=\"https://z201.cn/2021/05/25/Centos7-jenkins%E9%83%A8%E7%BD%B2/\">部署jenkins</a>并配置环境</li>\n<li>设置jenkins-credentials (后续用于从git仓库中获取代码)</li>\n<li>创建任务<ol>\n<li>设置仓库地址</li>\n<li>设置程序部署shell脚本</li>\n</ol>\n</li>\n</ol>\n<ul>\n<li><p>jenkins shell</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">mvn clean install -Dmaven.test.skip=true</span><br><span class=\"line\">cp x x x/target/xxx-1.0.0-SNAPSHOT.jar /opt/xxx/upgrade</span><br><span class=\"line\">cd /opt/xxx</span><br><span class=\"line\">BUILD_ID=dontKillMe sh xxx.sh</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>编写程序运行shell脚本。</p>\n</li>\n<li><p>部署java</p>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash</span></span><br><span class=\"line\">app=xxx</span><br><span class=\"line\">appName=$&#123;app&#125;-1.0.0-SNAPSHOT</span><br><span class=\"line\">projPath=/opt/xxx</span><br><span class=\"line\">upgradePath=$&#123;projPath&#125;/upgrade</span><br><span class=\"line\">backPath=$&#123;projPath&#125;/backup</span><br><span class=\"line\">logFile=$&#123;projPath&#125;/data/logs/$&#123;app&#125;.log</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 检查升级文件是否存在</span></span><br><span class=\"line\">echo \"checking upgrade file...\"</span><br><span class=\"line\">if [ ! -f $&#123;upgradePath&#125;/$&#123;appName&#125;.jar ]; then</span><br><span class=\"line\">    echo \"cann't found file $&#123;upgradePath&#125;/$&#123;appName&#125;.jar!\"</span><br><span class=\"line\">    exit</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 结束进程</span></span><br><span class=\"line\">pid=`ps aux | grep $&#123;projPath&#125;/$&#123;appName&#125;.jar | grep -v grep | grep -v kill | awk '&#123;print $2&#125;'`</span><br><span class=\"line\">if [ $&#123;pid&#125; ]; then</span><br><span class=\"line\">    echo \"kill $&#123;appName&#125;!\"</span><br><span class=\"line\">    kill -9 $pid</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 备份原升级文件,如果存在的话</span></span><br><span class=\"line\">if [ -f $&#123;projPath&#125;/$&#123;appName&#125;.jar ]; then</span><br><span class=\"line\">    timeStr=`date +%Y%m%d%H%M%S`</span><br><span class=\"line\">    mv $&#123;projPath&#125;/$&#123;appName&#125;.jar $&#123;backPath&#125;/$&#123;appName&#125;.jar.bak_$&#123;timeStr&#125;</span><br><span class=\"line\">    echo \"load $&#123;appName&#125; success!\"</span><br><span class=\"line\">    echo \"backup $&#123;appName&#125; success!\"</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 拷贝升级文件</span></span><br><span class=\"line\">echo \"copy $&#123;appName&#125;.jar...\"</span><br><span class=\"line\">cp $&#123;upgradePath&#125;/$&#123;appName&#125;.jar $&#123;projPath&#125;/$&#123;appName&#125;.jar</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 启动进程</span></span><br><span class=\"line\">echo \"start $&#123;appName&#125;...\"</span><br><span class=\"line\">nohup java -Djava.security.egd=file:/dev/./urandom -Xms512m -Xmx512m -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=256m -jar $&#123;projPath&#125;/$&#123;appName&#125;.jar --spring.profiles.active=test &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 查看日志</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 判断当天日志文件是否存在</span></span><br><span class=\"line\">if [ ! -f $&#123;logFile&#125; ]; then</span><br><span class=\"line\">    # 文件不存在则创建文件，再执行tail命令</span><br><span class=\"line\">    touch $&#123;logFile&#125;</span><br><span class=\"line\">fi</span><br><span class=\"line\">echo \"tail -f $&#123;logFile&#125;\"</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>部署vue</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> git revert</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> git restore .</span></span><br><span class=\"line\"></span><br><span class=\"line\">applicationPath=/opt/view/xxxx</span><br><span class=\"line\"></span><br><span class=\"line\">echo 'delete old files...'</span><br><span class=\"line\">rm -rf $&#123;applicationPath&#125;/*</span><br><span class=\"line\"></span><br><span class=\"line\">echo 'copy files after npm build!'</span><br><span class=\"line\">cp -rf dist/* $&#123;applicationPath&#125;</span><br></pre></td></tr></table></figure>\n\n","categories":["Dev"],"tags":["Jenkins","Dev"]},{"title":"Mac-Install-Neo4j-Jupyter","url":"/posts/1666574776/","content":"<blockquote>\n<p>准备学习下neo4j记录在mac下安装neo4j的坑。</p>\n</blockquote>\n<h2 id=\"neo4j官网网站下载失败\"><a href=\"#neo4j官网网站下载失败\" class=\"headerlink\" title=\"neo4j官网网站下载失败\"></a>neo4j官网网站下载失败</h2><blockquote>\n<p>国内只能从镜像地址下载</p>\n</blockquote>\n<p><a href=\"http://doc.we-yun.com:1008/\" target=\"_blank\" rel=\"noopener\">http://doc.we-yun.com:1008/</a> </p>\n<h2 id=\"配置jdk11\"><a href=\"#配置jdk11\" class=\"headerlink\" title=\"配置jdk11\"></a>配置jdk11</h2><blockquote>\n<p>可以查看我上面内容实用Jenv管理多个版本。</p>\n</blockquote>\n<h2 id=\"启动neo4j\"><a href=\"#启动neo4j\" class=\"headerlink\" title=\"启动neo4j\"></a>启动neo4j</h2><blockquote>\n<p>下载完成后解压</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 启动</span></span><br><span class=\"line\">./neo4j  start</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 关闭</span></span><br><span class=\"line\">./neo4j  stop</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"neo4j界面\"><a href=\"#neo4j界面\" class=\"headerlink\" title=\"neo4j界面\"></a>neo4j界面</h2><ul>\n<li>在浏览器中输入localhost:7474</li>\n<li>初始用户名、密码均为neo4j， 第一次登录需要修改密码</li>\n</ul>\n<h2 id=\"安装jupyter\"><a href=\"#安装jupyter\" class=\"headerlink\" title=\"安装jupyter\"></a>安装jupyter</h2><blockquote>\n<p>注意提前安装python环境</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">pip install jupyter notebook -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host=mirrors.aliyun.com</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 检查版本</span></span><br><span class=\"line\">jupyter --version</span><br></pre></td></tr></table></figure>\n\n","categories":["Neo4j"],"tags":["Mac","Neo4j","Jupiter"]},{"title":"Mac-OpenJdk11-JavaFx-Dev","url":"/posts/4130926005/","content":"<blockquote>\n<p>OpenJdk 11 环境下JavaFx开发环境设置</p>\n</blockquote>\n<ul>\n<li><a href=\"https://www.coder.work/article/884639\" target=\"_blank\" rel=\"noopener\">https://www.coder.work/article/884639</a></li>\n<li><a href=\"https://stackoverflow.com/questions/54291958/javafx-11-illegalaccesserror-when-creating-label\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/54291958/javafx-11-illegalaccesserror-when-creating-label</a></li>\n<li><a href=\"https://gluonhq.com/products/javafx/\" target=\"_blank\" rel=\"noopener\">https://gluonhq.com/products/javafx/</a></li>\n</ul>\n<h2 id=\"pom依赖\"><a href=\"#pom依赖\" class=\"headerlink\" title=\"pom依赖\"></a>pom依赖</h2><figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.openjfx<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javafx-controls<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>11<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.openjfx<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javafx-fxml<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>11<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"idea设置\"><a href=\"#idea设置\" class=\"headerlink\" title=\"idea设置\"></a>idea设置</h3><blockquote>\n<p>下载javafx版本，然后引入依赖。项目lib中引入。启动的时候在vm中添加启动参数</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">--module-path</span><br><span class=\"line\"><span class=\"meta\">/Users/$</span><span class=\"bash\">USER/word/libhome/javafx-sdk-11.0.2/lib</span></span><br><span class=\"line\">--add-modules</span><br><span class=\"line\">javafx.controls</span><br><span class=\"line\">--add-modules</span><br><span class=\"line\">javafx.base</span><br><span class=\"line\">--add-modules</span><br><span class=\"line\">javafx.graphics</span><br><span class=\"line\">--add-modules</span><br><span class=\"line\">javafx.fxml</span><br><span class=\"line\">--add-modules</span><br><span class=\"line\">javafx.media</span><br></pre></td></tr></table></figure>\n\n","categories":["Dev"],"tags":["Mac","OpenJdk11","JavaFx"]},{"title":"Mac-Install-Jenv","url":"/posts/62740049/","content":"<blockquote>\n<p>简单记录下mac下多版本jdk管理 </p>\n</blockquote>\n<ul>\n<li><a href=\"https://adoptopenjdk.net/\" target=\"_blank\" rel=\"noopener\">https://adoptopenjdk.net/</a></li>\n<li><a href=\"https://www.jianshu.com/p/1a147d5515f0\" target=\"_blank\" rel=\"noopener\">https://www.jianshu.com/p/1a147d5515f0</a></li>\n</ul>\n<h2 id=\"检查环境\"><a href=\"#检查环境\" class=\"headerlink\" title=\"检查环境\"></a>检查环境</h2><h3 id=\"查看当前安装的jdk版本\"><a href=\"#查看当前安装的jdk版本\" class=\"headerlink\" title=\"查看当前安装的jdk版本\"></a>查看当前安装的jdk版本</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">/usr/libexec/java_home -V</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 如果有安装过jdk版本这里会输出信息</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用brew-安装jenv\"><a href=\"#使用brew-安装jenv\" class=\"headerlink\" title=\"使用brew 安装jenv\"></a>使用brew 安装jenv</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">brew install jenv</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">检查</span></span><br><span class=\"line\">jenv doctor </span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 刚安装会提示很多信息</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"初始化jenv\"><a href=\"#初始化jenv\" class=\"headerlink\" title=\"初始化jenv\"></a>初始化jenv</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">brew install jenv</span><br><span class=\"line\">jenv init -</span><br><span class=\"line\">echo 'eval \"$(jenv init -)\"' &gt;&gt; ~/.bash_profile</span><br><span class=\"line\">echo 'eval \"$(jenv init -)\"' &gt;&gt; ~/.zprofile</span><br><span class=\"line\">jenv add &lt;path-to-java8-Home-Dir&gt; # 这里从/usr/libexec/java_home -V 获取javaHome</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"切换jdk\"><a href=\"#切换jdk\" class=\"headerlink\" title=\"切换jdk\"></a>切换jdk</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">➜  ~ jenv versions</span><br><span class=\"line\">* system (set by /Users/zengqingfeng/.jenv/version)</span><br><span class=\"line\">  1.8</span><br><span class=\"line\">  1.8.0.275</span><br><span class=\"line\">  openjdk64-1.8.0.275</span><br><span class=\"line\">  </span><br><span class=\"line\">➜  ~ jenv local system # 切换版本</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"可能出现的问题\"><a href=\"#可能出现的问题\" class=\"headerlink\" title=\"可能出现的问题\"></a>可能出现的问题</h3><ul>\n<li>使用 jenv 过程可能会发现，当切换 JDK 版本之后， <code>${JAVA_HOME}</code> 环境变量没有改变，还是上一个 JDK 版本配置。</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">这时可以运行 exec $SHELL -l ， $&#123;JAVA_HOME&#125; 将会变成当前版本。</span><br></pre></td></tr></table></figure>\n\n","categories":["Dev"],"tags":["Mac","jenv","openJdk11"]},{"title":"SpringBoot-Mdc-Log","url":"/posts/2813270003/","content":"<blockquote>\n<p>日常在开发过程中方便排查文件，需要在日志中输出一些关键内容。</p>\n</blockquote>\n<h2 id=\"MDC\"><a href=\"#MDC\" class=\"headerlink\" title=\"MDC\"></a>MDC</h2><blockquote>\n<p>在茫茫日志中定位需要的信息很费时，MDC 全称是 Mapped Diagnostic Context.一个线程安全的存放诊断日志的容器。</p>\n</blockquote>\n<h3 id=\"演示代码\"><a href=\"#演示代码\" class=\"headerlink\" title=\"演示代码\"></a><a href=\"https://github.com/z201/code-example/tree/main/Spring-Boot-Mdc-Log\" target=\"_blank\" rel=\"noopener\">演示代码</a></h3><h3 id=\"HTTP处理演示\"><a href=\"#HTTP处理演示\" class=\"headerlink\" title=\"HTTP处理演示\"></a>HTTP处理演示</h3><h4 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h4><blockquote>\n<p>实际上代码不需要这么麻烦,只需要调用MDC.put 就能将数据写入，但是实际开发过程中。通过手动编码的方式添加太低效了，这里在spring mvc的场景下使用用拦截器来处理数据注入操作。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppApplicationController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">index</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">\"index\"</span>);</span><br><span class=\"line\">        Map&lt;String, Object&gt; data = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        data.put(<span class=\"string\">\"code\"</span>, <span class=\"string\">\"200\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">**</span><br><span class=\"line\"> * <span class=\"meta\">@author</span> z201.coding<span class=\"meta\">@gamil</span>.com</span><br><span class=\"line\"> */</span><br><span class=\"line\"><span class=\"meta\">@Order</span>(Ordered.HIGHEST_PRECEDENCE + <span class=\"number\">8</span>)</span><br><span class=\"line\"><span class=\"meta\">@ConditionalOnClass</span>(WebMvcConfigurer<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\">@<span class=\"title\">Slf4j</span></span></span><br><span class=\"line\"><span class=\"class\">@<span class=\"title\">Component</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">public</span> <span class=\"title\">class</span> <span class=\"title\">MdcTraceContextFilter</span> <span class=\"keyword\">extends</span> <span class=\"title\">OncePerRequestFilter</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doFilterInternal</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                                    FilterChain filterChain)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">        String appTraceId = request.getHeader(MdcApiConstant.HTTP_HEADER_TRACE_ID);</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * 没有设置就设置下,设置了就直接返回。注意这里必须提前在拦截器中设置好，不然会失效。</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StrUtil.isEmpty(appTraceId)) &#123;</span><br><span class=\"line\">            appTraceId = MDC.get(MdcApiConstant.HTTP_HEADER_TRACE_ID);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (Strings.isEmpty(appTraceId)) &#123;</span><br><span class=\"line\">                appTraceId = MdcTool.getInstance().currentTraceId();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            request.setAttribute(MdcApiConstant.HTTP_HEADER_TRACE_ID, appTraceId);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        MDC.put(MdcApiConstant.HTTP_HEADER_TRACE_ID, appTraceId);</span><br><span class=\"line\">        filterChain.doFilter(request, response);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MdcTool</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SingletonHolder</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> MdcTool INSTANCE = <span class=\"keyword\">new</span> MdcTool();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">MdcTool</span> <span class=\"params\">()</span></span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> MdcTool <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> SingletonHolder.INSTANCE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> String <span class=\"title\">currentTraceId</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ThreadLocalRandom random = ThreadLocalRandom.current();</span><br><span class=\"line\">        UUID uuid = <span class=\"keyword\">new</span> UUID(random.nextInt(), random.nextInt());</span><br><span class=\"line\">        StringBuilder st = <span class=\"keyword\">new</span> StringBuilder(uuid.toString().replace(<span class=\"string\">\"-\"</span>, <span class=\"string\">\"\"</span>).toLowerCase());</span><br><span class=\"line\">        st.append(Instant.now().toEpochMilli());</span><br><span class=\"line\">        <span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (i &lt; <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">            i++;</span><br><span class=\"line\">            st.append(ThreadLocalRandom.current().nextInt(<span class=\"number\">2</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> st.toString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"log配置文件\"><a href=\"#log配置文件\" class=\"headerlink\" title=\"log配置文件\"></a>log配置文件</h4><blockquote>\n<p>Log4j 或者 logback 在pattern表中修改表达式<code>%X{AppTraceId}</code> 这就是拦截去注入进去的数据key。</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>[%t][%level][%file:%line][%X&#123;AppTraceId&#125;] %msg%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">culr http:&#x2F;&#x2F;localhost:9007&#x2F;mdc&#x2F;</span><br><span class=\"line\">[AppApplicationController.java:19][00000000299baa76ffffffffbd27659b1641811416723011] index</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h4 id=\"异步调用的\"><a href=\"#异步调用的\" class=\"headerlink\" title=\"异步调用的\"></a>异步调用的</h4><blockquote>\n<ul>\n<li>在记录日志的时候，通常会使用MDC来存储每个线程的特有参数，以便更好的查询日志。</li>\n<li>但是Logback在最新的版本中因为性能问题，不会自动的将MDC的内存传给子线程。所以Logback建议在执行异步线程前</li>\n<li>先通过MDC.getCopyOfContextMap()方法将MDC内存获取出来，再传给线程。</li>\n<li>并在子线程的执行的最开始调用MDC.setContextMap(context)方法将父线程的MDC内容传给子线程。</li>\n</ul>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 这是&#123;<span class=\"doctag\">@link</span> ThreadPoolTaskExecutor&#125;简单的改良，可以在每个任务之前设置子线程的MDC数据。</span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> * https://logback.qos.ch/manual/mdc.html</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gamil.com</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MdcThreadPoolTaskExecutor</span> <span class=\"keyword\">extends</span> <span class=\"title\">ThreadPoolTaskExecutor</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Pool where task threads take MDC from the submitting thread.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> MdcThreadPoolTaskExecutor <span class=\"title\">newWithInheritedMdc</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize, <span class=\"keyword\">int</span> maximumPoolSize, <span class=\"keyword\">long</span> keepAliveTime,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                                                                TimeUnit unit, <span class=\"keyword\">int</span> queueCapacity, RejectedExecutionHandler rejectedExecutionHandler)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> MdcThreadPoolTaskExecutor(corePoolSize, maximumPoolSize, keepAliveTime, unit, queueCapacity, rejectedExecutionHandler);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">MdcThreadPoolTaskExecutor</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize, <span class=\"keyword\">int</span> maximumPoolSize,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                                      <span class=\"keyword\">long</span> keepAliveTime, TimeUnit unit, <span class=\"keyword\">int</span> queueCapacity, RejectedExecutionHandler rejectedExecutionHandler)</span> </span>&#123;</span><br><span class=\"line\">        setCorePoolSize(corePoolSize);</span><br><span class=\"line\">        setMaxPoolSize(maximumPoolSize);</span><br><span class=\"line\">        setKeepAliveSeconds((<span class=\"keyword\">int</span>) unit.toSeconds(keepAliveTime));</span><br><span class=\"line\">        setQueueCapacity(queueCapacity);</span><br><span class=\"line\">        setRejectedExecutionHandler(rejectedExecutionHandler);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Map&lt;String, String&gt; <span class=\"title\">initMdcContext</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取父线程MDC中的内容，必须在run方法之前，否则等异步线程执行的时候有可能MDC里面的值已经被清空了，这个时候就会返回null</span></span><br><span class=\"line\">        Map&lt;String, String&gt; context = MDC.getCopyOfContextMap();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Validator.isNull(context)) &#123;</span><br><span class=\"line\">            context = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (CollectionUtil.isEmpty(context)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 防止线程没有链路信息,这里可以扩展</span></span><br><span class=\"line\">            context.put(MdcApiConstant.HTTP_HEADER_TRACE_ID, MdcTool.getInstance().currentTraceId());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> context;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 所有线程都会委托给这个execute方法，在这个方法中我们把父线程的MDC内容赋值给子线程</span></span><br><span class=\"line\"><span class=\"comment\">     * https://logback.qos.ch/manual/mdc.html#managedThreads</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> runnable</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">(@NonNull Runnable runnable)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.execute(() -&gt; run(runnable, initMdcContext()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 异步提交</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> task</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@NonNull</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Future&lt;?&gt; submit(<span class=\"meta\">@NonNull</span> Runnable task) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">super</span>.submit(() -&gt; run(task, initMdcContext()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 异步提交</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> task</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@NonNull</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; <span class=\"function\">Future&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(@NonNull Callable&lt;T&gt; task)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">super</span>.submit(submit(task, initMdcContext()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 子线程委托的执行方法s</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> runnable &#123;<span class=\"doctag\">@link</span> Runnable&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> context  父线程MDC内容</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">(Runnable runnable, Map&lt;String, String&gt; context)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 将父线程的MDC内容传给子线程</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (context != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                MDC.setContextMap(context);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                logger.error(e.getMessage(), e);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 执行异步操作</span></span><br><span class=\"line\">            runnable.run();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 清空MDC内容</span></span><br><span class=\"line\">            MDC.clear();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> &lt;T&gt; <span class=\"function\">Callable&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(<span class=\"keyword\">final</span> Callable&lt;T&gt; task, <span class=\"keyword\">final</span> Map&lt;String, String&gt; context)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> () -&gt; &#123;</span><br><span class=\"line\">            Map&lt;String, String&gt; previous = MDC.getCopyOfContextMap();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (context == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                MDC.clear();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                MDC.setContextMap(context);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> task.call();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (previous == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    MDC.clear();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    MDC.setContextMap(previous);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.mdc.log;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MdcThreadTaskUtils</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> MdcThreadPoolTaskExecutor taskExecutor = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * demo</span></span><br><span class=\"line\"><span class=\"comment\">     *         ThreadTaskUtils.run(() -&gt; run());</span></span><br><span class=\"line\"><span class=\"comment\">     *         FutureTask&lt;String&gt; futureTask = new FutureTask&lt;String&gt;(() -&gt; call());</span></span><br><span class=\"line\"><span class=\"comment\">     *         ThreadTaskUtils.run(futureTask);</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * 核心线程数 5</span></span><br><span class=\"line\"><span class=\"comment\">         * 最大线程数 50</span></span><br><span class=\"line\"><span class=\"comment\">         * 队列最大长度 1000</span></span><br><span class=\"line\"><span class=\"comment\">         * 线程池维护线程所允许的空闲时间(单位秒) 120</span></span><br><span class=\"line\"><span class=\"comment\">         * 线程池对拒绝任务(无线程可用)的处理策略 ThreadPoolExecutor.CallerRunsPolicy策略 ,调用者的线程会执行该任务,如果执行器已关闭,则丢弃. 120</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">(Runnable runnable)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == taskExecutor) &#123;</span><br><span class=\"line\">            taskExecutor = MdcThreadPoolTaskExecutor.newWithInheritedMdc(<span class=\"number\">5</span>, <span class=\"number\">50</span>, <span class=\"number\">1000</span>, TimeUnit.SECONDS, <span class=\"number\">120</span>, <span class=\"keyword\">new</span> ThreadPoolExecutor.AbortPolicy());</span><br><span class=\"line\">            taskExecutor.initialize();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        taskExecutor.execute(runnable);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"线程次调用演示\"><a href=\"#线程次调用演示\" class=\"headerlink\" title=\"线程次调用演示\"></a>线程次调用演示</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.mdc.log;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.Disabled;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.MethodOrderer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.TestMethodOrder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.extension.ExtendWith;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.test.context.junit.jupiter.SpringExtension;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.CountDownLatch;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"meta\">@ExtendWith</span>(SpringExtension<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\">@<span class=\"title\">SpringBootTest</span>(<span class=\"title\">classes</span> </span>= AppApplication<span class=\"class\">.<span class=\"keyword\">class</span>, <span class=\"title\">webEnvironment</span> </span>= SpringBootTest.WebEnvironment.RANDOM_PORT)</span><br><span class=\"line\"><span class=\"meta\">@AutoConfigureMockMvc</span></span><br><span class=\"line\"><span class=\"comment\">// 指定单元测试方法顺序</span></span><br><span class=\"line\"><span class=\"meta\">@TestMethodOrder</span>(MethodOrderer.OrderAnnotation<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">public</span> <span class=\"title\">class</span> <span class=\"title\">AppApplicationTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"meta\">@Disabled</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testMdcTask</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        MdcThreadTaskUtils.run(()-&gt;&#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> count = <span class=\"number\">10</span>;</span><br><span class=\"line\">        CountDownLatch countDownLatch = <span class=\"keyword\">new</span> CountDownLatch(count);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; count; i++) &#123;</span><br><span class=\"line\">            MdcThreadTaskUtils.run(()-&gt;&#123;</span><br><span class=\"line\">                log.info(<span class=\"string\">\"&#123;&#125;\"</span>,Thread.currentThread().getId());</span><br><span class=\"line\">                countDownLatch.countDown();</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        countDownLatch.countDown();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">[MdcThreadPoolTaskExecutor-<span class=\"number\">1</span>][INFO][<span class=\"number\">0000000044</span>c1a93a000000000224a6b71641812254518111] </span><br><span class=\"line\">[MdcThreadPoolTaskExecutor-<span class=\"number\">2</span>][INFO][ffffffffd75119fd0000000030ef630d1641812254519101] <span class=\"number\">34</span></span><br><span class=\"line\">[MdcThreadPoolTaskExecutor-<span class=\"number\">3</span>][INFO][<span class=\"number\">0000000066</span>a8e5c8ffffffffd68aed601641812254519001] <span class=\"number\">35</span></span><br><span class=\"line\">[MdcThreadPoolTaskExecutor-<span class=\"number\">4</span>][INFO][<span class=\"number\">0000000066</span>ee68fdfffffffff577e4281641812254519111] <span class=\"number\">36</span></span><br><span class=\"line\">[MdcThreadPoolTaskExecutor-<span class=\"number\">3</span>][INFO][ffffffffa217a73300000000725bf6351641812254519000] <span class=\"number\">35</span></span><br><span class=\"line\">[MdcThreadPoolTaskExecutor-<span class=\"number\">5</span>][INFO][<span class=\"number\">00000000320</span>b6d0a000000003af12e701641812254519011] <span class=\"number\">37</span></span><br><span class=\"line\">[MdcThreadPoolTaskExecutor-<span class=\"number\">3</span>][INFO][<span class=\"number\">000000006</span>b4901b6ffffffffebbf10d91641812254519110] <span class=\"number\">35</span></span><br><span class=\"line\">[MdcThreadPoolTaskExecutor-<span class=\"number\">1</span>][INFO][<span class=\"number\">000000002</span>b61782800000000157d2c1e1641812254519100] <span class=\"number\">33</span></span><br><span class=\"line\">[MdcThreadPoolTaskExecutor-<span class=\"number\">5</span>][INFO][<span class=\"number\">00000000586</span>b86f7ffffffffc5581f661641812254520000] <span class=\"number\">37</span></span><br><span class=\"line\">[MdcThreadPoolTaskExecutor-<span class=\"number\">1</span>][INFO][ffffffff930e3437ffffffffa425c03b1641812254520011] <span class=\"number\">33</span></span><br><span class=\"line\">[MdcThreadPoolTaskExecutor-<span class=\"number\">2</span>][INFO][<span class=\"number\">000000001</span>a75d2e7fffffffff55857f91641812254520010] <span class=\"number\">34</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>成功防止异步操作丢失了log标记信息。</li>\n</ul>\n<h3 id=\"SpringAsync方法\"><a href=\"#SpringAsync方法\" class=\"headerlink\" title=\"SpringAsync方法\"></a>SpringAsync方法</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"> <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> AsyncTaskExecutor <span class=\"title\">taskExecutor</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ThreadPoolTaskExecutor executor =</span><br><span class=\"line\">          MdcThreadPoolTaskExecutor.newWithInheritedMdc(<span class=\"number\">8</span>, <span class=\"number\">32</span>, <span class=\"number\">2</span>, TimeUnit.MINUTES, <span class=\"number\">1000</span>, <span class=\"keyword\">new</span> ThreadPoolExecutor.AbortPolicy());</span><br><span class=\"line\">        executor.setThreadNamePrefix(<span class=\"string\">\"def-Executor \"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> executor;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppApplicationController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Async</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">index</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">\"index\"</span>);</span><br><span class=\"line\">        Map&lt;String, Object&gt; data = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        data.put(<span class=\"string\">\"code\"</span>, <span class=\"string\">\"200\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">[def-Executor <span class=\"number\">1</span>][INFO][ffffffffd62f558600000000385223a51641814195289011] index</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>还有其它场景的用法，比如内部服务调用的时候，就可以单独将数封住在请求中传递到下个服务，只需要在下一个服务中的拦截器中获取在设置到当前MDC中即可。</li>\n</ul>\n<h3 id=\"MDC源码\"><a href=\"#MDC源码\" class=\"headerlink\" title=\"MDC源码\"></a>MDC源码</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * As of SLF4J version 1.7.14, StaticMDCBinder classes shipping in various bindings</span></span><br><span class=\"line\"><span class=\"comment\"> * come with a getSingleton() method. Previously only a public field called SINGLETON </span></span><br><span class=\"line\"><span class=\"comment\"> * was available.</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> MDCAdapter</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> NoClassDefFoundError in case no binding is available</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 1.7.14</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> MDCAdapter <span class=\"title\">bwCompatibleGetMDCAdapterFromBinder</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> NoClassDefFoundError </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> StaticMDCBinder.getSingleton().getMDCA();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (NoSuchMethodError nsme) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// binding is probably a version of SLF4J older than 1.7.14</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> StaticMDCBinder.SINGLETON.getMDCA();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        mdcAdapter = bwCompatibleGetMDCAdapterFromBinder();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (NoClassDefFoundError ncde) &#123;</span><br><span class=\"line\">        mdcAdapter = <span class=\"keyword\">new</span> NOPMDCAdapter();</span><br><span class=\"line\">        String msg = ncde.getMessage();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (msg != <span class=\"keyword\">null</span> &amp;&amp; msg.contains(<span class=\"string\">\"StaticMDCBinder\"</span>)) &#123;</span><br><span class=\"line\">            Util.report(<span class=\"string\">\"Failed to load class \\\"org.slf4j.impl.StaticMDCBinder\\\".\"</span>);</span><br><span class=\"line\">            Util.report(<span class=\"string\">\"Defaulting to no-operation MDCAdapter implementation.\"</span>);</span><br><span class=\"line\">            Util.report(<span class=\"string\">\"See \"</span> + NO_STATIC_MDC_BINDER_URL + <span class=\"string\">\" for further details.\"</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> ncde;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// we should never get here</span></span><br><span class=\"line\">        Util.report(<span class=\"string\">\"MDC binding unsuccessful.\"</span>, e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Put a diagnostic context value (the &lt;code&gt;val&lt;/code&gt; parameter) as identified with the</span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;code&gt;key&lt;/code&gt; parameter into the current thread's diagnostic context map. The</span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;code&gt;key&lt;/code&gt; parameter cannot be null. The &lt;code&gt;val&lt;/code&gt; parameter</span></span><br><span class=\"line\"><span class=\"comment\"> * can be null only if the underlying implementation supports it.</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> * This method delegates all work to the MDC of the underlying logging system.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> key non-null key </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> val value to put in the map</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> IllegalArgumentException</span></span><br><span class=\"line\"><span class=\"comment\"> *           in case the \"key\" parameter is null</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">put</span><span class=\"params\">(String key, String val)</span> <span class=\"keyword\">throws</span> IllegalArgumentException </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (key == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">\"key parameter cannot be null\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mdcAdapter == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">\"MDCAdapter cannot be null. See also \"</span> + NULL_MDCA_URL);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    mdcAdapter.put(key, val);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>静态代码初始化mdcAdapter,mdcAdapter是个接口，可以理解为规范，会有不同的实现类。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220110190434.png\"></p>\n<ul>\n<li>项目中使用的是logback所以，实际使用的是LogbackMDCAdapter。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// The internal map is copied so as</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// We wish to avoid unnecessarily copying of the map. To ensure</span></span><br><span class=\"line\"> <span class=\"comment\">// efficient/timely copying, we have a variable keeping track of the last</span></span><br><span class=\"line\"> <span class=\"comment\">// operation. A copy is necessary on 'put' or 'remove' but only if the last</span></span><br><span class=\"line\"> <span class=\"comment\">// operation was a 'get'. Get operations never necessitate a copy nor</span></span><br><span class=\"line\"> <span class=\"comment\">// successive 'put/remove' operations, only a get followed by a 'put/remove'</span></span><br><span class=\"line\"> <span class=\"comment\">// requires copying the map.</span></span><br><span class=\"line\"> <span class=\"comment\">// See http://jira.qos.ch/browse/LOGBACK-620 for the original discussion.</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// We no longer use CopyOnInheritThreadLocal in order to solve LBCLASSIC-183</span></span><br><span class=\"line\"> <span class=\"comment\">// Initially the contents of the thread local in parent and child threads</span></span><br><span class=\"line\"> <span class=\"comment\">// reference the same map. However, as soon as a thread invokes the put()</span></span><br><span class=\"line\"> <span class=\"comment\">// method, the maps diverge as they should.</span></span><br><span class=\"line\"> <span class=\"keyword\">final</span> ThreadLocal&lt;Map&lt;String, String&gt;&gt; copyOnThreadLocal = <span class=\"keyword\">new</span> ThreadLocal&lt;Map&lt;String, String&gt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> WRITE_OPERATION = <span class=\"number\">1</span>;</span><br><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MAP_COPY_OPERATION = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// keeps track of the last operation performed</span></span><br><span class=\"line\"> <span class=\"keyword\">final</span> ThreadLocal&lt;Integer&gt; lastOperation = <span class=\"keyword\">new</span> ThreadLocal&lt;Integer&gt;();</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>真想大白，实际上维护了一个<code>ThreadLocal</code></p>\n</li>\n<li><p>这里需要注意有一个<code>NOPMDCAdapter</code> ，注意要是适配不支持上下文的日志系统。比如JDK14中的NOP。</p>\n</li>\n</ul>\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["Spring"],"tags":["SpringBoot","Spring","Mdc","Log"]},{"title":"学习技巧","url":"/posts/1183386531/","content":"<blockquote>\n<p>爱迪生说：“天才不过是一个经常能完成自己工作的聪明人而已。”我们不必做天才，优秀的人不过是一个经常能完成自己工作的普通人而已。</p>\n</blockquote>\n<h3 id=\"减少学习排斥心理\"><a href=\"#减少学习排斥心理\" class=\"headerlink\" title=\"减少学习排斥心理\"></a>减少学习排斥心理</h3><ol>\n<li>在学习过程中，可以穿插安排喜欢且擅长的环节。而不是死磕一个艰难的任务。<strong>艰难和轻松的任务穿插完成</strong>，避免过度负面情绪，让自己在学习和工作中保持愉悦和高效的方法。</li>\n<li>定制学习计划<ol>\n<li>定制学习OKR，不要指定完不成的任务。将任务具像化，人的大脑是善于遗忘的。让自己每天都能从学习上得到正面都反馈，拥有足够都收获感。</li>\n<li>人的大脑存在<strong>奖励系统</strong>，它更加愿意选择立刻就能得到的好处。避免每天同类型的学习任务，任务类型尽可能少安排。</li>\n<li>尝试让学习变得自发自觉，不要追求某种解决，而是专注与学习的本身。</li>\n<li>我们的大脑中存在<strong>场所神经元</strong>，<strong>环境的改变可以激发它的活性</strong>。</li>\n</ol>\n</li>\n<li>学习过程中，遭遇困难是很正常的事情。它是成长过程中的一部分。</li>\n</ol>\n<h3 id=\"伪勤奋\"><a href=\"#伪勤奋\" class=\"headerlink\" title=\"伪勤奋\"></a>伪勤奋</h3><ol>\n<li>学习是<strong>了解、记忆、应用、输出的过程</strong>，只有去完成感到需要思考、需要克服困难的任务，才能算真<strong>勤奋</strong>。</li>\n<li>学的东西，要立刻检验，检验自己有没有记住。要有输出和思考。</li>\n<li>观察、分析、试错、反思、调整、应用、总结。可以让学习到的知识能被掌握并应用，要知道自己是如何做到的。</li>\n<li>避免<strong>形式主义</strong>，很多事情动起来就能解决**80%**。</li>\n</ol>\n<a id=\"more\"></a>\n\n<h3 id=\"擅长考试\"><a href=\"#擅长考试\" class=\"headerlink\" title=\"擅长考试\"></a>擅长考试</h3><ol>\n<li>无论考试、还是面试都人生中不可避免都事情。但是学习和考试是两个思维，学习大多时候都是高密度都接受知识，而考试是输出。将知识点输出。</li>\n<li>需要明确知道自己需要回答什么问题，在学习的时候应该如何去思考、分析、记忆。有了预先的问题意思，学习的时候会更佳的专注，理解更为深刻。</li>\n<li><strong>即用即学</strong>与<strong>即学即用</strong>同样重要，有一种有效<strong>“检索式练习”</strong>，<strong>通过主动提问和主动会回想的方式，去巩固知识点，对自己学习的知识进行反馈测试。</strong></li>\n</ol>\n<h3 id=\"平常心\"><a href=\"#平常心\" class=\"headerlink\" title=\"平常心\"></a>平常心</h3><ol>\n<li><strong>在关键的时候用平常心去对待，当畏惧自己做的不好，担忧浪费时间、失败的结果，人就迷失了。</strong>在关键的时候暂时忘掉所有得失。</li>\n<li><strong>对于某一固定的学科或者领域，学习基本上是个匀加速或者变加速的过程，你的方法会逐渐完善，效率会逐步提高。</strong></li>\n</ol>\n<h3 id=\"专注力\"><a href=\"#专注力\" class=\"headerlink\" title=\"专注力\"></a>专注力</h3><ol>\n<li><strong>避免被动、机械的学习方法。合理的笔记，在过程中加入自己的思考</strong>。选择性去标记重点。</li>\n<li><strong>问题让人专注</strong>，在学习过程中，带着困惑去学习，让大脑快速的运转。人自然会变得专注。</li>\n<li>走神并不是一个问题，专注力需要去练习，“走神→重新专注→走神→重新专注”的过程，训练自己让自己<strong>重新专注</strong>。</li>\n<li>通过<strong>凝视某一个物体</strong>，也能让大脑快速的分泌<strong>专注力</strong>所需要的物质。</li>\n</ol>\n<h3 id=\"闭环\"><a href=\"#闭环\" class=\"headerlink\" title=\"闭环\"></a>闭环</h3><ol>\n<li>避免无效努力，总是重复的学习，浪费大量时间，只看书不做笔记，也不思考、不理解看过的东西自然容易被大脑忘记。所以我们需要<strong>把事情从头做到尾</strong>。做好每个环节，让学习复习的<strong>过程闭环</strong>。</li>\n<li><strong>学习与复习并行</strong>，通过重复强化训练。<strong>比如今天学习的知识，第二天就开始检测。</strong>人存在遗忘点，短时间不忘记，稍微温习就能达到较好的效果。</li>\n</ol>\n<h3 id=\"强化记忆\"><a href=\"#强化记忆\" class=\"headerlink\" title=\"强化记忆\"></a>强化记忆</h3><ol>\n<li>重复机械并不能强化记忆，<strong>要想记得快记得牢记得久，一定要经过充分的、有一定深度的加工，把“短时记忆”转化为“长时记忆”。“长时记忆”没有容量限制，保存时间也更为长久，可以长达数年甚至终身。</strong>比如教会其他人，用自己的话说出来。</li>\n</ol>\n<h3 id=\"主动思考\"><a href=\"#主动思考\" class=\"headerlink\" title=\"主动思考\"></a>主动思考</h3><ol>\n<li><strong>大脑不擅长记忆无意义的东西</strong>，<strong>组织知识点、结构化知识点。将知识串联起来。用自己的表示方式描述知识</strong>。每一次复习，都可以重新去组织表诉语言。</li>\n<li><strong>储备知识</strong>，有两种高效的方式，一种是<strong>结果导向式读书</strong>，<strong>一种是漫游式读书</strong>。围绕一个类型都知识点去阅读。</li>\n<li><strong>标记知识</strong>，阅读大量的内容时候，需要使用标记留下<strong>可供追溯的线索，就足够了。</strong>如果把“记忆”的环节放在阅读阶段，你会觉得很吃力，但放在“使用”阶段，你会轻松很多。</li>\n</ol>\n<h3 id=\"快速入门\"><a href=\"#快速入门\" class=\"headerlink\" title=\"快速入门\"></a>快速入门</h3><ol>\n<li>对于新的知识，建议阅读期间反复快速查看。让大脑快速<strong>建立索引</strong>，<strong>标记知识点。</strong>将相关的内容关联到一起去思考。</li>\n<li><strong>避免充足的时间</strong>，充足的时间很难提升效率，<strong>通过限定时间，让大脑主动去思考高效的方法。而非纠缠于细枝末节，用努力的幻象自欺欺人。</strong></li>\n<li><strong>先去抓核心、抓重点，先去完成，之后再去考虑完美。这是高效完成任务的重要诀窍。</strong></li>\n<li><strong>应用与输出，允许自己犯错，接受自己犯错。重要的是你要立刻开始输出。</strong></li>\n<li>持之以恒，知道的方法就是实践。</li>\n</ol>\n<h3 id=\"克服拖延症\"><a href=\"#克服拖延症\" class=\"headerlink\" title=\"克服拖延症\"></a>克服拖延症</h3><ol>\n<li>一般来说，我们在做事情之前，总是希望找到充分的理由和动力，说服自己去做。我们会觉得，“说服”是绕不过去的一步，不然没法开始。实际上这是一个死胡同。<strong>人在想的层面是无法解决问题的。真正影响行动的是开始做。</strong></li>\n<li><strong>“五分钟起步法”</strong>。<strong>开始做一件事的时候，先给自己 5 分钟的起步时间</strong>。在刚开始的能熬过前五分钟就能坚持下去。</li>\n<li><strong>尽量超前</strong>，走在计划的前面，给自己留下偷懒的资格和空间，当你相对拥有不做事的权利的时候，你才会更愿意追求主动做事。</li>\n<li><strong>替代拖延法</strong>，当任务很多的时候，时间不够用了。<strong>如果有一个更难的任务需要完成，我们就非常极其愿意去做相对简单的任务了。</strong></li>\n</ol>\n<h3 id=\"自律的人\"><a href=\"#自律的人\" class=\"headerlink\" title=\"自律的人\"></a>自律的人</h3><ol>\n<li><strong>真正的自律，它是指从“不自律”的念头中，约束自己的能力。</strong>一个能长时间专注学习的人，不是可以一直学下去，而是每一次不想学的时候，都做到了重新投入。<strong>其实，我们是在一种痛苦与另一种痛苦之间做选择。</strong>我们无从逃避，我们必须经受痛苦。<strong>当你接受了这个设定，事情突然简单起来了。</strong></li>\n<li><strong>自律的前提，是有一个隐形的外部约束。</strong>给自己一个限定，<strong>它可以在任何时刻，推动我们进入正轨。</strong></li>\n</ol>\n<h3 id=\"学习环境\"><a href=\"#学习环境\" class=\"headerlink\" title=\"学习环境\"></a>学习环境</h3><ol>\n<li><strong>找到一个学习的榜样，一个学习的环境</strong>。这时候存在一种<strong>“社会助长效应”</strong>，与其他人共同学习的时候，能提高学习的效率。</li>\n<li><strong>行动的惯性。当更自由的时候，要付出同等甚至更多的自律</strong>。让自己养成一种习惯，推动自己行动的习惯。让手机、电脑成为一种工具，而不是去沉迷它们。“维持这种惯性”。<strong>有节奏的去适应</strong>，第一步应该是适中的，方面切入理解的。避免<strong>劝退</strong>。将任务拆分到时间快中，连续做完。比如使用<strong>“番茄时间法”</strong>。</li>\n<li><strong>与其控制自己，不如控制环境。</strong>比如玩手机停不下来是我们的天性，而不是因为自制力不足。在网络中满足了我们对新鲜信息的需求。</li>\n<li>有时候确实难以完成任务，我们要接受自己。不要过于苛责自己。<strong>尝试有效的解压</strong>，方法包括：锻炼或者参加体育活动、阅读、听音乐、与家人朋友相处、外出散步、冥想，以及培养有创意的爱好。</li>\n</ol>\n<h3 id=\"时间管理\"><a href=\"#时间管理\" class=\"headerlink\" title=\"时间管理\"></a>时间管理</h3><ol>\n<li><p><strong>合理地制订计划</strong>，计划应该是具体的，<strong>包括任务内容，以及时间、频率的具体。</strong>只有具体的计划，才有被执行的可能性。</p>\n</li>\n<li><p><strong>计划可以衡量</strong>，“可衡量”不是为了束缚住自己，而是为了有一个标准可以参考，对自己做某件事的速度和效率，有直观的了解，方便对做事的方法进行优化。</p>\n</li>\n<li><p><strong>有效的计划</strong>，那些过于宏伟、不切实际的计划，会让人觉得焦虑。在开始做之前，容易因为畏惧而拖延；而完不成的时侯，挫败感会很强烈，进而影响对自己的评价和认知。<strong>计划和你的大目标要有一定的相关性</strong>。</p>\n</li>\n<li><p><strong>计划截止时间</strong>，毕竟截止期限（deadline）是第一生产力，没有时间约束的计划，大概率很难会积极执行。</p>\n</li>\n<li><p><strong>“倒数日”\\</strong>的思维，我们总是制订长期的计划。但是长期的计划大多时候难以执行，所以我们可以换一种方式。只**规划今天<strong>，明天要干啥，明天再说。无论今天表现如何，都完全不影响明天。你可以在新的一天，重整旗鼓。</strong>长远计划只要清楚大致方向和内容就好了，完全不必很详细。**</p>\n</li>\n<li><p><strong>按照 SMART 原则制订计划</strong>，计划应该是具体的，包括任务内容、时间、频率的具体，要认真想清楚，自己要做什么、怎么做以及做到怎样。只有足够具体的计划，才有被执行的可能性。</p>\n</li>\n<li><p><strong>我们在执行计划时，做的最不切实际的假设就是：以为自己能在指定的时间内完成指定的任务。</strong>实际上结果总是充满了变数，<strong>事情该花多少时间，就应该花多少时间。而不应该是，我想让它花多少时间，它就只能花多少时间。</strong></p>\n</li>\n<li><p><strong>todolist</strong>，每天今天要做的事情，都写出具体的条目，列在一个清单里。只要写下来就好，不用排优先级，也不用给它们固定具体的时间。选一个眼下最为重要且紧急的任务，开始执行，并且记录开始的时间。<strong>大致知道自己要做哪些事情，并且理清大致的顺序，然后直接开始做，一件接一件，专注完成。</strong></p>\n</li>\n<li><p><strong>计划，是工具，是手段，是为我们服务的</strong>，保证我们知道自己在什么时间段，该做什么，按照怎样的顺序去做。而我们，常常把计划以及执行计划，错当成了目的本身。</p>\n</li>\n<li><p><strong>计划让自己大致知道自己要做哪些事情，并且理清大致的顺序，然后直接开始做，一件接一件，专注完成。专注于眼前那个看得到的目标的时候，我们的压力是很小的，有足够的动力和信心去完成。而完成小目标的那一瞬间，又会给予我们解脱和放松的感觉，进而继续奔赴下一个小目标。</strong>单单是“完成感”，就已经可以激励我们去做事了。</p>\n</li>\n<li><p><strong>能够真正提高效率、把事情做到极致的手段，是制定“小目标”。这会让你更容易坚持下去，因为在努力的过程中，你总是即刻就能看到成果，看到自己的进步。</strong></p>\n</li>\n<li><p><strong>把努力的过程，转变为一场又一场的短跑。</strong></p>\n<blockquote>\n<p>短跑观意味着：当你学习或工作 90~120 分钟后，你应该休息 15 分钟。过多的精力消耗和过度恢复都是不好的。每天的学习或工作模式，应该是一个钟摆式运动：按照一定的周期消耗和补充精力。（《精力管理》）</p>\n</blockquote>\n</li>\n<li><p><strong>冥想，</strong>冥想可以让你迅速恢复精力，也可以让你的情绪保持平静，坚持一段时间，甚至能够缓解焦虑，而且可以有效提升你的专注力。</p>\n<blockquote>\n<p>冥想的具体做法是：闭上眼睛，全身放松，把注意力集中于呼吸上面，深深地、静静地、缓缓地呼吸，只关注自己的每一次呼气和吸气。</p>\n</blockquote>\n</li>\n<li><p><strong>做不同的事情</strong>，交换使用你大脑的不同区域，也可以实现高效做事。<strong>散步、听音乐、午休、和朋友面对面聊天，都是有效的休息方式。</strong>我们应该按照做事 - 恢复 - 做事 - 恢复的模式，去学习和工作。但这是不够的，15 分钟的休息只是小打小闹，我们的大脑，总体上还是处于亢奋的工作状态。<strong>那些既成功又快乐幸福的人，也是会感受到压力的，然而他们很注重恢复。“休息是必要的投资，有助于更高效地学习“。</strong></p>\n</li>\n<li><p><strong>酝酿效应</strong>,当你暂时完成今天的任务后，还请留出时间，什么都不要想，让大脑充分休息。其它没解决的事情，留给明天去做。</p>\n<blockquote>\n<p>休息对于创造力是非常重要的。我们认为如果只是坐着什么事也不干，我们就确实什么事也没干。但不是的，思想在工作，并且思想需要这样，才能获得顿悟。我们常常一觉醒来就能想到解决办法，这并非巧合，因为潜意识正在活动。（哈佛大学教授 Tal）</p>\n</blockquote>\n</li>\n<li><p><strong>专注很重要，但休息和放松的重要性是同等的。</strong>学习时候的状态分为专注模式和发散模式，前者是指专心死磕没有解决的问题；而发散模式是指，遇到难题，实在想不出思路时，可以试着散步或运动，让大脑得到放松，任由思维漫步。松弛状态可以让大脑的不同区域得到相互联络的机会，并反馈给我们宝贵的灵感。</p>\n</li>\n</ol>\n<h3 id=\"知识储备\"><a href=\"#知识储备\" class=\"headerlink\" title=\"知识储备\"></a>知识储备</h3><ol>\n<li><strong>你懂得越多，你学得越快。</strong>当你的知识储备很少时，你学任何东西，都需要从最基础的地方开始。对内容和思维方式，一点点地了解、熟悉、思考。</li>\n<li><strong>学习和记忆的本质，就是把新知识与旧知识建立联系，你存储的旧知识容量越大、种类越多，就越能随时找到与新知识之间的联系，越能更快更好地学习。</strong></li>\n<li><strong>能力储备也是很重要</strong>，每个人的知识储备和能力水平，在启动之初，相差不会特别大。但在之后每个需要调取知识和运用能力的场合，它们都会在实践中得到升级。这是一个加速的过程。就像是理财领域的“复利”效应，你的每一次练习，都会积累成你的本金。</li>\n<li><strong>越早付出努力，你在之后的人生中，达成目的的速度越快、效率越高。</strong>人和人，向来都不是在一个起点上进行努力的。优秀和不优秀，是马太效应，富者愈富，穷者愈穷。一开始跟不上，后面更可能发生的是，你只会愈来愈跟不上。但也不必妄自菲薄，就从现在开始吧。</li>\n<li><strong>种一棵树最好的时间是十年前，其次是现在。</strong></li>\n</ol>\n<h3 id=\"相信努力\"><a href=\"#相信努力\" class=\"headerlink\" title=\"相信努力\"></a>相信努力</h3><ol>\n<li>因为我“努力认真”，我才做到了这件事；如果目前还没成功，是因为我还没足够努力认真。在遇到困难时，TA 会想着靠更多的“努力认真”去解决问题，而很少会因为对自己的怀疑而放弃。</li>\n</ol>\n<h3 id=\"刻意练习\"><a href=\"#刻意练习\" class=\"headerlink\" title=\"刻意练习\"></a>刻意练习</h3><ol>\n<li>智能是可以改变的，我们可以提高智能。高效的刻意练习，可以让我们变得更聪明。<ol>\n<li>目标要明确。</li>\n<li>做事时需要极其专注。</li>\n<li>需要及时看到反馈，并进行调整。比输入更重要的，是输出；用输出，来指导自己如何输入。</li>\n<li>走出舒适区。</li>\n<li>坚信<strong>成长型思维</strong>。</li>\n</ol>\n</li>\n<li><strong>惯性的力量</strong>，会使这一选择不断自我强化，并让你轻易走不出去。<strong>如果我们想做一件事，关于这件事的一切知识储备是必要条件，但并不充分。我们需要学会调取，也就是学会利用知识储备。</strong>但这也是不够的，<strong>需要我们以不同的方式，去调取和运用知识点。</strong></li>\n<li><strong>“双加工理论”</strong>，人类的认知加工包括“自动化加工”和“受意识控制的加工”，前者是指，我们已经积累了某一行为模式的大量练习的经验，每一个具体的步骤，以及注意事项，已经内化为我们近乎无意识的动作，比如走路、吃饭、系鞋带、骑自行车、跑步、打字等等。<strong>只要我们积累了大量的练习，“受意识控制的加工”可以转变为“自动化加工”。</strong></li>\n<li><strong>对于学习来说，做到理解并且会用，是一回事；但，熟练是另外一回事。只有通过练习，做到熟练，你才能进行下一个层次的事情，那意味着，你做题的速度更快、准确度更高。</strong></li>\n</ol>\n<h3 id=\"行动起来\"><a href=\"#行动起来\" class=\"headerlink\" title=\"行动起来\"></a>行动起来</h3><blockquote>\n<p>why-how-what，理念-逻辑-知识，这就是知识的黄金圆环。</p>\n</blockquote>\n<ol>\n<li>不要在方法论上花太多时间，<strong>任何一份工作，它的大部分内容，都是很琐碎很机械的，创造力当然也重要，但创造力永远只占极少极少的一部分。</strong></li>\n<li><strong>学习是有方法的，按照正确的方法练习</strong>。</li>\n</ol>\n<h4 id=\"勇气\"><a href=\"#勇气\" class=\"headerlink\" title=\"勇气\"></a>勇气</h4><ul>\n<li>爱情没了可以再处。</li>\n<li>朋友没了可以再交。</li>\n<li>工作没了可以在找。</li>\n<li>钱没了可以再赚。</li>\n<li>你要记住其实你什么都不缺，人生随时可有可无。</li>\n<li>只是缺一份重新开始的勇气。</li>\n</ul>\n<h4 id=\"面对焦虑\"><a href=\"#面对焦虑\" class=\"headerlink\" title=\"面对焦虑\"></a>面对焦虑</h4><blockquote>\n<p>随着年龄不断提升,生活和未来带来的焦虑。让自己难以招架，这个年龄在来改变自己晚吗？其实不晚。</p>\n</blockquote>\n<ul>\n<li><p>面对焦虑最好的办法就是改变自己，不断提升自己。让自己过的充实。</p>\n</li>\n<li><p>工业化的社会，拥有的自由时间应该是用来提升自己的。而不是一味的娱乐。</p>\n</li>\n<li><p>改变自己、提升自己。让自己的生活变得充实健康。不努力只会和那些正在努力的人差距只会只会越来越大。最终可能完全丧失竞争力。</p>\n</li>\n</ul>\n<h4 id=\"尝试计划\"><a href=\"#尝试计划\" class=\"headerlink\" title=\"尝试计划\"></a>尝试计划</h4><blockquote>\n<p>尝试和自己斗智斗勇，如果想要改变自己首先要能约束自己。让自己的行为按照自己预期的方向前进。</p>\n</blockquote>\n<ul>\n<li><p>尝试对每天的事情，进行一个安排。</p>\n</li>\n<li><p>尝试对每天安排的事情，逐个完成。</p>\n</li>\n<li><p>根据自己当前的情况调整安排的计划，让计划和生活更加协调。</p>\n</li>\n<li><p>细化计划内容，让大脑习惯这种方式。</p>\n</li>\n</ul>\n<h4 id=\"高效习惯\"><a href=\"#高效习惯\" class=\"headerlink\" title=\"高效习惯\"></a>高效习惯</h4><blockquote>\n<p>尝试更加高效的生活，而不是让自己的生活一味的随心所欲。去思考去实践，让生活更加高效有趣。</p>\n</blockquote>\n<ul>\n<li>生活的琐事上，会消耗的大量的时间。高效简洁的处理，让自己的可以掌控时间增加。</li>\n<li>科学、健康、合理的安排的自己的时间。计划永远赶不上变化，适当调整计划，保持住一个合理的时间安排。</li>\n</ul>\n<h4 id=\"养成习惯\"><a href=\"#养成习惯\" class=\"headerlink\" title=\"养成习惯\"></a>养成习惯</h4><blockquote>\n<p>养成好的习惯终生适用。</p>\n</blockquote>\n<ul>\n<li>我们的大脑是有非常强的可塑性，通过刻意的练习锻炼大脑。</li>\n</ul>\n<h4 id=\"了解真实的自己\"><a href=\"#了解真实的自己\" class=\"headerlink\" title=\"了解真实的自己\"></a>了解真实的自己</h4><blockquote>\n<p>自己从小到大都不是一个学习好的孩子，但是从来不觉得自己的智商差。但是自己的学习方式或者说学习思维确实一点都没养成。</p>\n</blockquote>\n<ul>\n<li><p>逐步改变自己之前，需要对自己的情况进行一个了解。近几天都在看关于学习相关的资料和视频。今天突然发现一个特别有趣的话<code>间歇性踌躇满志，持续性混吃等死</code>，感觉这就是我十多年来对学习这会事态度的完美诠释。更可怕的是这大概是我早期应对焦虑的手段之一。</p>\n</li>\n<li><p>根据自己当前的实际情况，分析整理专业知识。整理自己的时间，对于时间这个事情。这是世上对所有人都公平的事情，所以如何根据自己的情况合理分配时间至关重要。</p>\n</li>\n<li><p>整理需要掌握的知识方向，归纳需要掌握的知识点。优先改善自己的学习思维，刻意有目标的去学习。</p>\n</li>\n<li><p>冲动性学习很难长久，所以需要对自己更为了解才行。</p>\n</li>\n</ul>\n<h4 id=\"通过各种途径去了解自己\"><a href=\"#通过各种途径去了解自己\" class=\"headerlink\" title=\"通过各种途径去了解自己\"></a>通过各种途径去了解自己</h4><blockquote>\n<p>了解自己是一个漫长的过程，自律是漫长的。每个人的坚持的方法都不一样，自律就是对自己不满意。对现实不满意，才会让自己努力去改变自己。</p>\n</blockquote>\n<ul>\n<li><a href=\"https://www.apesk.com/mbti/dati.asp\" target=\"_blank\" rel=\"noopener\">mbti测试</a> 这是非常权威的心理测试。</li>\n<li>每个人坚持的方法都不一样，比如背单词的app每天打卡，或者番茄工作法。寻找自己的坚持点非常重要，如果不能找到自己的坚持点，大多情况下都会所谓的坚持都只会仓促结束。</li>\n</ul>\n<h4 id=\"让自己更加优秀\"><a href=\"#让自己更加优秀\" class=\"headerlink\" title=\"让自己更加优秀\"></a>让自己更加优秀</h4><ol>\n<li><strong>理解和接受自己会犯错误。</strong>关键是要尽早发现，在错误进入到最终产品前发现它们。幸运的是，除了我们少数几个在喷气推进实验所开发火箭导航系统的人外，在软件行业中犯错误通常不会导致灾难性事故。我们可以，也应该从错误中吸取教训，微笑，并继续前进。</li>\n<li><strong>你不是你的代码。</strong>记住代码审查的全部目的就是去发现问题，相信问题会被我们发现。当有问题疏漏时不要自责。</li>\n<li><strong>不管你对“空手道”有多了解，一定会有人知道的更多。</strong>如果你去问，这样的人可以告诉你一些新的招数。从别人那里寻找和接受新的知识，特别是那些你认为不需要的知识。</li>\n<li><strong>不要在没有讨论的情况下重写代码。</strong>在“调整代码”和“重写代码”之间有一条很细致的界限，你应该在代码审查的制度下做风格上的调整，不要独断专行。</li>\n<li><strong>对那些不如你的人要尊敬，礼遇，有耐心。</strong>经常跟开发人员打交道的非技术人士通常持有这样的观点：程序员凭借一技之长狂放不羁。不要让你的发怒和缺乏耐性让他们心中的这种形象加深。</li>\n<li><strong>这世界上唯一不变的就是变化。</strong>开放思考，面带微笑的接受它。把需求上、平台或工具里的每个改变都视作一种新的挑战，而不是把它们当作大麻烦来抵制。</li>\n<li><strong>真正的权威来自知识，而不是职位。</strong>知识造就权威，权威带来尊敬——所以，如果你想在一个无私的环境中获得尊敬，去培养自己的知识吧。</li>\n<li><strong>为信仰奋斗，但我文雅的接受失败。</strong>要理解，有时候你的想法会被拒绝。即使你是对的，你也不要报复或说“I told you so.”千万不要让你心爱的被抛弃的想法变成殉道者或抱怨素材。</li>\n<li><strong>不要成为“角落里的程序员。”</strong>不要成为隐藏在黑暗办公室里、只因为口渴才出现的人。藏在角落的里程序员短视、与世隔绝、不受控制。这样的人在公开的、合作的工作环境中发不出声音。参与到交流中，成为你的办公室团体中的一员。</li>\n<li><strong>批评代码而不是人——对编码人友善，但不要对代码友善。</strong>尽可能的让你的批评具有积极性，以改进代码为目标。批评要联系本地标准，编程规格文档和提高后的性能等。</li>\n</ol>\n","categories":["学习"],"tags":["学习技巧"]},{"title":"Docker-Compose-SpringBoot-Mysql-Redis","url":"/posts/2694709029/","content":"<blockquote>\n<p>在Java的技术栈中可以使用maven插件来构建docker镜像，用起来没有docker-compose好用。</p>\n</blockquote>\n<h3 id=\"实现目标\"><a href=\"#实现目标\" class=\"headerlink\" title=\"实现目标\"></a>实现目标</h3><ol>\n<li>spring boot 、mysql 、redis 定义正常运行。</li>\n<li>解决docker compose 启动顺序问题。</li>\n<li>解决配置文件读取其它容器ip问题。</li>\n</ol>\n<h2 id=\"源码地址\"><a href=\"#源码地址\" class=\"headerlink\" title=\"源码地址\"></a><a href=\"https://github.com/z201/code-example/tree/main/Docker-Compose-SpringBoot-Mysql-Redis\" target=\"_blank\" rel=\"noopener\">源码地址</a></h2><h3 id=\"演示效果\"><a href=\"#演示效果\" class=\"headerlink\" title=\"演示效果\"></a>演示效果</h3><h4 id=\"docker运行情况\"><a href=\"#docker运行情况\" class=\"headerlink\" title=\"docker运行情况\"></a>docker运行情况</h4><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220107221150.png\"></p>\n<h4 id=\"spring-boot运行情况\"><a href=\"#spring-boot运行情况\" class=\"headerlink\" title=\"spring boot运行情况\"></a>spring boot运行情况</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">➜  docker-run curl http://127.0.0.1:9000/docker/</span><br><span class=\"line\">&#123;<span class=\"string\">\"code\"</span>:<span class=\"string\">\"200\"</span>,<span class=\"string\">\"data\"</span>:<span class=\"string\">\"[information_schema, docker_app_1, mysql, performance_schema, sys]\"</span>,<span class=\"string\">\"cache\"</span>:&#123;<span class=\"string\">\"redis_version\"</span>: <span class=\"string\">\"5.0.5\"</span>&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"构建项目\"><a href=\"#构建项目\" class=\"headerlink\" title=\"构建项目\"></a>构建项目</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">.</span><br><span class=\"line\">├── Dockerfile <span class=\"comment\"># Dockerfile</span></span><br><span class=\"line\">├── docker-compose.yml <span class=\"comment\"># docker-compose文件</span></span><br><span class=\"line\">├── docker-config <span class=\"comment\"># docekr配置文件</span></span><br><span class=\"line\">│   ├── mysql</span><br><span class=\"line\">│   │   ├── init</span><br><span class=\"line\">│   │   │   └── 1_init.sql <span class=\"comment\"># mysql数据库初始化文件</span></span><br><span class=\"line\">│   │   └── my.cnf <span class=\"comment\"># mysql 配置文件</span></span><br><span class=\"line\">│   ├── pwd.txt </span><br><span class=\"line\">│   └── redis </span><br><span class=\"line\">│       └── redis.conf <span class=\"comment\"># redis 配置文件</span></span><br><span class=\"line\">├── pom.xml <span class=\"comment\"># java maven 项目依赖</span></span><br><span class=\"line\">├── src</span><br><span class=\"line\">│   ├── main</span><br><span class=\"line\">│   │   ├── java</span><br><span class=\"line\">│   │   │   └── cn</span><br><span class=\"line\">│   │   │       └── z201</span><br><span class=\"line\">│   │   │           └── docker</span><br><span class=\"line\">│   │   │               ├── AppApplication.java <span class=\"comment\"># spring boot 启动类</span></span><br><span class=\"line\">│   │   │               └── AppApplicationController.java <span class=\"comment\"># demo接口类</span></span><br><span class=\"line\">│   │   └── resources</span><br><span class=\"line\">│   │       ├── application-dev.yml <span class=\"comment\"># dev环境下配置文件</span></span><br><span class=\"line\">│   │       ├── application-test.yml <span class=\"comment\"># test环境下配置文件</span></span><br><span class=\"line\">│   │       ├── application.yml <span class=\"comment\"># spring boot 配置文件</span></span><br><span class=\"line\">│   │       └── logback.xml <span class=\"comment\"># 日志输出文件</span></span><br><span class=\"line\">│   └── <span class=\"built_in\">test</span></span><br><span class=\"line\">│       └── java</span><br><span class=\"line\">└── target</span><br><span class=\"line\">    ├── Docker-Compose-SpringBoot-Mysql-Redis-1.0.0-SNAPSHOT.jar <span class=\"comment\"># mvn install 构建多产物</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"spring-boot-项目\"><a href=\"#spring-boot-项目\" class=\"headerlink\" title=\"spring boot 项目\"></a>spring boot 项目</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.docker;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppApplicationController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> JdbcTemplate jdbcTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">index</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        List&lt;String&gt; dataBasesList = jdbcTemplate.queryForList(<span class=\"string\">\"SHOW  DATABASES\"</span>, String<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">        Properties info =  redisTemplate.getConnectionFactory().getConnection().info();</span><br><span class=\"line\">        Map&lt;String, Object&gt; data = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        data.put(<span class=\"string\">\"code\"</span>, <span class=\"string\">\"200\"</span>);</span><br><span class=\"line\">        data.put(<span class=\"string\">\"db\"</span>, dataBasesList.toString());</span><br><span class=\"line\">        data.put(<span class=\"string\">\"cache\"</span>, info);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.docker;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.SpringApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.ApplicationContext;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppApplication</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        ApplicationContext applicationContext = SpringApplication.run(AppApplication<span class=\"class\">.<span class=\"keyword\">class</span>, <span class=\"title\">args</span>)</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置文件</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">application:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">spring-boot-mysql-redis</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">active:</span> <span class=\"string\">dev</span></span><br><span class=\"line\">  <span class=\"attr\">mvc:</span></span><br><span class=\"line\">    <span class=\"attr\">throw-exception-if-no-handler-found:</span> <span class=\"literal\">true</span> <span class=\"comment\"># 处理404</span></span><br><span class=\"line\">  <span class=\"attr\">web:</span></span><br><span class=\"line\">    <span class=\"attr\">resources:</span></span><br><span class=\"line\">      <span class=\"attr\">add-mappings:</span> <span class=\"literal\">false</span> <span class=\"comment\"># 关闭资源映射</span></span><br><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">9000</span></span><br><span class=\"line\">  <span class=\"attr\">servlet:</span></span><br><span class=\"line\">    <span class=\"attr\">context-path:</span> <span class=\"string\">/docker</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">logging:</span></span><br><span class=\"line\">  <span class=\"attr\">config:</span> <span class=\"string\">classpath:logback.xml</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>test</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://mysql:3306/docker_app_1?useSSL=false&amp;useUnicode=true&amp;autoReconnect=true&amp;failOverReadOnly=false&amp;characterEncoding=utf-8</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">driver-class-name:</span> <span class=\"string\">com.mysql.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">com.zaxxer.hikari.HikariDataSource</span></span><br><span class=\"line\">    <span class=\"attr\">hikari:</span> <span class=\"comment\"># https://github.com/brettwooldridge/HikariCP (uses milliseconds for all time values)</span></span><br><span class=\"line\">      <span class=\"attr\">maximumPoolSize:</span> <span class=\"number\">20</span> <span class=\"comment\"># 连接池最大连接数，默认是10</span></span><br><span class=\"line\">      <span class=\"attr\">minimumIdle:</span> <span class=\"number\">5</span>  <span class=\"comment\"># 最小空闲连接数量</span></span><br><span class=\"line\">      <span class=\"attr\">idleTimeout:</span> <span class=\"number\">600000</span> <span class=\"comment\"># 空闲连接存活最大时间，默认600000（10分钟）</span></span><br><span class=\"line\">      <span class=\"attr\">connectionTimeout:</span> <span class=\"number\">30000</span> <span class=\"comment\"># 数据库连接超时时间,默认30秒，即30000</span></span><br><span class=\"line\">      <span class=\"attr\">maxLifetime:</span> <span class=\"number\">1800000</span> <span class=\"comment\"># 此属性控制池中连接的最长生命周期，值0表示无限生命周期，默认1800000即30分钟</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">host:</span> <span class=\"string\">redis</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">6379</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">database:</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"attr\">lettuce:</span></span><br><span class=\"line\">      <span class=\"attr\">pool:</span></span><br><span class=\"line\">        <span class=\"attr\">max-active:</span> <span class=\"number\">8</span> <span class=\"comment\"># 连接池最大连接数（使用负值表示没有限制）</span></span><br><span class=\"line\">        <span class=\"attr\">max-wait:</span> <span class=\"number\">2000</span> <span class=\"comment\"># 连接池最大阻塞等待时间（使用负值表示没有限制）</span></span><br><span class=\"line\">        <span class=\"attr\">min-idle:</span> <span class=\"number\">0</span> <span class=\"comment\"># 连接池中的最小空闲连接</span></span><br><span class=\"line\">        <span class=\"attr\">max-idle:</span> <span class=\"number\">8</span> <span class=\"comment\"># 连接池中的最大空闲连接</span></span><br><span class=\"line\">      <span class=\"attr\">shutdown-timeout:</span> <span class=\"number\">100</span> <span class=\"comment\"># 关闭超时时间</span></span><br><span class=\"line\">    <span class=\"attr\">timeout:</span> <span class=\"string\">60s</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>这里需要注意在mysql和redis连接上并没有写ip而是docker容器互联的功能，在同一个网桥中使用links互通多个容器的网络。</p>\n</li>\n<li><p>dev的环境都是本地环境，可以自己搭建mysql、redis环境。</p>\n</li>\n</ul>\n<h4 id=\"docket-compose配置文件\"><a href=\"#docket-compose配置文件\" class=\"headerlink\" title=\"docket-compose配置文件\"></a>docket-compose配置文件</h4><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version :</span> <span class=\"string\">'3'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">network-docker-app:</span></span><br><span class=\"line\">    <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">web:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">cn.z201.docker-app</span></span><br><span class=\"line\">    <span class=\"attr\">build:</span></span><br><span class=\"line\">      <span class=\"attr\">context:</span> <span class=\"string\">.</span></span><br><span class=\"line\">      <span class=\"attr\">dockerfile:</span> <span class=\"string\">.</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">cn.z201.docker-app-3</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">network-docker-app</span></span><br><span class=\"line\">    <span class=\"attr\">expose:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'9000'</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'9000:9000'</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span> <span class=\"comment\"># 等待其它服务启动完成</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">mysql</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis</span></span><br><span class=\"line\">    <span class=\"attr\">links:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">mysql</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis</span></span><br><span class=\"line\">  <span class=\"attr\">mysql:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">mysql:5.7</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">mysql5.7-dev-3</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">network-docker-app</span></span><br><span class=\"line\">    <span class=\"attr\">expose:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'3306'</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'3306:3306'</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./docker-config/mysql/my.cnf:/etc/mysql/my.cnf</span> <span class=\"comment\"># 映射数据库配置文件</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./docker-config/mysql/init:/docker-entrypoint-initdb.d</span> <span class=\"comment\"># 初始化数据库</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">[</span></span><br><span class=\"line\">      <span class=\"string\">'--character-set-server=utf8mb4'</span><span class=\"string\">,</span></span><br><span class=\"line\">      <span class=\"string\">'--collation-server=utf8mb4_unicode_ci'</span><span class=\"string\">,</span></span><br><span class=\"line\">      <span class=\"string\">'--lower_case_table_names=1'</span><span class=\"string\">,</span></span><br><span class=\"line\">      <span class=\"string\">'--default-time-zone=+8:00'</span><span class=\"string\">]</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_ROOT_PASSWORD=root</span> <span class=\"comment\"># 设置root密码</span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> <span class=\"string\">\"/bin/netstat -anpt|grep 3306\"</span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">3s</span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">redis:5.0.5</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">redis5.0.6-dev-3</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">network-docker-app</span></span><br><span class=\"line\">    <span class=\"attr\">expose:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'6379'</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'6379:6379'</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./docker-config/redis/redis.conf:/etc/redis.conf</span> <span class=\"comment\"># 映射数据库配置文件</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">redis-server</span> <span class=\"string\">/etc/redis.conf</span> <span class=\"comment\"># 启动redis命令</span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> <span class=\"string\">\"/bin/netstat -anpt|grep 6379\"</span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">3s</span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["Docker"],"tags":["Mysql","Redis","Docker","SpringBoot"]},{"title":"Docker-Compose-Redis-Sentinel","url":"/posts/2018531175/","content":"<blockquote>\n<p>上次编写了Docker-Compose-Redis-Master-Slave的文档，完成了简单的主从配置。这次在上次的基础上增加哨兵监控。</p>\n</blockquote>\n<p><a href=\"https://github.com/z201/code-example/tree/main/Docker-Compose-Redis-Sentinel\" target=\"_blank\" rel=\"noopener\">源码地址</a></p>\n<h3 id=\"编写docker-compose配置文件\"><a href=\"#编写docker-compose配置文件\" class=\"headerlink\" title=\"编写docker-compose配置文件\"></a>编写docker-compose配置文件</h3><ul>\n<li>这里和上次的使用同一个网桥</li>\n<li>Docker-compose 文件和 sentinel配置文件放在同一个目录下。</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version :</span> <span class=\"string\">'3'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">network-redis:</span></span><br><span class=\"line\">    <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">sentinel1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">redis:5.0.5</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">redis5.0.6-sentinel-1</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">network-redis</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'26379:26379'</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">redis-sentinel</span> <span class=\"string\">/usr/local/etc/redis/sentinel.conf</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./sentinel.conf:/usr/local/etc/redis/sentinel.conf</span></span><br><span class=\"line\">  <span class=\"attr\">sentinel2:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">redis:5.0.5</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">redis5.0.6-sentinel-2</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">network-redis</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'26380:26379'</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">redis-sentinel</span> <span class=\"string\">/usr/local/etc/redis/sentinel.conf</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./sentinel1.conf:/usr/local/etc/redis/sentinel.conf</span></span><br><span class=\"line\">  <span class=\"attr\">sentinel3:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">redis:5.0.5</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">redis5.0.6-sentinel-3</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">network-redis</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'26381:26379'</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">redis-sentinel</span> <span class=\"string\">/usr/local/etc/redis/sentinel.conf</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./sentinel2.conf:/usr/local/etc/redis/sentinel.conf</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>编写sentinel配置文件，</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">port 26379</span><br><span class=\"line\">sentinel deny-scripts-reconfig yes</span><br><span class=\"line\">sentinel monitor mymaster 172.21.0.2 6379 2</span><br><span class=\"line\">sentinel auth-pass mymaster redis_pwd</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p><code>port</code> 这里使用了三个哨兵,端口号需要单独设置 <code>26379 26380 26381</code> 并且复制出三份。按照要求修改端口号信息。</p>\n</li>\n<li><p><code>sentinel monitor mymaster 172.21.0.2 6379 1</code> </p>\n<ul>\n<li>master-name 表示给监视的主节点起一个名称；</li>\n<li>ip 表示主节点的 IP；这个ip填写正确这里docker演示使用<code>docker inspect  [id] </code>查看master ip</li>\n<li>port 表示主节点的端口；</li>\n<li>quorum 表示确认主节点下线的 Sentinel 数量，如果 quorum 设置为 1 表示只要有一台 Sentinel 判断它下线了，就可以确认它真的下线了。</li>\n</ul>\n</li>\n<li><p><code>sentinel auth-pass mymaster redis_pwd</code> </p>\n<ul>\n<li>所以如果 Redis 有密码，也需要设置。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">cp sentinel.conf sentinel1.conf</span><br><span class=\"line\">cp sentinel.conf sentinel2.conf</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"启动检查\"><a href=\"#启动检查\" class=\"headerlink\" title=\"启动检查\"></a>启动检查</h3><ul>\n<li>启动docker-compose文件</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker-compose -f docker-sentinel-compose.yml up -d</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220107003131.png\"></p>\n<ul>\n<li>进入sentinel容器检查</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker -it [id]</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>进入sentinel</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">redis-cli -p 26379</span><br><span class=\"line\">127.0.0.1:26379&gt; sentinel master mymaster</span><br><span class=\"line\"> 1) <span class=\"string\">\"name\"</span></span><br><span class=\"line\"> 2) <span class=\"string\">\"mymaster\"</span></span><br><span class=\"line\"> 3) <span class=\"string\">\"ip\"</span></span><br><span class=\"line\"> 4) <span class=\"string\">\"172.21.0.2\"</span> <span class=\"comment\"># 主库的ip</span></span><br><span class=\"line\"> 5) <span class=\"string\">\"port\"</span></span><br><span class=\"line\"> 6) <span class=\"string\">\"6379\"</span></span><br><span class=\"line\"> 7) <span class=\"string\">\"runid\"</span></span><br><span class=\"line\"> 8) <span class=\"string\">\"c0a0e5fa85c6fc61cf0670d374eac9c35f1b440c\"</span></span><br><span class=\"line\"> 9) <span class=\"string\">\"flags\"</span></span><br><span class=\"line\">10) <span class=\"string\">\"master\"</span></span><br><span class=\"line\">11) <span class=\"string\">\"link-pending-commands\"</span></span><br><span class=\"line\">12) <span class=\"string\">\"0\"</span></span><br><span class=\"line\">13) <span class=\"string\">\"link-refcount\"</span></span><br><span class=\"line\">14) <span class=\"string\">\"1\"</span></span><br><span class=\"line\">15) <span class=\"string\">\"last-ping-sent\"</span></span><br><span class=\"line\">16) <span class=\"string\">\"0\"</span></span><br><span class=\"line\">17) <span class=\"string\">\"last-ok-ping-reply\"</span></span><br><span class=\"line\">18) <span class=\"string\">\"508\"</span></span><br><span class=\"line\">19) <span class=\"string\">\"last-ping-reply\"</span></span><br><span class=\"line\">20) <span class=\"string\">\"508\"</span></span><br><span class=\"line\">21) <span class=\"string\">\"down-after-milliseconds\"</span></span><br><span class=\"line\">22) <span class=\"string\">\"30000\"</span></span><br><span class=\"line\">23) <span class=\"string\">\"info-refresh\"</span></span><br><span class=\"line\">24) <span class=\"string\">\"6070\"</span></span><br><span class=\"line\">25) <span class=\"string\">\"role-reported\"</span></span><br><span class=\"line\">26) <span class=\"string\">\"master\"</span></span><br><span class=\"line\">27) <span class=\"string\">\"role-reported-time\"</span></span><br><span class=\"line\">28) <span class=\"string\">\"106612\"</span></span><br><span class=\"line\">29) <span class=\"string\">\"config-epoch\"</span></span><br><span class=\"line\">30) <span class=\"string\">\"3\"</span></span><br><span class=\"line\">31) <span class=\"string\">\"num-slaves\"</span> <span class=\"comment\"># 两个从库</span></span><br><span class=\"line\">32) <span class=\"string\">\"2\"</span></span><br><span class=\"line\">33) <span class=\"string\">\"num-other-sentinels\"</span> <span class=\"comment\"># //还有两个哨兵</span></span><br><span class=\"line\">34) <span class=\"string\">\"2\"</span></span><br><span class=\"line\">35) <span class=\"string\">\"quorum\"</span></span><br><span class=\"line\">36) <span class=\"string\">\"2\"</span></span><br><span class=\"line\">37) <span class=\"string\">\"failover-timeout\"</span></span><br><span class=\"line\">38) <span class=\"string\">\"180000\"</span></span><br><span class=\"line\">39) <span class=\"string\">\"parallel-syncs\"</span></span><br><span class=\"line\">40) <span class=\"string\">\"1\"</span></span><br><span class=\"line\">127.0.0.1:26379&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"高可用检查\"><a href=\"#高可用检查\" class=\"headerlink\" title=\"高可用检查\"></a>高可用检查</h3><blockquote>\n<p>停止 master容器，等待10s，进入任意sentinel容器，使用<code>sentinel master mymaster</code>命令观察主节点发生变化，观察外挂的Sentinel*.conf 主节点IP发生变化</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">127.0.0.1:26379&gt; sentinel master mymaster</span><br><span class=\"line\"> 1) <span class=\"string\">\"name\"</span></span><br><span class=\"line\"> 2) <span class=\"string\">\"mymaster\"</span></span><br><span class=\"line\"> 3) <span class=\"string\">\"ip\"</span></span><br><span class=\"line\"> 4) <span class=\"string\">\"172.21.0.4\"</span> <span class=\"comment\"># 这里发现已经发生变化了</span></span><br><span class=\"line\"> 5) <span class=\"string\">\"port\"</span></span><br><span class=\"line\"> 6) <span class=\"string\">\"6379\"</span></span><br><span class=\"line\"> 7) <span class=\"string\">\"runid\"</span></span><br><span class=\"line\"> 8) <span class=\"string\">\"5114e2ca2ea3eb15a865f2cd5d7c5101e2bf0d34\"</span></span><br><span class=\"line\"> 9) <span class=\"string\">\"flags\"</span></span><br><span class=\"line\">10) <span class=\"string\">\"master\"</span></span><br><span class=\"line\">11) <span class=\"string\">\"link-pending-commands\"</span></span><br><span class=\"line\">12) <span class=\"string\">\"0\"</span></span><br><span class=\"line\">13) <span class=\"string\">\"link-refcount\"</span></span><br><span class=\"line\">14) <span class=\"string\">\"1\"</span></span><br><span class=\"line\">15) <span class=\"string\">\"last-ping-sent\"</span></span><br><span class=\"line\">16) <span class=\"string\">\"0\"</span></span><br><span class=\"line\">17) <span class=\"string\">\"last-ok-ping-reply\"</span></span><br><span class=\"line\">18) <span class=\"string\">\"520\"</span></span><br><span class=\"line\">19) <span class=\"string\">\"last-ping-reply\"</span></span><br><span class=\"line\">20) <span class=\"string\">\"520\"</span></span><br><span class=\"line\">21) <span class=\"string\">\"down-after-milliseconds\"</span></span><br><span class=\"line\">22) <span class=\"string\">\"30000\"</span></span><br><span class=\"line\">23) <span class=\"string\">\"info-refresh\"</span></span><br><span class=\"line\">24) <span class=\"string\">\"1529\"</span></span><br><span class=\"line\">25) <span class=\"string\">\"role-reported\"</span></span><br><span class=\"line\">26) <span class=\"string\">\"master\"</span></span><br><span class=\"line\">27) <span class=\"string\">\"role-reported-time\"</span></span><br><span class=\"line\">28) <span class=\"string\">\"1604\"</span></span><br><span class=\"line\">29) <span class=\"string\">\"config-epoch\"</span></span><br><span class=\"line\">30) <span class=\"string\">\"4\"</span></span><br><span class=\"line\">31) <span class=\"string\">\"num-slaves\"</span></span><br><span class=\"line\">32) <span class=\"string\">\"2\"</span></span><br><span class=\"line\">33) <span class=\"string\">\"num-other-sentinels\"</span></span><br><span class=\"line\">34) <span class=\"string\">\"2\"</span></span><br><span class=\"line\">35) <span class=\"string\">\"quorum\"</span></span><br><span class=\"line\">36) <span class=\"string\">\"2\"</span></span><br><span class=\"line\">37) <span class=\"string\">\"failover-timeout\"</span></span><br><span class=\"line\">38) <span class=\"string\">\"180000\"</span></span><br><span class=\"line\">39) <span class=\"string\">\"parallel-syncs\"</span></span><br><span class=\"line\">40) <span class=\"string\">\"1\"</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>还可以进入Redis容器检查Redis运行角色</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">reids-cli</span><br><span class=\"line\">127.0.0.1:6379&gt; auth redis_pwd</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; role</span><br><span class=\"line\">1) <span class=\"string\">\"slave\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"172.21.0.4\"</span></span><br><span class=\"line\">3) (<span class=\"built_in\">integer</span>) 6379</span><br><span class=\"line\">4) <span class=\"string\">\"connected\"</span></span><br><span class=\"line\">5) (<span class=\"built_in\">integer</span>) 227725</span><br><span class=\"line\">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["Docker"],"tags":["Redis","Docker","Docker-Compose"]},{"title":"Docker-Compose-Redis-Master-Slave","url":"/posts/1022769596/","content":"<blockquote>\n<p>使用docker-compose搭建Redis主从测试环境。</p>\n</blockquote>\n<h3 id=\"源码地址\"><a href=\"#源码地址\" class=\"headerlink\" title=\"源码地址\"></a><a href=\"https://github.com/z201/code-example/tree/main/Docker-Compose-Redis-Master-Slave\" target=\"_blank\" rel=\"noopener\">源码地址</a></h3><h3 id=\"编写docker-compose配置文件\"><a href=\"#编写docker-compose配置文件\" class=\"headerlink\" title=\"编写docker-compose配置文件\"></a>编写docker-compose配置文件</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version :</span> <span class=\"string\">'3'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">network-redis:</span></span><br><span class=\"line\">    <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">master:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">redis:5.0.5</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">redis5.0.6-master</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">network-redis</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'6379:6379'</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">redis-server</span> <span class=\"string\">--requirepass</span> <span class=\"string\">redis_pwd</span>  <span class=\"string\">--masterauth</span> <span class=\"string\">redis_pwd</span> <span class=\"comment\"># 启动redis命令</span></span><br><span class=\"line\">  <span class=\"attr\">slaves1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">redis:5.0.5</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">redis5.0.6-slaves1</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">network-redis</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'6380:6379'</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">redis-server</span> <span class=\"string\">--slaveof</span> <span class=\"string\">redis5.0.6-master</span> <span class=\"number\">6379</span> <span class=\"string\">--requirepass</span> <span class=\"string\">redis_pwd</span> <span class=\"string\">--masterauth</span> <span class=\"string\">redis_pwd</span> <span class=\"comment\"># 启动redis命令</span></span><br><span class=\"line\">  <span class=\"attr\">slaves2:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">redis:5.0.5</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">redis5.0.6-slaves2</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">network-redis</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'6381:6379'</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">redis-server</span> <span class=\"string\">--slaveof</span> <span class=\"string\">redis5.0.6-master</span> <span class=\"number\">6379</span> <span class=\"string\">--requirepass</span> <span class=\"string\">redis_pwd</span> <span class=\"string\">--masterauth</span> <span class=\"string\">redis_pwd</span> <span class=\"comment\"># 启动redis命令</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>指定密码redis_pwd 作为测试密码</li>\n</ul>\n<h3 id=\"启动测试\"><a href=\"#启动测试\" class=\"headerlink\" title=\"启动测试\"></a>启动测试</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker-compse -f docker-compose up -d</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Starting redis5.0.6-master ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Starting redis5.0.6-slaves2 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Starting redis5.0.6-slaves1 ... <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>检查docker运行</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker ps</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220106235951.png\"></p>\n<ul>\n<li>使用redis-cli检查</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">redis-cli</span><br><span class=\"line\">127.0.0.1:6379&gt; auth redis_pwd</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; info replication</span><br><span class=\"line\"><span class=\"comment\"># Replication</span></span><br><span class=\"line\">role:master</span><br><span class=\"line\">connected_slaves:2</span><br><span class=\"line\">slave0:ip=172.21.0.3,port=6379,state=online,offset=126,lag=0</span><br><span class=\"line\">slave1:ip=172.21.0.4,port=6379,state=online,offset=126,lag=0</span><br><span class=\"line\">master_replid:76d204429eefdd1df062c54ce8eae3b8ba9268b6</span><br><span class=\"line\">master_replid2:0000000000000000000000000000000000000000</span><br><span class=\"line\">master_repl_offset:126</span><br><span class=\"line\">second_repl_offset:-1</span><br><span class=\"line\">repl_backlog_active:1</span><br><span class=\"line\">repl_backlog_size:1048576</span><br><span class=\"line\">repl_backlog_first_byte_offset:1</span><br><span class=\"line\">repl_backlog_histlen:126</span><br><span class=\"line\">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>这里可以有两个slave。</p>\n</li>\n<li><p>可以使用客户端工具往master写入数据,看slave是否存在数据。</p>\n</li>\n</ul>\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["Docker"],"tags":["Redis","Docker","Docker-Compose"]},{"title":"查缺补漏-网络协议","url":"/posts/595781010/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h3 id=\"网络协议\"><a href=\"#网络协议\" class=\"headerlink\" title=\"网络协议\"></a>网络协议</h3><blockquote>\n<p>网络协议是一组确定的规则，这些规则确定如何在同一网络中的不同设备之间传输数据。本质上，它允许连接的设备彼此通信，而不管其内部过程，结构或设计是否有差异。（两个端点都需要了解协议才能进行交流）。</p>\n</blockquote>\n<h3 id=\"OSI网络模型\"><a href=\"#OSI网络模型\" class=\"headerlink\" title=\"OSI网络模型\"></a>OSI网络模型</h3><blockquote>\n<p>OSI英文全称叫做(Open System Interconnection Model). 中文全称叫做开放式系统互联模型. 也叫做网络7层模型，从下到上依次为，物理层，数据链路层，网络层，传输层，会话层，表示层，应用层。</p>\n</blockquote>\n<ul>\n<li>OIS概念模型<strong>实际上并没有真正实现过，但是我们需要参考这个分层来理解网络协议</strong>一般来说把5-7层叫做上层，1-4层叫做下层。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211123214245.png\"></p>\n<ul>\n<li>7-应用层 -&gt; 网络流程应用（表示的是用户界面，例如Telnet，HTTP、FTP、TFTP、SMTP、SNMP、DNS、TELNET、HTTPS、POP3、DHCP）</li>\n<li>6-表示层 -&gt; 数据表示 (数据如何呈现，特殊处理-&gt;例如加密，比如JPEG、ASCLL、EBCDIC、加密格式等）</li>\n<li>5-会话层 -&gt; 主机间的通信（将不同应用程序的数据分开。建立，管理和终止应用之间的会话）</li>\n<li>4-传输层 -&gt; 端到端连接（可靠或不可靠的传递，例如TCP，UDP)</li>\n<li>3-网络层 -&gt; 地址和最佳路径（提供路由器用于路径的逻辑寻址，比如ICMP IGMP IP(IPV4 IPV6)）</li>\n<li>2-数据链路层 -&gt; 媒体访问（将位组合成字节，将字节组合成帧，使用MAC地址访问，错误检测-比如HDLC）</li>\n<li>1-物理层 -&gt; 二进制传输（在设备之间移动bits。例如V.35）</li>\n</ul>\n<h3 id=\"TCP-IP网络模型\"><a href=\"#TCP-IP网络模型\" class=\"headerlink\" title=\"TCP/IP网络模型\"></a>TCP/IP网络模型</h3><blockquote>\n<p>TCP/IP 模型和OSI相比会简单一点，只有四层，分别为数据链路层，网络层，传输层和应用层。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211123214318.png\"></p>\n<h3 id=\"OSI模型与TCP-IP模型\"><a href=\"#OSI模型与TCP-IP模型\" class=\"headerlink\" title=\"OSI模型与TCP/IP模型\"></a>OSI模型与TCP/IP模型</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211123215305.png\"></p>\n<ul>\n<li>4-应用层 -&gt; 对应于OSI的5-7层</li>\n<li>3-传输层 -&gt; 这个是和OSI的第四层想同的</li>\n<li>2-网络层 -&gt; 这个是和OSI的第3网络层对应的</li>\n<li>1-网络访问层 -&gt; 这个是和OSI的第1-2层所对应的</li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"TCP-IP协议\"><a href=\"#TCP-IP协议\" class=\"headerlink\" title=\"TCP/IP协议\"></a>TCP/IP协议</h3><blockquote>\n<p>TCP/IP的前身APPA:NCP协议。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211123220629.png\"></p>\n<ul>\n<li>TCP：<strong>面向连接的、可靠的、拥塞控制、基于字节流的、有状态服务</strong>传输层通信协议。</li>\n<li>UDP：<strong>面向无连接、基于数据包、无状态服务</strong></li>\n<li>IP：根据IP地址穿透网络传输数据。</li>\n</ul>\n<h4 id=\"TCP\"><a href=\"#TCP\" class=\"headerlink\" title=\"TCP\"></a>TCP</h4><blockquote>\n<p>TCP的全称是Transmission Control Protocol，在IP协议之上，解决网络通信可依赖的问题。TCP基本上被以上大多数的协议所使用。</p>\n</blockquote>\n<ul>\n<li><strong>面向连接</strong>，也就是建立连接。为了客户端与服务端维护的连接，而建立一定的数据结构维护互相交互的状态。通过这种数据结构来保证所谓的面相连接的特性。</li>\n<li><strong>可靠性</strong>，通过TCP连接传输的数据，无差错、不丢失、不重复、按顺序到达。使用校验、确认和重传机制来保证可靠传输。</li>\n<li><strong>阻塞控制</strong>，TCP自己决定何时停止和发送数据。</li>\n<li><strong>基于字节流</strong>，发送的时候是一个流，没头没尾，消息是<strong>有序</strong>的，会对<strong>重复</strong>的消息丢弃。</li>\n<li><strong>状态服务</strong>，自身维护了状态</li>\n</ul>\n<h5 id=\"端口号\"><a href=\"#端口号\" class=\"headerlink\" title=\"端口号\"></a>端口号</h5><blockquote>\n<p>TCP报文中有端口相关信息，穿插下。端口号的范围从0到65535，通过端口号被分为三个不同的类别。</p>\n</blockquote>\n<ul>\n<li>公认端口（Well-Known）0-1023 是经过实践检验的协议，所以称为公认端口。诸如Http使用端口80，https使用443<ul>\n<li>HTTP - 80</li>\n<li>HTTPS - 443</li>\n<li>FTP - 20,21</li>\n<li>SSH - 22</li>\n<li>Telnet - 23</li>\n</ul>\n</li>\n<li>注册端口（Registered）1024-49151</li>\n<li>临时端口（Ephemeral）49152-65535</li>\n</ul>\n<h5 id=\"TCP报文格式\"><a href=\"#TCP报文格式\" class=\"headerlink\" title=\"TCP报文格式\"></a>TCP报文格式</h5><blockquote>\n<p>TCP 报文是 TCP 层传输的数据单元，也称为报文段。TCP 报文中每个字段如图所示。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211123230635.png\"></p>\n<h5 id=\"报文字段含义\"><a href=\"#报文字段含义\" class=\"headerlink\" title=\"报文字段含义\"></a>报文字段含义</h5><blockquote>\n<p>固定首部长度为20字节,可变部分0~40字节</p>\n</blockquote>\n<ul>\n<li><p><em>Source Prot</em> 源端口 16bit 范围 0 ~ 56625</p>\n</li>\n<li><p><em>Destination Port</em> 目标端口 16bit 范围 0 ~ 56625</p>\n</li>\n<li><p><em>Sequence Number</em> 序列号字段 32bit </p>\n<ul>\n<li>它表示本报文段所发送数据的第一个字节的编号。在 TCP 连接中，所传送的字节流的每一个字节都会按顺序编号。当SYN标记不为1时，这是当前数据分段第一个字母的序列号；如果SYN的值是1时，这个字段的值就是初始序列值（ISN），用于对序列号进行同步。这时，第一个字节的序列号比这个字段的值大1，也就是ISN加1。<strong>解决网络包乱序问题</strong></li>\n</ul>\n</li>\n<li><p><em>Acknowledgment Number，ACK Number</em>  确认号字段</p>\n<ul>\n<li>TCP 确认号（Acknowledgment Number，ACK Number）：占 32 位。它表示接收方期望收到发送方下一个报文段的第一个字节数据的编号。其值是接收计算机即将接收到的下一个序列号，也就是下一个接收到的字节的序列号加1。<strong>解决网络不丢包问题</strong></li>\n</ul>\n</li>\n<li><p><em>Header Length</em> 数据偏移字段 </p>\n<ul>\n<li>TCP 首部长度（Header Length）：数据偏移是指数据段中的“数据”部分起始处距离 TCP 数据段起始处的字节偏移量，占 4 位。其实这里的“数据偏移”也是在确定 TCP 数据段头部分的长度，告诉接收端的应用程序，数据从何处开始。</li>\n</ul>\n</li>\n<li><p><em>Reserved</em> 保留字段 4bit 为 TCP 将来的发展预留空间，目前必须全部为 0。</p>\n</li>\n<li><p>标志位字段</p>\n<blockquote>\n<p>SYN 是发起一个连接，ACK 是回复，RST 是重新连接，FIN结束连接。注意这几个标志位。</p>\n</blockquote>\n<ul>\n<li>CWR（Congestion Window Reduce）：拥塞窗口减少标志，用来表明它接收到了设置 ECE 标志的 TCP 包。并且，发送方收到消息之后，通过减小发送窗口的大小来降低发送速率。</li>\n<li>ECE（ECN Echo）：用来在 TCP 三次握手时表明一个 TCP 端是具备 ECN 功能的。在数据传输过程中，它也用来表明接收到的 TCP 包的 IP 头部的 ECN 被设置为 11，即网络线路拥堵。</li>\n<li>URG（Urgent）：表示本报文段中发送的数据是否包含紧急数据。URG=1 时表示有紧急数据。当 URG=1 时，后面的紧急指针字段才有效。</li>\n<li><strong>ACK</strong>：表示前面的确认号字段是否有效。ACK=1 时表示有效。只有当 ACK=1 时，前面的确认号字段才有效。TCP 规定，连接建立后，ACK 必须为 1。</li>\n<li>PSH（Push）：告诉对方收到该报文段后是否立即把数据推送给上层。如果值为 1，表示应当立即把数据提交给上层，而不是缓存起来。</li>\n<li><strong>RST</strong>：表示是否重置连接。如果 RST=1，说明 TCP 连接出现了严重错误（如主机崩溃），必须释放连接，然后再重新建立连接。</li>\n<li><strong>SYN</strong>：在建立连接时使用，用来同步序号。当 SYN=1，ACK=0 时，表示这是一个请求建立连接的报文段；当 SYN=1，ACK=1 时，表示对方同意建立连接。SYN=1 时，说明这是一个请求建立连接或同意建立连接的报文。只有在前两次握手中 SYN 才为 1。</li>\n<li><strong>FIN</strong>：标记数据是否发送完毕。如果 FIN=1，表示数据已经发送完成，当通信结束希望断开连接时，通信双方的主机之间就可以相互交换 <code>FIN</code> 位置为 1 的 TCP 段。</li>\n</ul>\n</li>\n<li><p><em>Window Size</em> 窗口大小字段 16bit </p>\n<ul>\n<li>它表示从 Ack Number 开始还可以接收多少字节的数据量，也表示当前接收端的接收窗口还有多少剩余空间。该字段可以用于 <strong>TCP 的流量控制</strong>。</li>\n</ul>\n</li>\n<li><p><em>TCP Checksum</em> TCP 校验字段 16bit</p>\n<ul>\n<li>它用于<strong>确认传输的数据是否有损坏</strong>。发送端基于数据内容校验生成一个数值，接收端根据接收的数据校验生成一个值。两个值必须相同，才能证明数据是有效的。如果两个值不同，则丢掉这个数据包。Checksum 是根据伪头 + TCP 头 + TCP 数据三部分进行计算的。</li>\n</ul>\n</li>\n<li><p><em>Urgent Pointer</em> 紧急指针字段 </p>\n<ul>\n<li>仅当前面的 URG 控制位为 1 时才有意义。它指出本数据段中为紧急数据的字节数，占 16 位。当所有紧急数据处理完后，TCP 就会告诉应用程序恢复到正常操作。即使当前窗口大小为 0，也是可以发送紧急数据的，因为紧急数据无须缓存。</li>\n</ul>\n</li>\n<li><p><em>Option</em> 可选项字段</p>\n<ul>\n<li>长度不定，但长度必须是 32bits 的整数倍。</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"TCP状态\"><a href=\"#TCP状态\" class=\"headerlink\" title=\"TCP状态\"></a>TCP状态</h5><blockquote>\n<p>TCP的状态变迁图更细致的描述了TCP连接建立和连接终止中的各个状态</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211123232928.png\"></p>\n<h5 id=\"三次握手建立连接\"><a href=\"#三次握手建立连接\" class=\"headerlink\" title=\"三次握手建立连接\"></a>三次握手建立连接</h5><blockquote>\n<p>握手的主要行为 SYN 同步 ACK 确认 </p>\n<ol>\n<li><p>同步Sequence序列号，初始化序列号ISN（Inital Sequence Number）</p>\n</li>\n<li><p>交换TCP通讯参数，比如MSS、窗口比例因子、选择性确认、指定校验算法</p>\n</li>\n<li><p>防止失效的连接请求访问到服务器端，让服务器误认为要建立连接。</p>\n</li>\n</ol>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211208200222.png\"></p>\n<ul>\n<li><p>过程</p>\n<ul>\n<li>Client 发送 自身的SYN 到 Server ，并包含初始化序列号</li>\n<li>Server 发送一个 SYN 和 ACK 在同一个报文中 给Client  ， </li>\n<li>Client 发送一个 ACK 给 Server</li>\n</ul>\n</li>\n<li><p>实践过程</p>\n<ul>\n<li>准备一台linxu Centos 且安装好 tcpdump </li>\n<li><code>yum install tcpdump</code></li>\n<li><code>tcpdump -i eth0 -w out_3.pcap tcp port 80 -c 3 -S</code>  监听eth0网卡、将内容输出到out_3.pacp 方便 Wireshark 分析 、监听tcp 协议 端口 80 只保留前3个包，用绝对序列号代替相对序列化。在客户端使用 curl命令访问对于服务即可。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211203154224.png\"></p>\n<ul>\n<li>第一次握手客户端发送自身序列号 2883770579 并且 将 syn 设置为 1  </li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211203155019.png\"></p>\n<pre><code>- 第二次握手 将 syn设置为 1 、ack 设置为 1， 并且返回确认报文ack 2883770579 + 1 = 2883770580 。</code></pre>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211203155507.png\"></p>\n<ul>\n<li>第三次握手 将ACK设置成1 ， 确认报文ack 2054592687 + 1 = 2054592689 。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211208200251.png\"></p>\n</li>\n</ul>\n<h5 id=\"四次挥手关闭连接\"><a href=\"#四次挥手关闭连接\" class=\"headerlink\" title=\"四次挥手关闭连接\"></a>四次挥手关闭连接</h5><blockquote>\n<p>TCP是全双工的，且存在半关闭(half-close)状态的存在，所以终止TCP协议需要4次握手。连接双方都需要关闭连接。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211203152951.png\"></p>\n<ul>\n<li><p>过程</p>\n<ul>\n<li>Clinet 发送自身 FIN M到 Server </li>\n<li>Server 发送一个ACK 切 M + 1 给 Client</li>\n<li>Server 发送 FIN N 到 Client </li>\n<li>Client 发送 ACK N + 1 到 Server</li>\n</ul>\n</li>\n<li><p>实践过程</p>\n<ul>\n<li><code>tcpdump -i eth0 -w out_3.pcap tcp port 80  -S</code></li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211203165015.png\"></p>\n<ul>\n<li>不知道为什么不是四次，在客户端发送完请求后，不会立刻关闭连接，仍然处于establish状态，短连接会经过fin-wait1 fin wait2 time_wait</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"MSS分段\"><a href=\"#MSS分段\" class=\"headerlink\" title=\"MSS分段\"></a>MSS分段</h5><blockquote>\n<p>客户端与服务器之间的通信是一个数据传输过程。通信的消息将以数据包形式进行传输。TCP 协议在数据进行数据传输时，使用滑动窗口机制来同时发送多个数据包。当数据包丢失时，TCP 协议利用数据重发功能重新发送数据包。因接收端接收数据包的能力不同，TCP 流控制会根据接收端的能力发送适当数量的数据包。</p>\n</blockquote>\n<ul>\n<li>数据分片<ul>\n<li>数据在传输的过程中，会经过很多的物理设备，这些设备处理的数据都有一些限制，因此在发送数据都是好不能超过最大的字节数。这个最大的字节数就是（Maximum Segment Size，MSS）。当要发送的数据超过该值的时候，就需要将数据拆分为多个包，依次发送。</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"TCP流量控制\"><a href=\"#TCP流量控制\" class=\"headerlink\" title=\"TCP流量控制\"></a>TCP流量控制</h5><h5 id=\"TCP阻塞控制\"><a href=\"#TCP阻塞控制\" class=\"headerlink\" title=\"TCP阻塞控制\"></a>TCP阻塞控制</h5><h5 id=\"TCP的RST\"><a href=\"#TCP的RST\" class=\"headerlink\" title=\"TCP的RST\"></a>TCP的RST</h5><h4 id=\"UDP\"><a href=\"#UDP\" class=\"headerlink\" title=\"UDP\"></a>UDP</h4><blockquote>\n<p>DNS,SNMP和TFTP都是使用UDP，实际上DNS和SNMP既可以使用TCP也可以使用UDP。相比TCP，UDP提供了效率，TCP在使用过程中有太多的开销，实际上并不是所有的场景都需要TCP可靠的通信机制，比如DNS</p>\n</blockquote>\n<ul>\n<li><strong>无连接</strong> 不提供复杂的控制机制，利用 IP 提供面向「无连接」的通信服务</li>\n<li>协议真的非常简洁，头部只有 <code>8</code> 个字节（ 64 位）</li>\n</ul>\n<h5 id=\"UDP报文格式\"><a href=\"#UDP报文格式\" class=\"headerlink\" title=\"UDP报文格式\"></a>UDP报文格式</h5><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211124012658.png\"></p>\n<h5 id=\"报文字段含义-1\"><a href=\"#报文字段含义-1\" class=\"headerlink\" title=\"报文字段含义\"></a>报文字段含义</h5><ul>\n<li><em>Source Prot</em> 源端口 16bit 范围 0 ~ 56625</li>\n<li><em>Destination Port</em> 目标端口 16bit 范围 0 ~ 56625</li>\n<li><em>Length</em> 长度 16bit 表示 UDP 数据报长度，包含 UDP 报文头和 UDP 数据长度。因为 UDP 报文头长度是 8 个字节，所以这个值最小为 8。</li>\n<li><em>checksum</em> 校验值 16bit 可以检验数据在传输过程中是否被损坏。</li>\n</ul>\n<h4 id=\"IP\"><a href=\"#IP\" class=\"headerlink\" title=\"IP\"></a>IP</h4><blockquote>\n<p>IP协议是TCP/IP协议的核心，所有的TCP，UDP，IMCP，IGMP的数据都以IP数据格式传输。要注意的是，IP不是可靠的协议，这是说，IP协议没有提供一种数据未传达以后的处理机制，这被认为是上层协议：TCP或UDP要做的事情。</p>\n</blockquote>\n<ul>\n<li>无连接、非可靠、无确认。</li>\n<li>IP协议提供了一种分层、与硬件无关的寻址系统，它可以在复杂的路由式网络中传输数据服务。</li>\n<li>IP协议可以将多个网络连接起来，在源地址和目的地址之间传输数据，以适应不同网络对数据包的要求。</li>\n</ul>\n<h3 id=\"HTTP-HTTPS\"><a href=\"#HTTP-HTTPS\" class=\"headerlink\" title=\"HTTP/HTTPS\"></a>HTTP/HTTPS</h3><blockquote>\n<p>HTTP 就是超文本传输协议，也就是 HyperText Transfer Protocol。HTTP over SSL/TLS 也就是运行在 SSL/TLS 协议上的 HTTP。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211206141044.png\"></p>\n<ul>\n<li><p>HTTP重要里程碑的时间点</p>\n<ul>\n<li>Http0.9 -&gt; 1991</li>\n</ul>\n</li>\n<li><p>Http1.0 -&gt;1996</p>\n<ul>\n<li>Http 1.1 -&gt; 1999</li>\n</ul>\n</li>\n<li><p>Http2 -&gt; 2015</p>\n</li>\n<li><p>HTML 超文本标记语言</p>\n</li>\n</ul>\n<h4 id=\"HTTP1-1\"><a href=\"#HTTP1-1\" class=\"headerlink\" title=\"HTTP1.1\"></a>HTTP1.1</h4><blockquote>\n<p>1995 年，网景的 Netscape Navigator 和微软的 Internet Explorer 开始了著名的“浏览器大战”，都希望在互联网上占据主导地位。</p>\n</blockquote>\n<h4 id=\"HTTP2\"><a href=\"#HTTP2\" class=\"headerlink\" title=\"HTTP2\"></a>HTTP2</h4><blockquote>\n<p>HTTP/2 基于 Google 的 SPDY 协议，注重性能改善。</p>\n</blockquote>\n<h4 id=\"HTTP3\"><a href=\"#HTTP3\" class=\"headerlink\" title=\"HTTP3\"></a>HTTP3</h4><blockquote>\n<p>HTTP/3 基于 Google 的 QUIC 协议，是将来的发展方向。</p>\n</blockquote>\n<h4 id=\"Proxy\"><a href=\"#Proxy\" class=\"headerlink\" title=\"Proxy\"></a>Proxy</h4><blockquote>\n<p>Http Proxy是Http协议中的一个环节，中转站可以转发客户端请求也可以转发服务端应答。</p>\n</blockquote>\n<ul>\n<li>匿名代理：完全“隐匿”了被代理的机器，外界看到的只是代理服务器。</li>\n<li>透明代理：顾名思义，它在传输过程中是“透明开放”的，外界既知道代理，也知道客户端。</li>\n<li>正向代理：靠近客户端，代表客户端向服务器发送请求。</li>\n<li>反向代理：靠近服务器端，代表服务器响应客户端的请求。</li>\n</ul>\n<h4 id=\"SSL-TLS\"><a href=\"#SSL-TLS\" class=\"headerlink\" title=\"SSL/TLS\"></a>SSL/TLS</h4><blockquote>\n<p><em>TLS</em> 是<em>SSL</em> 的改良版本</p>\n</blockquote>\n<h3 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h3><h4 id=\"描述下GET与POST的区别。\"><a href=\"#描述下GET与POST的区别。\" class=\"headerlink\" title=\"描述下GET与POST的区别。\"></a>描述下GET与POST的区别。</h4><ul>\n<li>GET和POST是HTTP请求的两种基本方法。<ul>\n<li>GET：特定浏览器和服务器对URL长度有限制，例如 IE对URL长度的限制是2083字节(2K+35)。理论上没有长度限制，其限制取决于操作系 统的支持。所以GET提交时，传输数据就会受到URL长度的限制。</li>\n<li>POST：由于不是通过URL传值，理论上数据不受限。但实际各个WEB服务器会规定对post提交数据大小进行限制。</li>\n</ul>\n</li>\n<li>GET和POST本质上没有区别,只是在浏览器上直观体现方式不同。GET和POST本质上就是TCP链接，并无差别。但是由于HTTP的规定和浏览器/服务器的限制，导致他们在应用过程中体现出一些不同。</li>\n<li>GET产生一个TCP数据包;POST产生两个TCP数据包。<ul>\n<li>对于GET方式的请求，浏览器会把http header和data一并发送出去，服务器响应200(返回数据);</li>\n<li>而对于POST，浏览器先发送header，服务器响应100 continue，浏览器再发送data，服务器响应200 ok(返回数据)。</li>\n<li>在网络环境好的情况下，发一次包的时间和发两次包的时间差别基本可以无视。而在网络环境差的情况下，两次包的TCP在验证数据包完整性上，有非常大的优点，一般的浏览POST会发送两次，但是Firefox就发送一次。</li>\n</ul>\n</li>\n<li>安全性<ul>\n<li>在没有加密的情况安全性是一样的,在浏览器调试模式下可以看到所有数据的。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"描述下HTTP-Cookie。\"><a href=\"#描述下HTTP-Cookie。\" class=\"headerlink\" title=\"描述下HTTP Cookie。\"></a>描述下HTTP Cookie。</h4><ul>\n<li>一个cookie就是存储在用户主机浏览器中的一小段文本文件。Cookies是纯文本形式，它们不包含任何可执行代码。一个Web页面或服务器告之浏览器来将这些信息存储并且基于一系列规则在之后的每个请求中都将该信息返回至服务器。Web服务器之后可以利用这些信息来标识用户。多数需要登录的站点通常会在你的认证信息通过后来设置一个cookie，之后只要这个cookie存在并且合法，就可以自由的浏览这个站点的所有部分。再次，cookie只是包含了数据。在后续的http 请求中，浏览器会将cookie带回给Web Server。同时在浏览器允许脚本执行的情况下，Cookie是可以被JavaScript等脚本设置的。</li>\n<li>Cookie的类别。<ul>\n<li>Session Cookie这个类型的cookie只在会话期间内有效，即当关闭浏览器的时候，它会被浏览器删除。设置session cookie的办法是：在创建cookie不设置Expires即可。</li>\n<li>Persistent Cookie持久型cookie顾名思义就是会长期在用户会话中生效。当你设置cookie的属性Max-Age为1个月的话，那么在这个月里每个相关URL的http请求中都会带有这个cookie。所以它可以记录很多用户初始化或自定义化的信息，比如什么时候第一次登录及弱登录态等。</li>\n<li>Secure cookie安全cookie是在https访问下的cookie形态，以确保cookie在从客户端传递到Server的过程中始终加密的。但是必须是在HTTPS的情况才有效果。</li>\n<li>HttpOnly 属性，这个数据设置为true后，客户端通过JS是无法获取到cookie信息的（暂时的）。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"描述下Servlet-Cookie-与Session。\"><a href=\"#描述下Servlet-Cookie-与Session。\" class=\"headerlink\" title=\"描述下Servlet Cookie 与Session。\"></a>描述下Servlet Cookie 与Session。</h4><ul>\n<li><p>具体来说cookie机制采用的是在客户端保持状态的方案，而session机制采用的是在服务器端保持状态的方案。</p>\n<ul>\n<li>服务器端保持状态的方案在客户端也需要保存一个标识，所以session机制可能需要借助于cookie机制来达到保存标识的目的。</li>\n</ul>\n</li>\n<li><p>Session是以cookie为基础的。在一些web开发的书中，往往只是简单的把Session和cookie作为两种并列的http传送信息的方式，session cookies位于服务器端，persistent cookie位于客户端。</p>\n</li>\n</ul>\n<ul>\n<li>Cookie不是很安全，别人可以分析存放在本地的cookie并进行cookie欺骗考虑到安全应当使用session。</li>\n<li>Session会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能考虑到减轻服务器性能方面，应当使用cookie。</li>\n<li>单个Cookie保存的数据不能超过4K，很多浏览器都限制一个站点最多保存20个cookie。</li>\n<li>关闭浏览器不会导致服务端session被删除，服务器为session设置了一个失效时间，当距离客户上一次使用session的时间超过了这个失效时间时，服务器就可以认为客户端已经停止了活动，才会把session删除以节省存储空间。</li>\n<li>关闭浏览器，只会是浏览器端内存里的session cookie消失，但不会使保存在服务器端的session对象消失，同样也不会使已经保存到硬盘上的持久化cookie消失。</li>\n</ul>\n<h4 id=\"URI与URL的区别\"><a href=\"#URI与URL的区别\" class=\"headerlink\" title=\"URI与URL的区别\"></a>URI与URL的区别</h4><h5 id=\"URL\"><a href=\"#URL\" class=\"headerlink\" title=\"URL\"></a>URL</h5><ul>\n<li>RFC1738 (1994.12) Uniform Resource Locator 表示资源的位置，期望提提供查找资源的方法。</li>\n<li>它是可以对互联网上资源位置访问方式对一种简洁表达。通常的表现格式如下。</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">scheme://host[:port<span class=\"comment\">#]/path/…/[;url-params][?query-string][#anchor]</span></span><br><span class=\"line\"></span><br><span class=\"line\">scheme //有我们很熟悉的http、https、ftp以及著名的ed2k，迅雷的thunder等。</span><br><span class=\"line\">host   //HTTP服务器的IP地址或者域名</span><br><span class=\"line\">port<span class=\"comment\">#  //HTTP服务器的默认端口是80，这种情况下端口号可以省略。如果使用了别的端口，必须指明，</span></span><br><span class=\"line\">例如tomcat的默认端口是8080  http://localhost:8080/</span><br><span class=\"line\">path   //访问资源的路径</span><br><span class=\"line\">url-params  //所带参数 </span><br><span class=\"line\">query-string    //发送给http服务器的数据</span><br><span class=\"line\">anchor //锚点定位</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"URN\"><a href=\"#URN\" class=\"headerlink\" title=\"URN\"></a>URN</h5><ul>\n<li>RFC2141 (1997.5) Uniform Resource Name ，资源映射名称。比如</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">mailto: xxxxx@qq.com</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"URI\"><a href=\"#URI\" class=\"headerlink\" title=\"URI\"></a>URI</h5><ul>\n<li>RFC1630 (1994.6) Uniform Resource Identifier 用于区分资源 , 是 URL 和 URN 的超集，用于取代URL 和 URN概念。</li>\n<li>URI 属于父类，而 URL 属于 URI 的子类。URL 是 URI 的一个子集。<strong>URI：统一资源标识 URL：统一资源定位 URN：统一资源名称。</strong></li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211123132409.png\"></p>\n<h4 id=\"TCP安全问题\"><a href=\"#TCP安全问题\" class=\"headerlink\" title=\"TCP安全问题\"></a>TCP安全问题</h4><h5 id=\"SYN攻击\"><a href=\"#SYN攻击\" class=\"headerlink\" title=\"SYN攻击\"></a>SYN攻击</h5><blockquote>\n<p>在三次握手过程中，服务端收到SYN-ACK之后，收到客户端的ACK之前TCP连接成为半连接(half-open connect) ，这个时候服务器处于SYN_REVD状态，收到ACK之后服务器才能转入ESTABLISHED状态。</p>\n</blockquote>\n<ul>\n<li>SYN 攻击指的是，攻击客户端在短时间内伪造大量不存在的IP地址，向服务器不断地发送SYN包，服务器回复确认包，并等待客户的确认。由于源地址是不存在的，服务器需要不断的重发直至超时，这些伪造的SYN包将长时间占用未连接队列，正常的SYN请求被丢弃，导致目标系统运行缓慢，严重者会引起网络堵塞甚至系统瘫痪。</li>\n</ul>\n<h5 id=\"SYN检测\"><a href=\"#SYN检测\" class=\"headerlink\" title=\"SYN检测\"></a>SYN检测</h5><ul>\n<li>在Linux/Unix上可以使用系统自带的netstats命令来检测SYN攻击。</li>\n</ul>\n<h5 id=\"SYN攻击防范\"><a href=\"#SYN攻击防范\" class=\"headerlink\" title=\"SYN攻击防范\"></a>SYN攻击防范</h5><h6 id=\"设置超时时间与缓存列队。\"><a href=\"#设置超时时间与缓存列队。\" class=\"headerlink\" title=\"设置超时时间与缓存列队。\"></a>设置超时时间与缓存列队。</h6><ul>\n<li><p>应用层connect超时时间调整。</p>\n</li>\n<li><p>操作系统内核限制调整。</p>\n<ul>\n<li>服务器端SYN_RCV状态</li>\n<li>net.ipv4.tcp_max_syn_backlog:  SYN_RCVD状态的最大连接数。</li>\n<li>net.ipv4.tcp_synack_retries: 被动建立时,发SYN/ACK的重试次数。</li>\n<li>客户端SYN_SENT状态</li>\n<li>net.ipv4.tcp_syn_retries = 6 主动建立连接时，发SYN的重试次数。</li>\n<li>net.ipv4.ip_local_port_range = 32768 60999 建立连接时的本地端口可用范围。</li>\n<li>ACCEPT列队设置</li>\n</ul>\n</li>\n</ul>\n","categories":["查缺补漏"],"tags":["Http","Tcp","Udp"]},{"title":"MySQL基础（四）","url":"/posts/3237165083/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h2 id=\"练手项目\"><a href=\"#练手项目\" class=\"headerlink\" title=\"练手项目\"></a>练手项目</h2><h3 id=\"牛客网\"><a href=\"#牛客网\" class=\"headerlink\" title=\"牛客网\"></a>牛客网</h3><h4 id=\"准备一个mysql-5-7的数据库\"><a href=\"#准备一个mysql-5-7的数据库\" class=\"headerlink\" title=\"准备一个mysql 5.7的数据库\"></a>准备一个mysql 5.7的数据库</h4><h4 id=\"配置本地数据库\"><a href=\"#配置本地数据库\" class=\"headerlink\" title=\"配置本地数据库\"></a>配置本地数据库</h4><ul>\n<li><p><a href=\"https://launchpad.net/test-db/employees-db-1/1.0.6\" target=\"_blank\" rel=\"noopener\">https://launchpad.net/test-db/employees-db-1/1.0.6</a> 下载文件 <strong>employees_db-full-1.0.6.tar.bz2</strong></p>\n</li>\n<li><p>解压文件</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">➜  employees_db tree </span><br><span class=\"line\">.</span><br><span class=\"line\">├── Changelog</span><br><span class=\"line\">├── README</span><br><span class=\"line\">├── employees.sql</span><br><span class=\"line\">├── employees_partitioned.sql</span><br><span class=\"line\">├── employees_partitioned2.sql</span><br><span class=\"line\">├── employees_partitioned3.sql</span><br><span class=\"line\">├── load_departments.dump</span><br><span class=\"line\">├── load_dept_emp.dump</span><br><span class=\"line\">├── load_dept_manager.dump</span><br><span class=\"line\">├── load_employees.dump</span><br><span class=\"line\">├── load_salaries.dump</span><br><span class=\"line\">├── load_titles.dump</span><br><span class=\"line\">├── objects.sql</span><br><span class=\"line\">├── test_employees_md5.sql</span><br><span class=\"line\">└── test_employees_sha.sql</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>在将文件导入数据库</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql -uroot -p -t &lt; employees.sql</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"解决问题\"><a href=\"#解决问题\" class=\"headerlink\" title=\"解决问题\"></a>解决问题</h4><ul>\n<li>employees.sql 修改内容</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 38行 set storage_engine = InnoDB; 替换</span></span><br><span class=\"line\"><span class=\"keyword\">set</span> default_storage_engine = <span class=\"keyword\">InnoDB</span>;</span><br><span class=\"line\"><span class=\"comment\"># 44行 select CONCAT('storage engine: ', @@storage_engine) as INFO; 替换</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"keyword\">CONCAT</span>(<span class=\"string\">'storage engine: '</span>, @@default_storage_engine) <span class=\"keyword\">as</span> INFO;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>注意导入的时候会出现文件打不开的问题</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"string\">'LOADING departments'</span> <span class=\"keyword\">as</span> <span class=\"string\">'INFO'</span>;</span><br><span class=\"line\">source /home/employees_db/load_departments.dump ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"string\">'LOADING employees'</span> <span class=\"keyword\">as</span> <span class=\"string\">'INFO'</span>;</span><br><span class=\"line\">source /home/employees_db/load_employees.dump ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"string\">'LOADING dept_emp'</span> <span class=\"keyword\">as</span> <span class=\"string\">'INFO'</span>;</span><br><span class=\"line\">source /home/employees_db/load_dept_emp.dump ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"string\">'LOADING dept_manager'</span> <span class=\"keyword\">as</span> <span class=\"string\">'INFO'</span>;</span><br><span class=\"line\">source /home/employees_db/load_dept_manager.dump ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"string\">'LOADING titles'</span> <span class=\"keyword\">as</span> <span class=\"string\">'INFO'</span>;</span><br><span class=\"line\">source /home/employees_db/load_titles.dump ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"string\">'LOADING salaries'</span> <span class=\"keyword\">as</span> <span class=\"string\">'INFO'</span>;</span><br><span class=\"line\">source /home/employees_db/load_salaries.dump ;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>这里要将文件正确的路径写进去。</p>\n</li>\n<li><p>如果是本地的docker环境部署mysql，可以使用docker cp 命令将文件复制到容器中。在登陆到容器执行导入脚本</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">// 从宿主机器拷贝到容器中</span><br><span class=\"line\">docker cp ~/Downloads/employees_db laughing_black:/home</span><br><span class=\"line\">// laughing_black 是容器的名称</span><br><span class=\"line\"></span><br><span class=\"line\">// 从容器中拷贝会宿主机器中</span><br><span class=\"line\">docker cp laughing_black:/employees_db.sql .</span><br></pre></td></tr></table></figure>\n\n","categories":["Mysql"],"tags":["Mysql"]},{"title":"Snowflake","url":"/posts/2519242267/","content":"<h1 id=\"Snowflake\"><a href=\"#Snowflake\" class=\"headerlink\" title=\"Snowflake\"></a>Snowflake</h1><blockquote>\n<p>Snowflake，雪花算法是由Twitter开源的分布式ID生成算法，以划分命名空间的方式将 64-bit位分割成多个部分，每个部分代表不同的含义。这种就是将64位划分为不同的段，每段代表不同的涵义，基本就是时间戳、机器ID和序列数，当然这种方案就是需要考虑时钟回拨的问题以及做一些 buffer的缓冲设计提高性能。</p>\n</blockquote>\n<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><blockquote>\n<p>Twitter 早期用 MySQL 存储数据，随着用户的增长，单一的 MySQL 实例没法承受海量的数据，开发团队就开始用 <a href=\"http://cassandra.apache.org/\" target=\"_blank\" rel=\"noopener\">Cassandra</a> 和 sharded MySQL 替代原有的系统。然而和 MySQL 不同的是，Cassandra 没有内置为每一条数据生成唯一 ID 的功能，因为在一个分布式环境下，很难有完美的 ID 生成方案。</p>\n</blockquote>\n<ul>\n<li>对于 Twitter 而言，这样的 ID 生成方案要满足两个基本的要求，一是每秒能生成几十万条 ID 用于标识不同的 tweet；二是这些 ID 应该可以有个大致的顺序，也就是说发布时间相近的两条 tweet，它们的 ID 也应当相近，这样才能方便各种客户端对 tweet 进行排序。</li>\n<li>第一个要求意味着 ID 生成要以一种非协作的（uncoordinated）的方式进行，例如不能有一个全局的原子变量。</li>\n<li>第二个要求使得 tweet 按 ID 排序后满足 <a href=\"http://ci.nii.ac.jp/naid/110002673489/\" target=\"_blank\" rel=\"noopener\">k-sorted</a> 条件。如果序列 A 要满足 k-sorted，当且仅当对于任意的 p, q，如果 1 &lt;= p &lt;= q - k (1 &lt;= p &lt;= q &lt;= n)，则有 A[p] &lt;= A[q]。换句话说，如果元素 p 排在 q 前面，且相差至少 k 个位置，那么 p 必然小于或等于 q。如果 tweet 序列满足这个条件，要获取第 r 条 tweet 之后的消息，只要从第 r - k 条开始查找即可。</li>\n<li>Twitter 解决这两个问题的方案非常简单高效：每一个 ID 都是 64 位数字，由时间戳、节点号和序列编号组成。其中序列编号是每个节点本地生成的序号，而节点号则由 <a href=\"http://zookeeper.apache.org/\" target=\"_blank\" rel=\"noopener\">ZooKeeper</a> 维护。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211227152630.png\"></p>\n<ul>\n<li>官网给出的代码是scala写出来的<a href=\"https://github.com/twitter-archive/snowflake/blob/snowflake-2010/src/main/scala/com/twitter/service/snowflake/IdWorker.scala\" target=\"_blank\" rel=\"noopener\">代码</a>。</li>\n<li><strong>1bit</strong>，不用，因为二进制中最高位是符号位，1表示负数，0表示正数。生成的id一般都是用整数，所以最高位固定为0。</li>\n<li><strong>41bit-时间戳</strong>，用来记录时间戳，毫秒级。<ul>\n<li>41位可以表示2^41-1个数字，<br>- 如果只用来表示正整数（计算机中正数包含0），可以表示的数值范围是：0 至 2^41-1，减1是因为可表示的数值范围是从0开始算的，而不是1。<br>- 也就是说41位可以表示2^41-1个毫秒的值，转化成单位年则是(2^{41}-1) / (1000 * 60 * 60 * 24 *365) = 69年</li>\n</ul>\n</li>\n<li><strong>10bit-工作机器id</strong>，用来记录工作机器id。<ul>\n<li>可以部署在2^{10} = 1024个节点，包括5位datacenterId和5位workerId</li>\n<li>5位（bit）可以表示的最大正整数是2^{5}-1 = 31，即可以用0、1、2、3、….31这32个数字，来表示不同的datecenterId或workerId</li>\n</ul>\n</li>\n<li><strong>12bit-序列号</strong>，序列号，用来记录同毫秒内产生的不同id。<br> -  12位（bit）可以表示的最大正整数是2^{12}-1 = 4095，即可以用0、1、2、3、….4094这4095个数字，来表示同一机器同一时间截（毫秒)内产生的4095个ID序号。</li>\n</ul>\n<a id=\"more\"></a>\n\n<h2 id=\"Java实现\"><a href=\"#Java实现\" class=\"headerlink\" title=\"Java实现\"></a>Java实现</h2><blockquote>\n<p>由于在Java中64bit的整数是long类型，所以在Java中SnowFlake算法生成的id就是long来存储的。</p>\n</blockquote>\n<ul>\n<li>所有id生成按照时间趋势递增</li>\n<li>理论上分布式系统不会生产重复id（因为有datacenterId和workerId来做区分）</li>\n</ul>\n<h3 id=\"pom依赖\"><a href=\"#pom依赖\" class=\"headerlink\" title=\"pom依赖\"></a>pom依赖</h3><figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- JMH基准测试 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.openjdk.jmh<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jmh-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.21<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.openjdk.jmh<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jmh-generator-annprocess<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.21<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 单元测试 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.junit.jupiter<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit-jupiter-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.7.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.junit.jupiter<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit-jupiter-engine<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.7.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Java代码\"><a href=\"#Java代码\" class=\"headerlink\" title=\"Java代码\"></a>Java代码</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.example;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.time.Clock;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnowflakeDistributeId</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 开始时间截，这里用系统的时间戳</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> startTime = <span class=\"number\">1420041600000L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 机器id所占的位数 5 位</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> WORKER_ID_BITS = <span class=\"number\">5L</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 序列在id中占的位数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">long</span> SEQUENCE_BITS = <span class=\"number\">12L</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 数据标识id所占的位数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> DATA_CENTER_ID_BITS = <span class=\"number\">5L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 数据中心最大数量。支持的最大机器id，结果是31 (这个移位算法可以很快计算出几位二进制数所能表示的最大十进制数)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> maxWorkerId = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; WORKER_ID_BITS); <span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 支持的最大数据标识id，结果是31</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> maxDatacenterId = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; DATA_CENTER_ID_BITS);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 机器ID向左移12位</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> workerIdShift = SEQUENCE_BITS;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 数据标识id向左移17位(12+5)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> datacenterIdShift = SEQUENCE_BITS + WORKER_ID_BITS;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间截向左移22位(5+5+12)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> timestampLeftShift = SEQUENCE_BITS + WORKER_ID_BITS + DATA_CENTER_ID_BITS;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生成序列的掩码，这里为4095 (0b111111111111=0xfff=4095)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> sequenceMask = -<span class=\"number\">1L</span> ^ (-<span class=\"number\">1L</span> &lt;&lt; SEQUENCE_BITS);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 工作机器ID(0~31)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> workerId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 数据中心ID(0~31)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> datacenterId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 毫秒内序列(0~4095)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> sequence = <span class=\"number\">0L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 上次生成ID的时间截</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> lastTimestamp = -<span class=\"number\">1L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 禁止参的构造，规避创建对象时候使用默认的机器码</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">SnowflakeDistributeId</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> workerId     工作ID (0~31)</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> datacenterId 数据中心ID (0~31)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SnowflakeDistributeId</span><span class=\"params\">(<span class=\"keyword\">long</span> workerId, <span class=\"keyword\">long</span> datacenterId)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (workerId &gt; maxWorkerId || workerId &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(String.format(<span class=\"string\">\"worker Id can't be greater than %d or less than 0\"</span>, maxWorkerId));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (datacenterId &gt; maxDatacenterId || datacenterId &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(String.format(<span class=\"string\">\"datacenter Id can't be greater than %d or less than 0\"</span>, maxDatacenterId));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.workerId = workerId;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.datacenterId = datacenterId;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获得下一个ID (该方法是线程安全的)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> SnowflakeId</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">long</span> <span class=\"title\">nextId</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">long</span> timestamp = Clock.systemDefaultZone().millis();</span><br><span class=\"line\">        <span class=\"comment\">//如果当前时间小于上一次ID生成的时间戳，说明系统时钟回退过这个时候应当抛出异常</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (timestamp &lt; lastTimestamp) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(</span><br><span class=\"line\">                    String.format(<span class=\"string\">\"Clock moved backwards.  Refusing to generate id for %d milliseconds\"</span>, lastTimestamp - timestamp));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//如果是同一时间生成的，则进行毫秒内序列</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (lastTimestamp == timestamp) &#123;</span><br><span class=\"line\">            sequence = (sequence + <span class=\"number\">1</span>) &amp; sequenceMask;</span><br><span class=\"line\">            <span class=\"comment\">//毫秒内序列溢出,序列数已经达到最大</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (sequence == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//阻塞到下一个毫秒,获得新的时间戳</span></span><br><span class=\"line\">                timestamp = tilNextMillis(lastTimestamp);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//时间戳改变，毫秒内序列重置</span></span><br><span class=\"line\">            sequence = <span class=\"number\">0L</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//上次生成ID的时间截</span></span><br><span class=\"line\">        lastTimestamp = timestamp;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//移位并通过或运算拼到一起组成64位的ID</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ((timestamp - startTime) &lt;&lt; timestampLeftShift) <span class=\"comment\">// 时间戳部分</span></span><br><span class=\"line\">                | (datacenterId &lt;&lt; datacenterIdShift) <span class=\"comment\">// 数据中心部分</span></span><br><span class=\"line\">                | (workerId &lt;&lt; workerIdShift) <span class=\"comment\">// 机器标识符部分</span></span><br><span class=\"line\">                | sequence; <span class=\"comment\">// 序列号部分</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 阻塞到下一个毫秒，直到获得新的时间戳</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> lastTimestamp 上次生成ID的时间截</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 当前时间戳</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">long</span> <span class=\"title\">tilNextMillis</span><span class=\"params\">(<span class=\"keyword\">long</span> lastTimestamp)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">long</span> timestamp = Clock.systemDefaultZone().millis();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (timestamp &lt;= lastTimestamp) &#123;</span><br><span class=\"line\">            timestamp = Clock.systemDefaultZone().millis();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> timestamp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"JMH基准测试\"><a href=\"#JMH基准测试\" class=\"headerlink\" title=\"JMH基准测试\"></a>JMH基准测试</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.example;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.openjdk.jmh.annotations.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.openjdk.jmh.results.format.ResultFormatType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.openjdk.jmh.runner.Runner;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.openjdk.jmh.runner.RunnerException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.openjdk.jmh.runner.options.Options;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.openjdk.jmh.runner.options.OptionsBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SnowflakeDistributeIdTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> Integer MEASUREMENT_ITERATIONS = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> Integer WARMUP_ITERATIONS = <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> RunnerException </span>&#123;</span><br><span class=\"line\">        Options opt = <span class=\"keyword\">new</span> OptionsBuilder()</span><br><span class=\"line\">                <span class=\"comment\">// 设置类名正则表达式基准为搜索当前类</span></span><br><span class=\"line\">                .include(\"\\\\.\" + SnowflakeDistributeIdTest.class.getSimpleName() + \"\\\\.\")</span><br><span class=\"line\">                <span class=\"comment\">// 都是一些基本的参数，可以根据具体情况调整。一般比较重的东西可以进行大量的测试，放到服务器上运行。</span></span><br><span class=\"line\">                .warmupIterations(WARMUP_ITERATIONS) <span class=\"comment\">// 多少次预热</span></span><br><span class=\"line\">                .measurementIterations(MEASUREMENT_ITERATIONS) <span class=\"comment\">// 要做多少次测量m</span></span><br><span class=\"line\">                .timeUnit(TimeUnit.MILLISECONDS) <span class=\"comment\">// 毫秒</span></span><br><span class=\"line\">                <span class=\"comment\">// 不使用多线程</span></span><br><span class=\"line\">                .forks(<span class=\"number\">1</span>) <span class=\"comment\">// 进行 fork 的次数。如果 fork 数是2的话，则 JMH 会 fork 出两个进程来进行测试。</span></span><br><span class=\"line\">                .threads(<span class=\"number\">1</span>) <span class=\"comment\">// 每个进程中的测试线程，这个非常好理解，根据具体情况选择，一般为cpu乘以2。</span></span><br><span class=\"line\">                <span class=\"comment\">// Throughput 整体吞吐量，例如”1秒内可以执行多少次调用”。</span></span><br><span class=\"line\">                <span class=\"comment\">// AverageTime: 调用的平均时间，例如”每次调用平均耗时xxx毫秒”。</span></span><br><span class=\"line\">                <span class=\"comment\">// SampleTime: 随机取样，最后输出取样结果的分布，例如”99%的调用在xxx毫秒以内，99.99%的调用在xxx毫秒以内”</span></span><br><span class=\"line\">                <span class=\"comment\">// SingleShotTime: 以上模式都是默认一次 iteration 是 1s，唯有 SingleShotTime 是只运行一次。往往同时把 warmup 次数设为0，用于测试冷启动时的性能。</span></span><br><span class=\"line\">                <span class=\"comment\">// All(“all”, “All benchmark modes”);</span></span><br><span class=\"line\">                .mode(Mode.AverageTime)</span><br><span class=\"line\">                .shouldDoGC(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">                .shouldFailOnError(<span class=\"keyword\">true</span>)             <span class=\"comment\">//</span></span><br><span class=\"line\">                .resultFormat(ResultFormatType.JSON) <span class=\"comment\">// 输出格式化</span></span><br><span class=\"line\"><span class=\"comment\">//                .result(\"/dev/null\") // set this to a valid filename if you want reports</span></span><br><span class=\"line\">                .result(<span class=\"string\">\"benchmark.log\"</span>)</span><br><span class=\"line\">                .shouldFailOnError(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">                .jvmArgs(<span class=\"string\">\"-server\"</span>)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        <span class=\"keyword\">new</span> Runner(opt).run();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Benchmark 方法级注解，表示该方法是需要进行 benchmark 的对象，用法和 JUnit 的 <span class=\"doctag\">@Test</span> 类似。</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Benchmark</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testSnowflakeDistributeId</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        SnowflakeDistributeId idWorker = <span class=\"keyword\">new</span> SnowflakeDistributeId(<span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000000</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">long</span> id = idWorker.nextId();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"jmhVersion\"</span> : <span class=\"string\">\"1.21\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"benchmark\"</span> : <span class=\"string\">\"cn.z201.example.SnowflakeDistributeIdTest.testSnowflakeDistributeId\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"mode\"</span> : <span class=\"string\">\"avgt\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"threads\"</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"forks\"</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"jvm\"</span> : <span class=\"string\">\"/Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home/jre/bin/java\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"jvmArgs\"</span> : [</span><br><span class=\"line\">            <span class=\"string\">\"-server\"</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"attr\">\"jdkVersion\"</span> : <span class=\"string\">\"1.8.0_275\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"vmName\"</span> : <span class=\"string\">\"OpenJDK 64-Bit Server VM\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"vmVersion\"</span> : <span class=\"string\">\"25.275-b01\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"warmupIterations\"</span> : <span class=\"number\">10</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"warmupTime\"</span> : <span class=\"string\">\"10 s\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"warmupBatchSize\"</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"measurementIterations\"</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"measurementTime\"</span> : <span class=\"string\">\"10 s\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"measurementBatchSize\"</span> : <span class=\"number\">1</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"primaryMetric\"</span> : &#123;</span><br><span class=\"line\">            <span class=\"attr\">\"score\"</span> : <span class=\"number\">244.1343217804878</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"scoreError\"</span> : <span class=\"string\">\"NaN\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"scoreConfidence\"</span> : [</span><br><span class=\"line\">                <span class=\"string\">\"NaN\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"NaN\"</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"attr\">\"scorePercentiles\"</span> : &#123;</span><br><span class=\"line\">                <span class=\"attr\">\"0.0\"</span> : <span class=\"number\">244.1343217804878</span>,</span><br><span class=\"line\">                <span class=\"attr\">\"50.0\"</span> : <span class=\"number\">244.1343217804878</span>,</span><br><span class=\"line\">                <span class=\"attr\">\"90.0\"</span> : <span class=\"number\">244.1343217804878</span>,</span><br><span class=\"line\">                <span class=\"attr\">\"95.0\"</span> : <span class=\"number\">244.1343217804878</span>,</span><br><span class=\"line\">                <span class=\"attr\">\"99.0\"</span> : <span class=\"number\">244.1343217804878</span>,</span><br><span class=\"line\">                <span class=\"attr\">\"99.9\"</span> : <span class=\"number\">244.1343217804878</span>,</span><br><span class=\"line\">                <span class=\"attr\">\"99.99\"</span> : <span class=\"number\">244.1343217804878</span>,</span><br><span class=\"line\">                <span class=\"attr\">\"99.999\"</span> : <span class=\"number\">244.1343217804878</span>,</span><br><span class=\"line\">                <span class=\"attr\">\"99.9999\"</span> : <span class=\"number\">244.1343217804878</span>,</span><br><span class=\"line\">                <span class=\"attr\">\"100.0\"</span> : <span class=\"number\">244.1343217804878</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"attr\">\"scoreUnit\"</span> : <span class=\"string\">\"ms/op\"</span>,</span><br><span class=\"line\">            <span class=\"attr\">\"rawData\"</span> : [</span><br><span class=\"line\">                [</span><br><span class=\"line\">                    <span class=\"number\">244.1343217804878</span></span><br><span class=\"line\">                ]</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">\"secondaryMetrics\"</span> : &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>生成比较平稳。还没测试在多线程情况下的效果。</li>\n</ul>\n","categories":["算法"],"tags":["分布式","算法"]},{"title":"Redis-Geo","url":"/posts/786198647/","content":"<h3 id=\"源码地址\"><a href=\"#源码地址\" class=\"headerlink\" title=\"源码地址\"></a><a href=\"https://github.com/z201/code-example/tree/main/Redis-Geo\" target=\"_blank\" rel=\"noopener\">源码地址</a></h3><h3 id=\"Geo\"><a href=\"#Geo\" class=\"headerlink\" title=\"Geo\"></a>Geo</h3><blockquote>\n<p>Redis 在 3.2 版本中增加了 GEO 类型用于存储和查询地理位置。</p>\n</blockquote>\n<ul>\n<li><p>GEOADD：添加地理位置</p>\n</li>\n<li><p>GEOPOS：查询位置信息</p>\n</li>\n<li><p>GEODIST：距离统计</p>\n</li>\n<li><p>GEORADIUS：以给定的经纬度为中心， 找出某一半径内的元素</p>\n</li>\n<li><p>GEORADIUSBYMEMBER 找出位于指定范围内的元素，中心点是由给定的位置元素决定</p>\n</li>\n<li><p>GEOHASH：返回一个或多个位置元素HASH</p>\n</li>\n<li><p>关于删除，使用集合函数中的zrem，geo本质存在一个集合中。</p>\n</li>\n</ul>\n<h3 id=\"演示效果\"><a href=\"#演示效果\" class=\"headerlink\" title=\"演示效果\"></a>演示效果</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211224143558.png\"></p>\n<ul>\n<li>使用百度地图，标记出5个坐标。<a href=\"https://api.map.baidu.com/lbsapi/getpoint/index.html\" target=\"_blank\" rel=\"noopener\">百度地图坐标获取</a>  <a href=\"https://map.baidu.com/\" target=\"_blank\" rel=\"noopener\">百度地图</a></li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1.杭州市 蒋村商务中心 120.075338,30.294845</span></span><br><span class=\"line\"><span class=\"comment\">// 2.杭州市 中节能西溪首座 120.081806,30.294907</span></span><br><span class=\"line\"><span class=\"comment\">// 3.杭州市 西溪蝶园 120.070452,30.294221</span></span><br><span class=\"line\"><span class=\"comment\">// 4.杭州市 西溪财富中心 120.077854,30.296342</span></span><br><span class=\"line\"><span class=\"comment\">// 5.杭州市 九橙 西溪创投中心 120.055468,30.284523</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用redis-cli作为客户端测试工具 geo 集合key = hz</li>\n</ul>\n<a id=\"more\"></a>\n\n<h4 id=\"GEOADD\"><a href=\"#GEOADD\" class=\"headerlink\" title=\"GEOADD\"></a>GEOADD</h4><ul>\n<li>添加坐标信息</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; geoadd hz 120.075338 30.294845 1 </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; geoadd hz 120.081806 30.294907 2</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; geoadd hz 120.070452 30.294221 3</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; geoadd hz 120.077854 30.296342 4</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; geoadd hz 120.055468 30.284523 5</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"GEOPOS\"><a href=\"#GEOPOS\" class=\"headerlink\" title=\"GEOPOS\"></a>GEOPOS</h4><ul>\n<li>从键里面返回所有给定位置元素的位置（经度和纬度）</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; geopos hz 1 2 </span><br><span class=\"line\">1) 1) <span class=\"string\">\"120.07533878087997437\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"30.29484408467364176\"</span></span><br><span class=\"line\">2) 1) <span class=\"string\">\"120.08180826902389526\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"30.29490745270262408\"</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"GEODIST\"><a href=\"#GEODIST\" class=\"headerlink\" title=\"GEODIST\"></a>GEODIST</h4><ul>\n<li>返回两个给定位置之间的距离。如果两个位置之间的其中一个不存在， 那么命令返回空值。</li>\n<li>指定单位的参数 <code>unit</code> 必须是以下单位的其中一个<ul>\n<li><code>m</code> 表示单位为米。</li>\n<li><code>km</code> 表示单位为千米。</li>\n<li><code>mi</code> 表示单位为英里。</li>\n<li><code>ft</code> 表示单位为英尺。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; geodist hz 1 2 m</span><br><span class=\"line\"><span class=\"string\">\"621.3522\"</span></span><br><span class=\"line\"><span class=\"comment\"># 获取 1 和 2 之间的距离米</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>拿<strong>百度地图</strong>的尺子测试下。差了6米问题不大。精度不高的业务够用了。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211224150747.png\"></p>\n<h4 id=\"GEORADIUS\"><a href=\"#GEORADIUS\" class=\"headerlink\" title=\"GEORADIUS\"></a>GEORADIUS</h4><ul>\n<li>以给定的经纬度为中心， 返回键包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。</li>\n<li>范围可以使用以下其中一个单位：<ul>\n<li><code>m</code> 表示单位为米。</li>\n<li><code>km</code> 表示单位为千米。</li>\n<li><code>mi</code> 表示单位为英里。</li>\n<li><code>ft</code> 表示单位为英尺。</li>\n</ul>\n</li>\n<li>在给定以下可选项时， 命令会返回额外的信息：<ul>\n<li><code>WITHDIST</code> ： 在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。 距离的单位和用户给定的范围单位保持一致。</li>\n<li><code>WITHCOORD</code> ： 将位置元素的经度和维度也一并返回。</li>\n<li><code>WITHHASH</code> ： 以 52 位有符号整数的形式， 返回位置元素经过原始 geohash 编码的有序集合分值。 这个选项主要用于底层应用或者调试， 实际中的作用并不大。</li>\n</ul>\n</li>\n<li>默认命令的排序<ul>\n<li><code>ASC</code> ： 根据中心的位置， 按照从近到远的方式返回位置元素。</li>\n<li><code>DESC</code> ： 根据中心的位置， 按照从远到近的方式返回位置元素。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; georadius hz 120.075338 30.294845 500 m </span><br><span class=\"line\">1) <span class=\"string\">\"3\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"1\"</span></span><br><span class=\"line\">3) <span class=\"string\">\"4\"</span></span><br><span class=\"line\"><span class=\"comment\"># 中心坐标 120.075338 30.294845 500m内的位置。</span></span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; georadius hz 120.075338 30.294845 500 m WITHDIST</span><br><span class=\"line\">1) 1) <span class=\"string\">\"3\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"474.3718\"</span></span><br><span class=\"line\">2) 1) <span class=\"string\">\"1\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"0.1264\"</span></span><br><span class=\"line\">3) 1) <span class=\"string\">\"4\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"293.5036\"</span></span><br><span class=\"line\"><span class=\"comment\"># 中心坐标 120.075338 30.294845 500m内的位置,并显示距离m。</span></span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; georadius hz 120.075338 30.294845 500 m WITHDIST WITHCOORD ASC</span><br><span class=\"line\">1) 1) <span class=\"string\">\"1\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"0.1264\"</span></span><br><span class=\"line\">   3) 1) <span class=\"string\">\"120.07533878087997437\"</span></span><br><span class=\"line\">      2) <span class=\"string\">\"30.29484408467364176\"</span></span><br><span class=\"line\">2) 1) <span class=\"string\">\"4\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"293.5036\"</span></span><br><span class=\"line\">   3) 1) <span class=\"string\">\"120.0778546929359436\"</span></span><br><span class=\"line\">      2) <span class=\"string\">\"30.29634210487881063\"</span></span><br><span class=\"line\">3) 1) <span class=\"string\">\"3\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"474.3718\"</span></span><br><span class=\"line\">   3) 1) <span class=\"string\">\"120.07045179605484009\"</span></span><br><span class=\"line\">      2) <span class=\"string\">\"30.2942205432684446\"</span></span><br><span class=\"line\"><span class=\"comment\"># 中心坐标 120.075338 30.294845 500m内的位置,并显示距离,ASC排序。</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>一般用来做<strong>附近的人(建筑等等)</strong></li>\n</ul>\n<h4 id=\"GEORADIUSBYMEMBER\"><a href=\"#GEORADIUSBYMEMBER\" class=\"headerlink\" title=\"GEORADIUSBYMEMBER\"></a>GEORADIUSBYMEMBER</h4><ul>\n<li><p>找出位于指定范围内的元素，参数是元素而不是坐标。</p>\n</li>\n<li><p>范围可以使用以下其中一个单位：</p>\n<ul>\n<li><code>m</code> 表示单位为米。</li>\n<li><code>km</code> 表示单位为千米。</li>\n<li><code>mi</code> 表示单位为英里。</li>\n<li><code>ft</code> 表示单位为英尺。</li>\n</ul>\n</li>\n<li><p>在给定以下可选项时， 命令会返回额外的信息：</p>\n<ul>\n<li><code>WITHDIST</code> ： 在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。 距离的单位和用户给定的范围单位保持一致。</li>\n<li><code>WITHCOORD</code> ： 将位置元素的经度和维度也一并返回。</li>\n<li><code>WITHHASH</code> ： 以 52 位有符号整数的形式， 返回位置元素经过原始 geohash 编码的有序集合分值。 这个选项主要用于底层应用或者调试， 实际中的作用并不大。</li>\n</ul>\n</li>\n<li><p>默认命令的排序</p>\n<ul>\n<li><code>ASC</code> ： 根据中心的位置， 按照从近到远的方式返回位置元素。</li>\n<li><code>DESC</code> ： 根据中心的位置， 按照从远到近的方式返回位置元素。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; GEORADIUSBYMEMBER hz 1 500 m</span><br><span class=\"line\">1) <span class=\"string\">\"3\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"1\"</span></span><br><span class=\"line\">3) <span class=\"string\">\"4\"</span></span><br><span class=\"line\"><span class=\"comment\"># 元素 500m的元素</span></span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; GEORADIUSBYMEMBER hz 1 500 m WITHDIST WITHCOORD ASC</span><br><span class=\"line\">1) 1) <span class=\"string\">\"1\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"0.0000\"</span></span><br><span class=\"line\">   3) 1) <span class=\"string\">\"120.07533878087997437\"</span></span><br><span class=\"line\">      2) <span class=\"string\">\"30.29484408467364176\"</span></span><br><span class=\"line\">2) 1) <span class=\"string\">\"4\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"293.4996\"</span></span><br><span class=\"line\">   3) 1) <span class=\"string\">\"120.0778546929359436\"</span></span><br><span class=\"line\">      2) <span class=\"string\">\"30.29634210487881063\"</span></span><br><span class=\"line\">3) 1) <span class=\"string\">\"3\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"474.4311\"</span></span><br><span class=\"line\">   3) 1) <span class=\"string\">\"120.07045179605484009\"</span></span><br><span class=\"line\">      2) <span class=\"string\">\"30.2942205432684446\"</span></span><br><span class=\"line\"><span class=\"comment\"># 元素 500m的元素包含完整信息。</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>一般用来做<strong>附近的人(建筑等等)</strong></li>\n</ul>\n<h4 id=\"GEOHASH\"><a href=\"#GEOHASH\" class=\"headerlink\" title=\"GEOHASH\"></a>GEOHASH</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; GEOHASH hz 1 2 3 </span><br><span class=\"line\">1) <span class=\"string\">\"wtmkk7h0q00\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"wtmkke0bsu0\"</span></span><br><span class=\"line\">3) <span class=\"string\">\"wtmkk6bssk0\"</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"删除坐标\"><a href=\"#删除坐标\" class=\"headerlink\" title=\"删除坐标\"></a>删除坐标</h4><ul>\n<li>关于删除，使用集合函数中的zrem，geo本质存在一个集合中。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; GEORADIUSBYMEMBER hz 1 500 m</span><br><span class=\"line\">1) <span class=\"string\">\"3\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"1\"</span></span><br><span class=\"line\">3) <span class=\"string\">\"4\"</span></span><br><span class=\"line\"><span class=\"comment\"># 元素 500m的元素</span></span><br><span class=\"line\">127.0.0.1:6379&gt; zrem hz 4</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">127.0.0.1:6379&gt; GEORADIUSBYMEMBER hz 1 500 m</span><br><span class=\"line\">1) <span class=\"string\">\"3\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"1\"</span></span><br><span class=\"line\"><span class=\"comment\"># 将 4 元素删除后只能看到 3 1 了。</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"代码演示\"><a href=\"#代码演示\" class=\"headerlink\" title=\"代码演示\"></a>代码演示</h3><ul>\n<li>spring boot 2.4.5</li>\n<li>gson</li>\n</ul>\n<h3 id=\"配置项目\"><a href=\"#配置项目\" class=\"headerlink\" title=\"配置项目\"></a>配置项目</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021/12/24</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisConfig</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 防止key 出现乱码</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> RedisTemplate <span class=\"title\">redisTemplate</span><span class=\"params\">(LettuceConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class=\"line\">        RedisTemplate template = <span class=\"keyword\">new</span> RedisTemplate();</span><br><span class=\"line\">        RedisSerializer&lt;String&gt; redisSerializer = <span class=\"keyword\">new</span> StringRedisSerializer();</span><br><span class=\"line\">        template.setConnectionFactory(connectionFactory);</span><br><span class=\"line\">        <span class=\"comment\">// key序列化方式</span></span><br><span class=\"line\">        template.setKeySerializer(redisSerializer);</span><br><span class=\"line\">        <span class=\"comment\">// value序列化</span></span><br><span class=\"line\">        template.setValueSerializer(redisSerializer);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> template;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> StringRedisTemplate <span class=\"title\">stringRedisTemplate</span><span class=\"params\">(LettuceConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class=\"line\">        StringRedisTemplate stringRedisTemplate = <span class=\"keyword\">new</span> StringRedisTemplate();</span><br><span class=\"line\">        stringRedisTemplate.setConnectionFactory(connectionFactory);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> stringRedisTemplate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"单元测试代码\"><a href=\"#单元测试代码\" class=\"headerlink\" title=\"单元测试代码\"></a>单元测试代码</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">    </span><br><span class=\"line\"> <span class=\"keyword\">package</span> cn.z201.redis;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.gson.Gson;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.gson.GsonBuilder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.extension.ExtendWith;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.geo.Circle;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.geo.Distance;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.geo.GeoResults;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.geo.Point;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisGeoCommands;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.test.context.junit.jupiter.SpringExtension;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.*;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"meta\">@ExtendWith</span>(SpringExtension<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\">@<span class=\"title\">SpringBootTest</span>(<span class=\"title\">classes</span> </span>= AppApplication<span class=\"class\">.<span class=\"keyword\">class</span>, <span class=\"title\">webEnvironment</span> </span>= SpringBootTest.WebEnvironment.NONE)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppApplicationTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testGeo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 1.杭州市 蒋村商务中心 120.075338,30.294845</span></span><br><span class=\"line\">        <span class=\"comment\">// 2.杭州市 中节能西溪首座 120.081806,30.294907</span></span><br><span class=\"line\">        <span class=\"comment\">// 3.杭州市 西溪蝶园 120.070452,30.294221</span></span><br><span class=\"line\">        <span class=\"comment\">// 4.杭州市 西溪财富中心 120.077854,30.296342</span></span><br><span class=\"line\">        <span class=\"comment\">// 5.杭州市 九橙 西溪创投中心 120.055468,30.284523</span></span><br><span class=\"line\">        Map&lt;String, Point&gt; points = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        points.put(<span class=\"string\">\"1\"</span>, <span class=\"keyword\">new</span> Point(<span class=\"number\">120.075338</span>, <span class=\"number\">30.294845</span>));</span><br><span class=\"line\">        points.put(<span class=\"string\">\"2\"</span>, <span class=\"keyword\">new</span> Point(<span class=\"number\">120.081806</span>, <span class=\"number\">30.294907</span>));</span><br><span class=\"line\">        points.put(<span class=\"string\">\"3\"</span>, <span class=\"keyword\">new</span> Point(<span class=\"number\">120.070452</span>, <span class=\"number\">30.294221</span>));</span><br><span class=\"line\">        points.put(<span class=\"string\">\"4\"</span>, <span class=\"keyword\">new</span> Point(<span class=\"number\">120.077854</span>, <span class=\"number\">30.296342</span>));</span><br><span class=\"line\">        points.put(<span class=\"string\">\"5\"</span>, <span class=\"keyword\">new</span> Point(<span class=\"number\">120.055468</span>, <span class=\"number\">30.284523</span>));</span><br><span class=\"line\">        Long result = redisTemplate.opsForGeo().add(<span class=\"string\">\"site\"</span>, points);</span><br><span class=\"line\">        log.info(<span class=\"string\">\"&#123;&#125;\"</span>, result);</span><br><span class=\"line\">        Set&lt;String&gt; keys = redisTemplate.keys(<span class=\"string\">\"*\"</span>);</span><br><span class=\"line\">        Gson gson = <span class=\"keyword\">new</span> GsonBuilder().setPrettyPrinting().create();</span><br><span class=\"line\">        log.info(<span class=\"string\">\"size -&gt; &#123;&#125; \"</span>, keys.size());</span><br><span class=\"line\">        List&lt;Point&gt; pointList = redisTemplate.opsForGeo().position(<span class=\"string\">\"site\"</span>, <span class=\"string\">\"1\"</span>, <span class=\"string\">\"2\"</span>);</span><br><span class=\"line\">        log.info(<span class=\"string\">\"pointList -&gt; &#123;&#125; \"</span>, gson.toJson(pointList));</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * \tMETERS(6378137, \"m\"),</span></span><br><span class=\"line\"><span class=\"comment\">         * \tKILOMETERS(6378.137, \"km\"),</span></span><br><span class=\"line\"><span class=\"comment\">         * \tMILES(3963.191, \"mi\"),</span></span><br><span class=\"line\"><span class=\"comment\">         * \tFEET(20925646.325, \"ft\");</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        Distance distance = redisTemplate.opsForGeo().distance(<span class=\"string\">\"site\"</span>, <span class=\"string\">\"1\"</span>, <span class=\"string\">\"2\"</span>, RedisGeoCommands.DistanceUnit.KILOMETERS);</span><br><span class=\"line\">        log.info(<span class=\"string\">\"distance -&gt; &#123;&#125; \"</span>, gson.toJson(distance));</span><br><span class=\"line\">        Circle circle = <span class=\"keyword\">new</span> Circle(<span class=\"keyword\">new</span> Point(<span class=\"number\">120.075338</span>, <span class=\"number\">30.294845</span>), <span class=\"keyword\">new</span> Distance(<span class=\"number\">500</span>, RedisGeoCommands.DistanceUnit.KILOMETERS));</span><br><span class=\"line\">        RedisGeoCommands.GeoRadiusCommandArgs args = RedisGeoCommands.GeoRadiusCommandArgs.newGeoRadiusArgs()</span><br><span class=\"line\">                .includeDistance()</span><br><span class=\"line\">                .includeCoordinates()</span><br><span class=\"line\">                .sortAscending();</span><br><span class=\"line\">        log.info(<span class=\"string\">\"geoLocationGeoResults -&gt; &#123;&#125; \"</span>, gson.toJson(args));</span><br><span class=\"line\">        GeoResults&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; geoLocationGeoResults = redisTemplate.opsForGeo().radius(<span class=\"string\">\"site\"</span>, circle, args);</span><br><span class=\"line\">        log.info(<span class=\"string\">\"geoLocationGeoResults -&gt; &#123;&#125; \"</span>, gson.toJson(geoLocationGeoResults));</span><br><span class=\"line\">        keys.forEach(item -&gt; &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (!Objects.equals(<span class=\"string\">\"hz\"</span>, item)) &#123;</span><br><span class=\"line\">                        redisTemplate.delete(item);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    log.info(<span class=\"string\">\" keys - &gt; &#123;&#125; \"</span>, item);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>GEORADIUSBYMEMBER 方法过期了，这里就不演示了。</li>\n</ul>\n<h3 id=\"End\"><a href=\"#End\" class=\"headerlink\" title=\"End\"></a>End</h3>","categories":["Redis"],"tags":["Redis","Geo"]},{"title":"Tcpdump入门","url":"/posts/2803052659/","content":"<h2 id=\"Tcpdump\"><a href=\"#Tcpdump\" class=\"headerlink\" title=\"Tcpdump\"></a>Tcpdump</h2><blockquote>\n<p>dump the traffic on a network，根据使用者的定义对网络上的数据包进行截获的包分析工具。</p>\n</blockquote>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><h4 id=\"linux\"><a href=\"#linux\" class=\"headerlink\" title=\"linux\"></a>linux</h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install tcpdump</span><br><span class=\"line\">[root@~]<span class=\"comment\"># tcpdump --v</span></span><br><span class=\"line\">tcpdump version 4.9.2</span><br><span class=\"line\">libpcap version 1.5.3</span><br><span class=\"line\">OpenSSL 1.0.2k-fips  26 Jan 2017</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Mac\"><a href=\"#Mac\" class=\"headerlink\" title=\"Mac\"></a>Mac</h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">brew install tcpdump</span><br><span class=\"line\">➜  ~ tcpdump --v</span><br><span class=\"line\">tcpdump version 4.99.1</span><br><span class=\"line\">libpcap version 1.10.1</span><br><span class=\"line\">OpenSSL 1.1.1k  25 Mar 2021</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h3 id=\"参数\"><a href=\"#参数\" class=\"headerlink\" title=\"参数\"></a>参数</h3><ul>\n<li><code>-A  </code>  以ASCII格式打印出所有分组，并将链路层的头最小化</li>\n<li><code>-d </code>   将匹配信息包的代码以人们能够理解的汇编格式给出</li>\n<li><code>-D </code>   打印出系统中所有可以用tcpdump截包的网络接口</li>\n<li><code>-ddd</code>    将匹配信息包的代码以十进制的形式输出</li>\n<li><code>-e</code>    在输出行打印出数据链路层的头部信息</li>\n<li><code>-f  </code>  将外部的Internet地址以数字的形式打印出来</li>\n<li><code>-l </code>   使标准输出变为缓冲行形式</li>\n<li><code>-L</code>    列出网络接口的已知数据链路</li>\n<li><code>-n</code>    不把网络地址转换成名字</li>\n<li><code>-N</code>    不输出主机名中的域名部分，如“kongove.ubuntu.cn”只输出“kongove”</li>\n<li><code>-O</code>    不运行分组分组匹配（packet-matching）代码优化程序</li>\n<li><code>-p </code>   不将网络接口设置成混杂模式</li>\n<li><code>-q </code>   快速输出，只输出较少的协议信息</li>\n<li><code>-S </code>   将tcp的序列号以绝对值形式输出，而不是相对值</li>\n<li><code>-t</code>    在输出的每一行不打印时间戳</li>\n<li><code>-u</code>    输出未解码的NFS句柄</li>\n<li><code>-v </code>   输出一个稍微详细的信息，例如在ip包中可以包括ttl和服务类型的信息</li>\n<li><code>-vv </code>   输出详细的报文信息</li>\n<li><code>-c count </code>   指定监听数据包数量，当收到指定的包的数目后，tcpdump就会停止</li>\n<li><code>-C file_size</code>    限定数据包写入文件大小</li>\n<li><code>-F file</code>    从指定的文件中读取表达式,忽略其它的表达式</li>\n<li><code>-i interface</code>    指定监听网络接口</li>\n<li><code>-m module</code>    打开指定的SMI MIB组件</li>\n<li><code>-M secret </code>   如果tcp报文中存在TCP-MD5选项，则需要用secret作为共享的验证码用于验证TCP-MD5选选项摘要（详见RFC 2385）<br>-r file    从指定的文件中读取包(这些包一般通过-w选项产生)</li>\n<li><code>-s snaplen</code>    从每个分组中读取最开始的snaplen个字节，而不是默认的68个字节</li>\n<li><code>-T type </code>   将截取的数据包直接解释为指定类型的报文，常见类型有rpc（远程过程调用）和snmp（简单网络管理协议），还包括aodv、cnfp、rpc、rtp、rtcp、snmp、tftp、vat、wb等<br>-w file    指定将监听到的数据包写入文件，不分析和打印数据包</li>\n<li><code>-W filecount </code>   限定能写入文件数据包的数量</li>\n<li><code>-E </code>spi@ipaddr algo:secret,…    用spi@ipaddr algo:secret解密那些以addr作为地址，并且包含了安全参数索引值spi的IPsec ESP分组</li>\n</ul>\n<h3 id=\"命令格式\"><a href=\"#命令格式\" class=\"headerlink\" title=\"命令格式\"></a>命令格式</h3><blockquote>\n<p>tcpdump采用命令行方式，它的命令格式为：</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">tcpdump [ -adeflnNOpqStvx ] [ -c 数量 ] [ -F 文件名 ] [ -i 网络接口 ] [ -r 文件名] [ -s snaplen ]  [ -T 类型 ] [ -w 文件名 ] [表达式 ]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"表达式\"><a href=\"#表达式\" class=\"headerlink\" title=\"表达式\"></a>表达式</h3><h3 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h3><h4 id=\"指定运行时间\"><a href=\"#指定运行时间\" class=\"headerlink\" title=\"指定运行时间\"></a>指定运行时间</h4><blockquote>\n<p>tcpdump通常都是手动运行，需要使用类似Ctrl+C都方式终结，想控制运行时间不用手动停止程序。</p>\n</blockquote>\n<ul>\n<li>方法一 超时</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">timeout 5400 tcpdump -i eth0 <span class=\"string\">'port 8080'</span> -w myfile</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>方法二 组合 <code>-G {sec}</code> (每 x 秒轮换转储文件)和 <code>-W {count}</code> (限制转储文件的数量),将运行 15 秒然后停止。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">tcpdump -G 15 -W 1 -w myfile.pcap -i eth0 <span class=\"string\">'port 8080'</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"指定间隔保存\"><a href=\"#指定间隔保存\" class=\"headerlink\" title=\"指定间隔保存\"></a>指定间隔保存</h4><ul>\n<li>方法一 -G 600 600s保存一次 -i 指定网卡 -s -w 保存文件的格式</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">tcpdump -i lo -s0 -G 600  -w %Y_%m%d_%H%M_%S.pcap</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>方法二 -C 5 每5M保存一个包</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">tcpdump -i lo -s0 -C 5 -Z root -w eth0.pcap</span><br></pre></td></tr></table></figure>\n","categories":["软件"],"tags":["网络通信","抓包软件"]},{"title":"查缺补漏-Zookeeper","url":"/posts/2936478442/","content":"<h3 id=\"Zookeeper概述\"><a href=\"#Zookeeper概述\" class=\"headerlink\" title=\"Zookeeper概述\"></a>Zookeeper概述</h3><blockquote>\n<p>Zookeeper可以让企业的IT架构逐步从集中式向分布式过度，所谓的分布式是指：把一个计算任务分解成若干个计算单元，并且分派到若干不同的计算机中去执行，然后汇总计算结果的过程。</p>\n</blockquote>\n<ul>\n<li><p>Zookeeper介绍</p>\n<ul>\n<li>Zookeeper是源代码开放的分布式协调服务，由雅虎创建，是Google Chubby开源实现。Zookeeper是一个高性能的分布式数据一致性解决方案，它将那些复杂、容易出错的分布式一致性服务封装起来，构成一个搞笑可靠的原语集，并提供一系列简单易用的接口给用户使用。</li>\n</ul>\n</li>\n<li><p>Zookeeper的典型应用场景</p>\n<ul>\n<li>数据发布/订阅 顾名思义就是一方把数据发布出来，另一方通过某种手动可以得到这些数据。<ul>\n<li>通常数据订阅有两种方式：推模式和拉模式，推模式一般是服务器主动向客户端推送消息，拉模式是客户端主动去服务端获取数据（通常采用的是轮询的方式）。</li>\n<li>Zookeeper采用两种方式的结合。<ul>\n<li>发布者将数据发布到Zookeeper集群节点上，订阅者通过一定的方法告诉服务器，我对那个节点的数据感兴趣，那个服务器在这些节点的数据发送变化时，就通知客户端，客户端得到通知后可以去服务器获取数据信息。</li>\n<li>分布式协调/通知<ul>\n<li>心跳检测：在分布式系统中，通常需要机器是否可以用，Zookeeper中我们让所有的机器都注册一个临时节点，所以只需要判断这个节点是否存在就可以了，不需要直接去连接需要检查的机器，降低系统的负载度（节点分为临时和持久）。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>Zookpeeper重量级使用</p>\n<ul>\n<li>Hadoop、HBase、Storm、Solr。</li>\n</ul>\n</li>\n<li><p>集群角色</p>\n<ul>\n<li>Leader、Follower、Observer<ul>\n<li>Leader服务器是整个Zookeeper集群工作机制的核心</li>\n<li>Follower服务器是Zookeeper集群状态的跟随者</li>\n<li>Oserver服务器充当一个观察者的角色</li>\n<li>Leader、Follower设计模式，Observer观察者模式</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>会话</p>\n<ul>\n<li>会话是指客户端Zookeeper服务器的连接，Zookeeper中的会话叫Session，客户端与服务器建立TCP的长连接来维持一个Session,客户端在启动的时候首先会与服务器建立一个TCP连接,通过这个连接客户端能够通过心跳检测与服务器保持有效的会话，也能向Zookeeper服务器发送请求并获得响应。</li>\n</ul>\n</li>\n<li><p>数据节点</p>\n<ul>\n<li>Zookeeper中的节点有两类<ul>\n<li>集群中的一台机器称为一个节点</li>\n<li>数据模型中的数据单元Znode，分别为持久节点和临时节点。（其实数据节点就是一个tree节点就是Znode）</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>版本</p>\n<ul>\n<li>Zookeeper中的版本<ul>\n<li>version<ul>\n<li>当前数据节点数据内容版本</li>\n</ul>\n</li>\n<li>cversion<ul>\n<li>当前数据节点子节点的版本号</li>\n</ul>\n</li>\n<li>aversion<ul>\n<li>当前数据节点ACL变更版本号</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>watcher（事件监听器）</p>\n<ul>\n<li>Zookeeper允许用户在指定节点上注册一些Watcher，当数据节点发生变化的时候，Zookeeper服务器会把这个变化通知发送给感兴趣的客户端。</li>\n</ul>\n</li>\n<li><p>ACL权限控制</p>\n<ul>\n<li>ACL是Access Contril Lists 的缩写,Zookeeper采用ACL策略来进行权限控制,有以下权限：<ul>\n<li>CREATE：创建子节点</li>\n<li>READ：获取子节点</li>\n<li>WRITE:更新子节点数据权限</li>\n<li>DELETE:删除子节点权限</li>\n<li>ADMIN：设置节点ACL权限</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Zoopeeper环境搭建（集群、单机、伪集群）\"><a href=\"#Zoopeeper环境搭建（集群、单机、伪集群）\" class=\"headerlink\" title=\"Zoopeeper环境搭建（集群、单机、伪集群）\"></a>Zoopeeper环境搭建（集群、单机、伪集群）</h3><ul>\n<li>单机模式（设备环境有限暂时单机）<ul>\n<li>准备工作<ul>\n<li>下载Zookeeper（此处自行处理）</li>\n<li>解压 tar xzvf xxx.gz 解压</li>\n<li>重命名文件夹 Zookeeper 命令mv xxx xxx 后面的参数是新名字（可以不做）</li>\n<li>进入文件夹中/conf/</li>\n<li>复制配置文件zoo_sample.cfg（样例文件） 并重命名 zoo.cfg</li>\n</ul>\n</li>\n<li>编辑zoo.cfg内容（仅供参考,具体环境自行修改）</li>\n<li>tickTime = 2000<ul>\n<li>tickTime：基本事件单元，以毫秒为单位。这个时间是作为 Zookeeper 服务器之间或客户端与服务器之间维持心跳的时间间隔，也就是每个 tickTime 时间就会发送一个心跳。</li>\n</ul>\n</li>\n<li>initLimit= 5<ul>\n<li>initLimit:这个配置项用来配置Zookeeper接受客户端初始化连接时最长能忍受多少个心跳时间间隔数，当已超过5个心跳的时间（也就是tickTime）长度后Zookeeper服务器还没有收到客户端的返回信息，那么表明这个客户端连接失败。总的时间长度是5 * 2000=4s。</li>\n</ul>\n</li>\n<li>dataDir = D:\\zookeeper\\data<ul>\n<li>顾名思义就是 Zookeeper 保存数据快照的目录，默认情况下，Zookeeper 将写数据的日志文件也保存在这个目录里）。</li>\n</ul>\n</li>\n<li>dataLogDir= D:\\zookeeper\\log<ul>\n<li>顾名思义就是 Zookeeper 保存日志的目录。</li>\n</ul>\n</li>\n<li>synclimit = 5<ul>\n<li>这个配置项表示Leader与Follower之间发送消息，请求和应答时间长长度，最长不能超过多少个tickTime的时间长度,总的时间长度是2 * 2000 = 4s。</li>\n</ul>\n</li>\n<li>clientPort = 2181<ul>\n<li>这个端口就是客户端连接 Zookeeper 服务器的端口，Zookeeper 会监听这个端口，接受客户端的访问请求。</li>\n</ul>\n</li>\n<li>Server（待续）<ul>\n<li>格式：server.id=host:port:port（两个port保证可以正常使用就行）<ul>\n<li>id：通常为整数，并且不能重复使用整数。</li>\n<li>host：服务器的IP地址。</li>\n<li>port: Follower端口</li>\n<li>port: Leader选举投票。</li>\n</ul>\n</li>\n<li>ZooKeeper建议使用hostname，而非ip。这需要对主机的/etc/hostname和/etc/hosts做host绑定(不用的OS不同修改方式)。</li>\n<li>创建一个myid文件（放在 dataDir文件下面）</li>\n<li>写入一行数据（请查阅zoo.cfg文件）<ul>\n<li>写入id位置的数据即可。表示当前系统环境Zookeeper是哪一个Server（通讯用的）。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>启动服务与停止服务</li>\n<li>进入bin/文件</li>\n<li>执行zkServer.cmd 或则 <a href=\"http://zkserver.sh/\" target=\"_blank\" rel=\"noopener\">zkServer.sh</a></li>\n<li>CMD直接双击运行 ,SH则 sudo sh ./zkServer.sh start 启动 stop 关闭</li>\n<li>验证 使用telnet来测试(自行安装)<ul>\n<li>telnet ip port 敲命令 stat 若返回数据表示当前服务器不能对外提供服务表明集群下其他服务器未启动（在Zookeeper中只要有半数的服务器正常工作就可以向外提供服务）。</li>\n</ul>\n</li>\n<li>在此简单说明下何为伪集群就是在一台服务器上的多个Zookeeper的集群叫伪集群（伪集群 两个port不能与其他zookeeper的port一样）。</li>\n<li>单机模式就删除其他服务器运行的时候就是单机模式。</li>\n</ul>\n</li>\n</ul>\n","categories":["Zookeeper"]},{"title":"Wireshark入门","url":"/posts/112304606/","content":"<h3 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h3><blockquote>\n<p>Wireshark（前称Ethereal）是一个网络数据包分析软件。网络数据包分析软件的功能是截取网络数据包，并尽可能显示出最为详细的网络数据包数据。Wireshark使用WinPCAP作为接口，直接与网卡进行数据报文交换。</p>\n</blockquote>\n<p><a href=\"https://www.wireshark.org/#download\" target=\"_blank\" rel=\"noopener\">官方下载地址</a></p>\n<p><a href=\"https://www.wireshark.org/docs/\" target=\"_blank\" rel=\"noopener\">官方文档</a></p>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><ul>\n<li>安装完成之后大概是这样，注意mac和windows上有一定安装差异。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211218132956.png\"></p>\n<ul>\n<li>安装好chmodBPF 注意，mac系统升级之后会导致该插件无法使用。需要重新安装软件。</li>\n</ul>\n<blockquote>\n<p> The capture session could not be initiated on interface ‘en0’ (You don’t have permission to capture on that device). Please check to make sure you have sufficient permissions…<br>大概提示这么一句话</p>\n</blockquote>\n<ul>\n<li>解决方法有两种</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo chmod 777 /dev/bpf*</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>或者 </li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo chown 你的电脑用户名:admin bp*</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改完成后检查</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">ls -la | grep bp</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>如果没有生效，重启试试。</li>\n</ul>\n<h3 id=\"快速使用\"><a href=\"#快速使用\" class=\"headerlink\" title=\"快速使用\"></a>快速使用</h3><blockquote>\n<p>选中一个设备比如WIFI:en0</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211218133238.png\"></p>\n<ul>\n<li>上图显示连接到我了的小米wifi。</li>\n</ul>\n<h3 id=\"界面介绍\"><a href=\"#界面介绍\" class=\"headerlink\" title=\"界面介绍\"></a>界面介绍</h3><blockquote>\n<p>需要我们注意到地方</p>\n</blockquote>\n<ul>\n<li>Display Filter(显示过滤器)， 用于过滤。</li>\n<li>Packet List Pane(封包列表)， 显示捕获到的封包， 有源地址和目标地址，端口号。 颜色不同，代表Packet Details Pane(封包详细信息), 显示封包中的字段。</li>\n<li>Dissector Pane(16进制数据)。</li>\n<li>Miscellanous(地址栏，杂项)。</li>\n</ul>\n","categories":["软件"],"tags":["网络通信","抓包软件"]},{"title":"Docker-Compose-Redis-Mysql","url":"/posts/2663149277/","content":"<blockquote>\n<p>记录下使用docker-compose构建管理Redis、mysql。</p>\n</blockquote>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><ol>\n<li>创建工作目录</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ mkdir -p docker docker/mysql docker/mysql/data docker/redis docker/redis/data</span><br><span class=\"line\"><span class=\"comment\"># 使用 tree docker 查看目录结构 yum -y install tree 安装</span></span><br><span class=\"line\">$ tree docker</span><br><span class=\"line\">docker</span><br><span class=\"line\">├── mysql</span><br><span class=\"line\">│   └── data</span><br><span class=\"line\">└── redis</span><br><span class=\"line\">    └── data</span><br><span class=\"line\">$ touch docker/mysql/my.cnf docker/redis/redis.conf </span><br><span class=\"line\">$ tree docker</span><br><span class=\"line\">docker</span><br><span class=\"line\">├── mysql</span><br><span class=\"line\">│   ├── data</span><br><span class=\"line\">│   └── my.cnf</span><br><span class=\"line\">└── redis</span><br><span class=\"line\">    ├── data</span><br><span class=\"line\">    └── redis.conf</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>准备my.conf 、redis.conf<ol>\n<li>my.conf</li>\n</ol>\n</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">[client]</span><br><span class=\"line\"> port = 3306</span><br><span class=\"line\"> socket = /var/lib/mysql/data/mysql.sock</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\"> <span class=\"comment\"># 针对5.7版本执行group by字句出错问题解决</span></span><br><span class=\"line\">sql_mode=<span class=\"string\">'STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'</span></span><br><span class=\"line\"> <span class=\"comment\"># 一般配置选项</span></span><br><span class=\"line\"> basedir = /var/lib/mysql</span><br><span class=\"line\"> datadir = /var/lib/mysql/data</span><br><span class=\"line\"> port = 3306</span><br><span class=\"line\"> socket = /var/lib/mysql/data/mysql.sock</span><br><span class=\"line\"> lc-messages-dir = /usr/share/mysql <span class=\"comment\"># 务必配置此项，否则执行sql出错时，只能显示错误代码而不显示具体错误消息</span></span><br><span class=\"line\"> character-set-server=utf8</span><br><span class=\"line\"> back_log = 300</span><br><span class=\"line\"> max_connections = 3000</span><br><span class=\"line\"> max_connect_errors = 50</span><br><span class=\"line\"> table_open_cache = 4096</span><br><span class=\"line\"> max_allowed_packet = 32M</span><br><span class=\"line\"> <span class=\"comment\">#binlog_cache_size = 4M</span></span><br><span class=\"line\"> max_heap_table_size = 128M</span><br><span class=\"line\"> read_rnd_buffer_size = 16M</span><br><span class=\"line\"> sort_buffer_size = 16M</span><br><span class=\"line\"> join_buffer_size = 16M</span><br><span class=\"line\"> thread_cache_size = 16</span><br><span class=\"line\"> query_cache_size = 64M</span><br><span class=\"line\"> query_cache_limit = 4M</span><br><span class=\"line\"> ft_min_word_len = 8</span><br><span class=\"line\"> thread_stack = 512K</span><br><span class=\"line\"> transaction_isolation = REPEATABLE-READ</span><br><span class=\"line\"> tmp_table_size = 64M</span><br><span class=\"line\"> <span class=\"comment\">#log-bin=mysql-bin</span></span><br><span class=\"line\"> long_query_time = 6</span><br><span class=\"line\"> server_id=1</span><br><span class=\"line\"> innodb_buffer_pool_size = 256M</span><br><span class=\"line\"> innodb_thread_concurrency = 16</span><br><span class=\"line\"> innodb_log_buffer_size = 16M</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>redis.conf 可以去这里下载 <a href=\"https://redis.io/topics/config\" target=\"_blank\" rel=\"noopener\">官网</a></li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget https://raw.githubusercontent.com/redis/redis/5.0/redis.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 修改内容</span></span><br><span class=\"line\">daemonize no     <span class=\"comment\">## 若使用开机启动，生成pid，该项必须设置为诶yes，否则redis将不能够正常执行开机启动(systemctl start redis,执行后一直卡着，直到超时)</span></span><br><span class=\"line\"><span class=\"comment\">#bind 127.0.0.1  ##注释掉，允许所有其他ip访问，真实使用最好坐下限制，只允许某些主机访问</span></span><br><span class=\"line\">protected-mode no  <span class=\"comment\">## 允许其他机器上的客户端连接当前redis，配置文件设置该项，则开机启动处就可以去掉--protected no </span></span><br><span class=\"line\">requirepass root  <span class=\"comment\">##设置密码</span></span><br><span class=\"line\"><span class=\"comment\"># daemonize yes，他的作用是开启守护进程模式，在该模式下，redis会在后台运行，并将进程pid号写入至redis.conf选项pidfile设置的文件中，此时redis将一直运行，除非手动kill该进程。但是在后面的命令中“-d”选项也是开启daemonize，这是docker自家的方式。</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"编写Docker-Compose文件\"><a href=\"#编写Docker-Compose文件\" class=\"headerlink\" title=\"编写Docker-Compose文件\"></a>编写Docker-Compose文件</h2><figure class=\"highlight dockerfile\"><table><tr><td class=\"code\"><pre><span class=\"line\">version : <span class=\"string\">'3'</span></span><br><span class=\"line\">services:</span><br><span class=\"line\">  mysql:</span><br><span class=\"line\">    image: mysql/mysql-server:<span class=\"number\">5.7</span>.<span class=\"number\">18</span></span><br><span class=\"line\">    container_name: mysql5.<span class=\"number\">7.18</span>-dev</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - net-shop-db</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - <span class=\"string\">\"3306:3306\"</span></span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - /opt/docker/mysql/my.cnf:/etc/my.cnf <span class=\"comment\"># 映射数据库配置文件</span></span><br><span class=\"line\">      - /opt/docker/mysql/data:/var/lib/mysql/data  <span class=\"comment\"># 映射数据库保存目录到宿主机，防止数据丢失</span></span><br><span class=\"line\">      - /opt/docker/mysql/log:/var/log/mysql <span class=\"comment\"># 日志文件</span></span><br><span class=\"line\">      - /etc/localtime:/etc/localtime:ro <span class=\"comment\"># 设置容器时区与宿主机保持一致</span></span><br><span class=\"line\">    restart: always <span class=\"comment\"># 设置容器自启模式</span></span><br><span class=\"line\">    command: [</span><br><span class=\"line\">      <span class=\"string\">'--character-set-server=utf8mb4'</span>,</span><br><span class=\"line\">      <span class=\"string\">'--collation-server=utf8mb4_unicode_ci'</span>,</span><br><span class=\"line\">      <span class=\"string\">'--lower_case_table_names=1'</span>,</span><br><span class=\"line\">      <span class=\"string\">'--default-time-zone=+8:00'</span>]</span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ=Asia/Shanghai <span class=\"comment\"># 设置容器时区与宿主机保持一致</span></span><br><span class=\"line\">      - MYSQL_ROOT_PASSWORD=root <span class=\"comment\"># 设置root密码</span></span><br><span class=\"line\">  redis:</span><br><span class=\"line\">    image: redis:<span class=\"number\">5.0</span>.<span class=\"number\">5</span></span><br><span class=\"line\">    container_name: redis5.<span class=\"number\">0.6</span>-dev</span><br><span class=\"line\">    networks:</span><br><span class=\"line\">      - net-shop-db</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - <span class=\"string\">\"6379:6379\"</span></span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - /etc/localtime:/etc/localtime:ro <span class=\"comment\"># 设置容器时区与宿主机保持一致</span></span><br><span class=\"line\">      - /opt/docker/redis/data:/data</span><br><span class=\"line\">      - /opt/docker/redis/redis.conf:/etc/redis.conf</span><br><span class=\"line\">    command: redis-server /etc/redis.conf <span class=\"comment\"># 启动redis命令</span></span><br><span class=\"line\">    environment:</span><br><span class=\"line\">      - TZ=Asia/Shanghai <span class=\"comment\"># 设置容器时区与宿主机保持一致</span></span><br><span class=\"line\">    restart: always <span class=\"comment\"># 设置容器自启模式</span></span><br><span class=\"line\"></span><br><span class=\"line\">networks:</span><br><span class=\"line\">  net-shop-db:</span><br><span class=\"line\">    driver: bridge</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h2><blockquote>\n<p>注意需要提前启动docker</p>\n</blockquote>\n<ol>\n<li>创建并启动容器 <code>docker-compose -f docker-compose.yml up -d</code></li>\n<li>批量停止容器并清除容器 <code>docker-compose -f docker-compose.yml down</code></li>\n<li>重新构建容器 <code>docker-compose -f docker-compose.yml up --build -d</code></li>\n<li>启动失败，可以查看容器日志信息获取帮助 <code>docker logs 容器名词或容器ID # 既docker-compose.yml文件参数container_name指定的值</code></li>\n</ol>\n<h2 id=\"备注\"><a href=\"#备注\" class=\"headerlink\" title=\"备注\"></a>备注</h2><ol>\n<li>docker-compose 命令不存在、未找到命令。直接从github上下载，国内下载巨慢。</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 注意查看docker 版本 和 docker-compose 的版本</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/bin/</span><br><span class=\"line\"></span><br><span class=\"line\">curl -L https://github.com/docker/compose/releases/download/1.27.4/docker-compose-`uname -s`-`uname -m` -o /usr/<span class=\"built_in\">local</span>/bin/docker-compose</span><br><span class=\"line\"><span class=\"comment\">#。直接用国内的镜像</span></span><br><span class=\"line\">curl -L https://get.daocloud.io/docker/compose/releases/download/1.27.4/docker-compose-`uname -s`-`uname -m` &gt; /usr/<span class=\"built_in\">local</span>/bin/docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\">chmod +x /usr/<span class=\"built_in\">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://yefeihonours.github.io/post/docker/docker_compose/\" target=\"_blank\" rel=\"noopener\">docker-compose 命令不存在、未找到命令</a></p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/43654441\" target=\"_blank\" rel=\"noopener\">使用 docker-compose 在 Docker 中启动有密码的 Redis 容器</a></p>\n<p><a href=\"https://cloud.tencent.com/developer/article/1678769\" target=\"_blank\" rel=\"noopener\">Docker-Compose搭建mysql、redis、zookeeper、rabbitmq、consul、elasticsearch环境</a></p>\n<p><a href=\"https://juejin.cn/post/6844903655389265927\" target=\"_blank\" rel=\"noopener\">Docker Compose多容器部署</a></p>\n<p><a href=\"https://colobu.com/2018/05/15/Stop-and-remove-all-docker-containers-and-images/\" target=\"_blank\" rel=\"noopener\">停止、删除所有的docker容器和镜像</a></p>\n<p><a href=\"https://my.oschina.net/u/4362704/blog/3308004\" target=\"_blank\" rel=\"noopener\">宿主机连接docker中的mysql</a></p>\n<p><a href=\"https://developer.aliyun.com/article/618035\" target=\"_blank\" rel=\"noopener\">Docker Compose 安装 on centos7</a></p>\n<p><a href=\"https://cloud.tencent.com/developer/article/1678769\" target=\"_blank\" rel=\"noopener\">Docker-Compose搭建mysql、redis、zookeeper、rabbitmq、consul、elasticsearch环境</a></p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/140732202\" target=\"_blank\" rel=\"noopener\">docker-compose一键安装redis+mysql+rabbitmq</a></p>\n","categories":["Docker"],"tags":["Mysql","Redis","Docker","Docker-Compose"]},{"title":"Centos7-Docker-Deploy","url":"/posts/3601561739/","content":"<blockquote>\n<p>centos7部署docker-ce 和 docker-compose</p>\n</blockquote>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><ul>\n<li><p>准备一台ESC服务器，并可以使用控制台登录。</p>\n</li>\n<li><p>检查ESC是否安装了docker，可以选择是否卸载重装。</p>\n<ul>\n<li>检查docker是否安装,<code>docker 显示相关信息则表示安装</code></li>\n</ul>\n</li>\n<li><p>卸载docker，若不重装直接忽略，<code>yum list installed | grep docker</code>查看安装内容</p>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ docker </span><br><span class=\"line\"><span class=\"comment\"># -bash: docekr: 未找到命令 则表示未安装了</span></span><br><span class=\"line\"><span class=\"comment\"># 如果安装，卸载默认安装的docer</span></span><br><span class=\"line\">sudo yum remove docker docker-common container-selinux docker-selinux docker-engine</span><br><span class=\"line\">安装 yum-utils，它提供了 yum-config-manager，可用来管理yum源</span><br><span class=\"line\">sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装docker\"><a href=\"#安装docker\" class=\"headerlink\" title=\"安装docker\"></a>安装docker</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#更新yum </span></span><br><span class=\"line\">yum update</span><br><span class=\"line\"><span class=\"comment\">#获取官方源</span></span><br><span class=\"line\">wget -P /etc/yum.repos.d/ https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class=\"line\"><span class=\"comment\">##添加yum源</span></span><br><span class=\"line\">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class=\"line\"><span class=\"comment\">## 也可以使用下面的方式配置docker的yum源</span></span><br><span class=\"line\"><span class=\"comment\"># 华为 二选一</span></span><br><span class=\"line\">wget -O /etc/yum.repos.d/docker-ce.repo https://repo.huaweicloud.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class=\"line\">sudo sed -i <span class=\"string\">'s+download.docker.com+repo.huaweicloud.com/docker-ce+'</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class=\"line\"><span class=\"comment\"># 阿里 二选一</span></span><br><span class=\"line\">wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo</span><br><span class=\"line\"><span class=\"comment\">##更新索引</span></span><br><span class=\"line\">sudo yum clean all<span class=\"comment\">##推荐先清空索引，特别是新版本docker需要换成老版本docker的时候</span></span><br><span class=\"line\"><span class=\"comment\"># 安装默认的</span></span><br><span class=\"line\">sudo yum install -y docker-ce docker-ce-cli containerd.io </span><br><span class=\"line\"><span class=\"comment\">#查看可以安装的版本</span></span><br><span class=\"line\">yum list docker-ce --showduplicates | sort -r</span><br><span class=\"line\"><span class=\"comment\">#选择安装</span></span><br><span class=\"line\">yum install -y docker-ce-18.03.0.ce-1.el7.centos</span><br><span class=\"line\"><span class=\"comment\">#安装docker </span></span><br><span class=\"line\">yum install docker -y</span><br><span class=\"line\"><span class=\"comment\">#检查</span></span><br><span class=\"line\">docker -v <span class=\"comment\">#输出版本信息</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"卸载docker\"><a href=\"#卸载docker\" class=\"headerlink\" title=\"卸载docker\"></a>卸载docker</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo yum remove docker-ce</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置网络加速\"><a href=\"#配置网络加速\" class=\"headerlink\" title=\"配置网络加速\"></a>配置网络加速</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 添加一下内容</span></span><br><span class=\"line\">vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"registry-mirrors\"</span>: [</span><br><span class=\"line\">    <span class=\"string\">\"https://3oq8m6tn.mirror.aliyuncs.com\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"https://hub-mirror.c.163.com\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"https://mirror.baidubce.com\"</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>之后重新启动服务</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"设置docker相关信息\"><a href=\"#设置docker相关信息\" class=\"headerlink\" title=\"设置docker相关信息\"></a>设置docker相关信息</h3><ol>\n<li>设置docker开机启动项<code>systemctl enable docker.service</code></li>\n<li>关闭docker开机启动项 <code>systemctl stop docker.service</code></li>\n<li>检查docker当前运行情况 <code>systemctl status docker</code></li>\n<li>若未启动则启动docker <code>systemctl start docker</code> ,若启动了可以重启<code>systemctl restart docker</code></li>\n<li>检查docker运行情况<code>service docker status</code></li>\n</ol>\n<h3 id=\"部署docker-compsoe\"><a href=\"#部署docker-compsoe\" class=\"headerlink\" title=\"部署docker-compsoe\"></a>部署docker-compsoe</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#更新pip</span></span><br><span class=\"line\">pip install --upgrade pip</span><br><span class=\"line\"><span class=\"comment\">#pip 安装,需要注意pip的版本 docker 与 docker-compose有版本对应 </span></span><br><span class=\"line\">pip install docker-compose </span><br><span class=\"line\">pip3 install docker-compose</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#如果没有pip</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h2><p><a href=\"https://developer.aliyun.com/article/336442\" target=\"_blank\" rel=\"noopener\">阿里云CentOS 7上安装配置Docker</a></p>\n<p><a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-compose-on-centos-7\" target=\"_blank\" rel=\"noopener\">How To Install and Use Docker Compose on CentOS 7</a></p>\n","categories":["Dev"],"tags":["Centos7","Linux","Docker"]},{"title":"源码分析-netty源码环境搭建","url":"/posts/2918322548/","content":"<h2 id=\"0x00-阅读源代码\"><a href=\"#0x00-阅读源代码\" class=\"headerlink\" title=\"0x00 阅读源代码\"></a>0x00 阅读源代码</h2><h3 id=\"下载源代码\"><a href=\"#下载源代码\" class=\"headerlink\" title=\"下载源代码\"></a>下载源代码</h3><ul>\n<li>阅读版本号 <code>netty-4.1.33.Final</code><ul>\n<li>由于github下载速度是在太慢了，这里用gitee克隆一个镜像。</li>\n<li>下载版本<code>git clone -b netty-4.1.33.Final git@gitee.com:Z201/netty.git</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"查看源代码结构\"><a href=\"#查看源代码结构\" class=\"headerlink\" title=\"查看源代码结构\"></a>查看源代码结构</h3><ul>\n<li>查看项目主要文件夹</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">tree -d  -L 1    </span><br><span class=\"line\">├── all</span><br><span class=\"line\">├── bom</span><br><span class=\"line\">├── buffer (Core netty定制的buffer)</span><br><span class=\"line\">├── codec (Protocol Support)</span><br><span class=\"line\">├── codec-dns (Protocol Support)</span><br><span class=\"line\">├── codec-haproxy (Protocol Support)</span><br><span class=\"line\">├── codec-http (Protocol Support)</span><br><span class=\"line\">├── codec-http2 (Protocol Support)</span><br><span class=\"line\">├── codec-memcache (Protocol Support)</span><br><span class=\"line\">├── codec-mqtt (Protocol Support 物联网)</span><br><span class=\"line\">├── codec-redis (Protocol Support )</span><br><span class=\"line\">├── codec-smtp (Protocol Support 邮件)</span><br><span class=\"line\">├── codec-socks (Protocol Support)</span><br><span class=\"line\">├── codec-stomp (Protocol Support ws)</span><br><span class=\"line\">├── codec-xml (Protocol Support)</span><br><span class=\"line\">├── common (Core)</span><br><span class=\"line\">├── dev-tools</span><br><span class=\"line\">├── docker</span><br><span class=\"line\">├── example （抄代码的地方）</span><br><span class=\"line\">├── handler  (Protocol Support)</span><br><span class=\"line\">├── handler-proxy (Protocol Support)</span><br><span class=\"line\">├── license</span><br><span class=\"line\">├── microbench (测试用的)</span><br><span class=\"line\">├── resolver\t(Core)</span><br><span class=\"line\">├── resolver-dns (Core)</span><br><span class=\"line\">├── tarball</span><br><span class=\"line\">├── target</span><br><span class=\"line\">├── testsuite</span><br><span class=\"line\">├── testsuite-autobahn</span><br><span class=\"line\">├── testsuite-http2</span><br><span class=\"line\">├── testsuite-osgi</span><br><span class=\"line\">├── testsuite-shading</span><br><span class=\"line\">├── transport (Transport Services)</span><br><span class=\"line\">├── transport-native-epoll  (Transport Servicesnative omitted - reserved keyword <span class=\"keyword\">in</span> Java)</span><br><span class=\"line\">├── transport-native-kqueue (Transport Servicesnative omitted - reserved keyword <span class=\"keyword\">in</span> Java)</span><br><span class=\"line\">├── transport-native-unix-common Transport Services native omitted - reserved keyword <span class=\"keyword\">in</span> Java)</span><br><span class=\"line\">├── transport-native-unix-common-tests </span><br><span class=\"line\">├── transport-rxtx (Transport Services 串口编程 作废)</span><br><span class=\"line\">├── transport-sctp (Transport Services )</span><br><span class=\"line\">└── transport-udt  (Transport Services 作废)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>将项目导入idea中，笔者采用mac系统。这里需要注意需要安装部分软件。</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">brew install autoconf automake libtool</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 如果安装了国内的镜像出现Error opening archive: Failed to open</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> <span class=\"built_in\">export</span> HOMEBREW_BOTTLE_DOMAIN=<span class=\"string\">''</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 参考文档 https://zhuanlan.zhihu.com/p/383707713</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> 如果是mac系统需要手动将pom文件tcnative.classifier修改成对应系统的。</span></span><br><span class=\"line\">mvn install -Dmaven.test.skip=true</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"0x01-根据官方文档快速入门\"><a href=\"#0x01-根据官方文档快速入门\" class=\"headerlink\" title=\"0x01 根据官方文档快速入门\"></a>0x01 根据官方文档快速入门</h2><blockquote>\n<p>强烈推荐认真阅读netty的官方文档。</p>\n</blockquote>\n<ul>\n<li>官方文档地址 ：<a href=\"https://netty.io/wiki/index.html\" target=\"_blank\" rel=\"noopener\">https://netty.io/wiki/index.html</a></li>\n</ul>\n<h3 id=\"Core\"><a href=\"#Core\" class=\"headerlink\" title=\"Core\"></a>Core</h3><ul>\n<li>netty-common模块是 Netty 的核心基础包，其他模块都需要依赖它。常用的包括通用工具类和自定义并发包。</li>\n<li>netty-buffer 模块中Netty自己实现了的一个更加完备的ByteBuf 工具类，用于网络通信中的数据载体。</li>\n<li>netty-resover模块主要提供了一些有关基础设施的解析工具，包括 IP Address、Hostname、DNS 等。</li>\n</ul>\n<h3 id=\"Protocol-Support\"><a href=\"#Protocol-Support\" class=\"headerlink\" title=\"Protocol Support\"></a>Protocol Support</h3><ul>\n<li>netty-codec模块主要负责编解码工作，提供主流协议的编辑码，还提供了抽象编解码类 ByteToMessageDecoder 和 MessageToByteEncoder，通过继承这两个类我们可以轻松实现自定义的编解码逻辑。</li>\n</ul>\n<h3 id=\"Transport-Service\"><a href=\"#Transport-Service\" class=\"headerlink\" title=\"Transport Service\"></a>Transport Service</h3><ul>\n<li>netty-transport 模块可以说是 Netty 提供数据处理和传输的核心模块，如 Bootstrap、Channel、ChannelHandler、EventLoop、EventLoopGroup、ChannelPipeline 等。其中 Bootstrap 负责客户端或服务端的启动工作，包括创建、初始化 Channel 等；EventLoop 负责向注册的 Channel 发起 I/O 读写操作；ChannelPipeline 负责 ChannelHandler 的有序编排，这些组件在介绍 Netty 逻辑架构的时候都有所涉及。</li>\n</ul>\n","categories":["源码分析"],"tags":["Netty"]},{"title":"MySQL基础（三）","url":"/posts/2011046270/","content":"<h2 id=\"SQL-常见用法\"><a href=\"#SQL-常见用法\" class=\"headerlink\" title=\"SQL 常见用法\"></a>SQL 常见用法</h2><h3 id=\"1-查找数据的查询\"><a href=\"#1-查找数据的查询\" class=\"headerlink\" title=\"1. 查找数据的查询\"></a>1. 查找数据的查询</h3><h4 id=\"SELECT-用于从数据库中选择数据\"><a href=\"#SELECT-用于从数据库中选择数据\" class=\"headerlink\" title=\"SELECT: 用于从数据库中选择数据\"></a><strong>SELECT</strong>: 用于从数据库中选择数据</h4><ul>\n<li><code>SELECT</code> * <code>FROM</code> table_name;</li>\n</ul>\n<h4 id=\"DISTINCT-用于过滤掉重复的值并返回指定列的行\"><a href=\"#DISTINCT-用于过滤掉重复的值并返回指定列的行\" class=\"headerlink\" title=\"DISTINCT: 用于过滤掉重复的值并返回指定列的行\"></a><strong>DISTINCT</strong>: 用于过滤掉重复的值并返回指定列的行</h4><ul>\n<li><code>SELECT DISTINCT</code> column_name;</li>\n</ul>\n<h4 id=\"WHERE-用于过滤记录-行\"><a href=\"#WHERE-用于过滤记录-行\" class=\"headerlink\" title=\"WHERE: 用于过滤记录/行\"></a><strong>WHERE</strong>: 用于过滤记录/行</h4><ul>\n<li><code>SELECT</code> column1, column2 <code>FROM</code> table_name <code>WHERE</code> condition;</li>\n<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> condition1 <code>AND</code> condition2;</li>\n<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> condition1 <code>OR</code> condition2;</li>\n<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE NOT</code> condition;</li>\n<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> condition1 <code>AND</code> (condition2 <code>OR</code> condition3);</li>\n<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE EXISTS</code> (<code>SELECT</code> column_name <code>FROM</code> table_name <code>WHERE</code> condition);</li>\n</ul>\n<h4 id=\"ORDER-BY-用于结果集的排序，升序（ASC）或者降序（DESC）\"><a href=\"#ORDER-BY-用于结果集的排序，升序（ASC）或者降序（DESC）\" class=\"headerlink\" title=\"ORDER BY: 用于结果集的排序，升序（ASC）或者降序（DESC）\"></a><strong>ORDER BY</strong>: 用于结果集的排序，升序（ASC）或者降序（DESC）</h4><ul>\n<li><code>SELECT</code> * <code>FROM</code> table_name <code>ORDER BY</code> column;</li>\n<li><code>SELECT</code> * <code>FROM</code> table_name <code>ORDER BY</code> column <code>DESC</code>;</li>\n<li><code>SELECT</code> * <code>FROM</code> table_name <code>ORDER BY</code> column1 <code>ASC</code>, column2 <code>DESC</code>;</li>\n</ul>\n<h4 id=\"SELECT-TOP-用于指定从表顶部返回的记录数\"><a href=\"#SELECT-TOP-用于指定从表顶部返回的记录数\" class=\"headerlink\" title=\"SELECT TOP: 用于指定从表顶部返回的记录数\"></a><strong>SELECT TOP</strong>: 用于指定从表顶部返回的记录数</h4><ul>\n<li><code>SELECT TOP</code> number columns_names <code>FROM</code> table_name <code>WHERE</code> condition;</li>\n<li><code>SELECT TOP</code> percent columns_names <code>FROM</code> table_name <code>WHERE</code> condition;</li>\n<li>并非所有数据库系统都支持<code>SELECT TOP</code>。 MySQL 中是<code>LIMIT</code>子句</li>\n<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>LIMIT</code> offset, count;</li>\n</ul>\n<h4 id=\"LIKE-用于搜索列中的特定模式，WHERE-子句中使用的运算符\"><a href=\"#LIKE-用于搜索列中的特定模式，WHERE-子句中使用的运算符\" class=\"headerlink\" title=\"LIKE: 用于搜索列中的特定模式，WHERE 子句中使用的运算符\"></a><strong>LIKE</strong>: 用于搜索列中的特定模式，WHERE 子句中使用的运算符</h4><ul>\n<li>% (percent sign) 是一个表示零个，一个或多个字符的通配符</li>\n<li>_ (underscore) 是一个表示单个字符通配符</li>\n<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>WHERE</code> column_name <code>LIKE</code> pattern;</li>\n<li><code>LIKE</code> ‘a%’    （查找任何以“a”开头的值）</li>\n<li><code>LIKE</code> ‘%a’    （查找任何以“a”结尾的值）</li>\n<li><code>LIKE</code> ‘%or%’  （查找任何包含“or”的值）</li>\n<li><code>LIKE</code> ‘_r%’   （查找任何第二位是“r”的值）</li>\n<li><code>LIKE</code> ‘a_%_%’ （查找任何以“a”开头且长度至少为3的值）</li>\n<li><code>LIKE</code> ‘[a-c]%’（查找任何以“a”或“b”或“c”开头的值）</li>\n</ul>\n<h4 id=\"IN-用于在-WHERE-子句中指定多个值的运算符\"><a href=\"#IN-用于在-WHERE-子句中指定多个值的运算符\" class=\"headerlink\" title=\"IN: 用于在 WHERE 子句中指定多个值的运算符\"></a><strong>IN</strong>: 用于在 WHERE 子句中指定多个值的运算符</h4><ul>\n<li>本质上，IN运算符是多个OR条件的简写</li>\n<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>WHERE</code> column_name <code>IN</code> (value1, value2, …);</li>\n<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>WHERE</code> column_name <code>IN</code> (<code>SELECT STATEMENT</code>);</li>\n</ul>\n<h4 id=\"BETWEEN-用于过滤给定范围的值的运算符\"><a href=\"#BETWEEN-用于过滤给定范围的值的运算符\" class=\"headerlink\" title=\"BETWEEN: 用于过滤给定范围的值的运算符\"></a><strong>BETWEEN</strong>: 用于过滤给定范围的值的运算符</h4><ul>\n<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>WHERE</code> column_name <code>BETWEEN</code> value1 <code>AND</code> value2;</li>\n<li><code>SELECT</code> * <code>FROM</code> Products <code>WHERE</code> (column_name <code>BETWEEN</code> value1 <code>AND</code> value2) <code>AND NOT</code> column_name2 <code>IN</code> (value3, value4);</li>\n<li><code>SELECT</code> * <code>FROM</code> Products <code>WHERE</code> column_name <code>BETWEEN</code> #01/07/1999# AND #03/12/1999#;</li>\n</ul>\n<h4 id=\"NULL-代表一个字段没有值\"><a href=\"#NULL-代表一个字段没有值\" class=\"headerlink\" title=\"NULL: 代表一个字段没有值\"></a><strong>NULL</strong>: 代表一个字段没有值</h4><ul>\n<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> column_name <code>IS NULL</code>;</li>\n<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> column_name <code>IS NOT NULL</code>;</li>\n</ul>\n<h4 id=\"AS-用于给表或者列分配别名\"><a href=\"#AS-用于给表或者列分配别名\" class=\"headerlink\" title=\"AS: 用于给表或者列分配别名\"></a><strong>AS</strong>: 用于给表或者列分配别名</h4><ul>\n<li><code>SELECT</code> column_name <code>AS</code> alias_name <code>FROM</code> table_name;</li>\n<li><code>SELECT</code> column_name <code>FROM</code> table_name <code>AS</code> alias_name;</li>\n<li><code>SELECT</code> column_name <code>AS</code> alias_name1, column_name2 <code>AS</code> alias_name2;</li>\n<li><code>SELECT</code> column_name1, column_name2 + ‘, ‘ + column_name3 <code>AS</code> alias_name;</li>\n</ul>\n<h4 id=\"UNION-用于组合两个或者多个-SELECT-语句的结果集的运算符\"><a href=\"#UNION-用于组合两个或者多个-SELECT-语句的结果集的运算符\" class=\"headerlink\" title=\"UNION: 用于组合两个或者多个 SELECT 语句的结果集的运算符\"></a><strong>UNION</strong>: 用于组合两个或者多个 SELECT 语句的结果集的运算符</h4><ul>\n<li>每个 SELECT 语句必须拥有相同的列数</li>\n<li>列必须拥有相似的数据类型</li>\n<li>每个 SELECT 语句中的列也必须具有相同的顺序</li>\n<li><code>SELECT</code> columns_names <code>FROM</code> table1 <code>UNION SELECT</code> column_name <code>FROM</code> table2;</li>\n<li><code>UNION</code> 仅允许选择不同的值, <code>UNION ALL</code> 允许重复</li>\n</ul>\n<h4 id=\"ANY-ALL-用于检查-WHERE-或-HAVING-子句中使用的子查询条件的运算符\"><a href=\"#ANY-ALL-用于检查-WHERE-或-HAVING-子句中使用的子查询条件的运算符\" class=\"headerlink\" title=\"ANY|ALL: 用于检查 WHERE 或 HAVING 子句中使用的子查询条件的运算符\"></a><strong>ANY|ALL</strong>: 用于检查 WHERE 或 HAVING 子句中使用的子查询条件的运算符</h4><ul>\n<li><code>ANY</code> 如果任何子查询值满足条件，则返回 true。</li>\n<li><code>ALL</code> 如果所有子查询值都满足条件，则返回 true。</li>\n<li><code>SELECT</code> columns_names <code>FROM</code> table1 <code>WHERE</code> column_name operator (<code>ANY</code>|<code>ALL</code>) (<code>SELECT</code> column_name <code>FROM</code> table_name <code>WHERE</code> condition);</li>\n</ul>\n<h4 id=\"GROUP-BY-通常与聚合函数（COUNT，MAX，MIN，SUM，AVG）一起使用，用于将结果集分组为一列或多列\"><a href=\"#GROUP-BY-通常与聚合函数（COUNT，MAX，MIN，SUM，AVG）一起使用，用于将结果集分组为一列或多列\" class=\"headerlink\" title=\"GROUP BY: 通常与聚合函数（COUNT，MAX，MIN，SUM，AVG）一起使用，用于将结果集分组为一列或多列\"></a><strong>GROUP BY</strong>: 通常与聚合函数（COUNT，MAX，MIN，SUM，AVG）一起使用，用于将结果集分组为一列或多列</h4><ul>\n<li><code>SELECT</code> column_name1, COUNT(column_name2) <code>FROM</code> table_name <code>WHERE</code> condition <code>GROUP BY</code> column_name1 <code>ORDER BY</code> COUNT(column_name2) DESC;</li>\n</ul>\n<h4 id=\"HAVING-HAVING-子句指定-SELECT-语句应仅返回聚合值满足指定条件的行。它被添加到-SQL-语言中，因为WHERE关键字不能与聚合函数一起使用。\"><a href=\"#HAVING-HAVING-子句指定-SELECT-语句应仅返回聚合值满足指定条件的行。它被添加到-SQL-语言中，因为WHERE关键字不能与聚合函数一起使用。\" class=\"headerlink\" title=\"HAVING: HAVING 子句指定 SELECT 语句应仅返回聚合值满足指定条件的行。它被添加到 SQL 语言中，因为WHERE关键字不能与聚合函数一起使用。\"></a><strong>HAVING</strong>: HAVING 子句指定 SELECT 语句应仅返回聚合值满足指定条件的行。它被添加到 SQL 语言中，因为WHERE关键字不能与聚合函数一起使用。</h4><ul>\n<li><code>SELECT</code> <code>COUNT</code>(column_name1), column_name2 <code>FROM</code> table <code>GROUP BY</code> column_name2 <code>HAVING</code> <code>COUNT(</code>column_name1<code>)</code> &gt; 5;</li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"2-修改数据的查询\"><a href=\"#2-修改数据的查询\" class=\"headerlink\" title=\"2. 修改数据的查询\"></a>2. 修改数据的查询</h3><h4 id=\"INSERT-INTO-用于在表中插入新记录-行\"><a href=\"#INSERT-INTO-用于在表中插入新记录-行\" class=\"headerlink\" title=\"INSERT INTO: 用于在表中插入新记录/行\"></a><strong>INSERT INTO</strong>: 用于在表中插入新记录/行</h4><ul>\n<li><code>INSERT INTO</code> table_name (column1, column2) <code>VALUES</code> (value1, value2);</li>\n<li><code>INSERT INTO</code> table_name <code>VALUES</code> (value1, value2 …);</li>\n</ul>\n<h4 id=\"UPDATE-用于修改表中的现有记录-行\"><a href=\"#UPDATE-用于修改表中的现有记录-行\" class=\"headerlink\" title=\"UPDATE: 用于修改表中的现有记录/行\"></a><strong>UPDATE</strong>: 用于修改表中的现有记录/行</h4><ul>\n<li><code>UPDATE</code> table_name <code>SET</code> column1 = value1, column2 = value2 <code>WHERE</code> condition;</li>\n<li><code>UPDATE</code> table_name <code>SET</code> column_name = value;</li>\n</ul>\n<h4 id=\"DELETE-用于删除表中的现有记录-行\"><a href=\"#DELETE-用于删除表中的现有记录-行\" class=\"headerlink\" title=\"DELETE: 用于删除表中的现有记录/行\"></a><strong>DELETE</strong>: 用于删除表中的现有记录/行</h4><ul>\n<li><code>DELETE FROM</code> table_name <code>WHERE</code> condition;</li>\n<li><code>DELETE</code> * <code>FROM</code> table_name;</li>\n</ul>\n<h3 id=\"3-聚合查询\"><a href=\"#3-聚合查询\" class=\"headerlink\" title=\"3. 聚合查询\"></a>3. 聚合查询</h3><h4 id=\"COUNT-返回出现次数\"><a href=\"#COUNT-返回出现次数\" class=\"headerlink\" title=\"COUNT: 返回出现次数\"></a><strong>COUNT</strong>: 返回出现次数</h4><ul>\n<li><code>SELECT COUNT (DISTINCT</code> column_name<code>)</code>;</li>\n</ul>\n<h4 id=\"MIN-and-MAX-返回所选列的最小-最大值\"><a href=\"#MIN-and-MAX-返回所选列的最小-最大值\" class=\"headerlink\" title=\"MIN() and MAX(): 返回所选列的最小/最大值\"></a><strong>MIN() and MAX()</strong>: 返回所选列的最小/最大值</h4><ul>\n<li><code>SELECT MIN (</code>column_names<code>) FROM</code> table_name <code>WHERE</code> condition;</li>\n<li><code>SELECT MAX (</code>column_names<code>) FROM</code> table_name <code>WHERE</code> condition;</li>\n</ul>\n<h4 id=\"AVG-返回数字列的平均值\"><a href=\"#AVG-返回数字列的平均值\" class=\"headerlink\" title=\"AVG(): 返回数字列的平均值\"></a><strong>AVG()</strong>: 返回数字列的平均值</h4><ul>\n<li><code>SELECT AVG (</code>column_name<code>) FROM</code> table_name <code>WHERE</code> condition;</li>\n</ul>\n<h4 id=\"SUM-返回数值列的总和\"><a href=\"#SUM-返回数值列的总和\" class=\"headerlink\" title=\"SUM(): 返回数值列的总和\"></a><strong>SUM()</strong>: 返回数值列的总和</h4><ul>\n<li><code>SELECT SUM (</code>column_name<code>) FROM</code> table_name <code>WHERE</code> condition;</li>\n</ul>\n<h3 id=\"4-连接查询\"><a href=\"#4-连接查询\" class=\"headerlink\" title=\"4. 连接查询\"></a>4. 连接查询</h3><h4 id=\"INNER-JOIN-内连接，返回在两张表中具有匹配值的记录\"><a href=\"#INNER-JOIN-内连接，返回在两张表中具有匹配值的记录\" class=\"headerlink\" title=\"INNER JOIN: 内连接，返回在两张表中具有匹配值的记录\"></a><strong>INNER JOIN</strong>: 内连接，返回在两张表中具有匹配值的记录</h4><ul>\n<li><code>SELECT</code> column_names <code>FROM</code> table1 <code>INNER JOIN</code> table2 <code>ON</code> table1.column_name=table2.column_name;</li>\n<li><code>SELECT</code> table1.column_name1, table2.column_name2, table3.column_name3 <code>FROM</code> ((table1 <code>INNER JOIN</code> table2 <code>ON</code> relationship) <code>INNER JOIN</code> table3 <code>ON</code> relationship);</li>\n</ul>\n<h4 id=\"LEFT-OUTER-JOIN-左外连接，返回左表（table1）中的所有记录，以及右表中的匹配记录（table2）\"><a href=\"#LEFT-OUTER-JOIN-左外连接，返回左表（table1）中的所有记录，以及右表中的匹配记录（table2）\" class=\"headerlink\" title=\"LEFT (OUTER) JOIN: 左外连接，返回左表（table1）中的所有记录，以及右表中的匹配记录（table2）\"></a><strong>LEFT (OUTER) JOIN</strong>: 左外连接，返回左表（table1）中的所有记录，以及右表中的匹配记录（table2）</h4><ul>\n<li><code>SELECT</code> column_names <code>FROM</code> table1 <code>LEFT JOIN</code> table2 <code>ON</code> table1.column_name=table2.column_name;</li>\n</ul>\n<h4 id=\"RIGHT-OUTER-JOIN-右外连接，返回右表（table2）中的所有记录，以及左表（table1）中匹配的记录\"><a href=\"#RIGHT-OUTER-JOIN-右外连接，返回右表（table2）中的所有记录，以及左表（table1）中匹配的记录\" class=\"headerlink\" title=\"RIGHT (OUTER) JOIN: 右外连接，返回右表（table2）中的所有记录，以及左表（table1）中匹配的记录\"></a><strong>RIGHT (OUTER) JOIN</strong>: 右外连接，返回右表（table2）中的所有记录，以及左表（table1）中匹配的记录</h4><ul>\n<li><code>SELECT</code> column_names <code>FROM</code> table1 <code>RIGHT JOIN</code> table2 <code>ON</code> table1.column_name=table2.column_name;</li>\n</ul>\n<h4 id=\"FULL-OUTER-JOIN-全外连接，全连接是左右外连接的并集-连接表包含被连接的表的所有记录-如果缺少匹配的记录-以-NULL-填充。\"><a href=\"#FULL-OUTER-JOIN-全外连接，全连接是左右外连接的并集-连接表包含被连接的表的所有记录-如果缺少匹配的记录-以-NULL-填充。\" class=\"headerlink\" title=\"FULL (OUTER) JOIN: 全外连接，全连接是左右外连接的并集. 连接表包含被连接的表的所有记录, 如果缺少匹配的记录, 以 NULL 填充。\"></a><strong>FULL (OUTER) JOIN</strong>: 全外连接，全连接是左右外连接的并集. 连接表包含被连接的表的所有记录, 如果缺少匹配的记录, 以 NULL 填充。</h4><ul>\n<li><code>SELECT</code> column_names <code>FROM</code> table1 <code>FULL OUTER JOIN</code> table2 <code>ON</code> table1.column_name=table2.column_name;</li>\n</ul>\n<h4 id=\"Self-JOIN-自连接，表自身连接\"><a href=\"#Self-JOIN-自连接，表自身连接\" class=\"headerlink\" title=\"Self JOIN: 自连接，表自身连接\"></a><strong>Self JOIN</strong>: 自连接，表自身连接</h4><ul>\n<li><code>SELECT</code> column_names <code>FROM</code> table1 T1, table1 T2 <code>WHERE</code> condition;</li>\n</ul>\n<h3 id=\"5-视图查询\"><a href=\"#5-视图查询\" class=\"headerlink\" title=\"5. 视图查询\"></a>5. 视图查询</h3><h4 id=\"CREATE-创建视图\"><a href=\"#CREATE-创建视图\" class=\"headerlink\" title=\"CREATE: 创建视图\"></a><strong>CREATE</strong>: 创建视图</h4><ul>\n<li><code>CREATE VIEW</code> view_name <code>AS SELECT</code> column1, column2 <code>FROM</code> table_name <code>WHERE</code> condition;</li>\n</ul>\n<h4 id=\"SELECT-检索视图\"><a href=\"#SELECT-检索视图\" class=\"headerlink\" title=\"SELECT: 检索视图\"></a><strong>SELECT</strong>: 检索视图</h4><ul>\n<li><code>SELECT</code> * <code>FROM</code> view_name;</li>\n</ul>\n<h4 id=\"DROP-删除视图\"><a href=\"#DROP-删除视图\" class=\"headerlink\" title=\"DROP: 删除视图\"></a><strong>DROP</strong>: 删除视图</h4><ul>\n<li><code>DROP VIEW</code> view_name;</li>\n</ul>\n<h3 id=\"6-修改表的查询\"><a href=\"#6-修改表的查询\" class=\"headerlink\" title=\"6. 修改表的查询\"></a>6. 修改表的查询</h3><h4 id=\"ADD-添加字段\"><a href=\"#ADD-添加字段\" class=\"headerlink\" title=\"ADD: 添加字段\"></a><strong>ADD</strong>: 添加字段</h4><ul>\n<li><code>ALTER TABLE</code> table_name <code>ADD</code> column_name column_definition;</li>\n</ul>\n<h4 id=\"MODIFY-修改字段数据类型\"><a href=\"#MODIFY-修改字段数据类型\" class=\"headerlink\" title=\"MODIFY: 修改字段数据类型\"></a><strong>MODIFY</strong>: 修改字段数据类型</h4><ul>\n<li><code>ALTER TABLE</code> table_name <code>MODIFY</code> column_name column_type;</li>\n</ul>\n<h4 id=\"DROP-删除字段\"><a href=\"#DROP-删除字段\" class=\"headerlink\" title=\"DROP: 删除字段\"></a><strong>DROP</strong>: 删除字段</h4><ul>\n<li><code>ALTER TABLE</code> table_name <code>DROP COLUMN</code> column_name;</li>\n</ul>\n<h3 id=\"数学函数\"><a href=\"#数学函数\" class=\"headerlink\" title=\"数学函数\"></a>数学函数</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">ABS(x)         <span class=\"comment\">--返回x的绝对值</span></span><br><span class=\"line\">BIN(x)         <span class=\"comment\">--返回x的二进制（OCT返回八进制，HEX返回十六进制）</span></span><br><span class=\"line\">CEILING(x)     <span class=\"comment\">--返回大于x的最小整数值</span></span><br><span class=\"line\">EXP(x)         <span class=\"comment\">--返回值e（自然对数的底）的x次方</span></span><br><span class=\"line\">FLOOR(x)       <span class=\"comment\">--返回小于x的最大整数值</span></span><br><span class=\"line\">GREATEST(x1,x2,...,xn)</span><br><span class=\"line\">                <span class=\"comment\">--返回集合中最大的值</span></span><br><span class=\"line\">LEAST(x1,x2,...,xn)   </span><br><span class=\"line\">                <span class=\"comment\">--返回集合中最小的值</span></span><br><span class=\"line\">LN(x)           <span class=\"comment\">--返回x的自然对数</span></span><br><span class=\"line\">LOG(x,y)        <span class=\"comment\">--返回x的以y为底的对数</span></span><br><span class=\"line\">MOD(x,y)        <span class=\"comment\">--返回x/y的模（余数）</span></span><br><span class=\"line\">PI()            <span class=\"comment\">--返回pi的值（圆周率）</span></span><br><span class=\"line\">RAND()          <span class=\"comment\">--返回０到１内的随机值,可以通过提供一个参数(种子)使RAND()随机数生成器生成一个指定的值。</span></span><br><span class=\"line\">ROUND(x,y)      <span class=\"comment\">--返回参数x的四舍五入的有y位小数的值</span></span><br><span class=\"line\">SIGN(x)         <span class=\"comment\">--返回代表数字x的符号的值</span></span><br><span class=\"line\">SQRT(x)         <span class=\"comment\">--返回一个数的平方根</span></span><br><span class=\"line\"><span class=\"keyword\">TRUNCATE</span>(x,y)   <span class=\"comment\">--返回数字x截短为y位小数的结果</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"聚合函数\"><a href=\"#聚合函数\" class=\"headerlink\" title=\"聚合函数\"></a>聚合函数</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">AVG(X)            <span class=\"comment\">--返回指定列的平均值</span></span><br><span class=\"line\">COUNT(X)          <span class=\"comment\">--返回指定列中非NULL值的个数</span></span><br><span class=\"line\">MIN(X)            <span class=\"comment\">--返回指定列的最小值</span></span><br><span class=\"line\">MAX(X)            <span class=\"comment\">--返回指定列的最大值</span></span><br><span class=\"line\">SUM(X)            <span class=\"comment\">--返回指定列的所有值之和</span></span><br><span class=\"line\">GROUP_CONCAT(X)   <span class=\"comment\">--返回由属于一组的列值连接组合而成的结果，非常有用</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"字符串函数（20个）\"><a href=\"#字符串函数（20个）\" class=\"headerlink\" title=\"字符串函数（20个）\"></a>字符串函数（20个）</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">ASCII(char)        <span class=\"comment\">--返回字符的ASCII码值</span></span><br><span class=\"line\">BIT_LENGTH(str)    <span class=\"comment\">--返回字符串的比特长度</span></span><br><span class=\"line\">CONCAT(s1,s2...,sn) </span><br><span class=\"line\">                   <span class=\"comment\">--将s1,s2...,sn连接成字符串</span></span><br><span class=\"line\">CONCAT_WS(sep,s1,s2...,sn)</span><br><span class=\"line\">                   <span class=\"comment\">--将s1,s2...,sn连接成字符串，并用sep字符间隔</span></span><br><span class=\"line\"><span class=\"keyword\">INSERT</span>(<span class=\"keyword\">str</span>,x,y,<span class=\"keyword\">instr</span>) </span><br><span class=\"line\">                   <span class=\"comment\">--将字符串str从第x位置开始，y个字符长的子串替换为字符串instr，返回结果</span></span><br><span class=\"line\">FIND_IN_SET(<span class=\"keyword\">str</span>,<span class=\"keyword\">list</span>)</span><br><span class=\"line\">                   <span class=\"comment\">--分析逗号分隔的list列表，如果发现str，返回str在list中的位置</span></span><br><span class=\"line\"><span class=\"keyword\">LCASE</span>(<span class=\"keyword\">str</span>)或<span class=\"keyword\">LOWER</span>(<span class=\"keyword\">str</span>) </span><br><span class=\"line\">                   <span class=\"comment\">--返回将字符串str中所有字符改变为小写后的结果</span></span><br><span class=\"line\"><span class=\"keyword\">LEFT</span>(<span class=\"keyword\">str</span>,x)        <span class=\"comment\">--返回字符串str中最左边的x个字符</span></span><br><span class=\"line\"><span class=\"keyword\">LENGTH</span>(s)          <span class=\"comment\">--返回字符串str中的字符数</span></span><br><span class=\"line\"><span class=\"keyword\">LTRIM</span>(<span class=\"keyword\">str</span>)         <span class=\"comment\">--从字符串str中切掉开头的空格</span></span><br><span class=\"line\"><span class=\"keyword\">POSITION</span>(<span class=\"keyword\">substr</span>,<span class=\"keyword\">str</span>) </span><br><span class=\"line\">                   <span class=\"comment\">--返回子串substr在字符串str中第一次出现的位置</span></span><br><span class=\"line\">QUOTE(<span class=\"keyword\">str</span>)         <span class=\"comment\">--用反斜杠转义str中的单引号</span></span><br><span class=\"line\"><span class=\"keyword\">REPEAT</span>(<span class=\"keyword\">str</span>,srchstr,rplcstr)</span><br><span class=\"line\">                   <span class=\"comment\">--返回字符串str重复x次的结果</span></span><br><span class=\"line\"><span class=\"keyword\">REVERSE</span>(<span class=\"keyword\">str</span>)       <span class=\"comment\">--返回颠倒字符串str的结果</span></span><br><span class=\"line\"><span class=\"keyword\">RIGHT</span>(<span class=\"keyword\">str</span>,x)       <span class=\"comment\">--返回字符串str中最右边的x个字符</span></span><br><span class=\"line\"><span class=\"keyword\">RTRIM</span>(<span class=\"keyword\">str</span>)         <span class=\"comment\">--返回字符串str尾部的空格</span></span><br><span class=\"line\"><span class=\"keyword\">STRCMP</span>(s1,s2)      <span class=\"comment\">--比较字符串s1和s2</span></span><br><span class=\"line\"><span class=\"keyword\">TRIM</span>(<span class=\"keyword\">str</span>)          <span class=\"comment\">--去除字符串首部和尾部的所有空格</span></span><br><span class=\"line\"><span class=\"keyword\">UCASE</span>(<span class=\"keyword\">str</span>)或<span class=\"keyword\">UPPER</span>(<span class=\"keyword\">str</span>) </span><br><span class=\"line\">                   <span class=\"comment\">--返回将字符串str中所有字符转变为大写后的结果</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"日期和时间函数\"><a href=\"#日期和时间函数\" class=\"headerlink\" title=\"日期和时间函数\"></a>日期和时间函数</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">CURDATE()或CURRENT_DATE() </span><br><span class=\"line\">                   <span class=\"comment\">--返回当前的日期</span></span><br><span class=\"line\">CURTIME()或CURRENT_TIME() </span><br><span class=\"line\">                   <span class=\"comment\">--返回当前的时间</span></span><br><span class=\"line\">DATE_ADD(date,INTERVAL int keyword)</span><br><span class=\"line\">                   <span class=\"comment\">--返回日期date加上间隔时间int的结果(int必须按照关键字进行格式化)</span></span><br><span class=\"line\"><span class=\"comment\">-- 例如</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DATE_ADD</span>(<span class=\"keyword\">CURRENT_DATE</span>,<span class=\"built_in\">INTERVAL</span> <span class=\"number\">6</span> <span class=\"keyword\">MONTH</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">DATE_FORMAT(date,fmt)  </span><br><span class=\"line\">                   <span class=\"comment\">--依照指定的fmt格式格式化日期date值</span></span><br><span class=\"line\">DATE_SUB(date,INTERVAL int keyword)</span><br><span class=\"line\">                   <span class=\"comment\">--返回日期date加上间隔时间int的结果(int必须按照关键字进行格式化)</span></span><br><span class=\"line\"><span class=\"comment\">-- 例如</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DATE_SUB</span>(<span class=\"keyword\">CURRENT_DATE</span>,<span class=\"built_in\">INTERVAL</span> <span class=\"number\">6</span> <span class=\"keyword\">MONTH</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">DAYOFWEEK(date)    <span class=\"comment\">--返回date所代表的一星期中的第几天(1~7)</span></span><br><span class=\"line\">DAYOFMONTH(date)   <span class=\"comment\">--返回date是一个月的第几天(1~31)</span></span><br><span class=\"line\">DAYOFYEAR(date)    <span class=\"comment\">--返回date是一年的第几天(1~366)</span></span><br><span class=\"line\">DAYNAME(date)      <span class=\"comment\">--返回date的星期名，如：SELECT DAYNAME(CURRENT_DATE);</span></span><br><span class=\"line\">FROM_UNIXTIME(ts,fmt)  </span><br><span class=\"line\">                   <span class=\"comment\">--根据指定的fmt格式，格式化UNIX时间戳ts</span></span><br><span class=\"line\">HOUR(time)         <span class=\"comment\">--返回time的小时值(0~23)</span></span><br><span class=\"line\">MINUTE(time)       <span class=\"comment\">--返回time的分钟值(0~59)</span></span><br><span class=\"line\">MONTH(date)        <span class=\"comment\">--返回date的月份值(1~12)</span></span><br><span class=\"line\">MONTHNAME(date)    <span class=\"comment\">--返回date的月份名，如：SELECT MONTHNAME(CURRENT_DATE);</span></span><br><span class=\"line\">NOW()              <span class=\"comment\">--返回当前的日期和时间</span></span><br><span class=\"line\">QUARTER(date)      <span class=\"comment\">--返回date在一年中的季度(1~4)</span></span><br><span class=\"line\"><span class=\"comment\">-- 例如</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">QUARTER</span>(<span class=\"keyword\">CURRENT_DATE</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">WEEK(date)         <span class=\"comment\">--返回日期date为一年中第几周(0~53)</span></span><br><span class=\"line\">YEAR(date)         <span class=\"comment\">--返回日期date的年份(1000~9999)</span></span><br><span class=\"line\"><span class=\"comment\">-- 例如，获取当前系统时间</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> FROM_UNIXTIME(<span class=\"keyword\">UNIX_TIMESTAMP</span>());</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">EXTRACT</span>(YEAR_MONTH <span class=\"keyword\">FROM</span> <span class=\"keyword\">CURRENT_DATE</span>);</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">EXTRACT</span>(DAY_SECOND <span class=\"keyword\">FROM</span> <span class=\"keyword\">CURRENT_DATE</span>);</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">EXTRACT</span>(HOUR_MINUTE <span class=\"keyword\">FROM</span> <span class=\"keyword\">CURRENT_DATE</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 返回两个日期值之间的差值(月数)</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">PERIOD_DIFF</span>(<span class=\"number\">200302</span>,<span class=\"number\">199802</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 在Mysql中计算年龄：</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DATE_FORMAT</span>(<span class=\"keyword\">FROM_DAYS</span>(<span class=\"keyword\">TO_DAYS</span>(<span class=\"keyword\">NOW</span>())-<span class=\"keyword\">TO_DAYS</span>(birthday)),<span class=\"string\">'%Y'</span>)+<span class=\"number\">0</span> <span class=\"keyword\">AS</span> age <span class=\"keyword\">FROM</span> employee;</span><br><span class=\"line\"><span class=\"comment\">-- 这样，如果Brithday是未来的年月日的话，计算结果为0。</span></span><br><span class=\"line\"><span class=\"comment\">-- 下面的SQL语句计算员工的绝对年龄，即当Birthday是未来的日期时，将得到负值。</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DATE_FORMAT</span>(<span class=\"keyword\">NOW</span>(), <span class=\"string\">'%Y'</span>) </span><br><span class=\"line\">- <span class=\"keyword\">DATE_FORMAT</span>(birthday, <span class=\"string\">'%Y'</span>) </span><br><span class=\"line\">-(<span class=\"keyword\">DATE_FORMAT</span>(<span class=\"keyword\">NOW</span>(), <span class=\"string\">'00-%m-%d'</span>) </span><br><span class=\"line\">&lt; <span class=\"keyword\">DATE_FORMAT</span>(birthday, <span class=\"string\">'00-%m-%d'</span>)) <span class=\"keyword\">AS</span> age <span class=\"keyword\">from</span> employee</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"加密函数\"><a href=\"#加密函数\" class=\"headerlink\" title=\"加密函数\"></a>加密函数</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">AES_ENCRYPT(str,key)  </span><br><span class=\"line\"><span class=\"comment\">--返回用密钥key对字符串str利用高级加密标准算法加密后的结果，调用AES_ENCRYPT的结果是一个二进制字符串，以BLOB类型存储</span></span><br><span class=\"line\">AES_DECRYPT(str,key)  </span><br><span class=\"line\">                   <span class=\"comment\">--返回用密钥key对字符串str利用高级加密标准算法解密后的结果</span></span><br><span class=\"line\">DECODE(str,key)    <span class=\"comment\">--使用key作为密钥解密加密字符串str</span></span><br><span class=\"line\">ENCRYPT(str,salt)  <span class=\"comment\">--使用UNIXcrypt()函数，用关键词salt(一个可以惟一确定口令的字符串，就像钥匙一样)加密字符串str</span></span><br><span class=\"line\">ENCODE(str,key)    <span class=\"comment\">--使用key作为密钥加密字符串str，调用ENCODE()的结果是一个二进制字符串，它以BLOB类型存储</span></span><br><span class=\"line\">MD5()              <span class=\"comment\">--计算字符串str的MD5校验和</span></span><br><span class=\"line\">PASSWORD(str)      <span class=\"comment\">--返回字符串str的加密版本，这个加密过程是不可逆转的，和UNIX密码加密过程使用不同的算法。</span></span><br><span class=\"line\">SHA()              <span class=\"comment\">--计算字符串str的安全散列算法(SHA)校验和</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 例如</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">ENCRYPT</span>(<span class=\"string\">'root'</span>,<span class=\"string\">'salt'</span>) ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">ENCODE</span>(<span class=\"string\">'xufeng'</span>,<span class=\"string\">'key'</span>) ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DECODE</span>(<span class=\"keyword\">ENCODE</span>(<span class=\"string\">'xufeng'</span>,<span class=\"string\">'key'</span>),<span class=\"string\">'key'</span>) ;<span class=\"comment\">--加解密放在一起</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">AES_ENCRYPT</span>(<span class=\"string\">'root'</span>,<span class=\"string\">'key'</span>) ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">AES_DECRYPT</span>(<span class=\"keyword\">AES_ENCRYPT</span>(<span class=\"string\">'root'</span>,<span class=\"string\">'key'</span>),<span class=\"string\">'key'</span>) ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">MD5</span>(<span class=\"string\">'123456'</span>) ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">SHA</span>(<span class=\"string\">'123456'</span>) ;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"控制流函数\"><a href=\"#控制流函数\" class=\"headerlink\" title=\"控制流函数\"></a>控制流函数</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">CASE WHEN [test1] THEN [result1]...ELSE [default] <span class=\"keyword\">END</span> </span><br><span class=\"line\">                    <span class=\"comment\">--如果test1是真，则返回result1，否则返回default</span></span><br><span class=\"line\"><span class=\"keyword\">CASE</span> [<span class=\"keyword\">test</span>] <span class=\"keyword\">WHEN</span> [val1] <span class=\"keyword\">THEN</span> [<span class=\"keyword\">result</span>]...ELSE [<span class=\"keyword\">default</span>] <span class=\"keyword\">END</span>  </span><br><span class=\"line\">                    <span class=\"comment\">--如果test和valN相等，则返回result，否则返回default</span></span><br><span class=\"line\"><span class=\"keyword\">IF</span>(<span class=\"keyword\">test</span>,t,f)        <span class=\"comment\">--如果test是真，返回t；否则返回f</span></span><br><span class=\"line\"><span class=\"keyword\">IFNULL</span>(arg1,arg2)   <span class=\"comment\">--如果arg1不是空，返回arg1，否则返回arg2</span></span><br><span class=\"line\"><span class=\"keyword\">NULLIF</span>(arg1,arg2)   <span class=\"comment\">--如果arg1=arg2返回NULL；否则返回arg1</span></span><br><span class=\"line\"><span class=\"comment\">-- 这些函数的第一个是IFNULL()，它有两个参数，并且对第一个参数进行判断。</span></span><br><span class=\"line\"><span class=\"comment\">-- 如果第一个参数不是NULL，函数就会向调用者返回第一个参数；</span></span><br><span class=\"line\"><span class=\"comment\">-- 如果是NULL,将返回第二个参数。</span></span><br><span class=\"line\"><span class=\"comment\">-- 例如</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">IFNULL</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>), </span><br><span class=\"line\"><span class=\"keyword\">IFNULL</span>(<span class=\"literal\">NULL</span>,<span class=\"number\">10</span>),</span><br><span class=\"line\"><span class=\"keyword\">IFNULL</span>(<span class=\"number\">4</span>*<span class=\"literal\">NULL</span>,<span class=\"string\">'false'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">NULLIF() <span class=\"comment\">-- 函数将会检验提供的两个参数是否相等，如果相等，则返回NULL，</span></span><br><span class=\"line\"><span class=\"comment\">-- 如果不相等，就返回第一个参数。</span></span><br><span class=\"line\"><span class=\"comment\">-- 例如</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span>  <span class=\"keyword\">NULLIF</span>(<span class=\"number\">1</span>,<span class=\"number\">1</span>),</span><br><span class=\"line\"> <span class=\"keyword\">NULLIF</span>(<span class=\"string\">'A'</span>,<span class=\"string\">'B'</span>),</span><br><span class=\"line\"> <span class=\"keyword\">NULLIF</span>(<span class=\"number\">2</span>+<span class=\"number\">3</span>,<span class=\"number\">4</span>+<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">MySQL的IF()</span><br><span class=\"line\"><span class=\"comment\">-- 函数也可以建立一个简单的条件测试，</span></span><br><span class=\"line\"><span class=\"comment\">-- 这个函数有三个参数，第一个是要被判断的表达式，</span></span><br><span class=\"line\"><span class=\"comment\">-- 如果表达式为真，IF()将会返回第二个参数，</span></span><br><span class=\"line\"><span class=\"comment\">-- 如果为假，IF()将会返回第三个参数。</span></span><br><span class=\"line\"><span class=\"comment\">-- 例如</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">IF</span>(<span class=\"number\">1</span>&lt;<span class=\"number\">10</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>),<span class=\"keyword\">IF</span>(<span class=\"number\">56</span>&gt;<span class=\"number\">100</span>,<span class=\"string\">'true'</span>,<span class=\"string\">'false'</span>);</span><br><span class=\"line\"><span class=\"comment\">-- IF()函数在只有两种可能结果时才适合使用。</span></span><br><span class=\"line\"><span class=\"comment\">-- 然而，在现实世界中，我们可能发现在条件测试中会需要多个分支。</span></span><br><span class=\"line\"><span class=\"comment\">-- 在这种情况下，它和PHP及Perl语言的switch-case条件例程一样。</span></span><br><span class=\"line\"></span><br><span class=\"line\">CASE</span><br><span class=\"line\"><span class=\"comment\">-- 函数的格式有些复杂，通常如下所示：</span></span><br><span class=\"line\">CASE [expression to be evaluated]</span><br><span class=\"line\">WHEN [val 1] THEN [result 1]</span><br><span class=\"line\">WHEN [val 2] THEN [result 2]</span><br><span class=\"line\">WHEN [val 3] THEN [result 3]</span><br><span class=\"line\">......</span><br><span class=\"line\">WHEN [val n] THEN [result n]</span><br><span class=\"line\">ELSE [default result]</span><br><span class=\"line\"><span class=\"keyword\">END</span></span><br><span class=\"line\"><span class=\"comment\">-- 这里，第一个参数是要被判断的值或表达式，接下来的是一系列的WHEN-THEN块，</span></span><br><span class=\"line\"><span class=\"comment\">-- 每一块的第一个参数指定要比较的值，如果为真，就返回结果。</span></span><br><span class=\"line\"><span class=\"comment\">-- 所有的WHEN-THEN块将以ELSE块结束，当END结束了所有外部的CASE块时，</span></span><br><span class=\"line\"><span class=\"comment\">-- 如果前面的每一个块都不匹配就会返回ELSE块指定的默认结果。</span></span><br><span class=\"line\"><span class=\"comment\">-- 如果没有指定ELSE块，而且所有的WHEN-THEN比较都不是真，MySQL将会返回NULL。</span></span><br><span class=\"line\"><span class=\"keyword\">CASE</span>函数还有另外一种句法，有时使用起来非常方便，如下：</span><br><span class=\"line\"><span class=\"keyword\">CASE</span></span><br><span class=\"line\"><span class=\"keyword\">WHEN</span> [conditional <span class=\"keyword\">test</span> <span class=\"number\">1</span>] <span class=\"keyword\">THEN</span> [<span class=\"keyword\">result</span> <span class=\"number\">1</span>]</span><br><span class=\"line\"><span class=\"keyword\">WHEN</span> [conditional <span class=\"keyword\">test</span> <span class=\"number\">2</span>] <span class=\"keyword\">THEN</span> [<span class=\"keyword\">result</span> <span class=\"number\">2</span>]</span><br><span class=\"line\"><span class=\"keyword\">ELSE</span> [<span class=\"keyword\">default</span> <span class=\"keyword\">result</span>]</span><br><span class=\"line\"><span class=\"keyword\">END</span></span><br><span class=\"line\"><span class=\"comment\">-- 这种条件下，返回的结果取决于相应的条件测试是否为真。</span></span><br><span class=\"line\">例如：</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span>  <span class=\"keyword\">CASE</span> <span class=\"string\">'green'</span></span><br><span class=\"line\">      <span class=\"keyword\">WHEN</span> <span class=\"string\">'red'</span> <span class=\"keyword\">THEN</span> <span class=\"string\">'stop'</span></span><br><span class=\"line\">      <span class=\"keyword\">WHEN</span> <span class=\"string\">'green'</span> <span class=\"keyword\">THEN</span> <span class=\"string\">'go'</span> <span class=\"keyword\">END</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">CASE</span>  <span class=\"number\">9</span> </span><br><span class=\"line\"><span class=\"keyword\">WHEN</span> <span class=\"number\">1</span> <span class=\"keyword\">THEN</span> <span class=\"string\">'a'</span></span><br><span class=\"line\"><span class=\"keyword\">WHEN</span> <span class=\"number\">2</span> <span class=\"keyword\">THEN</span> <span class=\"string\">'b'</span> <span class=\"keyword\">ELSE</span> <span class=\"string\">'N/A'</span> <span class=\"keyword\">END</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">CASE</span> <span class=\"keyword\">WHEN</span> (<span class=\"number\">2</span>+<span class=\"number\">2</span>)=<span class=\"number\">4</span> <span class=\"keyword\">THEN</span> <span class=\"string\">'OK'</span> </span><br><span class=\"line\"><span class=\"keyword\">WHEN</span> (<span class=\"number\">2</span>+<span class=\"number\">2</span>)&lt;&gt;<span class=\"number\">4</span> <span class=\"keyword\">THEN</span> <span class=\"string\">'not OK'</span> <span class=\"keyword\">END</span> <span class=\"keyword\">AS</span> <span class=\"keyword\">STATUS</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">Name</span>,<span class=\"keyword\">IF</span>((IsActive = <span class=\"number\">1</span>),<span class=\"string\">'已激活'</span>,<span class=\"string\">'未激活'</span>) <span class=\"keyword\">AS</span> <span class=\"keyword\">RESULT</span> </span><br><span class=\"line\"><span class=\"keyword\">FROM</span> UserLoginInfo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> fname,lname,(math+sci+lit) <span class=\"keyword\">AS</span> total,</span><br><span class=\"line\"><span class=\"keyword\">CASE</span> <span class=\"keyword\">WHEN</span> (math+sci+lit) &lt; <span class=\"number\">50</span> <span class=\"keyword\">THEN</span> <span class=\"string\">'D'</span></span><br><span class=\"line\">     <span class=\"keyword\">WHEN</span> (math+sci+lit) <span class=\"keyword\">BETWEEN</span> <span class=\"number\">50</span> <span class=\"keyword\">AND</span> <span class=\"number\">150</span> <span class=\"keyword\">THEN</span> <span class=\"string\">'C'</span></span><br><span class=\"line\">     <span class=\"keyword\">WHEN</span> (math+sci+lit) <span class=\"keyword\">BETWEEN</span> <span class=\"number\">151</span> <span class=\"keyword\">AND</span> <span class=\"number\">250</span> <span class=\"keyword\">THEN</span> <span class=\"string\">'B'</span></span><br><span class=\"line\"><span class=\"keyword\">ELSE</span> <span class=\"string\">'A'</span> <span class=\"keyword\">END</span> <span class=\"keyword\">AS</span> grade <span class=\"keyword\">FROM</span> marks ;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">IF</span>(<span class=\"keyword\">ENCRYPT</span>(<span class=\"string\">'sue'</span>,<span class=\"string\">'ts'</span>)=upass,<span class=\"string\">'allow'</span>,<span class=\"string\">'deny'</span>) <span class=\"keyword\">AS</span> LoginResult</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> <span class=\"keyword\">users</span> <span class=\"keyword\">WHERE</span> uname = <span class=\"string\">'sue'</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"格式化函数\"><a href=\"#格式化函数\" class=\"headerlink\" title=\"格式化函数\"></a>格式化函数</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">DATE_FORMAT(date,fmt)  </span><br><span class=\"line\">                  <span class=\"comment\">--依照字符串fmt格式化日期date值</span></span><br><span class=\"line\">FORMAT(x,y)       <span class=\"comment\">--把x格式化为以逗号隔开的数字序列，y是结果的小数位数</span></span><br><span class=\"line\">INET_ATON(ip)     <span class=\"comment\">--返回IP地址的数字表示</span></span><br><span class=\"line\">INET_NTOA(num)    <span class=\"comment\">--返回数字所代表的IP地址</span></span><br><span class=\"line\">TIME_FORMAT(time,fmt)   </span><br><span class=\"line\">                  <span class=\"comment\">--依照字符串fmt格式化时间time值</span></span><br><span class=\"line\"><span class=\"comment\">-- 其中最简单的是FORMAT()函数，</span></span><br><span class=\"line\"><span class=\"comment\">-- 它可以把大的数值格式化为以逗号间隔的易读的序列。</span></span><br><span class=\"line\"><span class=\"comment\">-- 例如</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">FORMAT</span>(<span class=\"number\">34234.34323432</span>,<span class=\"number\">3</span>) ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DATE_FORMAT</span>(<span class=\"keyword\">NOW</span>(),<span class=\"string\">'%W,%D %M %Y %r'</span>) ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DATE_FORMAT</span>(<span class=\"keyword\">NOW</span>(),<span class=\"string\">'%Y-%m-%d'</span>) ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DATE_FORMAT</span>(<span class=\"number\">19990330</span>,<span class=\"string\">'%Y-%m-%d'</span>) ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DATE_FORMAT</span>(<span class=\"keyword\">NOW</span>(),<span class=\"string\">'%h:%i %p'</span>) ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">INET_ATON</span>(<span class=\"string\">'10.122.89.47'</span>) ;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">INET_NTOA</span>(<span class=\"number\">175790383</span>) ;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"类型转化函数\"><a href=\"#类型转化函数\" class=\"headerlink\" title=\"类型转化函数\"></a>类型转化函数</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 为了进行数据类型转化，MySQL提供了CAST()函数，</span></span><br><span class=\"line\"><span class=\"comment\">-- 它可以把一个值转化为指定的数据类型。</span></span><br><span class=\"line\"><span class=\"comment\">-- 类型有：</span></span><br><span class=\"line\">BINARY,CHAR,DATE,TIME,DATETIME,SIGNED,UNSIGNED</span><br><span class=\"line\"><span class=\"comment\">-- 例如</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">CAST</span>(<span class=\"keyword\">NOW</span>() <span class=\"keyword\">AS</span> SIGNED <span class=\"built_in\">INTEGER</span>),<span class=\"keyword\">CURDATE</span>()+<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"string\">'f'</span>=<span class=\"built_in\">BINARY</span> <span class=\"string\">'F'</span>,<span class=\"string\">'f'</span>=<span class=\"keyword\">CAST</span>(<span class=\"string\">'F'</span> <span class=\"keyword\">AS</span> <span class=\"built_in\">BINARY</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"系统信息函数\"><a href=\"#系统信息函数\" class=\"headerlink\" title=\"系统信息函数\"></a>系统信息函数</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">DATABASE()         <span class=\"comment\">--返回当前数据库名</span></span><br><span class=\"line\">BENCHMARK(count,expr)   </span><br><span class=\"line\">                   <span class=\"comment\">--将表达式expr重复运行count次</span></span><br><span class=\"line\">CONNECTION_ID()    <span class=\"comment\">--返回当前客户的连接ID</span></span><br><span class=\"line\">FOUND_ROWS()       <span class=\"comment\">--返回最后一个SELECT查询进行检索的总行数</span></span><br><span class=\"line\">USER()或SYSTEM_USER()  </span><br><span class=\"line\">                   <span class=\"comment\">--返回当前登陆用户名</span></span><br><span class=\"line\">VERSION()          <span class=\"comment\">--返回MySQL服务器的版本</span></span><br><span class=\"line\"><span class=\"comment\">-- 例如</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DATABASE</span>(),<span class=\"keyword\">VERSION</span>(),<span class=\"keyword\">USER</span>();</span><br><span class=\"line\">SELECTBENCHMARK(9999999,LOG(RAND()*PI()));</span><br><span class=\"line\"><span class=\"comment\">--该例中,MySQL计算LOG(RAND()*PI())表达式9999999次。</span></span><br></pre></td></tr></table></figure>\n\n","categories":["Mysql"],"tags":["Mysql","参考文档"]},{"title":"Centos7-Selenium-Java-Dev","url":"/posts/4212331734/","content":"<blockquote>\n<p>最近在编写爬虫程序，这里简单的做下笔记。</p>\n</blockquote>\n<h3 id=\"阅读注意事项\"><a href=\"#阅读注意事项\" class=\"headerlink\" title=\"阅读注意事项\"></a>阅读注意事项</h3><ol>\n<li>需要一台服务器(阿里ESC)这种，分配的公网ip。</li>\n<li>这里使用的yum安装，所以环境配置都创建好了，不需要在手动修改。</li>\n</ol>\n<h3 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h3><blockquote>\n<p>安装Java、maven、git、selenium运行环境</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用的机器是centos7.4</span></span><br><span class=\"line\"><span class=\"comment\"># 系统环境一个一个来安装。</span></span><br><span class=\"line\"><span class=\"comment\"># 1.检查是否安装jdk</span></span><br><span class=\"line\">-&gt; yum install java-1.8.0-openjdk-devel.x86_64</span><br><span class=\"line\">-&gt; java -version</span><br><span class=\"line\">openjdk version <span class=\"string\">\"1.8.0_262\"</span></span><br><span class=\"line\">OpenJDK Runtime Environment (build 1.8.0_262-b10)</span><br><span class=\"line\">OpenJDK 64-Bit Server VM (build 25.262-b10, mixed mode)</span><br><span class=\"line\">-&gt; yum install maven</span><br><span class=\"line\">-&gt; mvn -version</span><br><span class=\"line\">Java version: 1.8.0_262, vendor: Oracle Corporation</span><br><span class=\"line\">Java home: /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.262.b10-0.el7_8.x86_64/jre</span><br><span class=\"line\">Default locale: zh_CN, platform encoding: UTF-8</span><br><span class=\"line\">OS name: <span class=\"string\">\"linux\"</span>, version: <span class=\"string\">\"3.10.0-862.el7.x86_64\"</span>, arch: <span class=\"string\">\"amd64\"</span>, family: <span class=\"string\">\"unix\"</span></span><br><span class=\"line\">-&gt; yum install git</span><br><span class=\"line\">git version 1.8.3.1</span><br><span class=\"line\"><span class=\"comment\"># 查看是否生成过证书</span></span><br><span class=\"line\">-&gt; ls -al ~/.ssh</span><br><span class=\"line\"><span class=\"comment\"># 这里配置下ssh公钥方便git拉去代码</span></span><br><span class=\"line\">-&gt; ssh-keygen -t rsa -C “you email@gamil.com”</span><br><span class=\"line\"><span class=\"comment\"># 查看证书</span></span><br><span class=\"line\">-&gt; cat ~/.ssh/id_rsa.pub</span><br><span class=\"line\"><span class=\"comment\"># 开始配置 selenium 运行环境</span></span><br><span class=\"line\">-&gt; wget https://dl.google.com/linux/direct/google-chrome-stable_current_x86_64.rpm</span><br><span class=\"line\">-&gt; yum localinstall google-chrome-stable_current_x86_64.rpm</span><br><span class=\"line\"><span class=\"comment\"># 检查版本 </span></span><br><span class=\"line\">-&gt; google-chrome --version </span><br><span class=\"line\">Google Chrome 85.0.4183.83 </span><br><span class=\"line\"><span class=\"comment\"># 安装 chromedriver</span></span><br><span class=\"line\">-&gt; yum install chromedriver</span><br><span class=\"line\">-&gt; chromedriver -version</span><br><span class=\"line\">ChromeDriver 84.0.4147.89 </span><br><span class=\"line\"><span class=\"comment\"># 这里注意 chromedriver 可能与chrome的版本不一致，去官方网站下载后解压复制到/usr/bin中</span></span><br><span class=\"line\"><span class=\"comment\"># 下载地址 https://chromedriver.chromium.org/</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>注意 google-chrome 和 chromedriver版本是需要对应的具体可以到官方查看。</li>\n<li>在centos上运行需要配置下关键参数</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">ChromeOptions chromeOptions = <span class=\"keyword\">new</span> ChromeOptions();</span><br><span class=\"line\">   chromeOptions.addArguments(<span class=\"string\">\"--headless\"</span>);</span><br><span class=\"line\">   chromeOptions.addArguments(<span class=\"string\">\"--disable-gpu\"</span>); <span class=\"comment\">// 不配置一定报错</span></span><br><span class=\"line\">   chromeOptions.addArguments(<span class=\"string\">\"--no-sandbox\"</span>);</span><br><span class=\"line\">   <span class=\"comment\">// 创建无界面浏览器对象</span></span><br><span class=\"line\">   chromeOptions.setHeadless(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ChromeDriver(chromeOptions);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>启动代码的需要指定环境变量</li>\n</ul>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">System.setProperty(<span class=\"string\">\"webdriver.chrome.chromedriver\"</span>, <span class=\"string\">\"/usr/bin/chromedriver\"</span>);</span><br><span class=\"line\"># 具体可以通过 whereis chromedriver查看。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h3><p><a href=\"https://segmentfault.com/a/1190000015389941\" target=\"_blank\" rel=\"noopener\">CentOS使用yum安装jdk</a></p>\n","categories":["Selenium"],"tags":["Java","Centos7","Linux","Selenium"]},{"title":"Nginx-Https","url":"/posts/2531120770/","content":"<blockquote>\n<p>最近在搭建测试环境，很久没接触nginx了。</p>\n</blockquote>\n<h3 id=\"阅读注意事项\"><a href=\"#阅读注意事项\" class=\"headerlink\" title=\"阅读注意事项\"></a>阅读注意事项</h3><ol>\n<li>需要一个域名，并且在国内备案过。</li>\n<li>需要一台服务器(阿里ESC)这种，分配的公网ip。</li>\n<li>申请或者购买一张证书。和域名做关联，域名解析到服务器的公网ip。注意开放服务区的80、443端口。<ol>\n<li>证书有两个文件<ol>\n<li><code>domian.name.key domain.name.pem</code></li>\n</ol>\n</li>\n<li>吧证书上传到目标nginx服务器中。</li>\n<li>检查服务器防火墙</li>\n</ol>\n</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo firewall-cmd --permanent --zone=public --add-service=http</span><br><span class=\"line\">sudo firewall-cmd --permanent --zone=public --add-service=https</span><br><span class=\"line\">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"开始步骤\"><a href=\"#开始步骤\" class=\"headerlink\" title=\"开始步骤\"></a>开始步骤</h3><h4 id=\"安装nginx\"><a href=\"#安装nginx\" class=\"headerlink\" title=\"安装nginx\"></a>安装nginx</h4><blockquote>\n<p>服务器使用的Centos服务器 使用yum安装nginx。</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">-&gt; yum install -y nginx</span><br><span class=\"line\"><span class=\"comment\">#检查nginx安装位置信息</span></span><br><span class=\"line\">-&gt; whereis nginx</span><br><span class=\"line\">nginx: /usr/sbin/nginx /usr/lib64/nginx /etc/nginx /usr/share/nginx /usr/share/man/man3/nginx.3pm.gz /usr/share/man/man8/nginx.8.gz</span><br><span class=\"line\"><span class=\"comment\"># 实际上是安装到/etc/nginx里面了</span></span><br><span class=\"line\"><span class=\"comment\"># 设置开机自动启动nginx</span></span><br><span class=\"line\">-&gt; sudo systemctl <span class=\"built_in\">enable</span> nginx</span><br><span class=\"line\">Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.</span><br><span class=\"line\"><span class=\"comment\"># 切换到nginx安装目录</span></span><br><span class=\"line\">-&gt; <span class=\"built_in\">cd</span> /etc/nginx</span><br><span class=\"line\"><span class=\"comment\"># 启动nginx</span></span><br><span class=\"line\">-&gt; nginx</span><br><span class=\"line\"><span class=\"comment\"># 测试nginx 在浏览器里面请求http://ip 就可以了看到nginx页面就算安装成功</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置证书\"><a href=\"#配置证书\" class=\"headerlink\" title=\"配置证书\"></a>配置证书</h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建证书文件并且将证书复制近文件中</span></span><br><span class=\"line\">-&gt; <span class=\"built_in\">cd</span> /etc/nginx</span><br><span class=\"line\">-&gt; mkdir cert</span><br><span class=\"line\">-&gt; mv domian.name.key /etc/nginx/cert/</span><br><span class=\"line\">-&gt; mv domian.name.pem /etc/nginx/cert/</span><br><span class=\"line\"><span class=\"comment\"># 配置nginx.conf文件使证书生效，并将80端口转发到443端口上。</span></span><br><span class=\"line\">-&gt; vim nginx.conf</span><br><span class=\"line\"><span class=\"comment\">#以下属性中以ssl开头的属性代表与证书配置有关，其他属性请根据自己的需要进行配置。</span></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">         listen 443; <span class=\"comment\">#配置HTTPS的默认访问端口号为443。此处如果未配置HTTPS的默认访问端口，可能会造成Nginx无法启动。Nginx 1.15.0以上版本请使用listen 443 ssl代替listen 443和ssl on。</span></span><br><span class=\"line\">         server_name www.certificatestests.com; <span class=\"comment\">#将www.certificatestests.com修改为您证书绑定的域名，例如：www.example.com。如果您购买的是通配符域名证书，要修改为通配符域名，例如：*.aliyun.com。</span></span><br><span class=\"line\">         root html;</span><br><span class=\"line\">         index index.html index.htm;</span><br><span class=\"line\">         ssl_certificate cert/domain name.pem;  <span class=\"comment\">#将domain name.pem替换成您证书的文件名称。</span></span><br><span class=\"line\">         ssl_certificate_key cert/domain name.key; <span class=\"comment\">#将domain name.key替换成您证书的密钥文件名称。</span></span><br><span class=\"line\">         ssl_session_timeout 5m;</span><br><span class=\"line\">         ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; <span class=\"comment\">#使用此加密套件。</span></span><br><span class=\"line\">         ssl_protocols TLSv1 TLSv1.1 TLSv1.2; <span class=\"comment\">#使用该协议进行配置。</span></span><br><span class=\"line\">         ssl_prefer_server_ciphers on;</span><br><span class=\"line\">         location / &#123;</span><br><span class=\"line\">         root html;  <span class=\"comment\">#站点目录。</span></span><br><span class=\"line\">         index index.html index.htm;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\"><span class=\"comment\">#        listen       80 default_server;</span></span><br><span class=\"line\"><span class=\"comment\">#        listen       [::]:80 default_server;</span></span><br><span class=\"line\"><span class=\"comment\">#        server_name  _;</span></span><br><span class=\"line\">        listen 80;</span><br><span class=\"line\">        listen [::]:80;</span><br><span class=\"line\">        server_name www.certificatestests.com;</span><br><span class=\"line\">        <span class=\"built_in\">return</span> 301 https://<span class=\"variable\">$host</span><span class=\"variable\">$request_uri</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"><span class=\"comment\"># 保存并推出、检查配置nginx配置文件是否合法、并重启nginx</span></span><br><span class=\"line\">-&gt; nginx -t</span><br><span class=\"line\">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class=\"line\">nginx: configuration file /etc/nginx/nginx.conf <span class=\"built_in\">test</span> is successful</span><br><span class=\"line\">-&gt; nginx -s reload</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"测试域名证书是否生效\"><a href=\"#测试域名证书是否生效\" class=\"headerlink\" title=\"测试域名证书是否生效\"></a>测试域名证书是否生效</h4><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">https:&#x2F;&#x2F;domian</span><br><span class=\"line\">http:&#x2F;&#x2F;domian 检查是否安全链接即可。一般浏览器上面会出现一个安全的标志</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h3><p><a href=\"https://help.aliyun.com/document_detail/98728.html?spm=5176.2020520163.0.dexternal.3e4756a7jNJMZQ\" target=\"_blank\" rel=\"noopener\">阿里云帮助文档-在Nginx上配置证书</a></p>\n<p><a href=\"https://segmentfault.com/a/1190000018109309\" target=\"_blank\" rel=\"noopener\">CentOS 7 上安装最新版 Nginx</a></p>\n","categories":["Dev"],"tags":["Nginx","Https"]},{"title":"SpringBoot-Change-Tomcat-Version","url":"/posts/3681309085/","content":"<blockquote>\n<p>本章只是回顾一次eureka版本升级后tomcat资源占用过高的问题，临时解决。</p>\n</blockquote>\n<h3 id=\"升级springBoot、SpringCloud版本\"><a href=\"#升级springBoot、SpringCloud版本\" class=\"headerlink\" title=\"升级springBoot、SpringCloud版本\"></a>升级springBoot、SpringCloud版本</h3><ul>\n<li>升级完成后直接在测试环境测试部署，结果发现eureka的cpu资源占用过高，导致假死。通过arthas发现是tomcat线程阻塞。通过dependepency看了下springboot中内嵌tomcat的版本是9了。之前是8，测试环境一大堆人等着测试接口。首先想着降低tomcat版本。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">查看依赖</span><br><span class=\"line\">gradle dependencies</span><br><span class=\"line\">mvn dependency:tree &gt; output.txt   # 输出到文件里</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"排除SpringBoot的Tomcat，指定Tomcat版本\"><a href=\"#排除SpringBoot的Tomcat，指定Tomcat版本\" class=\"headerlink\" title=\"排除SpringBoot的Tomcat，指定Tomcat版本\"></a>排除SpringBoot的Tomcat，指定Tomcat版本</h3><p>有时候我们需要在特定情况下使用特定的Tomcat版本，这时候总不能因为Tomcat就改变SpringBoot的版本，所以可以采用排除SpringBoot中的Tomcat包，然后手动指定Tomcat的版本，当然还要引入Tomcat相关的包。</p>\n<h5 id=\"Gradle的配置\"><a href=\"#Gradle的配置\" class=\"headerlink\" title=\"Gradle的配置\"></a>Gradle的配置</h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">compile(<span class=\"string\">'org.springframework.boot:spring-boot-starter-web'</span>) &#123;</span><br><span class=\"line\">  exclude <span class=\"keyword\">module</span>: <span class=\"string\">\"spring-boot-starter-tomcat\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">compile <span class=\"string\">'org.apache.tomcat.embed:tomcat-embed-core:8.5.37'</span></span><br><span class=\"line\">compile <span class=\"string\">'org.apache.tomcat.embed:tomcat-embed-el:8.5.37'</span></span><br><span class=\"line\">compile <span class=\"string\">'org.apache.tomcat.embed:tomcat-embed-logging-juli:8.5.2'</span></span><br><span class=\"line\">compile <span class=\"string\">'org.apache.tomcat.embed:tomcat-embed-websocket:8.5.37'</span></span><br></pre></td></tr></table></figure>\n\n<p>如果不指定版本，则会使用最新的Tomcat版本, 否则直接指定对应的版本号。</p>\n<h5 id=\"Maven的配置\"><a href=\"#Maven的配置\" class=\"headerlink\" title=\"Maven的配置\"></a>Maven的配置</h5><ol>\n<li>在 pom.xml文件里面添加一个标签<properties>，添加期望的版本。</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tomcat.version</span>&gt;</span>8.5.37<span class=\"tag\">&lt;/<span class=\"name\">tomcat.version</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>添加必要的Jar包：</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span> </span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.tomcat<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span> </span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>tomcat-juli<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span> </span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;tomcat.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span> </span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.tomcat.embed<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>tomcat-embed-logging-juli<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;tomcat.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>重新部署eureka后一切正常。处理时间短暂，没有影响大家工作。时间过了大半年了，也忘记具体是啥原因了。有机会本地复现试试。</p>\n","categories":["Spring"],"tags":["SpringBoot","Eureka","Tomcat"]},{"title":"Eureka-Dingding-Notification","url":"/posts/288875540/","content":"<blockquote>\n<p>本篇幅只是回顾使用eureka的时候如何钉钉告警。</p>\n</blockquote>\n<h3 id=\"eureka如何快速实现钉钉告警\"><a href=\"#eureka如何快速实现钉钉告警\" class=\"headerlink\" title=\"eureka如何快速实现钉钉告警\"></a>eureka如何快速实现钉钉告警</h3><p><a href=\"https://z201.cn/2020/07/15/%E5%AE%9E%E8%B7%B5-spring-boot%E5%BC%82%E5%B8%B8%E9%92%89%E9%92%89%E9%80%9A%E7%9F%A5/\">实践-spring-boot异常钉钉通知</a></p>\n<p>​        上面实践了springboot全局异常钉钉告警机制。这篇主要回顾eureka监听机制钉钉告警。在日常维护工作中，如果出现网络抖动或者其它问题导致应用不可用，需要第一件发出告警提醒相关人员尽快处理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">sequenceDiagram</span><br><span class=\"line\">eureka -&gt;&gt; eventListener : event</span><br><span class=\"line\">eventListener -&gt;&gt;  钉钉 : alarmNoticeSend</span><br><span class=\"line\">钉钉 -&gt;&gt; 开发人员  : eurekaInstanceInfo</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>实例图</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/eureka%E5%AE%9E%E4%BE%8B%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6.png\"></p>\n<p>​        关键代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@EventListener</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">listen</span><span class=\"params\">(EurekaInstanceCanceledEvent event)</span> </span>&#123;</span><br><span class=\"line\">        log.error(<span class=\"string\">\"告警通知 [&#123;&#125;] 服务注销 timestamp [&#123;&#125;] serverId [&#123;&#125;]\"</span>,</span><br><span class=\"line\">                event.getAppName(),</span><br><span class=\"line\">                event.getTimestamp(),</span><br><span class=\"line\">                event.getServerId());</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!event.isReplication()) &#123;</span><br><span class=\"line\">            ServiceNotice serviceNotice = <span class=\"keyword\">new</span> ServiceNotice();</span><br><span class=\"line\">            serviceNotice.setTitle(<span class=\"string\">\"告警通知 服务下线\"</span>);</span><br><span class=\"line\">            serviceNotice.setAppName(event.getAppName());</span><br><span class=\"line\">            serviceNotice.setTimestamp(event.getTimestamp());</span><br><span class=\"line\">            serviceNotice.setServerId(event.getServerId());</span><br><span class=\"line\">            serviceNotice.setProfiles(active);</span><br><span class=\"line\">            alarmNoticeManage.createNotice(serviceNotice, <span class=\"string\">\"\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@EventListener</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">listen</span><span class=\"params\">(EurekaInstanceRegisteredEvent event)</span> </span>&#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">\"告警通知 [&#123;&#125;] 服务注册 timestamp [&#123;&#125;] id [&#123;&#125;] ipAddr [&#123;&#125;] \"</span>,</span><br><span class=\"line\">                event.getInstanceInfo().getAppName(),</span><br><span class=\"line\">                event.getTimestamp(),</span><br><span class=\"line\">                event.getInstanceInfo().getId(),</span><br><span class=\"line\">                event.getInstanceInfo().getIPAddr()</span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!event.isReplication()) &#123;</span><br><span class=\"line\">            ServiceNotice serviceNotice = <span class=\"keyword\">new</span> ServiceNotice();</span><br><span class=\"line\">            serviceNotice.setTitle(<span class=\"string\">\"告警通知 服务上线\"</span>);</span><br><span class=\"line\">            serviceNotice.setAppName(event.getInstanceInfo().getAppName());</span><br><span class=\"line\">            serviceNotice.setTimestamp(event.getTimestamp());</span><br><span class=\"line\">            serviceNotice.setServerId(event.getInstanceInfo().getId());</span><br><span class=\"line\">            serviceNotice.setProfiles(active);</span><br><span class=\"line\">            alarmNoticeManage.createNotice(serviceNotice, <span class=\"string\">\"\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>效果如下</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">告警通知 服务下线</span><br><span class=\"line\">2020-07-16 16:03:20 Z-GATEWAY 192.168.31.7:z-gateway:9000 profiles dev1</span><br><span class=\"line\">@xxx</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>eureka查看源码得知有五个事件。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">EurekaServerStartedEvent - Eureka服务端启动事件</span><br><span class=\"line\">EurekaRegistryAvailableEvent - Eureka服务端可用事件</span><br><span class=\"line\">EurekaInstanceRegisteredEvent - Eureka客户端服务注册事件</span><br><span class=\"line\">EurekaInstanceRenewedEvent - Eureka客户端续约事件</span><br><span class=\"line\">EurekaInstanceCanceledEvent - Eureka客户端下线事件</span><br></pre></td></tr></table></figure>\n\n<p>这里就比较简单了。</p>\n","categories":["Eureka"],"tags":["微服务","Java","Eureka","钉钉"]},{"title":"SpringBoot-Error-Dingding-Notification","url":"/posts/1118278652/","content":"<blockquote>\n<p>本篇幅只是回顾使用钉钉做异常告警需要那些关键业务信息。</p>\n</blockquote>\n<h3 id=\"为什么要做钉钉通知？\"><a href=\"#为什么要做钉钉通知？\" class=\"headerlink\" title=\"为什么要做钉钉通知？\"></a>为什么要做钉钉通知？</h3><p>​        事情要从我入职上家公司说起，进入公司后把线上项目clone下来大致看了下。代码风格过于滞后、编码风格混乱。进入公司第一周就出现了线上故障，嗯。我去线上检查日志，emmmm竟然没有日志输出。这次故障是由客户反馈来的。当时我非常吃惊，大伙好像很淡定的样子，习以为常了？</p>\n<p>​        想到当初面试的时候和总监的谈话，主要是带领团队落地微服务架构，看来必须大刀阔斧了。</p>\n<p>​        首先想到的时候改进日志输出、定义全局异常级别，根据异常级别输出日志。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">sequenceDiagram</span><br><span class=\"line\">Java应用 -&gt;&gt; SpringAop全局异常拦截 : runtimeException</span><br><span class=\"line\">SpringAop全局异常拦截 -&gt;&gt;  钉钉 : alarmNoticeSend</span><br><span class=\"line\">钉钉 -&gt;&gt; 开发人员  : exceptionInfo</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>效果图</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/springboot%E9%92%89%E9%92%89%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E6%8B%A6%E6%88%AA.png\"></p>\n<p>​        我们需要从钉钉里面看到那些异常信息呢？这是当时输出到钉钉的信息。通过编写全局拦截器，在公共基础项目里面添加了aop全局拦截。刚开始上线的时候钉钉一天动不动就几千个异常告警。刚开始大伙都很紧张，过了个把月大伙已经又麻木了。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">告警信息</span><br><span class=\"line\">工程名：z201-gateway</span><br><span class=\"line\">类路径：cn.z201.cloud.gateway.VlinkFrameworkGatewayApplicationTest</span><br><span class=\"line\">方法名：alarm</span><br><span class=\"line\">异常信息：java.lang.IllegalAccessException</span><br><span class=\"line\">异常追踪：</span><br><span class=\"line\">cn.z201.cloud.gateway.VlinkFrameworkGatewayApplicationTest.alarm(VlinkFrameworkGatewayApplicationTest.java:<span class=\"number\">64</span>)</span><br><span class=\"line\">sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class=\"line\">sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class=\"number\">62</span>)</span><br><span class=\"line\">sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class=\"number\">43</span>)</span><br><span class=\"line\">java.lang.reflect.Method.invoke(Method.java:<span class=\"number\">498</span>)</span><br><span class=\"line\">org.junit.runners.model.FrameworkMethod$<span class=\"number\">1</span>.runReflectiveCall(FrameworkMethod.java:<span class=\"number\">50</span>)</span><br><span class=\"line\">org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:<span class=\"number\">12</span>)</span><br><span class=\"line\">org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:<span class=\"number\">47</span>)</span><br><span class=\"line\">org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:<span class=\"number\">17</span>)</span><br><span class=\"line\">org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:<span class=\"number\">74</span>)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"这样的告警信息就够了吗？\"><a href=\"#这样的告警信息就够了吗？\" class=\"headerlink\" title=\"这样的告警信息就够了吗？\"></a>这样的告警信息就够了吗？</h3><p>​        明显这样是不够够的，前端有安卓、ios、微信小程序、web、快应用。太多前端项目了，后端需要识别出是哪里的项目出的问题。于是又改进了一次。邀请前端开发人员在HttpHeader里面增加额外参数。为了做流量区分也增加了一些参数。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"> &#123;</span><br><span class=\"line\">  <span class=\"string\">\"Content-Type\"</span>:<span class=\"string\">\"application/json\"</span> </span><br><span class=\"line\">  \"Authorization\":\"Bearer xxxxxxxxxx\"  ## jwt</span><br><span class=\"line\">  \"Client-Business-Group-Source\": \"1\", ##  业务组来源唯一标号</span><br><span class=\"line\">  \"Client-Business-Source\": \"1000\", ## 业务来源唯一标号</span><br><span class=\"line\">  \"Client-Business-Activity-Source\": \"1\", ## 查看介绍、更多 针对特殊业务流量识别</span><br><span class=\"line\">  \"Client-Env-Source\": \"1\",\t\t\t\t ##客户端环境来源  1 ios  2 android  3 windows</span><br><span class=\"line\">  \"Client-Platform-Source\": \"xxx\", ##客户端平台 xxx手机型号、浏览器</span><br><span class=\"line\">  \"Client-Start-Time\": \"1\",        ##请求时间戳</span><br><span class=\"line\">  \"Client-Version-Source\": \"1.0.0\" ##客户端版本号</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>​        通过上面的改进告警信息完善很多。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">告警信息</span><br><span class=\"line\">工程名：z201-gateway</span><br><span class=\"line\">类路径：cn.z201.cloud.gateway.VlinkFrameworkGatewayApplicationTest</span><br><span class=\"line\">方法名：alarm</span><br><span class=\"line\">异常信息：java.lang.IllegalAccessException</span><br><span class=\"line\">异常扩展信息： &#123;</span><br><span class=\"line\">  &quot;Client-Business-Source&quot;: &quot;1000&quot;, </span><br><span class=\"line\">  &quot;Client-Business-Activity-Source&quot;: &quot;1&quot;, </span><br><span class=\"line\">  &quot;Client-Env-Source&quot;: &quot;1&quot;,\t\t\t\t </span><br><span class=\"line\">  &quot;Client-Platform-Source&quot;: &quot;xxx&quot;,   </span><br><span class=\"line\">  &quot;Client-Version-Source&quot;: &quot;1.0.0&quot; </span><br><span class=\"line\">&#125; </span><br><span class=\"line\">异常追踪：</span><br><span class=\"line\">cn.z201.cloud.gateway.VlinkFrameworkGatewayApplicationTest.alarm(VlinkFrameworkGatewayApplicationTest.java:64)</span><br><span class=\"line\">sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class=\"line\">sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class=\"line\">sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class=\"line\">java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class=\"line\">org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)</span><br><span class=\"line\">org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)</span><br><span class=\"line\">org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)</span><br><span class=\"line\">org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)</span><br><span class=\"line\">org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"分布式下面临的问题！\"><a href=\"#分布式下面临的问题！\" class=\"headerlink\" title=\"分布式下面临的问题！\"></a>分布式下面临的问题！</h3><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">sequenceDiagram</span><br><span class=\"line\">gateway -&gt;&gt; 应用A : httpRequest</span><br><span class=\"line\">应用A -&gt;&gt;  应用B : httpRequest</span><br><span class=\"line\">应用B --&gt;&gt; 应用A : httpResponse</span><br><span class=\"line\">应用A --&gt;&gt; gateway : httpResponse</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/%E5%A4%9A%E5%BA%94%E7%94%A8%E9%93%BE%E8%B7%AF%E8%AF%B7%E6%B1%82.png\"></p>\n<p>​        当调用链多的时候定位问题就有点麻烦，比如应用a调用应用b。应用b执行了异常信息直接抛出了告警信息。但是spring cloud http rpc默认是不会吧请求参数传递到后面的服务中，需要我们做下简单的扩展。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">HttpApiConstant</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    String X_REAL_IP = <span class=\"string\">\"x-real-ip\"</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 请求头跟踪id名。</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    String HTTP_HEADER_TRACE_ID = <span class=\"string\">\"AppTraceId\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 请求头</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    String HTTP_TOKEN_HEADER = <span class=\"string\">\"Authorization\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * app租户</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    String APP_TENANT = <span class=\"string\">\"Tenant\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    String CLIENT_BUSINESS_GROUP_SOURCE = <span class=\"string\">\"Client-Business-Group-Source\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    String CLIENT_BUSINESS_SOURCE = <span class=\"string\">\"Client-Business-Source\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    String CLIENT_BUSINESS_ACTIVITY_SOURCE = <span class=\"string\">\"Client-Business-Activity-Source\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    String CLIENT_EVN_SOURCE = <span class=\"string\">\"Client-Env-Source\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    String CLIENT_PLATFORM_SOURCE = <span class=\"string\">\"Client-Platform-Source\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    String CLIENT_START_TIME = <span class=\"string\">\"Client-Start-Time\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    String CLIENT_VERSION_SOURCE = <span class=\"string\">\"Client-Version-Source\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> * 自定义restTemplate拦截器</span></span><br><span class=\"line\"><span class=\"comment\"> * 这里可以把一些参数从应用层传到内部服务</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"meta\">@ConditionalOnClass</span>(WebMvcConfigurer<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">public</span> <span class=\"title\">class</span> <span class=\"title\">MdcFeignInterceptorConfig</span> <span class=\"keyword\">implements</span> <span class=\"title\">RequestInterceptor</span>, <span class=\"title\">HttpApiConstant</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">MdcFeignInterceptorConfig</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">\"Loaded Z-REST-INTERCEPTOR [V1.0.0]\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">apply</span><span class=\"params\">(RequestTemplate template)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes())</span><br><span class=\"line\">                    .getRequest();</span><br><span class=\"line\">            String xRealIp = request.getHeader(X_REAL_IP);</span><br><span class=\"line\">            String authentication = request.getHeader(HTTP_TOKEN_HEADER);</span><br><span class=\"line\">            String appTraceId = request.getHeader(HTTP_HEADER_TRACE_ID);</span><br><span class=\"line\">            String businessGroupSource = request.getHeader(CLIENT_BUSINESS_GROUP_SOURCE);</span><br><span class=\"line\">            String clientBusinessSource = request.getHeader(CLIENT_BUSINESS_SOURCE);</span><br><span class=\"line\">            String clientBusinessActivitySource = request.getHeader(CLIENT_BUSINESS_ACTIVITY_SOURCE);</span><br><span class=\"line\">            String clientEnvSource = request.getHeader(CLIENT_EVN_SOURCE);</span><br><span class=\"line\">            String clientPlatformSource = request.getHeader(CLIENT_PLATFORM_SOURCE);</span><br><span class=\"line\">            String clientStartTime = request.getHeader(CLIENT_START_TIME);</span><br><span class=\"line\">            String clientVersionSource = request.getHeader(CLIENT_VERSION_SOURCE);</span><br><span class=\"line\">            template.header(HttpHeaders.ACCEPT_ENCODING, <span class=\"string\">\"gzip\"</span>);</span><br><span class=\"line\">            template.header(X_REAL_IP, xRealIp);</span><br><span class=\"line\">            template.header(HTTP_TOKEN_HEADER, authentication);</span><br><span class=\"line\">            template.header(CLIENT_BUSINESS_GROUP_SOURCE, businessGroupSource);</span><br><span class=\"line\">            template.header(CLIENT_BUSINESS_SOURCE, clientBusinessSource);</span><br><span class=\"line\">            template.header(CLIENT_BUSINESS_ACTIVITY_SOURCE, clientBusinessActivitySource);</span><br><span class=\"line\">            template.header(CLIENT_EVN_SOURCE, clientEnvSource);</span><br><span class=\"line\">            template.header(CLIENT_PLATFORM_SOURCE, clientPlatformSource);</span><br><span class=\"line\">            template.header(CLIENT_START_TIME, clientStartTime);</span><br><span class=\"line\">            template.header(CLIENT_VERSION_SOURCE, clientVersionSource);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (log.isDebugEnabled()) &#123;</span><br><span class=\"line\">                Enumeration&lt;String&gt; headerNames = request.getHeaderNames();</span><br><span class=\"line\">                <span class=\"keyword\">while</span> (headerNames.hasMoreElements()) &#123;</span><br><span class=\"line\">                    String name = headerNames.nextElement();</span><br><span class=\"line\">                    String value = request.getHeader(name);</span><br><span class=\"line\">                    log.debug(<span class=\"string\">\"header &#123;&#125; - &#123;&#125;\"</span>, name, value);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">\"template exception &#123;&#125;\"</span>,e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>简单的异常钉钉告警就到这里结束了。</p>\n","categories":["Spring"],"tags":["微服务","Java","钉钉","Spring"]},{"title":"Centos7-Openresty-Deploy","url":"/posts/225068205/","content":"<h2 id=\"OpenResty\"><a href=\"#OpenResty\" class=\"headerlink\" title=\"OpenResty\"></a>OpenResty</h2><blockquote>\n<p>OpenResty(又称：ngx_openresty) 是一个基于 NGINX 的可伸缩的 Web 平台，由中国人章亦春发起，提供了很多高质量的第三方模块。OpenResty 是一个强大的 Web 应用服务器</p>\n</blockquote>\n<h3 id=\"安装方法\"><a href=\"#安装方法\" class=\"headerlink\" title=\"安装方法\"></a>安装方法</h3><ul>\n<li>通过源安装</li>\n<li>编译安装</li>\n</ul>\n<h3 id=\"源安装\"><a href=\"#源安装\" class=\"headerlink\" title=\"源安装\"></a>源安装</h3><ul>\n<li>安装yum-utils</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install yum-utils</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>添加openresty源repo</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum-config-manager --add-repo https://openresty.org/package/rhel/openresty.repo</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>安装</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y openresty</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>启动</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl start openresty</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>效果</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211208162209.png\"></p>\n<ul>\n<li>安装openresty命令行工具</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y openresty-resty</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>检查当前安装的openresty</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">/usr/local/openresty/bin/openresty -V</span><br></pre></td></tr></table></figure>\n\n","categories":["Dev"],"tags":["Centos7","Linux","Openresty"]},{"title":"查缺补漏-Jvm","url":"/posts/1071592781/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h2 id=\"JVM\"><a href=\"#JVM\" class=\"headerlink\" title=\"JVM\"></a>JVM</h2><blockquote>\n<p>JVM 全称 Java Virtual Machine，也就是我们耳熟能详的 Java 虚拟机。JVM 会翻译执行 Java 字节码，然后调用真正的操作系统函数，这些操作系统函数是与平台息息相关的。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211124021707.png\"></p>\n<ul>\n<li>如上图所示，通过JVM，Java实现了跨平台、只要class文件能正常执行，就可以在其他系统上面运行。 JVM 与操作系统之间的关系：JVM 上承开发语言，下接操作系统，它的中间接口就是字节码。</li>\n</ul>\n<h3 id=\"JDK\"><a href=\"#JDK\" class=\"headerlink\" title=\"JDK\"></a>JDK</h3><ul>\n<li>JDK 的全拼，Java Development Kit JVM、JRE、JDK 它们三者之间的关系，可以用一个包含关系表示。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211124021902.png\"></p>\n<h2 id=\"JVM字节码\"><a href=\"#JVM字节码\" class=\"headerlink\" title=\"JVM字节码\"></a>JVM字节码</h2><blockquote>\n<p>对于 Java 开发者来说，虚拟机、字节码就是其底层知识。<code>Java Byte</code> 由单字节 <code>bute</code>的指令组成,理论上最多支持256个操作码。实际上只使用了200个左右操作码。</p>\n</blockquote>\n<h3 id=\"编译java文件\"><a href=\"#编译java文件\" class=\"headerlink\" title=\"编译java文件\"></a>编译java文件</h3><blockquote>\n<p>这里采用xxd xx.java </p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.jvm;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Testing</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Hello world!\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>通过javac编译成class文件、在用xxd查看编译后的16进制class文件。</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">➜  jvm git:(master) ✗ javac Testing.java </span><br><span class=\"line\">➜  jvm git:(master) ✗ xxd Testing.class </span><br><span class=\"line\">00000000: cafe babe 0000 0034 001d 0a00 0600 0f09  .......4........</span><br><span class=\"line\">00000010: 0010 0011 0800 120a 0013 0014 0700 1507  ................</span><br><span class=\"line\">00000020: 0016 0100 063c 696e 6974 3e01 0003 2829  .....&lt;init&gt;...()</span><br><span class=\"line\">00000030: 5601 0004 436f 6465 0100 0f4c 696e 654e  V...Code...LineN</span><br><span class=\"line\">00000040: 756d 6265 7254 6162 6c65 0100 046d 6169  umberTable...mai</span><br><span class=\"line\">00000050: 6e01 0016 285b 4c6a 6176 612f 6c61 6e67  n...([Ljava/lang</span><br><span class=\"line\">00000060: 2f53 7472 696e 673b 2956 0100 0a53 6f75  /String;)V...Sou</span><br><span class=\"line\">00000070: 7263 6546 696c 6501 000c 5465 7374 696e  rceFile...Testin</span><br><span class=\"line\">00000080: 672e 6a61 7661 0c00 0700 0807 0017 0c00  g.java..........</span><br><span class=\"line\">00000090: 1800 1901 000c 4865 6c6c 6f20 776f 726c  ......Hello worl</span><br><span class=\"line\">000000a0: 6421 0700 1a0c 001b 001c 0100 1363 6e2f  d!...........cn/</span><br><span class=\"line\">000000b0: 7a32 3031 2f6a 766d 2f54 6573 7469 6e67  z201/jvm/Testing</span><br><span class=\"line\">000000c0: 0100 106a 6176 612f 6c61 6e67 2f4f 626a  ...java/lang/Obj</span><br><span class=\"line\">000000d0: 6563 7401 0010 6a61 7661 2f6c 616e 672f  ect...java/lang/</span><br><span class=\"line\">000000e0: 5379 7374 656d 0100 036f 7574 0100 154c  System...out...L</span><br><span class=\"line\">000000f0: 6a61 7661 2f69 6f2f 5072 696e 7453 7472  java/io/PrintStr</span><br><span class=\"line\">00000100: 6561 6d3b 0100 136a 6176 612f 696f 2f50  eam;...java/io/P</span><br><span class=\"line\">00000110: 7269 6e74 5374 7265 616d 0100 0770 7269  rintStream...pri</span><br><span class=\"line\">00000120: 6e74 6c6e 0100 1528 4c6a 6176 612f 6c61  ntln...(Ljava/la</span><br><span class=\"line\">00000130: 6e67 2f53 7472 696e 673b 2956 0021 0005  ng/String;)V.!..</span><br><span class=\"line\">00000140: 0006 0000 0000 0002 0001 0007 0008 0001  ................</span><br><span class=\"line\">00000150: 0009 0000 001d 0001 0001 0000 0005 2ab7  ..............*.</span><br><span class=\"line\">00000160: 0001 b100 0000 0100 0a00 0000 0600 0100  ................</span><br><span class=\"line\">00000170: 0000 0500 0900 0b00 0c00 0100 0900 0000  ................</span><br><span class=\"line\">00000180: 2500 0200 0100 0000 09b2 0002 1203 b600  %...............</span><br><span class=\"line\">00000190: 04b1 0000 0001 000a 0000 000a 0002 0000  ................</span><br><span class=\"line\">000001a0: 0008 0008 0009 0001 000d 0000 0002 000e  ................</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>编译后完全看不懂，jdk实际上提供了专门用来解析类文件的工具<code>javap</code></li>\n</ul>\n<h3 id=\"javap\"><a href=\"#javap\" class=\"headerlink\" title=\"javap\"></a>javap</h3><blockquote>\n<p>javap能对给定的class文件提供的字节代码进行反编译</p>\n</blockquote>\n<ul>\n<li>使用格式</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">javap &lt;options&gt; &lt;classes&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">  -help  --help  -?        输出此用法消息</span><br><span class=\"line\">  -version                 版本信息</span><br><span class=\"line\">  -v  -verbose             输出附加信息</span><br><span class=\"line\">  -l                       输出行号和本地变量表</span><br><span class=\"line\">  -public                  仅显示公共类和成员</span><br><span class=\"line\">  -protected               显示受保护的/公共类和成员</span><br><span class=\"line\">  -package                 显示程序包/受保护的/公共类</span><br><span class=\"line\">                           和成员 (默认)</span><br><span class=\"line\">  -p  -private             显示所有类和成员</span><br><span class=\"line\">  -c                       对代码进行反汇编</span><br><span class=\"line\">  -s                       输出内部类型签名</span><br><span class=\"line\">  -sysinfo                 显示正在处理的类的</span><br><span class=\"line\">                           系统信息 (路径, 大小, 日期, MD5 散列)</span><br><span class=\"line\">  -constants               显示最终常量</span><br><span class=\"line\">  -classpath &lt;path&gt;        指定查找用户类文件的位置</span><br><span class=\"line\">  -cp &lt;path&gt;               指定查找用户类文件的位置</span><br><span class=\"line\">  -bootclasspath &lt;path&gt;    覆盖引导类文件的位置</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>演示下上面的类</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">javap -c -s -v Testing</span><br><span class=\"line\"></span><br><span class=\"line\">Classfile /Users/z201/word/z201.github.io.code/java-learning/learn-jvm/src/test/java/cn/z201/jvm/Testing<span class=\"class\">.<span class=\"keyword\">class</span></span></span><br><span class=\"line\"><span class=\"class\">  <span class=\"title\">Last</span> <span class=\"title\">modified</span> 2020-03-01</span>; size <span class=\"number\">432</span> bytes</span><br><span class=\"line\">  MD5 checksum b50deb6f6e7df9bb99585bc71b92d39b</span><br><span class=\"line\">  Compiled from <span class=\"string\">\"Testing.java\"</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">cn</span>.<span class=\"title\">z201</span>.<span class=\"title\">jvm</span>.<span class=\"title\">Testing</span></span></span><br><span class=\"line\">  minor version: 0</span><br><span class=\"line\">  major version: <span class=\"number\">52</span></span><br><span class=\"line\">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class=\"line\">Constant pool:</span><br><span class=\"line\">   #1 = Methodref          #6.#15         // java/lang/Object.\"&lt;init&gt;\":()V</span><br><span class=\"line\">   #2 = Fieldref           #16.#17        // java/lang/System.out:Ljava/io/PrintStream;</span><br><span class=\"line\">   #3 = String             #18            // Hello world!</span><br><span class=\"line\">   #4 = Methodref          #19.#20        // java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class=\"line\">   #5 = Class              #21            // cn/z201/jvm/Testing</span><br><span class=\"line\">   #6 = Class              #22            // java/lang/Object</span><br><span class=\"line\">   #7 = Utf8               &lt;init&gt;</span><br><span class=\"line\">   #8 = Utf8               ()V</span><br><span class=\"line\">   #9 = Utf8               Code</span><br><span class=\"line\">  #10 = Utf8               LineNumberTable</span><br><span class=\"line\">  #11 = Utf8               main</span><br><span class=\"line\">  #12 = Utf8               ([Ljava/lang/String;)V</span><br><span class=\"line\">  #13 = Utf8               SourceFile</span><br><span class=\"line\">  #14 = Utf8               Testing.java</span><br><span class=\"line\">  #15 = NameAndType        #7:#8          // \"&lt;init&gt;\":()V</span><br><span class=\"line\">  #16 = Class              #23            // java/lang/System</span><br><span class=\"line\">  #17 = NameAndType        #24:#25        // out:Ljava/io/PrintStream;</span><br><span class=\"line\">  #18 = Utf8               Hello world!</span><br><span class=\"line\">  #19 = Class              #26            // java/io/PrintStream</span><br><span class=\"line\">  #20 = NameAndType        #27:#28        // println:(Ljava/lang/String;)V</span><br><span class=\"line\">  #21 = Utf8               cn/z201/jvm/Testing</span><br><span class=\"line\">  #22 = Utf8               java/lang/Object</span><br><span class=\"line\">  #23 = Utf8               java/lang/System</span><br><span class=\"line\">  #24 = Utf8               out</span><br><span class=\"line\">  #25 = Utf8               Ljava/io/PrintStream;</span><br><span class=\"line\">  #26 = Utf8               java/io/PrintStream</span><br><span class=\"line\">  #27 = Utf8               println</span><br><span class=\"line\">  #28 = Utf8               (Ljava/lang/String;)V</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> cn.z201.jvm.Testing();</span><br><span class=\"line\">    descriptor: ()V</span><br><span class=\"line\">    flags: ACC_PUBLIC</span><br><span class=\"line\">    Code:</span><br><span class=\"line\">      stack=<span class=\"number\">1</span>, locals=<span class=\"number\">1</span>, args_size=<span class=\"number\">1</span></span><br><span class=\"line\">         <span class=\"number\">0</span>: aload_0</span><br><span class=\"line\">         1: invokespecial #1                  // Method java/lang/Object.\"&lt;init&gt;\":()V</span><br><span class=\"line\">         <span class=\"number\">4</span>: <span class=\"keyword\">return</span></span><br><span class=\"line\">      LineNumberTable:</span><br><span class=\"line\">        line <span class=\"number\">5</span>: <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(java.lang.String[])</span></span>;</span><br><span class=\"line\">    descriptor: ([Ljava/lang/String;)V</span><br><span class=\"line\">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class=\"line\">    Code:</span><br><span class=\"line\">      stack=<span class=\"number\">2</span>, locals=<span class=\"number\">1</span>, args_size=<span class=\"number\">1</span></span><br><span class=\"line\">         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class=\"line\">         3: ldc           #3                  // String Hello world!</span><br><span class=\"line\">         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class=\"line\">         <span class=\"number\">8</span>: <span class=\"keyword\">return</span></span><br><span class=\"line\">      LineNumberTable:</span><br><span class=\"line\">        line <span class=\"number\">8</span>: <span class=\"number\">0</span></span><br><span class=\"line\">        line <span class=\"number\">9</span>: <span class=\"number\">8</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">SourceFile: <span class=\"string\">\"Testing.java\"</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"IDEA-bytecode-viewer\"><a href=\"#IDEA-bytecode-viewer\" class=\"headerlink\" title=\"IDEA bytecode viewer\"></a>IDEA bytecode viewer</h3><blockquote>\n<p>jclasslib is a bytecode viewer for Java class files</p>\n</blockquote>\n<ul>\n<li>在plugins中搜索jclasslib bytecode viewer</li>\n<li>安装重启IDEA后，编译项目代码(run 一次)选中代码文件 view 菜单中有 bytecode viewer 选项。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211124135425.png\"></p>\n<ul>\n<li>IDEA 显示的内容更加容易阅读。</li>\n</ul>\n<h2 id=\"JVM的内存布局\"><a href=\"#JVM的内存布局\" class=\"headerlink\" title=\"JVM的内存布局\"></a>JVM的内存布局</h2><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/JVM%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80.png\"></p>\n<h3 id=\"堆\"><a href=\"#堆\" class=\"headerlink\" title=\"堆\"></a>堆</h3><ul>\n<li><p>堆（Java Heap） 也叫 Java 堆或者是 GC 堆，它是一个线程共享的内存区域，也是 JVM 中占用内存最大的一块区域，Java 中所有的对象都存储在这里。</p>\n<ul>\n<li><p>存储的是我们<strong>new</strong>来的对象，不存放基本类型和对象引用。</p>\n</li>\n<li><p>由于创建了大量的对象，垃圾回收器主要工作在这块区域。</p>\n</li>\n<li><p>线程共享区域，因此是线程不安全的。</p>\n</li>\n<li><p>能够发生内存溢出，主要有OutOfMemoryError和StackOverflowError。</p>\n</li>\n<li><p>那么什么时候发生OutOfMemoryError，什么时候发生StackOverflowError？虚拟机在扩展栈时无法申请到足够的内存空间，<strong>将抛出OutOfMemoryError异常</strong>，线程请求的栈深度超过虚拟机所允许的最大深度，<strong>将抛出StackOverflowError异常</strong>。</p>\n</li>\n<li><p>Java堆区还可以划分为<strong>新生代和老年代</strong>，新生代又可以进一步划分为<strong>Eden区、Survivor 1区、Survivor 2区</strong>。具体比例参数的话，可以看一下下面这张图。</p>\n</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Java%E5%A0%86%E7%9A%84%E5%88%92%E5%88%86.png\"></p>\n<ul>\n<li>合理设置老年代和新生代的空间比例对 JVM 垃圾回收的性能有很大影响，JVM 设置老年代新生代比例的参数是 -XX:NewRatio。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"新生代\"><a href=\"#新生代\" class=\"headerlink\" title=\"新生代\"></a>新生代</h4><ul>\n<li>新生代是类的诞生、成长、消亡的区域，一个类在这里产生、应用，最后被垃圾回收器收集，结束生命。新生区又分为两部分：伊甸区（Eden space）和幸存区（Survivor pace），绝大多数的类都是在伊甸区被 new 出来的。幸存区有两个：0区（from Survivor 0 space）和 1区（to Survivor 1 space）。两个Survivor 区空间一样大，当Eden 区满了，则会触发普通GC，若 Eden 区中的对象经过垃圾回收没有被回收掉，会将Eden 区中的幸存对象移动到幸存0区。若幸存0区也满了，再对该区域进行垃圾回收，然后移动到1区，然后之前的0区将置为空，没有任何数据。显然，Survivor 区只是增加了对象在年轻代中逗留的时间，增加了被垃圾回收的可能性。那如果1区也满了呢？再移动到养老区。若养老区也满了，那么这时候将产生Full GC，进行养老区的内存清理。若养老区执行Full GC 之后发现依然无法进行对象的保存，就会产生 OOM 异常“OutOfMemoryError”。</li>\n<li>每次垃圾回收时都有大量的对象需要被回收。垃圾回收器在新生代采用的收集算法是Copying(复制)方法：它将可用内存按容量划分为大小相等的两块，每次只使用其中的一块。当这一块面对内存用完了，就将还存活的对象复制到另外一块，然后再把已使用的内存空间一次清理掉。由于新生代有每次垃圾回收时都有大量的对象需要被回收的特点，所以采用Copying算法，复制的存活对象较少，性能比较好。但是Copying算法还是有缺陷的，那就是内存的使用率只有一半。</li>\n</ul>\n<h4 id=\"OutOfMemoryError\"><a href=\"#OutOfMemoryError\" class=\"headerlink\" title=\"OutOfMemoryError\"></a>OutOfMemoryError</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">java.lang.OutOfMemoryError: Java heap space</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>Java 虚拟机的堆内存设置不够，可以通过-Xms、-Xmx来调整</li>\n<li>代码中创建了大量大对象，并且长时间不能被垃圾回收器收集</li>\n<li>内存加载的数据量太大：一次性从数据库取太多数据</li>\n<li>集合类中有对对象的引用，使用后未清空，GC不能进行回收</li>\n<li>代码中存在循环产生过多的重复对象</li>\n</ol>\n<h3 id=\"老年代\"><a href=\"#老年代\" class=\"headerlink\" title=\"老年代\"></a>老年代</h3><ul>\n<li>年轻代中经过垃圾回收没有回收掉的对象将被Copy到年老代。</li>\n<li>每次垃圾回收时只有少量的对象需要被回收。垃圾回收器在老年代采用的收集算法是 Mark-Compac t算法：为了解决Copying算法的缺陷，充分利用内存空间，提出了Mark-Compact算法。它先将需要回收的对象进行标记，然后将存活对象都向一端移动，然后清理掉端边界以外的内存。</li>\n</ul>\n<h4 id=\"FULL-GC\"><a href=\"#FULL-GC\" class=\"headerlink\" title=\"FULL GC\"></a>FULL GC</h4><ul>\n<li>当老年代空间满了，就会对新生代和老年代空间进行一次全量垃圾回收，即Full GC。</li>\n</ul>\n<h3 id=\"方法区\"><a href=\"#方法区\" class=\"headerlink\" title=\"方法区\"></a>方法区</h3><ul>\n<li>方法区（Method Area） 也被称为非堆区，用于和“Java 堆”的概念进行区分，它也是线程共享的内存区域，用于存储已经被 JVM 加载的类型信息、常量、静态变量、代码缓存等数据。    </li>\n</ul>\n<h4 id=\"运行时常量池\"><a href=\"#运行时常量池\" class=\"headerlink\" title=\"运行时常量池\"></a>运行时常量池</h4><ul>\n<li>Run-Time Constant Pool这是方法区的一部分，版本号、字段、方法、超类、接口等各种信息，还有一项信息就是常量池。Java 的常量池可以存放各种常量信息，不管是编译期生成的各种字面量，还是需要在运行时决定的符号引用。</li>\n</ul>\n<h3 id=\"程序计数器\"><a href=\"#程序计数器\" class=\"headerlink\" title=\"程序计数器\"></a>程序计数器</h3><ul>\n<li>程序计数器（Program Counter Register） 线程独有一块很小的内存区域，保存当前线程所执行字节码的位置，包括正在执行的指令、跳转、分支、循环、异常处理等。</li>\n</ul>\n<h3 id=\"虚拟机栈\"><a href=\"#虚拟机栈\" class=\"headerlink\" title=\"虚拟机栈\"></a>虚拟机栈</h3><ul>\n<li><p>虚拟机栈也叫 Java 虚拟机栈（Java Virtual Machine Stack），和程序计数器相同它也是线程独享的，用来描述 Java 方法的执行，在每个方法被执行时就会同步创建一个栈帧，用来存储局部变量表、操作栈、动态链接、方法出口等信息。当调用方法时执行入栈，而方法返回时执行出栈。</p>\n<ul>\n<li><p><strong>线程私有区域，每一个线程都有独享一个虚拟机栈，因此这是线程安全的区域。</strong></p>\n</li>\n<li><p>存放基本数据类型以及对象的引用。</p>\n</li>\n<li><p>每一个方法执行的时候会在虚拟机栈中创建一个相应栈帧，方法执行完毕后该栈帧就会被销毁。<strong>方法栈帧是以先进后出的方式虚拟机栈的。</strong></p>\n</li>\n<li><p>每一个栈帧又可以划分为<strong>局部变量表、操作数栈、动态链接、方法出口</strong>以及额外的附加信息。</p>\n<ul>\n<li>这个区域可能有两种异常：如果线程请求的栈深度大于虚拟机所允许的深度，将抛出StackOverflowError异常（通常是递归导致的）；JVM动态扩展时无法申请到足够内存则抛出OutOfMemoryError异常。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"本地方法栈\"><a href=\"#本地方法栈\" class=\"headerlink\" title=\"本地方法栈\"></a>本地方法栈</h3><ul>\n<li><p>本地方法栈（Native Method Stacks）与虚拟机栈类似，它是线程独享的，并且作用也和虚拟机栈类似。只不过虚拟机栈是为虚拟机中执行的 Java 方法服务的，而本地方法栈则是为虚拟机使用到的本地（Native）方法服务。</p>\n</li>\n<li><p>JVM 的执行流程是，首先先把 Java 代码（.java）转化成字节码（.class），然后通过类加载器将字节码加载到内存中，所谓的内存也就是我们上面介绍的运行时数据区，但字节码并不是可以直接交给操作系统执行的机器码，而是一套 JVM 的指令集。这个时候需要使用特定的命令解析器也就是我们俗称的<strong>执行引擎（Execution Engine）</strong>将字节码翻译成可以被底层操作系统执行的指令再去执行，这样就实现了整个 Java 程序的运行，这也是 JVM 的整体执行流程。</p>\n</li>\n</ul>\n<h3 id=\"类的加载机制\"><a href=\"#类的加载机制\" class=\"headerlink\" title=\"类的加载机制\"></a>类的加载机制</h3><blockquote>\n<p>符号引用和直接引用有一个重要的区别：使用符号引用时被引用的目标不一定已经加载到内存中；而使用直接引用时，引用的目标必定已经存在虚拟机的内存中了。</p>\n</blockquote>\n<ul>\n<li>类的生命周期会经历以下 7 个阶段：</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/ClassLoading.png\"></p>\n<ol>\n<li>加载阶段（Loading）</li>\n<li>验证阶段（Verification）</li>\n<li>准备阶段（Preparation）</li>\n<li>解析阶段（Resolution）</li>\n<li>初始化阶段（Initialization）</li>\n<li>使用阶段（Using）</li>\n<li>卸载阶段（Unloading）</li>\n</ol>\n<h4 id=\"加载阶段\"><a href=\"#加载阶段\" class=\"headerlink\" title=\"加载阶段\"></a>加载阶段</h4><blockquote>\n<p>此阶段用于查到相应的类（通过类名进行查找）并将此类的字节流转换为方法区运行时的数据结构，然后再在内存中生成一个能代表此类的 java.lang.Class 对象，作为其他数据访问的入口。</p>\n</blockquote>\n<ul>\n<li>Java语言的类型可以分为两大类：<strong>基本类型、引用类型</strong>。基本类型是由虚拟机预先定义好的，所以不会经历单独的类加载过程。而引用类型又分为四种：<strong>类、接口、数组类、泛型参数</strong>。由于泛型参数会在编译的过程中被擦除（关于类型擦除的知识，大家可以查下资料），所以在Java中只有类、接口、数组类三种类型需要经历JVM对其进行连接和初始化的过程。</li>\n</ul>\n<h4 id=\"验证阶段\"><a href=\"#验证阶段\" class=\"headerlink\" title=\"验证阶段\"></a>验证阶段</h4><blockquote>\n<p>此步骤主要是为了验证字节码的安全性，如果不做安全校验的话可能会载入非安全或有错误的字节码，从而导致系统崩溃，它是 JVM 自我保护的一项重要举措。</p>\n</blockquote>\n<ul>\n<li>验证的主要动作大概有以下几个：<ul>\n<li>文件格式校验包括常量池中的常量类型、Class 文件的各个部分是否被删除或被追加了其他信息等；</li>\n<li>元数据校验包括父类正确性校验（检查父类是否有被 final 修饰）、抽象类校验等；</li>\n<li>字节码校验，此步骤最为关键和复杂，主要用于校验程序中的语义是否合法且符合逻辑；</li>\n<li>符号引用校验，对类自身以外比如常量池中的各种符号引用的信息进行匹配性校验。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"准备阶段\"><a href=\"#准备阶段\" class=\"headerlink\" title=\"准备阶段\"></a>准备阶段</h4><p>此阶段是用来初始化并为类中定义的静态变量分配内存的，这些静态变量会被分配到方法区上。这些变量所使用的内存都将在方法区（&lt;Jdk1.8）元数据区（&gt;=Jdk1.8）中进行分配。这时候进行内存分配的仅包括类变量，而不包括实例变量，实例变量将会在对象实例化的时候随对象一起分配在Java堆中。</p>\n<h4 id=\"解析阶段\"><a href=\"#解析阶段\" class=\"headerlink\" title=\"解析阶段\"></a>解析阶段</h4><blockquote>\n<p>此阶段主要是用来解析类、接口、字段及方法的，解析时会把符号引用替换成直接引用。</p>\n</blockquote>\n<ul>\n<li><p>所谓的符号引用是指以一组符号来描述所引用的目标，符号可以是任何形式的字面量，只要使用时能无歧义地定位到目标即可；而直接引用是可以直接指向目标的指针、相对偏移量或者是一个能间接定位到目标的句柄。</p>\n</li>\n<li><p>符号引用和直接引用有一个重要的区别：使用符号引用时被引用的目标不一定已经加载到内存中；而使用直接引用时，引用的目标必定已经存在虚拟机的内存中了。</p>\n</li>\n</ul>\n<h4 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h4><blockquote>\n<p>初始化阶段 JVM 就正式开始执行类中编写的 Java 业务代码了。到这一步骤之后，类的加载过程就算正式完成了。</p>\n</blockquote>\n<ul>\n<li>JVM 规范枚举了下述多种触发情况：<ul>\n<li>当虚拟机启动时，初始化用户指定的主类；<ul>\n<li>当遇到用以新建目标类实例的 new 指令时，初始化 new 指令的目标类;</li>\n<li>当遇到调用静态方法的指令时，初始化该静态方法所在的类;</li>\n<li>当遇到访问静态字段的指令时，初始化该静态字段所在的类；子类的初始化会触发父类的初始化;</li>\n<li>如果一个接口定义了 default 方法，那么直接实现或者间接实现该接口的类的初始化，会触发该接口的初始化;</li>\n<li>使用反射 API 对某个类进行反射调用时，初始化这个类；</li>\n<li>当初次调用 MethodHandle 实例时，初始化该 MethodHandle 指向的方法所在的类。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"Jvm垃圾回收\"><a href=\"#Jvm垃圾回收\" class=\"headerlink\" title=\"Jvm垃圾回收\"></a>Jvm垃圾回收</h3><ul>\n<li>JVM可以自动管理内存，拥有自动垃圾回收机制，主要是对堆中的对象进行清理。</li>\n</ul>\n<h4 id=\"可达性分析算法\"><a href=\"#可达性分析算法\" class=\"headerlink\" title=\"可达性分析算法\"></a>可达性分析算法</h4><blockquote>\n<p>从线程栈帧中局部变量或者方法区的静态变量引用的对象进行标记，然后判断被标记的对象是否引用了其他对象，通过持续标记。找出未被标记的对象，这些对象就是可以被回收的垃圾对象。</p>\n</blockquote>\n<h4 id=\"回收方式\"><a href=\"#回收方式\" class=\"headerlink\" title=\"回收方式\"></a>回收方式</h4><h5 id=\"清理\"><a href=\"#清理\" class=\"headerlink\" title=\"清理\"></a>清理</h5><ul>\n<li>将垃圾对象占用用的空间标记成空闲，记录在一个空闲列队中，当需要分配新对象的时候，就从空间列队中找到合适的空间分配给这个对象。但是垃圾对象是散落在内存空间各处，并不是连续存放的。当需要分配一段连续大的内存空间的时候，可能出现没有足够空闲空间的问题。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211023224631.png\"></p>\n<h5 id=\"压缩\"><a href=\"#压缩\" class=\"headerlink\" title=\"压缩\"></a>压缩</h5><ul>\n<li>从堆空间的头部开始，将存活的对象拷贝在一段连续的内存空间中，剩余的空间就是连续的空闲空间。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211023224648.png\"></p>\n<h5 id=\"复制\"><a href=\"#复制\" class=\"headerlink\" title=\"复制\"></a>复制</h5><ul>\n<li>将堆空间拆分成2空间from、to，其中一部分创建对象，当from空间对象使用完成后，将标记过的对象复制到to空间中，当对象从from复制到to空间后，两个空间交换引用，继续在from空间创建对象，一直到from空间满了。这里的空闲是指标记空闲。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211023224706.png\"></p>\n<h4 id=\"垃圾回收器\"><a href=\"#垃圾回收器\" class=\"headerlink\" title=\"垃圾回收器\"></a>垃圾回收器</h4><blockquote>\n<p>具体执行垃圾回收的回收器有四种,</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211124020112.png\"></p>\n<h5 id=\"Serial\"><a href=\"#Serial\" class=\"headerlink\" title=\"Serial\"></a>Serial</h5><ul>\n<li>早期的垃圾回收器，只有一个执行垃圾回收。</li>\n</ul>\n<h5 id=\"Parallel\"><a href=\"#Parallel\" class=\"headerlink\" title=\"Parallel\"></a>Parallel</h5><ul>\n<li>多个线程执行垃圾回收，适合在多核cpu上面，在串行或者并行垃圾回收过程中，需要停止用户程序线程，或者可能导致对象标记错乱。对用户程序影响较大，程序都停止了。</li>\n</ul>\n<h5 id=\"CMS\"><a href=\"#CMS\" class=\"headerlink\" title=\"CMS\"></a>CMS</h5><ul>\n<li>在垃圾回收的阶段，垃圾回收器和用户线程可以并发执行，对程序线程影响较小。</li>\n</ul>\n<h5 id=\"G1\"><a href=\"#G1\" class=\"headerlink\" title=\"G1\"></a>G1</h5><ul>\n<li>将堆拆分成多个子区域，每个区域独自进行垃圾回收。整个过程垃圾回收线程和用户程序线程并行。效率较高适合多种场景。</li>\n</ul>\n<h3 id=\"类加载器\"><a href=\"#类加载器\" class=\"headerlink\" title=\"类加载器\"></a>类加载器</h3><blockquote>\n<p>虚拟机设计团队把加载动作放到 JVM 外部实现，以便让应用程序决定如何获取所需的类，JVM 提供了 3 种类加载器：</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211020020028.png\"></p>\n<ul>\n<li><p>BootstrapClassloader  启动（根）类加载器</p>\n<ul>\n<li>它不是java类，该类加载器由C++实现，它嵌套在JVM内核里，当JVM启动时该类加载器就启动了。负责加载Java基础类，对应加载的文件是JRE/lib/ 目录下的rt.jar、resources.jar、charsets.jar等。</li>\n</ul>\n</li>\n<li><p>ExtensionClassLoader 扩展类加载器</p>\n<ul>\n<li>加载JRE/lib/ext下面指定要用的jar包，继承URLClassLoader。</li>\n</ul>\n</li>\n<li><p>AppClassLoader 应用程序类加载器</p>\n<ul>\n<li>加载应用程序classpath目录下的所指定的类库，继承URLClassLoader。</li>\n</ul>\n</li>\n<li><p>自上而下尝试加载，最下面的加载器没有加载到的话，则抛出ClassNotFoundException。</p>\n<ul>\n<li>如果一个类加载器收到了类加载请求，它并不会自己先去加载，而是把这个请求委托给父类的加载器去执行；</li>\n<li>如果父类加载器还存在其父类加载器，则进一步向上委托，依次递归,请求最终将到达项层的启动类加载器；</li>\n<li>如果父类加载器可以完成类加载任务，就成功返回，倘若父类加载器无法完成此加载任务，子加载器才会尝试自己去加载，</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"双亲委派机制\"><a href=\"#双亲委派机制\" class=\"headerlink\" title=\"双亲委派机制\"></a>双亲委派机制</h4><ul>\n<li>这种工作原理就是双亲委派机制。Java类随着加载它的类加载器一起具备了一种带有优先级的层次关系。比如，Java中的Object类，它存放在rt.jar之中,无论哪一个类加载器要加载这个类，最终都是委派给处于模型最顶端的启动类加载器进行加载，因此Object在各种类加载环境中都是同一个类。如果不采用双亲委派模型，那么由各个类加载器自己去加载的话，那么系统中会存在多种不同的Object类。<ul>\n<li>避免核心API被篡改。</li>\n<li>避免类的重复加载。</li>\n</ul>\n</li>\n<li>子类加载器可以访问父加载器的类型，但是反过来不行。由于父加载器的类型对于子加载器是可见的，所以父加载器中加载的类型不会再子加载器中加载。</li>\n</ul>\n<h4 id=\"负责依赖\"><a href=\"#负责依赖\" class=\"headerlink\" title=\"负责依赖\"></a>负责依赖</h4><ul>\n<li>如果一个加载器在加载某个类的时候，发现这个类依赖于另外几个类或接口，也会去尝试加载这些依赖项。</li>\n</ul>\n<h4 id=\"缓存加载\"><a href=\"#缓存加载\" class=\"headerlink\" title=\"缓存加载\"></a>缓存加载</h4><ul>\n<li>为了提升加载效率，消除重复加载，一旦某个类被一个类加载器加载，那么它会缓存这个加载结果，不会重复加载。</li>\n</ul>\n<h3 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h3><h4 id=\"你将如何使用thread-dump？你将如何分析Thread-dump？\"><a href=\"#你将如何使用thread-dump？你将如何分析Thread-dump？\" class=\"headerlink\" title=\"你将如何使用thread dump？你将如何分析Thread dump？\"></a>你将如何使用thread dump？你将如何分析Thread dump？</h4><ul>\n<li>线程转储是一个JVM活动线程的列表，它对于分析系统瓶颈和死锁非常有用。有很多方法可以获取线程转储——使用Profiler，Kill -3命令，jstack工具等等。我更喜欢jstack工具，因为它容易使用并且是JDK自带的。由于它是一个基于终端的工具，所以我们可以编写一些脚本去定时的产生线程转储以待分析。</li>\n</ul>\n<h4 id=\"Java中堆和栈有什么不同\"><a href=\"#Java中堆和栈有什么不同\" class=\"headerlink\" title=\"Java中堆和栈有什么不同?\"></a><strong>Java</strong>中堆和栈有什么不同?</h4><ul>\n<li>栈是⼀块和线程紧密相关的内存区域,每个线程都有⾃⼰的栈内存，⽤于存储本地变量，⽅法参数和栈调⽤，⼀个线程中存储的变量对其它线程是不可⻅的。</li>\n<li>堆是所有线程共享的⼀⽚公⽤内存区域,对象都在堆⾥创建，为了提升效率线程会从堆中弄⼀个缓存到⾃⼰的栈，如果多个线程使⽤该变量就可能引发问题，这时volatile 变量就可以发挥作⽤了，它要求线程从主存中读取变量的值。</li>\n</ul>\n<h4 id=\"内存泄漏和内存溢出\"><a href=\"#内存泄漏和内存溢出\" class=\"headerlink\" title=\"内存泄漏和内存溢出\"></a>内存泄漏和内存溢出</h4><ul>\n<li>内存溢出是说程序需要申请的内存超过了JVM当前可以分配的最大内存，溢出。</li>\n<li>内存泄漏是说期望被回收的内存对象没有被回收，泄漏。</li>\n<li>内存泄漏持续发生，很可能引起内存溢出。</li>\n</ul>\n","categories":["查缺补漏"],"tags":["Java","Jvm"]},{"title":"Git-Merge-Commit","url":"/posts/2939564960/","content":"<blockquote>\n<p>工作中可能出现一个bug修复多次调教或者开发过程中需要临时保存代码到分支上的操作。但是合并主分支的时候不希望把过多的提交记录信息展示出来。这里就需要用到git rebase 命名。</p>\n</blockquote>\n<h2 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h2><blockquote>\n<p>使用git rebase 合并多条commit</p>\n</blockquote>\n<ol>\n<li>查看git log 选择要合并的记录</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">log</span> --oneline</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211220220324.png\"></p>\n<p>2.选中一个commit id作为合并到对象，从上至下按照最新提交的记录排序。这里可以选中第三条记录。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git rebase -i 7893ade</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211220220518.png\"></p>\n<ul>\n<li>这里会显示可以合并的记录还有git的命令帮助信息</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 命令:</span></span><br><span class=\"line\"><span class=\"comment\"># p, pick &lt;提交&gt; = 使用提交</span></span><br><span class=\"line\"><span class=\"comment\"># r, reword &lt;提交&gt; = 使用提交，但修改提交说明</span></span><br><span class=\"line\"><span class=\"comment\"># e, edit &lt;提交&gt; = 使用提交，进入 shell 以便进行提交修补</span></span><br><span class=\"line\"><span class=\"comment\"># s, squash &lt;提交&gt; = 使用提交，但融合到前一个提交</span></span><br><span class=\"line\"><span class=\"comment\"># f, fixup &lt;提交&gt; = 类似于 \"squash\"，但丢弃提交说明日志</span></span><br><span class=\"line\"><span class=\"comment\"># x, exec &lt;命令&gt; = 使用 shell 运行命令（此行剩余部分）</span></span><br><span class=\"line\"><span class=\"comment\"># b, break = 在此处停止（使用 'git rebase --continue' 继续变基）</span></span><br><span class=\"line\"><span class=\"comment\"># d, drop &lt;提交&gt; = 删除提交</span></span><br><span class=\"line\"><span class=\"comment\"># l, label &lt;label&gt; = 为当前 HEAD 打上标记</span></span><br><span class=\"line\"><span class=\"comment\"># t, reset &lt;label&gt; = 重置 HEAD 到该标记</span></span><br><span class=\"line\"><span class=\"comment\"># m, merge [-C &lt;commit&gt; | -c &lt;commit&gt;] &lt;label&gt; [# &lt;oneline&gt;]</span></span><br><span class=\"line\"><span class=\"comment\"># .       创建一个合并提交，并使用原始的合并提交说明（如果没有指定</span></span><br><span class=\"line\"><span class=\"comment\"># .       原始提交，使用注释部分的 oneline 作为提交说明）。使用</span></span><br><span class=\"line\"><span class=\"comment\"># .       -c &lt;提交&gt; 可以编辑提交说明。</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># 可以对这些行重新排序，将从上至下执行。</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># 如果您在这里删除一行，对应的提交将会丢失。</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># 然而，如果您删除全部内容，变基操作将会终止。</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>这里将要合并的commit 前缀pick 改成 s 或者 squash 就可以开始合并了。这里使用vim <code>:wq</code>保存</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">pick a755a10 完善单元测试</span><br><span class=\"line\">s d3f1272 完善代码</span><br><span class=\"line\">s 547947e</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>正常情况下，不回创建临时空间。直接将代码推送到需要存储分支就可以了。这里不直接推送主分支，建议合并过去。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git push -f origin branch</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>不正常的情况，一般是合并冲突，只需要将合并解决掉， 在将合并的文件添加暂存区，在使用git rebase –continue。或者直接放弃git rebase –abort 或者直接切换到其他分支，然后删除刚才操作的文件退回<code>rm -rf .git/rebase-merge</code></li>\n<li>检查<code>git log --oneline</code></li>\n</ul>\n","categories":["Git"],"tags":["Rebase"]},{"title":"Redis-cli使用","url":"/posts/3808068988/","content":"<blockquote>\n<p>在mac中使用redis-cli。相比rdm我可能更喜欢这个命令行工具。</p>\n</blockquote>\n<h3 id=\"在mac中之安装redis-cli\"><a href=\"#在mac中之安装redis-cli\" class=\"headerlink\" title=\"在mac中之安装redis-cli\"></a>在mac中之安装redis-cli</h3><blockquote>\n<p>按照标准的按照流程，需要先安装redis-server。</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">brew tap ringohub/redis-cli</span><br><span class=\"line\"></span><br><span class=\"line\">brew update &amp;&amp; brew doctor</span><br><span class=\"line\"></span><br><span class=\"line\">brew install redis-cli</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>相关文档<a href=\"https://stackoverflow.com/questions/39704273/macos-x-is-there-a-way-to-install-only-redis-cli\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/39704273/macos-x-is-there-a-way-to-install-only-redis-cli</a></li>\n</ul>\n<h3 id=\"根据redis常用命令来学习使用redis-cli。\"><a href=\"#根据redis常用命令来学习使用redis-cli。\" class=\"headerlink\" title=\"根据redis常用命令来学习使用redis-cli。\"></a>根据redis常用命令来学习使用redis-cli。</h3>","categories":["Redis"],"tags":["Redis","Redis-cli"]},{"title":"Nginx-Log","url":"/posts/2239464817/","content":"<blockquote>\n<p>公司没有日志采集平台，又不太可能在业务系统里面搞事情。好在之前有玩过elk日志分析组合。直接从服务器上面撸出日志简单的用linux命令分析下吧。</p>\n</blockquote>\n<blockquote>\n<p>Ngxin 日志格式化</p>\n</blockquote>\n<ul>\n<li>Nginx提供的访问日志里就蕴藏着大量有用信息。今天这篇要说的就是如果修改Nginx默认日志格式，以便于我们更好的挖掘有效指标。</li>\n</ul>\n<p>编辑<code>/etc/nginx.conf</code>配置文件，在日志部分添加下面两段代码，编辑完成后重启Nginx服务即可。</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">log_format</span> main <span class=\"string\">'<span class=\"variable\">$host</span> - <span class=\"variable\">$remote_addr</span> - [<span class=\"variable\">$time_local</span>] \"<span class=\"variable\">$request</span>\" '</span></span><br><span class=\"line\">                <span class=\"string\">'<span class=\"variable\">$status</span> <span class=\"variable\">$upstream_response_time</span> <span class=\"variable\">$request_time</span> \"<span class=\"variable\">$http_referer</span>\"'</span></span><br><span class=\"line\">                <span class=\"string\">'\"<span class=\"variable\">$http_user_agent</span>\" \"<span class=\"variable\">$http_x_forwarded_for</span>\" <span class=\"variable\">$body_bytes_sent</span> '</span>;</span><br><span class=\"line\"><span class=\"attribute\">access_log</span> /var/log/nginx/access.log main;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>简单罗列一下变量的含义:</p>\n</blockquote>\n<ul>\n<li><code>$host</code> 访问域名</li>\n<li><code>$remote_addr</code> 客户端IP地址</li>\n<li><code>$time_local</code> 访问时间</li>\n<li><code>$status</code> 访问状态码</li>\n<li><code>$upstream_response_time</code> 应用返回到Nginx的时间</li>\n<li><code>$request_time</code> 请求时间</li>\n<li><code>$http_referer</code> 请求来源</li>\n<li><code>$http_user_agent</code> 访问客户端</li>\n<li><code>$http_x_forwarded_for</code> 客户端IP地址</li>\n<li><code>$body_bytes_sent</code> 返回给客户端大小</li>\n</ul>\n<blockquote>\n<p>在server中不生效的问题</p>\n</blockquote>\n<ul>\n<li>在server中增加 <code>access_log /var/log/nginx/access.log main;</code></li>\n</ul>\n<blockquote>\n<p>日期显示问题</p>\n</blockquote>\n<ul>\n<li><p><code>[01/Jul/2020:03:25:17 +0800]  </code>官方默认是这种</p>\n</li>\n<li><p>修改默认格式</p>\n</li>\n</ul>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">log_format</span> main <span class=\"string\">'<span class=\"variable\">$host</span> - <span class=\"variable\">$remote_addr</span> - [<span class=\"variable\">$time_iso8601</span>] \"<span class=\"variable\">$request</span>\" '</span></span><br><span class=\"line\">                <span class=\"string\">'<span class=\"variable\">$status</span> <span class=\"variable\">$upstream_response_time</span> <span class=\"variable\">$request_time</span> \"<span class=\"variable\">$http_referer</span>\"'</span></span><br><span class=\"line\">                <span class=\"string\">'\"<span class=\"variable\">$http_user_agent</span>\" \"<span class=\"variable\">$http_x_forwarded_for</span>\" <span class=\"variable\">$body_bytes_sent</span> '</span>;</span><br><span class=\"line\"><span class=\"attribute\">access_log</span> /var/log/nginx/access.log main;</span><br></pre></td></tr></table></figure>\n\n\n\n<ul>\n<li>在server中增加下面代码</li>\n</ul>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tif ($time_iso8601 ~ \"^(\\d&#123;4&#125;)-(\\d&#123;2&#125;)-(\\d&#123;2&#125;) (\\d&#123;2&#125;):(\\d&#123;2&#125;):(\\d&#123;2&#125;)\") &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attribute\">set</span> <span class=\"variable\">$year</span> <span class=\"variable\">$1</span>;</span><br><span class=\"line\">\t\t\t<span class=\"attribute\">set</span> <span class=\"variable\">$month</span> <span class=\"variable\">$2</span>;</span><br><span class=\"line\">\t\t\t<span class=\"attribute\">set</span> <span class=\"variable\">$day</span> <span class=\"variable\">$3</span>;</span><br><span class=\"line\">\t\t\t<span class=\"attribute\">set</span> <span class=\"variable\">$hour</span> <span class=\"variable\">$4</span>;</span><br><span class=\"line\">\t\t\t<span class=\"attribute\">set</span> <span class=\"variable\">$minutes</span> <span class=\"variable\">$5</span>;</span><br><span class=\"line\">\t\t\t<span class=\"attribute\">set</span> <span class=\"variable\">$seconds</span> <span class=\"variable\">$6</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Nginx日志统计\"><a href=\"#Nginx日志统计\" class=\"headerlink\" title=\"Nginx日志统计\"></a>Nginx日志统计</h3><p>（日志文件叫access.log 在当前目录下）</p>\n<p><strong>统计 PV，就是日志行数</strong></p>\n<p><code>cat access.log |wc -l</code></p>\n<p><strong>UV, 即是统计 IP 数</strong></p>\n<p><code>cat access.log |awk &#39;{print $1}&#39; |sort |uniq -c |wc -l</code></p>\n<p><strong>使用linux grep 进行统计</strong></p>\n<p><code>grep -E &quot;POST|GET&quot; access.log | awk -F &#39;&quot;&#39; &#39;{print $2,$3}&#39; | awk &#39;{print $2}&#39;| sort | uniq -c | sort -k1nr | head -100</code></p>\n<p><strong>耗时的请求发生时间、所请求的 URI 和耗时</strong></p>\n<p><code>cat access.log | awk &#39;{print $4,$7,$10,$NF}&#39; | sort -k3 -nr | head -100</code></p>\n<p><strong>统计</strong>nginx<strong>访问频次最高的</strong>100<strong>个</strong>Ip**</p>\n<p><code>grep -E &quot;POST|GET&quot; access.log | awk -F &#39;&quot;&#39; &#39;{print $(NF-1)}&#39; | sort | uniq -c | sort -k1nr | head -100</code></p>\n<p><strong>统计</strong>nginx<strong>访问不正常（状态码</strong>400+<strong>）的前</strong>100<strong>个</strong>url<strong>和频次</strong></p>\n<p><code>grep -E &quot;POST|GET&quot; access.log | awk -F &#39;&quot;&#39; &#39;{print $2,$3}&#39; | awk &#39;{if ($4&gt;=&quot;400&quot;) {print $4,$1,$2}}&#39; | sort | uniq -c | sort -k1nr | head -100</code></p>\n<p><strong>统计nginx访问状态码非200的前100个</strong>url<strong>和频次**</strong></p>\n<p><code>grep -E &quot;POST|GET&quot; access.log | awk -F &#39;&quot;&#39; &#39;{print $2,$3}&#39; | awk &#39;{if ($4!=200) {print $4,$1,$2}}&#39; | sort | uniq -c | sort -k1nr | head -100</code></p>\n<p><strong>不同 URI 的平均耗时</strong></p>\n<p><code>grep -E &quot;POST|GET&quot; access.log  | awk &#39;{s[$10] += $NF;c[$10]++}END{for(i in s){print i,s[i]/c[i]}}&#39; |sort -k2 -nr | head</code></p>\n<p><strong>每秒请求量统计</strong></p>\n<p>统计每秒的请求数,top100的时间点(精确到秒)</p>\n<p><code>grep -E &quot;POST|GET&quot; access.log |  awk &#39;{print $4}&#39; access.log |cut -c 14-21|sort|uniq -c|sort -nr|head -n 100</code></p>\n<p><strong>每分钟请求量统计</strong></p>\n<p>统计每分钟的请求数,top100的时间点(精确到分钟)</p>\n<p><code>grep -E &quot;POST|GET&quot; access.log |  awk &#39;{print $4}&#39; access.log |cut -c 14-18|sort|uniq -c|sort -nr|head -n 100</code></p>\n<p><strong>每小时请求量统计</strong></p>\n<p>统计每小时的请求数,top100的时间点(精确到小时)</p>\n<p><code>grep -E &quot;POST|GET&quot; access.log |  awk &#39;{print $4}&#39; access.log |cut -c 14-15|sort|uniq -c|sort -nr|head -n 100</code></p>\n<p><strong>统计蜘蛛抓取次数</strong></p>\n<p><code>grep &#39;Baiduspider&#39; access.log |wc -l</code></p>\n","categories":["Nginx"],"tags":["nginx"]},{"title":"Coding-Style","url":"/posts/1362086803/","content":"<blockquote>\n<p>好久没更新博客，最近公司让我出一个代码规范，我吓了一跳。赶忙翻出阿里《 码出高效》，不敢造次，我就补充点个人的想法吧。代码是给人看的。代码风格应该遵循<code>极简主义</code>    </p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20210928210510111.png\">                                                                                                  </p>\n<h3 id=\"1、避免复杂、追求简单\"><a href=\"#1、避免复杂、追求简单\" class=\"headerlink\" title=\"1、避免复杂、追求简单\"></a>1、避免复杂、追求简单</h3><blockquote>\n<p>日常开发中，除了解决业务问题还需要解决许多的工程问题。如何选择当下合适的方法解决问题；需要不断尝试和摸索，没有最好的方法只有更好的方法。</p>\n</blockquote>\n<h3 id=\"2、合理平滑的处理技术债务\"><a href=\"#2、合理平滑的处理技术债务\" class=\"headerlink\" title=\"2、合理平滑的处理技术债务\"></a>2、合理平滑的处理技术债务</h3><blockquote>\n<p>技术的演变速度太快，如何避免长时间的技术债务是非常严重的问题，总之弊大于利。尽可能保持轻装上阵，避免拖油瓶项目。</p>\n<p>关键字：</p>\n<ul>\n<li>一方库: 本工程内部子项目模块依赖的库(jar 包)。 </li>\n<li>二方库: 公司内部发布到中央仓库，可供公司内部其它应用依赖的库(jar包)。 </li>\n<li>三方库: 公司之外的开源库(jar 包)。 </li>\n</ul>\n</blockquote>\n<h4 id=\"『避免过度封装』\"><a href=\"#『避免过度封装』\" class=\"headerlink\" title=\"『避免过度封装』\"></a>『避免过度封装』</h4><blockquote>\n<p>特别是没有完整的技术人员编制的情况下，怎么简单怎么处理（去除中间商赚差价一个道理。）避免过度开发<code>一方库</code>；建议使用原生方式(综合评估代码量)<code>避免框架过度封装</code>。（Java的方法调用链过长是出了名的恶心）</p>\n</blockquote>\n<h4 id=\"『避免代码过度重复』\"><a href=\"#『避免代码过度重复』\" class=\"headerlink\" title=\"『避免代码过度重复』\"></a>『避免代码过度重复』</h4><blockquote>\n<p>每次开发业务都会写很多的代码。定期对公司项目进行基础代码的重构。合理的拆分<code>业务无关的基础代码</code>。</p>\n</blockquote>\n<h4 id=\"『避免版本混乱』\"><a href=\"#『避免版本混乱』\" class=\"headerlink\" title=\"『避免版本混乱』\"></a>『避免版本混乱』</h4><p>使用统一的版本管理。约束所有的项目jar版本依赖。防止因为过度使用<code>三方库</code>出现奇怪的bug。公司<code>bom</code>需要单独处理。尽量保持与社区版本同步，比如springboot最新版是2.1.3 ，那么公司使用的版本最好是近半年的GA版本。</p>\n<h4 id=\"『物极必反』\"><a href=\"#『物极必反』\" class=\"headerlink\" title=\"『物极必反』\"></a>『物极必反』</h4><blockquote>\n<p>请勿过度依赖某框架栈或者解决方式，客观的对比相关解决方案优缺点。</p>\n</blockquote>\n<h4 id=\"『选择大于努力』\"><a href=\"#『选择大于努力』\" class=\"headerlink\" title=\"『选择大于努力』\"></a>『选择大于努力』</h4><blockquote>\n<p>集中精力掌握核心知识。按照目前技术演变的速度，更新最快的是应用技术，其次是行业规范相关技术。最后才是革命性的技术。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/%E4%BB%A3%E7%A0%81%E6%80%BB%E7%BB%93/%E6%8A%80%E6%9C%AF%E8%B1%A1%E9%99%90%E5%9B%BE.png\"></p>\n<a id=\"more\"></a>\n\n<h3 id=\"3、指定一种工程结构\"><a href=\"#3、指定一种工程结构\" class=\"headerlink\" title=\"3、指定一种工程结构\"></a>3、指定一种工程结构</h3><blockquote>\n<p>统一的工程结构，对开发人员来说如同指路明灯，可以快速的区分相关代码位置。</p>\n</blockquote>\n<h4 id=\"『阿里巴巴Java开发手册-应用分层』\"><a href=\"#『阿里巴巴Java开发手册-应用分层』\" class=\"headerlink\" title=\"『阿里巴巴Java开发手册-应用分层』\"></a>『阿里巴巴Java开发手册-应用分层』</h4><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/%E4%BB%A3%E7%A0%81%E6%80%BB%E7%BB%93/%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.png\"></p>\n<ul>\n<li>开放接口层:可直接封装 Service 方法暴露成 RPC 接口;通过 Web 封装成 http 接口;进行 网关安全控制、流量控制等。 </li>\n<li>终端显示层:各个端的模板渲染并执行显示的层。当前主要是 velocity 渲染，JS 渲染， JSP 渲染，移动端展示等。 </li>\n<li>Web 层:主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等。 </li>\n<li>Service 层:相对具体的业务逻辑服务层。 </li>\n<li>Manager 层:通用业务处理层，它有如下特征:<ol>\n<li>对第三方平台封装的层，预处理返回结果及转化异常信息;</li>\n<li>对Service层通用能力的下沉，如缓存方案、中间件通用处理; </li>\n<li>与DAO层交互，对多个DAO的组合复用。 </li>\n</ol>\n</li>\n<li>DAO 层:数据访问层，与底层 MySQL、Oracle、Hbase 等进行数据交互。 </li>\n<li>外部接口或第三方平台:包括其它部门RPC开放接口，基础平台，其它公司的HTTP接口。 </li>\n</ul>\n<h4 id=\"『建议分层方式』\"><a href=\"#『建议分层方式』\" class=\"headerlink\" title=\"『建议分层方式』\"></a>『建议分层方式』</h4><blockquote>\n<p>根据工作实际情况，参考阿里的应用分层后适当采纳。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/%E4%BB%A3%E7%A0%81%E6%80%BB%E7%BB%93/%E5%BB%BA%E8%AE%AE%E5%BA%94%E7%94%A8%E5%88%86%E5%B1%82.png\"></p>\n<ul>\n<li><p>开放接口层:可直接封装 Service 方法暴露成 RPC 接口;通过 Web 封装成 http 接口;进行 网关安全控制、流量控制等。 </p>\n</li>\n<li><p><del>终端显示层:各个端的模板渲染并执行显示的层。当前主要是 velocity 渲染，JS 渲染， JSP 渲染，移动端展示等</del>  </p>\n</li>\n<li><p><del>Web 层:主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等</del>  </p>\n</li>\n<li><p>Service 层:相对具体的业务逻辑服务层。 </p>\n</li>\n<li><p>Manager 层:通用业务处理层，它有如下特征:</p>\n<ol>\n<li><p>对第三方平台封装的层，预处理返回结果及转化异常信息。</p>\n</li>\n<li><p>对Service层通用能力的下沉，如缓存方案、中间件通用处理。</p>\n</li>\n<li><p>与DAO层交互，对多个DAO的组合复用。 </p>\n</li>\n</ol>\n</li>\n<li><p>DAO 层:数据访问层，与底层 MySQL、Oracle、Hbase 等进行数据交互。 </p>\n</li>\n<li><p>外部接口或第三方平台:包括其它部门RPC开放接口，基础平台，其它公司的HTTP接口。</p>\n</li>\n</ul>\n<blockquote>\n<p>目前Java已经不写前端代码，所以终端显示层和Web已经没有使用的价值。这里需要额外的注意，开放接口层不需要任何的业务操作，方便做完整的单元测试。将参数校验等操作放在具体业务执行的过程中。</p>\n</blockquote>\n<h4 id=\"『建议分层异常处理方式』\"><a href=\"#『建议分层异常处理方式』\" class=\"headerlink\" title=\"『建议分层异常处理方式』\"></a>『建议分层异常处理方式』</h4><ul>\n<li>(分层异常处理规约)在 DAO 层，产生的异常类型有很多，无法用细粒度的异常进行catch，使用catch(Exception e)方式，并throw new xxxException(e)，不需要打印日志，因为日志在 Manager/Service 层一定需要捕获并打印到日志文件中去，如果同台服务器再打日志，浪费性能和存储。<code>在 Service 层出现异常时，必须记录出错日志到磁盘，尽可能带上参数信息，相当于保护案发现场</code>。如果 Manager 层与 Service 同机部署，日志方式与 DAO层处理一致，如果是单独部署，则采用与 Service 一致的处理方式。</li>\n</ul>\n<h4 id=\"『分层领域模型规约』\"><a href=\"#『分层领域模型规约』\" class=\"headerlink\" title=\"『分层领域模型规约』\"></a>『分层领域模型规约』</h4><ul>\n<li>DO(Data Object):此对象与数据库表结构一一对应，通过 DAO 层向上传输数据源对象。 </li>\n<li>DTO(Data Transfer Object):数据传输对象，Service 或 Manager 向外传输的对象。 </li>\n<li>BO(Business Object):业务对象，由 Service 层输出的封装业务逻辑的对象。 </li>\n<li><del>AO(ApplicationObject):应用对象，在Web层与Service层之间抽象的复用对象模型， 极为贴近展示层，复用度不高</del>。</li>\n<li><del>VO(View Object):显示层对象，通常是 Web 向模板渲染引擎层传输的对象</del>。</li>\n<li><del>Query:数据查询对象，各层接收上层的查询请求。注意超过 2 个参数的建议查询封装，<code>禁止使用 Map 类来传输</code>。</del> </li>\n</ul>\n<blockquote>\n<p>没有必要过度设计、导致代码量增加。DTO、AO、VO Query 在实际开发过程实际上可以完全复用。Query是查询参数,通常用于用户分页查询和普通参数查询等封装体。BO需要高度抽象，属于业务模型。目前接口数据显示要求不高的情况可以适当放宽，不使用 BO层。</p>\n</blockquote>\n<h4 id=\"『分层参考』\"><a href=\"#『分层参考』\" class=\"headerlink\" title=\"『分层参考』\"></a>『分层参考』</h4><ul>\n<li>推荐的参考</li>\n</ul>\n<blockquote>\n<p>主目录示例:com.github.z201.pre</p>\n<ul>\n<li>com.github.z201   公司域名(这只是例子)</li>\n<li>pre               项目名称</li>\n<li>dao              模块名称</li>\n</ul>\n<p>模块示例:com.github.z201.pre</p>\n<ul>\n<li>dao     #mybaits接口映射层</li>\n<li>entity  # mysql表映射层</li>\n<li>dto      # 网络传输层</li>\n<li>manger # 第三方（缓存、事务、mp、外部接口）</li>\n<li>service  # 主要业务实现（无事务处理、简单业务）</li>\n<li>utils       # 项目工具类（该项目独立使用的）</li>\n</ul>\n<p>对于该模块关键模块，建议单独区分，用于识别。按照黄金法则，一个模块中核心接口少数。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">➜  demo git:(develop) ✗ tree src/main -d -L 7</span><br><span class=\"line\">src/main</span><br><span class=\"line\">├── java</span><br><span class=\"line\">│   └── com</span><br><span class=\"line\">│       └── github</span><br><span class=\"line\">│           └── z201</span><br><span class=\"line\">│               └── pre</span><br><span class=\"line\">│                   ├── annotation <span class=\"comment\"># 关键业务（注解拦截层）</span></span><br><span class=\"line\">│                   ├── dao        <span class=\"comment\"># mybaits接口映射层</span></span><br><span class=\"line\">│                   ├── entity     <span class=\"comment\"># 实体映射层</span></span><br><span class=\"line\">│                   ├── dto     </span><br><span class=\"line\">│                   │   ├── cache\t <span class=\"comment\"># 缓存传输层</span></span><br><span class=\"line\">│                   │   ├── param  <span class=\"comment\"># 请求参数封装体（Query的细化）</span></span><br><span class=\"line\">│                   │   ├── result <span class=\"comment\"># 响应参数封装体</span></span><br><span class=\"line\">│                   │   └── search <span class=\"comment\"># 查询参数封装体（Query的细化）</span></span><br><span class=\"line\">│                   ├── <span class=\"built_in\">limit</span>      <span class=\"comment\"># 关键业务实现（关键业务不建议放到service层，方便快速识别。）</span></span><br><span class=\"line\">│                   │   └── impl</span><br><span class=\"line\">│                   ├── manger     <span class=\"comment\"># 第三方（缓存、事务、mp、外部接口）</span></span><br><span class=\"line\">│                   │   └── impl   <span class=\"comment\"># 实现类</span></span><br><span class=\"line\">│                   ├── service    <span class=\"comment\"># 主要业务实现（无事务处理）</span></span><br><span class=\"line\">│                   │   └── impl   <span class=\"comment\"># 实现类</span></span><br><span class=\"line\">│                   └── utils      <span class=\"comment\"># 项目工具类（该项目独立使用的）</span></span><br><span class=\"line\">│                       └── common  </span><br><span class=\"line\">│                       </span><br><span class=\"line\">└── resource</span><br><span class=\"line\">    └── mapper <span class=\"comment\"># mybatis文件。</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4、保持代码的整洁\"><a href=\"#4、保持代码的整洁\" class=\"headerlink\" title=\"4、保持代码的整洁\"></a>4、保持代码的整洁</h3><blockquote>\n<p>写出运行代码（bug）是简单的、写出适合阅读的代码是困难，建议阅读<code>阿里巴巴Java开发手册</code> 以及<code>码出高效Java开发手册</code>相关章节。这里做下内容补充。</p>\n</blockquote>\n<h4 id=\"『尽可能少写代码』\"><a href=\"#『尽可能少写代码』\" class=\"headerlink\" title=\"『尽可能少写代码』\"></a>『尽可能少写代码』</h4><blockquote>\n<p>写的越多错的越多，错的越多修复越难。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用lombok语法糖，简化模版代码。</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@NoArgsConstructor</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SmSpaceFunctionCache</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 主键</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer id;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 功能名称</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 图片主键id（使用运营后台 sm_admin_pictrue表存储图片)</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer adminPictureId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 图片地址</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String picPath;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 排序 默认 0</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer orderBy;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 无 get 、 set 更多特性请查阅lombok使用方法。</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"『提高代码覆盖率』\"><a href=\"#『提高代码覆盖率』\" class=\"headerlink\" title=\"『提高代码覆盖率』\"></a>『提高代码覆盖率』</h4><blockquote>\n<p>（避免无调用代码，避免过度使用代码生成器）健壮的代码是干净、简洁的。避免重型项目出现（保持项目业务代码1-2W行，可以适当的模块化）</p>\n</blockquote>\n<h4 id=\"『合理拆分代码逻辑』\"><a href=\"#『合理拆分代码逻辑』\" class=\"headerlink\" title=\"『合理拆分代码逻辑』\"></a>『合理拆分代码逻辑』</h4><blockquote>\n<p>（避免代码过度优化和过早优化，<code>需求一定会改、一定会改、一定会改</code>）适当调整代码，保证阅读方便即可。推荐使用阿里<code>p3c</code>代码检查工具。鬼故事：李光磊以前劝华为的同事用Eclipse，人家打死不肯用。他自己搞起来，给人家说，你看，多方便。华为的同时默默的输入了一个文件名，跳过去，Eclipse崩贵了，文件太大。</p>\n</blockquote>\n<h4 id=\"『更新注释』\"><a href=\"#『更新注释』\" class=\"headerlink\" title=\"『更新注释』\"></a>『更新注释』</h4><blockquote>\n<p>代码千万行，注释第一行。注释不规范，同事两行泪。改代码不改注释非常容易误导他人。尽可能保持个人代码的注释信息合理。</p>\n</blockquote>\n<h4 id=\"『面向接口编程』\"><a href=\"#『面向接口编程』\" class=\"headerlink\" title=\"『面向接口编程』\"></a>『面向接口编程』</h4><blockquote>\n<ul>\n<li>面向接口编程和面向对象编程并不是平级的，它并不是比面向对象编程更先进的一种独立的编程思想，而是附属于面向对象思想体系，属于其一部分。或者说，它是面向对象编程体系中的思想精髓之一。</li>\n<li>在一个面向对象的系统中，系统的各种功能是由许许多多的不同对象协作完成的。在这种情况下，各个对象内部是如何实现自己的,对系统设计人员来讲就不那么重要了；而各个对象之间的协作关系则成为系统设计的关键。小到不同类之间的通信，大到各模块之间的交互，在系统设计之初都是要着重考虑的，这也是系统设计的主要工作内容。面向接口编程就是指按照这种思想来编程。</li>\n</ul>\n</blockquote>\n<ul>\n<li>降低程序的耦合性。在程序中紧密的联系并不是一件好的事情，因为两种事物之间联系越紧密，更换其中之一的难度就越大，扩展功能和debug的难度也就越大。 </li>\n<li>易于程序的扩展。</li>\n<li>有利于程序的维护。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 示例代码,在接口暴露层，是不建议做任何的业务操作。建议使用bean封装数据。</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(FunctionController.ROUTER_INDEX)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FunctionController</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String ROUTER_INDEX = <span class=\"string\">\"/api/space\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    PackageFunctionServiceI packageFunctionService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取功能分页列表</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@PostMapping</span>(<span class=\"string\">\"/function/list\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">listSpaceFunction</span><span class=\"params\">(@RequestBody SpacePackageFunctionSearch pageSearch)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> packageFunctionService.listSpaceFunction(pageSearch);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  .....</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>if/for/while/switch/do等保留字与左右括号之间都必须加空格。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 合理的增加空格，方便阅读代码。</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == endTime || <span class=\"number\">0L</span> == endTime) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">\"获取用户vip的到期时间失败了，数据出现异常。～～～\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5、防御式编程\"><a href=\"#5、防御式编程\" class=\"headerlink\" title=\"5、防御式编程\"></a>5、防御式编程</h3><ul>\n<li>请不要相信任何参数。尽可能保持客观的态度编写代码。参考&lt;&lt;代码大全&gt;&gt; <code>『人类都是不安全、不值得信任的，所有的人，都会犯错误，而你写的代码，应该考虑到所有可能发生的错误，让你的程序不会因为他人的错误而发生错误』</code></li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这是从内部接口调用的数据，首先不信任给的数据。避免常规错误导致自己的逻辑出现明显的bug。</span></span><br><span class=\"line\"><span class=\"comment\">// 获取vip的到期时间</span></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">  endTime = spaceVipCacheService.getSpaceVipEndTimeByUserId(userId);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (InvalidProtocolBufferException e) &#123;</span><br><span class=\"line\">  log.warn(<span class=\"string\">\"获取用户vip的到期时间失败了，系统出现异常。～～～ \"</span>);</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">\"获取用户vip的到期时间失败了，系统出现异常。～～～\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == endTime || <span class=\"number\">0L</span> == endTime) &#123;</span><br><span class=\"line\">  log.warn(<span class=\"string\">\"获取用户vip的到期时间失败了，系统出现异常。～～～ \"</span>);</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">\"获取用户vip的到期时间失败了，数据出现异常。～～～\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6、抛异常-or-返回错误码-or-日志\"><a href=\"#6、抛异常-or-返回错误码-or-日志\" class=\"headerlink\" title=\"6、抛异常 or 返回错误码 or 日志\"></a>6、抛异常 or 返回错误码 or 日志</h3><blockquote>\n<p>公司外的http/api开放接口必须使用“错误码”；应用内部推荐异常抛出(适当抛出堆栈，性能影响)。避免恶意请求接口，并通过返回消息猜出接口参数的问题。日志文件推荐至少保存15天，因为有些异常具备以“周”为频次发生的特点。</p>\n</blockquote>\n<ul>\n<li>就java日志框架而言，建议使用侨接slf4j来输出日志。<ul>\n<li>当遇到问题的时候，只能功过debug功能来确定问题。应该考虑输出日志信息，良好的系统日志信息对问题进行定位的。</li>\n<li>项目中大量的分支判断if \\else、switch 的分支时候使用日志可以定位具体是哪个业务流程。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//尽可能参数化日志信息，日志是给人看的。不是为了输出而输出。关键参数可以隔离显示比如 [&#123;&#125;]</span></span><br><span class=\"line\">logger.debug(<span class=\"string\">\"这是一条debug日志 [&#123;&#125;]\"</span> , userId);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对于debug日志，必须判断日志的级别才能进行输出。</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(logger.isDebugEnabled())&#123;</span><br><span class=\"line\">  logger.debug(<span class=\"string\">\"这是一条debug日志 [&#123;&#125;]\"</span> , userId);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 避免使用字符串拼接的方式输出日志，这样会导致生产了很多的string对象。</span></span><br><span class=\"line\">logger.debug(<span class=\"string\">\"这是一条字符串拼接的日志输出 : [\"</span>  + userId +<span class=\"string\">\"]\"</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>日志级别的使用<ul>\n<li><code>日志级别 trace, debug, info, warn, error, fatal</code></li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"> 这里以log4j相关的日志的打印级别，OFF即不打印，其他则按照标准级别配置即可，如 debug </span><br><span class=\"line\">       关闭：OFF(0)</span><br><span class=\"line\">致命：FATAL(100)，对应Logger.fatal方法</span><br><span class=\"line\">错误：ERROR(200)，对应Logger.error方法</span><br><span class=\"line\">警告：WARN(300)，对应Logger.warn方法</span><br><span class=\"line\">信息：INFO(400)，对应Logger.info方法</span><br><span class=\"line\">调试：DEBUG(500)，对应Logger.debug方法</span><br><span class=\"line\">跟踪：TRACE(600)，对应Logger.trace方法</span><br><span class=\"line\">全部：ALL(Integer.MAX_VALUE)</span><br><span class=\"line\">当指定某一个级别时，比如DEBUG，那么所有低于这个级别的其它级别日志，都会被打印。</span><br><span class=\"line\">当指定级别为DEBUG时，Logger.debug、Logger.info、Logger.warn、Logger.error以及Logger.fatal等方法</span><br><span class=\"line\">都能输出日志，但Logger.trace无法输出日志。</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>error：对于影响到程序正常运行的信息，需要及时补货并输出，适用范围<code>配置文件读取失败、第三方调用失败、数据库连接失败、缓存等关键组件失败异常</code></li>\n</ul>\n<h3 id=\"7、方法命名、变量命名\"><a href=\"#7、方法命名、变量命名\" class=\"headerlink\" title=\"7、方法命名、变量命名\"></a>7、方法命名、变量命名</h3><blockquote>\n<p>建议阅读<code>阿里巴巴Java开发手册</code> 以及<code>码出高效Java开发手册</code>相关章节。这里做下内容补充。</p>\n</blockquote>\n<ul>\n<li><p>变量命名</p>\n<blockquote>\n<p>如果想不到合适的变量名字，麻烦把注释写清楚。如果连思考的时间都没有请使用TODO标记。</p>\n</blockquote>\n</li>\n<li><p>service层</p>\n<blockquote>\n<p>如果想不到合适的方法名字，麻烦把注释写全。如果连思考的时间都没有请使用TODO标记。</p>\n</blockquote>\n</li>\n<li><p>Dao层</p>\n<blockquote>\n<p>如果是批量建议加上Batch。</p>\n</blockquote>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">获取单个对象 &#96;getXxx&#96;</span><br><span class=\"line\">获取多个对象&#96;listXxx&#96;</span><br><span class=\"line\">通过复杂的查询&#96;listXxxBySearch&#96;这里的&#96;search&#96;就是参数封装体</span><br><span class=\"line\">获取统计值 &#96;countXxx&#96;</span><br><span class=\"line\">插入&#96;saveXxx&#96; &#x2F; &#96;insertXxx&#96;</span><br><span class=\"line\">删除 &#96;removeXxx&#96; &#x2F; &#96;deleteXxx&#96;</span><br><span class=\"line\">修改 &#96;updateXxx&#96;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8、Redis\"><a href=\"#8、Redis\" class=\"headerlink\" title=\"8、Redis\"></a>8、Redis</h3><ul>\n<li>key名设计</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">#建议：可读性和可管理性（redis作为标准缓存时推荐）</span><br><span class=\"line\">#以业务名(或数据库名)为前缀(防止key冲突)，用冒号分隔，比如业务名:表名:id</span><br><span class=\"line\">ugc:video:1</span><br><span class=\"line\"></span><br><span class=\"line\">#简洁性</span><br><span class=\"line\">#建议：保证语义的前提下，控制key的长度，当key较多时，内存占用也不容忽视，例如：</span><br><span class=\"line\">user:&#123;uid&#125;:friends:messages:&#123;mid&#125;简化为u:&#123;uid&#125;:fr:m:&#123;mid&#125;。</span><br><span class=\"line\"></span><br><span class=\"line\">#强制：不要包含特殊字符</span><br><span class=\"line\">反例：包含空格、换行、单双引号以及其他转义字符</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>value设计</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 强制：拒绝bigkey(防止网卡流量、慢查询)</span><br><span class=\"line\">string类型控制在20KB以内，hash、list、set、zset元素个数不要超过5000，这里指的是field(不是key)。</span><br><span class=\"line\"># 反例：一个包含200万个元素的list。</span><br><span class=\"line\">非字符串的bigkey，不要使用del删除，使用hscan、sscan、zscan方式渐进式删除，同时要注意防止bigkey过期时间自动删除问题(例如一个200万的zset设置1小时过期，会触发del操作，造成阻塞，而且该操作不会不出现在慢查询中(latency可查))。</span><br><span class=\"line\"></span><br><span class=\"line\"># 建议- 选择适合的数据类型。</span><br><span class=\"line\">例如：实体类型(要合理控制和使用数据结构内存编码优化配置,例如ziplist，但也要注意节省内存和性能之间的平衡)</span><br><span class=\"line\"></span><br><span class=\"line\"># 反例</span><br><span class=\"line\">set user:1:name tom</span><br><span class=\"line\">set user:1:age 19</span><br><span class=\"line\">set user:1:favor football</span><br><span class=\"line\"></span><br><span class=\"line\">改进</span><br><span class=\"line\">hmset user:1 name tom age 19 favor football</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>控制key的生命周期，redis不是垃圾桶。</li>\n</ul>\n<p><code>建议使用expire设置过期时间(条件允许可以打散过期时间，防止集中过期)，不过期的数据重点关注idletime。</code></p>\n<ul>\n<li>【建议】：禁用命令</li>\n</ul>\n<p>禁止线上（正式环境）使用keys、flushall、flushdb等，通过redis的rename机制禁掉命令，或者使用scan的方式渐进式处理。</p>\n<ul>\n<li>【建议】使用批量操作提高效率</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">原生命令：例如mget、mset。</span><br><span class=\"line\">非原生命令：可以使用pipeline提高效率。</span><br><span class=\"line\">但要注意控制一次批量操作的元素个数(例如500以内，实际也和元素字节数有关)。</span><br><span class=\"line\">注意两者不同：</span><br><span class=\"line\">1. 原生是原子操作，pipeline是非原子操作。</span><br><span class=\"line\">2. pipeline可以打包不同的命令，原生做不到。</span><br><span class=\"line\">3. pipeline需要客户端和服务端同时支持。</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>【建议】Redis（伪）事务功能较弱，不建议过多使用</li>\n</ul>\n<p>Redis的事务功能较弱(不支持回滚)，而且集群版本(自研和官方)要求一次事务操作的key必须在一个slot上(可以使用hashtag功能解决)。</p>\n<h2 id=\"代码质量\"><a href=\"#代码质量\" class=\"headerlink\" title=\"代码质量\"></a>代码质量</h2><blockquote>\n<p>我们也经常会听到很多其他的描述方式。这些描述方法语义更丰富、更专业、更细化。</p>\n</blockquote>\n<h3 id=\"写好代码\"><a href=\"#写好代码\" class=\"headerlink\" title=\"写好代码\"></a>写好代码</h3><ul>\n<li>可维护性（maintainability）<ul>\n<li>所谓的“维护”无外乎就是修改 bug、修改老的代码、添加新的代码之类的工作。所谓“代码易维护”就是指，在不破坏原有代码设计、不引入新的 bug 的情况下，能够快速地修改或者添加代码。</li>\n</ul>\n</li>\n<li>可读性（readability）<ul>\n<li>我们在编写代码的时候，时刻要考虑到代码是否易读、易理解。除此之外，代码的可读性在非常大程度上会影响代码的可维护性。</li>\n</ul>\n</li>\n<li>可扩展性（extensibility）<ul>\n<li>我们在不修改或少量修改原有代码的情况下，通过扩展的方式添加新的功能代码。说直白点就是，代码预留了一些功能扩展点，你可以把新功能代码，直接插到扩展点上，而不需要因为要添加一个功能而大动干戈，改动大量的原始代码。</li>\n</ul>\n</li>\n<li>灵活性（flexibility）<ul>\n<li>灵活性是一个挺抽象的评价标准。如果一段代码易扩展、易复用或者易用，我们都可以称这段代码写得比较灵活。</li>\n</ul>\n</li>\n<li>简洁性（simplicity）<ul>\n<li>KISS 原则：“Keep It Simple，Stupid”。这个原则说的意思就是，尽量保持代码简单。代码简单、逻辑清晰，也就意味着易读、易维护。我们在编写代码的时候，往往也会把简单、清晰放到首位。</li>\n</ul>\n</li>\n<li>可复用性（reusability）<ul>\n<li>代码的可复用性可以简单地理解为，尽量减少重复代码的编写，复用已有的代码。在后面的很多章节中，我们都会经常提到“可复用性”这一代码评价标准。</li>\n</ul>\n</li>\n<li>可测试性（testability）<ul>\n<li>代码的可测试性差，比较难写单元测试，那基本上就能说明代码设计得有问题。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"设计原则\"><a href=\"#设计原则\" class=\"headerlink\" title=\"设计原则\"></a>设计原则</h3><blockquote>\n<p>抽象、抽象、还是抽象。</p>\n</blockquote>\n<ul>\n<li>SOLID 原则 -SRP 单一职责原则SOLID 原则 </li>\n<li>OCP 开闭原则SOLID 原则 </li>\n<li>LSP 里式替换原则SOLID 原则 </li>\n<li>ISP 接口隔离原则SOLID 原则 </li>\n<li>DIP 依赖倒置原则DRY 原则、KISS 原则、YAGNI 原则、LOD 法则</li>\n</ul>\n<!--more-->\n\n<h3 id=\"设计模式\"><a href=\"#设计模式\" class=\"headerlink\" title=\"设计模式\"></a>设计模式</h3><blockquote>\n<p>设计模式是针对软件开发中经常遇到的一些设计问题，总结出来的一套解决方案或者设计思路。大部分设计模式要解决的都是代码的可扩展性问题。很多框架都有它们的身影。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>范围\\目的</th>\n<th>创建型模式</th>\n<th>结构型模式</th>\n<th>行为型模式</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>类模式</td>\n<td>工厂方法</td>\n<td>(类）适配器</td>\n<td>模板方法、解释器</td>\n</tr>\n<tr>\n<td>对象模式</td>\n<td>单例 原型 抽象工厂 建造者</td>\n<td>代理 (对象）适配器 桥接 装饰 外观 享元 组合</td>\n<td>策略 命令 职责链 状态 观察者 中介者 迭代器 访问者 备忘录</td>\n</tr>\n</tbody></table>\n<h4 id=\"GoF的23种设计模式的功能\"><a href=\"#GoF的23种设计模式的功能\" class=\"headerlink\" title=\"GoF的23种设计模式的功能\"></a>GoF的23种设计模式的功能</h4><p>前面说明了 GoF 的 23 种设计模式的分类，现在对各个模式的功能进行介绍。</p>\n<ol>\n<li>单例（Singleton）模式：某个类只能生成一个实例，该类提供了一个全局访问点供外部获取该实例，其拓展是有限多例模式。</li>\n<li>原型（Prototype）模式：将一个对象作为原型，通过对其进行复制而克隆出多个和原型类似的新实例。</li>\n<li>工厂方法（Factory Method）模式：定义一个用于创建产品的接口，由子类决定生产什么产品。</li>\n<li>抽象工厂（AbstractFactory）模式：提供一个创建产品族的接口，其每个子类可以生产一系列相关的产品。</li>\n<li>建造者（Builder）模式：将一个复杂对象分解成多个相对简单的部分，然后根据不同需要分别创建它们，最后构建成该复杂对象。</li>\n<li>代理（Proxy）模式：为某对象提供一种代理以控制对该对象的访问。即客户端通过代理间接地访问该对象，从而限制、增强或修改该对象的一些特性。</li>\n<li>适配器（Adapter）模式：将一个类的接口转换成客户希望的另外一个接口，使得原本由于接口不兼容而不能一起工作的那些类能一起工作。</li>\n<li>桥接（Bridge）模式：将抽象与实现分离，使它们可以独立变化。它是用组合关系代替继承关系来实现，从而降低了抽象和实现这两个可变维度的耦合度。</li>\n<li>装饰（Decorator）模式：动态的给对象增加一些职责，即增加其额外的功能。</li>\n<li>外观（Facade）模式：为多个复杂的子系统提供一个一致的接口，使这些子系统更加容易被访问。</li>\n<li>享元（Flyweight）模式：运用共享技术来有效地支持大量细粒度对象的复用。</li>\n<li>组合（Composite）模式：将对象组合成树状层次结构，使用户对单个对象和组合对象具有一致的访问性。</li>\n<li>模板方法（TemplateMethod）模式：定义一个操作中的算法骨架，而将算法的一些步骤延迟到子类中，使得子类可以不改变该算法结构的情况下重定义该算法的某些特定步骤。</li>\n<li>策略（Strategy）模式：定义了一系列算法，并将每个算法封装起来，使它们可以相互替换，且算法的改变不会影响使用算法的客户。</li>\n<li>命令（Command）模式：将一个请求封装为一个对象，使发出请求的责任和执行请求的责任分割开。</li>\n<li>职责链（Chain of Responsibility）模式：把请求从链中的一个对象传到下一个对象，直到请求被响应为止。通过这种方式去除对象之间的耦合。</li>\n<li>状态（State）模式：允许一个对象在其内部状态发生改变时改变其行为能力。</li>\n<li>观察者（Observer）模式：多个对象间存在一对多关系，当一个对象发生改变时，把这种改变通知给其他多个对象，从而影响其他对象的行为。</li>\n<li>中介者（Mediator）模式：定义一个中介对象来简化原有对象之间的交互关系，降低系统中对象间的耦合度，使原有对象之间不必相互了解。</li>\n<li>迭代器（Iterator）模式：提供一种方法来顺序访问聚合对象中的一系列数据，而不暴露聚合对象的内部表示。</li>\n<li>访问者（Visitor）模式：在不改变集合元素的前提下，为一个集合中的每个元素提供多种访问方式，即每个元素有多个访问者对象访问。</li>\n<li>备忘录（Memento）模式：在不破坏封装性的前提下，获取并保存一个对象的内部状态，以便以后恢复它。</li>\n<li>解释器（Interpreter）模式：提供如何定义语言的文法，以及对语言句子的解释方法，即解释器。</li>\n</ol>\n<h3 id=\"编程规范\"><a href=\"#编程规范\" class=\"headerlink\" title=\"编程规范\"></a>编程规范</h3><blockquote>\n<p>对于编码规范，考虑到很多书籍已经讲得很好了（比如《重构》《代码大全》《代码整洁之道》等</p>\n</blockquote>\n<h3 id=\"代码重构\"><a href=\"#代码重构\" class=\"headerlink\" title=\"代码重构\"></a>代码重构</h3><blockquote>\n<p>在软件开发中，只要软件在不停地迭代，就没有一劳永逸的设计。随着需求的变化，代码的不停堆砌。</p>\n</blockquote>\n","categories":["Dev"]},{"title":"Idea-Plugin","url":"/posts/1247507960/","content":"<blockquote>\n<p>有必要记录下自己常用的插件，避免特殊事件的发生。</p>\n</blockquote>\n<h4 id=\"MybatisX\"><a href=\"#MybatisX\" class=\"headerlink\" title=\"MybatisX\"></a>MybatisX</h4><blockquote>\n<p>Mybatis 插件，可以定位java和xml关系。通过java接口快速生成相关xml文件或者方法。</p>\n</blockquote>\n<h4 id=\"Mybaits-Log-plugin\"><a href=\"#Mybaits-Log-plugin\" class=\"headerlink\" title=\"Mybaits Log plugin\"></a>Mybaits Log plugin</h4><blockquote>\n<p>使用插件将mybaits默认的日志输出转换成可以运行的sql日志。</p>\n</blockquote>\n<h4 id=\"Alibaba-java-coding-guidelines\"><a href=\"#Alibaba-java-coding-guidelines\" class=\"headerlink\" title=\"Alibaba-java-coding-guidelines\"></a>Alibaba-java-coding-guidelines</h4><blockquote>\n<p>阿里巴巴java代码检查工具</p>\n</blockquote>\n<h4 id=\"json2pojo\"><a href=\"#json2pojo\" class=\"headerlink\" title=\"json2pojo\"></a>json2pojo</h4><blockquote>\n<p>json转bean的工具</p>\n</blockquote>\n<h4 id=\"PlantUML-integration\"><a href=\"#PlantUML-integration\" class=\"headerlink\" title=\"PlantUML integration\"></a>PlantUML integration</h4><blockquote>\n<p>画图的软件</p>\n</blockquote>\n<h3 id=\"Translation\"><a href=\"#Translation\" class=\"headerlink\" title=\"Translation\"></a>Translation</h3><blockquote>\n<p>翻译</p>\n</blockquote>\n<h4 id=\"查看某个方法被调用的地方。-鼠标选中方法名称\"><a href=\"#查看某个方法被调用的地方。-鼠标选中方法名称\" class=\"headerlink\" title=\"查看某个方法被调用的地方。(鼠标选中方法名称)\"></a>查看某个方法被调用的地方。(鼠标选中方法名称)</h4><p><code>Navigate | Call Hierarchy </code> 快捷键<code>control + option + h</code></p>\n<h4 id=\"Genterate-代码生成\"><a href=\"#Genterate-代码生成\" class=\"headerlink\" title=\"Genterate 代码生成\"></a>Genterate 代码生成</h4><p><code>Code | Genterate</code> #快捷键 <code>command + n</code></p>\n<h4 id=\"Copyright-模版\"><a href=\"#Copyright-模版\" class=\"headerlink\" title=\"Copyright 模版\"></a>Copyright 模版</h4><p><code>Edit | Copyright | Copyright profiles </code></p>\n<ul>\n<li>样板</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">Copyright (c) $today.year  </span><br><span class=\"line\">@Author:z201.coding@gamil.com</span><br><span class=\"line\">@LastModified:$today.format(&quot;yyyy-MM-dd&quot;)</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h4 id=\"Maven-Helper\"><a href=\"#Maven-Helper\" class=\"headerlink\" title=\"Maven Helper\"></a>Maven Helper</h4><ul>\n<li>解析maven pom结构，分析冲突；</li>\n</ul>\n<h4 id=\"快捷搜索\"><a href=\"#快捷搜索\" class=\"headerlink\" title=\"快捷搜索\"></a>快捷搜索</h4><p><code>shift 两次</code></p>\n<h4 id=\"全文搜索\"><a href=\"#全文搜索\" class=\"headerlink\" title=\"全文搜索\"></a>全文搜索</h4><p><code>command + shift + f</code></p>\n<h4 id=\"查找接口的实现类：\"><a href=\"#查找接口的实现类：\" class=\"headerlink\" title=\"查找接口的实现类：\"></a>查找接口的实现类：</h4><p> ctrl + alt +B </p>\n<h4 id=\"查看类或接口的继承关系：\"><a href=\"#查看类或接口的继承关系：\" class=\"headerlink\" title=\"查看类或接口的继承关系：\"></a>查看类或接口的继承关系：</h4><p>ctrl + h</p>\n","categories":["Dev"],"tags":["Idea"]},{"title":"源码分析-skywalking源码环境搭建","url":"/posts/3595703232/","content":"<h2 id=\"0x00-阅读源代码\"><a href=\"#0x00-阅读源代码\" class=\"headerlink\" title=\"0x00 阅读源代码\"></a>0x00 阅读源代码</h2><blockquote>\n<p>长达9天的断网终于结束了。</p>\n</blockquote>\n<h3 id=\"下载源代码\"><a href=\"#下载源代码\" class=\"headerlink\" title=\"下载源代码\"></a>下载源代码</h3><ul>\n<li>代码仓库地址 <a href=\"https://gitee.com/Z201/skywalking.git\" target=\"_blank\" rel=\"noopener\">https://gitee.com/Z201/skywalking.git</a></li>\n<li>阅读版本号 <code>v6.0.0-GA</code></li>\n<li>下载版本<code>git clone -b v6.0.0-GA https://github.com/apache/skywalking.git</code><ul>\n<li>由于github下载速度是在太慢了，这里用gitee克隆一个镜像。</li>\n<li>下载版本<code>git clone -b v6.0.0-GA https://gitee.com/Z201/skywalking.git</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"查看源代码结构\"><a href=\"#查看源代码结构\" class=\"headerlink\" title=\"查看源代码结构\"></a>查看源代码结构</h3><blockquote>\n<p>源码设计子项目过多，这里简单暂时2级目录。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">tree -d L 2</span><br><span class=\"line\">.</span><br><span class=\"line\">├── src  </span><br><span class=\"line\">│   ├── main # 源代码</span><br><span class=\"line\">│   ├── site # 站点稳当</span><br><span class=\"line\">│   └── test # 单元测试</span><br><span class=\"line\">└── travis   # 官方的ci集成</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>查看项目源码主目录</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">➜  skywalking git:(8b638258b) tree -d -L 1</span><br><span class=\"line\">.</span><br><span class=\"line\">├── apm-application-toolkit</span><br><span class=\"line\">├── apm-checkstyle</span><br><span class=\"line\">├── apm-commons</span><br><span class=\"line\">├── apm-dist</span><br><span class=\"line\">├── apm-protocol <span class=\"comment\"># pd文件</span></span><br><span class=\"line\">├── apm-sniffer <span class=\"comment\"># 插件</span></span><br><span class=\"line\">├── apm-webapp  </span><br><span class=\"line\">├── docker</span><br><span class=\"line\">├── docs</span><br><span class=\"line\">├── licenses</span><br><span class=\"line\">├── oap-server <span class=\"comment\"># 这里和5.x 有很大的不同改动了很多东西。</span></span><br><span class=\"line\">├── skywalking-ui </span><br><span class=\"line\">└── tools</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>将项目导入idea中。</li>\n</ul>\n<p>官方文档:<a href=\"https://github.com/apache/skywalking/blob/master/docs/en/guides/How-to-build.md\" target=\"_blank\" rel=\"noopener\">如何构建</a></p>\n<p><code>git submodule init</code></p>\n<p><code>git submodule update</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">➜  skywalking git:(8b638258b) git submodule init</span><br><span class=\"line\">Submodule <span class=\"string\">'apm-protocol/apm-network/src/main/proto'</span> (https://github.com/apache/incubator-skywalking-data-collect-protocol.git) registered <span class=\"keyword\">for</span> path <span class=\"string\">'apm-protocol/apm-network/src/main/proto'</span></span><br><span class=\"line\">Submodule <span class=\"string\">'oap-server/server-query-plugin/query-graphql-plugin/src/main/resources/query-protocol'</span> (https://github.com/apache/incubator-skywalking-query-protocol.git) registered <span class=\"keyword\">for</span> path <span class=\"string\">'oap-server/server-query-plugin/query-graphql-plugin/src/main/resources/query-protocol'</span></span><br><span class=\"line\">Submodule <span class=\"string\">'skywalking-ui'</span> (https://github.com/apache/incubator-skywalking-ui) registered <span class=\"keyword\">for</span> path <span class=\"string\">'skywalking-ui'</span></span><br><span class=\"line\">➜  skywalking git:(8b638258b) git submodule update</span><br><span class=\"line\">Cloning into <span class=\"string\">'/Users/zengqingfeng/word/source-code/skywalking/apm-protocol/apm-network/src/main/proto'</span>...</span><br><span class=\"line\">Cloning into <span class=\"string\">'/Users/zengqingfeng/word/source-code/skywalking/oap-server/server-query-plugin/query-graphql-plugin/src/main/resources/query-protocol'</span>...</span><br><span class=\"line\">Cloning into <span class=\"string\">'/Users/zengqingfeng/word/source-code/skywalking/skywalking-ui'</span>...</span><br><span class=\"line\">Submodule path <span class=\"string\">'apm-protocol/apm-network/src/main/proto'</span>: checked out <span class=\"string\">'b66fa070fd647662f06497e4ed3657eb258cb6e9'</span></span><br><span class=\"line\">Submodule path <span class=\"string\">'oap-server/server-query-plugin/query-graphql-plugin/src/main/resources/query-protocol'</span>: checked out <span class=\"string\">'c65a23bd6b9bba8d1df30d4de261624952df2b7b'</span></span><br><span class=\"line\">Submodule path <span class=\"string\">'skywalking-ui'</span>: checked out <span class=\"string\">'c44642f73b9f73a54b0d716cade5094304e1a67b'</span></span><br></pre></td></tr></table></figure>\n\n<p><code>clean package -DskipTests</code></p>\n<blockquote>\n<p>这个时候慢慢等吧v6.0.0-GA有120个子项目。更新完之后导入IDEA就好了。</p>\n</blockquote>\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["源码分析"]},{"title":"SpringBoot-Redis-Timeout-Error","url":"/posts/51185885/","content":"<blockquote>\n<p>最近在看项目的时候发现一个临时问题，就是redis.timeout设置0依然超时的问题。</p>\n</blockquote>\n<ul>\n<li>代码适用版本 <code>jedis:2.9.0</code> , <code>org.springframework.data.redis:1.8.1</code></li>\n</ul>\n<h3 id=\"timeout设置0的问题\"><a href=\"#timeout设置0的问题\" class=\"headerlink\" title=\"timeout设置0的问题\"></a>timeout设置0的问题</h3><blockquote>\n<p>spring.redis.timeout =0 如果设置成0 redis默认超时时间就是2秒. </p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Jedis/jedis-timeout-1.jpg\"></p>\n<blockquote>\n<p>根据debug发现设置0点时候依然是2000毫秒。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Jedis/jedis-timeout-2.jpg\"></p>\n<blockquote>\n<p>根据初始化方法找到的原因。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Jedis/jedis-timeout-3.png\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Jedis/jedis-timeout-4.png\"></p>\n<blockquote>\n<p>这里可以看到，当timeout设置0点时候不会被赋值。</p>\n</blockquote>\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["Redis"],"tags":["Redis","Java","Spring"]},{"title":"Grpc入门","url":"/posts/3210089193/","content":"<blockquote>\n<p>17年年底做的技术调研，文档好想没有写完。</p>\n</blockquote>\n<h2 id=\"gRPC\"><a href=\"#gRPC\" class=\"headerlink\" title=\"gRPC \"></a><a href=\"https://github.com/grpc/grpc\" target=\"_blank\" rel=\"noopener\">gRPC </a></h2><h3 id=\"流程概念\"><a href=\"#流程概念\" class=\"headerlink\" title=\"流程概念\"></a>流程概念</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Grpc/grpc-1.png\"></p>\n<h3 id=\"性能对比\"><a href=\"#性能对比\" class=\"headerlink\" title=\"性能对比\"></a>性能对比</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Grpc/grpc-2.png\"></p>\n<h3 id=\"谁在使用\"><a href=\"#谁在使用\" class=\"headerlink\" title=\"谁在使用\"></a>谁在使用</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Grpc/grpc-3.png\"></p>\n<a id=\"more\"></a>\n\n<h2 id=\"ProtoBuf\"><a href=\"#ProtoBuf\" class=\"headerlink\" title=\"ProtoBuf\"></a>ProtoBuf</h2><blockquote>\n<p>Protocol Buffers 是 google 的一种数据交换的格式，它独立于语言，独立于平台。google 提供了多种语言的实现：java、c#、c++、go、PHP 和 python，每一种实现都包含了相应语言的编译器以及库文件。由于它是一种二进制的格式，比使用 xml 进行数据交换快许多。可以把它用于分布式应用之间的数据通信或者异构环境下的数据交换。作为一种效率和兼容性都很优秀的二进制数据传输格式，可以用于诸如网络传输、配置文件、数据存储等诸多领域。</p>\n<p>至于protobuf是什么、使用场景、有什么好处，本文不做说明，这里将会为大家介绍怎么用 <code>protobuf</code> 来定义我们的交互协议，包括 <code>.proto</code> 的语法以及如何根据proto文件生成相应的代码。本文基于<a href=\"https://developers.google.com/protocol-buffers/docs/proto3\" target=\"_blank\" rel=\"noopener\">proto3</a>，读者也可以点击了解<a href=\"https://developers.google.com/protocol-buffers/docs/proto\" target=\"_blank\" rel=\"noopener\">proto2</a></p>\n</blockquote>\n<h2 id=\"proto3语法\"><a href=\"#proto3语法\" class=\"headerlink\" title=\"proto3语法\"></a>proto3语法</h2><h3 id=\"定义一个-Message\"><a href=\"#定义一个-Message\" class=\"headerlink\" title=\"定义一个 Message\"></a>定义一个 Message</h3><p>首先我们来定义一个 Search 请求，在这个请求里面，我们需要给服务端发送三个信息：</p>\n<ul>\n<li>query：查询条件</li>\n<li>page_number：你想要哪一页数据</li>\n<li>result_per_page：每一页有多少条数据</li>\n</ul>\n<p>于是我们可以这样定义：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 指定使用proto3，如果不指定的话，编译器会使用proto2去编译</span><br><span class=\"line\">syntax &#x3D; &quot;proto3&quot;; &#x2F;&#x2F;[proto2|proto3]</span><br><span class=\"line\"></span><br><span class=\"line\">message SearchRequests &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; 定义SearchRequests的成员变量，需要指定：变量类型、变量名、变量Tag</span><br><span class=\"line\">    string query &#x3D; 1;</span><br><span class=\"line\">    int32 page_number &#x3D; 2;</span><br><span class=\"line\">    int32 result_per_page &#x3D; 3;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"定义多个-message-类型\"><a href=\"#定义多个-message-类型\" class=\"headerlink\" title=\"定义多个 message 类型\"></a>定义多个 message 类型</h3><p>一个 proto 文件可以定义多个 message ，比如我们可以在刚才那个 proto 文件中把服务端返回的消息结构也一起定义：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">message SearchRequest &#123;</span><br><span class=\"line\">    string query &#x3D; 1;</span><br><span class=\"line\">    int32 page_number &#x3D; 2;</span><br><span class=\"line\">    int32 result_per_page &#x3D; 3;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">message SearchResponse &#123;</span><br><span class=\"line\">    repeated string result &#x3D; 1;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>message 可以嵌套定义，比如 message 可以定义在另一个 message 内部</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">message SearchResponse &#123;</span><br><span class=\"line\">    message Result &#123;</span><br><span class=\"line\">        string url &#x3D; 1;</span><br><span class=\"line\">        string title &#x3D; 2;</span><br><span class=\"line\">        repeated string snippets &#x3D; 3;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    repeated Result results &#x3D; 1;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>定义在 message 内部的 message 可以这样使用：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">message SomeOtherMessage &#123;</span><br><span class=\"line\">    SearchResponse.Result result &#x3D; 1;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"定义变量类型\"><a href=\"#定义变量类型\" class=\"headerlink\" title=\"定义变量类型\"></a>定义变量类型</h3><p>在刚才的例子之中，我们使用了2个<code>标准值类型</code>： string 和 int32，除了这些标准类型之外，变量的类型还可以是复杂类型，比如自定义的<code>枚举</code>和自定义的 <code>message</code></p>\n<p>这里我们把标准类型列举一下protobuf内置的标准类型以及跟各平台对应的关系：</p>\n<table>\n<thead>\n<tr>\n<th>.proto</th>\n<th>说明</th>\n<th>Java</th>\n<th>Python</th>\n<th>Go</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>double</td>\n<td></td>\n<td>double</td>\n<td>float</td>\n<td>float64</td>\n</tr>\n<tr>\n<td>float</td>\n<td></td>\n<td>float</td>\n<td>float</td>\n<td>float32</td>\n</tr>\n<tr>\n<td>int32</td>\n<td>使用变长编码，对负数编码效率低，如果你的变量可能是负数，可以使用sint32</td>\n<td>int</td>\n<td>int</td>\n<td>int32</td>\n</tr>\n<tr>\n<td>int64</td>\n<td>使用变长编码，对负数编码效率低，如果你的变量可能是负数，可以使用sint64</td>\n<td>long</td>\n<td>int/long</td>\n<td>int64</td>\n</tr>\n<tr>\n<td>uint32</td>\n<td>使用变长编码</td>\n<td>int</td>\n<td>int/long</td>\n<td>uint32</td>\n</tr>\n<tr>\n<td>uint64</td>\n<td>使用变长编码</td>\n<td>long</td>\n<td>int/long</td>\n<td>uint64</td>\n</tr>\n<tr>\n<td>sint32</td>\n<td>使用变长编码，带符号的int类型，对负数编码比int32高效</td>\n<td>int</td>\n<td>int</td>\n<td>int32</td>\n</tr>\n<tr>\n<td>sint64</td>\n<td>使用变长编码，带符号的int类型，对负数编码比int64高效</td>\n<td>long</td>\n<td>int/long</td>\n<td>int64</td>\n</tr>\n<tr>\n<td>fixed32</td>\n<td>4字节编码， 如果变量经常大于228 的话，会比uint32高效</td>\n<td>int</td>\n<td>int</td>\n<td>int32</td>\n</tr>\n<tr>\n<td>fixed64</td>\n<td>8字节编码， 如果变量经常大于256 的话，会比uint64高效</td>\n<td>long</td>\n<td>int/long</td>\n<td>uint64</td>\n</tr>\n<tr>\n<td>sfixed32</td>\n<td>4字节编码</td>\n<td>int</td>\n<td>int</td>\n<td>int32</td>\n</tr>\n<tr>\n<td>sfixed64</td>\n<td>8字节编码</td>\n<td>long</td>\n<td>int/long</td>\n<td>int64</td>\n</tr>\n<tr>\n<td>bool</td>\n<td></td>\n<td>boolean</td>\n<td>bool</td>\n<td>bool</td>\n</tr>\n<tr>\n<td>string</td>\n<td>必须包含utf-8编码或者7-bit ASCII text</td>\n<td>String</td>\n<td>str/unicode</td>\n<td>string</td>\n</tr>\n<tr>\n<td>bytes</td>\n<td>任意的字节序列</td>\n<td>ByteString</td>\n<td>str</td>\n<td>[]byte</td>\n</tr>\n</tbody></table>\n<p>补充说明：</p>\n<ul>\n<li>In Java, unsigned 32-bit and 64-bit integers are represented using their signed counterparts, with the top bit simply being stored in the sign bit.</li>\n<li>In all cases, setting values to a field will perform type checking to make sure it is valid.</li>\n<li>64-bit or unsigned 32-bit integers are always represented as long when decoded, but can be an int if an int is given when setting the field. In all cases, the value must fit in the type represented when set. See <a href=\"https://developers.google.com/protocol-buffers/docs/proto\" target=\"_blank\" rel=\"noopener\">2</a>.</li>\n<li>Python strings are represented as unicode on decode but can be str if an ASCII string is given (this is subject to change).</li>\n<li>Integer is used on 64-bit machines and string is used on 32-bit machines.</li>\n</ul>\n<p>关于标准值类型，还可以参考<a href=\"https://developers.google.com/protocol-buffers/docs/proto3#scalar\" target=\"_blank\" rel=\"noopener\">Scalar Value Types</a></p>\n<p>如果你想了解这些数据是怎么序列化和反序列化的，可以点击 <a href=\"https://developers.google.com/protocol-buffers/docs/encoding\" target=\"_blank\" rel=\"noopener\">Protocol Buffer Encoding</a> 了解更多关于protobuf编码内容。</p>\n<h3 id=\"分配Tag\"><a href=\"#分配Tag\" class=\"headerlink\" title=\"分配Tag\"></a>分配Tag</h3><p>每一个变量在message内都需要自定义一个<strong>唯一的数字Tag</strong>，protobuf会根据Tag从数据中查找变量对应的位置，具体原理跟protobuf的<a href=\"https://developers.google.com/protocol-buffers/docs/encoding\" target=\"_blank\" rel=\"noopener\">二进制数据格式</a>有关。Tag一旦指定，以后更新协议的时候也不能修改，否则无法对旧版本兼容。</p>\n<p>Tag的取值范围最小是1，最大是229-1，但 19000~19999 是 protobuf 预留的，用户不能使用。</p>\n<p>虽然 Tag 的定义范围比较大，但不同 Tag 也会对 protobuf 编码带来一些影响：</p>\n<ul>\n<li>1 ~ 15：单字节编码</li>\n<li>16 ~ 2047：双字节编码</li>\n</ul>\n<p>使用频率高的变量最好设置为1 ~ 15，这样可以减少编码后的数据大小，但由于Tag一旦指定不能修改，所以为了以后扩展，也记得为未来保留一些 1 ~ 15 的 Tag</p>\n<h3 id=\"指定变量规则\"><a href=\"#指定变量规则\" class=\"headerlink\" title=\"指定变量规则\"></a>指定变量规则</h3><p>在 proto3 中，可以给变量指定以下两个规则：</p>\n<ul>\n<li><code>singular</code>：0或者1个，但不能多于1个</li>\n<li><code>repeated</code>：任意数量（包括0）</li>\n</ul>\n<p>当构建 message 的时候，build 数据的时候，会检测设置的数据跟规则是否匹配</p>\n<p>在proto2中，规则为：</p>\n<ul>\n<li>required：必须有一个</li>\n<li>optional：0或者1个</li>\n<li>repeated：任意数量（包括0）</li>\n</ul>\n<h3 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h3><p>用<code>//</code>表示注释开头，如</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">message SearchRequest &#123;</span><br><span class=\"line\">    string query &#x3D; 1;</span><br><span class=\"line\">    int32 page_number &#x3D; 2; &#x2F;&#x2F; Which page number do we want</span><br><span class=\"line\">    int32 result_per_page &#x3D; 3; &#x2F;&#x2F; Number of results to return per page</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"保留变量不被使用\"><a href=\"#保留变量不被使用\" class=\"headerlink\" title=\"保留变量不被使用\"></a>保留变量不被使用</h3><p>上面我们说到，一旦 Tag 指定后就不能变更，这就会带来一个问题，假如在版本1的协议中，我们有个变量：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">int32 number &#x3D; 1；</span><br></pre></td></tr></table></figure>\n\n<p>在版本2中，我们决定废弃对它的使用，那我们应该如何修改协议呢？注释掉它？删除掉它？如果把它删除了，后来者很可能在定义新变量的时候，使新的变量 Tag = 1 ，这样会导致协议不兼容。那有没有办法规避这个问题呢？我们可以用 <code>reserved</code> 关键字，当一个变量不再使用的时候，我们可以把它的变量名或 Tag 用 <code>reserved</code> 标注，这样，当这个 Tag 或者变量名字被重新使用的时候，编译器会报错</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">message Foo &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; 注意，同一个 reserved 语句不能同时包含变量名和 Tag </span><br><span class=\"line\">    reserved 2, 15, 9 to 11;</span><br><span class=\"line\">    reserved &quot;foo&quot;, &quot;bar&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"默认值\"><a href=\"#默认值\" class=\"headerlink\" title=\"默认值\"></a>默认值</h3><p>当解析 message 时，如果被编码的 message 里没有包含某些变量，那么根据类型不同，他们会有不同的默认值：</p>\n<ul>\n<li>string：默认是空的字符串</li>\n<li>byte：默认是空的bytes</li>\n<li>bool：默认为false</li>\n<li>numeric：默认为0</li>\n<li>enums：定义在第一位的枚举值，也就是0</li>\n<li>messages：根据生成的不同语言有不同的表现，参考<a href=\"https://developers.google.com/protocol-buffers/docs/reference/overview\" target=\"_blank\" rel=\"noopener\">generated code guide</a></li>\n</ul>\n<p>注意，收到数据后反序列化后，对于标准值类型的数据，比如bool，如果它的值是 false，那么我们无法判断这个值是对方设置的，还是对方压根就没给这个变量设置值。</p>\n<h3 id=\"定义枚举-Enumerations\"><a href=\"#定义枚举-Enumerations\" class=\"headerlink\" title=\"定义枚举 Enumerations\"></a>定义枚举 Enumerations</h3><p>在 protobuf 中，我们也可以定义枚举，并且使用该枚举类型，比如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">message SearchRequest &#123;</span><br><span class=\"line\">    string query &#x3D; 1;</span><br><span class=\"line\">    int32 page_number &#x3D; 2; &#x2F;&#x2F; Which page number do we want</span><br><span class=\"line\">    int32 result_per_page &#x3D; 3; &#x2F;&#x2F; Number of results to return per page</span><br><span class=\"line\">    enum Corpus &#123;</span><br><span class=\"line\">        UNIVERSAL &#x3D; 0;</span><br><span class=\"line\">        WEB &#x3D; 1;</span><br><span class=\"line\">        IMAGES &#x3D; 2;</span><br><span class=\"line\">        LOCAL &#x3D; 3;</span><br><span class=\"line\">        NEWS &#x3D; 4;</span><br><span class=\"line\">        PRODUCTS &#x3D; 5;</span><br><span class=\"line\">        VIDEO &#x3D; 6;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Corpus corpus &#x3D; 4;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>枚举定义在一个消息内部或消息外部都是可以的，如果枚举是 定义在 message 内部，而其他 message 又想使用，那么可以通过 <code>MessageType.EnumType</code> 的方式引用。定义枚举的时候，我们要保证<strong>第一个枚举值必须是0</strong>，枚举值不能重复，除非使用 <code>option allow_alias = true</code> 选项来开启别名。如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">enum EnumAllowingAlias &#123;</span><br><span class=\"line\">    option allow_alias &#x3D; true;</span><br><span class=\"line\">    UNKNOWN &#x3D; 0;</span><br><span class=\"line\">    STARTED &#x3D; 1;</span><br><span class=\"line\">    RUNNING &#x3D; 1;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>枚举值的范围是32-bit integer，但因为枚举值使用变长编码，所以不推荐使用负数作为枚举值，因为这会带来效率问题。</p>\n<h3 id=\"如何引用其他-proto-文件\"><a href=\"#如何引用其他-proto-文件\" class=\"headerlink\" title=\"如何引用其他 proto 文件\"></a>如何引用其他 proto 文件</h3><p>在proto语法中，有两种引用其他 proto 文件的方法： <code>import</code> 和 <code>import public</code>，这两者有什么区别呢？下面举个例子说明：<br><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Grpc/grpc-4.png\" alt=\"这里写图片描述\"></p>\n<ul>\n<li>在情景1中， my.proto <strong>不能</strong>使用 second.proto 中定义的内容</li>\n<li>在情景2中， my.proto <strong>可以</strong>使用 second.proto 中定义的内容</li>\n<li>情景1和情景2中，my.proto 都可以使用 first.proto</li>\n<li>情景1和情景2中，first.proto 都可以使用 second.proto</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; my.proto</span><br><span class=\"line\">import &quot;first.proto&quot;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; first.proto</span><br><span class=\"line\">&#x2F;&#x2F;import &quot;second.proto&quot;;</span><br><span class=\"line\">import public &quot;second.proto&quot;;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; second.proto</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"升级-proto-文件正确的姿势\"><a href=\"#升级-proto-文件正确的姿势\" class=\"headerlink\" title=\"升级 proto 文件正确的姿势\"></a>升级 proto 文件正确的姿势</h3><p>升级更改 proto 需要遵循以下原则</p>\n<ul>\n<li>不要修改任何已存在的变量的 Tag</li>\n<li>如果你新增了变量，新生成的代码依然能解析旧的数据，但新增的变量将会变成默认值。相应的，新代码序列化的数据也能被旧的代码解析，但旧代码会自动忽略新增的变量。</li>\n<li>废弃不用的变量用 reserved 标注</li>\n<li>int32、 uint32、 int64、 uint64 和 bool 是相互兼容的，这意味你可以更改这些变量的类型而不会影响兼容性</li>\n<li>sint32 和 sint64 是兼容的，但跟其他类型不兼容</li>\n<li>string 和 bytes 可以兼容，前提是他们都是UTF-8编码的数据</li>\n<li>fixed32 和 sfixed32 是兼容的, fixed64 和 sfixed64是兼容的</li>\n</ul>\n<h3 id=\"Any-的使用\"><a href=\"#Any-的使用\" class=\"headerlink\" title=\"Any 的使用\"></a>Any 的使用</h3><p>Any可以让你在 proto 文件中使用未定义的类型，具体里面保存什么数据，是在上层业务代码使用的时候决定的，使用 Any 必须导入 <code>import google/protobuf/any.proto</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">import &quot;google&#x2F;protobuf&#x2F;any.proto&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">message ErrorStatus &#123;</span><br><span class=\"line\">    string message &#x3D; 1;</span><br><span class=\"line\">    repeated google.protobuf.Any details &#x3D; 2;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Oneof-的使用\"><a href=\"#Oneof-的使用\" class=\"headerlink\" title=\"Oneof 的使用\"></a>Oneof 的使用</h3><p>Oneof 类似union，如果你的消息中有很多可选字段，而同一个时刻最多仅有其中的一个字段被设置的话，你可以使用oneof来强化这个特性并且节约存储空间，如</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">message LoginReply &#123;</span><br><span class=\"line\">    oneof test_oneof &#123;</span><br><span class=\"line\">        string name &#x3D; 3;</span><br><span class=\"line\">        string age &#x3D; 4;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    required string status &#x3D; 1;</span><br><span class=\"line\">    required string token &#x3D; 2;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这样，name 和 age 都是 LoginReply 的成员，但不能给他们同时设置值（设置一个oneof字段会自动清理其他的oneof字段）。</p>\n<h3 id=\"Maps-的使用\"><a href=\"#Maps-的使用\" class=\"headerlink\" title=\"Maps 的使用\"></a>Maps 的使用</h3><p>protobuf 支持定义 map 类型的成员，如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">map&lt;key_type, value_type&gt; map_field &#x3D; N;</span><br><span class=\"line\">&#x2F;&#x2F; 举例：map&lt;string, Project&gt; projects &#x3D; 3;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>key_type:必须是string或者int</li>\n<li>value_type：任意类型</li>\n</ul>\n<p>使用 map 要注意：</p>\n<ul>\n<li>Map 类型不能使 repeated</li>\n<li>Map 是无序的</li>\n<li>以文本格式展示时，Map 以 key 来排序</li>\n<li>如果有相同的键会导致解析失败</li>\n</ul>\n<h3 id=\"Packages-的使用\"><a href=\"#Packages-的使用\" class=\"headerlink\" title=\"Packages 的使用\"></a>Packages 的使用</h3><p>为了防止不同消息之间的命名冲突，你可以对特定的.proto文件提指定 package 名字。在定义消息的成员的时候，可以指定包的名字：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">package foo.bar;</span><br><span class=\"line\">message Open &#123; ... &#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">message Foo &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    &#x2F;&#x2F; 带上包名</span><br><span class=\"line\">    foo.bar.Open open &#x3D; 1;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Options\"><a href=\"#Options\" class=\"headerlink\" title=\"Options\"></a>Options</h2><p>Options 分为 file-level options（只能出现在最顶层，不能在消息、枚举、服务内部使用）、 message-level options（只能在消息内部使用）、field-level options（只能在变量定义时使用）</p>\n<ul>\n<li>java_package (file option)：指定生成类的包名，如果没有指定此选项，将由关键字package指定包名。此选项只在生成 java 代码时有效</li>\n<li>java_multiple_files (file option)：如果为 true， 定义在最外层的 message 、enum、service 将作为单独的类存在</li>\n<li>java_outer_classname (file option)：指定最外层class的类名，如果不指定，将会以文件名作为类名</li>\n<li>optimize_for (file option)：可选有 [SPEED|CODE_SIZE|LITE_RUNTIME] ，分别是效率优先、空间优先，第三个lite是兼顾效率和代码大小，但是运行时需要依赖 libprotobuf-lite</li>\n<li>cc_enable_arenas (file option):启动arena allocation，c++代码使用</li>\n<li>objc_class_prefix (file option)：Objective-C使用</li>\n<li>deprecated (field option)：提示变量已废弃、不建议使用</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">option java_package &#x3D; &quot;com.example.foo&quot;;</span><br><span class=\"line\">option java_multiple_files &#x3D; true;</span><br><span class=\"line\">option java_outer_classname &#x3D; &quot;Ponycopter&quot;;</span><br><span class=\"line\">option optimize_for &#x3D; CODE_SIZE;</span><br><span class=\"line\">int32 old_field &#x3D; 6 [deprecated&#x3D;true];</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"定义-Services\"><a href=\"#定义-Services\" class=\"headerlink\" title=\"定义 Services\"></a>定义 Services</h2><p>这个其实和gRPC相关，详细可参考：<a href=\"http://www.grpc.io/\" target=\"_blank\" rel=\"noopener\">gRPC</a>， 这里做一个简单的介绍<br>要定义一个服务，你必须在你的 .proto 文件中指定 <code>service</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">service RouteGuide &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后在我们的服务中定义 <code>rpc</code> 方法，指定它们的请求的和响应类型。<code>gRPC</code> 允许你定义4种类型的 service 方法</p>\n<h2 id=\"简单RPC\"><a href=\"#简单RPC\" class=\"headerlink\" title=\"简单RPC\"></a>简单RPC</h2><p>客户端使用 Stub 发送请求到服务器并等待响应返回，就像平常的函数调用一样，这是一个阻塞型的调用</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; Obtains the feature at a given position.</span><br><span class=\"line\">rpc GetFeature(Point) returns (Feature) &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"服务器端流式-RPC\"><a href=\"#服务器端流式-RPC\" class=\"headerlink\" title=\"服务器端流式 RPC\"></a>服务器端流式 RPC</h2><p>客户端发送请求到服务器，拿到一个流去读取返回的消息序列。客户端读取返回的流，直到里面没有任何消息。从例子中可以看出，通过在响应类型前插入 <code>stream</code> 关键字，可以指定一个服务器端的流方法</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; Obtains the Features available within the given Rectangle.  Results are</span><br><span class=\"line\">&#x2F;&#x2F; streamed rather than returned at once (e.g. in a response message with a</span><br><span class=\"line\">&#x2F;&#x2F; repeated field), as the rectangle may cover a large area and contain a</span><br><span class=\"line\">&#x2F;&#x2F; huge number of features.</span><br><span class=\"line\">rpc ListFeatures(Rectangle) returns (stream Feature) &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"客户端流式-RPC\"><a href=\"#客户端流式-RPC\" class=\"headerlink\" title=\"客户端流式 RPC\"></a>客户端流式 RPC</h2><p>客户端写入一个消息序列并将其发送到服务器，同样也是使用流。一旦客户端完成写入消息，它等待服务器完成读取返回它的响应。通过在请求类型前指定 <code>stream</code> 关键字来指定一个客户端的流方法</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; Accepts a stream of Points on a route being traversed, returning a</span><br><span class=\"line\">&#x2F;&#x2F; RouteSummary when traversal is completed.</span><br><span class=\"line\">rpc RecordRoute(stream Point) returns (RouteSummary) &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"双向流式-RPC\"><a href=\"#双向流式-RPC\" class=\"headerlink\" title=\"双向流式 RPC\"></a>双向流式 RPC</h2><p>双方使用读写流去发送一个消息序列。两个流独立操作，因此客户端和服务器可以以任意喜欢的顺序读写：比如， 服务器可以在写入响应前等待接收所有的客户端消息，或者可以交替的读取和写入消息，或者其他读写的组合。每个流中的消息顺序被预留。你可以通过在请求和响应前加 <code>stream</code> 关键字去制定方法的类型</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; Accepts a stream of RouteNotes sent while a route is being traversed,</span><br><span class=\"line\">&#x2F;&#x2F; while receiving other RouteNotes (e.g. from other users).</span><br><span class=\"line\">rpc RouteChat(stream RouteNote) returns (stream RouteNote) &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"代码生成\"><a href=\"#代码生成\" class=\"headerlink\" title=\"代码生成\"></a>代码生成</h2><p>使用 <code>protoc</code> 工具可以把编写好的 <code>proto</code> 文件“编译”为Java, Python, C++, Go, Ruby, JavaNano, Objective-C,或C#代码， <code>protoc</code> 可以从<a href=\"https://developers.google.com/protocol-buffers/docs/downloads\" target=\"_blank\" rel=\"noopener\">点击这里</a>进行下载。<code>protoc</code> 的使用方式如下：</p>\n<blockquote>\n<p> GitHub: tags地址 <a href=\"https://github.com/protocolbuffers/protobuf/tags\" target=\"_blank\" rel=\"noopener\">https://github.com/protocolbuffers/protobuf/tags</a></p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">protoc --proto_path=IMPORT_PATH --cpp_out=DST_DIR --java_out=DST_DIR --python_out=DST_DIR --go_out=DST_DIR --ruby_out=DST_DIR --javanano_out=DST_DIR --objc_out=DST_DIR --csharp_out=DST_DIR path/to/file.proto1</span><br></pre></td></tr></table></figure>\n\n<p>参数说明：</p>\n<ul>\n<li>IMPORT_PATH：指定 proto 文件的路径，如果没有指定， protoc 会从当前目录搜索对应的 proto 文件，如果有多个路径，那么可以指定多次<code>--proto_path</code></li>\n<li>指定各语言代码的输出路径<ul>\n<li>–cpp_out：生成c++代码</li>\n<li>java_out ：生成java代码</li>\n<li>python_out ：生成python代码</li>\n<li>go_out ：生成go代码</li>\n<li>ruby_out ：生成ruby代码</li>\n<li>javanano_out ：适合运行在有资源限制的平台（如Android）的java代码</li>\n<li>objc_out ：生成 Objective-C代码</li>\n<li>csharp_out ：生成C#代码</li>\n<li>php_out ：生成PHP代码</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h3><ul>\n<li><a href=\"https://www.ibm.com/developerworks/cn/linux/l-cn-gpb/index.html\" target=\"_blank\" rel=\"noopener\">IMB Google Protocol Buffer 的使用和原理</a></li>\n<li><a href=\"http://doc.oschina.net/grpc?t=57966\" target=\"_blank\" rel=\"noopener\">osChina gRPC 官方文档翻译</a></li>\n<li><a href=\"https://www.cnblogs.com/shitouer/archive/2013/04/10/google-protocol-buffers-tutorial.html\" target=\"_blank\" rel=\"noopener\">cnblogs Protocol Buffers</a></li>\n</ul>\n","categories":["入门"],"tags":["Grpc","ProtoBuf"]},{"title":"Arthas入门","url":"/posts/3713561999/","content":"<blockquote>\n<p>基础理论篇学习笔记</p>\n</blockquote>\n<h2 id=\"Arthas（阿尔萨斯）-能为你做什么？\"><a href=\"#Arthas（阿尔萨斯）-能为你做什么？\" class=\"headerlink\" title=\"Arthas（阿尔萨斯） 能为你做什么？\"></a>Arthas（阿尔萨斯） 能为你做什么？</h2><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://alibaba.github.io/arthas/_images/arthas.png\" alt=\"arthas\"></p>\n<p><code>Arthas</code> 是Alibaba开源的Java诊断工具，深受开发者喜爱。</p>\n<p>当你遇到以下类似问题而束手无策时，<code>Arthas</code>可以帮助你解决：</p>\n<ol>\n<li>这个类从哪个 jar 包加载的？为什么会报各种类相关的 Exception？</li>\n<li>我改的代码为什么没有执行到？难道是我没 commit？分支搞错了？</li>\n<li>遇到问题无法在线上 debug，难道只能通过加日志再重新发布吗？</li>\n<li>线上遇到某个用户的数据处理有问题，但线上同样无法 debug，线下无法重现！</li>\n<li>是否有一个全局视角来查看系统的运行状况？</li>\n<li>有什么办法可以监控到JVM的实时运行状态？</li>\n</ol>\n<p><code>Arthas</code>支持JDK 6+，支持Linux/Mac/Winodws，采用命令行交互模式，同时提供丰富的 <code>Tab</code> 自动补全功能，进一步方便进行问题的定位和诊断。</p>\n<h3 id=\"快速入门\"><a href=\"#快速入门\" class=\"headerlink\" title=\"快速入门\"></a>快速入门</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget https://alibaba.github.io/arthas/arthas-boot.jar</span><br><span class=\"line\">java -jar arthas-boot.jar</span><br></pre></td></tr></table></figure>\n\n<p>打印帮助信息</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">java -jar arthas-boot.jar -h</span><br></pre></td></tr></table></figure>\n\n<p>快速启动(使用国内阿里下载包)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">java -jar arthas-boot.jar --repo-mirror aliyun</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Arthas/arthas-up-01.png\"></p>\n<ul>\n<li>如果当前没有java程序运行则提示这个内容，并且不会被正常启动。</li>\n</ul>\n<p>demo程序作为演示</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">https://github.com/hengyunabc/spring-boot-inside</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>运行效果</li>\n</ul>\n<blockquote>\n<p>我们先运行一个demo，然后让arthas运行起来。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> spring-boot-inside // 进入文件夹</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> demo-arthas-spring-boot // 进入demo项目</span><br><span class=\"line\"></span><br><span class=\"line\">mvn clean install  // 构建项目</span><br><span class=\"line\"></span><br><span class=\"line\">java -jar demo-arthas-spring-boot-0.0.1-SNAPSHOT.jar  // 启动项目</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>启动项目之后在运行arthas</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">java -jar arthas-boot.jar</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Arthas/arthas-up-02.png\"></p>\n<blockquote>\n<p>如果已经有启动的项目,会提示 [1] project-name 这种。输入数字选择对应的项目即可。</p>\n</blockquote>\n<p>END</p>\n","categories":["入门"],"tags":["Java","Arthas"]},{"title":"Redis-Cache-Breakdown","url":"/posts/3752509203/","content":"<blockquote>\n<p>关于Redis场景下简单的处理方式。</p>\n</blockquote>\n<p><a href=\"https://github.com/z201/code-example/tree/main/Redis-Cache-Breakdown\" target=\"_blank\" rel=\"noopener\">源码地址</a></p>\n<h3 id=\"缓存穿透和缓存击穿\"><a href=\"#缓存穿透和缓存击穿\" class=\"headerlink\" title=\"缓存穿透和缓存击穿\"></a>缓存穿透和缓存击穿</h3><ul>\n<li>缓存穿透是指用户查询数据，在数据库没有，自然在缓存中也不会有。这样就导致用户查询的时候，在缓存中找不到，每次都要去数据库再查询一遍，然后返回空（相当于进行了两次无用的查询）。这样请求就绕过缓存直接查数据库，这也是经常提的缓存命中率问题。</li>\n<li>解决办法<ul>\n<li><strong>缓存空对象</strong>：代码维护较简单，但是效果不好。不过部分场景能使用</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"演示环境\"><a href=\"#演示环境\" class=\"headerlink\" title=\"演示环境\"></a>演示环境</h3><ul>\n<li>spring boot 2.4.5</li>\n<li>mysql</li>\n<li>Redis</li>\n<li>测试环境采用docker-compose</li>\n</ul>\n<h4 id=\"缓存穿透\"><a href=\"#缓存穿透\" class=\"headerlink\" title=\"缓存穿透\"></a>缓存穿透</h4><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF/%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98.svg\"></p>\n<ul>\n<li>理想的情况下我们数据缓存到redis里面，客户访问数据的时候直接去缓存查询，如果没有缓存就去数据库查询。</li>\n<li>仔细想想这里其实有一个bug，必须是缓存有的数据才会去数据库查询，如果一直都是在查询一个没有得数据咋办呢，缓存会一直落空，而且每次都会去数据库查询。</li>\n</ul>\n<h4 id=\"缓存击穿\"><a href=\"#缓存击穿\" class=\"headerlink\" title=\"缓存击穿\"></a>缓存击穿</h4><blockquote>\n<p>这个场景更多是应用在多线程的环境，这里衔接上面的代码，当并发量上来的时候，大量的查询集中查询某一个key，若这个时候key刚好失效了，就会导致请求全部进入数据中。这个就是所谓的缓存击穿。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF/%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98-%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF.svg\"></p>\n<h4 id=\"常用解决思路\"><a href=\"#常用解决思路\" class=\"headerlink\" title=\"常用解决思路\"></a>常用解决思路</h4><blockquote>\n<p>这里注意列举常用方案，根据实际情况使用</p>\n</blockquote>\n<h4 id=\"空值缓存\"><a href=\"#空值缓存\" class=\"headerlink\" title=\"空值缓存\"></a>空值缓存</h4><blockquote>\n<p>在访问缓存key之前，设置另一个短期key来锁住当前key的访问。这个方案可以降低持续缓存落空的情况。至少数据库被穿透的概率小很多了。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF/%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98-%E7%A9%BA%E5%80%BC%E7%BC%93%E5%AD%98.svg\"></p>\n<ul>\n<li>Redis方案<ul>\n<li>如上图所示，当缓存和数据库中都没找到的时候就将查询条件作为key并在缓存中插入一个空的数据，并指定好过期时间。这样下次的请求就会被缓存命中。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h4><a id=\"more\"></a>\n\n<h3 id=\"项目结构\"><a href=\"#项目结构\" class=\"headerlink\" title=\"项目结构\"></a>项目结构</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">.</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">docker-compose.yml</span> <span class=\"comment\"># docker-compose 配置文件</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">docker-config</span></span><br><span class=\"line\"><span class=\"string\">│</span>   <span class=\"string\">├──</span> <span class=\"string\">mysql</span></span><br><span class=\"line\"><span class=\"string\">│</span>   <span class=\"string\">│</span>   <span class=\"string\">├──</span> <span class=\"string\">init</span></span><br><span class=\"line\"><span class=\"string\">│</span>   <span class=\"string\">│</span>   <span class=\"string\">│</span>   <span class=\"string\">└──</span> <span class=\"string\">1_init.sql</span> <span class=\"comment\"># 初始化测试库</span></span><br><span class=\"line\"><span class=\"string\">│</span>   <span class=\"string\">│</span>   <span class=\"string\">└──</span> <span class=\"string\">my.cnf</span></span><br><span class=\"line\"><span class=\"string\">│</span>   <span class=\"string\">├──</span> <span class=\"string\">pwd.txt</span></span><br><span class=\"line\"><span class=\"string\">│</span>   <span class=\"string\">└──</span> <span class=\"string\">redis</span></span><br><span class=\"line\"><span class=\"string\">│</span>       <span class=\"string\">└──</span> <span class=\"string\">redis.conf</span></span><br><span class=\"line\"><span class=\"string\">├──</span> <span class=\"string\">pom.xml</span></span><br><span class=\"line\"><span class=\"string\">└──</span> <span class=\"string\">src</span></span><br><span class=\"line\">    <span class=\"string\">├──</span> <span class=\"string\">main</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">├──</span> <span class=\"string\">java</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>   <span class=\"string\">└──</span> <span class=\"string\">cn</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>       <span class=\"string\">└──</span> <span class=\"string\">z201</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>           <span class=\"string\">└──</span> <span class=\"string\">redis</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>               <span class=\"string\">├──</span> <span class=\"string\">AppApplication.java</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>               <span class=\"string\">├──</span> <span class=\"string\">AppApplicationController.java</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>               <span class=\"string\">├──</span> <span class=\"string\">AppApplicationServiceImpl.java</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">│</span>               <span class=\"string\">└──</span> <span class=\"string\">RedisConfig.java</span></span><br><span class=\"line\">    <span class=\"string\">│</span>   <span class=\"string\">└──</span> <span class=\"string\">resources</span></span><br><span class=\"line\">    <span class=\"string\">│</span>       <span class=\"string\">├──</span> <span class=\"string\">application-dev.yml</span></span><br><span class=\"line\">    <span class=\"string\">│</span>       <span class=\"string\">├──</span> <span class=\"string\">application-test.yml</span></span><br><span class=\"line\">    <span class=\"string\">│</span>       <span class=\"string\">├──</span> <span class=\"string\">application.yml</span></span><br><span class=\"line\">    <span class=\"string\">│</span>       <span class=\"string\">└──</span> <span class=\"string\">logback.xml</span></span><br><span class=\"line\">    <span class=\"string\">└──</span> <span class=\"string\">test</span></span><br><span class=\"line\">        <span class=\"string\">└──</span> <span class=\"string\">java</span></span><br><span class=\"line\">            <span class=\"string\">└──</span> <span class=\"string\">cn</span></span><br><span class=\"line\">                <span class=\"string\">└──</span> <span class=\"string\">z201</span></span><br><span class=\"line\">                    <span class=\"string\">└──</span> <span class=\"string\">redis</span></span><br><span class=\"line\">                        <span class=\"string\">└──</span> <span class=\"string\">AppApplicationTest.java</span> <span class=\"comment\"># 单元测试</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Docker-compose配置文件\"><a href=\"#Docker-compose配置文件\" class=\"headerlink\" title=\"Docker-compose配置文件\"></a>Docker-compose配置文件</h3><figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version :</span> <span class=\"string\">'3'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">networks:</span></span><br><span class=\"line\">  <span class=\"attr\">network-redis-cache-breakdown:</span></span><br><span class=\"line\">    <span class=\"attr\">driver:</span> <span class=\"string\">bridge</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">web:</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">cn.z201.docker-redis-cache-breakdown</span></span><br><span class=\"line\">    <span class=\"attr\">build:</span></span><br><span class=\"line\">      <span class=\"attr\">context:</span> <span class=\"string\">.</span></span><br><span class=\"line\">      <span class=\"attr\">dockerfile:</span> <span class=\"string\">.</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">cn.z201.docker-redis-cache-breakdown</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">network-redis-cache-breakdown</span></span><br><span class=\"line\">    <span class=\"attr\">expose:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'9001'</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'9001:9001'</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span> <span class=\"comment\"># 等待其它服务启动完成</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">mysql</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis</span></span><br><span class=\"line\">    <span class=\"attr\">links:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">mysql</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis</span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> <span class=\"string\">\"/bin/netstat -anpt|grep 9001\"</span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">3s</span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">mysql:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">mysql:5.7</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">mysql5.7-dev-5</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">network-redis-cache-breakdown</span></span><br><span class=\"line\">    <span class=\"attr\">expose:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'3306'</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'3306:3306'</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./docker-config/mysql/my.cnf:/etc/mysql/my.cnf</span> <span class=\"comment\"># 映射数据库配置文件</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./docker-config/mysql/init:/docker-entrypoint-initdb.d</span> <span class=\"comment\"># 初始化数据库</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">[</span></span><br><span class=\"line\">      <span class=\"string\">'--character-set-server=utf8mb4'</span><span class=\"string\">,</span></span><br><span class=\"line\">      <span class=\"string\">'--collation-server=utf8mb4_unicode_ci'</span><span class=\"string\">,</span></span><br><span class=\"line\">      <span class=\"string\">'--lower_case_table_names=1'</span><span class=\"string\">,</span></span><br><span class=\"line\">      <span class=\"string\">'--default-time-zone=+8:00'</span><span class=\"string\">]</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">MYSQL_ROOT_PASSWORD=root</span> <span class=\"comment\"># 设置root密码</span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> <span class=\"string\">\"/bin/netstat -anpt|grep 3306\"</span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">3s</span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">redis:5.0.5</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">redis5.0.6-dev-5</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">network-redis-cache-breakdown</span></span><br><span class=\"line\">    <span class=\"attr\">expose:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'6379'</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">'6379:6379'</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">./docker-config/redis/redis.conf:/etc/redis.conf</span> <span class=\"comment\"># 映射数据库配置文件</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">redis-server</span> <span class=\"string\">/etc/redis.conf</span> <span class=\"comment\"># 启动redis命令</span></span><br><span class=\"line\">    <span class=\"attr\">healthcheck:</span></span><br><span class=\"line\">      <span class=\"attr\">test:</span> <span class=\"string\">\"/bin/netstat -anpt|grep 6379\"</span></span><br><span class=\"line\">      <span class=\"attr\">interval:</span> <span class=\"string\">30s</span></span><br><span class=\"line\">      <span class=\"attr\">timeout:</span> <span class=\"string\">3s</span></span><br><span class=\"line\">      <span class=\"attr\">retries:</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"工具类\"><a href=\"#工具类\" class=\"headerlink\" title=\"工具类\"></a>工具类</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.redis;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.gson.Gson;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.gson.GsonBuilder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.util.CollectionUtils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.time.Duration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppApplicationServiceImpl</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String INFO = <span class=\"string\">\"INFO:\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String LOCK_PREFIX = <span class=\"string\">\"LOCK:P\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> JdbcTemplate jdbcTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 根据用户组件获取数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Map&lt;String, Object&gt; <span class=\"title\">findById</span><span class=\"params\">(String id)</span> </span>&#123;</span><br><span class=\"line\">        String sql = <span class=\"string\">\"SELECT * FROM person WHERE id = ?\"</span>;</span><br><span class=\"line\">        Map&lt;String, Object&gt; person = jdbcTemplate.queryForMap(sql, id);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> person;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 获取全部数据  </span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;Map&lt;String, Object&gt;&gt; all() &#123;</span><br><span class=\"line\">        List&lt;Map&lt;String, Object&gt;&gt; personList =</span><br><span class=\"line\">                jdbcTemplate.queryForList(<span class=\"string\">\"SELECT * FROM person\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> personList;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// redis set ex px </span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">lock</span><span class=\"params\">(String key, <span class=\"keyword\">long</span> timeout)</span> </span>&#123;</span><br><span class=\"line\">        Boolean result = redisTemplate.opsForValue().setIfAbsent(LOCK_PREFIX, key, Duration.ofSeconds(timeout));</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (result) &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">\"lock\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// redis单节点解锁</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">unlock</span><span class=\"params\">(String key)</span> </span>&#123;</span><br><span class=\"line\">        String script = <span class=\"string\">\"if redis.call('get',KEYS[1]) == ARGV[1]\"</span></span><br><span class=\"line\">                + <span class=\"string\">\"then\"</span></span><br><span class=\"line\">                + <span class=\"string\">\"     return redis.call('del',KEYS[1])\"</span></span><br><span class=\"line\">                + <span class=\"string\">\"else \"</span></span><br><span class=\"line\">                + <span class=\"string\">\"     return 0 \"</span></span><br><span class=\"line\">                + <span class=\"string\">\"end\"</span>;</span><br><span class=\"line\">        String[] args = <span class=\"keyword\">new</span> String[]&#123;key&#125;;</span><br><span class=\"line\">        DefaultRedisScript&lt;Long&gt; redisScript = <span class=\"keyword\">new</span> DefaultRedisScript&lt;&gt;(script, Long<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">        Object result = redisTemplate.execute(redisScript, Collections.singletonList(LOCK_PREFIX), args);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Objects.equals(result, <span class=\"number\">1L</span>)) &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">\"unlock ok\"</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 空值响应</span></span><br><span class=\"line\">     <span class=\"function\"><span class=\"keyword\">public</span> Map&lt;String, Object&gt; <span class=\"title\">findCacheById</span><span class=\"params\">(String id, Long lockOutTime, Long emptyOutTime)</span> </span>&#123;</span><br><span class=\"line\">        Map&lt;String, Object&gt; result = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        Gson gson = <span class=\"keyword\">new</span> GsonBuilder().create();</span><br><span class=\"line\">        String key = INFO + id;</span><br><span class=\"line\">        Object data = redisTemplate.opsForValue().get(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (data == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (lock(id, lockOutTime)) &#123;</span><br><span class=\"line\">                    log.info(<span class=\"string\">\"init data \"</span>);</span><br><span class=\"line\">                    result = findById(id);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (CollectionUtils.isEmpty(result)) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// 插入一个空格进去</span></span><br><span class=\"line\">                        log.info(<span class=\"string\">\"set empty \"</span>);</span><br><span class=\"line\">                        result = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">                        redisTemplate.opsForValue().set(key, gson.toJson(result), emptyOutTime, TimeUnit.MILLISECONDS);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        log.info(<span class=\"string\">\"set data \"</span>);</span><br><span class=\"line\">                        redisTemplate.opsForValue().set(key, gson.toJson(result));</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                unlock(id);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            result = gson.fromJson(data.toString(), Map<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!CollectionUtils.isEmpty(result)) &#123;</span><br><span class=\"line\">                log.info(<span class=\"string\">\"get cache\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"测试入口\"><a href=\"#测试入口\" class=\"headerlink\" title=\"测试入口\"></a>测试入口</h3><h4 id=\"单元测试\"><a href=\"#单元测试\" class=\"headerlink\" title=\"单元测试\"></a>单元测试</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.redis;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.gson.Gson;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.gson.GsonBuilder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.gson.reflect.TypeToken;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.Disabled;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.MethodOrderer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.TestMethodOrder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.jupiter.api.extension.ExtendWith;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisStringCommands;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisCallback;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.types.Expiration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.test.context.junit.jupiter.SpringExtension;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.util.CollectionUtils;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Type;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.time.Duration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.CountDownLatch;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutorService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executors;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"meta\">@ExtendWith</span>(SpringExtension<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\">@<span class=\"title\">SpringBootTest</span>(<span class=\"title\">classes</span> </span>= AppApplication<span class=\"class\">.<span class=\"keyword\">class</span>, <span class=\"title\">webEnvironment</span> </span>= SpringBootTest.WebEnvironment.NONE)</span><br><span class=\"line\"><span class=\"meta\">@AutoConfigureMockMvc</span></span><br><span class=\"line\"><span class=\"comment\">// 指定单元测试方法顺序</span></span><br><span class=\"line\"><span class=\"meta\">@TestMethodOrder</span>(MethodOrderer.OrderAnnotation<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">public</span> <span class=\"title\">class</span> <span class=\"title\">AppApplicationTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    AppApplicationServiceImpl appApplicationService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"meta\">@Disabled</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">dataView</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        List&lt;Map&lt;String, Object&gt;&gt; personList =</span><br><span class=\"line\">                appApplicationService.all();</span><br><span class=\"line\">        Gson gson = <span class=\"keyword\">new</span> GsonBuilder().setPrettyPrinting().create();</span><br><span class=\"line\">        log.info(<span class=\"string\">\"personList \\n &#123;&#125;\"</span>, gson.toJson(personList));</span><br><span class=\"line\">        Map&lt;String, Object&gt; objectMap = appApplicationService.findById(personList.get(<span class=\"number\">0</span>).get(<span class=\"string\">\"id\"</span>).toString());</span><br><span class=\"line\">        log.info(<span class=\"string\">\"person \\n &#123;&#125;\"</span>, gson.toJson(objectMap));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">clean</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        Set&lt;String&gt; keys =</span><br><span class=\"line\">                redisTemplate.keys(<span class=\"string\">\"*\"</span>);</span><br><span class=\"line\">        redisTemplate.delete(keys);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">testCacheBreakdownInfo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> count = <span class=\"number\">10</span>;</span><br><span class=\"line\">        String id = <span class=\"string\">\"3\"</span>;</span><br><span class=\"line\">        CountDownLatch countDownLatch = <span class=\"keyword\">new</span> CountDownLatch(count);</span><br><span class=\"line\">        ExecutorService executorService = Executors.newFixedThreadPool(count);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; count; i++) &#123;</span><br><span class=\"line\">            executorService.execute(() -&gt; &#123;</span><br><span class=\"line\">                log.info(<span class=\"string\">\" user &#123;&#125; \"</span>, appApplicationService.findCacheById(id, <span class=\"number\">1000L</span>, <span class=\"number\">10000L</span>));</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">1000L</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                countDownLatch.countDown();</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            countDownLatch.await();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        executorService.shutdown();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"meta\">@Disabled</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        clean();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">2</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">long</span> startTimes = System.currentTimeMillis();</span><br><span class=\"line\">            testCacheBreakdownInfo();</span><br><span class=\"line\">            <span class=\"keyword\">long</span> endTimes = System.currentTimeMillis();</span><br><span class=\"line\">            <span class=\"keyword\">long</span> runTime = (endTimes - startTimes);</span><br><span class=\"line\">            log.info(<span class=\"string\">\"执行完毕:  &#123;&#125;ms\"</span>, runTime);</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">1000L</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        clean();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[pool-2-thread-3]  lock</span><br><span class=\"line\">[pool-2-thread-3]  init data </span><br><span class=\"line\">[pool-2-thread-3]  HikariPool-1 - Starting...</span><br><span class=\"line\">[pool-2-thread-8]  unlock ok</span><br><span class=\"line\">[pool-2-thread-4]   user &#123;&#125; </span><br><span class=\"line\">[pool-2-thread-5]   user &#123;&#125; </span><br><span class=\"line\">[pool-2-thread-9]   user &#123;&#125; </span><br><span class=\"line\">[pool-2-thread-6]   user &#123;&#125; </span><br><span class=\"line\">[pool-2-thread-7]   user &#123;&#125; </span><br><span class=\"line\">[pool-2-thread-10]   user &#123;&#125; </span><br><span class=\"line\">[pool-2-thread-8]   user &#123;&#125; </span><br><span class=\"line\">[pool-2-thread-2]   user &#123;&#125; </span><br><span class=\"line\">[pool-2-thread-1]   user &#123;&#125; </span><br><span class=\"line\">[pool-2-thread-3]  HikariPool-1 - Start completed.</span><br><span class=\"line\">[pool-2-thread-3]  set data </span><br><span class=\"line\">[pool-2-thread-3]   user &#123;id&#x3D;3, full_name&#x3D;黛玉赵, email&#x3D;daiyu.zhao@gmail.com, telephone_number&#x3D;13100077310, sex&#x3D;true, birth_date&#x3D;1998-03-02 20:23:08.0, identity_card_number&#x3D;460501198803127323&#125; </span><br><span class=\"line\">[main]  执行完毕:  1336ms</span><br><span class=\"line\">[pool-3-thread-7]  get cache</span><br><span class=\"line\">[pool-3-thread-10]  get cache</span><br><span class=\"line\">[pool-3-thread-9]  get cache</span><br><span class=\"line\">[pool-3-thread-4]  get cache</span><br><span class=\"line\">[pool-3-thread-6]  get cache</span><br><span class=\"line\">[pool-3-thread-5]  get cache</span><br><span class=\"line\">[pool-3-thread-2]  get cache</span><br><span class=\"line\">[pool-3-thread-3]  get cache</span><br><span class=\"line\">[pool-3-thread-1]  get cache</span><br><span class=\"line\">[pool-3-thread-8]  get cache</span><br><span class=\"line\">[pool-3-thread-3]   user &#123;id&#x3D;3.0, full_name&#x3D;黛玉赵, email&#x3D;daiyu.zhao@gmail.com, telephone_number&#x3D;1.310007731E10, sex&#x3D;true, birth_date&#x3D;Mar 2, 1998 8:23:08 PM, identity_card_number&#x3D;4.605011988031273E17&#125; </span><br><span class=\"line\">[pool-3-thread-10]   user &#123;id&#x3D;3.0, full_name&#x3D;黛玉赵, email&#x3D;daiyu.zhao@gmail.com, telephone_number&#x3D;1.310007731E10, sex&#x3D;true, birth_date&#x3D;Mar 2, 1998 8:23:08 PM, identity_card_number&#x3D;4.605011988031273E17&#125; </span><br><span class=\"line\">[pool-3-thread-7]   user &#123;id&#x3D;3.0, full_name&#x3D;黛玉赵, email&#x3D;daiyu.zhao@gmail.com, telephone_number&#x3D;1.310007731E10, sex&#x3D;true, birth_date&#x3D;Mar 2, 1998 8:23:08 PM, identity_card_number&#x3D;4.605011988031273E17&#125; </span><br><span class=\"line\">[pool-3-thread-1]   user &#123;id&#x3D;3.0, full_name&#x3D;黛玉赵, email&#x3D;daiyu.zhao@gmail.com, telephone_number&#x3D;1.310007731E10, sex&#x3D;true, birth_date&#x3D;Mar 2, 1998 8:23:08 PM, identity_card_number&#x3D;4.605011988031273E17&#125; </span><br><span class=\"line\">[pool-3-thread-8]   user &#123;id&#x3D;3.0, full_name&#x3D;黛玉赵, email&#x3D;daiyu.zhao@gmail.com, telephone_number&#x3D;1.310007731E10, sex&#x3D;true, birth_date&#x3D;Mar 2, 1998 8:23:08 PM, identity_card_number&#x3D;4.605011988031273E17&#125; </span><br><span class=\"line\">[pool-3-thread-9]   user &#123;id&#x3D;3.0, full_name&#x3D;黛玉赵, email&#x3D;daiyu.zhao@gmail.com, telephone_number&#x3D;1.310007731E10, sex&#x3D;true, birth_date&#x3D;Mar 2, 1998 8:23:08 PM, identity_card_number&#x3D;4.605011988031273E17&#125; </span><br><span class=\"line\">[pool-3-thread-5]   user &#123;id&#x3D;3.0, full_name&#x3D;黛玉赵, email&#x3D;daiyu.zhao@gmail.com, telephone_number&#x3D;1.310007731E10, sex&#x3D;true, birth_date&#x3D;Mar 2, 1998 8:23:08 PM, identity_card_number&#x3D;4.605011988031273E17&#125; </span><br><span class=\"line\">[pool-3-thread-2]   user &#123;id&#x3D;3.0, full_name&#x3D;黛玉赵, email&#x3D;daiyu.zhao@gmail.com, telephone_number&#x3D;1.310007731E10, sex&#x3D;true, birth_date&#x3D;Mar 2, 1998 8:23:08 PM, identity_card_number&#x3D;4.605011988031273E17&#125; </span><br><span class=\"line\">[pool-3-thread-4]   user &#123;id&#x3D;3.0, full_name&#x3D;黛玉赵, email&#x3D;daiyu.zhao@gmail.com, telephone_number&#x3D;1.310007731E10, sex&#x3D;true, birth_date&#x3D;Mar 2, 1998 8:23:08 PM, identity_card_number&#x3D;4.605011988031273E17&#125; </span><br><span class=\"line\">[pool-3-thread-6]   user &#123;id&#x3D;3.0, full_name&#x3D;黛玉赵, email&#x3D;daiyu.zhao@gmail.com, telephone_number&#x3D;1.310007731E10, sex&#x3D;true, birth_date&#x3D;Mar 2, 1998 8:23:08 PM, identity_card_number&#x3D;4.605011988031273E17&#125; </span><br><span class=\"line\">[main]  执行完毕:  1025ms</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"接口测试\"><a href=\"#接口测试\" class=\"headerlink\" title=\"接口测试\"></a>接口测试</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.redis;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Properties;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppApplicationController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    AppApplicationServiceImpl appApplicationService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"&#123;id&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">index</span><span class=\"params\">(@PathVariable(required = <span class=\"keyword\">false</span>)</span> String id) </span>&#123;</span><br><span class=\"line\">        Map&lt;String, Object&gt; data = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        data.put(<span class=\"string\">\"code\"</span>, <span class=\"string\">\"200\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == id) &#123;</span><br><span class=\"line\">            data.put(<span class=\"string\">\"data\"</span>, <span class=\"string\">\"请求参数不合法\"</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            data.put(<span class=\"string\">\"data\"</span>, appApplicationService.findCacheById(id,<span class=\"number\">1000L</span>,<span class=\"number\">10000L</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">  docker-run curl http://127.0.0.1:9001/redis/1</span><br><span class=\"line\">&#123;<span class=\"string\">\"code\"</span>:<span class=\"string\">\"200\"</span>,<span class=\"string\">\"data\"</span>:&#123;<span class=\"string\">\"id\"</span>:1,<span class=\"string\">\"full_name\"</span>:<span class=\"string\">\"灵芸黄\"</span>,<span class=\"string\">\"email\"</span>:<span class=\"string\">\"lingyun.huang@gmail.com\"</span>,<span class=\"string\">\"telephone_number\"</span>:13842681484,<span class=\"string\">\"sex\"</span>:<span class=\"literal\">true</span>,<span class=\"string\">\"birth_date\"</span>:<span class=\"string\">\"1996-05-23T21:17:45.000+00:00\"</span>,<span class=\"string\">\"identity_card_number\"</span>:361405197211160626&#125;&#125;%</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["Redis"],"tags":["Mysql","Redis","Docker","Docker-Compose","Spring","Cache"]},{"title":"Docker-ElasticSearch5.6.8","url":"/posts/3253426685/","content":"<h3 id=\"docker查找镜像\"><a href=\"#docker查找镜像\" class=\"headerlink\" title=\"docker查找镜像\"></a>docker查找镜像</h3><p><code>docker search elasticSearch</code></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-search-elasticsearch.png\"></p>\n<h3 id=\"docker-拉去镜像\"><a href=\"#docker-拉去镜像\" class=\"headerlink\" title=\"docker 拉去镜像\"></a>docker 拉去镜像</h3><p><code>docker pull elasticsearch:5.6.8</code>  直接拉去官方的镜像， 可以使用指定版本。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-pull-elasticseatch.png\"></p>\n<h3 id=\"docker启动elasticsearch\"><a href=\"#docker启动elasticsearch\" class=\"headerlink\" title=\"docker启动elasticsearch\"></a>docker启动elasticsearch</h3><p><code>docker run  --name elasticsearch  -p 9200:9200 -p 9300:9300 -v $PWD/elasticsearch/data:/usr/share/elasticsearch/data -e &quot;discovery.type=single-node&quot;   elasticsearch:5.6.8</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">--name elasticsearch 指定容器名字</span><br><span class=\"line\">-p 9200:9200 -p 9300:9300 将容器的9200，9300端口映射成主机的9200，9300端口</span><br><span class=\"line\">-e <span class=\"string\">\"discovery.type=single-node\"</span> 指定单节点模式</span><br><span class=\"line\">elasticsearch:5.6.8 images名称</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-ps-elasticsearch.png\"></p>\n<ul>\n<li>这里只是演示单个节点。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-run-elasticsearch.png\"></p>\n<ul>\n<li>这里的日志输出有点问题，然后我也没挂载到本地。下次写集群部署到时候在来弄。</li>\n</ul>\n<h2 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h2>","categories":["Docker"],"tags":["Docker","ElasticSearch"]},{"title":"Docker-Mysql5.7","url":"/posts/1709401516/","content":"<h3 id=\"docker查找镜像\"><a href=\"#docker查找镜像\" class=\"headerlink\" title=\"docker查找镜像\"></a>docker查找镜像</h3><p><code>docker search mysql</code></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-search-mysql.png\"></p>\n<h3 id=\"docker-拉去镜像\"><a href=\"#docker-拉去镜像\" class=\"headerlink\" title=\"docker 拉去镜像\"></a>docker 拉去镜像</h3><p><code>docker pull mysql:5.7</code>  直接拉去官方的镜像， 可以使用指定版本。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-pull-mysql5.7.png\"></p>\n<h3 id=\"docker启动mysql\"><a href=\"#docker启动mysql\" class=\"headerlink\" title=\"docker启动mysql\"></a>docker启动mysql</h3><p><code>docker run -p 3306:3306 -v $PWD/mysql/conf:/mysql/etc/mysql/conf.d -v $PWD/mysql/logs:/logs -v $PWD/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7 </code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">-p 3306:3306 将容器的3306端口映射成主机的3306端口</span><br><span class=\"line\">-v <span class=\"variable\">$PWD</span>/mysql/conf:/mysql/etc/mysql/conf.d 将主机中当前目录下的mysql/conf挂载到容器的/mysql/etc/mysql/conf.d</span><br><span class=\"line\">-v <span class=\"variable\">$PWD</span>/mysql/logs:/logs 将主机中当前目录下的mysql/logs挂载到容器/logs</span><br><span class=\"line\">-v <span class=\"variable\">$PWD</span>/mysql/data:/var/lib/mysql 将主机中当前目录下的mysql/data挂载到容器/var/lib/mysql</span><br><span class=\"line\">-e MYSQL_ROOT_PASSWORD=123456  设置root 密码 123456</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-mysql-ps.png\"></p>\n<ul>\n<li>这里需要注意的是，本机有多个Mysql的时候，不要都挂载到一起了。</li>\n</ul>\n<h3 id=\"进入运行容器中\"><a href=\"#进入运行容器中\" class=\"headerlink\" title=\"进入运行容器中\"></a>进入运行容器中</h3><p><code>docker exec -it f1a0ccab4748 /bin/bash</code></p>\n<ul>\n<li><p>f1a0ccab4748 是mysql运行容器的ID</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-mysql-exec.png\"></p>\n</li>\n</ul>\n<h2 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h2>","categories":["Docker"],"tags":["Mysql","Docker"]},{"title":"Spring-Redis-String","url":"/posts/795614161/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h3 id=\"spring-redis-string\"><a href=\"#spring-redis-string\" class=\"headerlink\" title=\"spring-redis-string\"></a>spring-redis-string</h3><blockquote>\n<p>Spring-data-redis 有两个客户端，本章节主要使用lettuce来作为代码演示。尽可能面向redis编程。</p>\n</blockquote>\n<ul>\n<li>参考文献<a href=\"http://redisdoc.com/string/index.html\" target=\"_blank\" rel=\"noopener\">redis-string</a></li>\n</ul>\n<h3 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><ul>\n<li>接口</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learning.redis.operating.service;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@see</span> cn.z201.learning.redis.operating.service.impl.RedisStringImpl</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">RedisStringI</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 将字符串值 value 关联到 key 。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果 key 已经持有其他值， SET 就覆写旧值， 无视类型。</span></span><br><span class=\"line\"><span class=\"comment\">     * 当 SET 命令对一个带有生存时间（TTL）的键进行设置之后， 该键原有的 TTL 将被清除。</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/set.html &#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 1.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(1)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Boolean <span class=\"title\">set</span><span class=\"params\">(String key, String value)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 只在键 key 不存在的情况下， 将键 key 的值设置为 value 。</span></span><br><span class=\"line\"><span class=\"comment\">     * 若键 key 已经存在， 则 SETNX 命令不做任何动作。</span></span><br><span class=\"line\"><span class=\"comment\">     * SETNX 是『SET if Not eXists』(如果不存在，则 SET)的简写。</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 1.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(1)</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/setnx.html  &#125;</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Boolean <span class=\"title\">setNx</span><span class=\"params\">(String key, String value)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 将键 key 的值设置为 value ， 并将键 key 的生存时间设置为 seconds 秒钟。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果键 key 已经存在， 那么 SETEX 命令将覆盖已有的值。</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/setex.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 2.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(1)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> timeout seconds 秒</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Boolean <span class=\"title\">setEx</span><span class=\"params\">(String key, Long timeout, String value)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 这个命令和 SETEX 命令相似， 但它以毫秒为单位设置 key 的生存时间， 而不是像 SETEX 命令那样以秒为单位进行设置。</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/psetex.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 2.6.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(1)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> timeout milliseconds</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Boolean <span class=\"title\">pSetEx</span><span class=\"params\">(String key, Long timeout, String value)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 返回与键 key 相关联的字符串值。</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/get.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 1.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(1)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Object <span class=\"title\">get</span><span class=\"params\">(String key)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取key设置的value，并返回之前设置的值。</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/getset.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 1.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(1)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Object <span class=\"title\">getSet</span><span class=\"params\">(String key, String value)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 返回key对应value的长度</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/strlen.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 2.2.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 复杂度： O(1)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Long <span class=\"title\">strLen</span><span class=\"params\">(String key)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果键 key 已经存在并且它的值是一个字符串， APPEND 命令将把 value 追加到键 key 现有值的末尾。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果 key 不存在， APPEND 就简单地将键 key 的值设为 value ， 就像执行 SET key value 一样。</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/append.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 2.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： 平摊O(1)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Long <span class=\"title\">appEnd</span><span class=\"params\">(String key, String value)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 从偏移量 offset 开始， 用 value 参数覆写(overwrite)键 key 储存的字符串值。</span></span><br><span class=\"line\"><span class=\"comment\">     * 不存在的键 key 当作空白字符串处理。</span></span><br><span class=\"line\"><span class=\"comment\">     * SETRANGE 命令会确保字符串足够长以便将 value 设置到指定的偏移量上，</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果键 key 原来储存的字符串长度比偏移量小(比如字符串只有 5 个字符长，</span></span><br><span class=\"line\"><span class=\"comment\">     * 但你设置的 offset 是 10 )， 那么原字符和偏移量之间的空白将用零字节(zerobytes, \"\\x00\" )进行填充。</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/setrange.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 2.2.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度：对于长度较短的字符串，命令的平摊复杂度O(1)；对于长度较大的字符串，命令的复杂度为 O(M) ，其中 M 为 value 的长度。</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> offset</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Boolean <span class=\"title\">setRange</span><span class=\"params\">(String key, Long offset, String value)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 返回键 key 储存的字符串值的指定部分， 字符串的截取范围由 start 和 end 两个偏移量决定 (包括 start 和 end 在内)。</span></span><br><span class=\"line\"><span class=\"comment\">     * 负数偏移量表示从字符串的末尾开始计数， -1 表示最后一个字符， -2 表示倒数第二个字符， 以此类推。</span></span><br><span class=\"line\"><span class=\"comment\">     * GETRANGE 通过保证子字符串的值域(range)不超过实际字符串的值域来处理超出范围的值域请求。</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/setrange.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 2.4.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(N)，其中 N 为被返回的字符串的长度。</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> start</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> end</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Object <span class=\"title\">getRange</span><span class=\"params\">(String key, Long start, Long end)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 为键 key 储存的数字值加上一。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果键 key 不存在， 那么它的值会先被初始化为 0 ， 然后再执行 INCR 命令。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果键 key 储存的值不能被解释为数字， 那么 INCR 命令将返回一个错误。</span></span><br><span class=\"line\"><span class=\"comment\">     * 本操作的值限制在 64 位(bit)有符号数字表示之内。</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/incr.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 1.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(1)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Long <span class=\"title\">incr</span><span class=\"params\">(String key)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 为键 key 储存的数字值加上增量 increment 。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果键 key 不存在， 那么键 key 的值会先被初始化为 0 ， 然后再执行 INCRBY 命令。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果键 key 储存的值不能被解释为数字， 那么 INCRBY 命令将返回一个错误。</span></span><br><span class=\"line\"><span class=\"comment\">     * 本操作的值限制在 64 位(bit)有符号数字表示之内。</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/incrby.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 1.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(1)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sum</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Long <span class=\"title\">incrBy</span><span class=\"params\">(String key, Long sum)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 为键 key 储存的值加上浮点数增量 increment 。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果键 key 不存在， 那么 INCRBYFLOAT 会先将键 key 的值设为 0 ， 然后再执行加法操作。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果命令执行成功， 那么键 key 的值会被更新为执行加法计算之后的新值， 并且新值会以字符串的形式返回给调用者。</span></span><br><span class=\"line\"><span class=\"comment\">     * 无论是键 key 的值还是增量 increment ， 都可以使用像 2.0e7 、 3e5 、 90e-2 那样的指数符号(exponential notation)来表示， 但是，</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行 INCRBYFLOAT 命令之后的值总是以同样的形式储存， 也即是， 它们总是由一个数字，</span></span><br><span class=\"line\"><span class=\"comment\">     * 一个（可选的）小数点和一个任意长度的小数部分组成（比如 3.14 、 69.768 ，诸如此类)， 小数部分尾随的 0 会被移除，</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果可能的话， 命令还会将浮点数转换为整数（比如 3.0 会被保存成 3 ）。</span></span><br><span class=\"line\"><span class=\"comment\">     * 此外， 无论加法计算所得的浮点数的实际精度有多长， INCRBYFLOAT 命令的计算结果最多只保留小数点的后十七位。</span></span><br><span class=\"line\"><span class=\"comment\">     * 当以下任意一个条件发生时， 命令返回一个错误：</span></span><br><span class=\"line\"><span class=\"comment\">     * 键 key 的值不是字符串类型(因为 Redis 中的数字和浮点数都以字符串的形式保存，所以它们都属于字符串类型）；</span></span><br><span class=\"line\"><span class=\"comment\">     * 键 key 当前的值或者给定的增量 increment 不能被解释(parse)为双精度浮点数。</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/incrbyfloat.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 1.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(1)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sum</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Float <span class=\"title\">incrByFloat</span><span class=\"params\">(String key, Float sum)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 为键 key 储存的数字值减去一。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果键 key 不存在， 那么键 key 的值会先被初始化为 0 ， 然后再执行 DECR 操作。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果键 key 储存的值不能被解释为数字， 那么 DECR 命令将返回一个错误。</span></span><br><span class=\"line\"><span class=\"comment\">     * 本操作的值限制在 64 位(bit)有符号数字表示之内。</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/decr.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 1.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(1)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Long <span class=\"title\">decr</span><span class=\"params\">(String key)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 将键 key 储存的整数值减去减量 decrement 。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果键 key 不存在， 那么键 key 的值会先被初始化为 0 ， 然后再执行 DECRBY 命令。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果键 key 储存的值不能被解释为数字， 那么 DECRBY 命令将返回一个错误。</span></span><br><span class=\"line\"><span class=\"comment\">     * 本操作的值限制在 64 位(bit)有符号数字表示之内。</span></span><br><span class=\"line\"><span class=\"comment\">     * &lt;p&gt;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 1.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(1)</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sum</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Long <span class=\"title\">decrBy</span><span class=\"params\">(String key, Long sum)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 同时为多个键设置值。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果某个给定键已经存在， 那么 MSET 将使用新值去覆盖旧值，</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果这不是你所希望的效果， 请考虑使用 MSETNX 命令， 这个命令只会在所有给定键都不存在的情况下进行设置。</span></span><br><span class=\"line\"><span class=\"comment\">     * MSET 是一个原子性(atomic)操作， 所有给定键都会在同一时间内被设置， 不会出现某些键被设置了但是另一些键没有被设置的情况。</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/mset.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 1.0.1</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(N)，其中 N 为被设置的键数量。</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> map</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Boolean <span class=\"title\">mSet</span><span class=\"params\">(HashMap&lt;String, Object&gt; map)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 当且仅当所有给定键都不存在时， 为所有给定键设置值。</span></span><br><span class=\"line\"><span class=\"comment\">     * 即使只有一个给定键已经存在， MSETNX 命令也会拒绝执行对所有键的设置操作。</span></span><br><span class=\"line\"><span class=\"comment\">     * MSETNX 是一个原子性(atomic)操作， 所有给定键要么就全部都被设置， 要么就全部都不设置， 不可能出现第三种状态。</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/msetnx.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 1.0.1</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(N)， 其中 N 为被设置的键数量。</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> map</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">Boolean <span class=\"title\">mSetNx</span><span class=\"params\">(HashMap&lt;String, Object&gt; map)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 返回给定的一个或多个字符串键的值。</span></span><br><span class=\"line\"><span class=\"comment\">     * 如果给定的字符串键里面， 有某个键不存在， 那么这个键的值将以特殊值 nil 表示。</span></span><br><span class=\"line\"><span class=\"comment\">     * &#123;<span class=\"doctag\">@link</span> = http://redisdoc.com/string/mget.html&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     * 可用版本： &gt;= 1.0.0</span></span><br><span class=\"line\"><span class=\"comment\">     * 时间复杂度： O(N) ，其中 N 为给定键的数量。</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">List&lt;Object&gt; <span class=\"title\">mGet</span><span class=\"params\">(String[] key)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<ul>\n<li>代码实现</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learning.redis.operating.service.impl;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learning.redis.operating.Tools;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learning.redis.operating.service.RedisStringExpansionI;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learning.redis.operating.service.RedisStringI;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisCallback;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisStringImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">RedisStringI</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">set</span><span class=\"params\">(String key, String value)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key, value);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> connection.set(stringRedisSerializer.serialize(key),</span><br><span class=\"line\">                    stringRedisSerializer.serialize(value));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">setNx</span><span class=\"params\">(String key, String value)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key, value);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> connection.setNX(stringRedisSerializer.serialize(key),</span><br><span class=\"line\">                    stringRedisSerializer.serialize(value));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">setEx</span><span class=\"params\">(String key, Long timeout, String value)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key, value);</span><br><span class=\"line\">        Tools.notNull(timeout);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> connection.setEx(stringRedisSerializer.serialize(key),</span><br><span class=\"line\">                    timeout,</span><br><span class=\"line\">                    stringRedisSerializer.serialize(value));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">pSetEx</span><span class=\"params\">(String key, Long timeout, String value)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key, value);</span><br><span class=\"line\">        Tools.notNull(timeout);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> connection.pSetEx(stringRedisSerializer.serialize(key),</span><br><span class=\"line\">                    timeout,</span><br><span class=\"line\">                    stringRedisSerializer.serialize(value));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">get</span><span class=\"params\">(String key)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute((RedisCallback&lt;Object&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">byte</span>[] bytes = connection.get(stringRedisSerializer.serialize(key));</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != bytes || bytes.length != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> stringRedisSerializer.deserialize(bytes);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">getSet</span><span class=\"params\">(String key, String value)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key, value);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute((RedisCallback&lt;Object&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">byte</span>[] bytes = connection.getSet(stringRedisSerializer.serialize(key)</span><br><span class=\"line\">                    , stringRedisSerializer.serialize(value));</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != bytes || bytes.length != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> stringRedisSerializer.deserialize(bytes);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Long <span class=\"title\">strLen</span><span class=\"params\">(String key)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> connection.strLen(stringRedisSerializer.serialize(key));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Long <span class=\"title\">appEnd</span><span class=\"params\">(String key, String value)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key, value);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> connection.append(stringRedisSerializer.serialize(key),</span><br><span class=\"line\">                    stringRedisSerializer.serialize(value));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">setRange</span><span class=\"params\">(String key, Long offset, String value)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key, value);</span><br><span class=\"line\">        Tools.notNull(offset);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            connection.setRange(stringRedisSerializer.serialize(key),</span><br><span class=\"line\">                    stringRedisSerializer.serialize(value),</span><br><span class=\"line\">                    offset);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">getRange</span><span class=\"params\">(String key, Long start, Long end)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key);</span><br><span class=\"line\">        Tools.notNull(start);</span><br><span class=\"line\">        Tools.notNull(end);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.execute((RedisCallback&lt;Object&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">byte</span>[] bytes = connection.getRange(stringRedisSerializer.serialize(key),</span><br><span class=\"line\">                    start,</span><br><span class=\"line\">                    end);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> stringRedisSerializer.deserialize(bytes);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Long <span class=\"title\">incr</span><span class=\"params\">(String key)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> connection.incr(stringRedisSerializer.serialize(key));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">batchIncr</span><span class=\"params\">(String[] key)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Boolean) redisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            connection.openPipeline();</span><br><span class=\"line\">            Integer length = key.length;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; length; i++) &#123;</span><br><span class=\"line\">                connection.incr(stringRedisSerializer.serialize(key[i]));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            List&lt;Object&gt; result = connection.closePipeline();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == result || result.isEmpty() || result.contains(<span class=\"keyword\">false</span>)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Long <span class=\"title\">incrBy</span><span class=\"params\">(String key, Long sum)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == sum || sum &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> connection.incrBy(stringRedisSerializer.serialize(key), sum);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Double <span class=\"title\">incrByFloat</span><span class=\"params\">(String key, Double sum)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> == sum || sum &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Double) redisTemplate.execute((RedisCallback&lt;Double&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> connection.incrBy(stringRedisSerializer.serialize(key), sum.doubleValue());</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Long <span class=\"title\">decr</span><span class=\"params\">(String key)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> connection.decr(stringRedisSerializer.serialize(key));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Long <span class=\"title\">decrBy</span><span class=\"params\">(String key, Long sum)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (Long) redisTemplate.execute((RedisCallback&lt;Long&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> connection.decrBy(stringRedisSerializer.serialize(key), sum);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">mSet</span><span class=\"params\">(HashMap&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mSetNx(map, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">mSetNx</span><span class=\"params\">(HashMap&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mSetNx(map, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Object&gt; <span class=\"title\">mGet</span><span class=\"params\">(String[] key)</span> </span>&#123;</span><br><span class=\"line\">        Tools.notNull(key);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (List&lt;Object&gt;) redisTemplate.execute((RedisCallback&lt;List&lt;Object&gt;&gt;) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            Integer length = key.length;</span><br><span class=\"line\">            <span class=\"keyword\">byte</span>[][] bytes = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[length][];</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; length; i++) &#123;</span><br><span class=\"line\">                bytes[i] = stringRedisSerializer.serialize(key[i]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            List&lt;<span class=\"keyword\">byte</span>[]&gt; list = connection.mGet(bytes);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != list || list.size() == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                List&lt;Object&gt; result = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">                length = list.size();</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; length; i++) &#123;</span><br><span class=\"line\">                    Object object = stringRedisSerializer.deserialize(list.get(i));</span><br><span class=\"line\">                    result.add(String.valueOf(object));</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 重构之后的代码</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> map</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> nx</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Boolean <span class=\"title\">mSetNx</span><span class=\"params\">(HashMap&lt;String, Object&gt; map, Boolean nx)</span> </span>&#123;</span><br><span class=\"line\">        Assert.notNull(map, <span class=\"string\">\"map is null\"</span>);</span><br><span class=\"line\">        Assert.notEmpty(map, <span class=\"string\">\"map is empty\"</span>);</span><br><span class=\"line\">        redisTemplate.execute((RedisCallback) connection -&gt; &#123;</span><br><span class=\"line\">            RedisSerializer stringRedisSerializer = redisTemplate.getStringSerializer();</span><br><span class=\"line\">            connection.openPipeline();</span><br><span class=\"line\">            Iterator&lt;Map.Entry&lt;String, Object&gt;&gt; iterator = map.entrySet().iterator();</span><br><span class=\"line\">            String key;</span><br><span class=\"line\">            Object value;</span><br><span class=\"line\">            Map&lt;<span class=\"keyword\">byte</span>[], <span class=\"keyword\">byte</span>[]&gt; tuple = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (iterator.hasNext()) &#123;</span><br><span class=\"line\">                Map.Entry&lt;String, Object&gt; entry = iterator.next();</span><br><span class=\"line\">                key = entry.getKey();</span><br><span class=\"line\">                value = entry.getValue();</span><br><span class=\"line\">                Tools.notNull(key, value.toString());</span><br><span class=\"line\">                tuple.put(stringRedisSerializer.serialize(key), stringRedisSerializer.serialize(value));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (nx) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!tuple.isEmpty()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> connection.mSetNX(tuple);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!tuple.isEmpty()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> connection.mSet(tuple);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>单元测试</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testRedisString</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Assert.assertEquals(<span class=\"keyword\">true</span>, redisString.set(<span class=\"string\">\"key\"</span>, <span class=\"string\">\"value\"</span>));</span><br><span class=\"line\">    Assert.assertEquals(<span class=\"string\">\"value\"</span>, redisString.get(<span class=\"string\">\"key\"</span>));</span><br><span class=\"line\">    HashMap map = <span class=\"keyword\">new</span> HashMap&lt;String, Object&gt;();</span><br><span class=\"line\">    map.put(<span class=\"string\">\"key1\"</span>, <span class=\"string\">\"value1\"</span>);</span><br><span class=\"line\">    map.put(<span class=\"string\">\"key2\"</span>, <span class=\"string\">\"value2\"</span>);</span><br><span class=\"line\">    Assert.assertEquals(<span class=\"keyword\">true</span>, redisString.mSet(map));</span><br><span class=\"line\">    Assert.assertEquals(<span class=\"keyword\">true</span>, redisString.set(<span class=\"string\">\"key3\"</span>, <span class=\"string\">\"1\"</span>));</span><br><span class=\"line\">    Assert.assertEquals(<span class=\"keyword\">true</span>, redisString.set(<span class=\"string\">\"key4\"</span>, <span class=\"string\">\"1\"</span>));</span><br><span class=\"line\">    log.info(<span class=\"string\">\"key3  key4 &#123;&#125;\"</span>, redisString.mGet(<span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">\"key3\"</span>, <span class=\"string\">\"key4\"</span>&#125;));</span><br><span class=\"line\">    log.info(<span class=\"string\">\"key4 incr &#123;&#125; \"</span>, redisString.incr(<span class=\"string\">\"key4\"</span>));</span><br><span class=\"line\">    log.info(<span class=\"string\">\"key4 3 incrBy &#123;&#125; \"</span>, redisString.incrBy(<span class=\"string\">\"key4\"</span>, <span class=\"number\">3L</span>));</span><br><span class=\"line\">    log.info(<span class=\"string\">\"key4 decr &#123;&#125; \"</span>, redisString.decr(<span class=\"string\">\"key4\"</span>));</span><br><span class=\"line\">    log.info(<span class=\"string\">\"key4 2 incrBy &#123;&#125; \"</span>, redisString.incrBy(<span class=\"string\">\"key4\"</span>, <span class=\"number\">2L</span>));</span><br><span class=\"line\">    Set&lt;String&gt; keys = redisTool.keys(<span class=\"string\">\"key*\"</span>);</span><br><span class=\"line\">    keys.forEach(item -&gt; log.info(<span class=\"string\">\" keys -&gt; key &#123;&#125; : value &#123;&#125; \"</span>, item, redisString.get(item)));</span><br><span class=\"line\">    redisString.setEx(<span class=\"string\">\"key1111\"</span>, <span class=\"number\">10L</span>, <span class=\"string\">\"value\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>日志输出</li>\n</ul>\n<figure class=\"highlight verilog\"><table><tr><td class=\"code\"><pre><span class=\"line\">[main] INFO  c<span class=\"variable\">.z</span><span class=\"variable\">.l</span><span class=\"variable\">.r</span><span class=\"variable\">.o</span><span class=\"variable\">.RedisOperatingApplicationTests</span> - key4 incr <span class=\"number\">2</span> </span><br><span class=\"line\">[main] INFO  c<span class=\"variable\">.z</span><span class=\"variable\">.l</span><span class=\"variable\">.r</span><span class=\"variable\">.o</span><span class=\"variable\">.RedisOperatingApplicationTests</span> - key3  key4 [<span class=\"number\">1</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\">[main] INFO  c<span class=\"variable\">.z</span><span class=\"variable\">.l</span><span class=\"variable\">.r</span><span class=\"variable\">.o</span><span class=\"variable\">.RedisOperatingApplicationTests</span> - key4 decr <span class=\"number\">1</span> </span><br><span class=\"line\">[main] INFO  c<span class=\"variable\">.z</span><span class=\"variable\">.l</span><span class=\"variable\">.r</span><span class=\"variable\">.o</span><span class=\"variable\">.RedisOperatingApplicationTests</span> - key4 incrBy <span class=\"number\">4</span> </span><br><span class=\"line\">[main] INFO  c<span class=\"variable\">.z</span><span class=\"variable\">.l</span><span class=\"variable\">.r</span><span class=\"variable\">.o</span><span class=\"variable\">.RedisOperatingApplicationTests</span> -  keys -&gt; key key4 : value <span class=\"number\">4</span> </span><br><span class=\"line\">[main] INFO  c<span class=\"variable\">.z</span><span class=\"variable\">.l</span><span class=\"variable\">.r</span><span class=\"variable\">.o</span><span class=\"variable\">.RedisOperatingApplicationTests</span> -  keys -&gt; key key1 : value value1 </span><br><span class=\"line\">[main] INFO  c<span class=\"variable\">.z</span><span class=\"variable\">.l</span><span class=\"variable\">.r</span><span class=\"variable\">.o</span><span class=\"variable\">.RedisOperatingApplicationTests</span> -  keys -&gt; key key3 : value <span class=\"number\">1</span> </span><br><span class=\"line\">[main] INFO  c<span class=\"variable\">.z</span><span class=\"variable\">.l</span><span class=\"variable\">.r</span><span class=\"variable\">.o</span><span class=\"variable\">.RedisOperatingApplicationTests</span> -  keys -&gt; key key : value value </span><br><span class=\"line\">[main] INFO  c<span class=\"variable\">.z</span><span class=\"variable\">.l</span><span class=\"variable\">.r</span><span class=\"variable\">.o</span><span class=\"variable\">.RedisOperatingApplicationTests</span> -  keys -&gt; key key2 : value value2</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["Spring"],"tags":["Redis","Java","Spring"]},{"title":"Docker-Zookeeper","url":"/posts/3958923991/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h3 id=\"docker查找镜像\"><a href=\"#docker查找镜像\" class=\"headerlink\" title=\"docker查找镜像\"></a>docker查找镜像</h3><p><code>docker search zookeeper</code></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-search-zookeeper.png\"></p>\n<h3 id=\"docker-拉去镜像\"><a href=\"#docker-拉去镜像\" class=\"headerlink\" title=\"docker 拉去镜像\"></a>docker 拉去镜像</h3><p><code>docker pull zookeeper</code>  直接拉去官方的镜像，一般第一个就是。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-pull-zookeeper.png\"></p>\n<h3 id=\"docker启动zookeeper\"><a href=\"#docker启动zookeeper\" class=\"headerlink\" title=\"docker启动zookeeper\"></a>docker启动zookeeper</h3><p><code>docker run -p 2181:2181 -v $PWD/zookeeper/data:/data  -d zookeeper:latest </code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">-p 2181:2181：将容器的2181端口映射成主机的2181端口</span><br><span class=\"line\">-v <span class=\"variable\">$PWD</span>/zookeeper/data:/data :将主机中当前目录下的data挂载到容器的/data</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-zookeeper-ps.png\"></p>\n<ul>\n<li>这里需要注意的是，本机有多zookeeper的时候，不要都挂载到一起了。</li>\n</ul>\n<h3 id=\"进入运行容器中\"><a href=\"#进入运行容器中\" class=\"headerlink\" title=\"进入运行容器中\"></a>进入运行容器中</h3><p><code>docker exec -it 3f6a8c213504 /bin/bash</code></p>\n<ul>\n<li><p>3f6a8c213504 是zookeeper运行容器的ID</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-exec-zookeeper.png\"></p>\n</li>\n</ul>\n<h2 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h2>","categories":["Docker"],"tags":["Zookeeper","Docker"]},{"title":"Docker-Redis","url":"/posts/1265826095/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h2 id=\"Docker环境下部署redis\"><a href=\"#Docker环境下部署redis\" class=\"headerlink\" title=\"Docker环境下部署redis\"></a>Docker环境下部署redis</h2><h3 id=\"确认已经安装好了Docker环境\"><a href=\"#确认已经安装好了Docker环境\" class=\"headerlink\" title=\"确认已经安装好了Docker环境\"></a>确认已经安装好了Docker环境</h3><blockquote>\n<p> windows 和  linux 可以用 docker info检查是否安装</p>\n</blockquote>\n<ul>\n<li>在mac下就是这么个情况。需要注意的是，请不用使用email登录，否则在查找官方镜像的时候会抛出认证失败的问题。比如我是登录用户<code>z201</code></li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"docker查找镜像\"><a href=\"#docker查找镜像\" class=\"headerlink\" title=\"docker查找镜像\"></a>docker查找镜像</h3><p><code>docker search redis</code></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-search-redis.png\"></p>\n<h3 id=\"docker-拉去镜像\"><a href=\"#docker-拉去镜像\" class=\"headerlink\" title=\"docker 拉去镜像\"></a>docker 拉去镜像</h3><p><code>docker pull redis</code>  直接拉去官方的镜像，一般第一个就是。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-pull-redis.png\"></p>\n<h3 id=\"docker启动redis\"><a href=\"#docker启动redis\" class=\"headerlink\" title=\"docker启动redis\"></a>docker启动redis</h3><p><code>docker run -p 6379:6379 -v $PWD/data:/data  -d redis:latest redis-server --appendonly yes</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">-p 6379:6379：将容器的6379端口映射成主机的6379端口</span><br><span class=\"line\">-v <span class=\"variable\">$PWD</span>/data:/data :将主机中当前目录下的data挂载到容器的/data</span><br><span class=\"line\">redis-server --appendonly yes : 在容器执行redis-server启动命令，并打开redis持久化配置</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-redis-ps.png\"></p>\n<ul>\n<li>这里需要注意的是，如果你本地有很多的redis容器在跑，不要都挂载到一起了。</li>\n</ul>\n<h3 id=\"进入redis运行容器中\"><a href=\"#进入redis运行容器中\" class=\"headerlink\" title=\"进入redis运行容器中\"></a>进入redis运行容器中</h3><p><code>docker run -it redis:latest redis-cli -h 192.168.31.7</code></p>\n<ul>\n<li><p>这里使用redis-cli 连接redis 。注意下这里的ip，是你本机的ip。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Docker/docker-redis-cli.png\"></p>\n</li>\n<li><p>Redis <code>Keys</code> 命令用于查找所有符合给定模式 pattern 的 key ,这里可以看到redis目前是空的。</p>\n</li>\n</ul>\n<h2 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h2>","categories":["Docker"],"tags":["Redis","Docker"]},{"title":"SpringBoot-Dubbo","url":"/posts/2696067944/","content":"<blockquote>\n<p>离职两个月，太久没写项目了，重新温故下。</p>\n</blockquote>\n<ul>\n<li><p>这里的代码是最简单的演示效果。</p>\n</li>\n<li><p>项目下载地址 <code>git cloen -b v1.0.0 https://github.com/z201/learning-spring-dubbo-micro-service.git</code></p>\n</li>\n<li><p><code>v1.0.0</code>分支dubbo xml 配置演示基于zk做注册中心。</p>\n</li>\n<li><p><code>v2.0.0</code>分支dubbo annotation 配置演示基于zk做注册中心。</p>\n</li>\n<li><p><code>v3.0.0</code>分支dubbo xml 配置演示基于nacos做注册中心。</p>\n</li>\n</ul>\n<h3 id=\"项目模块\"><a href=\"#项目模块\" class=\"headerlink\" title=\"项目模块\"></a>项目模块</h3><ul>\n<li>现在演示的<code>v1.0.0</code>的代码</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>dubbo-micro-service-consumer<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span>  // 消费者</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>dubbo-micro-service-provider<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span>  // 生产者</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>dubbo-micro-service-zookeeper<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span> // 注册中心</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>dubbo-micro-service-api<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span>       // 公用api</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<ul>\n<li>相关依赖处理,主要是处理一个log输出的问题</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 排除掉 zkclient 、Zookeeper、 dubbo log4j 使用slf4j --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-over-slf4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.25<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-beans<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.jboss.netty<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>netty<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.101tec<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zkclient<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- Zookeeper --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.zookeeper<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.4.13<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"dubbo-micro-service-api\"><a href=\"#dubbo-micro-service-api\" class=\"headerlink\" title=\"dubbo-micro-service-api\"></a>dubbo-micro-service-api</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.io.api;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Demo Service interface</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> zengqingfeng</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 2.7.0</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">DefaultDemoServiceI</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 测试</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> name</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">sayHello</span><span class=\"params\">(String name)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"dubbo-micro-service-consumer\"><a href=\"#dubbo-micro-service-consumer\" class=\"headerlink\" title=\"dubbo-micro-service-consumer\"></a>dubbo-micro-service-consumer</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.io.learning.rpc.micro.consumer;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.io.api.DefaultDemoServiceI;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApiController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> DefaultDemoServiceI defaultDemoService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">runner</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> defaultDemoService.sayHello(<span class=\"string\">\"consumer\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.io.learning.rpc.micro.consumer;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.SpringApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.ImportResource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"meta\">@ImportResource</span>(value = &#123;</span><br><span class=\"line\">        <span class=\"string\">\"classpath:dubbo-consumer.xml\"</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppConsumerMain</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        System.setProperty(<span class=\"string\">\"dubbo.application.logger\"</span>,<span class=\"string\">\"slf4j\"</span>);</span><br><span class=\"line\">        SpringApplication.run(AppConsumerMain<span class=\"class\">.<span class=\"keyword\">class</span>, <span class=\"title\">args</span>)</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置文件</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8001</span></span><br><span class=\"line\">  <span class=\"attr\">compression:</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">min-response-size:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"comment\"># undertow</span></span><br><span class=\"line\">  <span class=\"attr\">undertow:</span></span><br><span class=\"line\">    <span class=\"attr\">worker-threads:</span> <span class=\"number\">20</span></span><br><span class=\"line\">    <span class=\"attr\">buffer-size:</span> <span class=\"number\">512</span></span><br><span class=\"line\">    <span class=\"attr\">io-threads:</span> <span class=\"number\">2</span></span><br><span class=\"line\">    <span class=\"attr\">access-log:</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">dir:</span> <span class=\"string\">target/logs</span></span><br><span class=\"line\">      <span class=\"attr\">pattern:</span> <span class=\"string\">combined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">consumer-spring-boot-starter</span></span><br><span class=\"line\">  <span class=\"attr\">devtools:</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xmlns:dubbo</span>=<span class=\"string\">\"http://code.alibabatech.com/schema/dubbo\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:application</span> <span class=\"attr\">name</span>=<span class=\"string\">\"consumer-spring-boot-starter\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:consumer</span> <span class=\"attr\">timeout</span>=<span class=\"string\">\"5000\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:registry</span> <span class=\"attr\">address</span>=<span class=\"string\">\"zookeeper://127.0.0.1:2181\"</span> <span class=\"attr\">check</span>=<span class=\"string\">\"false\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:reference</span> <span class=\"attr\">id</span>=<span class=\"string\">\"defaultDemoServiceI\"</span> <span class=\"attr\">interface</span>=<span class=\"string\">\"cn.z201.io.api.DefaultDemoServiceI\"</span> <span class=\"attr\">check</span>=<span class=\"string\">\"false\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"dubbo-micro-service-provider\"><a href=\"#dubbo-micro-service-provider\" class=\"headerlink\" title=\"dubbo-micro-service-provider\"></a>dubbo-micro-service-provider</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.io.learning.rpc.micro.provider.service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.io.api.DefaultDemoServiceI;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Default &#123;<span class=\"doctag\">@link</span> DefaultDemoServiceImpl&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> zengqingfeng</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@see</span> DefaultDemoServiceImpl</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@since</span> 2.7.0</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DefaultDemoServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">DefaultDemoServiceI</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * The default value of $&#123;dubbo.application.name&#125; is $&#123;spring.application.name&#125;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;spring.name&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String serviceName;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">sayHello</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> String.format(<span class=\"string\">\"[%s] : Hello, %s\"</span>, serviceName, name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.io.learning.rpc.micro.provider;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.SpringApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.ImportResource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@ImportResource</span>(value = &#123;</span><br><span class=\"line\">        <span class=\"string\">\"classpath:dubbo-provider.xml\"</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppProviderMain</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        System.setProperty(<span class=\"string\">\"dubbo.application.logger\"</span>,<span class=\"string\">\"slf4j\"</span>);</span><br><span class=\"line\">        SpringApplication.run(AppProviderMain<span class=\"class\">.<span class=\"keyword\">class</span>, <span class=\"title\">args</span>)</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            System.in.read(); <span class=\"comment\">// 没有使用http容器启动，防止程序直接运行结束。</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置文件</li>\n</ul>\n<figure class=\"highlight yaml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">provider-spring-boot-starter</span></span><br><span class=\"line\">  <span class=\"attr\">devtools:</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xmlns:dubbo</span>=<span class=\"string\">\"http://code.alibabatech.com/schema/dubbo\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:application</span> <span class=\"attr\">name</span>=<span class=\"string\">\"provider-spring-boot-starter\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">dubbo:application</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:registry</span> <span class=\"attr\">address</span>=<span class=\"string\">\"zookeeper://127.0.0.1:2181\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:protocol</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dubbo\"</span> <span class=\"attr\">port</span>=<span class=\"string\">\"20881\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:service</span> <span class=\"attr\">interface</span>=<span class=\"string\">\"cn.z201.io.api.DefaultDemoServiceI\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"defaultDemoServiceImpl\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"defaultDemoServiceImpl\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"cn.z201.io.learning.rpc.micro.provider.service.DefaultDemoServiceImpl\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"dubbo-micro-service-zookeeper\"><a href=\"#dubbo-micro-service-zookeeper\" class=\"headerlink\" title=\"dubbo-micro-service-zookeeper\"></a>dubbo-micro-service-zookeeper</h3><blockquote>\n<p>这个就不贴代码了，单独跑个zk是一样的。只不过我吧dubbo官方的demo代码复制过来了。</p>\n</blockquote>\n<h3 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Dubbo/dubbo-xml.png\"></p>\n<ul>\n<li><code>访问 http://127.0.0.1:8001/</code> 显示<code>[dubbo-spring-boot-starter] : Hello, consumer</code>。</li>\n</ul>\n","categories":["Spring"],"tags":["Java","Spring","Dubbo"]},{"title":"Centos7-Install-cmake","url":"/posts/2544953906/","content":"<blockquote>\n<p>前年的笔记内容，被我翻出来了。</p>\n</blockquote>\n<h1 id=\"Centos7-install-cmake\"><a href=\"#Centos7-install-cmake\" class=\"headerlink\" title=\"Centos7-install-cmake\"></a>Centos7-install-cmake</h1><blockquote>\n<p>CMake是一个跨平台的安装（<a href=\"https://baike.baidu.com/item/%E7%BC%96%E8%AF%91\" target=\"_blank\" rel=\"noopener\">编译</a>）工具，可以用简单的语句来描述所有平台的安装(编译过程)。他能够输出各种各样的makefile或者project文件，能测试<a href=\"https://baike.baidu.com/item/%E7%BC%96%E8%AF%91%E5%99%A8\" target=\"_blank\" rel=\"noopener\">编译器</a>所支持的C++特性,类似UNIX下的automake。只是 CMake 的<a href=\"https://baike.baidu.com/item/%E7%BB%84%E6%80%81%E6%A1%A3\" target=\"_blank\" rel=\"noopener\">组态档</a>取名为 CMakeLists.txt。Cmake 并不直接建构出最终的软件，而是产生标准的建构档（如 Unix 的 Makefile 或 Windows Visual C++ 的 projects/workspaces），然后再依一般的建构方式使用。这使得熟悉某个<a href=\"https://baike.baidu.com/item/%E9%9B%86%E6%88%90%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83\" target=\"_blank\" rel=\"noopener\">集成开发环境</a>（IDE）的开发者可以用标准的方式建构他的软件，这种可以使用各平台的原生建构系统的能力是 CMake 和 SCons 等其他类似系统的区别之处。</p>\n</blockquote>\n<h2 id=\"部署过程\"><a href=\"#部署过程\" class=\"headerlink\" title=\"部署过程\"></a>部署过程</h2><h3 id=\"1-下载cmake-Source-Code\"><a href=\"#1-下载cmake-Source-Code\" class=\"headerlink\" title=\"1.下载cmake Source Code\"></a>1.下载cmake Source Code</h3><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;cmake.org&#x2F;files&#x2F;v3.3&#x2F;cmake-3.3.2.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-解压缩\"><a href=\"#2-解压缩\" class=\"headerlink\" title=\"2.解压缩\"></a>2.解压缩</h3><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">tar xzvf cmake-3.3.2.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-执行引导命令\"><a href=\"#3-执行引导命令\" class=\"headerlink\" title=\"3.执行引导命令\"></a>3.执行引导命令</h3><ul>\n<li>注意：此时会检查gcc ,gcc-c++,是否安装和版本，如果没有请先安装。</li>\n<li>进入到cmake文件夹中执行</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install gcc</span><br><span class=\"line\">yum install gcc-c++</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">cd cmake-3.3.2  </span><br><span class=\"line\">.&#x2F;bootstrap</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-执行make\"><a href=\"#4-执行make\" class=\"headerlink\" title=\"4.执行make\"></a>4.执行make</h3><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">gmake</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-执行安装（root权限）\"><a href=\"#5-执行安装（root权限）\" class=\"headerlink\" title=\"5.执行安装（root权限）\"></a>5.执行安装（root权限）</h3><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n\n","categories":["Dev"],"tags":["Linux","Cmake"]},{"title":"后端应用性能指标","url":"/posts/3066404175/","content":"<h2 id=\"后端应用性能指标\"><a href=\"#后端应用性能指标\" class=\"headerlink\" title=\"后端应用性能指标\"></a>后端应用性能指标</h2><blockquote>\n<p>很久以前的笔记，被翻出来了。</p>\n</blockquote>\n<h3 id=\"吞吐量、PV、QPS、TPS、RPS、I-O负载概念。\"><a href=\"#吞吐量、PV、QPS、TPS、RPS、I-O负载概念。\" class=\"headerlink\" title=\"吞吐量、PV、QPS、TPS、RPS、I/O负载概念。\"></a>吞吐量、PV、QPS、TPS、RPS、I/O负载概念。</h3><blockquote>\n<p><strong>吞吐量</strong>:指单位时间内系统处理用户的请求数,不同的角度评估方式也不同。</p>\n<p>**PV **  :  是Page View的缩写。来自浏览器的一次html内容请求会被看作一个PV。</p>\n<p><strong>QPS</strong>：Queries Per Second意思是“每秒查询率”，是一台服务器每秒能够相应的查询次数，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。</p>\n<p><strong>TPS：</strong>是Transactions Per Second的缩写，也就是事务数/秒。它是软件测试结果的测量单位。一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数，</p>\n<p><strong>RPS</strong> : 是Requests Per Second的缩写,指并发数/平均响应时间。</p>\n<p><strong>I/0</strong> 负载: I/O 是 input/output的缩写，即输入输出端口。每个设备都会有一个专用的I/O地址，用来处理自己的输入输出信息。一个系统要能正确工作，必须要有数据通道（data paths）的机制，软件和硬件系统都概莫能外。对于计算机系统而言，必须要有data paths的机制来确保CPU, RAM和I/O设备之间的信息数据能正确的流动。这些data paths,通常被称为总线(BUS)，是计算机内部主要的通信通道。若想深入可以参考  <a href=\"https://book.douban.com/subject/1776614/\" target=\"_blank\" rel=\"noopener\">Understanding the Linux Kernel</a>。</p>\n</blockquote>\n<ul>\n<li>在技术人员的职业生涯中，总是不断开发新的系统。在设计系统的时候，因场景、时间而异。一个系统并不是开始就能设计的非常完美，绝对多数的情况是在有限的资源，优先解决核心问题。并预测可能发生的问题，通过反复迭代的逐步消除痛点。这本身是一个持久性的过程。但是早期优良的架构设计能为未来的工作带来非常大的帮助，如何去评判设计是否合理需要数据佐证。吞吐量、PV、QPS、TPS、RPS、I/O这些指标早设计初期能为开发人员提供非常大的帮助。</li>\n</ul>\n<h2 id=\"参考定律\"><a href=\"#参考定律\" class=\"headerlink\" title=\"参考定律\"></a>参考定律</h2><blockquote>\n<p>在设计系统时，应该多思考**<a href=\"http://wiki.mbalib.com/wiki/%E5%A2%A8%E8%8F%B2%E5%AE%9A%E5%BE%8B\" target=\"_blank\" rel=\"noopener\">墨菲定律</a>**</p>\n<ul>\n<li>任何事情都没表面看起来那么简单。</li>\n<li>所以事情都会比你预期的时间长。</li>\n<li>可能出错的事情总会出错。</li>\n<li>如果你担心某一件发生，那么它就更有可能发生。</li>\n</ul>\n<p>在系统划分的时，也要思考**<a href=\"http://www.melconway.com/Home/Conways_Law.html?spm=5176.100239.blogcont8611.8.e7792abC1tP3C\" target=\"_blank\" rel=\"noopener\">康威定律 </a>** </p>\n<ul>\n<li>系统架构是公司组织架构的反映。</li>\n<li>应该按照业务闭环进行系统拆分/组织架构拆分,实现闭环/高内聚/低耦合,减少沟通成本。</li>\n<li>在合适的时间进行系统拆分,不要一开始就吧系统/服务拆分非常细。虽然闭环，但是每个人维护的系统多,维护成本高。</li>\n</ul>\n<p>​                                                            —亿级流量网站架构核心技术 </p>\n</blockquote>\n<a id=\"more\"></a>\n\n<h3 id=\"TPS-吞吐量\"><a href=\"#TPS-吞吐量\" class=\"headerlink\" title=\"TPS(吞吐量)\"></a>TPS(吞吐量)</h3><blockquote>\n<p>一个系统的承压能力。单位时间内完成的工作量的量度。通常，平均响应时间越短，系统吞吐量越大；平均响应时间越长，系统吞吐量越小。但是，系统吞吐量越大，未必平均响应时间越短。因为在某些情况（例如，不增加任何硬件配置）吞吐量的增大，有时会把平均响应时间作为牺牲，来换取一段时间处理更多的请求。</p>\n</blockquote>\n<ul>\n<li>影响吞吐量的几个重要参数指标<ul>\n<li>QPS、TPS、并发数、响应。</li>\n</ul>\n</li>\n<li>名词概述<ul>\n<li><strong>并发数</strong> ： 系统同时处理的 reqeust / 事物数。</li>\n<li><strong>响应时间</strong> :  一般取reqeust的平均响应时间，很大程度上受客户端环境因素影响。</li>\n<li><strong>TPS</strong> （<strong>QPS</strong> ）: 并发数 / 响应时间。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"系统响应时间计算\"><a href=\"#系统响应时间计算\" class=\"headerlink\" title=\"系统响应时间计算\"></a><strong>系统响应时间计算</strong></h4><ul>\n<li><p>用于测量完成一个特定请求需要花费多少时间。它是一个非常重要的度量值因为它是用户体验的一个指数。尽管这样，你必须确保你理解你测量的是什么：</p>\n<ul>\n<li>系统级的反应时间。</li>\n<li>组件级的反应时间。</li>\n</ul>\n</li>\n<li><p>它们是完全不同的，因为系统级包括像队列时间这样的变量是差别很大的。</p>\n</li>\n<li><p>值得注意的是，响应时间同时也是不容易测量的度量值，因为它比其它的度量值更容易变化。因此你必需了解反应时间的分布。如果应用对你大部分用户的反应时间是2秒钟，而对10％用户的反应时间却是10秒钟，在这种情况下，你必须知道这个反应时间的分布，才能精确地评估该问题和解决它。这就要测量它们的反应时间并且得到它们的标准偏差，理想的情况是用一个柱状图把反应时间的分布显示出来。</p>\n</li>\n<li><p>举个🌰 场景：</p>\n<ul>\n<li>一位用户通过浏览器访问网站查看新闻。<strong>栗子中每个操作用别名代替，比如客户请求服务器过程、时间同称N1。</strong></li>\n</ul>\n</li>\n<li><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/web/%E5%90%9E%E5%90%90%E9%87%8F%E6%A0%97%E5%AD%90.svg\"></p>\n</li>\n<li><p>实线（请求），虚线（响应）。</p>\n</li>\n<li><p>网络传输时间: N1+N2 。</p>\n</li>\n<li><p>应用服务器处理时间: A1 + A11 <strong>OR</strong> A2 + A22。</p>\n</li>\n<li><p>数据库服务器处理时间: D1 + D11 <strong>OR</strong> D2 + D22。</p>\n</li>\n<li><p>响应时间  N1+N2+A1+A11+D1+D11 <strong>OR</strong> N1 + N2 + A2 + A22 + D2 + D22。</p>\n</li>\n<li><p>假设参数耗时 : </p>\n<ul>\n<li>N1 = 150ms ; N2 = 200ms。</li>\n<li>A1 = 10ms ; A11 = 10ms ; A2 = 10ms ；A22 = 10ms 。</li>\n<li>D1 = 10ms ; D11 = 20ms ; D2 = 20ms  ; D22 = 30。</li>\n</ul>\n</li>\n<li><p><strong>单次reqeust</strong> 。</p>\n<ul>\n<li>流程：<strong>P1</strong> = N1–&gt; A1 – &gt; D1 –&gt; D11 – &gt; A11 –&gt; N2。<ul>\n<li>耗时：<strong>T1</strong> = N1 + A1 + D1 + D11 + A11 + N2。</li>\n</ul>\n</li>\n<li>请求一次网站首页响应时间： 150 + 200 +  10 + 10 + 10 + 20 = 400，也就是客户请求网站地址的那一刻到看到网站至少需要400ms（半秒）。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"并发用户数的计算公式\"><a href=\"#并发用户数的计算公式\" class=\"headerlink\" title=\"并发用户数的计算公式\"></a>并发用户数的计算公式</h4><ul>\n<li>系统用户数: 系统额定的用户数量，如一个OA系统，可能使用该系统的用户总数是4000个，那么这个数量，就是系统用户数。</li>\n<li>同时在线用户数: 在一定的时间范围内，最大的同时在线用户数量。</li>\n<li>同时在线用户数 = 每秒请求数RPS(吞吐量) + 并发连接数 + 平均用户思考时间。</li>\n<li>平均并发用户数的计算: C = nL / T<ul>\n<li>C是平均的并发用户数。</li>\n<li>n是平均每天访问用户数(login session)。</li>\n<li>L是一天内用户从登录到退出的平均时间(login session的平均时间)。</li>\n<li>T是考察时间长度(一天内多长时间有用户使用系统)。</li>\n</ul>\n</li>\n<li>并发用户数峰值计算: C^约等于C + 3* 根号C 其中 C^ 是并发用户峰值，C 是平均并发用户数，该公式遵循泊松分布理论。</li>\n</ul>\n<h4 id=\"吞吐量的计算公式\"><a href=\"#吞吐量的计算公式\" class=\"headerlink\" title=\"吞吐量的计算公式\"></a>吞吐量的计算公式</h4><ul>\n<li>从业务角度看<ul>\n<li>吞吐量可以用<ul>\n<li>请求数/秒。</li>\n<li>页面数/秒。</li>\n<li>人数/天或处理业务数/小时等单位来衡量。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>从网络角度看，吞吐量可以用:<ul>\n<li>字节/秒来衡量</li>\n</ul>\n</li>\n<li>对于交互式应用来说，吞吐量指标反映的是服务器承受的压力，他能够说明系统的负载能力。</li>\n<li>以不同方式表达的吞吐量可以说明不同层次的问题，例如：<ul>\n<li>以字节数/秒方式可以表示数要受网络基础设施、服务器架构、应用服务器制约等方面的瓶颈。</li>\n<li>已请求数/秒的方式表示主要是受应用服务器和应用代码的制约体现出的瓶颈。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"思考时间的计算公式\"><a href=\"#思考时间的计算公式\" class=\"headerlink\" title=\"思考时间的计算公式\"></a><strong>思考时间的计算公式</strong></h4><ul>\n<li><p>Think Time，从业务角度来看，这个时间指用户进行操作时每个请求之间的时间间隔，为了模拟这样的时间间隔，引入了思考时间这个概念，来更加真实的模拟用户的操作。<br>在吞吐量这个公式中 F = VU * R / T说明吞吐量 F 是 VU 数量、每个用户发出的请求数 R 和时间 T 的函数，而其中的 R 又可以用时间T和用户思考时间 TS 来计算：R = T / TS<br>下面给出一个计算思考时间的一般步骤：</p>\n<ul>\n<li><p>首先计算出系统的并发用户数</p>\n<p>C = nL / TF = R × C</p>\n</li>\n<li><p>统计出系统平均的吞吐量</p>\n<p>F= VU * R / T R × C = VU * R / T</p>\n</li>\n<li><p>统计出平均每个用户发出的请求数量</p>\n<p>R= u<em>C</em>T / VU</p>\n</li>\n<li><p>根据公式计算出思考时间</p>\n<p>TS= T / R</p>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"因素（指标）\"><a href=\"#因素（指标）\" class=\"headerlink\" title=\"因素（指标）\"></a>因素（指标）</h4><ul>\n<li><p><strong>资源利用率</strong></p>\n<blockquote>\n<p>这里所谓的资源是对于系统中的一个抽象的概念，它包括很多方面</p>\n</blockquote>\n<ol>\n<li>reqeust  对 cpu 的消耗：单个reqeust对CPU消耗越高，外部系统接口、IO影响速度越慢，系统吞吐能力越低，反之越高。</li>\n<li>内存负载： 系统对系统内存、vm虚拟内存、swap交换区的使用情况。</li>\n<li>iO负载消耗 (<strong>这里的IO负载是指硬盘IO ，并不是网络IO</strong>): 系统在运行中常常会涉及到大量的磁盘读写操作。磁盘有两个重要的参数: Seek time、 Rotational latency。正常的I/O计数为：1000/(Seek time+Rotational latency)*0.75    在此范围内属正常。当达到85％的I/O计数以上时则基本认为已经存在I/O瓶劲。理论情况下，磁盘的随机读计数为125、顺序读计数为225。对于数据文件而言是随机读写，日志文件是顺序读写。</li>\n</ol>\n</li>\n<li><p><strong>外部接口</strong></p>\n<ol>\n<li>一个系统会将系统内的功能封装成接口(RESTFUL、SOAP)的形式向外部提供，这些外部接口和内部的代码处理逻辑是强关联的。比如使用到支付包，在一个支付reqeust中需要发起对支付接口的请求完成整个业务流程。</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"2、PV\"><a href=\"#2、PV\" class=\"headerlink\" title=\"2、PV\"></a>2、PV</h3><ul>\n<li>PV（page view）即页面浏览量，通常是衡量一个网络新闻频道或网站甚至一条网络新闻的主要指标。网页浏览数（page view）是评价网站流量最常用的指标之一，简称为PV。搜索引擎会根据网站的PV来判断网站的好与坏，是影响网站排名的重要因素之一。</li>\n<li>一般看新闻也就集中在早上、中午、晚上。假设早上7:30 - 8:30网站有会很大访问量大概3500左右。</li>\n<li><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/web/%E7%BD%91%E7%AB%99PV.png\"></li>\n</ul>\n<h3 id=\"3、QPS、TPS\"><a href=\"#3、QPS、TPS\" class=\"headerlink\" title=\"3、QPS、TPS\"></a>3、QPS、TPS</h3><blockquote>\n<p>每秒钟request/事务数量，一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。</p>\n</blockquote>\n<ol>\n<li><p>事务可以从客户端角度进行定义。如：</p>\n<ol>\n<li>一个登录的POST请求可定义为一个事务。</li>\n<li>一个文件上传下载的动作也可定义为一个事务。</li>\n<li>一组连续的请求操作也可定义一个事务。</li>\n</ol>\n</li>\n<li><p>事务也可从服务器端定义，如：</p>\n<ol>\n<li>执行一个数据库事务。</li>\n<li>执行一段存储过程。</li>\n<li>执行一个服务器请求等。</li>\n</ol>\n<p>理解了事务，再理解TPS，TPS需要结合性能测试场景来说明：</p>\n<ol>\n<li>单体<ol>\n<li>本次测试只测登录这一功能，便于分析和寻找瓶颈。</li>\n<li>也可做并发测试。</li>\n<li>TPS = 总事务数 / 总时间(秒)。</li>\n</ol>\n</li>\n<li>混合<ol>\n<li>多种模块一起进行测试，更符合真实场景，便于对服务器的整体处理能力进行评估。</li>\n<li>TPS=单个事务的TPS总和。</li>\n</ol>\n</li>\n</ol>\n</li>\n<li><p>大多数情况下，我们使用加权协函数平均方法来计算客户机的得分，利用客户机的这些信息使用加权协函数平均方法来计算服务器端的整体TPS得分。</p>\n</li>\n</ol>\n<h3 id=\"5、RPS\"><a href=\"#5、RPS\" class=\"headerlink\" title=\"5、RPS\"></a>5、RPS</h3><blockquote>\n<p>每秒请求数，这里还有两个我们通常认为和RPS相等的名词，arrival rate、TPS。</p>\n</blockquote>\n<h3 id=\"6、IO\"><a href=\"#6、IO\" class=\"headerlink\" title=\"6、IO\"></a>6、IO</h3>","categories":["性能优化"],"tags":["吞吐量","PV","QPS","TPS","RPS"]},{"title":"面试题-递归","url":"/posts/2136713508/","content":"<blockquote>\n<p>上周的一道笔试题</p>\n</blockquote>\n<h3 id=\"递归计算\"><a href=\"#递归计算\" class=\"headerlink\" title=\"递归计算\"></a>递归计算</h3><blockquote>\n<p>根据两组参数，使用递归完成编程。</p>\n<p>递归方法 </p>\n<p>​    参数1 [1,3]</p>\n<p>​    参数2 n</p>\n<p>当参数2 &lt; 小于参数1中元素个数的时候，不输出。</p>\n<p>当n = 3 时 输出 [1,3,4]</p>\n<p>当n = 4 时 输出 [1,3,4,7]</p>\n<p>当 n = 11 使用递归程序输出</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">(List&lt;Integer&gt; list , Integer end)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(list.isEmpty() || list.size() &lt; <span class=\"number\">1</span> || end == <span class=\"keyword\">null</span> || end &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">\"初始化参数异常\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (list.size() &lt; end) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> length = list.size();</span><br><span class=\"line\">        list.add(list.get(length - <span class=\"number\">1</span>) + list.get(length - <span class=\"number\">2</span>));</span><br><span class=\"line\">        test(list , end);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">    Integer[] arr = <span class=\"keyword\">new</span> Integer[]&#123;<span class=\"number\">1</span>,<span class=\"number\">3</span>&#125;;</span><br><span class=\"line\">    List&lt;Integer&gt; list = <span class=\"keyword\">new</span> ArrayList(Arrays.asList(arr));</span><br><span class=\"line\">    test(list , <span class=\"number\">11</span>);</span><br><span class=\"line\">    System.out.println(list.toString());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&gt;&gt; </span><br><span class=\"line\">[<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">7</span>, <span class=\"number\">11</span>, <span class=\"number\">18</span>, <span class=\"number\">29</span>, <span class=\"number\">47</span>, <span class=\"number\">76</span>, <span class=\"number\">123</span>, <span class=\"number\">199</span>]</span><br></pre></td></tr></table></figure>\n\n<p>不过当时写的时候并没有判断异常。当时紧张硬编码。</p>\n<h3 id=\"古典问题：⼀对兔⼦\"><a href=\"#古典问题：⼀对兔⼦\" class=\"headerlink\" title=\"古典问题：⼀对兔⼦\"></a>古典问题：⼀对兔⼦</h3><blockquote>\n<p>有⼀对兔⼦，从出⽣后第 3 个⽉起每个⽉都⽣⼀对兔⼦，⼩兔⼦⻓到第三个⽉后每个⽉⼜⽣⼀对兔⼦，</p>\n<p>假如兔⼦都不死，问每个⽉的兔⼦对数为多少？</p>\n<p>思路：斐波那契数列（Fibonacci sequence）</p>\n<p>程序分析： 兔⼦的规律为数列 1,1,2,3,5,8,13,21…，当 n=1 或 n=2时，分别为 1。 </p>\n<p>从 n=3 开始 f(n) = f(n-1) + f(n-2)。所以转化为程序则如下：</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> n = <span class=\"number\">10</span>;</span><br><span class=\"line\">\tSystem.out.println(<span class=\"string\">\"第\"</span> + n + <span class=\"string\">\"个⽉兔⼦总数为\"</span> + fun(n));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">fun</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (n == <span class=\"number\">1</span> || n == <span class=\"number\">2</span>)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> fun(n - <span class=\"number\">1</span>) + fun(n - <span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使⽤递归实现-n-的阶乘\"><a href=\"#使⽤递归实现-n-的阶乘\" class=\"headerlink\" title=\"使⽤递归实现 n! 的阶乘\"></a>使⽤递归实现 <strong>n!</strong> 的阶乘</h3><blockquote>\n<p>思路：求⼀个数的阶乘，既可以使⽤循环，也可以使⽤递归。本地要求使⽤递归。</p>\n<p>把公式分解后 n! = n*(n-1)! ；但是 1的阶乘为 1。所以我们可以定义⼀个⽅法 jie(int n)，假定⽅法就是</p>\n<p>求阶乘的⽅法，则每次 n! = n * jie(n-1)。这样就实现了⽅法逻辑了。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> n = <span class=\"number\">10</span>;</span><br><span class=\"line\">\tSystem.out.println(n+<span class=\"string\">\"阶乘为：\"</span> + jie(n));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">jie</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(n==<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"> \t&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> n*jie(n-<span class=\"number\">1</span>);</span><br><span class=\"line\"> \t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"⽤递归实现字符串倒转\"><a href=\"#⽤递归实现字符串倒转\" class=\"headerlink\" title=\"⽤递归实现字符串倒转\"></a>⽤递归实现字符串倒转</h3><blockquote>\n<p>思路：字符串倒序可以有多种实现⽅法，但是本地要求递归。所以我们需要找出相同的可以重复的⽅法来递归完成。</p>\n<p>例如：“hello”</p>\n<ul>\n<li><p>第⼀次：截取第⼀个字符“h”，截取剩下“ello”，使⽤“ello”+“h”；</p>\n</li>\n<li><p>第⼆次：那么“ello”字符串，可以使⽤相同的⽅法，“llo”+“e”；</p>\n</li>\n<li><p>第三次：“lo”+“l”；</p>\n</li>\n<li><p>第四次：“o”+“l”；</p>\n</li>\n<li><p>第五次：“o”⻓度已经是⼀个了，所以依次返回给上⼀步“olleh”。</p>\n</li>\n</ul>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StringReverse</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">reverse</span><span class=\"params\">(String originStr)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(originStr == <span class=\"keyword\">null</span> || originStr.length()== <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> originStr;</span><br><span class=\"line\"> \t\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> reverse(originStr.substring(<span class=\"number\">1</span>))+ originStr.charAt(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">\tSystem.out.println(reverse(<span class=\"string\">\"hello\"</span>));</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n","categories":["面试"],"tags":["递归"]},{"title":"Centos7-Install-ELK","url":"/posts/1715256040/","content":"<blockquote>\n<p>18年年初的笔记，被我翻出来了。</p>\n</blockquote>\n<h1 id=\"EL-B-K平台\"><a href=\"#EL-B-K平台\" class=\"headerlink\" title=\"EL(B)K平台\"></a>EL(B)K平台</h1><blockquote>\n<p>Elastic Stack（旧称ELK Stack），是一种能够从任意数据源抽取数据，并实时对数据进行搜索、分析和可视化展现的数据分析框架。（hadoop同一个开发人员）</p>\n<p><a href=\"https://www.elastic.co/cn/products\" target=\"_blank\" rel=\"noopener\">elastic 官网</a></p>\n</blockquote>\n<h2 id=\"EL-B-K是啥技术\"><a href=\"#EL-B-K是啥技术\" class=\"headerlink\" title=\"EL(B)K是啥技术\"></a>EL(B)K是啥技术</h2><ul>\n<li>java 开发的开源的全文搜索引擎工具。</li>\n<li>基于lucence搜索引擎的。</li>\n<li>采用 restful - api 标准的。</li>\n<li>高可用、高扩展的分布式框架。</li>\n<li>实时数据分析的。</li>\n</ul>\n<h3 id=\"E\"><a href=\"#E\" class=\"headerlink\" title=\"E\"></a>E</h3><blockquote>\n<p>Elasticsearch 是基于 JSON 的分布式搜索和分析引擎，专为实现水平扩展、高可用和管理便捷性而设计。</p>\n</blockquote>\n<h3 id=\"L\"><a href=\"#L\" class=\"headerlink\" title=\"L\"></a>L</h3><blockquote>\n<p>Logstash 是动态数据收集管道，拥有可扩展的插件生态系统，能够与 Elasticsearch 产生强大的协同作用。</p>\n</blockquote>\n<h3 id=\"B\"><a href=\"#B\" class=\"headerlink\" title=\"B\"></a>B</h3><blockquote>\n<p>Beats 是轻量型采集器的平台，从边缘机器向 Logstash 和 Elasticsearch 发送数据。</p>\n</blockquote>\n<h3 id=\"K\"><a href=\"#K\" class=\"headerlink\" title=\"K\"></a>K</h3><blockquote>\n<p>Kibana 能够以图表的形式呈现数据，并且具有可扩展的用户界面，供您全方位配置和管理 Elastic Stack。</p>\n</blockquote>\n<h2 id=\"下载程序\"><a href=\"#下载程序\" class=\"headerlink\" title=\"下载程序\"></a>下载程序</h2><a id=\"more\"></a>\n\n<h3 id=\"下载Logstash\"><a href=\"#下载Logstash\" class=\"headerlink\" title=\"下载Logstash\"></a>下载Logstash</h3><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;downloads&#x2F;logstash&#x2F;logstash-5.6.3.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载Elasticsearch\"><a href=\"#下载Elasticsearch\" class=\"headerlink\" title=\"下载Elasticsearch\"></a>下载Elasticsearch</h3><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;downloads&#x2F;elasticsearch&#x2F;elasticsearch-5.6.3.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载Kibana\"><a href=\"#下载Kibana\" class=\"headerlink\" title=\"下载Kibana\"></a>下载Kibana</h3><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;downloads&#x2F;kibana&#x2F;kibana-5.6.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"测试运行\"><a href=\"#测试运行\" class=\"headerlink\" title=\"测试运行\"></a>测试运行</h2><h3 id=\"Logstash\"><a href=\"#Logstash\" class=\"headerlink\" title=\"Logstash\"></a>Logstash</h3><ul>\n<li>解压</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">tar -zxvf logstash-5.6.3.tar.gz</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>默认解压后是没有配置文件的,需要手动创建一个。文件名<code>logstarsh.conf</code>这里只是让它正常启动。填写基本配置。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">input&#123;</span><br><span class=\"line\">        stdin&#123;  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">output&#123;</span><br><span class=\"line\">        stdout&#123;</span><br><span class=\"line\">                codec &#x3D;&gt; rubydebug</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>尝试启动logstash并验证是否配置成功，在logstash的解压目录下执行命令：./bin/logstash -f logstash.conf,出现如下截图表明配置成功,从启动信息中也能看出日志路径，端口等信息</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/elk/logstash.png\" alt=\"img\"></p>\n<ul>\n<li>演示启动成功。在交互命令中输入 hello world 会被输出成消息。</li>\n</ul>\n<h3 id=\"Elasticsearch\"><a href=\"#Elasticsearch\" class=\"headerlink\" title=\"Elasticsearch\"></a>Elasticsearch</h3><ul>\n<li>解压</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">tar -zxvf elasticsearch-5.6.3.tar.gz</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>默认自带一个配置文件,需要修改内容。elasticsearch目录下/config/elasticsearch.yml。<ul>\n<li>path.data修改为自己本机的data路径，自定义(这个路径如果不存在的话需要手动去创建)</li>\n<li>path,logs修改为自己本机的logs路径，也是自定义吧（这个路径如果不存在的话，启动elasticsearch会自动创建）</li>\n<li>network.host修改为安装服务器地址</li>\n<li>http.port为http访问端口，默认是9200。</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/elk/es.png\" alt=\"img\"></p>\n<ul>\n<li>测试运行./bin/elasticsearch.</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/elk/es_WARNING.png\" alt=\"img\"></p>\n<ul>\n<li>如果使用root运行会报错，elasticsearch出于安全考虑默认是不能用root去启动的,这是出于系统安全考虑设置的条件,所以为elasticsearch创建一个用户组和用户吧。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;创建elastic 用户组及用户：</span><br><span class=\"line\">groupadd elastic</span><br><span class=\"line\">&#x2F;&#x2F;帐号 elastic 密码 eone</span><br><span class=\"line\">useradd elastic -g elastic -p eone</span><br><span class=\"line\">&#x2F;&#x2F;更改elasticsearch文件夹及内部文件的所属用户及组为elastic:elastic：</span><br><span class=\"line\">chown -R elastic:elastic elasticsearch-5.6.3</span><br><span class=\"line\">&#x2F;&#x2F;切换用户 </span><br><span class=\"line\">su elastic</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>再启动。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/elk/es_WARNING1.png\" alt=\"img\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">切换到root用户编辑limit.conf文件</span><br><span class=\"line\">vi &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br><span class=\"line\">在文件末尾添加</span><br><span class=\"line\">elastic soft nofile 65536</span><br><span class=\"line\">elastic hard nofile 65536</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>再启动</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/elk/es_WARNING2.png\" alt=\"img\"></p>\n<ul>\n<li>采用了虚拟机，所临时修改下。</li>\n</ul>\n<p>*<strong>此操作需要root权限</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# sysctl -w vm.max_map_count&#x3D;2621441</span><br></pre></td></tr></table></figure>\n\n<p>查看修改结果</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# sysctl -a|grep vm.max_map_count</span><br><span class=\"line\">vm.max_map_count &#x3D; 262144</span><br></pre></td></tr></table></figure>\n\n<p>访问Elasticsearch </p>\n<ul>\n<li>注意默认的防火墙，测试环境建议关掉。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/elk/es1.png\" alt=\"img\"></p>\n<ul>\n<li>如果中断掉窗口或者意外退出就导致elasticsearch stop程序。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 启动的时候添加-d 参数后台运行</span><br><span class=\"line\">.&#x2F;bin&#x2F;elasticsearch -d</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Kibana\"><a href=\"#Kibana\" class=\"headerlink\" title=\"Kibana\"></a>Kibana</h3><ul>\n<li>解压</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">tar -zxvf kibana-5.6.3.tar.gz</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改配置文件进入kibana的解压目录的config目录下，编辑kibana.yml，server.port：5601放开，server.host修改为kibana的安装服务器，配置elasticsearch的路径端口</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/elk/kibana.png\" alt=\"img\"></p>\n","categories":["Dev"],"tags":["Centos7","Linux","Elasticsearch","Logstash","Kibana"]},{"title":"Centos7-Install-Sonarqube","url":"/posts/2041777895/","content":"<blockquote>\n<p>18年年初的笔记，被我翻出来了。</p>\n</blockquote>\n<h1 id=\"Sonarqube\"><a href=\"#Sonarqube\" class=\"headerlink\" title=\"Sonarqube\"></a>Sonarqube</h1><blockquote>\n<p>代码质量缺陷检测</p>\n</blockquote>\n<p><a href=\"https://www.sonarqube.org/\" target=\"_blank\" rel=\"noopener\">sonarqube官网</a></p>\n<h2 id=\"安装实例\"><a href=\"#安装实例\" class=\"headerlink\" title=\"安装实例\"></a>安装实例</h2><ul>\n<li>sonarqube6.7.1</li>\n<li>sonar-scanner-cli-3.0.2.768</li>\n</ul>\n<blockquote>\n<p>sonarqube是服务端包含es、ec、web。</p>\n<p>sonar-scanner 客户端主要将代码筛选并上传至sonarqube。</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<h3 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget -c https://sonarsource.bintray.com/Distribution/sonarqube/sonarqube-6.7.1.zip</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h3><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">unzip sonarqube-6.7.1.zip</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"移动\"><a href=\"#移动\" class=\"headerlink\" title=\"移动\"></a>移动</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">mkdir -p /opt/sonarqube</span><br><span class=\"line\">mv ./sonarqube-6.7.1  /opt/sonarqube</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"修改配置\"><a href=\"#修改配置\" class=\"headerlink\" title=\"修改配置\"></a>修改配置</h2><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/sonarqube/sonarqube-6.7.1/conf</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>查看配置文件</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost conf]<span class=\"comment\"># ls</span></span><br><span class=\"line\">sonar.properties  wrapper.conf</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>有两个配置文件</p>\n<ul>\n<li><p>sonar.properties </p>\n</li>\n<li><p>wrapper.conf </p>\n<p>​    配置文件内容较多，简单测试运行只需要修改</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"配置sonar-properties\"><a href=\"#配置sonar-properties\" class=\"headerlink\" title=\"配置sonar.properties\"></a>配置sonar.properties</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/sonarqube/sonar.png\"></p>\n<ul>\n<li>配置web访问权限0.0.0.0 就是大家都可以访问。</li>\n<li>配置port就是web端口号。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/sonarqube/mysql.png\"></p>\n<ul>\n<li>mysql连接，web是需要连接mysql的。主要提前装一个mysql。直接连接进入第一次会自动创建表结构。^_^</li>\n</ul>\n<h3 id=\"配置wrapper-conf\"><a href=\"#配置wrapper-conf\" class=\"headerlink\" title=\"配置wrapper.conf\"></a>配置wrapper.conf</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/sonarqube/wrapper.png\"></p>\n<ul>\n<li>emm简单配置；指向本地java。不指定会出现启动失败的问题。</li>\n</ul>\n<h2 id=\"测试启动\"><a href=\"#测试启动\" class=\"headerlink\" title=\"测试启动\"></a>测试启动</h2><ul>\n<li>不要使用root权限启动，因为elasticsearch作为组件也在里面，</li>\n</ul>\n<blockquote>\n<ul>\n<li>如果使用root运行会报错，elasticsearch出于安全考虑默认是不能用root去启动的,这是出于系统安全考虑设置的条件,所以为elasticsearch创建一个用户组和用户吧。</li>\n</ul>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;sonarqube 用户组及用户：</span><br><span class=\"line\">groupadd sonarqube</span><br><span class=\"line\">&#x2F;&#x2F;帐号 sonarqube 密码 eone</span><br><span class=\"line\">useradd sonarqube -g sonarqube -p eone</span><br><span class=\"line\">&#x2F;&#x2F;更改elasticsearch文件夹及内部文件的所属用户及组为elastic:elastic：</span><br><span class=\"line\">chown -R sonarqube:sonarqube sonarqube</span><br><span class=\"line\">&#x2F;&#x2F;切换用户 </span><br><span class=\"line\">su sonarqube</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"找到启动配置文件。\"><a href=\"#找到启动配置文件。\" class=\"headerlink\" title=\"找到启动配置文件。\"></a>找到启动配置文件。</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">sonarqube/sonarqube-6.7.1/bin/linux-x86-64</span><br></pre></td></tr></table></figure>\n\n<p>配置文件就在bin/***/里面。看你系统是啥就进啥目录。</p>\n<p>我是linux-x86-64所以。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/sonarqube/command.png\"></p>\n<p>不要用root启动不然elasticsearch会启动失败。</p>\n<p>启动完记得检查logs和进程。</p>\n","categories":["Dev"],"tags":["Centos7","Linux","Sonarqube"]},{"title":"Selenium入门","url":"/posts/1476484702/","content":"<h2 id=\"Selenium\"><a href=\"#Selenium\" class=\"headerlink\" title=\"Selenium\"></a>Selenium</h2><blockquote>\n<p>Selenium是最广泛使用的开源Web UI（用户界面）自动化测试套件之一。它最初由Jason Huggins于2004年开发，作为Thought Works的内部工具。Selenium支持跨不同浏览器，平台和编程语言的自动化。</p>\n</blockquote>\n<ul>\n<li><p>Selenium可以轻松部署在Windows，Linux，Solaris和Macintosh等平台上。此外，它支持iOS（iOS，Windows Mobile和Android）等移动应用程序的OS（操作系统）。</p>\n</li>\n<li><p>Selenium通过使用特定于每种语言的驱动程序支持各种编程语言.Selenium支持的语言包括C＃，Java，Perl，PHP，Python和Ruby。目前，Selenium Web驱动程序最受Java和C＃欢迎。Selenium测试脚本可以使用任何支持的编程语言进行编码，并且可以直接在大多数现代Web浏览器中运行。Selenium支持的浏览器包括Internet Explorer，Mozilla Firefox，Google Chrome和Safari。</p>\n</li>\n</ul>\n<h3 id=\"Selenium-WebDriver\"><a href=\"#Selenium-WebDriver\" class=\"headerlink\" title=\"Selenium WebDriver\"></a>Selenium WebDriver</h3><blockquote>\n<p>Selenium WebDriver是Selenium RC的继承者。Selenium WebDriver接受命令（在Selenese中发送，或通过客户端API）并将它们发送到浏览器。这是通过特定于浏览器的浏览器驱动程序实现的，该驱动程序将命令发送到浏览器并检索结果。大多数浏览器驱动程序实际上启动并访问浏览器应用程序。</p>\n</blockquote>\n<ul>\n<li>Selenium WebDriver是Selenium Tool套件中最重要的组件。最新版本“Selenium 2.0”与WebDriver API集成，提供更简单，更简洁的编程接口。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Selenium/selenium-webdriver.png\"></p>\n<h3 id=\"演示项目\"><a href=\"#演示项目\" class=\"headerlink\" title=\"演示项目\"></a><a href=\"https://github.com/z201/code-example/tree/main/Selenium-Tool\" target=\"_blank\" rel=\"noopener\">演示项目</a></h3><h3 id=\"环境配置\"><a href=\"#环境配置\" class=\"headerlink\" title=\"环境配置\"></a>环境配置</h3><blockquote>\n<p>这里选用的是Google Chrome测试套件。</p>\n</blockquote>\n<ul>\n<li><p>注意，使用jdk8。</p>\n</li>\n<li><p>下载ChromeDriver</p>\n<ul>\n<li>由三个独立的部分组成。有浏览器本身（“chrome”），Selenium项目提供的语言绑定（“驱动程序”）和从Chromium项目下载的可执行文件，它充当“chrome”和“driver”之间的桥梁。此可执行文件称为“chromedriver”，但我们将尝试将其称为此页面中的“服务器”以减少混淆。</li>\n<li>根据电脑安装的chrome版本选择合适的版本<a href=\"https://sites.google.com/a/chromium.org/chromedriver/downloads\" target=\"_blank\" rel=\"noopener\">下载地址</a></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"快速安装\"><a href=\"#快速安装\" class=\"headerlink\" title=\"快速安装\"></a>快速安装</h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Mac users with Homebrew installed: </span></span><br><span class=\"line\">brew tap homebrew/cask &amp;&amp; brew cask install chromedriver</span><br><span class=\"line\"><span class=\"comment\"># Debian based Linux distros: </span></span><br><span class=\"line\">sudo apt-get install chromium-chromedriver</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"快速更新\"><a href=\"#快速更新\" class=\"headerlink\" title=\"快速更新\"></a>快速更新</h4><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Mac users with Homebrew reInstall </span></span><br><span class=\"line\">brew cask reinstall chromedriver</span><br><span class=\"line\"><span class=\"comment\"># 如果已经存在新把之前的删除</span></span><br><span class=\"line\">rm /usr/<span class=\"built_in\">local</span>/bin/chromedriver</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h3 id=\"测试代码\"><a href=\"#测试代码\" class=\"headerlink\" title=\"测试代码\"></a>测试代码</h3><ul>\n<li>Pom.xml</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">junit.version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">junit.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">lmbok.version</span>&gt;</span>1.18.4<span class=\"tag\">&lt;/<span class=\"name\">lmbok.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">slf4j.version</span>&gt;</span>1.7.25<span class=\"tag\">&lt;/<span class=\"name\">slf4j.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">logback.version</span>&gt;</span>1.2.3<span class=\"tag\">&lt;/<span class=\"name\">logback.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- pom文件需要指定打包编码集，[WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent!  --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;lmbok.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.google.code.gson<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>gson<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.8.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Jsoup 工具包 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.jsoup<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsoup<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.10.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-java --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.seleniumhq.selenium<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>selenium-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.14.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;junit.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>ch.qos.logback<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>logback-classic<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;logback.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"工具类\"><a href=\"#工具类\" class=\"headerlink\" title=\"工具类\"></a>工具类</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020-08-30</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WebDriverTools</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 创建Chrome浏览器驱动</span></span><br><span class=\"line\"><span class=\"comment\">     * 需要系统已经安装好了chrome浏览器和chromedriver已加入到系统PATH环境变量中</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> WebDriver <span class=\"title\">chromeDriver</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chromeDriver(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> WebDriver <span class=\"title\">chromeDriver</span><span class=\"params\">(Object proxyServer)</span> </span>&#123;</span><br><span class=\"line\">        String osName = System.getProperties().getProperty(<span class=\"string\">\"os.name\"</span>);</span><br><span class=\"line\">        String path = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (osName.equals(<span class=\"string\">\"Linux\"</span>)) &#123;</span><br><span class=\"line\">            path = <span class=\"string\">\"/usr/bin/chromedriver\"</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (osName.equals(<span class=\"string\">\"Mac OS X\"</span>)) &#123;</span><br><span class=\"line\">            path = <span class=\"string\">\"/usr/local/bin/chromedriver\"</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.setProperty(<span class=\"string\">\"webdriver.chrome.chromedriver\"</span>, path);</span><br><span class=\"line\"><span class=\"comment\">//        ChromeDriverService service = new ChromeDriverService.Builder().usingDriverExecutable(new File(path)).usingAnyFreePort().build();</span></span><br><span class=\"line\">        ChromeOptions chromeOptions = <span class=\"keyword\">new</span> ChromeOptions();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != proxyServer) &#123;</span><br><span class=\"line\">            chromeOptions.addArguments(<span class=\"string\">\"--proxy-server=http://\"</span> + proxyServer);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        chromeOptions.addArguments(<span class=\"string\">\"--headless\"</span>);</span><br><span class=\"line\">        chromeOptions.addArguments(<span class=\"string\">\"--disable-gpu\"</span>);</span><br><span class=\"line\">        chromeOptions.addArguments(<span class=\"string\">\"--no-sandbox\"</span>); <span class=\"comment\">//Bypass OS security model</span></span><br><span class=\"line\">        chromeOptions.addArguments(<span class=\"string\">\"--disable-web-security\"</span>);</span><br><span class=\"line\">        chromeOptions.addArguments(<span class=\"string\">\"--ignore-urlfetcher-cert-requests\"</span>);</span><br><span class=\"line\">        chromeOptions.addArguments(<span class=\"string\">\"--disable-renderer-backgrounding\"</span>);</span><br><span class=\"line\">        chromeOptions.addArguments(<span class=\"string\">\"--disable-infobars\"</span>);</span><br><span class=\"line\">        chromeOptions.addArguments(<span class=\"string\">\"--start-maximized\"</span>);</span><br><span class=\"line\">        chromeOptions.addArguments(<span class=\"string\">\"--disable-dev-shm-usage\"</span>);</span><br><span class=\"line\">        chromeOptions.addArguments(<span class=\"string\">\"--log-level=3\"</span>); <span class=\"comment\">// set log level</span></span><br><span class=\"line\">        chromeOptions.addArguments(<span class=\"string\">\"--silent\"</span>);</span><br><span class=\"line\">        chromeOptions.addArguments(<span class=\"string\">\"lang=zh_CN.UTF-8\"</span>);</span><br><span class=\"line\">        chromeOptions.addArguments(<span class=\"string\">\"user-agent=\\\"\"</span> + SpiderProxyTools.randomUserAgent() + <span class=\"string\">\"\\\"\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 创建无界面浏览器对象</span></span><br><span class=\"line\"><span class=\"comment\">//        chromeOptions.setHeadless(true);</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ChromeDriver(chromeOptions);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>运行完上面的代码就完成了最简单的demo。</li>\n</ul>\n","categories":["入门"],"tags":["Selenium","爬虫"]},{"title":"Jjwt-Junti","url":"/posts/3535935197/","content":"<h2 id=\"Jjwt-Junti\"><a href=\"#Jjwt-Junti\" class=\"headerlink\" title=\"Jjwt-Junti\"></a>Jjwt-Junti</h2><blockquote>\n<p>本章内容主要是用来实际运行下jjwt的api，完成相应的单元测试。</p>\n</blockquote>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">junit.version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">junit.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">jjwt.version</span>&gt;</span>0.10.5<span class=\"tag\">&lt;/<span class=\"name\">jjwt.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">lmbok.version</span>&gt;</span>1.18.4<span class=\"tag\">&lt;/<span class=\"name\">lmbok.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2.version</span>&gt;</span>1.4.197<span class=\"tag\">&lt;/<span class=\"name\">h2.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">slf4j.version</span>&gt;</span>1.7.25<span class=\"tag\">&lt;/<span class=\"name\">slf4j.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">logback.version</span>&gt;</span>1.2.3<span class=\"tag\">&lt;/<span class=\"name\">logback.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- pom文件需要指定打包编码集，[WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent!  --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.jsonwebtoken<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jjwt-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;jjwt.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.jsonwebtoken<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jjwt-impl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;jjwt.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.jsonwebtoken<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jjwt-jackson<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;jjwt.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--log --&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>ch.qos.logback<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>logback-classic<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;logback.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 测试框架 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;junit.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.18.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"测试代码\"><a href=\"#测试代码\" class=\"headerlink\" title=\"测试代码\"></a>测试代码</h2><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.java.test.jjwt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.jsonwebtoken.Claims;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.jsonwebtoken.JwtBuilder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.jsonwebtoken.Jwts;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.jsonwebtoken.SignatureAlgorithm;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.jsonwebtoken.security.Keys;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.crypto.SecretKey;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.time.Clock;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.UUID;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JwtExampleTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">createJWT</span><span class=\"params\">(String id, String issuer, String subject, <span class=\"keyword\">long</span> ttlMillis, SecretKey key)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        Clock clock = Clock.systemDefaultZone();</span><br><span class=\"line\">        Date now = <span class=\"keyword\">new</span> Date(clock.millis());</span><br><span class=\"line\">        <span class=\"comment\">//Let's set the JWT Claims</span></span><br><span class=\"line\">        JwtBuilder builder = Jwts.builder()</span><br><span class=\"line\">                .setId(id)</span><br><span class=\"line\">                .setIssuedAt(now)</span><br><span class=\"line\">                .setSubject(subject)</span><br><span class=\"line\">                .setIssuer(issuer)</span><br><span class=\"line\">                .signWith(key);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 设置过期时间</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ttlMillis &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">long</span> expMillis = clock.millis() + ttlMillis;</span><br><span class=\"line\">            Date exp = <span class=\"keyword\">new</span> Date(expMillis);</span><br><span class=\"line\">            builder.setExpiration(exp);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 返回编码之后的字符串</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> builder.compact();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">parseJWT</span><span class=\"params\">(String jwt, SecretKey key)</span> </span>&#123;</span><br><span class=\"line\">        Claims claims = Jwts.parser()</span><br><span class=\"line\">                .setSigningKey(key)</span><br><span class=\"line\">                .parseClaimsJws(jwt).getBody();</span><br><span class=\"line\">        log.info(<span class=\"string\">\"ID: \"</span> + claims.getId());</span><br><span class=\"line\">        log.info(<span class=\"string\">\"Subject: \"</span> + claims.getSubject());</span><br><span class=\"line\">        log.info(<span class=\"string\">\"Issuer: \"</span> + claims.getIssuer());</span><br><span class=\"line\">        log.info(<span class=\"string\">\"Expiration: \"</span> + claims.getExpiration());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testJwt</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//The JWT signature algorithm we will be using to sign the token</span></span><br><span class=\"line\">        SecretKey key = Keys.secretKeyFor(SignatureAlgorithm.HS256);</span><br><span class=\"line\">        String jwt = createJWT(UUID.randomUUID().toString() ,  <span class=\"string\">\"issuer\"</span>  , <span class=\"string\">\"subject\"</span> , <span class=\"number\">10000</span> ,key);</span><br><span class=\"line\">        log.info(<span class=\"string\">\"createJWT &#123;&#125; \"</span> , jwt );</span><br><span class=\"line\">        parseJWT(jwt,key);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">输出</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">22</span>:<span class=\"number\">18</span>:<span class=\"number\">48.641</span> [main] INFO cn.z201.java.test.jjwt.JwtExampleTest - createJWT eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJjNjFmNzNmZi02OTM4LTQ2MDItYTNkNC1hY2FlZmI3N2Q2YTEiLCJpYXQiOjE1NTI3NDU5MjgsInN1YiI6InN1YmplY3QiLCJpc3MiOiJpc3N1ZXIiLCJleHAiOjE1NTI3NDU5Mzh9.t_ra42L21PMVzto1r2x1fSxCRZFkuk0hSzl2k-b-VWA </span><br><span class=\"line\"><span class=\"number\">22</span>:<span class=\"number\">18</span>:<span class=\"number\">48.694</span> [main] INFO cn.z201.java.test.jjwt.JwtExampleTest - ID: c61f73ff-<span class=\"number\">6938</span>-<span class=\"number\">4602</span>-a3d4-acaefb77d6a1</span><br><span class=\"line\"><span class=\"number\">22</span>:<span class=\"number\">18</span>:<span class=\"number\">48.694</span> [main] INFO cn.z201.java.test.jjwt.JwtExampleTest - Subject: subject</span><br><span class=\"line\"><span class=\"number\">22</span>:<span class=\"number\">18</span>:<span class=\"number\">48.694</span> [main] INFO cn.z201.java.test.jjwt.JwtExampleTest - Issuer: issuer</span><br><span class=\"line\"><span class=\"number\">22</span>:<span class=\"number\">18</span>:<span class=\"number\">48.696</span> [main] INFO cn.z201.java.test.jjwt.JwtExampleTest - Expiration: Sat Mar <span class=\"number\">16</span> <span class=\"number\">22</span>:<span class=\"number\">18</span>:<span class=\"number\">58</span> CST <span class=\"number\">2019</span></span><br></pre></td></tr></table></figure>\n\n","categories":["Jjwt"],"tags":["Java","JJWT","Junit4"]},{"title":"源码分析-spring源码环境搭建","url":"/posts/1025319372/","content":"<h2 id=\"0x00-阅读源代码\"><a href=\"#0x00-阅读源代码\" class=\"headerlink\" title=\"0x00 阅读源代码\"></a>0x00 阅读源代码</h2><h3 id=\"下载源代码\"><a href=\"#下载源代码\" class=\"headerlink\" title=\"下载源代码\"></a>下载源代码</h3><ul>\n<li>代码仓库地址 <a href=\"https://gitee.com/Z201/spring-framework.git\" target=\"_blank\" rel=\"noopener\">https://gitee.com/Z201/spring-framework.git</a></li>\n<li>阅读版本号 <code>v5.1.5.RELEASE</code></li>\n<li>下载版本<code>git clone -b v5.1.5.RELEASE https://github.com/spring-projects/spring-framework.git</code><ul>\n<li>由于github下载速度是在太慢了，这里用gitee克隆一个镜像。</li>\n<li>下载版本<code>git clone -b v5.1.5.RELEASE https://gitee.com/Z201/spring-framework.git</code></li>\n</ul>\n</li>\n<li>官方提供的文档<a href=\"https://github.com/spring-projects/spring-framework/blob/master/import-into-idea.md\" target=\"_blank\" rel=\"noopener\"><strong>import-into-idea</strong></a></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">➜  spring-framework git:(master) ./gradlew :spring-oxm:compileTestJava</span><br><span class=\"line\"></span><br><span class=\"line\">Downloading https://services.gradle.org/distributions/gradle-4.10.3-bin.zip</span><br><span class=\"line\">..........................................................................</span><br><span class=\"line\"></span><br><span class=\"line\">Welcome to Gradle 4.10.3!</span><br><span class=\"line\"></span><br><span class=\"line\">Here are the highlights of this release:</span><br><span class=\"line\"> - Incremental Java compilation by default</span><br><span class=\"line\"> - Periodic Gradle caches cleanup</span><br><span class=\"line\"> - Gradle Kotlin DSL 1.0-RC6</span><br><span class=\"line\"> - Nested included builds</span><br><span class=\"line\"> - SNAPSHOT plugin versions <span class=\"keyword\">in</span> the `plugins &#123;&#125;` block</span><br><span class=\"line\"></span><br><span class=\"line\">For more details see https://docs.gradle.org/4.10.3/release-notes.html</span><br><span class=\"line\"></span><br><span class=\"line\">Starting a Gradle Daemon (subsequent builds will be faster)</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; Task :spring-beans:compileTestJava</span><br><span class=\"line\">注: 某些输入文件使用或覆盖了已过时的 API。</span><br><span class=\"line\">注: 有关详细信息, 请使用 -Xlint:deprecation 重新编译。</span><br><span class=\"line\">注: 某些输入文件使用了未经检查或不安全的操作。</span><br><span class=\"line\">注: 有关详细信息, 请使用 -Xlint:unchecked 重新编译。</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; Task :spring-context:compileTestJava</span><br><span class=\"line\">注: 某些输入文件使用或覆盖了已过时的 API。</span><br><span class=\"line\">注: 有关详细信息, 请使用 -Xlint:deprecation 重新编译。</span><br><span class=\"line\">注: 某些输入文件使用了未经检查或不安全的操作。</span><br><span class=\"line\">注: 有关详细信息, 请使用 -Xlint:unchecked 重新编译。</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; Task :spring-oxm:genJaxb</span><br><span class=\"line\">[ant:javac] : warning: <span class=\"string\">'includeantruntime'</span> was not <span class=\"built_in\">set</span>, defaulting to build.sysclasspath=last; <span class=\"built_in\">set</span> to <span class=\"literal\">false</span> <span class=\"keyword\">for</span> repeatable builds</span><br><span class=\"line\"></span><br><span class=\"line\">BUILD SUCCESSFUL <span class=\"keyword\">in</span> 9m 18s</span><br><span class=\"line\">58 actionable tasks: 58 executed</span><br><span class=\"line\">➜  spring-framework git:(master)</span><br></pre></td></tr></table></figure>\n\n<p>如果显示BUILD SUCCESSFUL 说明构建成功了，但是由于项目太大了，所以下面就不介绍模块了。</p>\n","categories":["源码分析"],"tags":["Spring"]},{"title":"Junit4入门","url":"/posts/1499492201/","content":"<blockquote>\n<p>本文主要是为了记录很久以前对Junit的回顾。</p>\n</blockquote>\n<h2 id=\"Junit\"><a href=\"#Junit\" class=\"headerlink\" title=\"Junit\"></a>Junit</h2><blockquote>\n<p>Java开发中使用的最多的测试框架，工作中经常会大量使用。</p>\n</blockquote>\n<h3 id=\"建议遵守约定\"><a href=\"#建议遵守约定\" class=\"headerlink\" title=\"建议遵守约定\"></a>建议遵守约定</h3><ul>\n<li>测试类在test包下（如果是maven结构的项目建议建议不要方在源码中，早期的项目很多是没有区分开的）</li>\n<li>测试类命名xxxTest结尾。</li>\n<li>方法命名testxxxx命名。</li>\n<li>测试方法上必须使用@Test进行修饰。</li>\n<li>测试方法必须使用public void 进行修饰，不能带任何的参数。</li>\n<li>测试类的包应该和被测试类保持一致。</li>\n<li>测试单元中的每个方法必须独立测试，测试方法间不能有任何的依赖。</li>\n</ul>\n<h3 id=\"常用注解\"><a href=\"#常用注解\" class=\"headerlink\" title=\"常用注解\"></a>常用注解</h3><ul>\n<li>@Test(expected = ArithmeticException.class) 预期将抛出一个算术异常。</li>\n<li>@Test(timeout = 10) 改方法调用预期的时间范围 10毫秒，若超时算失败。</li>\n<li>@Ignore 被改注解修饰的方法不会被执行。</li>\n<li>@RunWith 可以更改测试运行器，制定的测试运行器需要继承 org.junit.runner.Runner。</li>\n</ul>\n<a id=\"more\"></a>\n\n<h4 id=\"断言测试\"><a href=\"#断言测试\" class=\"headerlink\" title=\"断言测试\"></a>断言测试</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.java.junit.main;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.hamcrest.CoreMatchers.is;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.junit.Assert.assertArrayEquals;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.junit.Assert.assertEquals;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.junit.Assert.assertFalse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.junit.Assert.assertNotNull;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.junit.Assert.assertNotSame;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.junit.Assert.assertNull;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.junit.Assert.assertSame;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.junit.Assert.assertThat;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.junit.Assert.assertTrue;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.After;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.AfterClass;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.Before;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.BeforeClass;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learn.java.junit.util.Calculate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleTset</span> </span>&#123;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"meta\">@Test</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testSimpleExample</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">\"this is testSimpleExample\"</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    * @BeforeClass 修饰的方法会在所有方法被被调用钱执行,该方法必须是静态的。</span></span><br><span class=\"line\"><span class=\"comment\">    * 在测试类加载就会运行，而且在内存中只会存在一个实例。它比较适合加载配置文件。</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"meta\">@BeforeClass</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">setUpBeforeClass</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception</span>&#123;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">\"this is @BeforeClass\"</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    * @AfterClass 所修饰的方法通常用来对资源的清理，修饰方法必须是静态的。</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"meta\">@AfterClass</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">tearDownAfterClass</span><span class=\"params\">()</span>  <span class=\"keyword\">throws</span> Exception</span>&#123;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">\"this is @AfterClass\"</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    * @Before 修饰的方法会在每个被@Test修饰的方法调用前执行。</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"meta\">@Before</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUp</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">\"this is @setUp\"</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    * @After 修饰的方法会在每个被@Test修饰的方法调用后执行。</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"meta\">@After</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">tearDown</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">\"this is @tearDown\"</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"meta\">@Test</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testSimple</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">      String str_1 = <span class=\"string\">\"this is testSimple\"</span>;</span><br><span class=\"line\">      assertEquals(<span class=\"string\">\"this is testSimple\"</span>, str_1); <span class=\"comment\">//检查两个变量或者等式是否平衡</span></span><br><span class=\"line\">      <span class=\"keyword\">int</span> int_1 = <span class=\"number\">2</span>;</span><br><span class=\"line\">      assertFalse(int_1 ==  <span class=\"keyword\">new</span> Calculate().add(<span class=\"number\">2</span>, <span class=\"number\">1</span>)); <span class=\"comment\">//检查条件是假的</span></span><br><span class=\"line\">      <span class=\"keyword\">int</span> int_2 = <span class=\"number\">3</span>;</span><br><span class=\"line\">      assertTrue(int_2 ==  <span class=\"keyword\">new</span> Calculate().add(<span class=\"number\">2</span>, <span class=\"number\">1</span>)); <span class=\"comment\">//检查条件是真的</span></span><br><span class=\"line\"></span><br><span class=\"line\">      assertNotNull(int_2); <span class=\"comment\">//检查对象不是空的</span></span><br><span class=\"line\"></span><br><span class=\"line\">      assertNull(<span class=\"keyword\">null</span>); <span class=\"comment\">//检查对象是空的</span></span><br><span class=\"line\"></span><br><span class=\"line\">      assertThat(<span class=\"number\">2</span>, is(<span class=\"number\">2</span>)); <span class=\"comment\">//判断2 是不是 2</span></span><br><span class=\"line\"></span><br><span class=\"line\">      String str3 = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">      String str4 = <span class=\"string\">\"abc\"</span>;</span><br><span class=\"line\">      String str5 = <span class=\"string\">\"abc\"</span>;</span><br><span class=\"line\">      String[] expectedArray = &#123;<span class=\"string\">\"one\"</span>, <span class=\"string\">\"two\"</span>, <span class=\"string\">\"three\"</span>&#125;;</span><br><span class=\"line\">      String[] resultArray =  &#123;<span class=\"string\">\"one\"</span>, <span class=\"string\">\"two\"</span>, <span class=\"string\">\"three\"</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//检查两个对象引用是否指向同一个对象</span></span><br><span class=\"line\">      assertSame(str4,str5);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//检查两个对象引用是否不指向同一个对象</span></span><br><span class=\"line\">      assertNotSame(str3,str4);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//检查两个数组是否相等。</span></span><br><span class=\"line\">      assertArrayEquals(expectedArray, resultArray);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>测试类</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.java.junit.util;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Calculate</span> </span>&#123;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">//相加</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> a , <span class=\"keyword\">int</span> b)</span></span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> a + b;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">//相减</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">subtract</span><span class=\"params\">(<span class=\"keyword\">int</span> a , <span class=\"keyword\">int</span> b)</span></span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> a - b;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">//相乘</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">multipy</span><span class=\"params\">(<span class=\"keyword\">int</span> a , <span class=\"keyword\">int</span> b)</span></span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> a * b;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">//相除</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">divide</span><span class=\"params\">(<span class=\"keyword\">int</span> a , <span class=\"keyword\">int</span> b)</span></span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> a / b;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>测试用例</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.java.junit.main;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.junit.Assert.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learn.java.junit.util.Calculate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CalculateTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"meta\">@Test</span>(timeout = <span class=\"number\">10</span>)</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testAdd</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      assertEquals(<span class=\"number\">6</span>, <span class=\"keyword\">new</span> Calculate().add(<span class=\"number\">3</span>, <span class=\"number\">3</span>));</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"meta\">@Test</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testSubtract</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      assertEquals(<span class=\"number\">0</span>, <span class=\"keyword\">new</span> Calculate().subtract(<span class=\"number\">3</span>, <span class=\"number\">3</span>));</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"meta\">@Test</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testMultipy</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      assertEquals(<span class=\"number\">9</span>, <span class=\"keyword\">new</span> Calculate().multipy(<span class=\"number\">3</span>, <span class=\"number\">3</span>));</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"meta\">@Test</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testDivide</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      assertEquals(<span class=\"number\">1</span>, <span class=\"keyword\">new</span> Calculate().divide(<span class=\"number\">3</span>, <span class=\"number\">3</span>));</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"参数化测试\"><a href=\"#参数化测试\" class=\"headerlink\" title=\"参数化测试\"></a>参数化测试</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.java.junit.main;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> org.junit.Assert.assertEquals;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collection;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.runner.RunWith;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.runners.Parameterized;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.runners.Parameterized.Parameters;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learn.java.junit.util.Calculate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 参数化测试</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@RunWith</span>(Parameterized<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">public</span> <span class=\"title\">class</span> <span class=\"title\">ParameterTest</span> </span>&#123;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"keyword\">int</span> expected = <span class=\"number\">0</span>;</span><br><span class=\"line\">   <span class=\"keyword\">int</span> intput_1 = <span class=\"number\">0</span>;</span><br><span class=\"line\">   <span class=\"keyword\">int</span> intput_2 = <span class=\"number\">0</span>;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"meta\">@Parameters</span></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Collection&lt;Object[]&gt; collection()&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> Arrays.asList(<span class=\"keyword\">new</span> Object[][]&#123;</span><br><span class=\"line\">         &#123;<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>&#125;,&#123;<span class=\"number\">4</span>,<span class=\"number\">2</span>,<span class=\"number\">2</span>&#125;    </span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ParameterTest</span><span class=\"params\">(<span class=\"keyword\">int</span> expected , <span class=\"keyword\">int</span> intput_1 ,<span class=\"keyword\">int</span> intput_2)</span></span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.expected = expected;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.intput_1  = intput_1;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.intput_2 = intput_2;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">   <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    * 执行的时候会被调用两次</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"meta\">@Test</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testAdd</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      assertEquals(expected, <span class=\"keyword\">new</span> Calculate().add(intput_1, intput_2));</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"套件中聚合测试\"><a href=\"#套件中聚合测试\" class=\"headerlink\" title=\"套件中聚合测试\"></a>套件中聚合测试</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.java.junit.main;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.runner.RunWith;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.runners.Suite;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 测试套件</span></span><br><span class=\"line\"><span class=\"comment\"> * 测试套件类,必须保证是一个空类，并且是有public 修饰的类</span></span><br><span class=\"line\"><span class=\"comment\"> * 测试套件可以执行其他测试套件</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@RunWith</span>(Suite<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\">@<span class=\"title\">Suite</span>.<span class=\"title\">SuiteClasses</span>(</span>&#123;ExampleTset<span class=\"class\">.<span class=\"keyword\">class</span>,</span></span><br><span class=\"line\"><span class=\"class\">                <span class=\"title\">CalculateTest</span>.<span class=\"title\">class</span>&#125;)</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">public</span> <span class=\"title\">class</span> <span class=\"title\">SuiteTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","categories":["Junit4"],"tags":["Java","Junit4"]},{"title":"Web-Json-Toekn-Jjwt","url":"/posts/4225444985/","content":"<blockquote>\n<p>Json web token (JWT), 是为了在网络应用环境间传递声明而执行的一种基于JSON的开放标准。该token被设计为紧凑且安全的，特别适用于分布式站点的单点登录（SSO）场景。JWT的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源，也可以增加一些额外的其它业务逻辑所必须的声明信息，该token也可直接被用于认证，也可被加密。也就是说JWT是Token的一种表述性声明规范。</p>\n</blockquote>\n<h2 id=\"JWT-Json-Web-Token\"><a href=\"#JWT-Json-Web-Token\" class=\"headerlink\" title=\"JWT(Json Web Token)\"></a>JWT(Json Web Token)</h2><ul>\n<li>官网地址：<strong><a href=\"https://jwt.io/\" target=\"_blank\" rel=\"noopener\">https://jwt.io/</a></strong></li>\n<li>jwt github：<strong><a href=\"https://github.com/jwtk/jjwt\" target=\"_blank\" rel=\"noopener\">https://github.com/jwtk/jjwt</a></strong></li>\n</ul>\n<h2 id=\"JWT生成编码后的样子\"><a href=\"#JWT生成编码后的样子\" class=\"headerlink\" title=\"JWT生成编码后的样子\"></a>JWT生成编码后的样子</h2><ul>\n<li>结构类似 xxx.yyy.zzz</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImF1ZCI6IuWkqeihjOWBpeeuoeeQhueUqOaItyIsImF1ZGllbmNlIjoid2ViIiwibmJmIjoxNTA3Njg0OTQyLCJpc3MiOiJ3d3cuMW9uZS5jbiIsImV4cCI6MTUwNzY4Njc0MiwiaWF0IjoxNTA3Njg0OTQyLCJqdGkiOjEwMDB9.GGF0kFbxNk2ezzuXEJVBZyyL4e4BYMdpse73cSDrUut7cbVyYuLG1CNr8RI7eI3VHz9sdCB14Kesi8rP-v3VJA</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>base64解析之后</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"attr\">\"body\"</span>:&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">\"sub\"</span>:<span class=\"string\">\"admin\"</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">\"aud\"</span>:<span class=\"string\">\"XXX用户\"</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">\"audience\"</span>:<span class=\"string\">\"web\"</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">\"nbf\"</span>:<span class=\"number\">1507684942</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">\"iss\"</span>:<span class=\"string\">\"www.xxx.cn\"</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">\"exp\"</span>:<span class=\"number\">1507686742</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">\"iat\"</span>:<span class=\"number\">1507684942</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">\"jti\"</span>:<span class=\"number\">1000</span></span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">\"header\"</span>:&#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">\"typ\"</span>:<span class=\"string\">\"JWT\"</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">\"alg\"</span>:<span class=\"string\">\"HS512\"</span></span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">\"signature\"</span>:<span class=\"string\">\"GGF0kFbxNk2ezzuXEJVBZyyL4e4BYMdpse73cSDrUut7cbVyYuLG1CNr8RI7eI3VHz9sdCB14Kesi8rP-v3VJA\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h2 id=\"JWT的构成\"><a href=\"#JWT的构成\" class=\"headerlink\" title=\"JWT的构成\"></a>JWT的构成</h2><ul>\n<li>第一部分我们称它为头部（header),第二部分我们称其为载荷（body)，第三部分是签证（signature)。</li>\n</ul>\n<h3 id=\"header\"><a href=\"#header\" class=\"headerlink\" title=\"header\"></a>header</h3><ul>\n<li>jwt的头部承载两部分信息：</li>\n<li>声明类型，这里是jwt</li>\n<li>声明加密的算法 通常直接使用 HMAC HS512</li>\n<li>完整的头部就像下面这样的JSON：</li>\n</ul>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  'typ': 'JWT', //</span><br><span class=\"line\">  'alg': 'HS512'</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>然后将头部进行base64加密（该加密是可以对称解密的),构成了第一部分.</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"body\"><a href=\"#body\" class=\"headerlink\" title=\"body\"></a>body</h3><ul>\n<li><p>载荷就是存放有效信息的地方。这个名字像是特指飞机上承载的货品，这些有效信息包含三个部分</p>\n</li>\n<li><p>标准中注册的声明</p>\n<ul>\n<li>公共的声明</li>\n<li>私有的声明</li>\n<li>标准中注册的声明 (建议但不强制使用) ：</li>\n</ul>\n</li>\n<li><p>iss: jwt签发者</p>\n</li>\n<li><p>sub: jwt所面向的用户</p>\n</li>\n<li><p>aud: 接收jwt的一方</p>\n</li>\n<li><p>exp: jwt的过期时间，这个过期时间必须要大于签发时间</p>\n</li>\n<li><p>nbf: 定义在什么时间之前，该jwt都是不可用的.</p>\n</li>\n<li><p>iat: jwt的签发时间</p>\n</li>\n<li><p>jti: jwt的唯一身份标识，主要用来作为一次性token,从而回避重放攻击。</p>\n</li>\n<li><pre><code>eyJzdWIiOiJhZG1pbiIsImF1ZCI6IuWkqeihjOWBpeeuoeeQhueUqOaItyIsImF1ZGllbmNlIjoid2ViIiwibmJmIjoxNTA3Njg0OTQyLCJpc3MiOiJ3d3cuMW9uZS5jbiIsImV4cCI6MTUwNzY4Njc0MiwiaWF0IjoxNTA3Njg0OTQyLCJqdGkiOjEwMDB9\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;json</span><br><span class=\"line\">&quot;body&quot;:&#123;</span><br><span class=\"line\">\t\t&quot;sub&quot;:&quot;admin&quot;,</span><br><span class=\"line\">\t\t&quot;aud&quot;:&quot;xx用户&quot;,</span><br><span class=\"line\">\t\t&quot;audience&quot;:&quot;web&quot;,</span><br><span class=\"line\">\t\t&quot;nbf&quot;:1507684942,</span><br><span class=\"line\">\t\t&quot;iss&quot;:&quot;www.xxx.cn&quot;,</span><br><span class=\"line\">\t\t&quot;exp&quot;:1507686742,</span><br><span class=\"line\">\t\t&quot;iat&quot;:1507684942,</span><br><span class=\"line\">\t\t&quot;jti&quot;:1000</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n</code></pre>\n</li>\n</ul>\n<h3 id=\"signature\"><a href=\"#signature\" class=\"headerlink\" title=\"signature\"></a>signature</h3><ul>\n<li>jwt的第三部分是一个签证信息，这个签证信息由三部分组成：</li>\n<li>header (base64后的)</li>\n<li>body(base64后的)</li>\n<li>secret<ul>\n<li>这个部分需要base64加密后的header和base64加密后的body使用.连接组成的字符串，然后通过header中声明的加密方式进行加盐secret组合加密，然后就构成了jwt的第三部分。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">GGF0kFbxNk2ezzuXEJVBZyyL4e4BYMdpse73cSDrUut7cbVyYuLG1CNr8RI7eI3VHz9sdCB14Kesi8rP-v3VJA</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>密钥secret是保存在服务端的，服务端会根据这个密钥进行生成token和验证，所以需要保护好。</li>\n</ul>\n<h2 id=\"JWT注意事项\"><a href=\"#JWT注意事项\" class=\"headerlink\" title=\"JWT注意事项\"></a>JWT注意事项</h2><ul>\n<li>body不要存放敏感信息，因为该部分用base64编码，在客户端是可解的；</li>\n<li>服务端保护好secret私钥，一旦客户端得带私匙就可以自己签发 JWT 了；</li>\n</ul>\n<h2 id=\"jwt扩展\"><a href=\"#jwt扩展\" class=\"headerlink\" title=\"jwt扩展\"></a>jwt扩展</h2><ul>\n<li>因为token是保留到客户端，所以服务端secret保护变得额外重要，建议将配置信息中secret加密后使用。不建议全局使用同一secret加密。</li>\n<li>REST风格推荐使用json传输数据,所以可以采用signature进行数据加密后提交。signature每次刷新都会更新所以安全级别将提高很多。</li>\n</ul>\n","categories":["Spring"],"tags":["JJWT","web json token"]},{"title":"FastDFS入门","url":"/posts/688330038/","content":"<h2 id=\"FastDfs介绍\"><a href=\"#FastDfs介绍\" class=\"headerlink\" title=\"FastDfs介绍\"></a>FastDfs介绍</h2><ul>\n<li><p>FastDFS是由国人余庆所开发，其项目地址：<a href=\"https://github.com/happyfish100\" target=\"_blank\" rel=\"noopener\">FastDFS</a>。FastDfs是一个轻量级的开源分布式文件系统，主要解决了大容量的文件存储和高并发访问的问题，文件存取时实现了负载均衡。文件存取时实现了负载均衡FastDFS实现了软件方式的RAID，可以使用廉价的IDE硬盘进行存储支持存储服务器在线扩容支持相同内容的文件只保存一份，节约磁盘空间。</p>\n</li>\n<li><p>FastDFS只能通过Client API访问，不支持POSIX访问方式。</p>\n</li>\n<li><p>FastDFS特别适合大中型网站使用，用来存储资源文件（如：图片、文档、音频、视频等等）。</p>\n</li>\n<li><p>它用纯C语言实现，支持Linux、FreeBSD、AIX等UNIX系统。它只能通过专有API对文件进行存取访问，不支持POSIX接口方式，不能mount使用。准确地讲，Google FS、HDFS、TFS（这三个都是底层上的实现，在文件系统上处理的是数据块）以及FastDFS、mogileFS（这两个是文件级上的实现，处理的是文件）等类Google FS都不是系统级的分布式文件系统，而是应用级的分布式文件存储服务。</p>\n</li>\n<li><p>特性</p>\n<ul>\n<li><pre><code>1、分组存储，灵活简洁、对等结构，不存在单点。\n2、文件ID由FastDFS生成，作为文件访问凭证。FastDFS不需要传统的name server（去重机制在服务端，导致不能达到秒传。）。\n3、和流行的web server无缝衔接，FastDFS已提供apache和nginx扩展模块。\n4、大、中、小文件均可以很好支持，支持海量小文件存储（实际上不建议存储超大文件（大于500M））。\n5、支持多块磁盘，支持单盘数据恢复（理论上，实际出现Storage合并丢操作失数据）。\n6、支持相同文件内容只保存一份，节省存储空间。\n7、存储服务器上可以保存文件附加属性。\n8、下载文件支持多线程方式，支持断点续传。</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"系统架构\"><a href=\"#系统架构\" class=\"headerlink\" title=\"系统架构\"></a>系统架构</h2><a id=\"more\"></a>\n\n<h3 id=\"架构示意图\"><a href=\"#架构示意图\" class=\"headerlink\" title=\"架构示意图\"></a>架构示意图</h3><ul>\n<li><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/FastDFS/fastdfs.png\" alt=\"fastdfs架构图\"></li>\n</ul>\n<h4 id=\"架构角色\"><a href=\"#架构角色\" class=\"headerlink\" title=\"架构角色\"></a>架构角色</h4><ul>\n<li>Tracker和Storage两个角色，其中绝大多数功能都是在Storage中实现，包括网络处理、文件上传、下载、同步、磁盘恢复等众多功能</li>\n<li>Tracker cluster中各个tracker server相互独立，不进行相互通信。</li>\n<li>Storage cluster中各个storage组（Volume1,Volume2…）相互独立，不进行相互通信，也就是说各个组之间保存的数据是不相同的。但是各个组中的storage server之间是属于互相备份的关系，也就是说storage server之间保存相同的数据。</li>\n<li>每个storage server会启动一个单独的线程主动向Tracker cluster中每个tracker server报告其状态信息，包括磁盘使用情况，文件同步情况及文件上传下载次数统计等信息。</li>\n</ul>\n<h4 id=\"上传文件流程图\"><a href=\"#上传文件流程图\" class=\"headerlink\" title=\"上传文件流程图\"></a>上传文件流程图</h4><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/FastDFS/fastdfs1.png\"></p>\n<ul>\n<li>上传流程描述</li>\n<li><ol>\n<li>client询问tracker上传到的storage，不需要附加参数。</li>\n<li>tracker返回一台可用的storage。</li>\n<li>client直接和storage通讯完成文件上传。</li>\n<li>上传完成，Storage server返回Client一个文件ID，文件上传结束。</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"下载文件流程图\"><a href=\"#下载文件流程图\" class=\"headerlink\" title=\"下载文件流程图\"></a>下载文件流程图</h4><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/FastDFS/fastdfs2.png\"></p>\n<ul>\n<li>下载流程描述</li>\n<li><ol>\n<li>client询问tracker下载文件的storage，参数为文件标识（组名和文件名）。</li>\n<li>tracker返回一台可用的storage。</li>\n<li>client直接和storage通讯完成文件下载。</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"相关术语\"><a href=\"#相关术语\" class=\"headerlink\" title=\"相关术语\"></a>相关术语</h2><ul>\n<li>Tracker Server：跟踪服务器，主要做调度工作，在访问上起负载均衡的作用。记录storage server的状态，是连接Client和Storage server的枢纽。 </li>\n<li>Storage Server：存储服务器，文件和meta data都保存到存储服务器上。</li>\n<li>client 客户端：业务请求发起方，通过专用接口基于TCP协议与<code>tracker</code>以及<code>storage server</code>进行交互  。</li>\n<li>group：组，也可称为卷。同组内服务器上的文件是完全相同的 文件标识：包括两部分：组名和文件名（包含路径） 。</li>\n<li>meta data：文件相关属性，键值对（Key Value Pair）方式，如：width=1024,heigth=768。</li>\n<li>fid：文件标识。</li>\n</ul>\n<h2 id=\"同步机制\"><a href=\"#同步机制\" class=\"headerlink\" title=\"同步机制\"></a>同步机制</h2><ul>\n<li>同一组内的storage server之间是对等的，文件上传、删除等操作可以在任意一台storage server上进行。</li>\n<li>文件同步只在同组内的storage server之间进行，采用push方式，即源服务器同步给目标服务器。</li>\n<li>源头数据才需要同步，备份数据不需要再次同步，否则就构成环路了。</li>\n<li>上述第二条规则有个例外，就是新增加一台storage server时，由已有的一台storage server将已有的所有数据（包括源头数据和备份数据）同步给该新增服务器。</li>\n</ul>\n<h2 id=\"去重机制\"><a href=\"#去重机制\" class=\"headerlink\" title=\"去重机制\"></a>去重机制</h2><ul>\n<li>Hash<ul>\n<li>去重机制也就是hash了，一个是自己实现的hash，另外一个是MD5。</li>\n</ul>\n</li>\n<li>MD5<ul>\n<li>需安装FastDHT(分布式哈希系统 ):使用 Berkeley DB 做数据存储，使用 libevent 做网络IO处理，提供 Java 版的客户端接口包。适合用来存储用户在线、会话等小数据量信息。<br>通过hash-&gt;文件路径来标识文件，后面上传的文件，如果已经存在相同内容的文件，则采用符号连接的方式，指向原始文件。</li>\n</ul>\n</li>\n<li>缺陷<ul>\n<li>FastDFS采用服务端去重的机制，相比网盘的秒传机制效率低。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"通信协议\"><a href=\"#通信协议\" class=\"headerlink\" title=\"通信协议\"></a>通信协议</h2><ul>\n<li><p>协议包由两部分组成：header和body</p>\n</li>\n<li><p>header共10字节，格式如下：  </p>\n<ul>\n<li>8 byte body length  </li>\n<li>1 byte command </li>\n<li>1 byte status</li>\n</ul>\n</li>\n<li><p>body数据包格式由取决于具体的命令，body可以为空</p>\n</li>\n<li><p>FDFS协议头</p>\n<ul>\n<li><table>\n<thead>\n<tr>\n<th>描述</th>\n<th>名称</th>\n<th>长度</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>报文内容</td>\n<td>contentLength</td>\n<td>1-7位</td>\n</tr>\n<tr>\n<td>报文类型</td>\n<td>cmd</td>\n<td>8位</td>\n</tr>\n<tr>\n<td>处理状态</td>\n<td>status</td>\n<td>9位</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"报文cmd（类型）参照表\"><a href=\"#报文cmd（类型）参照表\" class=\"headerlink\" title=\"报文cmd（类型）参照表\"></a>报文cmd（类型）参照表</h2><table>\n<thead>\n<tr>\n<th>常量</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>82</td>\n<td>客户端关闭连接命令</td>\n</tr>\n<tr>\n<td>111</td>\n<td>连接状态检查命令</td>\n</tr>\n<tr>\n<td>100</td>\n<td>服务端正确返回报文状态</td>\n</tr>\n<tr>\n<td>91</td>\n<td></td>\n</tr>\n<tr>\n<td>92</td>\n<td></td>\n</tr>\n<tr>\n<td>93</td>\n<td>获取文件源服务器</td>\n</tr>\n<tr>\n<td>101</td>\n<td></td>\n</tr>\n<tr>\n<td>102</td>\n<td></td>\n</tr>\n<tr>\n<td>103</td>\n<td></td>\n</tr>\n<tr>\n<td>104</td>\n<td></td>\n</tr>\n<tr>\n<td>105</td>\n<td></td>\n</tr>\n<tr>\n<td>106</td>\n<td></td>\n</tr>\n<tr>\n<td>107</td>\n<td></td>\n</tr>\n<tr>\n<td>11</td>\n<td>上传文件</td>\n</tr>\n<tr>\n<td>12</td>\n<td>删除文件</td>\n</tr>\n<tr>\n<td>13</td>\n<td>设置文件元数据</td>\n</tr>\n<tr>\n<td>14</td>\n<td>下载文件</td>\n</tr>\n<tr>\n<td>15</td>\n<td>获取文件元数据</td>\n</tr>\n<tr>\n<td>21</td>\n<td></td>\n</tr>\n<tr>\n<td>22</td>\n<td>获取文件信息</td>\n</tr>\n<tr>\n<td>23</td>\n<td>创建一个支持断点续传的文件</td>\n</tr>\n<tr>\n<td>24</td>\n<td>对文件断点续传(附加在原来为上传完全的文件后面)</td>\n</tr>\n<tr>\n<td>34</td>\n<td>修改支持断点续传的文件</td>\n</tr>\n<tr>\n<td>36</td>\n<td>清空支持断点的文件</td>\n</tr>\n</tbody></table>\n<h2 id=\"协议异常（状态码）参照表\"><a href=\"#协议异常（状态码）参照表\" class=\"headerlink\" title=\"协议异常（状态码）参照表\"></a>协议异常（状态码）参照表</h2><table>\n<thead>\n<tr>\n<th>常量</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>0</td>\n<td>成功</td>\n</tr>\n<tr>\n<td>2</td>\n<td>找不到节点或文件</td>\n</tr>\n<tr>\n<td>5</td>\n<td>服务端发生io异常</td>\n</tr>\n<tr>\n<td>16</td>\n<td>服务端忙</td>\n</tr>\n<tr>\n<td>22</td>\n<td>无效的参数</td>\n</tr>\n<tr>\n<td>28</td>\n<td>没有足够的存储空间</td>\n</tr>\n<tr>\n<td>61</td>\n<td>服务端拒绝连接</td>\n</tr>\n<tr>\n<td>114</td>\n<td>文件已经存在？</td>\n</tr>\n</tbody></table>\n<h2 id=\"状态码待续。。。\"><a href=\"#状态码待续。。。\" class=\"headerlink\" title=\"状态码待续。。。\"></a>状态码待续。。。</h2>","categories":["入门"],"tags":["FastDFS","文件存储"]},{"title":"Xpath入门","url":"/posts/1918301121/","content":"<blockquote>\n<p>​    了解Xpath之前先了解下XML、HTML。如果完全不知道是什么，建议系统学习HTML、XML下阅读下文。</p>\n</blockquote>\n<h2 id=\"XML\"><a href=\"#XML\" class=\"headerlink\" title=\"XML\"></a>XML</h2><blockquote>\n<p><strong>可扩展标记语言</strong>（英语：E<strong>x</strong>tensible <strong>M</strong>arkup <strong>L</strong>anguage，简称：<strong>XML</strong>），是一种标记语言。标记指计算机所能理解的信息符号，通过此种标记，计算机之间可以处理包含各种信息的文章等。如何定义这些标记，既可以选择国际通用的标记语言，比如HTML，也可以使用像XML这样由相关人士自由决定的标记语言，这就是语言的可扩展性。XML是从标准通用标记语言（SGML）中简化修改出来的。它主要用到的有可扩展标记语言、可扩展样式语言（XSL）、XBRL和XPath等。 </p>\n</blockquote>\n<p>示例-0</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">note</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">to</span>&gt;</span>George<span class=\"tag\">&lt;/<span class=\"name\">to</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">from</span>&gt;</span>John<span class=\"tag\">&lt;/<span class=\"name\">from</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">heading</span>&gt;</span>Reminder<span class=\"tag\">&lt;/<span class=\"name\">heading</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span>Don't forget the meeting!<span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">note</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"HTML\"><a href=\"#HTML\" class=\"headerlink\" title=\"HTML\"></a>HTML</h2><blockquote>\n<p><strong>超文本标记语言</strong>（英语：<strong>H</strong>yper<strong>T</strong>ext <strong>M</strong>arkup <strong>L</strong>anguage，简称：<strong>HTML</strong>）是一种用于创建网页的标准标记语言。HTML是一种基础技术，常与CSS、JavaScript一起被众多网站用于设计令人赏心悦目的网页、网页应用程序以及移动应用程序的用户界面。网页浏览器可以读取HTML文件，并将其渲染成可视化网页。HTML描述了一个网站的结构语义随着线索的呈现，使之成为一种标记语言而非编程语言。</p>\n<p>HTML元素是构建网站的基石。HTML允许嵌入图像与对象，并且可以用于创建交互式表单，它被用来结构化信息——例如标题、段落和列表等等，也可用来在一定程度上描述文档的外观和语义。HTML的语言形式为尖括号包围的HTML元素（如<code>&lt;html&gt;</code>），浏览器使用HTML标签和脚本来诠释网页内容，但不会将它们显示在页面上。</p>\n<p>HTML可以嵌入如JavaScript的脚本语言，它们会影响HTML网页的行为。网页浏览器也可以引用层叠样式表（CSS）来定义文本和其它元素的外观与布局。维护HTML和CSS标准的组织万维网联盟（W3C）鼓励人们使用CSS替代一些用于表现的HTML元素。</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<p>示例-1</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>我的第一个标题<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>我的第一个段落。<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"XML和HTML有啥关系呢？\"><a href=\"#XML和HTML有啥关系呢？\" class=\"headerlink\" title=\"XML和HTML有啥关系呢？\"></a>XML和HTML有啥关系呢？</h2><ul>\n<li><strong>XML是被设计用来描述数据的，重点是:什么是数据，如何存放数据</strong>。</li>\n<li><strong>HTML是被设计用来显示数据的，重点是:显示数据以及如何显示数据更好上面。</strong></li>\n</ul>\n<h2 id=\"Xpath\"><a href=\"#Xpath\" class=\"headerlink\" title=\"Xpath\"></a>Xpath</h2><blockquote>\n<p><strong>XPath</strong>即为XML路径语言（XML Path Language），它是一种用来确定XML文档中某部分位置的语言。</p>\n<p>XPath基于XML的树状结构，提供在数据结构树中找寻节点的能力。起初XPath的提出的初衷是将其作为一个通用的、介于XPointer间的语法模型。但是XPath很快的被开发者采用来当作小型查询语言。XPath 用于在 XML 文档中通过元素和属性进行导航。</p>\n</blockquote>\n<h2 id=\"标识法\"><a href=\"#标识法\" class=\"headerlink\" title=\"标识法\"></a>标识法</h2><p>最常见的XPath表达式是路径表达式（XPath这一名称的另一来源）。路径表达式是从一个XML节点（当前的上下文节点）到另一个节点、或一组节点的书面步骤顺序。这些步骤以“/”字符分开，每一步有三个构成成分：</p>\n<ul>\n<li>轴描述（用最直接的方式接近目标节点）</li>\n<li>节点测试（用于筛选节点位置和名称）</li>\n<li>节点描述（用于筛选节点的属性和子节点特征）</li>\n</ul>\n<p>一般情况下，我们使用简写后的语法。虽然完整的轴描述是一种更加贴近人类语言，利用自然语言的单词和语法来书写的描述方式，但是相比之下也更加罗嗦。</p>\n<h3 id=\"简写后的语法\"><a href=\"#简写后的语法\" class=\"headerlink\" title=\"简写后的语法\"></a>简写后的语法</h3><p>最简单的XPath如下：</p>\n<ul>\n<li><code>/A/B/C</code></li>\n</ul>\n<p>在这里选择所有符合规矩的C节点：C节点必须是B的子节点（<code>B/C</code>），同时B节点必须是A的子节点（<code>A/B</code>），而A是这个XML文档的根节点（<code>/A</code>）。此时的这种描述法类似于磁盘中文件的路径，从盘符开始顺着一级一级的目录最终找到文件。</p>\n<p>这里还有一个复杂一些的例子，包含了全部构成成分（请详细的看）：</p>\n<ul>\n<li><code>A//B/*[1]</code></li>\n</ul>\n<p>此时选择的元素是：在B节点下的第一个节点（<code>B/*[1]</code>），不论节点的名称如何（<code>*</code>）；而B节点必须出现在A节点内，不论和A节点之间相隔几层节点（<code>//B</code>）；与此同时A节点还必须是当前节点的子节点（<code>A</code>，前边没有<code>/</code>）。</p>\n<h2 id=\"轴描述语法\"><a href=\"#轴描述语法\" class=\"headerlink\" title=\"轴描述语法\"></a>轴描述语法</h2><table>\n<thead>\n<tr>\n<th>坐标</th>\n<th>名称</th>\n<th>说明</th>\n<th>缩写语法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>child</td>\n<td>子节点</td>\n<td>比自身节点深度大的一层的节点，且被包含在自身之内</td>\n<td>默认，不需要</td>\n</tr>\n<tr>\n<td>attribute</td>\n<td>属性</td>\n<td></td>\n<td><code>@</code></td>\n</tr>\n<tr>\n<td>descendant</td>\n<td>子孙节点</td>\n<td>比自身节点深度大的节点，且被包含在自身之内</td>\n<td>不提供</td>\n</tr>\n<tr>\n<td>descendant-or-self</td>\n<td>自身引用及子孙节点</td>\n<td></td>\n<td><code>//</code></td>\n</tr>\n<tr>\n<td>parent</td>\n<td>父节点</td>\n<td>比自身节点深度小一层的节点，且包含自身</td>\n<td><code>..</code></td>\n</tr>\n<tr>\n<td>ancestor</td>\n<td>祖先节点</td>\n<td>比自身节点深度小的节点，且包含自身</td>\n<td>不提供</td>\n</tr>\n<tr>\n<td>ancestor-or-self</td>\n<td>自身引用及祖先节点</td>\n<td></td>\n<td>不提供</td>\n</tr>\n<tr>\n<td>following</td>\n<td>下文节点</td>\n<td>按纵轴视图，在此节点后的所有完整节点，即不包含其祖先节点</td>\n<td>不提供</td>\n</tr>\n<tr>\n<td>preceding</td>\n<td>前文节点</td>\n<td>按纵轴视图，在此节点前的所有完整节点，即不包含其子孙节点</td>\n<td>不提供</td>\n</tr>\n<tr>\n<td>following-sibling</td>\n<td>下一个同级节点</td>\n<td></td>\n<td>不提供</td>\n</tr>\n<tr>\n<td>preceding-sibling</td>\n<td>上一个同级节点</td>\n<td></td>\n<td>不提供</td>\n</tr>\n<tr>\n<td>self</td>\n<td>自己</td>\n<td></td>\n<td><code>.</code></td>\n</tr>\n<tr>\n<td>namespace</td>\n<td>名称空间</td>\n<td></td>\n<td>不提供</td>\n</tr>\n</tbody></table>\n<h2 id=\"选取节点\"><a href=\"#选取节点\" class=\"headerlink\" title=\"选取节点\"></a>选取节点</h2><table>\n<thead>\n<tr>\n<th>表达式</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>nodename</td>\n<td>选取此节点的所有子节点。</td>\n</tr>\n<tr>\n<td>/</td>\n<td>从根节点选取。</td>\n</tr>\n<tr>\n<td>//</td>\n<td>从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。</td>\n</tr>\n<tr>\n<td>.</td>\n<td>选取当前节点。</td>\n</tr>\n<tr>\n<td>..</td>\n<td>选取当前节点的父节点。</td>\n</tr>\n<tr>\n<td>@</td>\n<td>选取属性。</td>\n</tr>\n</tbody></table>\n<h2 id=\"节点测试\"><a href=\"#节点测试\" class=\"headerlink\" title=\"节点测试\"></a>节点测试</h2><p>节点测试包括特定节点名或者更一般的表达式。至于XML里命名空间前缀<code>gs</code>已定义的文件，<code>//gs:enquiry</code>将找到所有在那命名空间里<code>enquiry</code>的节点。</p>\n<p>其他节点格式：</p>\n<ul>\n<li><p>comment() </p>\n<p>寻找XML注释节点，例如<code>&lt;!-- 注释 --&gt;</code></p>\n</li>\n<li><p>text() </p>\n<p>寻找某点的文字型别，例如<code>hello</code>于<code>&lt;k&gt;hello&lt;/k&gt;</code></p>\n</li>\n<li><p>node() </p>\n<p>寻找所有点</p>\n</li>\n</ul>\n<h2 id=\"节点描述\"><a href=\"#节点描述\" class=\"headerlink\" title=\"节点描述\"></a>节点描述</h2><p>节点描述为一个逻辑真假表达式，任何真假判断表达式都可在节点后方括号里表示，这条件必须在XPath处理这个节点前先被满足。在某一步骤可有多少个描述并没有限制。</p>\n<p>范例如下： <code>//a[@href=&#39;index.html&#39;]</code>，这将检查元素<code>a</code>有没有<code>href</code>属性，并且该它的值是<code>index.html</code>。</p>\n<p>复杂一些的范例如下：</p>\n<ul>\n<li><code>//a[@href=&#39;index.html&#39;][../div/@class=&#39;header&#39;]/@target</code></li>\n</ul>\n<p>或</p>\n<ul>\n<li><code>//a[@href=&#39;index.html&#39;][name(..)=&#39;div&#39;][../@class=&#39;header&#39;]/@target</code></li>\n</ul>\n<p>此例将会选择符合条件的元素<code>a</code>的<code>target</code>属性。 要求元素<code>a</code>：</p>\n<ul>\n<li>具有属性<code>href</code>且值为<code>index.html</code>；</li>\n<li>并且元素<code>a</code>具有父元素<code>div</code>；</li>\n<li>并且父元素（<code>div</code>）其自身具备<code>class</code>属性，值为<code>header</code>。</li>\n</ul>\n<h2 id=\"小试牛刀\"><a href=\"#小试牛刀\" class=\"headerlink\" title=\"小试牛刀\"></a>小试牛刀</h2><blockquote>\n<p>使用text() 获取 h1、p标签中的文本内容。</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>我的第一个标题<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>我的第一个段落。<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>获取h1、p标签里面的内容</p>\n<blockquote>\n<p>//h1/text()  &gt;&gt;  我的第一个标题</p>\n<p>//p/text() &gt;&gt; 我的第一个段落。</p>\n</blockquote>\n<hr>\n<blockquote>\n<p>使用text() 获取 div id = main h1、p标签中的文本内容。</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>我的第一个标题<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>我的第一个段落。<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"main\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>我的第二个标题<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>我的第二个段落。<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"king\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>我的第三个标题<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>我的第三个段落。<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>获取不同节点h1、p标签里面的内容</p>\n<blockquote>\n<p>//div[@id=’main’]/h1/text()  &gt;&gt;  我的第二个标题</p>\n<p>//div[@id=’main’]/p/text() &gt;&gt; 我的第二个段落。</p>\n<p>//div[@id=’main’]/h1/text() &gt;&gt; 我的第二个标题</p>\n<p>//div[@id=’main’]/p/text() &gt;&gt; 我的第二个段落。</p>\n<p>//div[@id=’king’]/div/h1/text() &gt;&gt; 我的第三个标题</p>\n<p>//div[@id=’king’]/div/p/text() &gt;&gt; 我的第三个段落。</p>\n</blockquote>\n<hr>\n<p>获取第一个div内h1、p标签里面的内容，和第二个div内h1、p标签里面的内容。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>我的第二个标题<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>我的第二个段落。<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>我的第三个标题<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>我的第三个段落。<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>获取相同节点h1、p标签里面的内容。</p>\n<blockquote>\n<p>//div[1]/h1/text() &gt;&gt; 我的第二个标题</p>\n<p>//div[1]/p/text()  &gt;&gt; 我的第二个段落。</p>\n<p>//div[2]/h1/text()  &gt;&gt;我的第三个标题</p>\n<p>//div[2]/p/text()  &gt;&gt; 我的第三个段落。</p>\n</blockquote>\n<hr>\n<p>获取ul中li title = 4的内容。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Title<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>我的第二个标题<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>我的第二个段落。<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>我的第三个标题<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>我的第三个段落。<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">\"item-0\"</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">\"item-1\"</span>&gt;</span>2<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">\"item-2\"</span>&gt;</span>3<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">li</span> <span class=\"attr\">class</span>=<span class=\"string\">\"item-3\"</span> <span class=\"attr\">title</span>=<span class=\"string\">\"4\"</span>&gt;</span>4<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>//ul/li[@title=’4’]/text() &gt;&gt; 4</p>\n</blockquote>\n<p>END</p>\n","categories":["入门"],"tags":["爬虫","Xpath"]},{"title":"Web-Crawle","url":"/posts/3356989948/","content":"<blockquote>\n<p>既然sakila的数据不是很好用，干脆自己爬点数据吧。</p>\n</blockquote>\n<ul>\n<li>在 <a href=\"https://z201.cn/2019/02/28/%E5%AE%9E%E6%88%98-sakila%E6%95%B0%E6%8D%AE%E5%BA%93%E9%A1%B9%E7%9B%AE/\">实战-sakila数据库项目</a> 介绍了sakila数据开发应用，结果发现只有文字数据，而且影片数据也不理想，所以这里需要使用爬虫从万能的互联网上抓点数据。</li>\n</ul>\n<h3 id=\"目标选择\"><a href=\"#目标选择\" class=\"headerlink\" title=\"目标选择\"></a>目标选择</h3><ul>\n<li>腾讯视频</li>\n</ul>\n<h3 id=\"抓取类型\"><a href=\"#抓取类型\" class=\"headerlink\" title=\"抓取类型\"></a>抓取类型</h3><ul>\n<li>电影</li>\n</ul>\n<h3 id=\"技术选型\"><a href=\"#技术选型\" class=\"headerlink\" title=\"技术选型\"></a>技术选型</h3><ul>\n<li><code> jsoup</code></li>\n</ul>\n<h3 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h3><blockquote>\n<p>简单的单元测试入门。jsoup的用法可以直接查看官方文档。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String UA_PHONE = <span class=\"string\">\"Mozilla/5.0 (Linux; Android 4.3; Nexus 10 Build/JSS15Q) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.23 Safari/537.36\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String UA_PC = <span class=\"string\">\"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String QQ_PAGE_MOVIE = <span class=\"string\">\"http://v.qq.com/x/list/movie?itype=-1&amp;offset=1\"</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\tDocument document = Jsoup.connect(QQ_PAGE_MOVIE)</span><br><span class=\"line\">            .userAgent(UA_PC)</span><br><span class=\"line\">            .timeout(TIME_OUT)</span><br><span class=\"line\">            .ignoreContentType(<span class=\"keyword\">true</span>).get();</span><br><span class=\"line\">      Elements elements = document.select(<span class=\"string\">\"li.list_item a.figure\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Element element : elements) &#123;</span><br><span class=\"line\">            String url = element.attr(<span class=\"string\">\"href\"</span>);</span><br><span class=\"line\">            String title = element.select(<span class=\"string\">\"img\"</span>).attr(<span class=\"string\">\"alt\"</span>);</span><br><span class=\"line\">            String image = element.select(<span class=\"string\">\"img\"</span>).attr(<span class=\"string\">\"r-lazyload\"</span>);</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"href  \"</span> + url + <span class=\"string\">\"   title  \"</span> + title + <span class=\"string\">\"  image  \"</span> + image);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h4 id=\"输出结果\"><a href=\"#输出结果\" class=\"headerlink\" title=\"输出结果\"></a>输出结果</h4><figure class=\"highlight verilog\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/5lmuabxmb5jf1fl.html   title  云南虫谷  image  //puui.qpic.cn/vcover_vt_pic/0/5lmuabxmb5jf1fl1550480109/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/3oe086g3e8pvmm1.html   title  神谕通天  image  //puui.qpic.cn/vcover_vt_pic/0/3oe086g3e8pvmm11526636789/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/nvy9lp6e061ecu2.html   title  湮灭  image  //puui.qpic.cn/vcover_vt_pic/0/nvy9lp6e061ecu21522377505/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/vq6l5tg1blwcquk.html   title  小悟空  image  //puui.qpic.cn/vcover_vt_pic/0/vq6l5tg1blwcquk1528942630/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/xuy45yvwdgajywr.html   title  小偷家族  image  //puui.qpic.cn/vcover_vt_pic/0/xuy45yvwdgajywr1534475242/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/v097i2zl7bekihf.html   title  遇见你真好  image  //puui.qpic.cn/vcover_vt_pic/0/v097i2zl7bekihf1520840657/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/5crb4lhjxu5irm0.html   title  摘金奇缘  image  //puui.qpic.cn/vcover_vt_pic/0/5crb4lhjxu5irm01540260494/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/70y5f38tjcmtw2t.html   title  吃货宇宙  image  //puui.qpic.cn/vcover_vt_pic/0/70y5f38tjcmtw2t1530070491/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/og0eputlxwet1cn.html   title  我不是药神  image  //puui.qpic.cn/vcover_vt_pic/0/og0eputlxwet1cn1524011116/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/c32gmogdsrjwi5t.html   title  求求你爱上我  image  //puui.qpic.cn/vcover_vt_pic/0/c32gmogdsrjwi5t1527907276/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/m871wzl4wsan735.html   title  地球最后的夜晚  image  //puui.qpic.cn/vcover_vt_pic/0/m871wzl4wsan7351548821409/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/5i3ppwn4q8ykk2v.html   title  午夜十二点  image  //puui.qpic.cn/vcover_vt_pic/0/5i3ppwn4q8ykk2v1527728549/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/wagzbx91asjomnu.html   title  无问西东  image  //puui.qpic.cn/vcover_vt_pic/0/wagzbx91asjomnu1527151117/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/fhz98sq3ecwh2bm.html   title  恐怖浴室  image  //puui.qpic.cn/vcover_vt_pic/0/fhz98sq3ecwh2bm1531122381/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/tpa0c309erq2p7t.html   title  无名之辈  image  //puui.qpic.cn/vcover_vt_pic/0/tpa0c309erq2p7t1545014750/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/h8lp8zokyi0y960.html   title  疯狂的公牛  image  //puui.qpic.cn/vcover_vt_pic/0/h8lp8zokyi0y9601548833946/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/7fjv56lqblm6jhd.html   title  熊出没·变形记  image  //puui.qpic.cn/vcover_vt_pic/0/7fjv56lqblm6jhd1518058675/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/5y95zy4idzqf6hc.html   title  捉妖记2  image  //puui.qpic.cn/vcover_vt_pic/0/5y95zy4idzqf6hc1515143734/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/xyaud3hk6mmi6ss.html   title  追龙  image  //puui.qpic.cn/vcover_vt_pic/0/xyaud3hk6mmi6ss1513156112/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/s4fnybn8ttiqerl.html   title  神奇动物：格林德沃之罪  image  //puui.qpic.cn/vcover_vt_pic/0/s4fnybn8ttiqerl1541656334/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/sdmcdbqecsgbqpq.html   title  南极之恋  image  //puui.qpic.cn/vcover_vt_pic/0/sdmcdbqecsgbqpq1514943903/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/fl98wya3y3vit90.html   title  闺蜜的战争  image  //puui.qpic.cn/vcover_vt_pic/0/fl98wya3y3vit901548665650/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/ewh18dn62hvddln.html   title  昼颜  image  //puui.qpic.cn/vcover_vt_pic/0/ewh18dn62hvddln1490692208/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/frs5qyzh8aeo7mj.html   title  来电狂响  image  //puui.qpic.cn/vcover_vt_pic/0/frs5qyzh8aeo7mj1547171319/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/cp8jhn5o7r5j0aa.html   title  英雄本色2018  image  //puui.qpic.cn/vcover_vt_pic/0/cp8jhn5o7r5j0aa1519977118/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/ia95960ibzdqly9.html   title  细思极恐  image  //puui.qpic.cn/vcover_vt_pic/0/ia95960ibzdqly91530059937/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/8taoglu73bcpz3u.html   title  猫与桃花源  image  //puui.qpic.cn/vcover_vt_pic/0/8taoglu73bcpz3u1524019282/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/zxsr2hae16abq7v.html   title  妈妈咪鸭  image  //puui.qpic.cn/vcover_vt_pic/0/zxsr2hae16abq7v1515552446/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/hhp6u9obgnkvpqh.html   title  地下凶猛  image  //puui.qpic.cn/vcover_vt_pic/0/hhp6u9obgnkvpqht1463720650.jpg/220</span></span><br><span class=\"line\"></span><br><span class=\"line\">href  https:<span class=\"comment\">//v.qq.com/x/cover/begymcfom3fw25j.html   title  谜巢  image  //puui.qpic.cn/vcover_vt_pic/0/begymcfom3fw25j1521084275/220</span></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n","categories":["爬虫"],"tags":["爬虫"]},{"title":"Redis基础（二）","url":"/posts/1741249225/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。 </p>\n</blockquote>\n<h3 id=\"set扩展\"><a href=\"#set扩展\" class=\"headerlink\" title=\"set扩展\"></a>set扩展</h3><ul>\n<li>分布式锁的简单实现<ul>\n<li>在日常开发中,redis主要用在缓存处理。为保证缓存所以会使用集群的方式，避免缓存雪崩。都使用集群了应用层也不太可能是单应用。在分布式的情况下就会涉及分布式锁。a应用和b应用一起对某条缓存记录操作，a查完数据在内存修改，在放回去。如果这个操作两个应用同时进行就会出现并发问题。为了保证操作的原子性，所以就要使用锁来保证操作执行的顺序。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用set的扩展命令 一次把expire和 setnx的特性带上。下面这条命令就是 过期时间5s 并且不可以重复添加。只能删除或者到期。</span></span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> lock:redis <span class=\"literal\">true</span> ex 5 nx</span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> lock:redis <span class=\"literal\">true</span> ex 5 nx  <span class=\"comment\"># 第二次在设置就失败了。</span></span><br><span class=\"line\">(nil)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>但是这种分布式锁并不能完美解决问题，因为锁有过期时间，如果时间过期了但是操作依然未执行完成，后面的操作进来就可能会造成不可控影响。</li>\n</ul>\n<h3 id=\"异步消息列队\"><a href=\"#异步消息列队\" class=\"headerlink\" title=\"异步消息列队\"></a>异步消息列队</h3><blockquote>\n<p>Redis list这个数据类型，非常适合做列队。使用rpush / lpush 操作入列，使用 lpop 和 rpop来出列队。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">192.168.31.7:6379&gt; rpush queue a b c d </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br><span class=\"line\">192.168.31.7:6379&gt; llen queue</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br><span class=\"line\"><span class=\"comment\"># rpop 压栈</span></span><br><span class=\"line\">192.168.31.7:6379&gt; lpop queue</span><br><span class=\"line\"><span class=\"string\">\"a\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; lpop queue</span><br><span class=\"line\"><span class=\"string\">\"b\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; lpop queue</span><br><span class=\"line\"><span class=\"string\">\"c\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; lpop queue</span><br><span class=\"line\"><span class=\"string\">\"d\"</span></span><br><span class=\"line\"><span class=\"comment\"># lpop 列队</span></span><br><span class=\"line\">192.168.31.7:6379&gt; lpop queue</span><br><span class=\"line\"><span class=\"string\">\"a\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; lpop queue</span><br><span class=\"line\"><span class=\"string\">\"b\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; lpop queue</span><br><span class=\"line\"><span class=\"string\">\"c\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; lpop queue</span><br><span class=\"line\"><span class=\"string\">\"d\"</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>但是，redis的list一旦被消费完就会被删除，为了避免客户端一直读取。建议使用阻塞列队<code>blpop\\brpop</code>的方式</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用blocking 阻塞读，1就是阻塞时间。这样可以避免不断的读。</span></span><br><span class=\"line\">192.168.31.7:6379&gt; rpush queue a b c d </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br><span class=\"line\">192.168.31.7:6379&gt; blpop queue 1</span><br><span class=\"line\">1) <span class=\"string\">\"queue\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"a\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; blpop queue 1</span><br><span class=\"line\">1) <span class=\"string\">\"queue\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"b\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; blpop queue 1</span><br><span class=\"line\">1) <span class=\"string\">\"queue\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"c\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; blpop queue 1</span><br><span class=\"line\">1) <span class=\"string\">\"queue\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"d\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; blpop queue 1 <span class=\"comment\"># 最后一次 list已经空了。</span></span><br><span class=\"line\">(nil)</span><br><span class=\"line\">(1.08s)  <span class=\"comment\"># 阻塞了一秒</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"key查询\"><a href=\"#key查询\" class=\"headerlink\" title=\"key查询\"></a>key查询</h3><ul>\n<li>虽然redis已经有keys，并不能像mysql一个提供limit这种，导致读取的太多了。Redis是一个单线程，数据太多会阻塞。<code>scan</code>提供了三个参数 <code>cursor key limit </code>分别是 </li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> key1 1</span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> key2 1</span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> key3 1</span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> key4 1</span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> key5 1</span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; scan 0 match key* count 10</span><br><span class=\"line\">1) <span class=\"string\">\"0\"</span></span><br><span class=\"line\">2) 1) <span class=\"string\">\"key4\"</span></span><br><span class=\"line\">   2) <span class=\"string\">\"key3\"</span></span><br><span class=\"line\">   3) <span class=\"string\">\"key2\"</span></span><br><span class=\"line\">   4) <span class=\"string\">\"key5\"</span></span><br><span class=\"line\">   5) <span class=\"string\">\"key1\"</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Redis事务\"><a href=\"#Redis事务\" class=\"headerlink\" title=\"Redis事务\"></a>Redis事务</h3><blockquote>\n<p>Redis事物分别是multi/exec/discard 对应的就是begin/commit/rollback。Redis在收到exec的指令才会执行事务列队，执行完毕后一次返回指令运行结果。但是Redis仅仅是保证了个隔离性。在使用事物的时候建议使用管道pipe，这样可以减少网络请求。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 简单的演示事务</span></span><br><span class=\"line\">192.168.31.7:6379&gt; multi</span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> name wang</span><br><span class=\"line\">QUEUED</span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> name zhang</span><br><span class=\"line\">QUEUED</span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">exec</span></span><br><span class=\"line\">1) OK</span><br><span class=\"line\">2) OK</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>事务丢弃 discard</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建一个字符串并对value进行累加。</span></span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> count 1</span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; get count</span><br><span class=\"line\"><span class=\"string\">\"1\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; multi <span class=\"comment\"># 开启事物</span></span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; incr count</span><br><span class=\"line\">QUEUED</span><br><span class=\"line\">192.168.31.7:6379&gt; incr count</span><br><span class=\"line\">QUEUED</span><br><span class=\"line\">192.168.31.7:6379&gt; discard <span class=\"comment\"># 丢弃事物</span></span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; get count <span class=\"comment\">#检查数据。</span></span><br><span class=\"line\"><span class=\"string\">\"1\"</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Watch\"><a href=\"#Watch\" class=\"headerlink\" title=\"Watch\"></a>Watch</h3><blockquote>\n<p>上面的分布式锁其实是一个悲观锁，实际上可以使用watch实现乐观锁。watch会在事务开始之前，监听一个或者多个参数，当执行exec的时候redis会检查被监听的参数是否改变，如果改变了事务执行失败。这里需要注意的是watch必须在事务之前开启。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 监听count</span></span><br><span class=\"line\">192.168.31.7:6379&gt; watch count </span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; incr count <span class=\"comment\"># 自增count的value。</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">192.168.31.7:6379&gt; multi <span class=\"comment\">#开启事物</span></span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; incr count </span><br><span class=\"line\">QUEUED</span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">exec</span>  </span><br><span class=\"line\">(nil) <span class=\"comment\">#事务执行失败。</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["Redis"],"tags":["Redis"]},{"title":"Redis基础（一）","url":"/posts/1474278929/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。 </p>\n</blockquote>\n<h2 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h2><ul>\n<li>Redis是一个速度非常快的<code>非关系型数据库(non-relationl databases)</code>,它可以是存储键对值（key-vakue）方式存储数据。它拥有5中数据类型。同时可以将存储在内存中的数据持久化到因硬盘中。</li>\n<li>Redis所有的数据都是以唯一的key字符串为名称，然后可以通过这个key来获取对应的value。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>结构类型</th>\n<th>结构存储的值</th>\n<th>结构的读写能力</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>STRING</td>\n<td>可以是字符串、整数或者浮点类型</td>\n<td>对整个字符串或者字符串的其中一部分执行操作；对整数和浮点数据执行<code>自动</code>或者<code>自减</code>操作</td>\n</tr>\n<tr>\n<td>LIST</td>\n<td>一个链表、链表每个节点上都包含了一个字符串</td>\n<td>从链表的两端推入或者弹出元素；根据偏移量对链表记性修剪<code>trim</code>；读取单个或者多个元素；根据值查询或者移除元素。</td>\n</tr>\n<tr>\n<td>SET</td>\n<td>包含字符串的无序集合，并且每个被包含的字符串都是唯一约束</td>\n<td>添加、查询、移除单个元素；检查一个元素是否存在于集合中；计算交集、并集、差集；从集合里面随机获取元素。</td>\n</tr>\n<tr>\n<td>HASH</td>\n<td>包含键值对的无序散列表</td>\n<td>添加、查询、移除单个键值对；获取全部键对值。</td>\n</tr>\n<tr>\n<td>ZSET（有序集合）</td>\n<td>字符串与浮点分数之间的有序映射，元素的排列顺序由分值大决定。</td>\n<td>添加、查询、移除单个元素；根据分值范围或者成员来获取元素。</td>\n</tr>\n</tbody></table>\n<h3 id=\"String\"><a href=\"#String\" class=\"headerlink\" title=\"String\"></a>String</h3><ul>\n<li>字符串是Redis当中最简单的数据结构。Redis的字符串是动态的字符串，可以被反复修改。内部实现类似Java的ArrayList，采用预分配空间的方式来减少内存频繁分配。预分配大小方式根据字符串的大小决定，字符串小于1m则扩容空间是加倍。若字符串超过1m，扩容一次只会多扩1m的空间。字符串最大长度是512m。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">192.168.31.7:6379&gt; keys * <span class=\"comment\"># 检查当前空间key</span></span><br><span class=\"line\">(empty list or <span class=\"built_in\">set</span>) <span class=\"comment\"># 空的</span></span><br><span class=\"line\"><span class=\"comment\"># 当个字符串读写</span></span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> redis-name redis:latest</span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; keys *</span><br><span class=\"line\">1) <span class=\"string\">\"redis-name\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; get redis-name</span><br><span class=\"line\"><span class=\"string\">\"redis:latest\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> redis-version 5.0.3</span><br><span class=\"line\">OK</span><br><span class=\"line\"><span class=\"comment\"># 批量获取字符串</span></span><br><span class=\"line\">192.168.31.7:6379&gt; mget redis-name redis-version</span><br><span class=\"line\">1) <span class=\"string\">\"redis:latest\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"5.0.3\"</span></span><br><span class=\"line\"><span class=\"comment\"># 批量写入字符串</span></span><br><span class=\"line\">192.168.31.7:6379&gt; mset os mac language Chinese</span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; keys *</span><br><span class=\"line\">1) <span class=\"string\">\"redis-version\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"language\"</span></span><br><span class=\"line\">3) <span class=\"string\">\"os\"</span></span><br><span class=\"line\">4) <span class=\"string\">\"redis-name\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; mget redis-name redis-version os language </span><br><span class=\"line\">1) <span class=\"string\">\"redis:latest\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"5.0.3\"</span></span><br><span class=\"line\">3) <span class=\"string\">\"mac\"</span></span><br><span class=\"line\">4) <span class=\"string\">\"Chinese\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt;</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h3 id=\"过期时间\"><a href=\"#过期时间\" class=\"headerlink\" title=\"过期时间\"></a>过期时间</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 给key添加过期时间</span></span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> ex time </span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; expire ex 10 <span class=\"comment\"># 过期时间10秒</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">192.168.31.7:6379&gt; get ex</span><br><span class=\"line\"><span class=\"string\">\"time\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; get ex</span><br><span class=\"line\">(nil)</span><br><span class=\"line\"><span class=\"comment\"># 创建的时候就给key设置过期时间</span></span><br><span class=\"line\">192.168.31.7:6379&gt; setex ex 10 time <span class=\"comment\"># 这里的过期时间要写在key 和value 的中间</span></span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; get ex</span><br><span class=\"line\">(nil)</span><br></pre></td></tr></table></figure>\n\n<!--more-->\n\n<h3 id=\"创建时是否存在判断\"><a href=\"#创建时是否存在判断\" class=\"headerlink\" title=\"创建时是否存在判断\"></a>创建时是否存在判断</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建时候条件判断</span></span><br><span class=\"line\">192.168.31.7:6379&gt; setnx ex time</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">192.168.31.7:6379&gt; get ex</span><br><span class=\"line\"><span class=\"string\">\"time\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; setnx ex z <span class=\"comment\"># 再次插入</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0  <span class=\"comment\"># 失败，因为key ex 已经存在。</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"计数\"><a href=\"#计数\" class=\"headerlink\" title=\"计数\"></a>计数</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 如果value 就是一个整数，可以使用inrc对value进行累加。这里了解下自增范围 就是signed long的取值范围。</span></span><br><span class=\"line\">192.168.31.7:6379&gt; <span class=\"built_in\">set</span> count 1</span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; incr count </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">192.168.31.7:6379&gt; incr count </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">192.168.31.7:6379&gt; incr count </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br><span class=\"line\">192.168.31.7:6379&gt; incr count </span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\">192.168.31.7:6379&gt; get count</span><br><span class=\"line\"><span class=\"string\">\"5\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; incrby count 5 <span class=\"comment\"># 指定累加数字</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 10</span><br><span class=\"line\">192.168.31.7:6379&gt; get count</span><br><span class=\"line\"><span class=\"string\">\"10\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; decr count  <span class=\"comment\"># 自减</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 9 </span><br><span class=\"line\">192.168.31.7:6379&gt; decrby count 4 <span class=\"comment\"># 指定减数字</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"List\"><a href=\"#List\" class=\"headerlink\" title=\"List\"></a>List</h3><ul>\n<li>Redis中的List有点类似Java中的LinkedList的结构,也是一个链表，所以插入和删除速度很快O(1)。索引很慢O(n)。这一特性导致Redis中的列表经常用来做列队。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 压栈的效果，后进先出。</span></span><br><span class=\"line\">192.168.31.7:6379&gt; rpush coding java pyhon c php</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br><span class=\"line\">192.168.31.7:6379&gt; rpop coding</span><br><span class=\"line\"><span class=\"string\">\"php\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; rpop coding</span><br><span class=\"line\"><span class=\"string\">\"c\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; rpop coding</span><br><span class=\"line\"><span class=\"string\">\"pyhon\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; rpop coding</span><br><span class=\"line\"><span class=\"string\">\"java\"</span></span><br><span class=\"line\"><span class=\"comment\"># 列队，先进先出</span></span><br><span class=\"line\">192.168.31.7:6379&gt; rpush coding java pyhon c php</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br><span class=\"line\">192.168.31.7:6379&gt; lpop coding</span><br><span class=\"line\"><span class=\"string\">\"java\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; lpop coding</span><br><span class=\"line\"><span class=\"string\">\"pyhon\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; lpop coding</span><br><span class=\"line\"><span class=\"string\">\"c\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; lpop coding</span><br><span class=\"line\"><span class=\"string\">\"php\"</span></span><br><span class=\"line\"><span class=\"comment\"># 获取列队长度</span></span><br><span class=\"line\">192.168.31.7:6379&gt; llen coding</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"获取List元素\"><a href=\"#获取List元素\" class=\"headerlink\" title=\"获取List元素\"></a>获取List元素</h4><ul>\n<li>这个操作非常慢，类似LinkedList的get的操作。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">192.168.31.7:6379&gt; lindex coding 1</span><br><span class=\"line\"><span class=\"string\">\"pyhon\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; lrange coding 1 -1 <span class=\"comment\">#遍历</span></span><br><span class=\"line\">1) <span class=\"string\">\"pyhon\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"c\"</span></span><br><span class=\"line\">3) <span class=\"string\">\"php\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; ltrim coding 1 0  <span class=\"comment\"># 清空列表</span></span><br><span class=\"line\">OK</span><br><span class=\"line\">192.168.31.7:6379&gt; llen coding</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Hash\"><a href=\"#Hash\" class=\"headerlink\" title=\"Hash\"></a>Hash</h3><ul>\n<li>Redis的hash和Java中的Hashmap类似的结构，数组+链表，碰撞hash就进桶。但是redis字典值只能是字符串。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 仍进去三条</span></span><br><span class=\"line\">192.168.31.7:6379&gt; hset books java <span class=\"string\">\"think in java\"</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">192.168.31.7:6379&gt; hset books python <span class=\"string\">\"think in python\"</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">192.168.31.7:6379&gt; hset books c <span class=\"string\">\"think in c\"</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">192.168.31.7:6379&gt; hlen books</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\"><span class=\"comment\"># 根据 key获取value</span></span><br><span class=\"line\">192.168.31.7:6379&gt; hget books java</span><br><span class=\"line\"><span class=\"string\">\"think in java\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; hget books python</span><br><span class=\"line\"><span class=\"string\">\"think in python\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; hget books c</span><br><span class=\"line\"><span class=\"string\">\"think in c\"</span></span><br><span class=\"line\"><span class=\"comment\"># 更新</span></span><br><span class=\"line\">192.168.31.7:6379&gt; hset books java <span class=\"string\">\"learning in java\"</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0 <span class=\"comment\"># 更新操作返回是0。。。</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"计数-1\"><a href=\"#计数-1\" class=\"headerlink\" title=\"计数\"></a>计数</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">192.168.31.7:6379&gt; hset books count 1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">192.168.31.7:6379&gt; hincrby books count 1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2</span><br><span class=\"line\">192.168.31.7:6379&gt; hincrby books count 1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">192.168.31.7:6379&gt; hincrby books count 1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br><span class=\"line\">192.168.31.7:6379&gt; hincrby books count 1</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 5</span><br><span class=\"line\">192.168.31.7:6379&gt; hget books count</span><br><span class=\"line\"><span class=\"string\">\"5\"</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>和字符串一样value是数字的时候也可以计数。在很多常见都可以用的哈。</li>\n</ul>\n<h3 id=\"set\"><a href=\"#set\" class=\"headerlink\" title=\"set\"></a>set</h3><ul>\n<li>Redis中的set类似Java中HashSet的数据结构，key是唯一无序的，但是它的value都null。当集合中最后一个元素被删除的时候，集合也就自动删除了。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 一次写入多个key</span></span><br><span class=\"line\">192.168.31.7:6379&gt; sadd name zhangsan lisi wangwu</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\">192.168.31.7:6379&gt; sadd name zhangsan</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0 <span class=\"comment\"># zhangsan 已经存在插入失败</span></span><br><span class=\"line\">192.168.31.7:6379&gt; smembers name <span class=\"comment\"># 无序的结果</span></span><br><span class=\"line\">1) <span class=\"string\">\"wangwu\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"zhangsan\"</span></span><br><span class=\"line\">3) <span class=\"string\">\"lisi\"</span></span><br><span class=\"line\"><span class=\"comment\"># 弹出来</span></span><br><span class=\"line\">192.168.31.7:6379&gt; spop name </span><br><span class=\"line\"><span class=\"string\">\"lisi\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; spop name</span><br><span class=\"line\"><span class=\"string\">\"zhangsan\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; spop name</span><br><span class=\"line\"><span class=\"string\">\"wangwu\"</span></span><br><span class=\"line\">192.168.31.7:6379&gt; smembers name </span><br><span class=\"line\">(empty list or <span class=\"built_in\">set</span>) <span class=\"comment\"># 弹完了集合就自己删除了。</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"zset\"><a href=\"#zset\" class=\"headerlink\" title=\"zset\"></a>zset</h3><ul>\n<li>划重点，这个比较特殊。类似Java中的SortSet和HashMap的结合体,实现有点复杂。它是一个set，内部的value都是唯一的，它又可以给每个value 赋予score，代表这个value的权重。内部是一个<code>跳表列表</code>的数据结构。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 插入三个数据</span></span><br><span class=\"line\">192.168.31.7:6379&gt; zadd grade 5.0 <span class=\"string\">\"java\"</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">192.168.31.7:6379&gt; zadd grade 4.9 <span class=\"string\">\"php\"</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">192.168.31.7:6379&gt; zadd grade 5.0 <span class=\"string\">\"c\"</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1</span><br><span class=\"line\">192.168.31.7:6379&gt; zadd grade 4.9 <span class=\"string\">\"c\"</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0 <span class=\"comment\">#  value是唯一的，所以插入失败。</span></span><br><span class=\"line\"><span class=\"comment\"># 统计下数量 类似count()</span></span><br><span class=\"line\">192.168.31.7:6379&gt; zcard grade</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 3</span><br><span class=\"line\"><span class=\"comment\"># 获取value的score</span></span><br><span class=\"line\">192.168.31.7:6379&gt; zscore grade <span class=\"string\">\"java\"</span></span><br><span class=\"line\"><span class=\"string\">\"5\"</span></span><br><span class=\"line\"><span class=\"comment\"># 删除 value</span></span><br><span class=\"line\">192.168.31.7:6379&gt; zrem grade <span class=\"string\">\"java\"</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 1 <span class=\"comment\"># 删除成功</span></span><br><span class=\"line\">192.168.31.7:6379&gt; zcard grade</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 2 <span class=\"comment\"># 再次统计就是两个了</span></span><br><span class=\"line\"><span class=\"comment\"># 根据 score 排序 正序</span></span><br><span class=\"line\">192.168.31.7:6379&gt; zrange grade 0 -1</span><br><span class=\"line\">1) <span class=\"string\">\"c\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"php\"</span></span><br><span class=\"line\"><span class=\"comment\"># 根据 score 排序 倒序</span></span><br><span class=\"line\">192.168.31.7:6379&gt; zrevrange grade 0 -1</span><br><span class=\"line\">1) <span class=\"string\">\"php\"</span></span><br><span class=\"line\">2) <span class=\"string\">\"c\"</span></span><br><span class=\"line\"><span class=\"comment\"># 获取排名</span></span><br><span class=\"line\">192.168.31.7:6379&gt; zrank grade <span class=\"string\">\"c\"</span></span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 0 <span class=\"comment\"># 这里的0是第0位</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["Redis"],"tags":["Redis"]},{"title":"Mybatis-Junti","url":"/posts/899510692/","content":"<blockquote>\n<p><a href=\"https://z201.cn/2019/02/26/mybatis%E5%B0%8F%E8%AF%95%E7%89%9B%E5%88%80/\">mybatis小试牛刀</a> 在此基础上添加log日志。</p>\n</blockquote>\n<ul>\n<li><p>官方文档 ： <a href=\"http://www.mybatis.org/mybatis-3/zh/logging.html\" target=\"_blank\" rel=\"noopener\">http://www.mybatis.org/mybatis-3/zh/logging.html</a></p>\n</li>\n<li><p>项目地址 ： <a href=\"https://github.com/z201/z201.github.io.code/tree/master/mybatis-learning/mybatis-learning-02\" target=\"_blank\" rel=\"noopener\">mybatis-learning-02</a></p>\n</li>\n</ul>\n<h3 id=\"0x01-测试控制台的显示内容\"><a href=\"#0x01-测试控制台的显示内容\" class=\"headerlink\" title=\"0x01 测试控制台的显示内容\"></a>0x01 测试控制台的显示内容</h3><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">User(id=1, name=TOM, age=12, gender=0)</span><br><span class=\"line\">User(id=2, name=JON, age=13, gender=1)</span><br><span class=\"line\">User(id=3, name=King, age=11, gender=0)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"0x02-增加日志输出\"><a href=\"#0x02-增加日志输出\" class=\"headerlink\" title=\"0x02 增加日志输出\"></a>0x02 增加日志输出</h3><blockquote>\n<p>根据官方文档显示，支持的log有很多实现，这里使用Slf4j + Logback 多组合。</p>\n</blockquote>\n<ul>\n<li>根据之前的项目，这里偷懒重新创建一个项目并把之前的代码都复制过来。</li>\n<li>添加maven依赖。</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.5.0<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">junit.version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">junit.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">lmbok.version</span>&gt;</span>1.18.4<span class=\"tag\">&lt;/<span class=\"name\">lmbok.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mysql.version</span>&gt;</span>5.1.47<span class=\"tag\">&lt;/<span class=\"name\">mysql.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2.version</span>&gt;</span>1.4.197<span class=\"tag\">&lt;/<span class=\"name\">h2.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- 新增内容 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">slf4j.version</span>&gt;</span>1.7.25<span class=\"tag\">&lt;/<span class=\"name\">slf4j.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">logback.version</span>&gt;</span>1.2.3<span class=\"tag\">&lt;/<span class=\"name\">logback.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- pom文件需要指定打包编码集，[WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent!  --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>ch.qos.logback<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>logback-classic<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;logback.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>添加logback配置文件</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">appender</span> <span class=\"attr\">name</span>=<span class=\"string\">\"STDOUT\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ch.qos.logback.core.ConsoleAppender\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- encoders are assigned the type</span></span><br><span class=\"line\"><span class=\"comment\">             ch.qos.logback.classic.encoder.PatternLayoutEncoder by default --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>z201.github.cn %d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">encoder</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">appender</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">root</span> <span class=\"attr\">level</span>=<span class=\"string\">\"debug\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">appender-ref</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"STDOUT\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">root</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>再次运行单元测试。</li>\n</ul>\n<figure class=\"highlight verilog\"><table><tr><td class=\"code\"><pre><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.046</span> [main] DEBUG org<span class=\"variable\">.apache</span><span class=\"variable\">.ibatis</span><span class=\"variable\">.logging</span><span class=\"variable\">.LogFactory</span> - Logging initialized using '<span class=\"keyword\">class</span> org<span class=\"variable\">.apache</span><span class=\"variable\">.ibatis</span><span class=\"variable\">.logging</span><span class=\"variable\">.slf4j</span><span class=\"variable\">.Slf4jImpl</span>' adapter.</span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.049</span> [main] DEBUG org<span class=\"variable\">.apache</span><span class=\"variable\">.ibatis</span><span class=\"variable\">.logging</span><span class=\"variable\">.LogFactory</span> - Logging initialized using '<span class=\"keyword\">class</span> org<span class=\"variable\">.apache</span><span class=\"variable\">.ibatis</span><span class=\"variable\">.logging</span><span class=\"variable\">.slf4j</span><span class=\"variable\">.Slf4jImpl</span>' adapter.</span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.076</span> [main] DEBUG o<span class=\"variable\">.a</span><span class=\"variable\">.i</span><span class=\"variable\">.d</span><span class=\"variable\">.pooled</span><span class=\"variable\">.PooledDataSource</span> - PooledDataSource forcefully closed/removed all connections.</span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.076</span> [main] DEBUG o<span class=\"variable\">.a</span><span class=\"variable\">.i</span><span class=\"variable\">.d</span><span class=\"variable\">.pooled</span><span class=\"variable\">.PooledDataSource</span> - PooledDataSource forcefully closed/removed all connections.</span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.076</span> [main] DEBUG o<span class=\"variable\">.a</span><span class=\"variable\">.i</span><span class=\"variable\">.d</span><span class=\"variable\">.pooled</span><span class=\"variable\">.PooledDataSource</span> - PooledDataSource forcefully closed/removed all connections.</span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.076</span> [main] DEBUG o<span class=\"variable\">.a</span><span class=\"variable\">.i</span><span class=\"variable\">.d</span><span class=\"variable\">.pooled</span><span class=\"variable\">.PooledDataSource</span> - PooledDataSource forcefully closed/removed all connections.</span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.155</span> [main] DEBUG o<span class=\"variable\">.a</span><span class=\"variable\">.i</span><span class=\"variable\">.t</span><span class=\"variable\">.jdbc</span><span class=\"variable\">.JdbcTransaction</span> - Opening JDBC Connection</span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.356</span> [main] DEBUG o<span class=\"variable\">.a</span><span class=\"variable\">.i</span><span class=\"variable\">.d</span><span class=\"variable\">.pooled</span><span class=\"variable\">.PooledDataSource</span> - Created connection <span class=\"number\">1839168128</span>.</span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.356</span> [main] DEBUG o<span class=\"variable\">.a</span><span class=\"variable\">.i</span><span class=\"variable\">.t</span><span class=\"variable\">.jdbc</span><span class=\"variable\">.JdbcTransaction</span> - Setting autocommit to false on JDBC Connection [conn0: url=jdbc:h2:mem:mybatis_learning_01_db user=ROOT]</span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.358</span> [main] DEBUG c<span class=\"variable\">.z201</span><span class=\"variable\">.mybatis</span><span class=\"variable\">.learning</span><span class=\"variable\">.UserDao</span><span class=\"variable\">.list</span> - ==&gt;  Preparing: SELECT * FROM <span class=\"meta\">`user` </span></span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.384</span> [main] DEBUG c<span class=\"variable\">.z201</span><span class=\"variable\">.mybatis</span><span class=\"variable\">.learning</span><span class=\"variable\">.UserDao</span><span class=\"variable\">.list</span> - ==&gt; Parameters: </span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.411</span> [main] DEBUG c<span class=\"variable\">.z201</span><span class=\"variable\">.mybatis</span><span class=\"variable\">.learning</span><span class=\"variable\">.UserDao</span><span class=\"variable\">.list</span> - &lt;==      Total: <span class=\"number\">3</span></span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.414</span> [main] DEBUG o<span class=\"variable\">.a</span><span class=\"variable\">.i</span><span class=\"variable\">.t</span><span class=\"variable\">.jdbc</span><span class=\"variable\">.JdbcTransaction</span> - Resetting autocommit to true on JDBC Connection [conn0: url=jdbc:h2:mem:mybatis_learning_01_db user=ROOT]</span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.415</span> [main] DEBUG o<span class=\"variable\">.a</span><span class=\"variable\">.i</span><span class=\"variable\">.t</span><span class=\"variable\">.jdbc</span><span class=\"variable\">.JdbcTransaction</span> - Closing JDBC Connection [conn0: url=jdbc:h2:mem:mybatis_learning_01_db user=ROOT]</span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.415</span> [main] DEBUG o<span class=\"variable\">.a</span><span class=\"variable\">.i</span><span class=\"variable\">.d</span><span class=\"variable\">.pooled</span><span class=\"variable\">.PooledDataSource</span> - Returned connection <span class=\"number\">1839168128</span> to pool.</span><br><span class=\"line\">User(id=<span class=\"number\">1</span>, name=TOM, age=<span class=\"number\">12</span>, gender=<span class=\"number\">0</span>)</span><br><span class=\"line\">User(id=<span class=\"number\">2</span>, name=JON, age=<span class=\"number\">13</span>, gender=<span class=\"number\">1</span>)</span><br><span class=\"line\">User(id=<span class=\"number\">3</span>, name=King, age=<span class=\"number\">11</span>, gender=<span class=\"number\">0</span>)</span><br><span class=\"line\">z201<span class=\"variable\">.github</span><span class=\"variable\">.cn</span> <span class=\"number\">15</span>:<span class=\"number\">08</span>:<span class=\"number\">30</span><span class=\"variable\">.416</span> [main] DEBUG cn<span class=\"variable\">.z201</span><span class=\"variable\">.mybatis</span><span class=\"variable\">.test</span><span class=\"variable\">.MybatisTest01</span> - <span class=\"keyword\">end</span>...</span><br></pre></td></tr></table></figure>\n\n","categories":["Mybatis"],"tags":["Junit4","Mybatis"]},{"title":"Mybatis-H2-Junit","url":"/posts/887797189/","content":"<blockquote>\n<p>接着上章内容<a href=\"https://z201.cn/2019/02/26/mybatis%E6%BA%90%E7%A0%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/\">mybatis源码环境搭建</a>,根据官方文档，运行一个demo项目。</p>\n</blockquote>\n<h3 id=\"项目结构\"><a href=\"#项目结构\" class=\"headerlink\" title=\"项目结构\"></a>项目结构</h3><ul>\n<li>项目源代码:<a href=\"https://github.com/z201/z201.github.io.code/tree/master/mybatis-learning/mybatis-learning-01\" target=\"_blank\" rel=\"noopener\">mybatis-learning-01</a></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mybatis-learning/mybatis-learning-01</span><br><span class=\"line\">├── mybatis-learning-01.iml</span><br><span class=\"line\">├── pom.xml  <span class=\"comment\">#项目依赖管理 1</span></span><br><span class=\"line\">└── src</span><br><span class=\"line\">    ├── main</span><br><span class=\"line\">    │   ├── java</span><br><span class=\"line\">    │   │   ├── cn</span><br><span class=\"line\">    │   │   │   └── z201</span><br><span class=\"line\">    │   │   │       └── mybatis</span><br><span class=\"line\">    │   │   │           └── learning</span><br><span class=\"line\">    │   │   │               ├── SetUpSessionFactory.java <span class=\"comment\"># mybatis 初始化  3</span></span><br><span class=\"line\">    │   │   │               ├── User.java <span class=\"comment\"># 实体 5</span></span><br><span class=\"line\">    │   │   │               └── UserDao.java <span class=\"comment\"># 实体dao 6</span></span><br><span class=\"line\">    │   │   └── package-info.java</span><br><span class=\"line\">    │   └── resources</span><br><span class=\"line\">    │       ├── init_table.sql <span class=\"comment\"># h2数据库初始化sql 4</span></span><br><span class=\"line\">    │       ├── mybatis</span><br><span class=\"line\">    │       │   └── UserDao.xml <span class=\"comment\"># dao 对应的mapper 7</span></span><br><span class=\"line\">    │       └── mybatis-config.xml <span class=\"comment\"># mybatis 配置文件 2</span></span><br><span class=\"line\">    └── <span class=\"built_in\">test</span></span><br><span class=\"line\">        └── java</span><br><span class=\"line\">            └── cn</span><br><span class=\"line\">                └── z201</span><br><span class=\"line\">                    └── mybatis</span><br><span class=\"line\">                        └── <span class=\"built_in\">test</span></span><br><span class=\"line\">                            ├── MybatisTest01.java <span class=\"comment\"># 单元测试 8</span></span><br><span class=\"line\">                            └── package-info.java</span><br><span class=\"line\"></span><br><span class=\"line\">15 directories, 11 files</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>根据上面注释的顺序，我们依次介绍项目代码。</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<h4 id=\"0x01-项目依赖管理\"><a href=\"#0x01-项目依赖管理\" class=\"headerlink\" title=\"0x01 项目依赖管理\"></a>0x01 项目依赖管理</h4><figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.z201<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-learning-01<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.5.0<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">junit.version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">junit.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">lmbok.version</span>&gt;</span>1.18.4<span class=\"tag\">&lt;/<span class=\"name\">lmbok.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mysql.version</span>&gt;</span>5.1.47<span class=\"tag\">&lt;/<span class=\"name\">mysql.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">h2.version</span>&gt;</span>1.4.197<span class=\"tag\">&lt;/<span class=\"name\">h2.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- pom文件需要指定打包编码集，[WARNING] File encoding has not been set, using platform encoding GBK, i.e. build is platform dependent!  --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;lmbok.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mysql.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.h2database<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>h2<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;h2.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t</span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;junit.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"0x02-mybatis-配置文件\"><a href=\"#0x02-mybatis-配置文件\" class=\"headerlink\" title=\"0x02 mybatis 配置文件\"></a>0x02 mybatis 配置文件</h4><figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">configuration</span></span></span><br><span class=\"line\"><span class=\"meta\">        <span class=\"meta-keyword\">PUBLIC</span> <span class=\"meta-string\">\"-//mybatis.org//DTD Config 3.0//EN\"</span></span></span><br><span class=\"line\"><span class=\"meta\">        <span class=\"meta-string\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">environments</span> <span class=\"attr\">default</span>=<span class=\"string\">\"development\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">environment</span> <span class=\"attr\">id</span>=<span class=\"string\">\"development\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">transactionManager</span> <span class=\"attr\">type</span>=<span class=\"string\">\"JDBC\"</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">\"POOLED\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"org.h2.Driver\"</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:h2:mem:mybatis_learning_01_db;MODE=MYSQL;INIT=RUNSCRIPT FROM './src/main/resources/init_table.sql'\"</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"\"</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">environment</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">environments</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"mybatis/UserDao.xml\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">mappers</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"0x03-mybatis-初始化\"><a href=\"#0x03-mybatis-初始化\" class=\"headerlink\" title=\"0x03 mybatis 初始化\"></a>0x03 mybatis 初始化</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.mybatis.learning;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.io.Resources;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SetUpSessionFactory</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> SqlSession <span class=\"title\">initSessionFactory</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">        String resource = <span class=\"string\">\"mybatis-config.xml\"</span>;</span><br><span class=\"line\">        InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class=\"line\">        SqlSessionFactory sqlSessionFactory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sqlSessionFactory.openSession();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"0x04-h2数据库初始化sql\"><a href=\"#0x04-h2数据库初始化sql\" class=\"headerlink\" title=\"0x04 h2数据库初始化sql\"></a>0x04 h2数据库初始化sql</h4><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`user`</span>(</span><br><span class=\"line\">  <span class=\"keyword\">id</span> <span class=\"built_in\">SMALLINT</span> PRIMARY <span class=\"keyword\">KEY</span> AUTO_INCREMENT ,</span><br><span class=\"line\">  <span class=\"keyword\">name</span> <span class=\"built_in\">VARCHAR</span>(<span class=\"number\">50</span>),</span><br><span class=\"line\">  age <span class=\"built_in\">SMALLINT</span>,</span><br><span class=\"line\">  gender <span class=\"built_in\">SMALLINT</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`user`</span>(<span class=\"keyword\">name</span> , age , gender) <span class=\"keyword\">VALUES</span>(<span class=\"string\">'TOM'</span> , <span class=\"number\">12</span> , <span class=\"number\">0</span> );</span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`user`</span>(<span class=\"keyword\">name</span> , age , gender) <span class=\"keyword\">VALUES</span>(<span class=\"string\">'JON'</span> , <span class=\"number\">13</span> , <span class=\"number\">1</span> );</span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`user`</span>(<span class=\"keyword\">name</span> , age , gender) <span class=\"keyword\">VALUES</span>(<span class=\"string\">'King'</span> , <span class=\"number\">11</span> , <span class=\"number\">0</span> );</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"0x05-实体bean\"><a href=\"#0x05-实体bean\" class=\"headerlink\" title=\"0x05  实体bean\"></a>0x05  实体bean</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.mybatis.learning;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.AllArgsConstructor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.ToString;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"meta\">@ToString</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer id;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer age;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer gender;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"0x06-实体dao\"><a href=\"#0x06-实体dao\" class=\"headerlink\" title=\"0x06 实体dao\"></a>0x06 实体dao</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.mybatis.learning;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserDao</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">List&lt;User&gt; <span class=\"title\">list</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"0x07-实体dao对应的mapper-xml\"><a href=\"#0x07-实体dao对应的mapper-xml\" class=\"headerlink\" title=\"0x07 实体dao对应的mapper.xml\"></a>0x07 实体dao对应的mapper.xml</h4><figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">mapper</span> <span class=\"meta-keyword\">PUBLIC</span> <span class=\"meta-string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span> <span class=\"meta-string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span> &gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"cn.z201.mybatis.learning.UserDao\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"list\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"cn.z201.mybatis.learning.User\"</span>&gt;</span></span><br><span class=\"line\">      SELECT * FROM `user`</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"0x08-单元测试\"><a href=\"#0x08-单元测试\" class=\"headerlink\" title=\"0x08 单元测试\"></a>0x08 单元测试</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.mybatis.test;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.mybatis.learning.SetUpSessionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.mybatis.learning.User;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.mybatis.learning.UserDao;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.Assert;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.junit.Test;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MybatisTest01</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test01</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">        SetUpSessionFactory setUpSessionFactory = <span class=\"keyword\">new</span> SetUpSessionFactory();</span><br><span class=\"line\">        SqlSession sqlSession = setUpSessionFactory.initSessionFactory();</span><br><span class=\"line\">        UserDao userDao = sqlSession.getMapper(UserDao<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">        List&lt;User&gt; userList = userDao.list();</span><br><span class=\"line\">        sqlSession.close();</span><br><span class=\"line\">        Assert.assertNotNull(userList);</span><br><span class=\"line\">        userList.forEach(System.out::println);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>结果</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">User(id=1, name=TOM, age=12, gender=0)</span><br><span class=\"line\">User(id=2, name=JON, age=13, gender=1)</span><br><span class=\"line\">User(id=3, name=King, age=11, gender=0)</span><br></pre></td></tr></table></figure>\n\n","categories":["Mybatis"],"tags":["Mybatis","H2"]},{"title":"源码分析-mybatis源码环境搭建","url":"/posts/716639737/","content":"<blockquote>\n<p>mybatis学习笔记。</p>\n</blockquote>\n<h2 id=\"0x00-阅读源代码\"><a href=\"#0x00-阅读源代码\" class=\"headerlink\" title=\"0x00 阅读源代码\"></a>0x00 阅读源代码</h2><h3 id=\"下载源代码\"><a href=\"#下载源代码\" class=\"headerlink\" title=\"下载源代码\"></a>下载源代码</h3><ul>\n<li>代码仓库地址 <a href=\"https://github.com/mybatis/mybatis-3.git\" target=\"_blank\" rel=\"noopener\">https://github.com/mybatis/mybatis-3.git</a></li>\n<li>阅读版本号 <code>myabtis-3.5.0</code></li>\n<li>下载版本<code>git clone -b mybatis-3.5.0 https://github.com/mybatis/mybatis-3.git</code><ul>\n<li>由于github下载速度是在太慢了，这里用gitee克隆一个镜像。</li>\n<li>下载版本<code>git clone -b mybatis-3.5.0 https://gitee.com/Z201/mybatis-3.git</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"查看源代码结构\"><a href=\"#查看源代码结构\" class=\"headerlink\" title=\"查看源代码结构\"></a>查看源代码结构</h3><ul>\n<li>查看项目主要文件夹</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">tree -d L 2</span><br><span class=\"line\">.</span><br><span class=\"line\">├── src  </span><br><span class=\"line\">│   ├── main <span class=\"comment\"># 源代码</span></span><br><span class=\"line\">│   ├── site <span class=\"comment\"># 站点稳当</span></span><br><span class=\"line\">│   └── <span class=\"built_in\">test</span> <span class=\"comment\"># 单元测试</span></span><br><span class=\"line\">└── travis   <span class=\"comment\"># 官方的ci集成</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>查看项目源码主目录</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">tree -d src/main -L 5</span><br><span class=\"line\">src/main</span><br><span class=\"line\">└── java</span><br><span class=\"line\">    └── org</span><br><span class=\"line\">        └── apache</span><br><span class=\"line\">            └── ibatis</span><br><span class=\"line\">                ├── annotations <span class=\"comment\"># 注解</span></span><br><span class=\"line\">                ├── binding     <span class=\"comment\"># 代理</span></span><br><span class=\"line\">                ├── builder     <span class=\"comment\"># 构造</span></span><br><span class=\"line\">                ├── cache       <span class=\"comment\"># 缓存</span></span><br><span class=\"line\">                ├── cursor      <span class=\"comment\"># 返回值类型为游标的方法</span></span><br><span class=\"line\">                ├── datasource  <span class=\"comment\"># 数据源</span></span><br><span class=\"line\">                ├── exceptions  <span class=\"comment\"># 异常</span></span><br><span class=\"line\">                ├── executor    <span class=\"comment\"># 数据操作具体执行</span></span><br><span class=\"line\">                ├── io          <span class=\"comment\"># 文件流</span></span><br><span class=\"line\">                ├── jdbc        <span class=\"comment\"># jdbc模块</span></span><br><span class=\"line\">                ├── lang        <span class=\"comment\"># 工具</span></span><br><span class=\"line\">                ├── logging     <span class=\"comment\"># 日志</span></span><br><span class=\"line\">                ├── mapping     <span class=\"comment\"># 映射、参数、结果集。</span></span><br><span class=\"line\">                ├── parsing     <span class=\"comment\"># 解析器</span></span><br><span class=\"line\">                ├── plugin      <span class=\"comment\"># 插件</span></span><br><span class=\"line\">                ├── reflection  <span class=\"comment\"># 反射</span></span><br><span class=\"line\">                ├── scripting   <span class=\"comment\"># sql解析</span></span><br><span class=\"line\">                ├── session     <span class=\"comment\"># 接口层会话</span></span><br><span class=\"line\">                ├── transaction <span class=\"comment\"># 事物</span></span><br><span class=\"line\">                └── <span class=\"built_in\">type</span>        <span class=\"comment\"># 类型</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>将项目导入idea中，就可以看到完整的源代码了。</li>\n</ul>\n<h2 id=\"0x01-根据官方文档快速入门\"><a href=\"#0x01-根据官方文档快速入门\" class=\"headerlink\" title=\"0x01 根据官方文档快速入门\"></a>0x01 根据官方文档快速入门</h2><blockquote>\n<p>强烈推荐认真阅读mybatis的官方文档。</p>\n</blockquote>\n<ul>\n<li>官方文档地址 ： <a href=\"http://www.mybatis.org/mybatis-3/zh/getting-started.html\" target=\"_blank\" rel=\"noopener\">http://www.mybatis.org/mybatis-3/zh/getting-started.html</a></li>\n</ul>\n","categories":["源码分析"],"tags":["Mybatis"]},{"title":"Maven","url":"/posts/2184043232/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h3 id=\"Mavan常用命令以及用法\"><a href=\"#Mavan常用命令以及用法\" class=\"headerlink\" title=\"Mavan常用命令以及用法\"></a>Mavan常用命令以及用法</h3><ul>\n<li>常用命令就要先了解Maven的生命周期<ul>\n<li>Maven的生命周期就是对所有的构建过程进行抽象和统一。包含了项目的清理、初始化、编译、测试、打包、集成测试、验证、部署和站点生成等几乎所有的构建步骤。</li>\n<li>Maven的生命周期是抽象的，即生命周期不做任何实际的工作，实际任务由插件完成，类似于设计模式中的模板方法。所以必须有对应的插件才能执行对于的步骤。</li>\n<li>Maven有三套相互独立的生命周期，分别是clean、default和site。每个生命周期包含一些阶段（phase），阶段是有顺序的，后面的阶段依赖于前面的阶段。<ul>\n<li><strong>clean生命周期</strong>：清理项目，包含三个phase。<ul>\n<li>1.）pre-clean：执行清理前需要完成的工作。</li>\n<li>2）clean：清理上一次构建生成的文件。</li>\n<li>3）post-clean：执行清理后需要完成的工作。</li>\n</ul>\n</li>\n<li><strong>default生命周期</strong>：构建项目，重要的phase如下。<ul>\n<li>1）validate：验证工程是否正确，所有需要的资源是否可用。</li>\n<li>2）compile：编译项目的源代码。  </li>\n<li>3）test：使用合适的单元测试框架来测试已编译的源代码。这些测试不需要已打包和布署。</li>\n<li>4）Package：把已编译的代码打包成可发布的格式，比如jar。</li>\n<li>5）integration-test：如有需要，将包处理和发布到一个能够进行集成测试的环境。</li>\n<li>6）verify：运行所有检查，验证包是否有效且达到质量标准。</li>\n<li>7）install：把包安装到maven本地仓库，可以被其他工程作为依赖来使用。</li>\n<li>8）Deploy：在集成或者发布环境下执行，将最终版本的包拷贝到远程的repository，使得其他的开发者或者工程可以共享。</li>\n</ul>\n</li>\n<li><strong>site生命周期</strong>：建立和发布项目站点，phase如下。<ul>\n<li>1）pre-site：生成项目站点之前需要完成的工作。</li>\n<li>2）site：生成项目站点文档。</li>\n<li>3）post-site：生成项目站点之后需要完成的工作。</li>\n<li>4）site-deploy：将项目站点发布到服务器</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<a id=\"more\"></a>\n\n<ul>\n<li><p>mvn clean </p>\n<ul>\n<li>清理项目构建文件。调用clean生命周期的clean阶段，实际执行pre-clean和clean阶段。</li>\n</ul>\n</li>\n<li><p>mvn install</p>\n<ul>\n<li>构建项目文件。实际执行pre-clean和clean，install以及之前所有阶段。</li>\n</ul>\n</li>\n<li><p>mvn install -Dmaven.test.skip=true</p>\n<ul>\n<li><p>构建项目的时候不执行测试。也可以使用插件来配置。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- surefire 插件用来在maven构建生命周期的test phase执行一个应用的单元测试 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-surefire-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.19.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">skipTests</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">skipTests</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">forkMode</span>&gt;</span>once<span class=\"tag\">&lt;/<span class=\"name\">forkMode</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">argLine</span>&gt;</span>-Dfile.encoding=UTF-8<span class=\"tag\">&lt;/<span class=\"name\">argLine</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">         <span class=\"comment\">&lt;!-- 插件手动匹配JUnit 目前是使用4.10的版本--&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.surefire<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>surefire-junit47<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.19.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>mvn eclipse:eclipse</p>\n<ul>\n<li>将pom项目转换成eclipse格式项目。</li>\n</ul>\n</li>\n<li><p>mvn jetty:run -war </p>\n<ul>\n<li><p>使用内置jetty启动项目,需要配置jetty扩展插件。也可以使用tomcat来作为插件。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 配置Maven插件(mvn jetty:run -war可以运行项目) --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.eclipse.jetty<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jetty-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>9.3.0.M1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 指定访问端口 --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">httpConnector</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">port</span>&gt;</span>80<span class=\"tag\">&lt;/<span class=\"name\">port</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">httpConnector</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 间隔x扫描一次,实现热部署 </span></span><br><span class=\"line\"><span class=\"comment\">            &lt;scanIntervalSeconds&gt;0&lt;/scanIntervalSeconds&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 编写类文件之后，是否自动重启jetty；可选后面两个值[manual|automatic] </span></span><br><span class=\"line\"><span class=\"comment\">            &lt;reload&gt;manual&lt;/reload&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 指定关闭端口 --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">stopPort</span>&gt;</span>9998<span class=\"tag\">&lt;/<span class=\"name\">stopPort</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">stopKey</span>&gt;</span>stop-jetty<span class=\"tag\">&lt;/<span class=\"name\">stopKey</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">webApp</span>&gt;</span></span><br><span class=\"line\">               <span class=\"comment\">&lt;!-- 配置&lt;contextPath&gt;/&lt;/contextPath&gt;，则访问路径为http://localhost:80 --&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">contextPath</span>&gt;</span>/<span class=\"tag\">&lt;/<span class=\"name\">contextPath</span>&gt;</span></span><br><span class=\"line\">               <span class=\"comment\">&lt;!-- 更改jetty默认webdefault.xml文件，主要修改了useFileMappedBuffer属性为false，使其不锁定静态文件 --&gt;</span></span><br><span class=\"line\">               <span class=\"comment\">&lt;!-- 此文件在C盘\\用户目录\\.m2\\repository\\org\\eclipse\\jetty\\jetty-webapp\\9.1.0.RC1\\找到jar包，打开jar包目录org\\eclipse\\jetty\\webapp\\目录中 --&gt;</span></span><br><span class=\"line\">               <span class=\"comment\">&lt;!-- &lt;defaultsDescriptor&gt;webdefault.xml&lt;/defaultsDescriptor&gt; --&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">defaultsDescriptor</span>&gt;</span>src/main/resources/webdefault.xml<span class=\"tag\">&lt;/<span class=\"name\">defaultsDescriptor</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">webApp</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"插件Git-Version\"><a href=\"#插件Git-Version\" class=\"headerlink\" title=\"插件Git Version\"></a>插件Git Version</h3><figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- Git Version插件 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>pl.project13.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>git-commit-id-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>get-the-git-infos<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">phase</span>&gt;</span>initialize<span class=\"tag\">&lt;/<span class=\"name\">phase</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>revision<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dotGitDirectory</span>&gt;</span>$&#123;project.basedir&#125;/.git<span class=\"tag\">&lt;/<span class=\"name\">dotGitDirectory</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">verbose</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">verbose</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dateFormat</span>&gt;</span>yyyy-MM-dd HH:mm:ss<span class=\"tag\">&lt;/<span class=\"name\">dateFormat</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">prefix</span>&gt;</span>git<span class=\"tag\">&lt;/<span class=\"name\">prefix</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">generateGitPropertiesFile</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">generateGitPropertiesFile</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">generateGitPropertiesFilename</span>&gt;</span>$&#123;project.build.outputDirectory&#125;/$&#123;project.name&#125;.build.json<span class=\"tag\">&lt;/<span class=\"name\">generateGitPropertiesFilename</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">format</span>&gt;</span>json<span class=\"tag\">&lt;/<span class=\"name\">format</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">gitDescribe</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">skip</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">skip</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">always</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">always</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dirty</span>&gt;</span>-dirty<span class=\"tag\">&lt;/<span class=\"name\">dirty</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">gitDescribe</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>插件将会在每次构建时生成一个版本相关文件</li>\n</ul>\n","categories":["Maven"],"tags":["Maven"]},{"title":"查缺补漏-Git","url":"/posts/2654339136/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h2 id=\"Git速度查询表\"><a href=\"#Git速度查询表\" class=\"headerlink\" title=\"Git速度查询表\"></a>Git速度查询表</h2><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Git/Git.jpg\"></p>\n<blockquote>\n<p> 下面是常用 的Git 命令清单。几个专用名词的译名如下：</p>\n</blockquote>\n<ul>\n<li>Workspace：工作区</li>\n<li>Index / Stage：暂存区</li>\n<li>Repository：仓库区（或本地仓库）</li>\n<li>Remote：远程仓库</li>\n</ul>\n<h3 id=\"最小配置\"><a href=\"#最小配置\" class=\"headerlink\" title=\"最小配置\"></a>最小配置</h3><blockquote>\n<p>为什么要最小配置,每次提交代码需要告诉git。所以需要简单设置下user信息。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git config --global user.name <span class=\"string\">'your name'</span></span><br><span class=\"line\">git config --global user.email <span class=\"string\">'your email'</span></span><br></pre></td></tr></table></figure>\n\n<p>这里需要注意config的三个作用域</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git config --<span class=\"built_in\">local</span>  <span class=\"comment\">#某个git本地仓库有效</span></span><br><span class=\"line\">git config --global <span class=\"comment\">#当前用户所有仓库有效，就是你系统的登陆用户。</span></span><br><span class=\"line\">git config --system <span class=\"comment\">#对系统所有的仓库都有效果。</span></span><br></pre></td></tr></table></figure>\n\n<p>我们一般只会使用local 和 global这两个配置。当我们配置好user.name user.email之后，我们可以检查下配置信息。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git config --list --<span class=\"built_in\">local</span> <span class=\"comment\"># 注意，必须在某个仓库里面才能看到。</span></span><br><span class=\"line\">git config --list --global</span><br><span class=\"line\">git config --list --system</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建一个本地仓库\"><a href=\"#创建一个本地仓库\" class=\"headerlink\" title=\"创建一个本地仓库\"></a>创建一个本地仓库</h3><blockquote>\n<p>一般来说git仓库有两种情况，一种是没有仓库，另外一种就是已经有仓库了。这里对第一种情况演示，因为工作中习惯在web上创建仓库。这里还是了解下。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git init git_learning</span><br></pre></td></tr></table></figure>\n\n<p>创建一个README文件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">touch README.md</span><br></pre></td></tr></table></figure>\n\n<p>这里需要说明下，本地仓库创建完成后需要与远程仓库进行管理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">git remote add origin github.com:yourname&#x2F;git_learning.git # 这里的yourname 是你的git账号</span><br></pre></td></tr></table></figure>\n\n<p>建议手动去github上面创建一个叫git_learning的仓库。上面的命令就是做下关联。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git add . <span class=\"comment\"># 将当前文件添加至暂存区</span></span><br><span class=\"line\">git commit -m <span class=\"string\">\"upload file\"</span> <span class=\"comment\"># 将暂存区的文件提交到本地仓库</span></span><br><span class=\"line\">git push origin mastet <span class=\"comment\"># 将本地仓库的改动信息推送到远程仓库中</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"可控一个远程仓库\"><a href=\"#可控一个远程仓库\" class=\"headerlink\" title=\"可控一个远程仓库\"></a>可控一个远程仓库</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 克隆一个仓库</span></span><br><span class=\"line\">git <span class=\"built_in\">clone</span> www.**/**.git</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"文件追踪\"><a href=\"#文件追踪\" class=\"headerlink\" title=\"文件追踪\"></a>文件追踪</h3><blockquote>\n<p>有些时候不想提交部分文件，但是git add .的时候添加进去了。</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># 添加文件到暂存区</span></span></span><br><span class=\"line\">git add [file] [file] </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># 添加文件夹暂存区</span></span></span><br><span class=\"line\">git add [dir]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># 添加当前目录所有文件暂存区</span></span></span><br><span class=\"line\">git add .</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\"># 如果是对所有文件都取消跟踪的话，就是</span></span></span><br><span class=\"line\">git rm -r --cached . 　　       ## 不删除本地文件</span><br><span class=\"line\">git rm -r --f . 　　            ## 删除本地文件</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"><span class=\"comment\">#对某个文件取消跟踪</span></span></span><br><span class=\"line\">git rm --cached readme1.txt    ## 删除readme1.txt的跟踪，并保留在本地。</span><br><span class=\"line\">git rm --f readme1.txt         ## 删除readme1.txt的跟踪，并且删除本地文件s</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"提交仓库\"><a href=\"#提交仓库\" class=\"headerlink\" title=\"提交仓库\"></a>提交仓库</h3><blockquote>\n<p>如果发现message写错了，可以修改下。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 修改最新一次commit提交message。</span></span><br><span class=\"line\">git commit --amend  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 提交暂存区的指定文件到仓库区</span></span><br><span class=\"line\">git commit [file1] [file2] ... -m [message]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将本地暂存区的文件推送到本地仓库。 当修改已经通过`git add &lt;change file&gt;`将其添加到`stage`，可以通过`git commit -m \"&lt;message&gt;\"`为这所有已经进入`stage`的改变添加一个`commit`信息。</span></span><br><span class=\"line\">git commit -m</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#可以直接使用`git commit -am \"&lt;message&gt;\"`，将所有修改，但未进`stage`的改动加入`stage`，并记录`commit`信息。(某种程度上相当于`git add`和`git commit -m`的组合技，前提是被改动文件已经是`tracked`)</span></span><br><span class=\"line\">git commit -am</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#这个命令经常会出现在本地仓库与远程仓库发生冲突的时候，需要强制推送更新。</span></span><br><span class=\"line\">git push -f origin master</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 推送删除远程分支操作</span></span><br><span class=\"line\">git push origin : xxxx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 推送删除远程分支操作</span></span><br><span class=\"line\">git push origin --delete xxxx</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>如果想修改以往的commit的message。注意是不连续的commit。<ul>\n<li>首先查看log 里面的信息,然后获取commitid进行合并</li>\n</ul>\n</li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"信息查看\"><a href=\"#信息查看\" class=\"headerlink\" title=\"信息查看\"></a>信息查看</h3><blockquote>\n<p>如果我们需要查看commit 提交日志可以使用log命令，这里简单介绍下log。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看查看本地仓库状态信息。</span></span><br><span class=\"line\">git status</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#log信息一行显示</span></span><br><span class=\"line\">git <span class=\"built_in\">log</span> --oneline </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#对比提交信息</span></span><br><span class=\"line\">git diff</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示暂存区和上一个commit的差异</span></span><br><span class=\"line\">git diff --cached [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示工作区与当前分支最新commit之间的差异</span></span><br><span class=\"line\">git diff HEAD</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示两次提交之间的差异</span></span><br><span class=\"line\">git diff [first-branch]...[second-branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示今天你写了多少行代码</span></span><br><span class=\"line\">git diff --shortstat <span class=\"string\">\"@&#123;0 day ago&#125;\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某次提交的元数据和内容变化</span></span><br><span class=\"line\">git show [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某次提交发生变化的文件</span></span><br><span class=\"line\">git show --name-only [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某次提交时，某个文件的内容</span></span><br><span class=\"line\">git show [commit]:[filename]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示当前分支的最近几次提交</span></span><br><span class=\"line\">git reflog</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 自带的图形化命令看提交记录。</span></span><br><span class=\"line\">git <span class=\"built_in\">log</span> --oneline --graph</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#log信息一行显示。且显示2条记录。</span></span><br><span class=\"line\">git <span class=\"built_in\">log</span> --oneline -n2</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"撤销\"><a href=\"#撤销\" class=\"headerlink\" title=\"撤销\"></a>撤销</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 修改文件名称。</span></span><br><span class=\"line\">git mv -f xxx xxx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 有的时候误将文件提交到__暂存区__,用这个命令可以删除掉。避免提交到远程仓库中。</span></span><br><span class=\"line\">git rm --cache xxxx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 因为项目初始化的时候未正确配置排除文件导致部分文件一直保存在服务器中。所以需要远程删除下。</span></span><br><span class=\"line\"><span class=\"comment\"># 加上 -n 这个参数，执行命令时，是不会删除任何文件，而是展示此命令要删除的文件列表预览。</span></span><br><span class=\"line\">git rm -r -n —cached xxx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 远程删除文件</span></span><br><span class=\"line\">git rm -r --cached xxx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除错误版本提交，一般是就近的一个远程仓库版本。</span></span><br><span class=\"line\">git reset --soft xxx(版本号)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 仅仅只是撤销已经提交的版本库和暂存区，工作去不受影响。这个操作通常是用来后悔提交的。工作去的代码依然有价值。</span></span><br><span class=\"line\">git reset --mixed xxx(版本号)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将工作去、暂存区、仓库版记录回复到某一个版本。这个操作非常犀利，尽量少用。</span></span><br><span class=\"line\">git reset --hard xxx(版本号)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"分支\"><a href=\"#分支\" class=\"headerlink\" title=\"分支\"></a>分支</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 切换分支，若分支不存在则创建一个xxx分支。</span></span><br><span class=\"line\">git checkout xxx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查询当前工作分支</span></span><br><span class=\"line\">git branch --v</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#查看远程分支</span></span><br><span class=\"line\">git branch -r</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除本地没有打开的分支。</span></span><br><span class=\"line\">git branch -d  xxx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除本地打开的分支</span></span><br><span class=\"line\">git branch -D xxx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除远程仓库分支</span></span><br><span class=\"line\">git branch -r -d origin/xxxx</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关闭大小写忽略\"><a href=\"#关闭大小写忽略\" class=\"headerlink\" title=\"关闭大小写忽略\"></a>关闭大小写忽略</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git config core.ignorecase <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"量修改历史记录中的信息\"><a href=\"#量修改历史记录中的信息\" class=\"headerlink\" title=\"量修改历史记录中的信息\"></a>量修改历史记录中的信息</h3><blockquote>\n<p>进入该仓库目录，打开 git bash 界面，执行 <code>git log</code> 命令查看历史提交信息（重点关注 Author）。</p>\n</blockquote>\n<ul>\n<li>打开一个文本编辑器，粘贴下面代码。<br>然后把 OLD_EMAIL，CORRECT_NAME，CORRECT_EMAIL 改成自己的新旧邮箱用户名。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"></span><br><span class=\"line\">git filter-branch --env-filter <span class=\"string\">'</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">OLD_EMAIL=\"原来的邮箱\"</span></span><br><span class=\"line\"><span class=\"string\">CORRECT_NAME=\"现在的名字\"</span></span><br><span class=\"line\"><span class=\"string\">CORRECT_EMAIL=\"现在的邮箱\"</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">if [ \"$GIT_COMMITTER_EMAIL\" = \"$OLD_EMAIL\" ]</span></span><br><span class=\"line\"><span class=\"string\">then</span></span><br><span class=\"line\"><span class=\"string\">    export GIT_COMMITTER_NAME=\"$CORRECT_NAME\"</span></span><br><span class=\"line\"><span class=\"string\">    export GIT_COMMITTER_EMAIL=\"$CORRECT_EMAIL\"</span></span><br><span class=\"line\"><span class=\"string\">fi</span></span><br><span class=\"line\"><span class=\"string\">if [ \"$GIT_AUTHOR_EMAIL\" = \"$OLD_EMAIL\" ]</span></span><br><span class=\"line\"><span class=\"string\">then</span></span><br><span class=\"line\"><span class=\"string\">    export GIT_AUTHOR_NAME=\"$CORRECT_NAME\"</span></span><br><span class=\"line\"><span class=\"string\">    export GIT_AUTHOR_EMAIL=\"$CORRECT_EMAIL\"</span></span><br><span class=\"line\"><span class=\"string\">fi</span></span><br><span class=\"line\"><span class=\"string\">'</span> --tag-name-filter cat -- --branches --tags</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>特殊情况-如果上面的批量修改命令执行失败的话，执行一下这段命令：</li>\n</ul>\n<p><code>bashgit filter-branch -f --index-filter &#39;git rm --cached --ignore-unmatch Rakefile&#39; HEAD</code></p>\n<h3 id=\"git清理分支提交记录\"><a href=\"#git清理分支提交记录\" class=\"headerlink\" title=\"git清理分支提交记录\"></a>git清理分支提交记录</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">1.Checkout </span><br><span class=\"line\">   git checkout --orphan latest_branch</span><br><span class=\"line\">2. Add all the files</span><br><span class=\"line\">   git add -A</span><br><span class=\"line\">3. Commit the changes</span><br><span class=\"line\">   git commit -am \"commit message\"</span><br><span class=\"line\">4. Delete the branch</span><br><span class=\"line\">   git branch -D master</span><br><span class=\"line\">5.Rename the current branch to master</span><br><span class=\"line\">   git branch -m master</span><br><span class=\"line\">6.Finally, force update your repository</span><br><span class=\"line\">   git push -f origin master</span><br></pre></td></tr></table></figure>\n\n","categories":["查缺补漏"],"tags":["Git"]},{"title":"查缺补漏-Dubbo","url":"/posts/2124610325/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h3 id=\"Dubbo概述\"><a href=\"#Dubbo概述\" class=\"headerlink\" title=\"Dubbo概述\"></a>Dubbo概述</h3><ul>\n<li>服务治理（SOA）治理框架</li>\n<li>Duboo是一个分布式服务框架<ul>\n<li>远程通讯：提供多种基于长链接的NIO框架抽象封装,包括多种线程模型、序列化“请求-响应”的信息交换方案。</li>\n<li>集群容错：提供基于接口方法的透明远程调用过程，包括多协议支持、软负载均衡、失败容错、地址路由、动态配置等集群支持。</li>\n<li>自动发现：基于注册中心目录服务，使服务消费方能动态地查找提供方，使地址透明，使服务提供方可以平滑增或减少机器。</li>\n<li>介绍：</li>\n<li>致力于提供高性能和透明化的RPC远程服务调用方案，以及SOA服务治理方案。</li>\n<li>Dubbo的命名：澳大利亚达博市</li>\n<li>同类型框架：<ul>\n<li>Apache Thrift、Hessian、RMI、WebService（原生）、HSF（淘宝，不开源）、JSF（京东，不开源）。</li>\n</ul>\n</li>\n<li>Dubbo涉及的基础知识<ul>\n<li>远程调用方面：RMI、Hassion、WebService、Thrift进行底层调用。</li>\n<li>通讯交互：HTTP、Mian、netty。</li>\n<li>序列化：Hession2、Java、Json。</li>\n<li>容器：Jetty、Spring。</li>\n<li>负载均衡：zookeeper、Redis。（大部分都是zookeeper）</li>\n</ul>\n</li>\n<li>简单的使用场景<ul>\n<li>作为对内提供服务应用的容器。</li>\n<li>拆分负载Web应用到服务容器。</li>\n<li>应用负载均和协调。</li>\n<li>引用服务处理。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"架构节点（抽象概念）\"><a href=\"#架构节点（抽象概念）\" class=\"headerlink\" title=\"架构节点（抽象概念）\"></a>架构节点（抽象概念）</h3><ul>\n<li>Provider:暴露服务的服务提供方。</li>\n<li>Consumer：调用远程服务的服务消费方。</li>\n<li>Registry：服务注册于发现服务</li>\n<li>Monitor:统计服务的调用次调用时间监控中心</li>\n<li>Container:服务运行容器<ul>\n<li>节点调用关系</li>\n<li>服务提供-服务提供者在启动的时候,向注册中心提供自己提供的服务。</li>\n<li>服务消费-服务消费者在启动的时候,向注册中心订阅自己所需要的服务。<ul>\n<li>注册中心异步返回服务提供者地址列表给消费者,如果有变动,注册中心将给予长连接推送变更数据给消费者。</li>\n</ul>\n</li>\n<li>服务统计-服务者和消费者,在内存中累计调用次数和调用时间,定时每分钟发送一次统计数据到监控中心。<ul>\n<li>异步方式</li>\n</ul>\n</li>\n<li>服务调用关系<ul>\n<li>服务消费者,从提供者地址列表中,基于[软负载均衡算法],选一台提供者进行调用,如果调用失败,在选另一台调用。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Dubbo源码相关\"><a href=\"#Dubbo源码相关\" class=\"headerlink\" title=\"Dubbo源码相关\"></a>Dubbo源码相关</h3><ul>\n<li>源码地址<code>git clone https://github.com/alibaba/dubbo</code></li>\n<li>初次编码不执行Test <code>mvn clean install -Dmaven.test.skip=true</code></li>\n<li>JS错误不修改,请自行忽视。</li>\n<li>修复mavan的警告<br>* 地址：<code>dubbo-parent pom.xml</code><br>* maven-jar-plugin version:2.4<br>* maven-surefire-plugin Version 2.19.1<br>* maven-deploy-plugin Version 3.3.9</li>\n<li>项目导入后修复Dubbo XML校验错误提示</li>\n<li>需要导入dubbo.xsd文件</li>\n<li>下载dubbo-2.5.3.jar 版本尽量保持源码同步,解压dt后导入eclipse中。<ul>\n<li>Preferences-XML-XML Catalog 添加一个自定义的：<ul>\n<li>Location: D:\\xsd\\dubbo.xsd</li>\n<li>Key: <a href=\"http://code.alibabatech.com/schema/dubbo/dubbo.xsd\" target=\"_blank\" rel=\"noopener\">http://code.alibabatech.com/schema/dubbo/dubbo.xsd</a> （默认生成的不行自行修改）。</li>\n<li>在校验错误的XML头部添加：</li>\n<li><?xml version=\"1.0\" encoding=\"UTF-8\"?> <!DOCTYPE dubbo SYSTEM\"http://code.alibabatech.com/schema/dubbo\"></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>关于maven-dependency-plugin错误 可能是IDE错误提示，空白处添加空格保存自动消失。<ul>\n<li>错误信息如下：Artifact has not been packaged yet. When used on reactor artifact, unpack should be executed after packaging: see MDEP-98. (org.apache.maven.plugins:maven-dependency-plugin:2.8:unpack:unpack:package)<ul>\n<li>修复方案更改插件配置:</li>\n<li><groupId>org.apache.maven.plugins</groupId><br><artifactId>maven-dependency-plugin</artifactId><br><version>2.10&lt;/version<executions>\n<execution>\n<id>unpack</id>\n<phase>packaged</phase>\n<goals>\n<goal>unpack</goal>\n</goals>\n</execution>\n</executions>\n</plugin></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Dubbo源码模块<ul>\n<li>Config配置层(Dubbo-config)</li>\n<li>Proxy服务代理层(Dubbo-rpc)</li>\n<li>Registry注册中心层(Dubbo-registry)</li>\n<li>Cluster路由层(Dubbo-cluster)</li>\n<li>Monitor监控层(Dubbo-monitor)</li>\n<li>Protocol远程调用层(Dubbo-rpc)</li>\n<li>Exchange信息交换层(Dubbo-remoting)</li>\n<li>Transport网络传输层(Dubbo-remoting)</li>\n<li>Serialize数据序列化层(Dubbo-common)</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Zookeeper\"><a href=\"#Zookeeper\" class=\"headerlink\" title=\"Zookeeper\"></a>Zookeeper</h3><blockquote>\n<p>（测试方案采用zookeeper做均衡负载，简单介绍下配置信息）</p>\n</blockquote>\n<ul>\n<li>下载地址 <a href=\"http://apache.fayea.com/zookeeper/zookeeper-3.4.8/zookeeper-3.4.8.tar.gz\" target=\"_blank\" rel=\"noopener\">http://apache.fayea.com/zookeeper/zookeeper-3.4.8/zookeeper-3.4.8.tar.gz</a></li>\n<li>基本配置：<ul>\n<li>单机模式：修改zookeeper-3.4.8/conf zoo.cfg(原始文件名zoo_sanple.cfg复制一份重命名)<ul>\n<li>编辑内容（仅供参考,具体环境自行修改）</li>\n<li>tickTime = 2000<ul>\n<li>tickTime：基本事件单元，以毫秒为单位。这个时间是作为 Zookeeper 服务器之间或客户端与服务器之间维持心跳的时间间隔，也就是每个 tickTime 时间就会发送一个心跳。</li>\n</ul>\n</li>\n<li>initLimit= 5<ul>\n<li>initLimit:这个配置项用来配置Zookeeper接受客户端初始化连接时最长能忍受多少个心跳时间间隔数，当已超过5个心跳的时间（也就是tickTime）长度后Zookeeper服务器还没有收到客户端的返回信息，那么表明这个客户端连接失败。总的时间长度是5 * 2000=4s。</li>\n</ul>\n</li>\n<li>dataDir = D:\\zookeeper\\data<ul>\n<li>顾名思义就是 Zookeeper 保存数据快照的目录，默认情况下，Zookeeper 将写数据的日志文件也保存在这个目录里）。</li>\n</ul>\n</li>\n<li>dataLogDir= D:\\zookeeper\\log<ul>\n<li>顾名思义就是 Zookeeper 保存日志的目录。</li>\n</ul>\n</li>\n<li>synclimit = 5<ul>\n<li>这个配置项表示Leader与Follower之间发送消息，请求和应答时间长长度，最长不能超过多少个tickTime的时间长度,总的时间长度是2 * 2000 = 4s。</li>\n</ul>\n</li>\n<li>clientPort = 2181<ul>\n<li>这个端口就是客户端连接 Zookeeper 服务器的端口，Zookeeper 会监听这个端口，接受客户端的访问请求。</li>\n</ul>\n</li>\n<li>Server（待续）<ul>\n<li>格式：server.id=host:port:port（两个port保证可以正常使用就行）<ul>\n<li>id：通常为整数，建议使用整数。</li>\n<li>host：服务器的IP地址。</li>\n<li>port: Follower端口</li>\n<li>port: Leader选举投票。</li>\n</ul>\n</li>\n<li>ZooKeeper建议使用hostname，而非ip。这需要对主机的/etc/hostname和/etc/hosts做host绑定(不用的OS不同修改方式)。</li>\n</ul>\n</li>\n<li>创建一个myid文件（放在 dataDir文件下面）<ul>\n<li>写入一行数据（请查阅zoo.cfg文件）<ul>\n<li>写入当前Zookeeper id位置的数据即可。表示当前系统环境Zookeeper是哪一个Server（通讯用的）。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Dubbo程序运行\"><a href=\"#Dubbo程序运行\" class=\"headerlink\" title=\"Dubbo程序运行\"></a>Dubbo程序运行</h3><ul>\n<li>测试运行,默认配置即可。注意与zookeeper一台机器。</li>\n<li>运行Dubbo-admin本机tomcat启动启动成功后127.0.0.1:8080/dubbo-admin（注意默认请设置跟目录,否则部分功能不发正常显示）<ul>\n<li>默认用户名密码(root/root,guest/guest)</li>\n</ul>\n</li>\n</ul>\n","categories":["查缺补漏"],"tags":["Java","Dubbo"]},{"title":"查缺补漏-Redis","url":"/posts/845363102/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h2 id=\"Redis-简介\"><a href=\"#Redis-简介\" class=\"headerlink\" title=\"Redis 简介\"></a>Redis 简介</h2><blockquote>\n<p>Redis 是完全开源免费的，遵守 BSD 协议，英文全称是<strong>Remote Dictionary Server</strong>（远程字典服务），是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p>\n</blockquote>\n<ul>\n<li>Redis 与 其他 key - value 缓存产品有以下三个特点：<ul>\n<li>Redis 支持数据持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</li>\n<li>Redis 不仅仅支持简单的 key - value 类型的数据，同时还提供 list，set，zset，hash 等数据结构的存储</li>\n<li>Redis 支持数据的备份，即 master - slave 模式的数据备份。</li>\n</ul>\n</li>\n<li>Redis是内存数据库，所有操作都在内存上完成，内存的访问速度本身就很快，读的速度是 110000 次 /s, 写的速度是 81000 次 /s。另一方面是因为它的数据结构。键值对是按一定的数据结构来组织的，操作键值对最终就是对数据结构进行增删改查操作，所以高效的数据结构是 Redis 快速处理数据的基础。</li>\n<li>Redis使用基于哈西槽(slot)的数据划分方式。</li>\n</ul>\n<h3 id=\"Redis数据类型与数据结构\"><a href=\"#Redis数据类型与数据结构\" class=\"headerlink\" title=\"Redis数据类型与数据结构\"></a>Redis数据类型与数据结构</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211013163550.png\"></p>\n<h4 id=\"数据结构时间复杂度\"><a href=\"#数据结构时间复杂度\" class=\"headerlink\" title=\"数据结构时间复杂度\"></a>数据结构时间复杂度</h4><table>\n<thead>\n<tr>\n<th>名称</th>\n<th>时间复杂度</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>哈希表</td>\n<td>O(1)</td>\n</tr>\n<tr>\n<td>跳表</td>\n<td>O(logN)</td>\n</tr>\n<tr>\n<td>双向链表</td>\n<td>O(N)</td>\n</tr>\n<tr>\n<td>压缩列表</td>\n<td>O(N)</td>\n</tr>\n<tr>\n<td>整数数组</td>\n<td>O(N)</td>\n</tr>\n</tbody></table>\n<h3 id=\"Redis事务\"><a href=\"#Redis事务\" class=\"headerlink\" title=\"Redis事务\"></a>Redis事务</h3><blockquote>\n<p>严格上来说redis是伪事物，</p>\n</blockquote>\n<ul>\n<li>Redis事务功能是通过MULTI、EXEC、DISCARD和WATCH 四个原语实现的。Redis会将一个事务中的所有命令序列化，然后按顺序执行。<ol>\n<li>redis 不支持回滚“Redis 在事务失败时不进行回滚，而是继续执行余下的命令”， 所以 Redis 的内部可以保持简单且快速。</li>\n<li>如果在一个事务中的命令出现错误，那么所有的命令都不会执行；</li>\n<li>如果在一个事务中出现运行错误，那么正确的命令会被执行。</li>\n</ol>\n</li>\n<li>MULTI命令用于开启一个事务，它总是返回OK。 MULTI执行之后，客户端可以继续向服务器发送任意多条命令，这些命令不会立即被执行，而是被放到一个队列中，当EXEC命令被调用时，所有队列中的命令才会被执行。</li>\n<li>EXEC：执行所有事务块内的命令。返回事务块内所有命令的返回值，按命令执行的先后顺序排列。当操作被打断时，返回空值 nil 。</li>\n<li>通过调用DISCARD，客户端可以清空事务队列，并放弃执行事务， 并且客户端会从事务状态中退出。</li>\n<li>WATCH 命令可以为 Redis 事务提供 check-and-set （CAS）行为。 可以监控一个或多个键，一旦其中有一个键被修改（或删除），之后的事务就不会执行，监控一直持续到EXEC命令。</li>\n</ul>\n<h3 id=\"Redis单线程\"><a href=\"#Redis单线程\" class=\"headerlink\" title=\"Redis单线程\"></a>Redis单线程</h3><ul>\n<li>我们通常说，Redis 是单线程，主要是指 Redis 的网络 IO 和键值对读写是由一个线程来完成的，这也是 Redis 对外提供键值存储服务的主要流程。但 Redis 的其他功能，比如持久化、异步删除、集群数据同步等，其实是由额外的线程执行的。Redis 的单线程设计机制以及多路复用机制</li>\n<li>Linux 中的 IO 多路复用机制<ul>\n<li>Linux 中的 IO 多路复用机制是指一个线程处理多个 IO 流，就是我们经常听到的 select/epoll 机制。简单来说，在 Redis 只运行单线程的情况下，该机制允许内核中，同时存在多个监听套接字和已连接套接字。内核会一直监听这些套接字上的连接请求或数据请求。一旦有请求到达，就会交给 Redis 线程处理，这就实现了一个 Redis 线程处理多个 IO 流的效果。</li>\n</ul>\n</li>\n<li><strong>Redis 的网络 IO 和键值对读写是由一个线程来完成的，这也是 Redis 对外提供键值存储服务的主要流程</strong></li>\n</ul>\n<h4 id=\"Redis单线程处理IO请求性能瓶颈\"><a href=\"#Redis单线程处理IO请求性能瓶颈\" class=\"headerlink\" title=\"Redis单线程处理IO请求性能瓶颈\"></a>Redis单线程处理IO请求性能瓶颈</h4><ul>\n<li>任意一个请求在server中一旦发生耗时，都会影响整个server的性能，也就是说后面的请求都要等前面这个耗时请求处理完成，自己才能被处理到。耗时的操作包括以下几种：<ul>\n<li>操作bigkey：写入一个bigkey在分配内存时需要消耗更多的时间，同样，删除bigkey释放内存同样会产生耗时；</li>\n<li>使用复杂度过高的命令：例如SORT/SUNION/ZUNIONSTORE，或者O(N)命令，但是N很大，例如lrange key 0 -1一次查询全量数据；</li>\n<li>大量key集中过期：Redis的过期机制也是在主线程中执行的，大量key集中过期会导致处理一个请求时，耗时都在删除过期key，耗时变长；</li>\n<li>淘汰策略：淘汰策略也是在主线程执行的，当内存超过Redis内存上限后，每次写入都需要淘汰一些key，也会造成耗时变长；</li>\n<li>AOF刷盘开启always机制：每次写入都需要把这个操作刷到磁盘，写磁盘的速度远比写内存慢，会拖慢Redis的性能；</li>\n<li>主从全量同步生成RDB：虽然采用fork子进程生成数据快照，但fork这一瞬间也是会阻塞整个线程的，实例越大，阻塞时间越久；</li>\n</ul>\n</li>\n<li>并发量非常大时，单线程读写客户端IO数据存在性能瓶颈，虽然采用IO多路复用机制，但是读写客户端数据依旧是同步IO，只能单线程依次读取客户端的数据，无法利用到CPU多核。</li>\n<li>Redis在4.0推出了lazy-free机制，把bigkey释放内存的耗时操作放在了异步线程中执行，降低对主线程的影响。</li>\n<li>Redis在6.0推出了多线程，可以在高并发场景下利用CPU多核多线程读写客户端数据，进一步提升server性能，当然，只是针对客户端的读写是并行的，每个命令的真正操作依旧是单线程的。</li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"Redis网络框架\"><a href=\"#Redis网络框架\" class=\"headerlink\" title=\"Redis网络框架\"></a>Redis网络框架</h3><blockquote>\n<p>一般服务器都是采用Linxu系统，在Linxu上Redis采用<code>epoll</code>模型进行网络通信</p>\n</blockquote>\n<h4 id=\"Redis线程模型\"><a href=\"#Redis线程模型\" class=\"headerlink\" title=\"Redis线程模型\"></a>Redis线程模型</h4><ul>\n<li>redis 内部使⽤⽂件事件处理器<code>file event handler</code>，这个⽂件事件处理器是单线程的，所以redis 才叫做单线程的模型。它采⽤ IO 多路复⽤机制同时监听多个 socket，根据 socket 上的事件来选择对应的事件处理器进⾏处理。</li>\n</ul>\n<h4 id=\"Socket通信过程\"><a href=\"#Socket通信过程\" class=\"headerlink\" title=\"Socket通信过程\"></a>Socket通信过程</h4><blockquote>\n<p>Redis采用Socket通信传输数据。Socket是在应用层和传输层之间的一个抽象层，它把TCP/IP层复杂的操作抽象为几个简单的接口，供应用层调用实现进程在网络中的通信。Socket起源于UNIX，在Unix一切皆文件的思想下，进程间通信就被冠名为文件描述符（file desciptor），Socket是一种“打开—读/写—关闭”模式的实现，服务器和客户端各自维护一个“文件”，在建立连接打开后，可以向文件写入内容供对方读取或者读取对方内容，通讯结束时关闭文件。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220102175658.png\" alt=\"img\"></p>\n<ul>\n<li>Socket保证了不同计算机之间的通信，也就是网络通信。通信模型是服务器与客户端之间的通信。两端都建立了一个Socket对象，然后通过Socket对象对数据进行传输。通常服务器处于一个无限循环，等待客户端的连接。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220102175838.png\" alt=\"img\"></p>\n<ul>\n<li>服务端先初始化Socket，建立流式套接字，与本机地址及端口进行绑定，然后通知TCP，准备好接收连接，调用accept()阻塞，等待来自客户端的连接。如果这时客户端与服务器建立了连接，客户端发送数据请求，服务器接收请求并处理请求，然后把响应数据发送给客户端，客户端读取数据，直到数据交换完毕。最后关闭连接，交互结束。</li>\n<li>TCP三次握手的Socket过程</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220102175926.png\" alt=\"img\"></p>\n<ul>\n<li>服务器调用socket()、bind()、listen()完成初始化后，调用accept()阻塞等待；</li>\n<li>客户端Socket对象调用connect()向服务器发送了一个SYN并阻塞；</li>\n<li>服务器完成了第一次握手，即发送SYN和ACK应答；</li>\n<li>客户端收到服务端发送的应答之后，从connect()返回，再发送一个ACK给服务器；</li>\n<li>服务器Socket对象接收客户端第三次握手ACK确认，此时服务端从accept()返回，建立连接。</li>\n</ul>\n<h4 id=\"Redis网络IO处理过程\"><a href=\"#Redis网络IO处理过程\" class=\"headerlink\" title=\"Redis网络IO处理过程\"></a>Redis网络IO处理过程</h4><blockquote>\n<p>Redis的网络模式是单reactor模式。non-blocking io + ( epoll 、select 、Kequeue</p>\n</blockquote>\n<ul>\n<li>Redis基于Reactor模式开发了自己的文件事件派发器，文件事件处理器使用I/O多路复用技术，同时监听多个套接字，并为套接字关联不同事件处理函数。当套接字的可读或者可写事件触发时，就会调用相应的事件处理函数。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220102180441.png\" alt=\"img\"></p>\n<ul>\n<li>在同步网络IO操作中，有潜在的阻塞点，分别是accept()、recv()。当Redis监听到一个客户端有连接请求，但未成功建立时，会柱塞在accept()函数里面，导致其他客户端无法和Redis建立连接，同理当Redis通过recv()从一个客户端读取数据但时候，如果数据一直没有达到。Redis也会一直柱塞在recv()。</li>\n<li>Redis非柱塞模式。在非柱塞模式中主要提现在三个函数方法上。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220102181626.png\" alt=\"img\"></p>\n<ul>\n<li>设置acceot()非柱塞，当Redis调用函数的时候，如果没有连接Redis并不会柱塞，这样就可以处理其它操作，同理在recv()和send()函数调用时候，也可以非柱塞处理。这样保证了Redis线程不会和同步的IO一样一直柱塞等待，也不会导致Redis无法处理实际达到的请求。</li>\n</ul>\n<h4 id=\"基于多路复用IO模型\"><a href=\"#基于多路复用IO模型\" class=\"headerlink\" title=\"基于多路复用IO模型\"></a>基于多路复用IO模型</h4><blockquote>\n<p>Linxu中IO多路复用机制是指一个线程处理多个IO流，<strong>也就是select、epool机制。在Redis运行单线程的情况下，该机制允许内核中，同时存在多个监听套接字和已连接套接字。</strong>内核会一直监听这些套接字上的连接请求或数据请求。一旦有请求到达，就会交给 Redis 线程处理，这就实现了一个 Redis 线程处理多个 IO 流的效果。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220102183137.png\" alt=\"img\"></p>\n<ul>\n<li>在RedisIO模型中，Redis的网络框架调用epool机制，让内核监听这些套接字。这样Redis不会柱塞在某一个特定的或已连接的套接字上，这样Redis就可以同时和多个客户端连接并处理请求，从而提高并发性。、</li>\n<li>select、epoll提供基础事件的回调机制，针对不同的事件发送，并用相应的处理函数。比如Accept 事件和 Read 事件，Redis 分别对这两个事件注册 accept 和 get 回调函数。当 Linux 内核监听到有连接请求或读数据请求时，就会触发 Accept 事件和 Read 事件，此时，内核就会回调 Redis 相应的 accept 和 get 函数进行处理。</li>\n</ul>\n<h3 id=\"Redis持久化机制\"><a href=\"#Redis持久化机制\" class=\"headerlink\" title=\"Redis持久化机制\"></a>Redis持久化机制</h3><blockquote>\n<p>Redis是一个支持持久化的内存数据库，通过持久化机制把内存中的数据同步到硬盘文件来保证数据持久化。当Redis重启后通过把硬盘文件重新加载到内存，就能达到恢复数据的目的。</p>\n</blockquote>\n<ul>\n<li><p>Redis 4.0 之前数据持久化方式有两种：AOF 方式和 RDB 方式。</p>\n<ul>\n<li>RDB（Redis DataBase，快照方式）是将某一个时刻的内存数据，以二进制的方式写入磁盘。RDB 默认的保存文件为 dump.rdb，优点是以二进制存储的，因此占用的空间更小、数据存储更紧凑，并且与 AOF 相比，RDB 具备更快的重启恢复能力。</li>\n<li>AOF（Append Only File，文件追加方式）是指将所有的操作命令，以文本的形式追加到文件中。AOF 默认的保存文件为 appendonly.aof，它的优点是存储频率更高，因此丢失数据的风险就越低，并且 AOF 并不是以二进制存储的，所以它的存储信息更易懂。缺点是占用空间大，重启之后的数据恢复速度比较慢。</li>\n</ul>\n</li>\n<li><p><strong>混合模式</strong>，Redis4.0之后增加的方式，混合模式集合了RDB和AOF的优点，在写入的时候先把当前数据以RDB的形式写入文件的开头，然后以AOF的格式存入文件，这样既能保证Redis重启时候的速度，又能减少数据丢失的风险。</p>\n</li>\n</ul>\n<h4 id=\"AOF（Append-Only-File）\"><a href=\"#AOF（Append-Only-File）\" class=\"headerlink\" title=\"AOF（Append Only File）\"></a>AOF（Append Only File）</h4><blockquote>\n<p>Redis会将每一个收到的写命令都通过Write函数追加到文件最后，类似于MySQL的binlog。当Redis重启是会通过重新执行文件中保存的写命令来在内存中重建整个数据库的内容。当两种方式同时开启时，数据恢复Redis会优先选择AOF恢复。AOF持久化机制是以日志的形式记录Redis中的每一次的增删改操作，不会记录查询操作，以文本的形式记录，打开记录的日志文件就可以查看操作记录。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220103134806.png\"></p>\n<ul>\n<li><h5 id=\"AOF更好保证数据不会被丢失，最多只丢失一秒内的数据，通过fock一个子进程处理持久化操作，保证了主进程不会进程io操作，能高效的处理客户端的请求。\"><a href=\"#AOF更好保证数据不会被丢失，最多只丢失一秒内的数据，通过fock一个子进程处理持久化操作，保证了主进程不会进程io操作，能高效的处理客户端的请求。\" class=\"headerlink\" title=\"AOF更好保证数据不会被丢失，最多只丢失一秒内的数据，通过fock一个子进程处理持久化操作，保证了主进程不会进程io操作，能高效的处理客户端的请求。\"></a>AOF更好保证数据不会被丢失，最多只丢失一秒内的数据，通过fock一个子进程处理持久化操作，保证了主进程不会进程io操作，能高效的处理客户端的请求。</h5></li>\n<li><p>AOF的日志文件的记录可读性非常的高，即使某一时刻有人执行<code>flushall</code>清空了所有数据，只需要拿到aof的日志文件，然后把最后一条的flushall给删除掉，就可以恢复数据。</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">redis&gt; RPUSH list 1 2 3 4</span><br><span class=\"line\">(<span class=\"built_in\">integer</span>) 4</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>AOF实际保存结果</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">*6 <span class=\"comment\">#表示当前命令有6个部分，每个部分由$开头</span></span><br><span class=\"line\"><span class=\"variable\">$5</span> </span><br><span class=\"line\">RPUSH</span><br><span class=\"line\"><span class=\"variable\">$4</span></span><br><span class=\"line\">list</span><br><span class=\"line\"><span class=\"variable\">$1</span></span><br><span class=\"line\">1</span><br><span class=\"line\"><span class=\"variable\">$1</span></span><br><span class=\"line\">2</span><br><span class=\"line\"><span class=\"variable\">$1</span></span><br><span class=\"line\">3</span><br><span class=\"line\"><span class=\"variable\">$1</span></span><br><span class=\"line\">4</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>与Mysql写前日志不同WAL(Write Ahead Log)，Redis采用写后日志，先执行命令，把数据写入内存中。然后在记录日志。这样可以避免记录错误命令、也不回柱塞当前的写操作。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220103130121.png\"></p>\n<h5 id=\"持久化触发机制\"><a href=\"#持久化触发机制\" class=\"headerlink\" title=\"持久化触发机制\"></a>持久化触发机制</h5><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220103130945.png\"></p>\n<h6 id=\"AOF-自动触发策略\"><a href=\"#AOF-自动触发策略\" class=\"headerlink\" title=\"AOF 自动触发策略\"></a>AOF 自动触发策略</h6><ul>\n<li>Always，同步写回：每个写命令执行完，立马同步地将日志写回磁盘；<ul>\n<li>同步写回可以做到基本不丢数据，但是它在每一个写命令后都有一个慢速的落盘操作，不可避免地会影响主线程性能。</li>\n</ul>\n</li>\n<li>Everysec，每秒写回：每个写命令执行完，只是先把日志写到 AOF 文件的内存缓冲区，每隔一秒把缓冲区中的内容写入磁盘；<ul>\n<li>每秒写回采用一秒写回一次的频率，避免了“同步写回”的性能开销，虽然减少了对系统性能的影响，但是如果发生宕机，上一秒内未落盘的命令操作仍然会丢失。所以，这只能算是，在避免影响主线程性能和避免数据丢失两者间取了个折中。</li>\n</ul>\n</li>\n<li>No，操作系统控制的写回：每个写命令执行完，只是先把日志写到 AOF 文件的内存缓冲区，由操作系统决定何时将缓冲区内容写回磁盘。<ul>\n<li>操作系统控制的写回在写完缓冲区后，就可以继续执行后续的命令，但是落盘的时机已经不在 Redis 手中了，只要 AOF 记录没有写回磁盘，一旦宕机对应的数据就丢失了。</li>\n</ul>\n</li>\n</ul>\n<h6 id=\"AOF手动触发\"><a href=\"#AOF手动触发\" class=\"headerlink\" title=\"AOF手动触发\"></a>AOF手动触发</h6><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">在客户端执行 bgrewriteaof 命令就可以手动触发 AOF 持久化</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"AOF重写触发条件\"><a href=\"#AOF重写触发条件\" class=\"headerlink\" title=\"AOF重写触发条件\"></a>AOF重写触发条件</h6><blockquote>\n<p>只有同时满足 auto-aof-rewrite-min-size 和 auto-aof-rewrite-percentage 设置的条件，才会触发 AOF 文件重写。</p>\n</blockquote>\n<ul>\n<li>auto-aof-rewrite-min-size：允许 AOF 重写的最小文件容量，默认是 64mb 。</li>\n<li>auto-aof-rewrite-percentage：AOF 文件重写的大小比例，默认值是 100，表示 100%，也就是只有当前 AOF 文件，比最后一次（上次）的 AOF 文件大一倍时，才会启动 AOF 文件重写。</li>\n<li>使用 <code>bgrewriteaof</code> 命令，可以自动触发 AOF 文件重写。</li>\n</ul>\n<h5 id=\"AOF-重写机制\"><a href=\"#AOF-重写机制\" class=\"headerlink\" title=\"AOF 重写机制\"></a>AOF 重写机制</h5><blockquote>\n<p>在写入所有的操作到日志文件中时，就会出现日志文件很多重复的操作，<strong>比如一个计数器操作了99次，如果不重写就会有99条记录。</strong>导致日志文件越来越大。就浪费了资源空间，所以在Redis中出现了<code>rewrite</code>机制。redis提供了bgrewriteaof命令。将内存中的数据以命令的方式保存到临时文件中，同时会fork出一条新进程来将文件重写。</p>\n</blockquote>\n<ul>\n<li>重写AOF的日志文件不是读取旧的日志文件瘦身，而是将内存中的数据用命令的方式重写一个AOF文件，重新保存替换原来旧的日志文件，因此内存中的数据才是最新的。</li>\n<li>重写操作也会<code>fork</code>一个子进程来处理重写操作，重写以内存中的数据作为重写的源，避免了操作的冗余性，保证了数据的最新。</li>\n</ul>\n<h5 id=\"AOF重写流程\"><a href=\"#AOF重写流程\" class=\"headerlink\" title=\"AOF重写流程\"></a>AOF重写流程</h5><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220103135639.png\"></p>\n<ul>\n<li><strong>和 AOF 日志由主线程写回不同，重写过程是由后台子进程 bgrewriteaof 来完成的，这也是为了避免阻塞主线程，导致数据库性能下降。</strong><ol>\n<li>处理命令请求。</li>\n<li>将写入命令追加到现有的AOF文件中。</li>\n<li>将写入命令追加到AOF重写缓存中。</li>\n<li>当子进程完成AOF重写之后，它会向父进程发送一个完成信号，父进程接到完成信号后，会将AOF重写缓存中的内容全部写入到AOF文件中。并对新的AOF文件进行改名，覆盖原有的AOF文件。</li>\n</ol>\n</li>\n<li>AOF文件重写是生成一个全新的文件，并把当前数据最少的操作命令保存到新文件上。当把所有的数据都保存至新文件后，Redis会交换两个文件，并把最新的持久化操作命令追加到新文件上。<ul>\n<li>子进程进行AOF重写期间，主进程可以继续处理命令请求。</li>\n<li>子进程带有主进程的数据副本，使用子进程而不是线程。可以避免锁的情况下，保证数据的安全性。</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220103141348.png\"></p>\n<h5 id=\"AOF配置\"><a href=\"#AOF配置\" class=\"headerlink\" title=\"AOF配置\"></a>AOF配置</h5><blockquote>\n<p>redis.conf文件</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 是否开启 AOF，yes 为开启，默认是关闭</span></span><br><span class=\"line\">appendonly no</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># AOF 默认文件名</span></span><br><span class=\"line\">appendfilename <span class=\"string\">\"appendonly.aof\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># AOF 持久化策略配置</span></span><br><span class=\"line\"><span class=\"comment\"># appendfsync always</span></span><br><span class=\"line\">appendfsync everysec</span><br><span class=\"line\"><span class=\"comment\"># appendfsync no</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># AOF 文件重写的大小比例，默认值是 100，表示 100%，也就是只有当前 AOF 文件，比最后一次的 AOF 文件大一倍时，才会启动 AOF 文件重写。</span></span><br><span class=\"line\">auto-aof-rewrite-percentage 100</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 允许 AOF 重写的最小文件容量</span></span><br><span class=\"line\">auto-aof-rewrite-min-size 64mb</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 是否开启启动时加载 AOF 文件效验，默认值是 yes，表示尽可能的加载 AOF 文件，忽略错误部分信息，并启动 Redis 服务。</span></span><br><span class=\"line\"><span class=\"comment\"># 如果值为 no，则表示，停止启动 Redis，用户必须手动修复 AOF 文件才能正常启动 Redis 服务。</span></span><br><span class=\"line\">aof-load-truncated yes</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"AOF小结\"><a href=\"#AOF小结\" class=\"headerlink\" title=\"AOF小结\"></a>AOF小结</h4><ul>\n<li><p>AOF文件通过保存所修改数据的命令来记录数据库的状态。</p>\n</li>\n<li><p>AOF文件中保存所有的命令都以Redis通讯协议格式来保存。</p>\n</li>\n<li><p>如果刚执行完一个命令，还没有来得及记日志就宕机了，那么这个命令和相应的数据就有丢失的风险。如果此时 Redis 是用作缓存，还可以从后端数据库重新读入数据进行恢复，但是，如果 Redis 是直接用作数据库的话，此时，因为命令没有记入日志，所以就无法用日志进行恢复了。</p>\n</li>\n<li><p>AOF 虽然避免了对当前命令的阻塞，但可能会给下一个操作带来阻塞风险。这是因为，AOF 日志也是在主线程中执行的，如果在把日志文件写入磁盘时，磁盘写压力大，就会导致写盘很慢，进而导致后续的操作也无法执行了。</p>\n</li>\n<li><p>Redis三种写回策略提现了一种设计原则<code>trade-off</code>取舍，在性能和可靠性保证之前做取舍。</p>\n</li>\n<li><p>由于Redis重度使用fock，Huge page在实际使用Redis时是建议关掉的。</p>\n<ul>\n<li>Huge page对提升TLB命中率比较友好，因为在相同的内存容量下，使用huge page可以减少页表项，TLB就可以缓存更多的页表项，能减少TLB miss的开销。</li>\n<li>fork出的子进程指向与父进程相同的内存地址空间，此时子进程就可以执行AOF重写，把内存中的所有数据写入到AOF文件中。但是此时父进程依旧是会有流量写入的，如果父进程操作的是一个已经存在的key，那么这个时候父进程就会真正拷贝这个key对应的内存数据，申请新的内存空间，内存分配是以页为单位进行分配的，默认4k，如果父进程此时操作的是一个bigkey，重新申请大块内存耗时会变长，可能会产阻塞风险。另外，如果操作系统开启了内存大页机制(Huge Page，页面大小2M)，那么父进程申请内存时阻塞的概率将会大大提高，所以在Redis机器上需要关闭Huge Page机制。Redis每次fork生成RDB或AOF重写完成后，都可以在Redis log中看到父进程重新申请了多大的内存空间。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"RDB（Snapshot）\"><a href=\"#RDB（Snapshot）\" class=\"headerlink\" title=\"RDB（Snapshot）\"></a>RDB（Snapshot）</h4><blockquote>\n<p>RDB持久化就是将当前进程的数据以生成快照的形式持久化到磁盘中。对于快照的理解，我们可以理解为将当前线程的数据以拍照的形式保存下来。</p>\n</blockquote>\n<ul>\n<li>将RDB做镜像全量持久化，AOF做增量持久化。RDB会耗费较长时间，不够实时，在停机的时候会导致大量丢失数据，所以需要AOF来配合使用。在redis实例重启时，会使用RDB持久化文件重新构建内存，再使用AOF重放近期的操作指令来实现完整恢复重启之前的状态。</li>\n<li>RDB是Redis默认的持久化方式。按照一定的时间周期策略把内存的数据以快照的形式保存到硬盘的二进制文件。即Snapshot快照存储，对应产生的数据文件为dump.rdb，通过配置文件中的save参数来定义快照的周期。（ 快照可以是其所表示的数据的一个副本，也可以是数据的一个复制品。）</li>\n<li>RDB持久化后的文件是紧凑的二进制文件，适合于备份、全量复制、大规模数据恢复的场景，对数据完整性和一致性要求不高，RDB会丢失最后一次快照的数据。</li>\n<li>Redis 的数据都在内存中，为了提供所有数据的可靠性保证，它执行的是全量快照，也就是说，把内存中的所有数据都记录到磁盘中。全量数据越多，RDB 文件就越大，往磁盘上写数据的时间开销就越大。</li>\n</ul>\n<h5 id=\"持久化触发机制-1\"><a href=\"#持久化触发机制-1\" class=\"headerlink\" title=\"持久化触发机制\"></a>持久化触发机制</h5><blockquote>\n<p>RDB 的持久化触发方式有两类：一类是手动触发，另一类是自动触发。</p>\n</blockquote>\n<ul>\n<li><p>手动触发 <code>save</code> 和 <code>bgsave</code></p>\n<ul>\n<li><code>save</code>:在主线程中执行，会导致阻塞；尽量避免在生产环境中使用。</li>\n<li><code>bgsave</code> fork()一个子进程，专门用于写入 RDB 文件，避免了主线程的阻塞，这也是 Redis RDB 文件生成的默认配置。整个过程中只有在 fork() 子进程时有短暂的阻塞，当子进程被创建之后，Redis 的主进程就可以响应其他客户端的请求了。</li>\n</ul>\n</li>\n<li><p>条件出发<code>save m n</code> ，该命令表示m秒内n个健发生改变，则自动触发。会执行一次<code>bgsave</code>。</p>\n</li>\n<li><p><code>flushall</code>清空Redis数据库，自动触发持久化并清空RDB文件。</p>\n</li>\n<li><p>主从同步触发，在Redis主从复制中，主节点会执行<code>bgsave</code>命令，并将RDB文件发送给从节点。过程会自动触发Redis持久化</p>\n</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220103132444.png\"> </p>\n<h5 id=\"fork和cow\"><a href=\"#fork和cow\" class=\"headerlink\" title=\"fork和cow\"></a>fork和cow</h5><ul>\n<li>fork和cow。fork是指redis通过创建子进程来进行RDB操作，cow指的是<strong>copy on write</strong>，子进程创建后，父子进程共享数据段，父进程继续提供读写服务，写脏的页面数据会逐渐和子进程分离开来。</li>\n</ul>\n<h5 id=\"RDB配置\"><a href=\"#RDB配置\" class=\"headerlink\" title=\"RDB配置\"></a>RDB配置</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># RDB 保存的条件</span></span><br><span class=\"line\">save 900 1 <span class=\"comment\"># 表示 900 秒内如果至少有 1 个 key 值变化，则把数据持久化到硬盘； </span></span><br><span class=\"line\">save 300 10 <span class=\"comment\"># 表示 300 秒内如果至少有 10 个 key 值变化，则把数据持久化到硬盘；</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># bgsave 失败之后，是否停止持久化数据到磁盘，yes 表示停止持久化，no 表示忽略错误继续写文件。</span></span><br><span class=\"line\">stop-writes-on-bgsave-error yes</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># RDB 文件压缩</span></span><br><span class=\"line\">rdbcompression yes <span class=\"comment\"># 它的默认值是 yes 表示开启 RDB 文件压缩，Redis 会采用 LZF 算法进行压缩。如果不想消耗 CPU 性能来进行文件压缩的话，可以设置为关闭此功能，这样的缺点是需要更多的磁盘空间来保存文件。 </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 写入文件和读取文件时是否开启 RDB 文件检查，检查是否有无损坏，如果在启动是检查发现损坏，则停止启动。</span></span><br><span class=\"line\">rdbchecksum yes</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># RDB 文件名</span></span><br><span class=\"line\">dbfilename dump.rdb</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># RDB 文件目录</span></span><br><span class=\"line\">dir ./</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"RDB小结\"><a href=\"#RDB小结\" class=\"headerlink\" title=\"RDB小结\"></a>RDB小结</h5><ul>\n<li>因为RDB只能保存某个时间间隔的数据，如果Redis突然宕机了，则会丢失最近一段时间的数据。</li>\n<li>RDB需要经常fock()才能使用子进程持久化在磁盘上。如果数据量很大fock()时间可能会很长，期间还会导致CPU不稳定。严重可能导致RedisServer阻塞较长时间。</li>\n</ul>\n<h4 id=\"Redis启动RDB-amp-AOF持久化文件加载机制\"><a href=\"#Redis启动RDB-amp-AOF持久化文件加载机制\" class=\"headerlink\" title=\"Redis启动RDB&amp;AOF持久化文件加载机制\"></a>Redis启动RDB&amp;AOF持久化文件加载机制</h4><blockquote>\n<p>Redis是基于内存的非关系型K-V数据库，它是基于内存的，如果Redis服务器挂了，数据就会丢失。为了避免数据丢失了，Redis提供了<strong>持久化</strong>，即把数据保存到磁盘。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211018123529.png\"></p>\n<h4 id=\"混合持久化\"><a href=\"#混合持久化\" class=\"headerlink\" title=\"混合持久化\"></a>混合持久化</h4><blockquote>\n<p>RDB 和 AOF 持久化各有利弊，RDB 可能会导致一定时间内的数据丢失，而 AOF 由于文件较大则会影响 Redis 的启动速度，为了能同时使用 RDB 和 AOF 各种的优点，Redis 4.0 之后新增了混合持久化的方式。</p>\n</blockquote>\n<ul>\n<li>简单来说，内存快照以一定的频率执行，在两次快照之间，使用 AOF 日志记录这期间的所有命令操作。</li>\n</ul>\n<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211222225144.png\" style=\"zoom:80%;\" />\n\n\n\n<h5 id=\"Redis启动混合持久化文件加载机制\"><a href=\"#Redis启动混合持久化文件加载机制\" class=\"headerlink\" title=\"Redis启动混合持久化文件加载机制\"></a>Redis启动混合持久化文件加载机制</h5><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211222225317.png\" style=\"zoom:80%;\" />\n\n\n\n<h3 id=\"Redis的过期策略以及内存淘汰机制\"><a href=\"#Redis的过期策略以及内存淘汰机制\" class=\"headerlink\" title=\"Redis的过期策略以及内存淘汰机制\"></a>Redis的过期策略以及内存淘汰机制</h3><ul>\n<li><p>redis采用的是定期删除+惰性删除策略。</p>\n<ul>\n<li>定期删除，redis默认每个100ms检查，是否有过期的key,有过期key则删除。需要说明的是，redis不是每个100ms将所有的key检查一次，而是随机抽取进行检查(如果每隔100ms,全部key进行检查，redis岂不是卡死)。因此，如果只采用定期删除策略，会导致很多key到时间没有删除。惰性删除派上用场。也就是说在你获取某个key的时候，redis会检查一下，这个key如果设置了过期时间那么是否过期了？如果过期了此时就会删除。</li>\n</ul>\n</li>\n<li><p>定时删除</p>\n<ul>\n<li>每个设置过期时间的key都需要创建一个定时器，到过期时间就会立即对key进行清除。该策略可以立即清除过期的数据，对内存很友好；但是<strong>会占用大量的CPU资源去处理过期的数据</strong>，从而影响缓存的响应时间和吞吐量。</li>\n</ul>\n</li>\n<li><p>内存淘汰策略</p>\n<ul>\n<li><p>当Redis内存快耗尽时，Redis会启动内存淘汰机制，将部分key清掉以腾出内存。</p>\n</li>\n<li><p>主要有5种处理机制</p>\n<ul>\n<li>LRU 最近最少使用</li>\n<li>LFU 最近使用频率低</li>\n<li>Random 随机淘汰</li>\n<li>TTL 过期时间</li>\n<li>No-Enviction 驱逐（什么都不做直接返回错误）</li>\n</ul>\n</li>\n<li><p><strong>volatile-lru</strong>：从已设置过期时间的数据集（server.db[i].expires）中挑选最近最少使用的数据淘汰。</p>\n</li>\n<li><p><strong>volatile-ttl</strong>：从已设置过期时间的数据集（server.db[i].expires）中挑选将要过期的数据淘汰。</p>\n</li>\n<li><p><strong>volatile-random</strong>：从已设置过期时间的数据集（server.db[i].expires）中任意选择数据淘汰。</p>\n</li>\n<li><p><strong>volatile-lfu</strong>：4.0版本新增，当内存不足以容纳新写入数据时，在过期的key中，使用LFU算法进行删除key。</p>\n</li>\n<li><p><strong>allkeys-lru</strong>：从数据集（server.db[i].dict）中挑选最近最少使用的数据淘汰。</p>\n</li>\n<li><p><strong>allkeys-lfu</strong>：4.0版本新增，当内存不足以容纳新写入数据时，从所有key中使用LFU算法进行淘汰。</p>\n</li>\n<li><p><strong>allkeys-random</strong>：从数据集（server.db[i].dict）中任意选择数据淘汰。</p>\n</li>\n<li><p><strong>no-enviction</strong>（驱逐）：禁止驱逐数据，新写入操作会报错。</p>\n</li>\n<li><p>如果没有设置 expire 的key, 不满足先决条件(prerequisites); 那么 volatile-lru, volatile-random 和volatile-ttl 策略的行为, 和 noeviction(不删除) 基本上一致。</p>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"Redis-的过期策略和内存淘汰机制的区别\"><a href=\"#Redis-的过期策略和内存淘汰机制的区别\" class=\"headerlink\" title=\"Redis 的过期策略和内存淘汰机制的区别\"></a>Redis 的过期策略和内存淘汰机制的区别</h4><ul>\n<li><p>新增 Redis 缓存时可以设置缓存的过期时间，该时间保证了数据在规定的时间内失效。通过这种方式可以完成某些场景的业务开发。对对于已经过期的数据，Redis 将使用两种策略来删除这些过期键，它们分别是惰性删除和定期删除。</p>\n</li>\n<li><p>惰性删除是指 Redis 服务器不主动删除过期的键值，而是当访问键值时，再检查当前的键值是否过期，如果过期则执行删除并返回 null 给客户端；如果没过期则正常返回值信息给客户端。</p>\n</li>\n<li><p>定期删除是指 Redis 服务器每隔一段时间会检查一下数据库，看看是否有过期键可以被清除。默认情况下 Redis 定期检查的频率是每秒扫描 10 次，用于定期清除过期键。当然此值还可以通过配置文件进行设置，在 redis.conf 中修改配置“hz”即可，默认的值为“hz 10”。Redis 服务器为了保证过期删除策略不会导致线程卡死，会给过期扫描增加了最大执行时间为 25ms。</p>\n</li>\n<li><p>当 Redis 的内存超过最大允许的内存之后，Redis 会触发内存淘汰策略，这和过期策略是完全不同的两个概念，经常有人把二者搞混，这两者一个是在正常情况下清除过期键，一个是在非正常情况下为了保证 Redis 顺利运行的保护策略。</p>\n</li>\n</ul>\n<h3 id=\"Redis-实现高可用\"><a href=\"#Redis-实现高可用\" class=\"headerlink\" title=\"Redis 实现高可用\"></a>Redis 实现高可用</h3><ul>\n<li>单节点数据持久化，保证了系统在发生宕机或者重启之后数据不会丢失，增加了系统的可靠性和减少了系统不可用的时间（省去了手动恢复数据的过程）</li>\n<li>主从数据同步（主从复制），可以将数据存储至多台服务器，这样当遇到一台服务器宕机之后，可以很快地切换至另一台服务器以继续提供服务</li>\n<li>Redis 哨兵模式（Sentinel），用于发生故障之后自动切换服务器</li>\n<li>Redis 集群（Cluster），多主多从的 Redis 分布式集群环境，用于提供性能更好的 Redis 服务，并且它自身拥有故障自动切换的能力。</li>\n</ul>\n<h4 id=\"单机版\"><a href=\"#单机版\" class=\"headerlink\" title=\"单机版\"></a>单机版</h4><blockquote>\n<p>单机版的Redis也有很多优点，比如实现实现简单、维护简单、部署简单、维护成本非常低，不需要其它额外的开支。但是，因为是单机版的Redis所以也存在很多的问题，比如最明显的单点故障问题，一个Redis挂了，所有的请求就会直接打在了DB上。并且一个Redis抗并发数量也是有限的，同时要兼顾读写两种请求，只要访问量一上来，Redis就受不了了，另一方面单机版的Redis数据量存储也是有限的，数据量一大，再重启Redis的时候，就会非常的慢，所以局限性也是比较大的。</p>\n</blockquote>\n<h4 id=\"主从版本\"><a href=\"#主从版本\" class=\"headerlink\" title=\"主从版本\"></a>主从版本</h4><blockquote>\n<p>主从的原理还算是比较简单的，一主多从，<strong>主数据库（master）可以读也可以写（read/write），从数据库仅读（only read）</strong>。主从模式一般实现<strong>读写分离</strong>，<strong>主数据库仅写（only write）</strong>，减轻主数据库的压力。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211007011326.png\"></p>\n<ul>\n<li>但是数据的一致性问题，假如主数据库写操作完成，那么他的数据会被复制到从数据库，若是还没有即使复制到从数据库，读请求又来了，此时读取的数据就不是最新的数据。从主同步的过程网络出故障了，导致主从同步失败，也会出现问题数据一致性的问题。主从模式不具备自动容错和恢复的功能，一旦主数据库，从节点晋升未主数据库的过程需要人为操作，维护的成本就会升高，并且主节点的写能力、存储能力都会受到限制。</li>\n</ul>\n<h5 id=\"数据同步方式\"><a href=\"#数据同步方式\" class=\"headerlink\" title=\"数据同步方式\"></a>数据同步方式</h5><ol>\n<li>当slave启动后会向master发送<code>PSYNC</code>命令，master节后到从数据库的命令后通过<code>bgsave</code>保存快照（<strong>RDB持久化</strong>），并且期间的执行的些命令会被缓存起来。</li>\n<li>然后master会将保存的快照发送给slave，并且继续缓存期间的写命令。</li>\n<li>slave收到主数据库发送过来的快照就会加载到自己的数据库中。</li>\n<li>最后master讲缓存的命令同步给slave，slave收到命令后执行一遍，这样master与slave数据就保持一致了。</li>\n</ol>\n<h4 id=\"哨兵\"><a href=\"#哨兵\" class=\"headerlink\" title=\"哨兵\"></a>哨兵</h4><blockquote>\n<p>哨兵模式是 Redis 官方推荐的高可用模式。哨兵模式是主从的升级版，因为主从的出现故障后，不会自动恢复，需要人为干预。在主从的基础上，实现哨兵模式就是为了监控主从的运行状况，对主从的健壮进行监控，就好像哨兵一样，只要有异常就发出警告，对异常状况进行处理。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211007011355.png\"></p>\n<h5 id=\"监控\"><a href=\"#监控\" class=\"headerlink\" title=\"监控\"></a>监控</h5><blockquote>\n<p>监控master和slave是否正常运行，以及哨兵之间也会相互监控</p>\n</blockquote>\n<ul>\n<li>监控是指哨兵进程在运行时，周期性地给所有的主从库发送 PING 命令，检测它们是否仍然在线运行。如果从库没有在规定时间内响应哨兵的 PING 命令，哨兵就会把它标记为“下线状态”；同样，如果主库也没有在规定时间内响应哨兵的 PING 命令，哨兵就会判定主库下线，然后开始自动切换主库的流程。</li>\n</ul>\n<h5 id=\"自动故障恢复\"><a href=\"#自动故障恢复\" class=\"headerlink\" title=\"自动故障恢复\"></a>自动故障恢复</h5><blockquote>\n<p>当master出现故障的时候，会自动选举一个slave作为master顶上去。</p>\n</blockquote>\n<h5 id=\"节点通信\"><a href=\"#节点通信\" class=\"headerlink\" title=\"节点通信\"></a>节点通信</h5><ul>\n<li><strong>哨兵与master建立连接后，定期会向（10秒一次）master和slave发送INFO命令，若是master被标记为主观下线，频率就会变为1秒一次。</strong></li>\n<li>发送的内容包含<strong>哨兵的ip和端口、运行id、配置版本、master名字、master的ip端口还有master的配置版本</strong>等信息。</li>\n<li><strong>定期的向master、slave和其它哨兵发送PING命令（每秒一次），以便检测对象是否存活</strong>，若是对方接收到了PING命令，无故障情况下，会回复PONG命令。</li>\n</ul>\n<ol>\n<li>INFO：该命令可以获取主从数据库的最新信息，可以实现新结点的发现</li>\n<li>PING：该命令被使用最频繁，该命令封装了自身节点和其它节点的状态数据。</li>\n<li>PONG：当节点收到MEET和PING，会回复PONG命令，也把自己的状态发送给对方。</li>\n<li>MEET：该命令在新结点加入集群的时候，会向老节点发送该命令，表示自己是个新人</li>\n<li>FAIL：当节点下线，会向集群中广播该消息。</li>\n</ol>\n<h5 id=\"上线和下线\"><a href=\"#上线和下线\" class=\"headerlink\" title=\"上线和下线\"></a>上线和下线</h5><blockquote>\n<p>当哨兵与master相同之后就会定期一直保持联系，若是某一时刻哨兵发送的PING在指定时间内没有收到回复（<code>sentinel down-after-milliseconds master-name milliseconds</code> 配置），那么发送PING命令的哨兵就会认为该master<strong>主观下线</strong>（<code>Subjectively Down</code>）。</p>\n<p>因为有可能是哨兵与该master之间的网络问题造成的，而不是master本身的原因，所以哨兵同时会询问其它的哨兵是否也认为该master下线，若是认为该节点下线的哨兵达到一定的数量（<strong>前面的quorum字段配置</strong>），就会认为该节点<strong>客观下线</strong>（<code>Objectively Down</code>）。</p>\n<p>若是没有足够数量的sentinel同意该master下线，则该master客观下线的标识会被移除；若是master重新向哨兵的PING命令回复了客观下线的标识也会被移除。</p>\n</blockquote>\n<h5 id=\"选举算法\"><a href=\"#选举算法\" class=\"headerlink\" title=\"选举算法\"></a>选举算法</h5><blockquote>\n<p>当master被认为客观下线后，又是怎么进行故障恢复的呢？原来哨兵中首先选举出一个老大哨兵来进行故障恢复，</p>\n</blockquote>\n<h5 id=\"选举master哨兵的算法叫做Raft算法\"><a href=\"#选举master哨兵的算法叫做Raft算法\" class=\"headerlink\" title=\"选举master哨兵的算法叫做Raft算法\"></a>选举master哨兵的算法叫做<strong>Raft算法</strong></h5><ol>\n<li>发现master下线的哨兵（sentinelA）会向其它的哨兵发送命令进行拉票，要求选择自己为哨兵大佬。</li>\n<li>若是目标哨兵没有选择其它的哨兵，就会选择该哨兵（sentinelA）为大佬。</li>\n<li>若是选择sentinelA的哨兵超过半数（半数原则），该大佬非sentinelA莫属。</li>\n<li>如果有多个哨兵同时竞选，并且可能存在票数一致的情况，就会等待下次的一个随机时间再次发起竞选请求，进行新的一轮投票，直到大佬被选出来。</li>\n</ol>\n<ul>\n<li>选出master哨兵后，master哨兵就会对故障进行自动回复，从slave中选出一名slave作为主数据库</li>\n</ul>\n<ol>\n<li>所有的slave中<code>slave-priority</code>优先级最高的会被选中。</li>\n<li>若是优先级相同，会选择偏移量最大的，因为偏移量记录着数据的复制的增量，越大表示数据越完整。</li>\n<li>若是以上两者都相同，选择ID最小的。</li>\n</ol>\n<h4 id=\"集群Cluster模式\"><a href=\"#集群Cluster模式\" class=\"headerlink\" title=\"集群Cluster模式\"></a>集群Cluster模式</h4><blockquote>\n<p>集群模式实现了Redis数据的分布式存储，实现数据的分片，每个redis节点存储不同的内容，并且解决了在线的节点收缩（下线）和扩容（上线）问题。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211222220615.png\"></p>\n<h5 id=\"虚拟槽分区算法\"><a href=\"#虚拟槽分区算法\" class=\"headerlink\" title=\"虚拟槽分区算法\"></a>虚拟槽分区算法</h5><blockquote>\n<p>在Redis集群中采用的使虚拟槽分区算法，会把redis集群分成16384 个槽（0 -16383）。</p>\n</blockquote>\n<ul>\n<li>当客户端请求过来，会首先通过对key进行CRC16 校验并对 16384 取模（CRC16(key)%16383）计算出key所在的槽，然后再到对应的槽上进行取数据或者存数据，这样就实现了数据的访问更新。</li>\n</ul>\n<h5 id=\"节点通信-1\"><a href=\"#节点通信-1\" class=\"headerlink\" title=\"节点通信\"></a>节点通信</h5><blockquote>\n<p>节点之间实现了将数据进行分片存储，那么节点之间又是怎么通信的呢？这个和前面哨兵模式讲的命令基本一样。</p>\n</blockquote>\n<ul>\n<li>新上线的节点，会通过 Gossip 协议向老成员发送Meet消息，表示自己是新加入的成员。</li>\n<li>老成员收到Meet消息后，在没有故障的情况下会恢复PONG消息，表示欢迎新结点的加入，除了第一次发送Meet消息后，之后都会发送定期PING消息，实现节点之间的通信。</li>\n</ul>\n<h5 id=\"数据请求\"><a href=\"#数据请求\" class=\"headerlink\" title=\"数据请求\"></a>数据请求</h5><blockquote>\n<p>在Redis的底层维护了<code>unsigned char myslots[CLUSTER_SLOTS/8]</code> 一个数组存放每个节点的槽信息。这样数组只表示自己是否存储对应的槽数据，若是1表示存在该数据，0表示不存在该数据，这样查询的效率就会非常的高，类似于布隆过滤器，二进制存储。并且，每个redis底层还维护了一个clusterNode数组，大小也是16384，用于储存负责对应槽的节点的ip、端口等信息，这样每一个节点就维护了其它节点的元数据信息，便于及时的找到对应的节点。</p>\n</blockquote>\n<h5 id=\"扩容和收缩\"><a href=\"#扩容和收缩\" class=\"headerlink\" title=\"扩容和收缩\"></a>扩容和收缩</h5><blockquote>\n<p>扩容和收缩也就是节点的上线和下线，可能节点发生故障了，故障自动回复的过程（节点收缩）。</p>\n</blockquote>\n<ul>\n<li>节点的收缩和扩容时，会重新计算每一个节点负责的槽范围，并发根据虚拟槽算法，将对应的数据更新到对应的节点。</li>\n<li>发生故障后，哨兵老大节点的选举，master节点的重新选举，slave怎样晋升为master节点，可以查看前面哨兵模式选举过程。</li>\n</ul>\n<h5 id=\"虚拟哈希槽分区\"><a href=\"#虚拟哈希槽分区\" class=\"headerlink\" title=\"虚拟哈希槽分区\"></a>虚拟哈希槽分区</h5><blockquote>\n<p>Redis Cluster 采用虚拟哈希槽分区，所有的键根据哈希函数映射到 0~16383 整数槽内，每个 key 通过 CRC16 校验后对 16384 取模来决定放置哪个槽（slot），每一个节点负责维护一部分槽以及槽所映射的键值数据。</p>\n</blockquote>\n<h5 id=\"一致性哈希算法原理\"><a href=\"#一致性哈希算法原理\" class=\"headerlink\" title=\"一致性哈希算法原理\"></a>一致性哈希算法原理</h5><blockquote>\n<p>一致性 Hash 算法使用取模的方法，对 2 的 32 方取模。即，一致性 Hash 算法将整个 Hash 空间组织成一个虚拟的圆环，Hash 函数的值空间为 0~2^32-1（一个 32 位无符号整型）</p>\n</blockquote>\n<h5 id=\"slot-原理\"><a href=\"#slot-原理\" class=\"headerlink\" title=\"slot 原理\"></a>slot 原理</h5><blockquote>\n<p>Redis Cluster 中有一个 16384 长度的槽的概念，它们的编号为 0~16383。这个槽是一个虚拟的槽，并不是真正存在的。正常工作的时候，Redis Cluster 中的每个 master 节点都会负责一部分的槽，当有某个 key 被映射到某个 master 负责的槽，那么这个 master 负责为这个 key 提供服务，至于哪个 master 节点负责哪个槽，这是可以由用户指定的，也可以在初始化的时候自动生成。每个槽映射一个数据子集，一般比节点数大。</p>\n</blockquote>\n<ul>\n<li>Redis Cluster 是服务端管理节点、槽、数据，值得一提的是只有 master 节点才能分配槽。通过哈希算法再加上取模运算可以将一个值固定地映射到某个区间，在这里，这个区间叫做 slots，区间由连续的 slot 组成。在 Redis Cluster 中，我们拥有 16384 个 slot，这个数是固定的，我们存储在 Redis Cluster 中的所有的键都会被映射到这些 slot 中。</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"code\"><pre><span class=\"line\">HASH_SLOT = CRC16(key) mod <span class=\"number\">16384</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Redis6-0\"><a href=\"#Redis6-0\" class=\"headerlink\" title=\"Redis6.0\"></a>Redis6.0</h3><ul>\n<li>网络处理多IO线程<ul>\n<li>随着网络硬件的性能提升，Redis 的性能瓶颈有时会出现在网络 IO 的处理上，也就是说，单个主线程处理网络请求的速度跟不上底层网络硬件的速度。采用多个 IO 线程来处理网络请求，提高网络请求处理的并行度。Redis 6.0 就是采用的这种方法。对于读写命令，Redis 仍然使用单线程来处理。</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220102230926.png\"></p>\n<ul>\n<li>客户端缓存、细粒度的权限设计<ul>\n<li>Redis 6.0 新增了一个重要的特性，就是实现了服务端协助的客户端缓存功能，也称为跟踪（Tracking）功能。有了这个功能，业务应用中的 Redis 客户端就可以把读取的数据缓存在业务应用本地了。</li>\n<li>6.0 实现的 Tracking 功能实现了两种模式<ul>\n<li>第一种模式是普通模式。在这个模式下，实例会在服务端记录客户端读取过的 key，并监测 key 是否有修改。一旦 key 的值发生变化，服务端会给客户端发送 invalidate 消息，通知客户端缓存失效了。</li>\n<li>第二种模式是广播模式。在这个模式下，服务端会给客户端广播所有 key 的失效情况，不过，这样做了之后，如果 key 被频繁修改，服务端会发送大量的失效广播消息，这就会消耗大量的网络带宽资源。<code>和普通模式不同，在广播模式下，即使客户端还没有读取过 key，但只要它注册了要跟踪的 key，服务端都会把 key 失效消息通知给这个客户端。</code></li>\n</ul>\n</li>\n<li>在 Redis 6.0 版本之前，要想实现实例的安全访问，只能通过设置密码来控制，例如，客户端连接实例前需要输入密码。<ul>\n<li>对于一些高风险的命令（例如 KEYS、FLUSHDB、FLUSHALL 等），在 Redis 6.0 之前，我们也只能通过 rename-command 来重新命名这些命令，避免客户端直接调用。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>RESP 3 协议<ul>\n<li>edis 6.0 实现了 RESP 3 通信协议，而之前都是使用的 RESP 2。在 RESP 2 中，客户端和服务器端的通信内容都是以字节数组形式进行编码的，客户端需要根据操作的命令或是数据类型自行对传输的数据进行解码，增加了客户端开发复杂度。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h3><h4 id=\"缓存热key\"><a href=\"#缓存热key\" class=\"headerlink\" title=\"缓存热key\"></a>缓存热key</h4><blockquote>\n<p><strong>什么是热Key呢</strong>？在Redis中，我们把访问频率高的key，称为热点key。</p>\n</blockquote>\n<ul>\n<li>如果某一热点key的请求到服务器主机时，由于请求量特别大，可能会导致主机资源不足，甚至宕机，从而影响正常的服务。<ul>\n<li>Redis集群扩容：增加分片副本，均衡读流量；</li>\n<li>使用二级缓存，即JVM本地缓存,减少Redis的读请求。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"缓存带来的问题\"><a href=\"#缓存带来的问题\" class=\"headerlink\" title=\"缓存带来的问题\"></a>缓存带来的问题</h4><h5 id=\"缓存雪崩\"><a href=\"#缓存雪崩\" class=\"headerlink\" title=\"缓存雪崩\"></a>缓存雪崩</h5><ul>\n<li><p>我们可以简单的理解为：由于原有缓存失效，新缓存未到期间(例如：我们设置缓存时采用了相同的过期时间，在同一时刻出现大面积的缓存过期)，所有原本应该访问缓存的请求都去查询数据库了，而对数据库CPU和内存造成巨大压力，严重的会造成数据库宕机。从而形成一系列连锁反应，造成整个系统崩溃。</p>\n</li>\n<li><p><strong>解决办法：</strong></p>\n<ol>\n<li><p>大多数系统设计者考虑用<strong>加锁</strong>（ 最多的解决方案）或者队列的方式保证来保证不会有大量的线程对数据库一次性进行读写，从而避免失效时大量的并发请求落到底层存储系统上。</p>\n</li>\n<li><p>将缓存失效时间分散开。</p>\n</li>\n<li><p>服务层增加熔断、降级、限流等操作，防止系统被流量攻溃。</p>\n</li>\n<li><p>增加redis的监控措施，并采用高可用架构处理。</p>\n</li>\n</ol>\n</li>\n</ul>\n<h5 id=\"缓存穿透\"><a href=\"#缓存穿透\" class=\"headerlink\" title=\"缓存穿透\"></a>缓存穿透</h5><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF/%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98.svg\"></p>\n<ul>\n<li>缓存穿透是指用户查询数据，在数据库没有，自然在缓存中也不会有。这样就导致用户查询的时候，在缓存中找不到，每次都要去数据库再查询一遍，然后返回空（相当于进行了两次无用的查询）。这样请求就绕过缓存直接查数据库，这也是经常提的缓存命中率问题。</li>\n<li>解决办法</li>\n</ul>\n<blockquote>\n<ol>\n<li><strong>缓存空对象</strong>：代码维护较简单，但是效果不好。</li>\n<li><strong>布隆过滤器</strong>：代码维护复杂，空间效率和查询时间都远远超过一般的算法，效果很好。有一定的误识别率，删除困难。</li>\n<li><strong>请求参数检验</strong>：防止恶意请求进入业务系统，将部分恶意请求拦截掉。</li>\n<li><strong>过载保护</strong>：对Redis的流量进行限制，放置过大流量进入Redis导致崩溃。</li>\n</ol>\n</blockquote>\n<ul>\n<li><p><strong>布隆过滤器</strong>，将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数据会被这个bitmap拦截掉，从而避免了对底层存储系统的查询压力。</p>\n<ul>\n<li>就是引入了k(k&gt;1)k(k&gt;1)个相互独立的哈希函数，保证在给定的空间、误判率下，完成元素判重的过程。它的优点是空间效率和查询时间都远远超过一般的算法，缺点是有一定的误识别率和删除困难。Hash存在一个冲突（碰撞）的问题，用同一个Hash得到的两个URL的值有可能相同。为了减少冲突，我们可以多引入几个Hash，如果通过其中的一个Hash值我们得出某元素不在集合中，那么该元素肯定不在集合中。只有在所有的Hash函数告诉我们该元素在集合中时，才能确定该元素存在于集合中。这便是Bloom-Filter的基本思想。Bloom-Filter一般用于在大数据量的集合中判定某元素是否存在。</li>\n</ul>\n</li>\n<li><p><strong>缓存空对象</strong>,一个查询返回的数据为空（不管是数据不存在，还是系统故障），我们仍然把这个空结果进行缓存，但它的过期时间会很短，最长不超过五分钟。通过这个直接设置的默认值存放到缓存，这样第二次到缓冲中获取就有值了，而不会继续访问数据库，这种办法最简单粗暴。</p>\n</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF/%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98-%E7%A9%BA%E5%80%BC%E7%BC%93%E5%AD%98.svg\"></p>\n<h5 id=\"布隆过滤器\"><a href=\"#布隆过滤器\" class=\"headerlink\" title=\"布隆过滤器\"></a>布隆过滤器</h5><blockquote>\n<p>布隆过滤器是一种基于<strong>概率</strong>的<strong>数据结构</strong>，主要用来判断某个元素是否在集合内，它具有<strong>运行速度快</strong>（时间效率），<strong>占用内存小</strong>的优点（空间效率），但是有一定的<strong>误识别率</strong>和<strong>删除困难</strong>的问题。它只能告诉你某个元素一定不在集合内或可能在集合内。</p>\n</blockquote>\n<ol>\n<li>一个非常大<strong>的二进制位数组</strong> （数组里只有0和1）</li>\n<li>若干个<strong>哈希函数</strong></li>\n<li><strong>空间效率</strong>和<strong>查询效率高</strong></li>\n<li>不存在<strong>漏报</strong>（False Negative）：某个元素在某个集合中，肯定能报出来。</li>\n<li>可能存在<strong>误报</strong>（False Positive）：某个元素不在某个集合中，可能也被爆出来。</li>\n<li>不提供删除方法，代码维护困难。</li>\n<li>位数组初始化都为0，它不存元素的具体值，当元素经过哈希函数哈希后的值（也就是数组下标）对应的数组位置值改为1。</li>\n</ol>\n<h5 id=\"布隆过滤器案例\"><a href=\"#布隆过滤器案例\" class=\"headerlink\" title=\"布隆过滤器案例\"></a>布隆过滤器案例</h5><blockquote>\n<p>当查询一件商品的缓存信息，布隆过滤器只能精确判断数据不存在情况，对于存在我们只能说是可能，因为存在Hash冲突情况，当然这个概率非常低。</p>\n</blockquote>\n<ol>\n<li>当查询一件商品的缓存信息</li>\n<li>然后，在布隆数组中查找访问对应的位值，0或1</li>\n<li>判断，三个值中，只要有一个不是1，那么我们认为数据是不存在的。</li>\n</ol>\n<h5 id=\"布隆过滤器删除问题\"><a href=\"#布隆过滤器删除问题\" class=\"headerlink\" title=\"布隆过滤器删除问题\"></a>布隆过滤器删除问题</h5><blockquote>\n<p>直接删除肯定不行，存在hash冲突，存在误删。</p>\n</blockquote>\n<ul>\n<li>定时任务，定期创建一个新的布隆过滤器。</li>\n</ul>\n<h5 id=\"如何减少布隆过滤器的误判\"><a href=\"#如何减少布隆过滤器的误判\" class=\"headerlink\" title=\"如何减少布隆过滤器的误判\"></a>如何减少布隆过滤器的误判</h5><ul>\n<li>增加二进制位数组的长度。这样经过hash后数据会更加的离散化，出现冲突的概率会大大降低。</li>\n<li>增加Hash的次数，变相的增加数据特征。特征数据越多，冲突的概率越小。</li>\n</ul>\n<h5 id=\"缓存击穿\"><a href=\"#缓存击穿\" class=\"headerlink\" title=\"缓存击穿\"></a>缓存击穿</h5><blockquote>\n<p><strong>缓存击穿</strong>是指一个<code>key</code>非常热点，在不停的扛着大并发，<strong>大并发</strong>集中对这一个点进行访问，当这个key在失效的瞬间，持续的<strong>大并发</strong>就穿破缓存，直接请求数据库，瞬间对数据库的访问压力增大。</p>\n</blockquote>\n<ul>\n<li>当用户出现<strong>大并发</strong>访问的时候，在查询缓存的时候和查询数据库的过程加锁，只能第一个进来的请求进行执行，当第一个请求把该数据放进缓存中，接下来的访问就会直接集中缓存，防止了<strong>缓存击穿</strong>。即根据key获取value值为空时，锁上，从数据库中<code>load</code>数据后再释放锁。若其它线程获取锁失败，则等待一段时间后重试。这里要注意，分布式环境中要使用<strong>分布式锁</strong>，<strong>单机</strong>的话用普通的锁（<code>synchronized</code>、<code>Lock</code>）就够了。<ul>\n<li><strong>使用互斥锁方案</strong>缓存失效时，不是立即去加载db数据，而是先使用某些带成功返回的原子操作命令，如(Redis的setnx）去操作，成功的时候，再去加载db数据库数据和设置缓存。否则就去重试获取缓存。</li>\n<li><strong>持续不过期</strong>,通过定时任务的方式同步数据到缓存中。防止热key数据过期。</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"缓存预热\"><a href=\"#缓存预热\" class=\"headerlink\" title=\"缓存预热\"></a>缓存预热</h5><ul>\n<li>缓存预热这个应该是一个比较常见的概念，缓存预热就是系统上线后，将相关的缓存数据直接加载到缓存系统。这样就可以避免在用户请求的时候，先查询数据库，然后再将数据缓存的问题！用户直接查询事先被预热的缓存数据！</li>\n</ul>\n<h5 id=\"缓存更新\"><a href=\"#缓存更新\" class=\"headerlink\" title=\"缓存更新\"></a>缓存更新</h5><ul>\n<li>除了缓存服务器自带的缓存失效策略之外（Redis默认的有6中策略可供选择），我们还可以根据具体的业务需求进行自定义的缓存淘汰，常见的策略有两种：<ul>\n<li>定时去清理过期的缓存；</li>\n<li>当有用户请求过来时，再判断这个请求所用到的缓存是否过期，过期的话就去底层系统得到新数据并更新缓存。</li>\n</ul>\n</li>\n<li>两者各有优劣，第一种的缺点是维护大量缓存的key是比较麻烦的，第二种的缺点就是每次用户请求过来都要判断缓存失效，逻辑相对比较复杂！具体用哪种方案，大家可以根据自己的应用场景来权衡。</li>\n</ul>\n<h5 id=\"缓存降级\"><a href=\"#缓存降级\" class=\"headerlink\" title=\"缓存降级\"></a>缓存降级</h5><ul>\n<li>当访问量剧增、服务出现问题（如响应时间慢或不响应）或非核心服务影响到核心流程的性能时，仍然需要保证服务还是可用的，即使是有损服务。系统可以根据一些关键数据进行自动降级，也可以配置开关实现人工降级。<ul>\n<li>以参考日志级别设置预案：<ul>\n<li>一般：比如有些服务偶尔因为网络抖动或者服务正在上线而超时，可以自动降级；</li>\n<li>警告：有些服务在一段时间内成功率有波动（如在95~100%之间），可以自动降级或人工降级，并发送告警；</li>\n<li>错误：比如可用率低于90%，或者数据库连接池被打爆了，或者访问量突然猛增到系统能承受的最大阀值，此时可以根据情况自动降级或者人工降级；</li>\n<li>严重错误：比如因为特殊原因数据错误了，此时需要紧急人工降级。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>服务降级的目的，是为了防止Redis服务故障，导致数据库跟着一起发生雪崩问题。因此，对于不重要的缓存数据，可以采取服务降级策略，例如一个比较常见的做法就是，Redis出现问题，不去数据库查询，而是直接返回默认值给用户。</li>\n</ul>\n<h4 id=\"数据一致性\"><a href=\"#数据一致性\" class=\"headerlink\" title=\"数据一致性\"></a>数据一致性</h4><blockquote>\n<p>缓存一致性问题作为日常开发长期存在的问题。</p>\n</blockquote>\n<ul>\n<li>集中式远程缓存(单节点) </li>\n<li>集群式远程缓存</li>\n<li>集中式远程缓存+本地缓存（更新频率高采用远程缓存，更新频率低才用本地缓存）<ul>\n<li>广播更新策略</li>\n<li>定时更新策略</li>\n</ul>\n</li>\n<li>集群式远程缓存+本地缓存（更新频率高采用远程缓存，更新频率低才用本地缓存）<ul>\n<li>广播更新策略</li>\n<li>定时更新策略</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220105184647.png\"></p>\n<h5 id=\"缓存常见的操作\"><a href=\"#缓存常见的操作\" class=\"headerlink\" title=\"缓存常见的操作\"></a>缓存常见的操作</h5><ul>\n<li><p>写入：缓存和数据库是两个不同的组件，只要涉及双写，就存在只有一个写成功的可能性，造成数据不一致。</p>\n</li>\n<li><p>更新：更新的情况类似，需要更新两个不同的组件。</p>\n</li>\n<li><p>读取：读取要保证从缓存中读到的信息是最新的，是和数据库中的是一致的。</p>\n</li>\n<li><p>删除：当删除数据库记录的时候，如何把缓存中的数据也删掉？</p>\n</li>\n</ul>\n<h5 id=\"同步直写\"><a href=\"#同步直写\" class=\"headerlink\" title=\"同步直写\"></a>同步直写</h5><ul>\n<li>写数据库的时候也写入缓存，通过代码检查机制使数据库和缓存数据统一。通常会采用事务、重试机制来保证数据。</li>\n</ul>\n<h5 id=\"延时双删\"><a href=\"#延时双删\" class=\"headerlink\" title=\"延时双删\"></a>延时双删</h5><ul>\n<li>先更新再删除，但是执行删除动作，在不久之后再执行一次，比如 1-5 秒之后。</li>\n</ul>\n<h5 id=\"集中更新\"><a href=\"#集中更新\" class=\"headerlink\" title=\"集中更新\"></a>集中更新</h5><ul>\n<li>弱化数据库，将数据优先存放到redis总，在通过定时器或扫描逻辑代码将数据同步到mysql中。</li>\n</ul>\n<h5 id=\"触发式加载\"><a href=\"#触发式加载\" class=\"headerlink\" title=\"触发式加载\"></a>触发式加载</h5><blockquote>\n<p>使用懒加载的方式，可以让缓存的同步变得非常简单</p>\n</blockquote>\n<ul>\n<li>当读取缓存的时候，如果缓存里没有相关数据，则执行相关的业务逻辑，构造缓存数据存入到缓存系统；</li>\n<li>当与缓存项相关的资源有变动，则先删除相应的缓存项，然后再对资源进行更新，这个时候，即使是资源更新失败，也是没有问题的。</li>\n</ul>\n<h5 id=\"可执行方案\"><a href=\"#可执行方案\" class=\"headerlink\" title=\"可执行方案\"></a>可执行方案</h5><ol>\n<li><p>通过Redis缓存策略过期时间更新缓存，对于访问量非常小的数据可以采用该方式。</p>\n</li>\n<li><p>更新数据库的后更新缓存（设置过期时间）</p>\n</li>\n<li><p>更新数据库后通过消息列队去处理Redis更新。（需要保证消息的顺序）</p>\n</li>\n<li><p>如果是Mysql可以定位binlog（需要单独单肩服务）</p>\n</li>\n</ol>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20220103155138.png\"></p>\n<h4 id=\"Redis命令是如何执行的\"><a href=\"#Redis命令是如何执行的\" class=\"headerlink\" title=\"Redis命令是如何执行的\"></a>Redis命令是如何执行的</h4><blockquote>\n<p>一条命令的执行过程有很多细节，但大体可分为：客户端先将用户输入的命令，转化为 Redis 相关的通讯协议，再用 socket 连接的方式将内容发送给服务器端，服务器端在接收到相关内容之后，先将内容转化为具体的执行命令，再判断用户授权信息和其他相关信息，当验证通过之后会执行最终命令，命令执行完之后，会进行相关的信息记录和数据统计，然后再把执行结果发送给客户端，这样一条命令的执行流程就结束了。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211222220835.png\"></p>\n<ul>\n<li>用户输入一条命令</li>\n<li>Redis客户端将命令转换成Redis的协议<strong>（RESP，REdis Serialization Protocol）</strong>，然后在通过socket连接发送给服务器端。<ul>\n<li>Redis使用<strong>空格符</strong>号来确定完成的命令长度。</li>\n</ul>\n</li>\n<li>Redis Server接受到命令，会到输入缓冲中读取数据，判断数据是否超过最大限制（默认是是1G），如果超过了则返回异常信息。</li>\n<li>Redis Server 在执行命令之前会做各种校验，命令是否异常、权限、集群相关、最大内存、持久化检查、只读检查、客户端订阅检查、从节点状态检查、是否初始化检查、lua脚本阻塞、事物、监视器。最后才会执行命令。<strong>调用 redisCommand 中的 proc 函数执行命令</strong></li>\n<li>执行完成之后统计，检查慢查询是否开启、检查统计信息是否开启、检查持久化是否开启（开启则记录信息）、检查是否有slave复制当前server（存在则同步命令到其他服务器）</li>\n<li>最后在通过soket返回客户端结果。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211222222535.png\"></p>\n<h4 id=\"单线程的Redis为什么这么快\"><a href=\"#单线程的Redis为什么这么快\" class=\"headerlink\" title=\"单线程的Redis为什么这么快\"></a>单线程的Redis为什么这么快</h4><ul>\n<li>存内存操作。</li>\n<li>单线程操作，避免平凡的上下文切换。</li>\n<li>采用了非阻塞I/O多路复用操作。（这里的I/O是指网络I/O）<ul>\n<li>这里的<strong>多路</strong>是指多个网络连接。<strong>复用</strong>复用同一个线程，采用多路I/O复用技术可以让单个线程高效处理多个连接请求。这样避免了线程创建销毁带来的资源消耗。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"为什么Redis的操作是原子性的，怎么保证原子性的？\"><a href=\"#为什么Redis的操作是原子性的，怎么保证原子性的？\" class=\"headerlink\" title=\"为什么Redis的操作是原子性的，怎么保证原子性的？\"></a>为什么Redis的操作是原子性的，怎么保证原子性的？</h4><ul>\n<li>对于Redis而言，命令的原子性指的是：一个操作的不可以再分，操作要么执行，要么不执行。Redis的操作之所以是原子性的，是因为Redis是单线程的。</li>\n<li>Redis本身提供的所有API都是原子操作，Redis中的事务其实是要保证批量操作的原子性。</li>\n<li>使用Redis的事务，或者使用Redis+Lua的方式实现。</li>\n</ul>\n<figure class=\"highlight lua\"><table><tr><td class=\"code\"><pre><span class=\"line\">// 客户端限流操作</span><br><span class=\"line\">//获取ip对应的访问次数</span><br><span class=\"line\">current = GET(ip)</span><br><span class=\"line\">//如果超过访问次数超过<span class=\"number\">20</span>次，则报错</span><br><span class=\"line\">IF current != NULL AND current &gt; <span class=\"number\">20</span> THEN</span><br><span class=\"line\">    ERROR <span class=\"string\">\"exceed 20 accesses per second\"</span></span><br><span class=\"line\">ELSE</span><br><span class=\"line\">    //如果访问次数不足<span class=\"number\">20</span>次，增加一次访问计数</span><br><span class=\"line\">    value = INCR(ip)</span><br><span class=\"line\">    //如果是第一次访问，将键值对的过期时间设置为<span class=\"number\">60</span>s后</span><br><span class=\"line\">    IF value == <span class=\"number\">1</span> THEN</span><br><span class=\"line\">        EXPIRE(ip,<span class=\"number\">60</span>)</span><br><span class=\"line\">    END</span><br><span class=\"line\">    //执行其他操作</span><br><span class=\"line\">    DO THINGS</span><br><span class=\"line\">END</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"大量key短时间内同时过期\"><a href=\"#大量key短时间内同时过期\" class=\"headerlink\" title=\"大量key短时间内同时过期\"></a>大量key短时间内同时过期</h4><ul>\n<li>如果大量的key集中在某一个时间过期，会导致redis卡顿现象，所以在设置过期时间的时候最好加上一个随机数，让的key过期时间分散一点。</li>\n</ul>\n<h4 id=\"Keys命令\"><a href=\"#Keys命令\" class=\"headerlink\" title=\"Keys命令\"></a>Keys命令</h4><ul>\n<li>keys命令可以扫出指定的key列表，但是keys命令会导致线程柱塞，线上服务会停顿，直到指令执行完毕，服务才能恢复。建议使用scan命令来代替使用。<strong>scan</strong>指令可以无阻塞的提取出指定模式的key列表，但是会有一定的重复概率，在客户端做一次去重就可以了，但是整体所花费的时间会比直接用keys指令长。但是对于 SCAN 这类增量式迭代命令来说， 因为在对键进行增量式迭代的过程中， 键可能会被修改， 所以增量式迭代命令只能对被返回的元素提供有限的保证 。</li>\n</ul>\n<h4 id=\"Redis为何是-16384-个槽\"><a href=\"#Redis为何是-16384-个槽\" class=\"headerlink\" title=\"Redis为何是 16384 个槽\"></a>Redis为何是 16384 个槽</h4><blockquote>\n<p>Redis Cluster 为什么是 16384 个槽，16384 是 2^14 的结果</p>\n</blockquote>\n<ul>\n<li>作者怎么说</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">The reason is:</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tNormal heartbeat packets carry the full configuration of a node, that can be replaced in an idempotent way with the old in order to update an old config. This means they contain the slots configuration for a node, in raw form, that uses 2k of space with16k slots, but would use a prohibitive 8k of space using 65k slots.</span><br><span class=\"line\">\t\tAt the same time it is unlikely that Redis Cluster would scale to more than 1000 mater nodes because of other design tradeoffs.</span><br><span class=\"line\">So 16k was in the right range to ensure enough slots per master with a max of 1000 maters, but a small enough number to propagate the slot configuration as a raw bitmap easily. Note that in small clusters the bitmap would be hard to compress because when N is small the bitmap would have slots&#x2F;N bits set that is a large percentage of bits set.</span><br></pre></td></tr></table></figure>\n\n","categories":["查缺补漏"],"tags":["Redis"]},{"title":"查缺补漏-Mybatis","url":"/posts/3249289058/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h2 id=\"整体架构\"><a href=\"#整体架构\" class=\"headerlink\" title=\"整体架构\"></a>整体架构</h2><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211013113522.png\"/>\n\n\n\n<h3 id=\"基础层\"><a href=\"#基础层\" class=\"headerlink\" title=\"基础层\"></a>基础层</h3><h3 id=\"处理层\"><a href=\"#处理层\" class=\"headerlink\" title=\"处理层\"></a>处理层</h3><h3 id=\"接口层\"><a href=\"#接口层\" class=\"headerlink\" title=\"接口层\"></a>接口层</h3><h2 id=\"Mybatis执行流程\"><a href=\"#Mybatis执行流程\" class=\"headerlink\" title=\"Mybatis执行流程\"></a>Mybatis执行流程</h2><ul>\n<li>获取sqlSessionFactory对象:解析文件的每一个信息保存在Configuration中，返回包含Configuration的DefaultSqlSession；注意：MappedStatement：代表一个增删改查的详细信息。</li>\n<li>获取sqlSession对象,返回一个DefaultSQlSession对象，包含Executor和Configuration;这一步会创建Executor对象；</li>\n<li>获取接口的代理对象（MapperProxy）,getMapper，使用MapperProxyFactory创建一个MapperProxy的代理对象。</li>\n</ul>\n<h2 id=\"Mybatis拦截器\"><a href=\"#Mybatis拦截器\" class=\"headerlink\" title=\"Mybatis拦截器\"></a>Mybatis拦截器</h2><blockquote>\n<p>代理对象里面包含了，DefaultSqlSession（Executor）</p>\n</blockquote>\n<ul>\n<li>执行增删改查方法。<ul>\n<li>调用DefaultSqlSession的增删改查（Executor）</li>\n<li>创建一个StatementHandler对象、且同时创建出ParameterHandler和ResultSetHandler。</li>\n<li>调用StatementHandler预编译参数以及设置参数值;使用ParameterHandler来给sql设置参数</li>\n<li>调用StatementHandler的增删改查方法；</li>\n<li>ResultSetHandler封装结果</li>\n</ul>\n</li>\n<li>MyBatis 拦截签名  拦截器签名是一个名为 @Intercepts 的注解，该注解中可以通过 @Signature 配置多个签名。@Signature 注解中则包含三个属性<ul>\n<li>type: 拦截器需要拦截的接口，有 4 个可选项，分别是：Executor、ParameterHandler、ResultSetHandler 以及 StatementHandler。</li>\n<li>method: 拦截器所拦截接口中的方法名，也就是前面四个接口中的方法名，接口和方法要对应上。</li>\n<li>args: 拦截器所拦截方法的参数类型，通过方法名和参数类型可以锁定唯一一个方法。</li>\n</ul>\n</li>\n<li>被拦截的对象<ul>\n<li>org.apache.ibatis.executor.Executor</li>\n<li>org.apache.ibatis.executor.statement.StatementHandler</li>\n<li>org.apache.ibatis.executor.statement.ParameterHandler</li>\n<li>org.apache.ibatis.executor.resultset.ResultSetHandler</li>\n</ul>\n</li>\n<li>Executor<ul>\n<li>update：该方法会在所有的 INSERT、 UPDATE、 DELETE 执行时被调用，如果想要拦截这些操作，可以通过该方法实现。</li>\n<li>query：该方法会在 SELECT 查询方法执行时被调用，方法参数携带了很多有用的信息，如果需要获取，可以通过该方法实现。</li>\n<li>queryCursor：当 SELECT 的返回类型是 Cursor 时，该方法会被调用。</li>\n<li>flushStatements：当 SqlSession 方法调用 flushStatements 方法或执行的接口方法中带有 @Flush 注解时该方法会被触发。</li>\n<li>commit：当 SqlSession 方法调用 commit 方法时该方法会被触发。</li>\n<li>rollback：当 SqlSession 方法调用 rollback 方法时该方法会被触发。</li>\n<li>getTransaction：当 SqlSession 方法获取数据库连接时该方法会被触发。</li>\n<li>close：该方法在懒加载获取新的 Executor 后会被触发。</li>\n<li>isClosed：该方法在懒加载执行查询前会被触发。</li>\n</ul>\n</li>\n<li>StatementHandler<ul>\n<li>prepare：该方法在数据库执行前被触发。</li>\n<li>parameterize：该方法在 prepare 方法之后执行，用来处理参数信息。</li>\n<li>batch：如果 MyBatis 的全剧配置中配置了 defaultExecutorType=”BATCH”，执行数据操作时该方法会被调用。</li>\n<li>update：更新操作时该方法会被触发。</li>\n<li>query：该方法在 SELECT 方法执行时会被触发。</li>\n<li>queryCursor：该方法在 SELECT 方法执行时，并且返回值为 Cursor 时会被触发。</li>\n</ul>\n</li>\n<li>ParameterHandler<ul>\n<li>getParameterObject：在执行存储过程处理出参的时候该方法会被触发。</li>\n<li>setParameters：设置 SQL 参数时该方法会被触发。</li>\n</ul>\n</li>\n<li>ResultSetHandler<ul>\n<li>handleResultSets：该方法会在所有的查询方法中被触发（除去返回值类型为 Cursor<E> 的查询方法），一般来说，如果我们想对查询结果进行二次处理，可以通过拦截该方法实现。</li>\n<li>handleCursorResultSets：当查询方法的返回值类型为 Cursor<E> 时，该方法会被触发。</li>\n<li>handleOutputParameters：使用存储过程处理出参的时候该方法会被调用。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"MyBatis插件\"><a href=\"#MyBatis插件\" class=\"headerlink\" title=\"MyBatis插件\"></a>MyBatis插件</h2><blockquote>\n<p>MyBatis 将插件单独分离出一个模块，位于 org.apache.ibatis.plugin 包中，在该模块中主要使用了两种设计模式：代理模式和责任链模式。</p>\n</blockquote>\n<ul>\n<li><p>插件接口</p>\n<ul>\n<li><p>org.apache.ibatis.plugin.Interceptor </p>\n</li>\n<li><p>intercept：它将直接覆盖你所拦截的对象，有个参数Invocation对象，通过该对象，可以反射调度原来对象的方法； </p>\n</li>\n<li><p>plugin：target是被拦截的对象，它的作用是给被拦截对象生成一个代理对象； </p>\n</li>\n<li><p>setProperties：允许在plugin元素中配置所需参数，该方法在插件初始化的时候会被调用一次； </p>\n</li>\n</ul>\n</li>\n<li><p>MyBatis允许我们自定义 Interceptor 拦截 SQL 语句执行过程中的某些关键逻辑，允许拦截的方法有：Executor 类中的 update()、query()、flushStatements()、commit()、rollback()、getTransaction()、close()、isClosed()方法，ParameterHandler 中的 setParameters()、getParameterObject() 方法，ResultSetHandler中的 handleOutputParameters()、handleResultSets()方法，以及StatementHandler 中的parameterize()、prepare()、batch()、update()、query()方法。</p>\n</li>\n</ul>\n<h2 id=\"MyBatis中的设计模式\"><a href=\"#MyBatis中的设计模式\" class=\"headerlink\" title=\"MyBatis中的设计模式\"></a>MyBatis中的设计模式</h2><ul>\n<li>工厂模式<ul>\n<li>工厂模式在 MyBatis 中的典型代表是 SqlSessionFactory。</li>\n<li>SqlSession 是 MyBatis 中的重要 Java 接口，可以通过该接口来执行 SQL 命令、获取映射器示例和管理事务，而 SqlSessionFactory 正是用来产生 SqlSession 对象的，所以它在 MyBatis 中是比较核心的接口之一。</li>\n<li>工厂模式应用解析：SqlSessionFactory 是一个接口类，它的子类 DefaultSqlSessionFactory 有一个 openSession(ExecutorType execType) 的方法，其中使用了工厂模式。</li>\n</ul>\n</li>\n<li>建造者模式<ul>\n<li>MyBatis 中的典型代表是 SqlSessionFactoryBuilder。</li>\n<li>普通的对象都是通过 new 关键字直接创建的，但是如果创建对象需要的构造参数很多，且不能保证每个参数都是正确的或者不能一次性得到构建所需的所有参数，那么就需要将构建逻辑从对象本身抽离出来，让对象只关注功能，把构建交给构建类，这样可以简化对象的构建，也可以达到分步构建对象的目的，而 SqlSessionFactoryBuilder 的构建过程正是如此。</li>\n<li>在 SqlSessionFactoryBuilder 中构建 SqlSessionFactory 对象的过程是这样的，首先需要通过 XMLConfigBuilder 对象读取并解析 XML 的配置文件，然后再将读取到的配置信息存入到 Configuration 类中，然后再通过 build 方法生成我们需要的 DefaultSqlSessionFactory 对象。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> SqlSessionFactory <span class=\"title\">build</span><span class=\"params\">(InputStream inputStream, String environment, Properties properties)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        XMLConfigBuilder parser = <span class=\"keyword\">new</span> XMLConfigBuilder(inputStream, environment, properties);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> build(parser.parse());</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> ExceptionFactory.wrapException(<span class=\"string\">\"Error building SqlSession.\"</span>, e);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        ErrorContext.instance().reset();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        inputStream.close();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Intentionally ignore. Prefer previous error.</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> SqlSessionFactory <span class=\"title\">build</span><span class=\"params\">(Configuration config)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> DefaultSqlSessionFactory(config);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>单例模式<ul>\n<li>单例模式在 MyBatis 中的典型代表是 ErrorContext。</li>\n<li>使用 private 修饰的 ThreadLocal 来保证每个线程拥有一个 ErrorContext 对象，在调用 instance() 方法时再从 ThreadLocal 中获取此单例对象。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ErrorContext</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String LINE_SEPARATOR = System.lineSeparator();</span><br><span class=\"line\">  <span class=\"comment\">// 每个线程存储的容器</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ThreadLocal&lt;ErrorContext&gt; LOCAL = ThreadLocal.withInitial(ErrorContext::<span class=\"keyword\">new</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ErrorContext <span class=\"title\">instance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> LOCAL.get();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>适配器模式</p>\n<ul>\n<li>MyBatis 中的典型代表是 Log。<ul>\n<li>SLF4J</li>\n<li>Apache Commons Logging</li>\n<li>Log4j 2</li>\n<li>Log4j</li>\n<li>JDK logging</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>代理模式</p>\n<ul>\n<li>代理模式在 MyBatis 中的典型代表是 MapperProxyFactory。</li>\n</ul>\n</li>\n<li><p>模版方法模式</p>\n<ul>\n<li>模板方法在 MyBatis 中的典型代表是 BaseExecutor。</li>\n</ul>\n</li>\n<li><p>装饰器模式</p>\n<ul>\n<li>装饰器模式在 MyBatis 中的典型代表是 Cache。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"Mybatis一些疑问\"><a href=\"#Mybatis一些疑问\" class=\"headerlink\" title=\"Mybatis一些疑问\"></a>Mybatis一些疑问</h2><h3 id=\"于\"><a href=\"#于\" class=\"headerlink\" title=\"#{} 于 ${}\"></a>#{} 于 ${}</h3><blockquote>\n<p>使用#{}可以有效的防止SQL注入，提高系统安全性。</p>\n</blockquote>\n<ul>\n<li>#{}是预编译,${}是字符串替换。<ul>\n<li>Mybatis在处理#{}时，会将sql中的#{}替换为?号，调用PreparedStatement的set方法来赋值；</li>\n<li>Mybatis在处理${}时，就是把${}替换成变量的值。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"MyBatis-Dao-接口的工作原理\"><a href=\"#MyBatis-Dao-接口的工作原理\" class=\"headerlink\" title=\"MyBatis Dao 接口的工作原理\"></a>MyBatis Dao 接口的工作原理</h3><ul>\n<li>Dao 接口的全限定名，就是映射文件中的 namespace 的值，接口的方法名，就是映射文件中 Mapper 的 Statement 的 id 值，接口方法内的参数，就是传递给 SQL 的参数。Mapper 接口是没有实现类的，当调用接口方法时，接口全限定名 + 方法名拼接字符串作为 key 值，可唯一定位一个 MapperStatement。在 MyBatis 中，每一个 select、insert、update、delete 标签，都会被解析为一个 MapperStatement 对象。</li>\n</ul>\n<h3 id=\"Dao-接口里的方法可以重载吗\"><a href=\"#Dao-接口里的方法可以重载吗\" class=\"headerlink\" title=\"Dao 接口里的方法可以重载吗\"></a>Dao 接口里的方法可以重载吗</h3><ul>\n<li>Mapper 接口的工作原理是 JDK 动态代理，MyBatis 运行时会使用 JDK 动态代理为 Mapper 接口生成代理对象 proxy，代理对象会拦截接口方法，转而执行 MapperStatement 所代表的 SQL，然后将 SQL 执行结果返回。所以是不能重载的</li>\n</ul>\n","categories":["查缺补漏"],"tags":["Mybatis"]},{"title":"查缺补漏-Spring","url":"/posts/4279462154/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/SpringFrameworkRutime.png\"></p>\n<h3 id=\"Spring\"><a href=\"#Spring\" class=\"headerlink\" title=\"Spring\"></a>Spring</h3><ul>\n<li><p>Spring是一个轻量级的IoC和AOP容器框架。是为Java应用程序提供基础性服务的一套框架，目的是用于简化企业应用程序的开发，它使得开发者只需要关心业务需求。</p>\n</li>\n<li><p>主要由以下几个模块组成：</p>\n<ul>\n<li>Spring Core：核心类库，提供IOC服务</li>\n<li>Spring Context：提供框架式的Bean访问方式，以及企业级功能（JNDI、定时任务等）</li>\n<li>Spring AOP：AOP服务切面编程</li>\n<li>Spring DAO：对JDBC的抽象，简化了数据访问异常的处理</li>\n<li>Spring ORM：对现有的ORM框架的支持</li>\n<li>Spring Web：提供了基本的面向Web的综合特性，例如多方文件上传</li>\n<li>Spring MVC：提供面向Web应用的Model-View-Controller实现</li>\n</ul>\n</li>\n<li><p>IoC（Inversion of Control，翻译为“控制反转”）不是一个具体的技术，而是一种设计思想。与传统控制流相比，IoC 会颠倒控制流，在传统的编程中需要开发者自行创建并销毁对象，而在 IoC 中会把这些操作交给框架来处理，这样开发者就不用关注具体的实现细节了，拿来直接用就可以了，这就是控制反转。</p>\n</li>\n<li><p>IoC 很好的体现出了面向对象的设计法则之一——好莱坞法则：“别找我们，我们找你”。即由 IoC 容器帮对象找到相应的依赖对象并注入，而不是由对象主动去找。</p>\n</li>\n<li><p>DI（Dependency Injection，翻译为“依赖注入”）表示组件间的依赖关系交由容器在运行期自动生成，也就是说，由容器动态的将某个依赖关系注入到组件之中，这样就能提升组件的重用频率。通过依赖注入机制，我们只需要通过简单的配置，就可指定目标需要的资源，完成自身的业务逻辑，而不需要关心资源来自哪里、由谁实现等问题。</p>\n</li>\n<li><p>IoC 和 DI 其实是同一个概念从不同角度的描述的，由于控制反转这个概念比较含糊（可能只理解成了容器控制对象这一个层面，很难让人想到谁来维护对象关系），所以 2004 年被开发者尊称为“教父”的 Martin Fowler（世界顶级专家，敏捷开发方法的创始人之一）又给出了一个新的名字“依赖注入”，相对 IoC 而言，“依赖注入”明确描述了“被注入对象依赖 IoC 容器配置依赖对象”。</p>\n</li>\n</ul>\n<h4 id=\"依赖注入\"><a href=\"#依赖注入\" class=\"headerlink\" title=\"依赖注入\"></a>依赖注入</h4><ul>\n<li>平常的Java开发中，程序员在某个类中需要依赖其它类的方法。通常是new一个依赖类再调用类实例的方法，这种开发存在的问题是new的类实例不好统一管理。 Spring提出了依赖注入的思想，即依赖类不由程序员实例化，而是通过Spring容器帮我们new指定实例并且将实例注入到需要该对象的类中。依赖注入的另一种说法是”控制反转”。通俗的理解是：平常我们new一个实例，这个实例的控制权是我们程序员。而控制反转是指new实例工作不由我们程序员来做而是交给Spring容器来做。</li>\n<li>IOC对于Spring框架来说，就是由Spring来负责控制对象的生命周期和对象间的关系。</li>\n<li>所谓依赖注入，就是由IOC容器在运行期间，动态地将某种依赖关系注入到对象之中，所以，以来注入DI 和控制反转IOC 是从不同的角度描述的同一间事情，就是值通过引用IOC容器，利用以来关系注入的方式，实现对象之间的解耦。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/SpringIoc%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B.png\"></p>\n<h4 id=\"注入方式\"><a href=\"#注入方式\" class=\"headerlink\" title=\"注入方式\"></a>注入方式</h4><ul>\n<li>Set注入。</li>\n<li>构造方法注入。</li>\n<li>工厂的方法注入。</li>\n<li>通过属性注入。</li>\n<li>通过List注入。</li>\n<li>通过Map注入。</li>\n</ul>\n<h3 id=\"Spring-AOP\"><a href=\"#Spring-AOP\" class=\"headerlink\" title=\"Spring AOP\"></a>Spring AOP</h3><ul>\n<li><p>AOP(Aspect-Oriented Programming:⾯向切⾯编程)能够将那些与业务⽆关，却为业务模块所共同调⽤的逻辑或责任（例如事务处理、⽇志管理、权限控制等）封装起来，便于减少系统的重复代码，降低模块间的耦合度，并有利于未来的可拓展性和可维护性。</p>\n<ul>\n<li><strong>Spring AOP</strong>就是基于动态代理的，如果要代理的对象，实现了某个接⼝，那么Spring AOP会使⽤<strong>JDK</strong> Proxy，去创建代理对象，⽽对于没有实现接⼝的对象，就⽆法使⽤ JDK Proxy 去进⾏代理了，这时候Spring AOP会使⽤<strong>Cglib</strong> ，这时候Spring AOP会使⽤ <strong>Cglib</strong> ⽣成⼀个被代理对象的⼦类来作为代理。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/SpringAopProcess.png\"></p>\n<ul>\n<li>Spring Aop是运行时增强。</li>\n<li>Cglib Aop是编译器增强。</li>\n</ul>\n</li>\n<li><p>AOP专门用于处理系统中分布于各个模块中交叉关注点的问题，在JavaEE应用中，常常通过AOP来处理一些横切性质的系统级服务，如事物管理、安全检查、缓存对象池管理。</p>\n<ul>\n<li>1.）切面 -Aspect 切面类 比如日志类</li>\n<li>2.） 连接点 - Join Point 加入切点的那个点</li>\n<li>3.）通知 -Advice 是在切面某个特定的连接点上的动作。</li>\n<li>4.）切入点 - Point Cut 匹配连接点的断点</li>\n<li>5.）引入 - Introduction </li>\n<li>6.）目标对象 - Target Object 被一个或多个通知对象，永远被代理的对象。</li>\n<li>7.） AOP代理 - AOP Proxy AOP创建的对象用来实现切面对象。</li>\n<li>8.）织入 - Weaving </li>\n<li>9.）AOP通俗的理解：<ul>\n<li>一个组建A，不关心其他常用的服务组件B，但是这个组件A使用组件B的时候不是组建A自身去调用，而是通过配置等其他方式，比如Spring中可以通过XML配置文件。这样就使的A压根不需要知道服务组件B是怎么样的，A只关心自己的业务逻辑，具体A使用B的时候，配置文件去做，与具体的A组件无关。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Spring框架中的设计模式\"><a href=\"#Spring框架中的设计模式\" class=\"headerlink\" title=\"Spring框架中的设计模式\"></a>Spring框架中的设计模式</h3><ul>\n<li>工厂模式：BeanFactory就是简单工厂模式的体现，用来创建对象的实例</li>\n<li>单例模式：Bean默认为单例模式</li>\n<li>代理模式：Spring的AOP功能用到了JDK的动态代理和CGLIB字节码生成技术</li>\n<li>模板方法：用来解决代码重复的问题。比如. RestTemplate, JmsTemplate, JpaTemplate</li>\n<li>观察者模式：定义对象键一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都会得到通知被制动更新，如Spring中listener的实现–ApplicationListener，Spring 事件驱动模型就是观察者模式很经典的⼀个应⽤。</li>\n<li>适配器模式 :Spring AOP 的增强或通知(Advice)使⽤到了适配器模式、spring MVC 中也是⽤到了适配器模式适配 Controller 。</li>\n<li>策略模式： Bean的实例化的时候决定采用何种方式初始化bean实例（反射或者CGLIB动态字节码生成），Resource 接口是具体资源访问策略的抽象。</li>\n<li>装饰器模式：Spring中用到的包装器模式在类名上有两种表现：一种是类名中含有Wrapper，另一种是类名中含有Decorator。</li>\n<li>模版模式：Spring Template 都采用了该模式。</li>\n</ul>\n<h3 id=\"Spring中Autowired和Resource关键字\"><a href=\"#Spring中Autowired和Resource关键字\" class=\"headerlink\" title=\"Spring中Autowired和Resource关键字\"></a>Spring中Autowired和Resource关键字</h3><ul>\n<li>@Resource和@Autowired都是做bean的注入时使用，其实@Resource并不是Spring的注解，它的包是javax.annotation.Resource，需要导入，但是Spring支持该注解的注入。</li>\n<li>Autowired注解是按照类型（byType）装配依赖对象，默认情况下它要求依赖对象必须存在，如果允许null值，可以设置它的required属性为false。如果我们想使用按照名称（byName）来装配，可以结合@Qualififier注解一起使用：</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestServiceImpl</span> </span>&#123; </span><br><span class=\"line\">  <span class=\"comment\">// 下面两种@Autowired只要使用一种即可 </span></span><br><span class=\"line\">  <span class=\"meta\">@Autowired</span> </span><br><span class=\"line\">  <span class=\"keyword\">private</span> UserDao userDao; <span class=\"comment\">// 用于字段上 </span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"meta\">@Autowired</span>  <span class=\"comment\">// 用于属性的方法上</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserDao</span><span class=\"params\">(UserDao userDao)</span> </span></span><br><span class=\"line\"><span class=\"function\">  </span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.userDao = userDao; </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// @Autowired注解是按照类型（byType）装配依赖对象，默认情况下它要求依赖对象必须存在，如果允</span></span><br><span class=\"line\"><span class=\"comment\">// 许null值，可以设置它的required属性为false。如果我们想使用按照名称（byName）来装配，可以结</span></span><br><span class=\"line\"><span class=\"comment\">// 合@Qualifier注解一起使用。如下：</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestServiceImpl</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@Autowired</span> </span><br><span class=\"line\">  <span class=\"meta\">@Qualifier</span>(<span class=\"string\">\"userDao\"</span>) <span class=\"keyword\">private</span> UserDao userDao;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Resource默认按照ByName自动注入，由J2EE提供，需要导入包javax.annotation.Resource。@Resource有两个重要的属性：name和type，而Spring将@Resource注解的name属性解析为bean的名字，而type属性则解析为bean的类型。所以，如果使用name属性，则使用byName的自动注入策略，而使用type属性时则使用byType自动注入策略。如果既不制定name也不制定type属性，这时将通过反射机制使用byName自动注入策略。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestServiceImpl</span> </span>&#123; </span><br><span class=\"line\">  <span class=\"comment\">// 下面两种@Resource只要使用一种即可 </span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 用于字段上 </span></span><br><span class=\"line\">  <span class=\"meta\">@Resource</span>(name=<span class=\"string\">\"userDao\"</span>) </span><br><span class=\"line\">  <span class=\"keyword\">private</span> UserDao userDao; </span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 用于属性的setter方法上 </span></span><br><span class=\"line\">  <span class=\"meta\">@Resource</span>(name=<span class=\"string\">\"userDao\"</span>) </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserDao</span><span class=\"params\">(UserDao userDao)</span> </span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.userDao = userDao;</span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Bean注册方式\"><a href=\"#Bean注册方式\" class=\"headerlink\" title=\"Bean注册方式\"></a>Bean注册方式</h3><ul>\n<li>XML 配置文件的注册方式</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"person\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.beans.Person\"</span>&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"id\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"1\"</span>/&gt;</span></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"Java\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Java-注解的注册方式\"><a href=\"#Java-注解的注册方式\" class=\"headerlink\" title=\"Java 注解的注册方式\"></a>Java 注解的注册方式</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 可以使用 @Component 注解方式来注册 Bean</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">private</span> Integer id;</span><br><span class=\"line\">   <span class=\"keyword\">private</span> String name</span><br><span class=\"line\">   <span class=\"comment\">// 忽略其他方法</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// @Bean 注解方式来注册 Bean</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"meta\">@Bean</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> Person  <span class=\"title\">person</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   <span class=\"comment\">// 忽略其他方法</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Java-API-的注册方式\"><a href=\"#Java-API-的注册方式\" class=\"headerlink\" title=\"Java API 的注册方式\"></a>Java API 的注册方式</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用 BeanDefinitionRegistry.registerBeanDefinition() 方法的方式注册 Bean\t</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CustomBeanDefinitionRegistry</span> <span class=\"keyword\">implements</span> <span class=\"title\">BeanDefinitionRegistryPostProcessor</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">postProcessBeanFactory</span><span class=\"params\">(ConfigurableListableBeanFactory beanFactory)</span> <span class=\"keyword\">throws</span> BeansException </span>&#123;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">postProcessBeanDefinitionRegistry</span><span class=\"params\">(BeanDefinitionRegistry registry)</span> <span class=\"keyword\">throws</span> BeansException </span>&#123;</span><br><span class=\"line\">\t\tRootBeanDefinition personBean = <span class=\"keyword\">new</span> RootBeanDefinition(Person<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 新增 Bean</span></span><br><span class=\"line\">\t\tregistry.registerBeanDefinition(<span class=\"string\">\"person\"</span>, personBean);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h3 id=\"Spring-Bean-的作用域\"><a href=\"#Spring-Bean-的作用域\" class=\"headerlink\" title=\"Spring Bean 的作用域\"></a>Spring Bean 的作用域</h3><ul>\n<li>singleton <ul>\n<li>表示在 Spring 容器中只有一个 Bean 实例，以单例的形式存在，是默认的 Bean 作用域。</li>\n</ul>\n</li>\n<li>prototype<ul>\n<li>原型作用域，每次调用 Bean 时都会创建一个新实例，也就是说每次调用 getBean() 方法时，相当于执行了 new Bean()。</li>\n</ul>\n</li>\n<li>request<ul>\n<li>每次 Http 请求时都会创建一个新的 Bean，该作用域仅适应于 WebApplicationContext 环境。</li>\n</ul>\n</li>\n<li>session<ul>\n<li>同一个 Http Session 共享一个 Bean 对象，不同的 Session 拥有不同的 Bean 对象，仅适用于 WebApplicationContext 环境。</li>\n</ul>\n</li>\n<li>global session<ul>\n<li>全局session共享一个bean对象。</li>\n</ul>\n</li>\n<li>application<ul>\n<li>全局的 Web 作用域，类似于 Servlet 中的 Application。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"Spring-中的单例-bean-的线程安全问题\"><a href=\"#Spring-中的单例-bean-的线程安全问题\" class=\"headerlink\" title=\"Spring 中的单例 bean 的线程安全问题\"></a>Spring 中的单例 bean 的线程安全问题</h4><ul>\n<li>单例 bean 存在线程问题，主要是因为当多个线程操作同⼀个对象的时候，对这个对象的⾮静态成员变量的写操作会存在线程安全问题。在类中定义⼀个ThreadLocal成员变量，将需要的可变成员变量保存在 ThreadLocal 中（推荐的⼀种⽅式）。</li>\n</ul>\n<h3 id=\"Bean-生命周期\"><a href=\"#Bean-生命周期\" class=\"headerlink\" title=\"Bean 生命周期\"></a>Bean 生命周期</h3><ul>\n<li>对于 Spring Bean 来说，并不是启动阶段就会触发 Bean 的实例化，只有当客户端通过显式或者隐式的方式调用 BeanFactory 的 getBean() 方法时，它才会触发该类的实例化方法。当然对于 BeanFactory 来说，也不是所有的 getBean() 方法都会实例化 Bean 对象，例如作用域为 singleton 时，只会在第一次，实例化该 Bean 对象，之后会直接返回该对象。但如果使用的是ApplicationContext 容器，则会在该容器启动的时候，立即调用注册到该容器所有 Bean 的实例化方法。getBean() 方法是属于 BeanFactory 接口的，它的真正实现是AbstractAutowireCapableBeanFactory 的 createBean() 方法，而 createBean() 是通过 doCreateBean() 来实现的，具体源码实现。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/springBean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png\"></p>\n<ul>\n<li>实例化Bean<ul>\n<li>对于BeanFactory容器，当客户向容器请求一个尚未初始化的bean时，或初始化bean的时候需要注入另一个尚未初始化的依赖时，容器就会调用createBean进行实例化。对于ApplicationContext容器，当容器启动结束后，通过获取BeanDefifinition对象中的信息，实例化所有的bean。</li>\n</ul>\n</li>\n<li>设置对象属性（依赖注入）<ul>\n<li>实例化后的对象被封装在BeanWrapper对象中，紧接着，Spring根据BeanDefifinition中的信息 以及 通过BeanWrapper提供的设置属性的接口完成依赖注入。     </li>\n</ul>\n</li>\n<li>处理Aware接口<ul>\n<li>接着，Spring会检测该对象是否实现了xxxAware接口，并将相关的xxxAware实例注入给Bean。<ul>\n<li>如果这个Bean已经实现了BeanNameAware接口，会调用它实现的setBeanName(String beanId)方法，此处传递的就是Spring配置文件中Bean的id值。</li>\n<li>如果这个Bean已经实现了BeanFactoryAware接口，会调用它实现的setBeanFactory()方法，传递的是Spring工厂自身。</li>\n<li>如果这个Bean已经实现了ApplicationContextAware接口，会调用setApplicationContext(ApplicationContext)方法，传入Spring上下文。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>BeanPostProcessor<ul>\n<li>如果想对Bean进行一些自定义的处理，那么可以让Bean实现了BeanPostProcessor接口，那将会调用postProcessBeforeInitialization(Object obj, String s)方法。</li>\n</ul>\n</li>\n<li>InitializingBean 与 init-method<ul>\n<li>如果实现相关方法或者配置了 init-method则会自动调用其配置的初始化方法</li>\n</ul>\n</li>\n<li>BeanPostProcessor<ul>\n<li>如果这个Bean实现了BeanPostProcessor接口，将会调用postProcessAfterInitialization(Object obj, String s)方法；由于这个方法是在Bean初始化结束时调用的，所以可以被应用于内存或缓存技术。</li>\n</ul>\n</li>\n<li>getBean<ul>\n<li>可以正常使用这个bean了。</li>\n</ul>\n</li>\n<li>DisposableBean<ul>\n<li>当Bean不再需要时，会经过清理阶段，如果Bean实现了DisposableBean这个接口，会调用其实现的destroy()方法。</li>\n</ul>\n</li>\n<li>destroy-method<ul>\n<li>如果这个Bean的Spring配置中配置了destroy-method属性，会自动调用其配置的销毁方法。</li>\n</ul>\n</li>\n<li>精简下<ul>\n<li>实例化Bean： Ioc容器通过获取BeanDefinition对象中的信息进行实例化，实例化对象被包装在BeanWrapper对象中。</li>\n<li>设置对象属性（DI）：通过BeanWrapper提供的设置属性的接口完成属性依赖注入。</li>\n<li>注入Aware接口（BeanFactoryAware， 可以用这个方式来获取其它 Bean，ApplicationContextAware）：Spring会检测该对象是否实现了xxxAware接口，并将相关的xxxAware实例注入给bean。</li>\n<li>BeanPostProcessor：自定义的处理（分前置处理和后置处理）</li>\n<li>InitializingBean和init-method：执行我们自己定义的初始化方法使用</li>\n<li>destroy：bean的销毁</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Spring自动装配\"><a href=\"#Spring自动装配\" class=\"headerlink\" title=\"Spring自动装配\"></a>Spring自动装配</h3><blockquote>\n<p>SpringBoot 工程的启动类上都必须要加一个 @SpringBootApplication 注解，而且还要在 run 方法中导入我们的主类，我们就从这个被导入的主类上的注解开始分析。</p>\n</blockquote>\n<ul>\n<li>基于添加jar依赖自动对Spring Boot程序进行配置<ul>\n<li>spring-boot-autoconfiguration</li>\n</ul>\n</li>\n<li>开启自动装配<ul>\n<li>@EnableAutoConfiguration</li>\n<li>@SpringBootApplication</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BlogApplication</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(VueBlogApplication<span class=\"class\">.<span class=\"keyword\">class</span>, <span class=\"title\">args</span>)</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"SpringBootApplication\"><a href=\"#SpringBootApplication\" class=\"headerlink\" title=\"SpringBootApplication\"></a>SpringBootApplication</h4><blockquote>\n<p>@SpringBootApplication 注解是一个复合注解。除去 Java 的 4 个元注解外，分别是 @SpringBootConfiguration、@EnableAutoConfiguration、@ComponentScan</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target</span>(ElementType.TYPE)</span><br><span class=\"line\"><span class=\"meta\">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Inherited</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAutoConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan</span>(excludeFilters = &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Filter</span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter<span class=\"class\">.<span class=\"keyword\">class</span>),</span></span><br><span class=\"line\"><span class=\"class\">        @<span class=\"title\">Filter</span>(<span class=\"title\">type</span> </span>= FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter<span class=\"class\">.<span class=\"keyword\">class</span>) &#125;)</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">public</span> @<span class=\"title\">interface</span> <span class=\"title\">SpringBootApplication</span> </span>&#123;</span><br><span class=\"line\">   </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"SpringBootConfiguration\"><a href=\"#SpringBootConfiguration\" class=\"headerlink\" title=\"SpringBootConfiguration\"></a>SpringBootConfiguration</h4><blockquote>\n<p>@SpringBootConfiguration 注解本质是一个 @Configuration 注解，而 @Configuration 本质是一个 @Component 注解。</p>\n</blockquote>\n<ul>\n<li>@SpringBootConfiguration 注解的启动类，本质就是一个配置类（ConfigurationClass），此类中可以声明一个或者多个被 @Bean 注解标记的方法。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target</span>(ElementType.TYPE)</span><br><span class=\"line\"><span class=\"meta\">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> SpringBootConfiguration &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Target</span>(ElementType.TYPE)</span><br><span class=\"line\"><span class=\"meta\">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Configuration &#123;</span><br><span class=\"line\">    <span class=\"meta\">@AliasFor</span>(annotation = Component<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\">    String value() default \"\";</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"ComponentScan\"><a href=\"#ComponentScan\" class=\"headerlink\" title=\"ComponentScan\"></a>ComponentScan</h4><blockquote>\n<p>执行包的扫描，如果 useDefaultFilters 属性为 true，那么它会将被 @component 注解标记以及以 @component 为元注解的注解标记的类都扫描到 IOC 容器中去。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class=\"line\"><span class=\"meta\">@Target</span>(&#123;ElementType.TYPE&#125;)</span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Repeatable</span>(ComponentScans<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">public</span> @<span class=\"title\">interface</span> <span class=\"title\">ComponentScan</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"EnableAutoConfiguration\"><a href=\"#EnableAutoConfiguration\" class=\"headerlink\" title=\"EnableAutoConfiguration\"></a>EnableAutoConfiguration</h4><blockquote>\n<p>通过@Import注解将特定的类导入到容器中</p>\n</blockquote>\n<ul>\n<li>引入AutoConfigurationImportSelector</li>\n<li>读取META-INF/spring.factories</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target</span>(ElementType.TYPE)</span><br><span class=\"line\"><span class=\"meta\">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Inherited</span></span><br><span class=\"line\"><span class=\"meta\">@AutoConfigurationPackage</span></span><br><span class=\"line\"><span class=\"meta\">@Import</span>(AutoConfigurationImportSelector<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">public</span> @<span class=\"title\">interface</span> <span class=\"title\">EnableAutoConfiguration</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Return the auto-configuration class names that should be considered. By default</span></span><br><span class=\"line\"><span class=\"comment\">\t * this method will load candidates using &#123;<span class=\"doctag\">@link</span> SpringFactoriesLoader&#125; with</span></span><br><span class=\"line\"><span class=\"comment\">\t * &#123;<span class=\"doctag\">@link</span> #getSpringFactoriesLoaderFactoryClass()&#125;.</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> metadata the source metadata</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> attributes the &#123;<span class=\"doctag\">@link</span> #getAttributes(AnnotationMetadata) annotation</span></span><br><span class=\"line\"><span class=\"comment\">\t * attributes&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@return</span> a list of candidate configurations</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">protected</span> List&lt;String&gt; <span class=\"title\">getCandidateConfigurations</span><span class=\"params\">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> </span>&#123;</span><br><span class=\"line\">\t\tList&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(),</span><br><span class=\"line\">\t\t\t\tgetBeanClassLoader());</span><br><span class=\"line\">\t\tAssert.notEmpty(configurations, <span class=\"string\">\"No auto configuration classes found in META-INF/spring.factories. If you \"</span></span><br><span class=\"line\">\t\t\t\t+ <span class=\"string\">\"are using a custom packaging, make sure that file is correct.\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> configurations;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>AutoConfigurationImportSelector类中通过 SpringFactoriesLoader.loadFactoryNames() 去 classpath 下的 META-INF/spring.factories 中获取了所有需要自动装配的类，放入到了 IOC 容器中。</li>\n</ul>\n<p>![image-20211102145526599](/Users/zengqingfeng/Library/Application Support/typora-user-images/image-20211102145526599.png)</p>\n<ul>\n<li>默认的信息</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"># Logging Systems</span><br><span class=\"line\">org.springframework.boot.logging.LoggingSystemFactory=\\</span><br><span class=\"line\">org.springframework.boot.logging.logback.LogbackLoggingSystem.Factory,\\</span><br><span class=\"line\">org.springframework.boot.logging.log4j2.Log4J2LoggingSystem.Factory,\\</span><br><span class=\"line\">org.springframework.boot.logging.java.JavaLoggingSystem.Factory</span><br><span class=\"line\"></span><br><span class=\"line\"># PropertySource Loaders</span><br><span class=\"line\">org.springframework.boot.env.PropertySourceLoader=\\</span><br><span class=\"line\">org.springframework.boot.env.PropertiesPropertySourceLoader,\\</span><br><span class=\"line\">org.springframework.boot.env.YamlPropertySourceLoader</span><br><span class=\"line\"></span><br><span class=\"line\"># ConfigData Location Resolvers</span><br><span class=\"line\">org.springframework.boot.context.config.ConfigDataLocationResolver=\\</span><br><span class=\"line\">org.springframework.boot.context.config.ConfigTreeConfigDataLocationResolver,\\</span><br><span class=\"line\">org.springframework.boot.context.config.StandardConfigDataLocationResolver</span><br><span class=\"line\"></span><br><span class=\"line\"># ConfigData Loaders</span><br><span class=\"line\">org.springframework.boot.context.config.ConfigDataLoader=\\</span><br><span class=\"line\">org.springframework.boot.context.config.ConfigTreeConfigDataLoader,\\</span><br><span class=\"line\">org.springframework.boot.context.config.StandardConfigDataLoader</span><br><span class=\"line\"></span><br><span class=\"line\"># Run Listeners</span><br><span class=\"line\">org.springframework.boot.SpringApplicationRunListener=\\</span><br><span class=\"line\">org.springframework.boot.context.event.EventPublishingRunListener</span><br><span class=\"line\"></span><br><span class=\"line\"># Error Reporters</span><br><span class=\"line\">org.springframework.boot.SpringBootExceptionReporter=\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.FailureAnalyzers</span><br><span class=\"line\"></span><br><span class=\"line\"># Application Context Initializers</span><br><span class=\"line\">org.springframework.context.ApplicationContextInitializer=\\</span><br><span class=\"line\">org.springframework.boot.context.ConfigurationWarningsApplicationContextInitializer,\\</span><br><span class=\"line\">org.springframework.boot.context.ContextIdApplicationContextInitializer,\\</span><br><span class=\"line\">org.springframework.boot.context.config.DelegatingApplicationContextInitializer,\\</span><br><span class=\"line\">org.springframework.boot.rsocket.context.RSocketPortInfoApplicationContextInitializer,\\</span><br><span class=\"line\">org.springframework.boot.web.context.ServerPortInfoApplicationContextInitializer</span><br><span class=\"line\"></span><br><span class=\"line\"># Application Listeners</span><br><span class=\"line\">org.springframework.context.ApplicationListener=\\</span><br><span class=\"line\">org.springframework.boot.ClearCachesApplicationListener,\\</span><br><span class=\"line\">org.springframework.boot.builder.ParentContextCloserApplicationListener,\\</span><br><span class=\"line\">org.springframework.boot.context.FileEncodingApplicationListener,\\</span><br><span class=\"line\">org.springframework.boot.context.config.AnsiOutputApplicationListener,\\</span><br><span class=\"line\">org.springframework.boot.context.config.DelegatingApplicationListener,\\</span><br><span class=\"line\">org.springframework.boot.context.logging.LoggingApplicationListener,\\</span><br><span class=\"line\">org.springframework.boot.env.EnvironmentPostProcessorApplicationListener,\\</span><br><span class=\"line\">org.springframework.boot.liquibase.LiquibaseServiceLocatorApplicationListener</span><br><span class=\"line\"></span><br><span class=\"line\"># Environment Post Processors</span><br><span class=\"line\">org.springframework.boot.env.EnvironmentPostProcessor=\\</span><br><span class=\"line\">org.springframework.boot.cloud.CloudFoundryVcapEnvironmentPostProcessor,\\</span><br><span class=\"line\">org.springframework.boot.context.config.ConfigDataEnvironmentPostProcessor,\\</span><br><span class=\"line\">org.springframework.boot.env.RandomValuePropertySourceEnvironmentPostProcessor,\\</span><br><span class=\"line\">org.springframework.boot.env.SpringApplicationJsonEnvironmentPostProcessor,\\</span><br><span class=\"line\">org.springframework.boot.env.SystemEnvironmentPropertySourceEnvironmentPostProcessor,\\</span><br><span class=\"line\">org.springframework.boot.reactor.DebugAgentEnvironmentPostProcessor</span><br><span class=\"line\"></span><br><span class=\"line\"># Failure Analyzers</span><br><span class=\"line\">org.springframework.boot.diagnostics.FailureAnalyzer=\\</span><br><span class=\"line\">org.springframework.boot.context.config.ConfigDataNotFoundFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.context.properties.IncompatibleConfigurationFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.context.properties.NotConstructorBoundInjectionFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.BeanCurrentlyInCreationFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.BeanDefinitionOverrideFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.BeanNotOfRequiredTypeFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.BindFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.BindValidationFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.UnboundConfigurationPropertyFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.ConnectorStartFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.NoSuchMethodFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.NoUniqueBeanDefinitionFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.PortInUseFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.ValidationExceptionFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.InvalidConfigurationPropertyNameFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.InvalidConfigurationPropertyValueFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.analyzer.PatternParseFailureAnalyzer,\\</span><br><span class=\"line\">org.springframework.boot.liquibase.LiquibaseChangelogMissingFailureAnalyzer</span><br><span class=\"line\"></span><br><span class=\"line\"># Failure Analysis Reporters</span><br><span class=\"line\">org.springframework.boot.diagnostics.FailureAnalysisReporter=\\</span><br><span class=\"line\">org.springframework.boot.diagnostics.LoggingFailureAnalysisReporter</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Spring-SPI\"><a href=\"#Spring-SPI\" class=\"headerlink\" title=\"Spring SPI\"></a>Spring SPI</h4><blockquote>\n<p>SPI 全称为 Service Provider Interface，是一种服务发现机制。SPI 的本质是将接口实现类的全限定名配置在文件中，并由服务加载器读取配置文件，加载实现类。</p>\n</blockquote>\n<ul>\n<li>Spring 的 SPI 配置文件是一个固定的文件 - <code>META-INF/spring.factories</code>，功能上和 JDK 的类似，每个接口可以有多个扩展实现，使用起来非常简单：</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//获取所有factories文件中配置的LoggingSystemFactory</span></span><br><span class=\"line\">List&lt;LoggingSystemFactory&gt;&gt; factories = </span><br><span class=\"line\">    SpringFactoriesLoader.loadFactories(LoggingSystemFactory<span class=\"class\">.<span class=\"keyword\">class</span>, <span class=\"title\">classLoader</span>)</span>;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Spring循环依赖\"><a href=\"#Spring循环依赖\" class=\"headerlink\" title=\"Spring循环依赖\"></a>Spring循环依赖</h3><blockquote>\n<p>当bean的作用域是Prototype的是不支持循环依赖的。不然会出现套娃，</p>\n</blockquote>\n<ul>\n<li>可能出现的依赖场景<ul>\n<li>构造器循环依赖</li>\n<li>属性注入循环依赖</li>\n</ul>\n</li>\n<li>Spring维护了三个Map，所谓的三级缓存。<ul>\n<li>singletonObjects：第一级缓存，里面放置的是实例化好的单例对象</li>\n<li>earlySingletonObjects：第二级缓存，里面存放的是提前曝光的单例对象。</li>\n<li>singletonFactories：第三级缓存，里面存放的是要被实例化的对象的对象工厂。</li>\n<li>创建bean的时候Spring首先从一级缓存singletonObjects中获取。如果获取不到，并且对象正在创建中，就再从二级缓存earlySingletonObjects中获取，如果还是获取不到就从三级缓存singletonFactories中取（Bean调用构造函数进行实例化后，即使属性还未填充，就可以通过三级缓存向外提前暴露依赖的引用值（提前曝光），根据对象引用能定位到堆中的对象，其原理是基于Java的引用传递），取到后从三级缓存移动到了二级缓存完全初始化之后将自己放入到一级缓存中供其他使用，因为加入singletonFactories三级缓存的前提是执行了构造器，所以构造器的循环依赖没法解决。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DefaultSingletonBeanRegistry</span> <span class=\"keyword\">extends</span> <span class=\"title\">SimpleAliasRegistry</span> <span class=\"keyword\">implements</span> <span class=\"title\">SingletonBeanRegistry</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * 一级缓存</span></span><br><span class=\"line\"><span class=\"comment\">     * singletonObjects 这就是人们常说的单例池，从微观意义上来说，这就是我们的 Spring 容器，</span></span><br><span class=\"line\"><span class=\"comment\">     * 它用于存放完全初始化好的 bean，从缓存中取出的 bean 可以直接使用。</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Map&lt;String, Object&gt; singletonObjects = <span class=\"keyword\">new</span> ConcurrentHashMap&lt;&gt;(<span class=\"number\">256</span>);</span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * 三级缓存</span></span><br><span class=\"line\"><span class=\"comment\">     * 存放 bean 工厂对象，提前曝光引用，解决循环依赖，虽然这个对象不完整，但是已经可以根据引用定位到堆内存中的对象，</span></span><br><span class=\"line\"><span class=\"comment\">     * 此对象可能是通过构造方法创建，还没装配属性。</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class=\"keyword\">new</span> HashMap&lt;&gt;(<span class=\"number\">16</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * 二级缓存</span></span><br><span class=\"line\"><span class=\"comment\">     * 存放原始的 bean 对象用于解决循环依赖，存到里面的对象还没有被填充属性。</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class=\"keyword\">new</span> HashMap&lt;&gt;(<span class=\"number\">16</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/** Names of beans that are currently in creation */</span></span><br><span class=\"line\">    <span class=\"comment\">// 标记为正在创建的 bean 的集合(A 依赖于 B，实例化 A 的过程中发现依赖 B，就去创建 B，那么 A 就会放在此集合中)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Set&lt;String&gt; singletonsCurrentlyInCreation =</span><br><span class=\"line\">            Collections.newSetFromMap(<span class=\"keyword\">new</span> ConcurrentHashMap&lt;&gt;(<span class=\"number\">16</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>首先尝试去从一级缓存 singletonObjects 单例池中去获取，没有获取到并且要获取的 Bean 正在创建中，再去查找二级缓存 earlySingletonObjects，如果还是没有找到，就再去三级缓存 singletonFactories 中去找，找到了就从三级缓存 singletonFactories 中移除，放入到二级缓存 earlySingletonObjects 中去，这样做的好处就是，如果还有其他对象尝试获取这个 Bean，那么可以直接从二级缓存中取出来，就不需要再调用 getEarlyBeanReference() 方法了。最终，创建好的 Bean，全部 put 到了单例池 singletonObjects 中了。</p>\n</li>\n<li><p>如何解决循环依赖</p>\n<ul>\n<li>构造器循环依赖解决办法：在构造函数中使用@Lazy注解延迟加载。在注入依赖时，先注入代理对象，当首次使用时再创建对象说明：一种互斥的关系而非层次递进的关系，故称为三个Map而非三级缓存的缘由 完成注入；</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Spring中Filter和Interceptor的区别\"><a href=\"#Spring中Filter和Interceptor的区别\" class=\"headerlink\" title=\"Spring中Filter和Interceptor的区别\"></a>Spring中Filter和Interceptor的区别</h3><ul>\n<li>Filter是基于函数回调（doFilter()方法）的，而Interceptor则是基于Java反射的（AOP思想）。</li>\n<li>Filter依赖于Servlet容器，而Interceptor不依赖于Servlet容器。</li>\n<li>Filter对几乎所有的请求起作用，而Interceptor只能对action请求起作用。</li>\n<li>Interceptor可以访问Action的上下文，值栈里的对象，而Filter不能。</li>\n<li>在action的生命周期里，Interceptor可以被多次调用，而Filter只能在容器初始化时调用一次。</li>\n<li>Filter在过滤是只能对request和response进行操作，而interceptor可以对request、response、handler、modelAndView、exception进行操作。</li>\n<li>interceptor 的执行顺序大致为：<ul>\n<li>请求到达 DispatcherServlet</li>\n<li>DispatcherServlet 发送至 Interceptor ，执行 preHandle</li>\n<li>请求达到 Controller</li>\n<li>请求结束后，postHandle 执行</li>\n</ul>\n</li>\n<li>Spring 中主要通过 HandlerInterceptor 接口来实现请求的拦截，实现 HandlerInterceptor 接口需要实现下面三个方法：<ul>\n<li><strong>preHandle()</strong> – 在handler执行之前，返回 boolean 值，true 表示继续执行，false 为停止执行并返回。</li>\n<li><strong>postHandle()</strong> – 在handler执行之后, 可以在返回之前对返回的结果进行修改</li>\n<li><strong>afterCompletion()</strong> – 在请求完全结束后调用，可以用来统计请求耗时等等</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.log4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.handler.HandlerInterceptorAdapter;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExecuteTimeInterceptor</span> <span class=\"keyword\">extends</span> <span class=\"title\">HandlerInterceptorAdapter</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger logger = Logger.getLogger(ExecuteTimeInterceptor<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//before the actual handler will be executed</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">preHandle</span><span class=\"params\">(HttpServletRequest request,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tHttpServletResponse response, Object handler)</span></span></span><br><span class=\"line\"><span class=\"function\">\t\t<span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">long</span> startTime = System.currentTimeMillis();</span><br><span class=\"line\">\t\trequest.setAttribute(<span class=\"string\">\"startTime\"</span>, startTime);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//after the handler is executed</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">postHandle</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tHttpServletRequest request, HttpServletResponse response,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\tObject handler, ModelAndView modelAndView)</span></span></span><br><span class=\"line\"><span class=\"function\">\t\t<span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">long</span> startTime = (Long)request.getAttribute(<span class=\"string\">\"startTime\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">long</span> endTime = System.currentTimeMillis();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">long</span> executeTime = endTime - startTime;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">//modified the exisitng modelAndView</span></span><br><span class=\"line\">\t\tmodelAndView.addObject(<span class=\"string\">\"executeTime\"</span>,executeTime);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">//log it</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(logger.isDebugEnabled())&#123;</span><br><span class=\"line\">\t\t   logger.debug(<span class=\"string\">\"[\"</span> + handler + <span class=\"string\">\"] executeTime : \"</span> + executeTime + <span class=\"string\">\"ms\"</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Servlet 的 Filter 接口需要实现如下方法：<ul>\n<li><code>void init(FilterConfig paramFilterConfig)</code> – 当容器初始化 Filter 时调用，该方法在 Filter 的生命周期只会被调用一次，一般在该方法中初始化一些资源，FilterConfig 是容器提供给 Filter 的初始化参数，在该方法中可以抛出 ServletException 。init 方法必须执行成功，否则 Filter 可能不起作用，出现以下两种情况时，web 容器中 Filter 可能无效： 1）抛出 ServletException 2）超过 web 容器定义的执行时间。</li>\n<li><code>doFilter(ServletRequest paramServletRequest, ServletResponse paramServletResponse, FilterChain paramFilterChain)</code> – Web 容器每一次请求都会调用该方法。该方法将容器的请求和响应作为参数传递进来， FilterChain 用来调用下一个 Filter。</li>\n<li><code>void destroy()</code> – 当容器销毁 Filter 实例时调用该方法，可以在方法中销毁资源，该方法在 Filter 的生命周期只会被调用一次。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Spring-事务\"><a href=\"#Spring-事务\" class=\"headerlink\" title=\"Spring 事务\"></a>Spring 事务</h3><h4 id=\"Spring的事物抽象\"><a href=\"#Spring的事物抽象\" class=\"headerlink\" title=\"Spring的事物抽象\"></a>Spring的事物抽象</h4><ul>\n<li><p>Spring事物的特性</p>\n<ul>\n<li>隔离级别<ul>\n<li>处理并发事务带来的问题</li>\n</ul>\n</li>\n<li>事物传播<ul>\n<li>处理业务代码互相调用事物问题</li>\n</ul>\n</li>\n<li>事物回滚<ul>\n<li>处理业务失败会滚业务事物问题</li>\n</ul>\n</li>\n<li>事物超时<ul>\n<li>处理事物允许的执行时间问题</li>\n</ul>\n</li>\n<li>是否只读<ul>\n<li>据说可以只读提高事物执行效率</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>事物开启方式</p>\n<ul>\n<li>编程式事务 代码中硬编码开启事物。</li>\n<li>声明式事务<ul>\n<li>基于注解开启事物。</li>\n<li>基于xml配置文件开启事物。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"Spring-事务中的隔离级别\"><a href=\"#Spring-事务中的隔离级别\" class=\"headerlink\" title=\"Spring 事务中的隔离级别\"></a>Spring 事务中的隔离级别</h4><blockquote>\n<p><strong>TransactionDefinition</strong> 接⼝中定义了五个表示隔离级别的常量：</p>\n</blockquote>\n<ul>\n<li><p><strong>TransactionDefinition.ISOLATION_DEFAULT:</strong> 使⽤后端数据库默认的隔离级别，Mysql 默认采⽤的 REPEATABLE_READ隔离级别 Oracle 默认采⽤的 READ_COMMITTED隔离级别。</p>\n</li>\n<li><p><strong>TransactionDefinition.ISOLATION_READ_UNCOMMITTED:</strong> 最低的隔离级别，允许读取尚未提交的阻⽌脏读，但是幻读或不可重复读仍有可能发⽣。</p>\n</li>\n<li><p><strong>TransactionDefinition.ISOLATION_READ_COMMITTED:</strong> 允许读取并发事务已经提交的数据，可以阻⽌脏读，但是幻读或不可重复读仍有可能发⽣。</p>\n</li>\n<li><p><strong>TransactionDefinition.ISOLATION_REPEATABLE_READ:</strong> 对同⼀字段的多次读取结果都是⼀致的，除⾮数据是被本身事务⾃⼰所修改，可以阻⽌脏读和不可重复读，但幻读仍有可能发⽣。</p>\n</li>\n<li><p><strong>TransactionDefinition.ISOLATION_SERIALIZABLE:</strong> 最⾼的隔离级别，完全服从ACID的隔离级别。所有的事务依次逐个执⾏，这样事务之间就完全不可能产⽣⼲扰，也就是说，该级别可以防⽌脏读、不可重复读以及幻读。但是这将严重影响程序的性能。通常情况下也不会⽤到该级别。</p>\n</li>\n</ul>\n<h4 id=\"Spring-事务中事务传播⾏为\"><a href=\"#Spring-事务中事务传播⾏为\" class=\"headerlink\" title=\"Spring 事务中事务传播⾏为\"></a>Spring 事务中事务传播⾏为</h4><ul>\n<li>⽀持当前事务的情况：<ul>\n<li><strong>TransactionDefinition.PROPAGATION_REQUIRED</strong>： 如果当前存在事务，则加⼊该事务；如果当前没有事务，则创建⼀个新的事务。</li>\n<li><strong>TransactionDefinition.PROPAGATION_SUPPORTS</strong>： 如果当前存在事务，则加⼊该事务；如果当前没有事务，则以⾮事务的⽅式继续运⾏。</li>\n<li><strong>TransactionDefinition.PROPAGATION_MANDATORY</strong>： 如果当前存在事务，则加⼊该事务；如果当前没有事务，则抛出异常。（mandatory：强制性）</li>\n</ul>\n</li>\n<li>不⽀持当前事务的情况：<ul>\n<li><strong>TransactionDefinition.PROPAGATION_REQUIRES_NEW</strong>： 创建⼀个新的事务，如果当前存在事务，则把当前事务挂起。</li>\n<li><strong>TransactionDefinition.PROPAGATION_NOT_SUPPORTED</strong>： 以⾮事务⽅式运⾏，如果当前存在事务，则把当前事务挂起。</li>\n<li><strong>TransactionDefinition.PROPAGATION_NEVER</strong>： 以⾮事务⽅式运⾏，如果当前存在事务，则抛出异常。</li>\n</ul>\n</li>\n<li>其他情况：<ul>\n<li><strong>TransactionDefinition.PROPAGATION_NESTED</strong>： 如果当前存在事务，则创建⼀个事务作为当前事务的嵌套事务来运⾏；如果当前没有事务，则该取值等价于TransactionDefinition.PROPAGATION_REQUIRED。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"TransactionStatus接口介绍\"><a href=\"#TransactionStatus接口介绍\" class=\"headerlink\" title=\"TransactionStatus接口介绍\"></a>TransactionStatus接口介绍</h4><ul>\n<li>TransactionStatus接口用来记录事务的状态 该接口定义了一组方法,用来获取或判断事务的相应状态信息.</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">TransactionStatus</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isNewTransaction</span><span class=\"params\">()</span></span>; <span class=\"comment\">// 是否是新的事物</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">hasSavepoint</span><span class=\"params\">()</span></span>; <span class=\"comment\">// 是否有恢复点</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setRollbackOnly</span><span class=\"params\">()</span></span>;  <span class=\"comment\">// 设置为只回滚</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isRollbackOnly</span><span class=\"params\">()</span></span>; <span class=\"comment\">// 是否为只回滚</span></span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> isCompleted; <span class=\"comment\">// 是否已完成</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Spring-Boot-启动流程\"><a href=\"#Spring-Boot-启动流程\" class=\"headerlink\" title=\"Spring Boot 启动流程\"></a>Spring Boot 启动流程</h3><blockquote>\n<p>Spring Boot 程序的入口是 SpringApplication.run(Application.class, args) 方法</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ConfigurableApplicationContext <span class=\"title\">run</span><span class=\"params\">(String... args)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 1.创建并启动计时监控类</span></span><br><span class=\"line\">    StopWatch stopWatch = <span class=\"keyword\">new</span> StopWatch();</span><br><span class=\"line\">    stopWatch.start();</span><br><span class=\"line\">    <span class=\"comment\">// 2.声明应用上下文对象和异常报告集合</span></span><br><span class=\"line\">    ConfigurableApplicationContext context = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">    <span class=\"comment\">// 3.设置系统属性 headless 的值</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.configureHeadlessProperty();</span><br><span class=\"line\">    <span class=\"comment\">// 4.创建所有 Spring 运行监听器并发布应用启动事件</span></span><br><span class=\"line\">    SpringApplicationRunListeners listeners = <span class=\"keyword\">this</span>.getRunListeners(args);</span><br><span class=\"line\">    listeners.starting();</span><br><span class=\"line\">    Collection exceptionReporters;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 5.处理 args 参数</span></span><br><span class=\"line\">        ApplicationArguments applicationArguments = <span class=\"keyword\">new</span> DefaultApplicationArguments(args);</span><br><span class=\"line\">        <span class=\"comment\">// 6.准备环境</span></span><br><span class=\"line\">        ConfigurableEnvironment environment = <span class=\"keyword\">this</span>.prepareEnvironment(listeners, applicationArguments);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.configureIgnoreBeanInfo(environment);</span><br><span class=\"line\">        <span class=\"comment\">// 7.创建 Banner 的打印类</span></span><br><span class=\"line\">        Banner printedBanner = <span class=\"keyword\">this</span>.printBanner(environment);</span><br><span class=\"line\">        <span class=\"comment\">// 8.创建应用上下文</span></span><br><span class=\"line\">        context = <span class=\"keyword\">this</span>.createApplicationContext();</span><br><span class=\"line\">        <span class=\"comment\">// 9.实例化异常报告器</span></span><br><span class=\"line\">        exceptionReporters = this.getSpringFactoriesInstances(SpringBootExceptionReporter.class, new Class[]&#123;ConfigurableApplicationContext.class&#125;, context);</span><br><span class=\"line\">        <span class=\"comment\">// 10.准备应用上下文</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.prepareContext(context, environment, listeners, applicationArguments, printedBanner);</span><br><span class=\"line\">        <span class=\"comment\">// 11.刷新应用上下文</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.refreshContext(context);</span><br><span class=\"line\">        <span class=\"comment\">// 12.应用上下文刷新之后的事件的处理</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.afterRefresh(context, applicationArguments);</span><br><span class=\"line\">        <span class=\"comment\">// 13.停止计时监控类</span></span><br><span class=\"line\">        stopWatch.stop();</span><br><span class=\"line\">        <span class=\"comment\">// 14.输出日志记录执行主类名、时间信息</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.logStartupInfo) &#123;</span><br><span class=\"line\">            (<span class=\"keyword\">new</span> StartupInfoLogger(<span class=\"keyword\">this</span>.mainApplicationClass)).logStarted(<span class=\"keyword\">this</span>.getApplicationLog(), stopWatch);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 15.发布应用上下文启动完成事件</span></span><br><span class=\"line\">        listeners.started(context);</span><br><span class=\"line\">        <span class=\"comment\">// 16.执行所有 Runner 运行器</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.callRunners(context, applicationArguments);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Throwable var10) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.handleRunFailure(context, var10, exceptionReporters, listeners);</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(var10);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 17.发布应用上下文就绪事件</span></span><br><span class=\"line\">        listeners.running(context);</span><br><span class=\"line\">        <span class=\"comment\">// 18.返回应用上下文对象</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> context;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Throwable var9) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.handleRunFailure(context, var9, exceptionReporters, (SpringApplicationRunListeners)<span class=\"keyword\">null</span>);</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(var9);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>Spring Boot 的启动流程</p>\n<ul>\n<li><p>1、创建并启动计时监控类</p>\n<ul>\n<li>此计时器是为了监控并记录 Spring Boot 应用启动的时间的，它会记录当前任务的名称，然后开启计时器。</li>\n</ul>\n</li>\n<li><p>2.声明应用上下文对象和异常报告集合</p>\n<ul>\n<li>此过程声明了应用上下文对象和一个异常报告的 ArrayList 集合。</li>\n</ul>\n</li>\n<li><p>3.设置系统属性 headless 的值</p>\n<ul>\n<li>设置 Java.awt.headless = true，其中 awt（Abstract Window Toolkit）的含义是抽象窗口工具集。设置为 true 表示运行一个 headless 服务器，可以用它来作一些简单的图像处理。</li>\n</ul>\n</li>\n<li><p>4.创建所有 Spring 运行监听器并发布应用启动事件</p>\n<ul>\n<li>此过程用于获取配置的监听器名称并实例化所有的类。</li>\n</ul>\n</li>\n<li><p>5.初始化默认应用的参数类</p>\n<ul>\n<li>也就是说声明并创建一个应用参数对象。</li>\n</ul>\n</li>\n<li><p>6.准备环境</p>\n<ul>\n<li>创建配置并且绑定环境（通过 property sources 和 profiles 等配置文件）。</li>\n</ul>\n</li>\n<li><p>7.创建 Banner 的打印类</p>\n<ul>\n<li>就是出个那个logo也可以自己定义。</li>\n</ul>\n</li>\n<li><p>8.创建应用上下文</p>\n<ul>\n<li>根据不同的应用类型来创建不同的 ApplicationContext 上下文对象。</li>\n</ul>\n</li>\n<li><p>9.实例化异常报告器</p>\n<ul>\n<li>它调用的是 getSpringFactoriesInstances() 方法来获取配置异常类的名称，并实例化所有的异常处理类。</li>\n</ul>\n</li>\n<li><p>10.准备应用上下文</p>\n<ul>\n<li>此方法的主要作用是把上面已经创建好的对象，传递给 prepareContext 来准备上下文，例如将环境变量 environment 对象绑定到上下文中、配置 bean 生成器以及资源加载器、记录启动日志等操作。</li>\n</ul>\n</li>\n<li><p>11.刷新应用上下文</p>\n<ul>\n<li>此方法用于解析配置文件，加载 bean 对象，并且启动内置的 web 容器等操作。</li>\n</ul>\n</li>\n<li><p>12.应用上下文刷新之后的事件处理</p>\n<ul>\n<li>这个方法的源码是空的，可以做一些自定义的后置处理操作。</li>\n</ul>\n</li>\n<li><p>13.停止计时监控类</p>\n<ul>\n<li>停止此过程第一步中的程序计时器，并统计任务的执行信息。</li>\n</ul>\n</li>\n<li><p>14.输出日志信息</p>\n<ul>\n<li>把相关的记录信息，如类名、时间等信息进行控制台输出。</li>\n</ul>\n</li>\n<li><p>15.发布应用上下文启动完成事件</p>\n<ul>\n<li>触发所有 SpringApplicationRunListener 监听器的 started 事件方法。</li>\n</ul>\n</li>\n<li><p>16.执行所有 Runner 运行器</p>\n<ul>\n<li>执行所有的 ApplicationRunner 和 CommandLineRunner 运行器。</li>\n</ul>\n</li>\n<li><p>17.发布应用上下文就绪事件</p>\n<ul>\n<li>触发所有的 SpringApplicationRunListener 监听器的 running 事件。</li>\n</ul>\n</li>\n<li><p>18.返回应用上下文对象</p>\n<ul>\n<li>到此为止 Spring Boot 的启动程序就结束了。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Spring代理\"><a href=\"#Spring代理\" class=\"headerlink\" title=\"Spring代理\"></a>Spring代理</h3><ul>\n<li>动态代理<ul>\n<li>在程序运行时利用反射动态创建代理对象&lt;复用性，易用性，更加集中都调用invoke。</li>\n</ul>\n</li>\n<li>静态代理<ul>\n<li>程序运行前代理类的.class文件就存在了。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"Spring中获取代理对象\"><a href=\"#Spring中获取代理对象\" class=\"headerlink\" title=\"Spring中获取代理对象\"></a>Spring中获取代理对象</h4><blockquote>\n<p>spring中获取代理对象的三种方式：</p>\n</blockquote>\n<ol>\n<li>直接autowire基于接口注入。</li>\n<li><code>@Autowire applicationcontext</code>，通过applicationcontext.getbean获取代理对象。</li>\n<li>通过<code>aopcontext.currentproxy</code>方法获取(注意：需要启动类上增加注解<code>@enableaspectjautoproxy(exposeproxy=true))；</code></li>\n</ol>\n<ul>\n<li>如果spring启动时循环依赖导致报错，可以通过依赖注入属性增加@lazy注解解决。</li>\n</ul>\n<h3 id=\"JDK-Proxy-和-CGLib-有什么区别\"><a href=\"#JDK-Proxy-和-CGLib-有什么区别\" class=\"headerlink\" title=\"JDK Proxy 和 CGLib 有什么区别\"></a>JDK Proxy 和 CGLib 有什么区别</h3><ul>\n<li>JDK Proxy <ul>\n<li>JDK Proxy 是 Java 语言自带的功能，无需通过加载第三方类实现。</li>\n<li>JDK Proxy 是通过拦截器加反射的方式实现的；</li>\n<li>JDK Proxy 只能代理继承接口的类；</li>\n</ul>\n</li>\n<li>CGLib <ul>\n<li>CGLib 是第三方提供的工具，基于 ASM 实现的，性能比较高；</li>\n<li>CGLib 无需通过接口来实现，它是通过实现子类的方式来完成调用的。</li>\n</ul>\n</li>\n</ul>\n","categories":["查缺补漏"],"tags":["Java","Spring"]},{"title":"查缺补漏-SpringMvc","url":"/posts/399195402/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h3 id=\"描述下Controller和RequestMapping注解。\"><a href=\"#描述下Controller和RequestMapping注解。\" class=\"headerlink\" title=\"描述下Controller和RequestMapping注解。\"></a>描述下Controller和RequestMapping注解。</h3><ul>\n<li><p>Controller</p>\n<ul>\n<li>声明在类上，该注解表明该类扮演控制器的角色，类似Action。</li>\n</ul>\n</li>\n<li><p>RequestMapping</p>\n<ul>\n<li>该注解是用来映射一个URL到一个类或一个特定的方处理法上。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"描述下Spring的作用域以及使用方法。\"><a href=\"#描述下Spring的作用域以及使用方法。\" class=\"headerlink\" title=\"描述下Spring的作用域以及使用方法。\"></a>描述下Spring的作用域以及使用方法。</h3><ul>\n<li>当定义一个Bean时，可以给这个Bean声明一个作用域。通过@Scope注解声明在类上。<ul>\n<li>Bean默认作用域是singleton 单例模式，在每个Spring Ioc容器中的一个Bean定义一个实例，也就是无状态Bean，也就是线程不安全的。这个单一实例会被存储到单例缓存（singleton cache）中，并且所有针对该bean的后续请求、访问和引用都将返回被缓存的对象实例。相当于一次创建多次使用。</li>\n<li>prototype 原型模式，在每个Spring Ioc容器中的一个Bean定义多实例，就相当与Java 中new 操作。通常作为有状态的Bean。Prototype作用域的bean会导致在每次对该bean请求（将其注入到另一个bean中，或者以程序的方式调用容器的getBean()方法）时都会创建一个新的bean实例。</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><p>其它作用域。</p>\n<ul>\n<li>request、session、global session 仅在基于web的应用中使用（不必关心你所采用的是什么web应用框架）。<ul>\n<li>如果不是在web下实现而是通过ApplicationContext这种实现，尝试使用这些作用域将抛出异常IllegalStateException未知作用域。</li>\n<li>request 对每一次HTTP请求都会产生一个新的bean。Spring容器会根据loginAction bean定义创建一个全新的LoginAction bean实例，且该loginAction bean实例仅在当前HTTP request内有效，因此可以根据需要放心的更改所建实例的内部状态，而其他请求中根据loginAction bean定义创建的实例，将不会看到这些特定于某个请求的状态变化。当处理请求结束，request作用域的bean实例将被销毁。</li>\n<li>session 对每一次HTTP请求都会产生一个新的bean，Spring容器会根据userPreferences bean定义创建一个全新的userPreferences bean实例，且该userPreferences bean仅在当前HTTP Session内有效。与request作用域一样，你可以根据需要放心的更改所创建实例的内部状态，而别的HTTP Session中根据userPreferences创建的实例，将不会看到这些特定于某个HTTP Session的状态变化。当HTTP Session最终被废弃的时候，在该HTTP Session作用域内的bean也会被废弃掉。</li>\n<li>‍global session 作用域类似于标准的HTTP Session作用域，不过它仅仅在基于portlet的web应用中才有意义。Portlet规范定义了全局Session的概念，它被所有构成某个portlet web应用的各种不同的portlet所共享。在global session作用域中定义的bean被限定于全局portlet Session的生命周期范围内。在一个标准的基于Servlet的web应用，并且定义了一个或多个具有global session作用域的bean，系统会使用标准的HTTP Session作用域，并且不会引起任何错误。</li>\n</ul>\n</li>\n<li>作用域依赖<ul>\n<li>Spring IoC容器除了管理对象（bean）的实例化，同时还负责协作者（或者叫依赖）的实例化。如果将一个Http request范围的bean注入到另一个bean中，那么需要注入一个AOP代理来替代被注入的作用域bean。也就是说需要注入一个代理对象，该对象具有与被代理对象一样的公共接口，而容器则可以足够智能的从相关作用域中（比如一个HTTP request）获取到真实的目标对象，并把方法调用委派给实际的对象。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"SpringMVc中Restfull风格的使用。\"><a href=\"#SpringMVc中Restfull风格的使用。\" class=\"headerlink\" title=\"SpringMVc中Restfull风格的使用。\"></a>SpringMVc中Restfull风格的使用。</h3><ul>\n<li>restfull 支持的请求头GET, HEAD, POST, PUT, PATCH, DELETE, OPTIONS, TRACE 。</li>\n<li>通常情况下只使用 GET,PUT,POST,DELETE。<ul>\n<li>GET 通常用来获取数据。</li>\n<li>PUT 通常用来新增数据。</li>\n<li>POST 通常用来更新数据。</li>\n<li>DELETE 通常用来删除数据。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"/get\"</span>, method = RequestMethod.GET)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">get</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"string\">\"200\"</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"/post\"</span>, method = RequestMethod.POST)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">post</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"string\">\"200\"</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"/delete\"</span>, method = RequestMethod.DELETE)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">delete</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"string\">\"200\"</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"/put\"</span>, method = RequestMethod.PUT)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">put</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"string\">\"200\"</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"SpringMvc的处理流程\"><a href=\"#SpringMvc的处理流程\" class=\"headerlink\" title=\"SpringMvc的处理流程\"></a>SpringMvc的处理流程</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/SpringMvc%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B.png\"></p>\n<a id=\"more\"></a>\n\n<ul>\n<li>源码分析</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/DispatcherServletUML.png\"></p>\n<ul>\n<li>DispatcherServlet是继承了FrameworkServlet，而FrameworkServlet又继承了HttpServletBean。追溯到最上层其实就是Servlet。通过源码可以发现最核心的一个方法<code>doService()</code>。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Exposes the DispatcherServlet-specific request attributes and delegates to &#123;<span class=\"doctag\">@link</span> #doDispatch&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\t * for the actual dispatching.</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doService</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t\tlogRequest(request);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Keep a snapshot of the request attributes in case of an include,</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// to be able to restore the original attributes after the include.</span></span><br><span class=\"line\">\t\tMap&lt;String, Object&gt; attributesSnapshot = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (WebUtils.isIncludeRequest(request)) &#123;</span><br><span class=\"line\">\t\t\tattributesSnapshot = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">\t\t\tEnumeration&lt;?&gt; attrNames = request.getAttributeNames();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> (attrNames.hasMoreElements()) &#123;</span><br><span class=\"line\">\t\t\t\tString attrName = (String) attrNames.nextElement();</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.cleanupAfterInclude || attrName.startsWith(DEFAULT_STRATEGIES_PREFIX)) &#123;</span><br><span class=\"line\">\t\t\t\t\tattributesSnapshot.put(attrName, request.getAttribute(attrName));</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Make framework objects available to handlers and view objects.</span></span><br><span class=\"line\">\t\trequest.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());</span><br><span class=\"line\">\t\trequest.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, <span class=\"keyword\">this</span>.localeResolver);</span><br><span class=\"line\">\t\trequest.setAttribute(THEME_RESOLVER_ATTRIBUTE, <span class=\"keyword\">this</span>.themeResolver);</span><br><span class=\"line\">\t\trequest.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource());</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.flashMapManager != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tFlashMap inputFlashMap = <span class=\"keyword\">this</span>.flashMapManager.retrieveAndUpdate(request, response);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (inputFlashMap != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\trequest.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\trequest.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, <span class=\"keyword\">new</span> FlashMap());</span><br><span class=\"line\">\t\t\trequest.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, <span class=\"keyword\">this</span>.flashMapManager);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">//进入doDispatch</span></span><br><span class=\"line\">\t\t\tdoDispatch(request, response);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (!WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Restore the original attribute snapshot, in case of an include.</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (attributesSnapshot != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\trestoreAttributesAfterInclude(request, attributesSnapshot);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Process the actual dispatching to the handler.</span></span><br><span class=\"line\"><span class=\"comment\">\t * &lt;p&gt;The handler will be obtained by applying the servlet's HandlerMappings in order.</span></span><br><span class=\"line\"><span class=\"comment\">\t * The HandlerAdapter will be obtained by querying the servlet's installed HandlerAdapters</span></span><br><span class=\"line\"><span class=\"comment\">\t * to find the first that supports the handler class.</span></span><br><span class=\"line\"><span class=\"comment\">\t * &lt;p&gt;All HTTP methods are handled by this method. It's up to HandlerAdapters or handlers</span></span><br><span class=\"line\"><span class=\"comment\">\t * themselves to decide which methods are acceptable.</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> request current HTTP request</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> response current HTTP response</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@throws</span> Exception in case of any kind of processing failure</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doDispatch</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t\tHttpServletRequest processedRequest = request;</span><br><span class=\"line\">\t\tHandlerExecutionChain mappedHandler = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">boolean</span> multipartRequestParsed = <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tWebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tModelAndView mv = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\t\tException dispatchException = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 先处理是否Multipart的请求，如果是则会解析，并且返回一个解析后的请求。</span></span><br><span class=\"line\">\t\t\t\tprocessedRequest = checkMultipart(request);</span><br><span class=\"line\">\t\t\t\tmultipartRequestParsed = (processedRequest != request);</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 寻找对应的handler</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Determine handler for the current request.</span></span><br><span class=\"line\">\t\t\t\tmappedHandler = getHandler(processedRequest);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (mappedHandler == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// 没有找到则直接返回默认404视图。</span></span><br><span class=\"line\">\t\t\t\t\tnoHandlerFound(processedRequest, response);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Determine handler adapter for the current request.</span></span><br><span class=\"line\">\t\t\t\tHandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Process last-modified header, if supported by the handler.</span></span><br><span class=\"line\">\t\t\t\tString method = request.getMethod();</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">boolean</span> isGet = <span class=\"string\">\"GET\"</span>.equals(method);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (isGet || <span class=\"string\">\"HEAD\"</span>.equals(method)) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">long</span> lastModified = ha.getLastModified(request, mappedHandler.getHandler());</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">new</span> ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 前置拦截器</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Actually invoke the handler.</span></span><br><span class=\"line\">        <span class=\"comment\">// 如果上面的流程都执行完成，在执行真实的handle</span></span><br><span class=\"line\">\t\t\t\tmv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">        <span class=\"comment\">// 如果是异步的就直接结束。</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 视图解析</span></span><br><span class=\"line\">\t\t\t\tapplyDefaultViewName(processedRequest, mv);</span><br><span class=\"line\">        <span class=\"comment\">//执行后置拦截器</span></span><br><span class=\"line\">\t\t\t\tmappedHandler.applyPostHandle(processedRequest, response, mv);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">\t\t\t\tdispatchException = ex;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">catch</span> (Throwable err) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// As of 4.3, we're processing Errors thrown from handler methods as well,</span></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// making them available for @ExceptionHandler methods and other scenarios.</span></span><br><span class=\"line\">\t\t\t\tdispatchException = <span class=\"keyword\">new</span> NestedServletException(<span class=\"string\">\"Handler dispatch failed\"</span>, err);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">// 响应视图</span></span><br><span class=\"line\">\t\t\tprocessDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">\t\t\ttriggerAfterCompletion(processedRequest, response, mappedHandler, ex);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">catch</span> (Throwable err) &#123;</span><br><span class=\"line\">\t\t\ttriggerAfterCompletion(processedRequest, response, mappedHandler,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">new</span> NestedServletException(<span class=\"string\">\"Handler processing failed\"</span>, err));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 没有抛异常也会判断是否异步，如果是异步也会执行拦截器。</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Instead of postHandle and afterCompletion</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (mappedHandler != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tmappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Clean up any resources used by a multipart request.</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (multipartRequestParsed) &#123;</span><br><span class=\"line\">\t\t\t\t\tcleanupMultipart(processedRequest);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Return the HandlerExecutionChain for this request.</span></span><br><span class=\"line\"><span class=\"comment\">\t * &lt;p&gt;Tries all handler mappings in order.</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> request current HTTP request</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@return</span> the HandlerExecutionChain, or &#123;<span class=\"doctag\">@code</span> null&#125; if no handler could be found</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"meta\">@Nullable</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">protected</span> HandlerExecutionChain <span class=\"title\">getHandler</span><span class=\"params\">(HttpServletRequest request)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.handlerMappings != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 遍历所有的HandlerMapping找出对应的HandlerExecutionChain</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (HandlerMapping mapping : <span class=\"keyword\">this</span>.handlerMappings) &#123;</span><br><span class=\"line\">\t\t\t\tHandlerExecutionChain handler = mapping.getHandler(request);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (handler != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> handler;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Apply postHandle methods of registered interceptors.</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">applyPostHandle</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response, @Nullable ModelAndView mv)</span></span></span><br><span class=\"line\"><span class=\"function\">\t\t\t<span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 取出所有拦截器，遍历拦截器</span></span><br><span class=\"line\">\t\tHandlerInterceptor[] interceptors = getInterceptors();</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!ObjectUtils.isEmpty(interceptors)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = interceptors.length - <span class=\"number\">1</span>; i &gt;= <span class=\"number\">0</span>; i--) &#123;</span><br><span class=\"line\">\t\t\t\tHandlerInterceptor interceptor = interceptors[i];</span><br><span class=\"line\">\t\t\t\tinterceptor.postHandle(request, response, <span class=\"keyword\">this</span>.handler, mv);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"内嵌web容器\"><a href=\"#内嵌web容器\" class=\"headerlink\" title=\"内嵌web容器\"></a>内嵌web容器</h3><blockquote>\n<p>spring boot 可以切换web容器，通过spring boot spi机制，引入不同的web容器并屏蔽默认tomcat完成切换web容器。</p>\n</blockquote>\n<ul>\n<li>spring-boot-starter-tomcat</li>\n<li>Spring-boot-starter-jettty</li>\n<li>Spring-boot-starter-undertow</li>\n<li>spring-boot-starter-reactor-netty</li>\n</ul>\n<h4 id=\"web配置\"><a href=\"#web配置\" class=\"headerlink\" title=\"web配置\"></a>web配置</h4><blockquote>\n<p>web容器配置信息分为两种，配置文件和代码配置。这里主要说下代码配置。</p>\n</blockquote>\n<ul>\n<li>WebServerFactoryCustomizer<T><ul>\n<li>TomcatServletWebServerFactory</li>\n<li>JettyServletWebServerFactory</li>\n<li>UndertowServletWebServerFactory</li>\n</ul>\n</li>\n</ul>\n","categories":["查缺补漏"],"tags":["Java","Spring"]},{"title":"查缺补漏-JavaCollecionsFramework","url":"/posts/347882303/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h3 id=\"Java集合\"><a href=\"#Java集合\" class=\"headerlink\" title=\"Java集合\"></a>Java集合</h3><p>​    集合是Java提供的工具包、包含常用的数据结构：集合、链表、队列、栈、数组、映射等。Collection的包是java.util.*。</p>\n<h4 id=\"Collection\"><a href=\"#Collection\" class=\"headerlink\" title=\"Collection\"></a>Collection</h4><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Collection/Java-Collection-Framework.svg\"></p>\n<h4 id=\"Map\"><a href=\"#Map\" class=\"headerlink\" title=\"Map\"></a>Map</h4><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Collection/Java-Map-Framework.svg\">  </p>\n<p><code>实际上还有Cloneable、Serializable接口是都集合类需要实现的，通用所以不不画上去了。 </code> </p>\n<h4 id=\"Java集合主要划分4个部分：\"><a href=\"#Java集合主要划分4个部分：\" class=\"headerlink\" title=\"Java集合主要划分4个部分：\"></a>Java集合主要划分4个部分：</h4><ul>\n<li>List(列队)</li>\n<li>Set(集合)</li>\n<li>Map(映射)</li>\n<li>工具类(Iterator迭代器、Enumeration枚举类、Arrays、Collections)</li>\n</ul>\n<h4 id=\"划重点\"><a href=\"#划重点\" class=\"headerlink\" title=\"划重点\"></a>划重点</h4><ul>\n<li>Conllection<ul>\n<li>List<ul>\n<li><code>ArrayList</code></li>\n<li><code>Vector</code><ul>\n<li>Stack</li>\n</ul>\n</li>\n<li><code>LinkedList</code></li>\n</ul>\n</li>\n<li>Set<ul>\n<li><code>HashSet</code></li>\n<li><code>TreeSet</code></li>\n<li><code>LinkedHashSet</code></li>\n</ul>\n</li>\n<li>Queue</li>\n</ul>\n</li>\n<li>Map<ul>\n<li><code>HashMap</code></li>\n<li><code>HashTable</code></li>\n<li><code>TreeMap</code></li>\n</ul>\n</li>\n<li>工具<ul>\n<li>Arrays</li>\n<li>Collections</li>\n<li>Enumeration</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Java类库中具体集合\"><a href=\"#Java类库中具体集合\" class=\"headerlink\" title=\"Java类库中具体集合\"></a>Java类库中具体集合</h3><table>\n<thead>\n<tr>\n<th>集合类型</th>\n<th>概括</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>ArrayList<E></td>\n<td>一种可以动态增长和缩减的索引序列，访问速度很快但是插入和删除比ArrayList慢。</td>\n</tr>\n<tr>\n<td>LinkedList<E></td>\n<td>一种可以在任何位置进行高效地插入和删除操作的有序序列，但是访问比较ArrayList慢。</td>\n</tr>\n<tr>\n<td>CopyOnWriteArrayList<E></td>\n<td>CopyOnWriteArrayList相当于线程安全的ArrayList，它实现了List接口，支持高并发。</td>\n</tr>\n<tr>\n<td>ArrayDeque<E></td>\n<td>一种循环数组实现的双端序列。</td>\n</tr>\n<tr>\n<td>HashSet<E></td>\n<td>一种没有重复元素的无序集合。</td>\n</tr>\n<tr>\n<td>TreeSet<E></td>\n<td>一种有序集合。</td>\n</tr>\n<tr>\n<td>EnumSet&lt;E extends Enum<E>&gt;</td>\n<td>一种包含枚举类型的集合。</td>\n</tr>\n<tr>\n<td>LinkedHashSet<E></td>\n<td>一种可以记住元素插入顺序的集合。</td>\n</tr>\n<tr>\n<td>PriorityQueue<E></td>\n<td>一种允许高效删除最小元素的集合。</td>\n</tr>\n<tr>\n<td>HashMap&lt;K , V&gt;</td>\n<td>一个存储 键 / 值 关联的数据结构。</td>\n</tr>\n<tr>\n<td>TreeMap&lt;K , V&gt;</td>\n<td>一种键值有序排列的映射表。</td>\n</tr>\n<tr>\n<td>EnumMap&lt;K extends Enum<K>, V&gt;</td>\n<td>一种键属于枚举类型的映射表。</td>\n</tr>\n<tr>\n<td>LinkedHashMap&lt;K ,V &gt;</td>\n<td>一种可以记住键 / 值 项添加顺序的映射表。</td>\n</tr>\n<tr>\n<td>WeakHashMap&lt;K , V &gt;</td>\n<td>一种其值无用武之地后可以被垃圾回收回收的映射表。</td>\n</tr>\n<tr>\n<td>IdentityHashMap&lt;K , V&gt;</td>\n<td>一种用 == 而不是用用 equals 比较的映射表。</td>\n</tr>\n</tbody></table>\n<a id=\"more\"></a>\n\n<h3 id=\"Java-Collection-Interface\"><a href=\"#Java-Collection-Interface\" class=\"headerlink\" title=\"Java Collection Interface\"></a>Java Collection Interface</h3><h4 id=\"Set\"><a href=\"#Set\" class=\"headerlink\" title=\"Set\"></a>Set</h4><ul>\n<li>TreeSet：基于红黑树实现，支持有序性操作，例如根据一个范围查找元素的操作。但是查找效率不如 HashSet，HashSet 查找的时间复杂度为 O(1)，TreeSet 则为 O(logN)。</li>\n<li>HashSet：基于哈希表实现，支持快速查找，但不支持有序性操作。并且失去了元素的插入顺序信息，也就是说使用 Iterator 遍历 HashSet 得到的结果是不确定的。</li>\n<li>LinkedHashSet：具有 HashSet 的查找效率，并且内部使用双向链表维护元素的插入顺序。</li>\n</ul>\n<h4 id=\"List\"><a href=\"#List\" class=\"headerlink\" title=\"List\"></a>List</h4><ul>\n<li>ArrayList：基于动态数组实现，支持随机访问。</li>\n<li>Vector：和 ArrayList 类似，但它是线程安全的。</li>\n<li>LinkedList：基于双向链表实现，只能顺序访问，但是可以快速地在链表中间插入和删除元素。不仅如此，LinkedList 还可以用作栈、队列和双向队列。</li>\n</ul>\n<h4 id=\"Queue\"><a href=\"#Queue\" class=\"headerlink\" title=\"Queue\"></a>Queue</h4><ul>\n<li>LinkedList：可以用它来实现双向队列。</li>\n<li>PriorityQueue：基于堆结构实现，可以用它来实现优先队列。</li>\n</ul>\n<h4 id=\"Map-1\"><a href=\"#Map-1\" class=\"headerlink\" title=\"Map\"></a>Map</h4><ul>\n<li>TreeMap：基于红黑树实现。</li>\n<li>HashMap：基于哈希表实现。</li>\n<li>HashTable：和 HashMap 类似，但它是线程安全的，这意味着同一时刻多个线程同时写入 HashTable 不会导致数据不一致。它是遗留类，不应该去使用它，而是使用 ConcurrentHashMap 来支持线程安全，ConcurrentHashMap 的效率会更高，因为 ConcurrentHashMap 引入了分段锁。</li>\n<li>LinkedHashMap：使用双向链表来维护元素的顺序，顺序为插入顺序或者最近最少使用（LRU）顺序。</li>\n<li>ConcurrentHashMap：并发线程安全的hashMap。</li>\n</ul>\n<h4 id=\"泛型E\"><a href=\"#泛型E\" class=\"headerlink\" title=\"泛型E\"></a>泛型E</h4><p>​    该接口封装了不同类型的结合，使得开发人员操作集合的时候不必关心他们具体的实现，核心的集合接口是Java集合框架的基础。证如上图看到的核心集合接口的层次关系。</p>\n<p>​    <E>语法告诉我们这个接口是泛化的，在使用集合的时候需要声明集合的实例、指定集合中对象的类型。指定类型之后编译器能在编译期间验证集合中的元素类型是正确的。从而减少错误。</p>\n<h3 id=\"Interface\"><a href=\"#Interface\" class=\"headerlink\" title=\"Interface\"></a>Interface</h3><blockquote>\n<p>首先简单的介绍下接口以及接口的方法，便于后面的深入学习。</p>\n</blockquote>\n<ul>\n<li><p>Iterator<E></p>\n</li>\n<li><p>Iterable<T></p>\n</li>\n<li><p>Collection<E></p>\n<ul>\n<li><p>Queue</p>\n<ul>\n<li>LinkedList 双向列队结构。</li>\n<li>PriorityQueue  基于堆机构实现，可以用来做优先级列队。</li>\n</ul>\n</li>\n<li><p>Set</p>\n<ul>\n<li>HashSet  基于哈希实现，支持快速查找，但不支持有序性操作，例如根据一个范围查找元素的操作。并且失去了元素的插入顺序信息，也就是说使用 Iterator 遍历 HashSet 得到的结果是不确定的。</li>\n<li>TreeSet  基于红黑树实现，支持有序性操作，但是查找效率不如 HashSet，HashSet 查找时间复杂度为 O(1)，TreeSet 则为 O(logN)；</li>\n</ul>\n</li>\n<li><p>LinkedHashSet  具有 HashSet 的查找效率，且内部使用链表维护元素的插入顺序。</p>\n</li>\n<li><p>List</p>\n<ul>\n<li>ArrayList 基于动态数组实现，支持随机访问元素。</li>\n<li>Vector 和ArrayList类似，但是它是线程安全的。</li>\n<li>Stack 是Vector的子类，它实现了一个标准的后进先出的栈。</li>\n<li>LinkedList 基于双向循环列表，只能顺序访问；可以快速的插入和删除元素。而且，LinkedList还可以用作栈、列队和双端列队。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>Map&lt;K , V &gt;</p>\n</li>\n</ul>\n<p><code>需要特别说明下Irertor&lt;E&gt; 和Iterable&lt;T&gt;这两个接口，Iterator模式是用于遍历集合类的标准方法。它主要用于将 访问逻辑从不同的类型集合类中抽象出来、所以在很多实现了Iterble集合类中实现这个多个Iterator接口。这样避免向客用户包撸集合内部的结构，这就是为什么我们用的这么爽的原因之一。</code></p>\n<h4 id=\"实现类一览表\"><a href=\"#实现类一览表\" class=\"headerlink\" title=\"实现类一览表\"></a>实现类一览表</h4><table>\n<thead>\n<tr>\n<th>Collction</th>\n<th>排序</th>\n<th>随机访问</th>\n<th>Key-Value</th>\n<th>可重复元素</th>\n<th>空元素</th>\n<th>线程安全</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>ArrayList</td>\n<td>Y</td>\n<td>Y</td>\n<td>N</td>\n<td>Y</td>\n<td>Y</td>\n<td>N</td>\n</tr>\n<tr>\n<td>LinkedList</td>\n<td>Y</td>\n<td>N</td>\n<td>N</td>\n<td>Y</td>\n<td>Y</td>\n<td>N</td>\n</tr>\n<tr>\n<td>HashSet</td>\n<td>N</td>\n<td>N</td>\n<td>N</td>\n<td>N</td>\n<td>Y</td>\n<td>N</td>\n</tr>\n<tr>\n<td>TreeSet</td>\n<td>Y</td>\n<td>N</td>\n<td>N</td>\n<td>N</td>\n<td>N</td>\n<td>N</td>\n</tr>\n<tr>\n<td>HashMap</td>\n<td>N</td>\n<td>Y</td>\n<td>Y</td>\n<td>N</td>\n<td>Y</td>\n<td>N</td>\n</tr>\n<tr>\n<td>TreeMap</td>\n<td>Y</td>\n<td>Y</td>\n<td>Y</td>\n<td>N</td>\n<td>N</td>\n<td>N</td>\n</tr>\n<tr>\n<td>Vector</td>\n<td>Y</td>\n<td>Y</td>\n<td>N</td>\n<td>Y</td>\n<td>Y</td>\n<td>Y</td>\n</tr>\n<tr>\n<td>Stack</td>\n<td>Y</td>\n<td>N</td>\n<td>N</td>\n<td>Y</td>\n<td>Y</td>\n<td>Y</td>\n</tr>\n<tr>\n<td>Hashtable</td>\n<td>N</td>\n<td>Y</td>\n<td>Y</td>\n<td>N</td>\n<td>N</td>\n<td>Y</td>\n</tr>\n<tr>\n<td>Properties</td>\n<td>Y</td>\n<td>N</td>\n<td>N</td>\n<td>Y</td>\n<td>Y</td>\n<td>Y</td>\n</tr>\n<tr>\n<td>CopyOnWriteArrayList</td>\n<td>Y</td>\n<td>Y</td>\n<td>Y</td>\n<td>N</td>\n<td>N</td>\n<td>Y</td>\n</tr>\n<tr>\n<td>ConcurrentHashMap</td>\n<td>N</td>\n<td>Y</td>\n<td>Y</td>\n<td>N</td>\n<td>N</td>\n<td>Y</td>\n</tr>\n<tr>\n<td>CopyOnWriteArrayList</td>\n<td>N</td>\n<td>N</td>\n<td>N</td>\n<td>N</td>\n<td>Y</td>\n<td>Y</td>\n</tr>\n</tbody></table>\n<h4 id=\"Iterator-接口\"><a href=\"#Iterator-接口\" class=\"headerlink\" title=\"Iterator 接口\"></a>Iterator 接口</h4><ul>\n<li>迭代器必须从属容器、其作用就是迭代所属容器中的元素。源代码看出这是一个泛型接口。就是迭代泛型类元素。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Collection/Interface-Iterator.jpg\">         </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Iterator</span>&lt;<span class=\"title\">E</span>&gt; </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 如果存在可以返回的元素就返回true</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">hasNext</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回将要访问的下一个元素、如果已经达到集合的尾部，则抛出一个NoSuchElementException异常。</span></span><br><span class=\"line\">    <span class=\"function\">E <span class=\"title\">next</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"> \t<span class=\"comment\">// 删除上次访问的对象。如果已经是尾部；则抛出一个IllegalStateException异常。</span></span><br><span class=\"line\">    <span class=\"comment\">// 如果没有重写这个方法就会排除这个异常UnsupportedOperationException  </span></span><br><span class=\"line\">    <span class=\"comment\">// 比如：Arrays$ArrayList中add 、 remove方法就没有重写，直接使用Arrays.toList的集合就会抛出这个异常</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> <span class=\"keyword\">void</span> <span class=\"title\">remove</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> UnsupportedOperationException(<span class=\"string\">\"remove\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Itreator专门提供的一个方法，可以使用Lambda表达式遍历。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> <span class=\"keyword\">void</span> <span class=\"title\">forEachRemaining</span><span class=\"params\">(Consumer&lt;? <span class=\"keyword\">super</span> E&gt; action)</span> </span>&#123;</span><br><span class=\"line\">        Objects.requireNonNull(action);</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (hasNext())</span><br><span class=\"line\">            action.accept(next());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Iterable-接口\"><a href=\"#Iterable-接口\" class=\"headerlink\" title=\"Iterable 接口\"></a>Iterable 接口</h4><ul>\n<li>这个接口被Collection继承。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Collection/Interface-Iterable.jpg\">  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Iterable</span>&lt;<span class=\"title\">T</span>&gt; </span>&#123;</span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"comment\">// 定义了Iterator，返回Iterator实例。</span></span><br><span class=\"line\">    <span class=\"function\">Iterator&lt;T&gt; <span class=\"title\">iterator</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 增强for循环，专门给Lambda表达式遍历。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> <span class=\"keyword\">void</span> <span class=\"title\">forEach</span><span class=\"params\">(Consumer&lt;? <span class=\"keyword\">super</span> T&gt; action)</span> </span>&#123;</span><br><span class=\"line\">        Objects.requireNonNull(action);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (T t : <span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">            action.accept(t);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"comment\">// 根据此Iterable描述的元素创建Spliterator。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> Spliterator&lt;T&gt; <span class=\"title\">spliterator</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Spliterators.spliteratorUnknownSize(iterator(), <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Collection-接口\"><a href=\"#Collection-接口\" class=\"headerlink\" title=\"Collection 接口\"></a>Collection 接口</h4><ul>\n<li>这个接口集合接口。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Collection/Interface-Collection.jpg\">  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Collection</span>&lt;<span class=\"title\">E</span>&gt; <span class=\"keyword\">extends</span> <span class=\"title\">Iterable</span>&lt;<span class=\"title\">E</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Query Operations</span></span><br><span class=\"line\"></span><br><span class=\"line\">   \t<span class=\"comment\">// 返回当前存储在集合中的元素个数。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">size</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 如果集合中没有元素,则返回true。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isEmpty</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 如果集合中包含一个元素与参数o相同,这返回true。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">contains</span><span class=\"params\">(Object o)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回当前用于访问集合的迭代器。</span></span><br><span class=\"line\">    <span class=\"function\">Iterator&lt;E&gt; <span class=\"title\">iterator</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回这个集合的数组对象。</span></span><br><span class=\"line\">    Object[] toArray();</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 返回这个集合的数组对象，如果t这个数组足够大，就将集合中的元素填入这个数组中。剩余的空间填入Null；否则，分配一个新数组，其成员类型与t的成员类型相同，其长度等于集合的大小，并添加集合元素。</span></span><br><span class=\"line\">    &lt;T&gt; T[] toArray(T[] a);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Modification Operations</span></span><br><span class=\"line\"> \t<span class=\"comment\">// 将一个元素添加到集合中，如果这个调用改变了集合，则返回true。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">add</span><span class=\"params\">(E e)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"> \t<span class=\"comment\">// 从这个集合中删除等于o的对象，如果匹配对象被删除。就返回true。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">remove</span><span class=\"params\">(Object o)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Bulk Operations</span></span><br><span class=\"line\">    <span class=\"comment\">// 如果此集合包含指定集合c中的所有元素，则返回true。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">containsAll</span><span class=\"params\">(Collection&lt;?&gt; c)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 将c集合中所有元素添加到这个集合中，如果由于这个调用改变了集合，返回true。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">addAll</span><span class=\"params\">(Collection&lt;? extends E&gt; c)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  从集合中删除集合c中的所有元素，如果由于这个元素改变了集合，返回true。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">removeAll</span><span class=\"params\">(Collection&lt;?&gt; c)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 删除此集合中满足给定谓词的所有元素。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> <span class=\"keyword\">boolean</span> <span class=\"title\">removeIf</span><span class=\"params\">(Predicate&lt;? <span class=\"keyword\">super</span> E&gt; filter)</span> </span>&#123;</span><br><span class=\"line\">        Objects.requireNonNull(filter);</span><br><span class=\"line\">        <span class=\"keyword\">boolean</span> removed = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> Iterator&lt;E&gt; each = iterator();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (each.hasNext()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (filter.test(each.next())) &#123;</span><br><span class=\"line\">                each.remove();</span><br><span class=\"line\">                removed = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> removed;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// 仅保留包含在指定集合中的此c集合中的元素</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">retainAll</span><span class=\"params\">(Collection&lt;?&gt; c)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 从这个集合中删除所有元素。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">clear</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Comparison and hashing</span></span><br><span class=\"line\">    <span class=\"comment\">// 从这个集合中删除所有元素。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">equals</span><span class=\"params\">(Object o)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回此集合的哈希码值</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">hashCode</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"> \t<span class=\"comment\">// 在此集合中的元素上创建Spliterator</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> Spliterator&lt;E&gt; <span class=\"title\">spliterator</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Spliterators.spliterator(<span class=\"keyword\">this</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   \t<span class=\"comment\">// 以此集合作为源返回顺序流。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> Stream&lt;E&gt; <span class=\"title\">stream</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> StreamSupport.stream(spliterator(), <span class=\"keyword\">false</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 以此集合作为源返回可能并行的Stream。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> Stream&lt;E&gt; <span class=\"title\">parallelStream</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> StreamSupport.stream(spliterator(), <span class=\"keyword\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Map-接口\"><a href=\"#Map-接口\" class=\"headerlink\" title=\"Map 接口\"></a>Map 接口</h4><blockquote>\n<p>翻译成中文就是地图，x y 坐标代表地图上的一个位置。Map就是一种 键\\值的存在。键好比地图中的x y ，值好比地图中的位置。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Collection/Interface-Map.jpg\">  </p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Map</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Query Operations</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回此映射中的键-值映射关系数。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">size</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Returns &lt;tt&gt;true&lt;/tt&gt; if this map contains no key-value mappings.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> &lt;tt&gt;true&lt;/tt&gt; if this map contains no key-value mappings</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"comment\">// 如果不存在映射元素，则返回true否则返回false。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isEmpty</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 如果这个映射表已经存有这个键就返回true。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">containsKey</span><span class=\"params\">(Object key)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"> \t<span class=\"comment\">// 如果这个映射表已经存在这个值就返回true。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">containsValue</span><span class=\"params\">(Object value)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取与键对应的值；返回与键对应的对象，如果映射表中没有这个对象则返回NULL，键可以是NULL。</span></span><br><span class=\"line\">    <span class=\"function\">V <span class=\"title\">get</span><span class=\"params\">(Object key)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Modification Operations</span></span><br><span class=\"line\"></span><br><span class=\"line\"> \t<span class=\"comment\">// 将键值对关系插入映射表中，如果这个键已经存在，新的对象会取代这个键对应旧的对象。这个方法将返回键的旧值，如果这个键以前没有出现过则返回NULL，键可以是NULL,但是值不能是NULL。</span></span><br><span class=\"line\">    <span class=\"function\">V <span class=\"title\">put</span><span class=\"params\">(K key, V value)</span></span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"comment\">// 如果该键 key 的映射存在，则从映射集合中删除该映射，并返回该键对应的值。如果该键没有映射关系，则返回一个NULL。</span></span><br><span class=\"line\">    <span class=\"function\">V <span class=\"title\">remove</span><span class=\"params\">(Object key)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Bulk Operations</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 将m映射表中所有的条目都添加到当前的映射表中。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">putAll</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  \t<span class=\"comment\">// 清空当前映射中键对值</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">clear</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Views</span></span><br><span class=\"line\">    <span class=\"comment\">// 返回映射表中所有键的集合，可以从这个集中删除元素，同时也可以映射表中删除它们，但是不能添加元素。</span></span><br><span class=\"line\">    <span class=\"function\">Set&lt;K&gt; <span class=\"title\">keySet</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回映射表中所有值的集合，可以从这个集中删除元素，同时也可以从映射表中删除它们，但是不能添加元素。</span></span><br><span class=\"line\">    <span class=\"function\">Collection&lt;V&gt; <span class=\"title\">values</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"> \t<span class=\"comment\">// 返回Map.Entry对象的集，即映射表中的键\\ 值对。同时也可以从映射表中删除元素，同时可以删除该键\\值对。但是不能添加任何元素。</span></span><br><span class=\"line\">    Set&lt;Map.Entry&lt;K, V&gt;&gt; entrySet();</span><br><span class=\"line\"></span><br><span class=\"line\">   \t</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Entry</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; </span>&#123;</span><br><span class=\"line\">      </span><br><span class=\"line\">        <span class=\"function\">K <span class=\"title\">getKey</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">       </span><br><span class=\"line\">        <span class=\"function\">V <span class=\"title\">getValue</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">       </span><br><span class=\"line\">        <span class=\"function\">V <span class=\"title\">setValue</span><span class=\"params\">(V value)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">       </span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">equals</span><span class=\"params\">(Object o)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      </span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">hashCode</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      </span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;K extends Comparable&lt;? <span class=\"keyword\">super</span> K&gt;, V&gt; Comparator&lt;Map.Entry&lt;K,V&gt;&gt; comparingByKey() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (Comparator&lt;Map.Entry&lt;K, V&gt;&gt; &amp; Serializable)</span><br><span class=\"line\">                (c1, c2) -&gt; c1.getKey().compareTo(c2.getKey());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       </span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;K, V extends Comparable&lt;? <span class=\"keyword\">super</span> V&gt;&gt; Comparator&lt;Map.Entry&lt;K,V&gt;&gt; comparingByValue() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (Comparator&lt;Map.Entry&lt;K, V&gt;&gt; &amp; Serializable)</span><br><span class=\"line\">                (c1, c2) -&gt; c1.getValue().compareTo(c2.getValue());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">     </span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;K, V&gt; Comparator&lt;Map.Entry&lt;K, V&gt;&gt; comparingByKey(Comparator&lt;? <span class=\"keyword\">super</span> K&gt; cmp) &#123;</span><br><span class=\"line\">            Objects.requireNonNull(cmp);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (Comparator&lt;Map.Entry&lt;K, V&gt;&gt; &amp; Serializable)</span><br><span class=\"line\">                (c1, c2) -&gt; cmp.compare(c1.getKey(), c2.getKey());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       </span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;K, V&gt; Comparator&lt;Map.Entry&lt;K, V&gt;&gt; comparingByValue(Comparator&lt;? <span class=\"keyword\">super</span> V&gt; cmp) &#123;</span><br><span class=\"line\">            Objects.requireNonNull(cmp);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (Comparator&lt;Map.Entry&lt;K, V&gt;&gt; &amp; Serializable)</span><br><span class=\"line\">                (c1, c2) -&gt; cmp.compare(c1.getValue(), c2.getValue());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Comparison and hashing</span></span><br><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">equals</span><span class=\"params\">(Object o)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">hashCode</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Defaultable methods</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回指定建映射到的值，如果该键不存在值，就返回一个默认的。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> V <span class=\"title\">getOrDefault</span><span class=\"params\">(Object key, V defaultValue)</span> </span>&#123;</span><br><span class=\"line\">        V v;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (((v = get(key)) != <span class=\"keyword\">null</span>) || containsKey(key))</span><br><span class=\"line\">            ? v</span><br><span class=\"line\">            : defaultValue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 为此映射中每一元素进行操作。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> <span class=\"keyword\">void</span> <span class=\"title\">forEach</span><span class=\"params\">(BiConsumer&lt;? <span class=\"keyword\">super</span> K, ? <span class=\"keyword\">super</span> V&gt; action)</span> </span>&#123;</span><br><span class=\"line\">        Objects.requireNonNull(action);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Map.Entry&lt;K, V&gt; entry : entrySet()) &#123;</span><br><span class=\"line\">            K k;</span><br><span class=\"line\">            V v;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                k = entry.getKey();</span><br><span class=\"line\">                v = entry.getValue();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span>(IllegalStateException ise) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// this usually means the entry is no longer in the map.</span></span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ConcurrentModificationException(ise);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            action.accept(k, v);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> <span class=\"keyword\">void</span> <span class=\"title\">replaceAll</span><span class=\"params\">(BiFunction&lt;? <span class=\"keyword\">super</span> K, ? <span class=\"keyword\">super</span> V, ? extends V&gt; function)</span> </span>&#123;</span><br><span class=\"line\">        Objects.requireNonNull(function);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Map.Entry&lt;K, V&gt; entry : entrySet()) &#123;</span><br><span class=\"line\">            K k;</span><br><span class=\"line\">            V v;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                k = entry.getKey();</span><br><span class=\"line\">                v = entry.getValue();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span>(IllegalStateException ise) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// this usually means the entry is no longer in the map.</span></span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ConcurrentModificationException(ise);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// ise thrown from function is not a cme.</span></span><br><span class=\"line\">            v = function.apply(k, v);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                entry.setValue(v);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span>(IllegalStateException ise) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// this usually means the entry is no longer in the map.</span></span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ConcurrentModificationException(ise);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> V <span class=\"title\">putIfAbsent</span><span class=\"params\">(K key, V value)</span> </span>&#123;</span><br><span class=\"line\">        V v = get(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (v == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            v = put(key, value);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> v;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> <span class=\"keyword\">boolean</span> <span class=\"title\">remove</span><span class=\"params\">(Object key, Object value)</span> </span>&#123;</span><br><span class=\"line\">        Object curValue = get(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!Objects.equals(curValue, value) ||</span><br><span class=\"line\">            (curValue == <span class=\"keyword\">null</span> &amp;&amp; !containsKey(key))) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        remove(key);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> <span class=\"keyword\">boolean</span> <span class=\"title\">replace</span><span class=\"params\">(K key, V oldValue, V newValue)</span> </span>&#123;</span><br><span class=\"line\">        Object curValue = get(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!Objects.equals(curValue, oldValue) ||</span><br><span class=\"line\">            (curValue == <span class=\"keyword\">null</span> &amp;&amp; !containsKey(key))) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        put(key, newValue);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> V <span class=\"title\">replace</span><span class=\"params\">(K key, V value)</span> </span>&#123;</span><br><span class=\"line\">        V curValue;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (((curValue = get(key)) != <span class=\"keyword\">null</span>) || containsKey(key)) &#123;</span><br><span class=\"line\">            curValue = put(key, value);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> curValue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> V <span class=\"title\">computeIfAbsent</span><span class=\"params\">(K key,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">            Function&lt;? <span class=\"keyword\">super</span> K, ? extends V&gt; mappingFunction)</span> </span>&#123;</span><br><span class=\"line\">        Objects.requireNonNull(mappingFunction);</span><br><span class=\"line\">        V v;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((v = get(key)) == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            V newValue;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((newValue = mappingFunction.apply(key)) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                put(key, newValue);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> newValue;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> v;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> V <span class=\"title\">computeIfPresent</span><span class=\"params\">(K key,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">            BiFunction&lt;? <span class=\"keyword\">super</span> K, ? <span class=\"keyword\">super</span> V, ? extends V&gt; remappingFunction)</span> </span>&#123;</span><br><span class=\"line\">        Objects.requireNonNull(remappingFunction);</span><br><span class=\"line\">        V oldValue;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((oldValue = get(key)) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            V newValue = remappingFunction.apply(key, oldValue);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (newValue != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                put(key, newValue);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> newValue;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                remove(key);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> V <span class=\"title\">compute</span><span class=\"params\">(K key,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">            BiFunction&lt;? <span class=\"keyword\">super</span> K, ? <span class=\"keyword\">super</span> V, ? extends V&gt; remappingFunction)</span> </span>&#123;</span><br><span class=\"line\">        Objects.requireNonNull(remappingFunction);</span><br><span class=\"line\">        V oldValue = get(key);</span><br><span class=\"line\"></span><br><span class=\"line\">        V newValue = remappingFunction.apply(key, oldValue);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newValue == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// delete mapping</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (oldValue != <span class=\"keyword\">null</span> || containsKey(key)) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// something to remove</span></span><br><span class=\"line\">                remove(key);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// nothing to do. Leave things as they were.</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// add or replace old mapping</span></span><br><span class=\"line\">            put(key, newValue);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> newValue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">default</span> V <span class=\"title\">merge</span><span class=\"params\">(K key, V value,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">            BiFunction&lt;? <span class=\"keyword\">super</span> V, ? <span class=\"keyword\">super</span> V, ? extends V&gt; remappingFunction)</span> </span>&#123;</span><br><span class=\"line\">        Objects.requireNonNull(remappingFunction);</span><br><span class=\"line\">        Objects.requireNonNull(value);</span><br><span class=\"line\">        V oldValue = get(key);</span><br><span class=\"line\">        V newValue = (oldValue == <span class=\"keyword\">null</span>) ? value :</span><br><span class=\"line\">                   remappingFunction.apply(oldValue, value);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(newValue == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            remove(key);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            put(key, newValue);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> newValue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"对比下Vector、ArrayList、LinkedList之前有何区别。\"><a href=\"#对比下Vector、ArrayList、LinkedList之前有何区别。\" class=\"headerlink\" title=\"对比下Vector、ArrayList、LinkedList之前有何区别。\"></a>对比下Vector、ArrayList、LinkedList之前有何区别。</h3><p><strong>Vector</strong></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/JavaConcurrent/Vector.png\"></p>\n<ul>\n<li>Vector是Java早期提供的线程安全动态数组，和ArrayList之间在扩容方面有很多的区别，Vector是扩容2倍，而ArrayList扩容1.5倍。</li>\n</ul>\n<p><strong>ArrayList</strong></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/JavaConcurrent/ArrayList.png\"></p>\n<ul>\n<li>ArrayList平时开发过程中使用最多的，是一个线程不安全的动态数组。所以性能上相对Vector好很多。</li>\n</ul>\n<p><strong>LinkedList</strong></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/JavaConcurrent/LinkedList.png\"></p>\n<ul>\n<li>它是一个链表，对比ArrayList和Vector不需要扩容。但没有实现<code>RandomAccess </code>接口。RandomAccess的实现，则尽量用for(int i = 0; i &lt; size; i++) 来遍历而不要用Iterator迭代器来遍历。</li>\n</ul>\n<h4 id=\"ArrayList-VS-linkedList\"><a href=\"#ArrayList-VS-linkedList\" class=\"headerlink\" title=\"ArrayList VS linkedList\"></a>ArrayList VS linkedList</h4><ul>\n<li><p><strong>Array</strong> （数组）是基于索引(index)的数据结构，它使用索引在数组中搜索和读取数据是很快的。</p>\n</li>\n<li><p>Array获取数据的时间复杂度是O(1),但是要删除数据却是开销很大，因为这需要重排数组中的所有数据, (因为删除数据以后, 需要把后面所有的数据前移)</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 数组初始化必须指定初始化的长度, 否则报错</span></span><br><span class=\"line\"><span class=\"keyword\">int</span>[] a = <span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[<span class=\"number\">4</span>];<span class=\"comment\">//推介使用int[] 这种方式初始化 </span></span><br><span class=\"line\"><span class=\"keyword\">int</span> c[] = &#123;<span class=\"number\">23</span>,<span class=\"number\">43</span>,<span class=\"number\">56</span>,<span class=\"number\">78</span>&#125;;<span class=\"comment\">//长度：4，索引范围：[0,3]</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p><code>ArrayList</code> 是用一个可扩容的数组来实现的 (re-sizing array)；</p>\n</li>\n<li><p><code>LinkedList</code> 是用 <code>doubly-linked list</code> 来实现的。</p>\n</li>\n<li><p><strong>数组和链表之间最大的区别</strong>就是数组是可以随机访问的（random access）。</p>\n<ul>\n<li>这个特点造成了在数组里可以通过下标用 O(1) 的时间拿到任何位置的数，而链表则做不到，只能从头开始逐个遍历。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"ArrayList-vs-Vector\"><a href=\"#ArrayList-vs-Vector\" class=\"headerlink\" title=\"ArrayList vs Vector\"></a>ArrayList vs Vector</h4><ul>\n<li><p><code>Vector</code> 是线程安全的，而 <code>ArrayList</code> 是线程不安全的；</p>\n</li>\n<li><p>扩容时扩多少的区别，文邹邹的说法就是 <code>data growth methods</code>不同，</p>\n</li>\n</ul>\n<ol>\n<li><ul>\n<li><code>Vector</code> 默认是扩大至 2 倍；</li>\n<li><code>ArrayList</code> 默认是扩大至 1.5 倍。</li>\n</ul>\n</li>\n</ol>\n<ul>\n<li>Vector 和 ArrayList 一样，也是继承自 java.util.AbstractList，底层也是用数组来实现的。</li>\n</ul>\n<h3 id=\"HashMap加载因子为什么是-0-75？\"><a href=\"#HashMap加载因子为什么是-0-75？\" class=\"headerlink\" title=\"HashMap加载因子为什么是 0.75？\"></a>HashMap加载因子为什么是 0.75？</h3><ul>\n<li><p>加载因子也叫扩容因子或负载因子，用来判断什么时候进行扩容的，假如加载因子是 0.5，HashMap 的初始化容量是 16，那么当 HashMap 中有 16*0.5=8 个元素时，HashMap 就会进行扩容。</p>\n</li>\n<li><p>那加载因子为什么是 0.75 而不是 0.5 或者 1.0 呢？</p>\n<ul>\n<li><p>这其实是出于容量和性能之间平衡的结果：</p>\n</li>\n<li><p>当加载因子设置比较大的时候，扩容的门槛就被提高了，扩容发生的频率比较低，占用的空间会比较小，但此时发生 Hash 冲突的几率就会提升，因此需要更复杂的数据结构来存储元素，这样对元素的操作时间就会增加，运行效率也会因此降低；</p>\n</li>\n<li><p>而当加载因子值比较小的时候，扩容的门槛会比较低，因此会占用更多的空间，此时元素的存储就比较稀疏，发生哈希冲突的可能性就比较小，因此操作性能会比较高。</p>\n</li>\n</ul>\n</li>\n<li><p>所以综合了以上情况就取了一个 0.5 到 1.0 的平均数 0.75 作为加载因子。</p>\n</li>\n</ul>\n<h3 id=\"当有哈希冲突时，HashMap-是如何查找并确认元素的？\"><a href=\"#当有哈希冲突时，HashMap-是如何查找并确认元素的？\" class=\"headerlink\" title=\"当有哈希冲突时，HashMap 是如何查找并确认元素的？\"></a>当有哈希冲突时，HashMap 是如何查找并确认元素的？</h3><ul>\n<li>当哈希冲突时我们需要通过判断 key 值是否相等，才确认此元素是不是我们想要的元素。</li>\n</ul>\n<h4 id=\"为什么改-equals-一定要改-hashCode-？\"><a href=\"#为什么改-equals-一定要改-hashCode-？\" class=\"headerlink\" title=\"为什么改 equals() 一定要改 hashCode()？\"></a>为什么改 equals() 一定要改 hashCode()？</h4><blockquote>\n<p>首先基于一个假设：任何两个 <code>object</code> 的 <code>hashCode</code> 都是不同的。也就是 <code>hash function</code> 是有效的。</p>\n</blockquote>\n<ul>\n<li>那么在这个条件下，有两个 <code>object</code> 是相等的，那如果不重写 <code>hashCode()</code>，算出来的哈希值都不一样，就会去到不同的 <code>buckets</code> 了，就迷失在茫茫人海中了，再也无法相认，就和 <code>equals()</code> 条件矛盾了，证毕。<ul>\n<li><code>hashCode()</code> 决定了 <code>key</code> 放在这个桶里的编号，也就是在数组里的 <code>index</code>；</li>\n<li><code>equals()</code> 是用来比较两个 <code>object</code> 是否相同的。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"HashMap和HashTable的区别\"><a href=\"#HashMap和HashTable的区别\" class=\"headerlink\" title=\"HashMap和HashTable的区别?\"></a>HashMap和HashTable的区别?</h3><ul>\n<li><p>两者父类不同</p>\n</li>\n<li><p>HashMap是继承自AbstractMap类，而Hashtable是继承自Dictionary类。不过它们都实现了同时实现了map、Cloneable（可复制）、Serializable（可序列化）这三个接口。</p>\n</li>\n<li><p>对外提供的接口不同</p>\n<ul>\n<li>Hashtable比HashMap多提供了elments() 和contains() 两个方法。elments() 方法继承自Hashtable的父类Dictionnary。elements() 方法用于返回此Hashtable中的value的枚举。contains()方法判断该Hashtable是否包含传入的value。它的作用与containsValue()一致。事实上，contansValue() 就只是调用了一下contains() 方法。</li>\n</ul>\n</li>\n<li><p>null支持不同</p>\n<ul>\n<li><p>Hashtable：key和value都不能为null。</p>\n</li>\n<li><p>HashMap：key可以为null，但是这样的key只能有一个，因为必须保证key的唯一性；可以有多个key</p>\n<p>值对应的value为null。 </p>\n</li>\n</ul>\n</li>\n<li><p>线程安全不同</p>\n<ul>\n<li><p>HashMap是线程不安全的，在多线程并发的环境下，可能会产生死锁等问题，因此需要开发人员自己处理多线程的安全问题。</p>\n</li>\n<li><p>Hashtable是线程安全的，它的每个方法上都有synchronized 关键字，因此可直接用于多线程中。</p>\n</li>\n<li><p>虽然HashMap是线程不安全的，但是它的效率远远高于Hashtable，这样设计是合理的，因为大部分的使用场景都是单线程。当需要多线程操作的时候可以使用线程安全的ConcurrentHashMap。</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"如何解决哈希冲突？\"><a href=\"#如何解决哈希冲突？\" class=\"headerlink\" title=\"如何解决哈希冲突？\"></a>如何解决哈希冲突？</h3><blockquote>\n<p>一般来说哈希冲突有两大类解决方式：</p>\n</blockquote>\n<ul>\n<li><p>Separate chaining</p>\n</li>\n<li><p>Open addressing</p>\n</li>\n<li><p>Java 中采用的是第一种 <code>Separate chaining</code>，即在发生碰撞的那个桶后面再加一条“链”来存储。</p>\n<ul>\n<li>JDK1.6 和 1.7 是用链表存储的，这样如果碰撞很多的话，就变成了在<strong>链表</strong>上的查找，worst case 就是 O(n)；</li>\n<li>JDK 1.8 进行了优化，当链表长度较大时（超过 8），会采用<strong>红黑树</strong>来存储，这样大大提高了查找效率。</li>\n</ul>\n</li>\n<li><p>第二种方法 <code>open addressing</code> 也是非常重要的思想，因为在真实的分布式系统里，有很多地方会用到 <code>hash</code> 的思想但又不适合用 <code>seprate chaining</code>。</p>\n<ul>\n<li>这种方法是顺序查找，如果这个桶里已经被占了，那就按照“某种方式”继续找下一个没有被占的桶，直到找到第一个空的。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Collection-vs-Collections\"><a href=\"#Collection-vs-Collections\" class=\"headerlink\" title=\"Collection vs Collections\"></a>Collection vs Collections</h3><ul>\n<li>Collection集合接口</li>\n<li>Collections是工具类,提供了一些静态方法。</li>\n</ul>\n","categories":["查缺补漏"],"tags":["Java","Java-Collecions-Framework","List","Set","Queue","Map"]},{"title":"查缺补漏-MySQL","url":"/posts/1254210873/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h3 id=\"Mysql基础架构图\"><a href=\"#Mysql基础架构图\" class=\"headerlink\" title=\"Mysql基础架构图\"></a>Mysql基础架构图</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/mysql/mysql%E6%9E%B6%E6%9E%84.svg\" alt=\"mysql基础架构图\"></p>\n<h4 id=\"简单介绍上图相关模块功能\"><a href=\"#简单介绍上图相关模块功能\" class=\"headerlink\" title=\"简单介绍上图相关模块功能\"></a>简单介绍上图相关模块功能</h4><ul>\n<li><p>连接器：管理连接，权限验证</p>\n</li>\n<li><p>查询缓存：命中缓存则直接返回结果</p>\n</li>\n<li><p>语法解析：词法分析，语法分析</p>\n</li>\n<li><p>查询优化：执行计划生成，索引选择</p>\n</li>\n<li><p>执行器：操作引擎，返回结果</p>\n</li>\n<li><p>存储引擎：存储数据，提供读写结构。</p>\n</li>\n</ul>\n<h4 id=\"连接器\"><a href=\"#连接器\" class=\"headerlink\" title=\"连接器\"></a>连接器</h4><blockquote>\n<p>我们需要连接到mysql服务端才能进行各种操作。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用密码登录到时候我们会使用这种格式。</span></span><br><span class=\"line\">mysql -h<span class=\"variable\">$ip</span> -P<span class=\"variable\">$port</span> -u<span class=\"variable\">$user</span> -p</span><br></pre></td></tr></table></figure>\n\n<p>执行上述命令会提示输入密码。输入完密码后就进入了mysql。</p>\n<ul>\n<li><p>如果用户名或者密码输入错误，会提示一个<code>Access denied for user</code>到错误，然后客户端程序结束执行。</p>\n</li>\n<li><p>如果用户名和密码认证通过，连接器会去权限表中查询该用户拥有的所有权限。此后该连接里面的权限逻辑判断都会依赖认证成功时候读取到的权限。</p>\n</li>\n</ul>\n<blockquote>\n<p>因此当修改用户的权限之后，如果被修改用户的在登录状态是不会修改已经连接的权限。需要让被修改权限用户从新登录。</p>\n</blockquote>\n<ul>\n<li>实际上连接的方式有多种，上面通过密码的方式只是其中的一种方式。当客户端与服务端mysql进程进程建立连接，服务器的进程就会创建一个单独的线程来专门处理与这个客户端的交互，当该客户断开与服务端连接时，服务端并不会马上销毁对应的交互线程，而是缓存起来。当另一个新的客户端连接进来的时候，在把这个缓存的线程分配给新的客户端。这样就避免的频繁创建和修改线程，节省系统的开销。但是连接线程多了也会影响服务端，所以也有默认的参数限制客户端的连接数量。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 这里是查询服务端存在的连接。</span><br><span class=\"line\">SHOW PROCESSLIST;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>我使用的阿里云的数据库，这里展示下结果集。这里需要注意，登录的账号需要有PROCESS的权限否则只能看到自己的连接信息（线程），我这里采用的root所以看到全部到。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/mysql/SHOW_PROCESSLIST.png\"></p>\n<ul>\n<li><a href=\"https://dev.mysql.com/doc/refman/5.7/en/processlist-table.html\" target=\"_blank\" rel=\"noopener\">MySQL PROCESSLIST 官方文档</a></li>\n</ul>\n<blockquote>\n<p>连接完成后如果没有执行后续操作则 Command会显示Sleep的状态，长时间Sleep会导致连接自动断开。默认的时间是8小时，也就是参数 <code>wait_timeout</code>。当客户端连接断开后，若客户端再次发出请求就会提示一个</p>\n<p><code>Lost connection to MySQL server during query</code>，此时就只能重新建立连接了。</p>\n</blockquote>\n<h5 id=\"半双工\"><a href=\"#半双工\" class=\"headerlink\" title=\"半双工\"></a>半双工</h5><ul>\n<li>MySQL客户端/服务端通信协议是<code>“半双工”</code>的：在任一时刻，要么是服务器向客户端发送数据，要么是客户端向服务器发送数据，这两个动作不能同时发生。一旦一端开始发送消息，另一端要接收完整个消息才能响应它，所以我们无法也无须将一个消息切成小块独立发送，也没有办法进行流量控制。</li>\n<li>服务器响应给用户的数据通常会很多，由多个数据包组成。但是当服务器响应客户端请求时，客户端必须完整的接收整个返回结果，而不能简单的只取前面几条结果，然后让服务器停止发送。因而在实际开发中，尽量保持查询简单且只返回必需的数据，减小通信间数据包的大小和数量是一个非常好的习惯，这也是查询中尽量避免使用<code>SELECT *</code>以及加上<code>LIMIT</code>限制的原因之一。</li>\n</ul>\n<h5 id=\"长连接与短连接\"><a href=\"#长连接与短连接\" class=\"headerlink\" title=\"长连接与短连接\"></a>长连接与短连接</h5><ul>\n<li><p>在数据库里面，长连接是指数据库建立连接，如果客户端有持续的请求则使用同一个连接，短连接是指每次执行几次短的查询就断开连接，下次查询再次创建连接。由于创建的过程复杂，一般来说尽量减少创建连接的动作，尽可能使用长连接。特别是在开发的时候出现大伙突然连接不上测试库，此时就检查下连接是不是太多了。因为连接多了会导致内存消耗特别快。</p>\n<ul>\n<li>mysql的执行过程中临时使用的内存管理是在连接线程对象里面，服务端断开的时候才会释放，为了避免内存消耗过大，每次执行较大的操作之后，可以通过<code>mysql_reset_connection</code>来重新初始化连接资源。这个操作是不需要重新做权限，只是恢复到创建的初始状态。</li>\n</ul>\n</li>\n<li><p><a href=\"https://dev.mysql.com/doc/refman/5.7/en/mysql-reset-connection.html\" target=\"_blank\" rel=\"noopener\">MySQL mysql_reset_connection 官方文档</a></p>\n</li>\n</ul>\n<h4 id=\"查询缓存\"><a href=\"#查询缓存\" class=\"headerlink\" title=\"查询缓存\"></a>查询缓存</h4><blockquote>\n<p> 一个不被建议使用的功能，在新版的8.0中已经被删除了。总结就是弊大于利。</p>\n</blockquote>\n<ul>\n<li>建立完成后，假设执行一次<code>SELECT</code>语句，执行逻辑就会到第二部查询缓存。mysql拿到一个查询之后，会先到缓存中寻找释放有完全对应的，因为之前执行的查询语句和结果集会直接被缓存起来，以<code>Keys-value</code>的形式。keys是查询语句-value是查询结果集。如果能命中这个key则直接返回value。咋一看挺有用的，但实际上查询缓存的实效的太频繁。并且keys的命中条件太不聪明了，<code>如果两次查询语句在任何的字符上存在不通（空格、大小写）</code>都不会缓存命中。为什么会频繁失效，因为如果对查询语句中的表进行更新，就会导致缓存失效。比如<code>INSERT、UPDATE 、DELETE 、TRUNCATE TABLE 、ALTER TABLE </code>等等就会导致缓存失效。</li>\n</ul>\n<h4 id=\"语法解析\"><a href=\"#语法解析\" class=\"headerlink\" title=\"语法解析\"></a>语法解析</h4><blockquote>\n<p>如果没有命中查询缓存，就要开始执行sql语句了。mysql需要做什么，因此需要对sql进行解析。MySQL通过关键字将SQL语句进行解析，并生成一颗对应的解析树。这个过程解析器主要通过语法规则来验证和解析。比如SQL中是否使用了错误的关键字或者关键字的顺序是否正确等等。预处理则会根据MySQL规则进一步检查解析树是否合法。比如检查要查询的数据表和数据列是否存在等等。</p>\n</blockquote>\n<ul>\n<li>本质上发送过来的是一个文本信息，这里就需要对该文本信息进行编译，涉及到<code>词法解析</code>、<code>语法解析</code>、<code>语义解析</code>等阶段。需要注意的是，这里会对sql语句进行一些检查，比如设计的相关表、表字段。这里检查通过的才会进入查询优化模块。</li>\n<li>根据SQL语言的功能可以划分成4个部分<ul>\n<li>DDL，英文叫做 Data Definition Language，也就是数据定义语言，它用来定义我们的数据库对象，包括数据库、数据表和列。通过使用 DDL，我们可以创建，删除和修改数据库和表结构。</li>\n<li>DML，英文叫做 Data Manipulation Language，数据操作语言，我们用它操作和数据库相关的记录，比如增加、删除、修改数据表中的记录。</li>\n<li>DCL，英文叫做 Data Control Language，数据控制语言，我们用它来定义访问权限和安全级别。</li>\n<li>DQL，英文叫做 Data Query Language，数据查询语言，我们用它查询想要的记录，它是 SQL 语言的重中之重。在实际的业务中，我们绝大多数情况下都是在和查询打交道，因此学会编写正确且高效的查询语句，是学习的重点。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"查询优化\"><a href=\"#查询优化\" class=\"headerlink\" title=\"查询优化\"></a>查询优化</h4><blockquote>\n<p>通过之前的语法解析，基本可以判定语法树是合法的，此时mysql就知道文本内容要做什么。</p>\n</blockquote>\n<ul>\n<li>mysql会对查询语句进行优化，优化的结果就是生成一个执行计划，这个计划会表明使用了那些查询索引，表之间的连接是什么样子的。有时候出现多种执行方式，只是效率不通，优化器会决定使用哪一个执行方案，这个时候就涉及到<code>EXPLAIN</code>语句，该语句可以查看sql到执行计划，这将涉及到查询优化。</li>\n<li>MySQL的查询优化器是一个非常复杂的部件，它使用了非常多的优化策略来生成一个最优的执行计划。<ul>\n<li>重新定义表的关联顺序（多张表关联查询时，并不一定按照SQL中指定的顺序进行，但有一些技巧可以指定关联顺序）</li>\n<li>优化函数</li>\n<li>提前终止查询（比如：使用Limit时，查找到满足数量的结果集后会立即终止查询）</li>\n<li>优化排序（在老版本MySQL会使用两次传输排序，即先读取行指针和需要排序的字段在内存中对其排序，然后再根据排序结果去读取数据行，而新版本采用的是单次传输排序，也就是一次读取所有的数据行，然后根据给定的列排序。对于<code>I/O</code>密集型应用，效率会高很多。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"执行器\"><a href=\"#执行器\" class=\"headerlink\" title=\"执行器\"></a>执行器</h4><blockquote>\n<p>进入到执行sql到环节。</p>\n</blockquote>\n<ul>\n<li>通过之前到查询优化，进入执行阶段，此时会先判断该连接用户是否有相关表的权限，如果没有会返回权限错误。如果有权限就会打开表，执行器会根据表定义的引擎去使用这个引擎提供的接口完成流程。</li>\n</ul>\n<h4 id=\"存储引擎\"><a href=\"#存储引擎\" class=\"headerlink\" title=\"存储引擎\"></a>存储引擎</h4><blockquote>\n<p> 关于存储引擎，这里明确提醒。不是三种也不是四种。而是多种因为随时可能出现新的引擎。</p>\n</blockquote>\n<ul>\n<li>我们常用的就是<code>InnoDB</code>和<code>MyISAM</code>，其它的不常见就不做过多介绍。mysql现在默认的引擎是<code>InnoDB</code>所以主要也是了解<code>InnoDB</code></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看当前服务支持的存储引擎</span></span><br><span class=\"line\">SHOW ENGINES;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/mysql/SHOW_ENGINES.png\"></p>\n<a id=\"more\"></a>\n\n<h4 id=\"innodb\"><a href=\"#innodb\" class=\"headerlink\" title=\"innodb\"></a>innodb</h4><ul>\n<li>插入缓冲（insert buffer),</li>\n<li>二次写(double write),</li>\n<li>自适应哈希索引(ahi),</li>\n<li>预读(read ahead)</li>\n<li>支持事务操作，具有事务 ACID 隔离特性，默认的隔离级别是<code>可重复读(repetable-read)</code>、通过MVCC（并发版本控制）来实现的。能够解决<code>脏读</code>和<code>不可重复读</code>的问题。</li>\n<li>InnoDB 支持外键操作。</li>\n<li>InnoDB 默认的锁粒度<code>行级锁</code>，并发性能比较好，会发生死锁的情况。</li>\n<li>和 MyISAM 一样的是，InnoDB 存储引擎也有 <code>.frm文件存储表结构</code> 定义，但是不同的是，InnoDB 的表数据与索引数据是存储在一起的，都位于 B+ 数的叶子节点上，而 MyISAM 的表数据和索引数据是分开的。</li>\n<li>InnoDB 有安全的日志文件，这个日志文件用于恢复因数据库崩溃或其他情况导致的数据丢失问题，保证数据的一致性。</li>\n<li>InnoDB 和 MyISAM 支持的索引类型相同，但具体实现因为文件结构的不同有很大差异。</li>\n<li>增删改查性能方面，如果执行大量的增删改操作，推荐使用 InnoDB 存储引擎，它在删除操作时是对行删除，不会重建表。</li>\n</ul>\n<h5 id=\"myisam与innodb\"><a href=\"#myisam与innodb\" class=\"headerlink\" title=\"myisam与innodb\"></a>myisam与innodb</h5><ul>\n<li>InnoDB支持事物，而MyISAM不支持事物</li>\n<li>InnoDB支持行级锁，而MyISAM支持表级锁</li>\n<li>InnoDB支持MVCC, 而MyISAM不支持</li>\n<li>InnoDB支持外键，而MyISAM不支持</li>\n<li>InnoDB不支持全文索引，而MyISAM支持。</li>\n</ul>\n<h3 id=\"索引\"><a href=\"#索引\" class=\"headerlink\" title=\"索引\"></a>索引</h3><h4 id=\"主键\"><a href=\"#主键\" class=\"headerlink\" title=\"主键\"></a>主键</h4><ul>\n<li>数据库表中对储存数据对象予以唯一和完整标识的数据列或属性的组合。一个数据列只能有一个主键，且主键的取值不能缺失，即不能为空值（Null）。</li>\n</ul>\n<h4 id=\"超键\"><a href=\"#超键\" class=\"headerlink\" title=\"超键\"></a>超键</h4><ul>\n<li>在关系中能唯一标识元组的属性集称为关系模式的超键。一个属性可以为作为一个超键，多个属性组合在一起也可以作为一个超键。超键包含候选键和主键。</li>\n</ul>\n<h4 id=\"候选键\"><a href=\"#候选键\" class=\"headerlink\" title=\"候选键\"></a>候选键</h4><ul>\n<li>是最小超键，即没有冗余元素的超键。</li>\n</ul>\n<h4 id=\"外键\"><a href=\"#外键\" class=\"headerlink\" title=\"外键\"></a>外键</h4><ul>\n<li>在一个表中存在的另一个表的主键称此表的外键。</li>\n</ul>\n<h4 id=\"为什么要使用自增列作为主键？\"><a href=\"#为什么要使用自增列作为主键？\" class=\"headerlink\" title=\"为什么要使用自增列作为主键？\"></a>为什么要使用自增列作为主键？</h4><blockquote>\n<p>自增ID有序，会按顺序往最后插入，而UUID无序，随机生成，随机插入，会造成频繁页分裂，内存碎片化，大量随机IO</p>\n</blockquote>\n<ul>\n<li><p>如果没有显示的指定主键，则InnoDB会选择一个不包含NULL值的唯一索引作为主键索引。如果不满足条件，InnoDB会选择内置6字节长度的ROWID作为隐含的聚集索引。</p>\n</li>\n<li><p>InnoDB数据记录本身存放主索引（B+Tree）的叶子结点上面，同一个叶子结点内的各条数据是按照主键顺序存放。因此每次插入数据的时候，mysql会根据其主键插入适当的位置，如果页达到装载因子条件，则开辟一个新的页。</p>\n</li>\n<li><p>使用非自增，每次插入的值都是几乎无序的，导致叶节点不够紧凑，频繁移动分叶造成大量碎片。增加维护工作。</p>\n</li>\n<li><p>InnoDB引擎的自增值，其实是<strong>保存在了内存</strong>里，并且到了MySQL 8.0版本后，才有了“自增值持久化”的能力。</p>\n</li>\n</ul>\n<h4 id=\"索引是什么\"><a href=\"#索引是什么\" class=\"headerlink\" title=\"索引是什么\"></a>索引是什么</h4><blockquote>\n<p>在了解索引之前，大概理解下mysql存储数据的大小划分<code>表空间 -&gt; 段 -&gt; 区 -&gt; 数据页</code> 。</p>\n</blockquote>\n<ul>\n<li><p>索引是对数据库表中一或多个列的值进行排序的结构，是帮助MySQL高效获取数据的数据结构</p>\n</li>\n<li><p>索引就是加快检索表中数据的方法。数据库的索引类似于书籍的索引。在书籍中，索引允许用户不必翻阅完整个书就能迅速地找到所需要的信息。在数据库中，索引也允许数据库程序迅速地找到表中的数据，而不必扫描整个数据库。</p>\n</li>\n<li><p>索引优缺点</p>\n<ol>\n<li>索引加快数据库的检索速度。</li>\n<li>索引降低了插入、删除、修改等维护任务的速度。</li>\n<li>唯一索引可以确保每一行数据的唯一性。</li>\n<li>通过使用索引，可以在查询的过程中使用优化隐藏器，提高系统的性能。</li>\n<li>索引需要占物理和数据空间。</li>\n</ol>\n</li>\n</ul>\n<h5 id=\"表空间、段、区、数据页\"><a href=\"#表空间、段、区、数据页\" class=\"headerlink\" title=\"表空间、段、区、数据页\"></a>表空间、段、区、数据页</h5><blockquote>\n<p>记录是按照行来存储的，但是数据库的读取并不以行为单位，否则一次读取（也就是一次 I/O 操作）只能处理一行数据，效率会非常低。因此在数据库中，不论读一行，还是读多行，都是将这些行所在的页进行加载。也就是说，数据库管理存储空间的基本单位是页（Page）。</p>\n</blockquote>\n<ul>\n<li>一个页中可以存储多个行记录（Row），同时在数据库中，还存在着区（Extent）、段（Segment）和表空间（Tablespace）。行、页、区、段、表空间的关系如下图所示：</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/MysqlInnoDB%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png\"></p>\n<h5 id=\"索引的优点\"><a href=\"#索引的优点\" class=\"headerlink\" title=\"索引的优点\"></a>索引的优点</h5><ul>\n<li><p>天生排序</p>\n</li>\n<li><p>快速查找</p>\n</li>\n</ul>\n<h5 id=\"索引的缺点\"><a href=\"#索引的缺点\" class=\"headerlink\" title=\"索引的缺点\"></a>索引的缺点</h5><ul>\n<li>占用空间</li>\n<li>降低更新表的速度。</li>\n</ul>\n<h5 id=\"注意点\"><a href=\"#注意点\" class=\"headerlink\" title=\"注意点\"></a>注意点</h5><ul>\n<li><p>小表使用全表扫描更快，中大表才使用索引。超级大表索引基本无效。</p>\n</li>\n<li><p>索引实现，分成 2 种：聚集索引和辅助索引（也叫二级索引或者非聚集索引）</p>\n</li>\n<li><p>功能区分，分为 6 种：普通索引，唯一索引，主键索引，复合索引，外键索引，全文索引。</p>\n<p>1、普通索引：最基本的索引，没有任何约束。<br>2、唯一索引：与普通索引类似，但具有唯一性约束。<br>3、主键索引：<strong>特殊的唯一索引，不允许有空值</strong>。<br>4、复合索引：将多个列组合在一起创建索引，可以覆盖多个列。<br>5、外键索引：只有InnoDB类型的表才可以使用外键索引，保证数据的一致性、完整性和实现级联操作。<br>6、全文索引：MySQL 自带的全文索引只能用于 InnoDB、MyISAM ，并且只能对英文进行全文检索，一般使用全文索引引擎（ES，Solr）。</p>\n</li>\n<li><p><code>注意：主键就是唯一索引，但是唯一索引不一定是主键，唯一索引可以为空，但是空值只能有一个，主键不能为空。</code></p>\n</li>\n</ul>\n<h4 id=\"常见索引类型\"><a href=\"#常见索引类型\" class=\"headerlink\" title=\"常见索引类型\"></a>常见索引类型</h4><blockquote>\n<p>索引是存储在一张表中特定列上的<code>数据结构</code>，索引是在列上创建的。并且，索引是一种数据结构。</p>\n</blockquote>\n<h5 id=\"全局索引-FULLTEXT\"><a href=\"#全局索引-FULLTEXT\" class=\"headerlink\" title=\"全局索引(FULLTEXT)\"></a>全局索引(FULLTEXT)</h5><ul>\n<li>全局索引，目前只有 MyISAM 引擎支持全局索引，它的出现是为了解决针对文本的模糊查询效率较低的问题。</li>\n</ul>\n<h5 id=\"哈希索引-HASH\"><a href=\"#哈希索引-HASH\" class=\"headerlink\" title=\"哈希索引(HASH)\"></a>哈希索引(HASH)</h5><ul>\n<li>哈希索引是 MySQL 中用到的唯一 key-value 键值对的数据结构，很适合作为索引。HASH 索引具有一次定位的好处，不需要像树那样逐个节点查找，但是这种查找适合应用于查找单个键的情况，对于范围查找，HASH 索引的性能就会很低。</li>\n</ul>\n<h5 id=\"B-Tree索引\"><a href=\"#B-Tree索引\" class=\"headerlink\" title=\"B-Tree索引\"></a>B-Tree索引</h5><ul>\n<li>B 就是 Balance 的意思，BTree 是一种平衡树，它有很多变种，最常见的就是 B+ Tree，它被 MySQL 广泛使用。</li>\n</ul>\n<h5 id=\"R-Tree索引\"><a href=\"#R-Tree索引\" class=\"headerlink\" title=\"R-Tree索引\"></a>R-Tree索引</h5><ul>\n<li>R-Tree 在 MySQL 很少使用，仅支持 geometry 数据类型，支持该类型的存储引擎只有MyISAM、BDb、InnoDb、NDb、Archive几种，相对于 B-Tree 来说，R-Tree 的优势在于范围查找。</li>\n</ul>\n<h4 id=\"B-Tree与Hash索引的区别\"><a href=\"#B-Tree与Hash索引的区别\" class=\"headerlink\" title=\"B+Tree与Hash索引的区别\"></a>B+Tree与Hash索引的区别</h4><ol>\n<li>B+Tree是一个平衡多叉树，从根节点到每个叶子节点点高度差值不超过1，同层级的节点互相有指针互相链接，是有序的。</li>\n<li>Hash索引是采用一定的Hash算法，把健值换成哈希值，检索的时候不需要类似b+树从根节点逐渐查找，值需要一次哈希运算即可，是无序的。</li>\n<li>Hash索引适合等值查询，哈希索引具有绝对优势（前提是：没有⼤量重复键值，如果⼤量重复键值时，哈希索引的效率很低，因为存在所谓的 哈希碰撞问题。不使用范围查询、也不支持索引完成排序。不支持联合索引最左匹配原则。通过列的基数很大也不建议使用Hash索引。</li>\n</ol>\n<h4 id=\"InnoDB存储引擎的B-树索引\"><a href=\"#InnoDB存储引擎的B-树索引\" class=\"headerlink\" title=\"InnoDB存储引擎的B+树索引\"></a>InnoDB存储引擎的B+树索引</h4><ul>\n<li>每个索引都对应一棵B+树，B+树分为好多层，最下边一层是叶子节点，其余的是内节点。所有用户记录都存储在B+树的叶子节点，所有目录项记录都存储在内节点。</li>\n<li>InnoDB存储引擎会自动为主键（如果没有它会自动帮我们添加）建立聚簇索引，聚簇索引的叶子节点包含完整的用户记录。</li>\n<li>我们可以为自己感兴趣的列建立二级索引，二级索引的叶子节点包含的用户记录由索引列 + 主键组成，所以如果想通过二级索引来查找完整的用户记录的话，需要通过回表操作，也就是在通过二级索引找到主键值之后再到聚簇索引中查找完整的用户记录。</li>\n<li>B+树中每层节点都是按照索引列值从小到大的顺序排序而组成了双向链表，而且每个页内的记录（不论是用户记录还是目录项记录）都是按照索引列的值从小到大的顺序而形成了一个单链表。如果是联合索引的话，则页面和记录先按照联合索引前边的列排序，如果该列值相同，再按照联合索引后边的列排序。</li>\n<li>通过索引查找记录是从B+树的根节点开始，一层一层向下搜索。由于每个页面都按照索引列的值建立了Page Directory（页目录），所以在这些页面中的查找非常快。</li>\n<li>二者SELECT COUNT(*)哪个更快，为什么<ul>\n<li>myisam更快，因为myisam内部维护了一个计数器，可以直接调取。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"索引失效\"><a href=\"#索引失效\" class=\"headerlink\" title=\"索引失效\"></a>索引失效</h4><ul>\n<li>两张表联合查询的时候表的编码集不一样会导致索引失效。</li>\n<li>列类型是字符串，一定要在条件中将数据用<code>引号引用</code>，否则失效（隐式转换）</li>\n<li>or语句前后未使用索引字段 ，字段A做了索引 WHERE A = 1 OR B = 2 这时候也不回走索引。</li>\n<li>like未使用最左前缀，where A like “%China”。</li>\n<li>在索引上使用函数 、!= 、&lt;&gt; 、not in 。</li>\n<li>where a = b + 1 查询条件做运算</li>\n<li>is null 、is not null</li>\n</ul>\n<h4 id=\"覆盖索引和回表\"><a href=\"#覆盖索引和回表\" class=\"headerlink\" title=\"覆盖索引和回表\"></a>覆盖索引和回表</h4><ul>\n<li>覆盖索引指的是在一次查询中，如果一个索引包含或者说覆盖所有需要查询的字段的值，我们就称之为覆盖索引，而不再需要回表查询。而要确定一个查询是否是覆盖索引，我们只需要explain sql语句看Extra的结果是否是“Using index”即可。</li>\n</ul>\n<h4 id=\"索引下推\"><a href=\"#索引下推\" class=\"headerlink\" title=\"索引下推\"></a>索引下推</h4><blockquote>\n<p>在根据索引查询过程中就根据查询条件过滤掉一些记录，减少最后的回表操作</p>\n</blockquote>\n<h4 id=\"使用索引查询一定能提高查询的性能吗？\"><a href=\"#使用索引查询一定能提高查询的性能吗？\" class=\"headerlink\" title=\"使用索引查询一定能提高查询的性能吗？\"></a>使用索引查询一定能提高查询的性能吗？</h4><blockquote>\n<p>通常,通过索引查询数据比全表扫描要快.但是我们也必须注意到它的代价.</p>\n</blockquote>\n<ul>\n<li>索引需要空间来存储,也需要定期维护, 每当有记录在表中增减或索引列被修改时,索引本身也会被修改. 这意味着每条记录的INSERT,DELETE,UPDATE将为此多付出4,5 次的磁盘I/O. 因为索引需要额外的存储空间和处理,那些不必要的索引反而会使查询反应时间变慢.使用索引查询不一定能提高查询性能,索引范围查询(INDEX RANGE SCAN)适用于两种情况:</li>\n<li>基于一个范围的检索,一般查询返回结果集小于表中记录数的30%</li>\n<li>基于非唯一性索引的检索</li>\n</ul>\n<h3 id=\"事务\"><a href=\"#事务\" class=\"headerlink\" title=\"事务\"></a>事务</h3><blockquote>\n<p>事务（Transaction）是并发控制的基本单位。所谓的事务，它是一个操作序列，这些操作要么都执行，要么都不执行，它是一个不可分割的工作单位。事务是数据库维护数据一致性的单位，在每个事务结束时，都能保持数据一致性。</p>\n</blockquote>\n<h4 id=\"ACID\"><a href=\"#ACID\" class=\"headerlink\" title=\"ACID\"></a>ACID</h4><blockquote>\n<p>一说到 MySQL 事务，你肯定能想起来四大特性：<code>原子性</code>、<code>一致性</code>、<code>隔离性</code>、<code>持久性</code>。</p>\n<p>ACID模式是一组数据库设计原则强调的是，对于业务数据和关键任务应用重要的可靠性方面。MySQL包含诸如的组件<code>InnoDB</code>存储引擎与ACID模型紧密结合，因此数据不会损坏，并且不会因软件崩溃和硬件故障等特殊情况而导致结果失真。当您依赖符合ACID的功能时，您无需重新发明一致性检查和崩溃恢复机制。如果您有其他软件安全措施，超可靠硬件或可以容忍少量数据丢失或不一致的应用程序，您可以调整MySQL设置以交换一些ACID可靠性以获得更高的性能或吞吐量。</p>\n</blockquote>\n<h4 id=\"原子性-Atomicity\"><a href=\"#原子性-Atomicity\" class=\"headerlink\" title=\"原子性(Atomicity)\"></a>原子性(Atomicity)</h4><ul>\n<li>原子性指的就是 MySQL 中的包含事务的操作要么<code>全部成功</code>、要么全部<code>失败回滚</code>，因此事务的操作如果成功就必须要全部应用到数据库，如果操作失败则不能对数据库有任何影响。</li>\n</ul>\n<h4 id=\"一致性-Consistency\"><a href=\"#一致性-Consistency\" class=\"headerlink\" title=\"一致性(Consistency)\"></a>一致性(Consistency)</h4><ul>\n<li>一致性指的是一个事务在执行前后其状态一致。比如 A 和 B 加起来的钱一共是 1000 元，那么不管 A 和 B 之间如何转账，转多少次，事务结束后两个用户的钱加起来还得是 1000，这就是事务的一致性。</li>\n</ul>\n<h4 id=\"持久性-Durability\"><a href=\"#持久性-Durability\" class=\"headerlink\" title=\"持久性(Durability)\"></a>持久性(Durability)</h4><ul>\n<li>持久性指的是一旦事务提交，那么发生的改变就是永久性的，即使数据库遇到特殊情况比如故障的时候也不会产生干扰。</li>\n</ul>\n<h4 id=\"隔离性-Isolation\"><a href=\"#隔离性-Isolation\" class=\"headerlink\" title=\"隔离性(Isolation)\"></a>隔离性(Isolation)</h4><blockquote>\n<p>当多个事务同时进行时，就有可能出现<code>脏读(dirty read)</code>、<code>不可重复读(non-repeatable read)</code>、<code>幻读(phantom read)</code> 的情况，为了解决这些并发问题，提出了隔离性的概念。</p>\n</blockquote>\n<ul>\n<li><code>读未提交</code>：读未提交指的是一个事务在提交之前，它所做的修改就能够被其他事务所看到。</li>\n<li><code>读已提交</code>：读已提交指的是一个事务在提交之后，它所做的变更才能够让其他事务看到。</li>\n<li><code>可重复读</code>：可重复读指的是一个事务在执行的过程中，看到的数据是和启动时看到的数据是一致的。未提交的变更对其他事务不可见。</li>\n<li><code>串行化</code>：顾名思义是对于同一行记录，<code>写</code>会加<code>写锁</code>，<code>读</code>会加<code>读锁</code>。当出现读写锁冲突的时候，后访问的事务必须等前一个事务执行完成，才能继续执行。</li>\n</ul>\n<h5 id=\"隔离性四个特性\"><a href=\"#隔离性四个特性\" class=\"headerlink\" title=\"隔离性四个特性\"></a>隔离性四个特性</h5><blockquote>\n<p>最重要的就是一致性。而<strong>一致性</strong>由原子性，隔离性，持久性来保证。</p>\n</blockquote>\n<ul>\n<li>原子性由 Undo log 保证。Undo Log 会保存每次变更之前的记录，从而在发生错误时进行回滚。</li>\n<li>隔离性由 MVCC 和 Lock 保证。</li>\n<li>持久性由 Redo Log 保证。每次真正修改数据之前，都会将记录写到 Redo Log 中，只有 Redo Log 写入成功，才会真正的写入到 B+ 树中，如果提交之前断电，就可以通过 Redo Log 恢复记录。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>事务隔离级别</th>\n<th>值</th>\n<th>脏读</th>\n<th>不可重复读</th>\n<th>幻读</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>读未提交（read-uncommitted）</td>\n<td>1</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>读已提交（read-committed）</td>\n<td>2</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>可重复读（repeatable-read）</td>\n<td>3</td>\n<td>否</td>\n<td>否</td>\n<td>是（x）</td>\n</tr>\n<tr>\n<td>串行化（serializable）</td>\n<td>4</td>\n<td>否</td>\n<td>否</td>\n<td>否</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>读已提交和可重复读实现原理就是MVCC Read View不同的生成时机。可重复读只在事务开始时生成一个Read View；读已提交每次执行前都会生成Read View。</p>\n</blockquote>\n<h5 id=\"读未提交\"><a href=\"#读未提交\" class=\"headerlink\" title=\"读未提交\"></a>读未提交</h5><blockquote>\n<p>一个事物未提交的时候，它做的数据变更就能被其它事物看到。</p>\n</blockquote>\n<ul>\n<li>原理：直接读取数据，不能解决任何并发问题</li>\n</ul>\n<h5 id=\"读提交\"><a href=\"#读提交\" class=\"headerlink\" title=\"读提交\"></a>读提交</h5><blockquote>\n<p>一个事物提交后，它做的数据变更才能被其它事物看到。</p>\n</blockquote>\n<ul>\n<li>原理：利用MVCC实现，每一句语句执行前都会生成Read View（一致性视图）</li>\n</ul>\n<h5 id=\"可重复读-（默认隔离级别）\"><a href=\"#可重复读-（默认隔离级别）\" class=\"headerlink\" title=\"可重复读 （默认隔离级别）\"></a>可重复读 （<strong>默认隔离级别</strong>）</h5><blockquote>\n<p>一个事物执行的过程中看到的数据，总是跟这个事物在启动时候看的数据一致。只有事务开始时会创建Read View，之后事务里的其他查询都用这个Read View。解决了脏读、不可重复读，快照读（普通查询，读取历史数据）</p>\n</blockquote>\n<ul>\n<li>原理：使用MVCC解决了幻读，当前读（读取最新提交数据）通过间隙锁解决幻读（lock in share mode、for update、update、detete、insert），间隙锁在可重复读下才生效。</li>\n</ul>\n<h5 id=\"串行化\"><a href=\"#串行化\" class=\"headerlink\" title=\"串行化\"></a>串行化</h5><blockquote>\n<p>对同一行数据 <code>写</code>会加<code>写锁</code>,<code>读</code>会加<code>读锁</code>。当出现读写冲突的时候，必须按数据执行事务。</p>\n</blockquote>\n<ul>\n<li>原理：使用锁，读加共享锁，写加排他锁，串行执行</li>\n</ul>\n<h4 id=\"并发事务的问题\"><a href=\"#并发事务的问题\" class=\"headerlink\" title=\"并发事务的问题\"></a>并发事务的问题</h4><h5 id=\"脏读\"><a href=\"#脏读\" class=\"headerlink\" title=\"脏读\"></a>脏读</h5><blockquote>\n<p>一个事务正在对一条记录进行修改，在这个事务完成并提交前，这条记录的数据就处于不一致状态。这时，另一个事务也来读取同一条记录，如果不加控制，第二个事务读取了这些“脏”数据，并据此做进一步的处理，就会产生未提交的数据依赖关系。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th align=\"left\">时间</th>\n<th align=\"left\">事务A</th>\n<th align=\"left\">事务B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">T1</td>\n<td align=\"left\">开启事务</td>\n<td align=\"left\">开启事务</td>\n</tr>\n<tr>\n<td align=\"left\">T2</td>\n<td align=\"left\">查询账户余额为1000</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">T3</td>\n<td align=\"left\">充值500，余额修改为1500</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">T4</td>\n<td align=\"left\"></td>\n<td align=\"left\">查询余额为<strong>1500</strong></td>\n</tr>\n<tr>\n<td align=\"left\">T5</td>\n<td align=\"left\">撤销事务，余额改回<strong>1000</strong></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">T6</td>\n<td align=\"left\"></td>\n<td align=\"left\">汇入500，余额修改为<strong>2000</strong></td>\n</tr>\n<tr>\n<td align=\"left\">T7</td>\n<td align=\"left\"></td>\n<td align=\"left\">提交事务</td>\n</tr>\n</tbody></table>\n<h5 id=\"不可重复读\"><a href=\"#不可重复读\" class=\"headerlink\" title=\"不可重复读\"></a>不可重复读</h5><blockquote>\n<p>一个事务在读取某些数据后的某个时间，再次读取以前读过的数据，却发现其读出的数据已经发生了变更、或者某些记录已经被删除了。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>时间</th>\n<th>事务A</th>\n<th>事务B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>T1</td>\n<td>开启事务</td>\n<td>开启事务</td>\n</tr>\n<tr>\n<td>T2</td>\n<td>select * from user where user_id=100 假设为小明的用户信息</td>\n<td></td>\n</tr>\n<tr>\n<td>T3</td>\n<td></td>\n<td>将user_id=100的用户信息对应的年龄修改为<strong>18</strong></td>\n</tr>\n<tr>\n<td>T4</td>\n<td></td>\n<td>提交事务</td>\n</tr>\n<tr>\n<td>T5</td>\n<td>再次查询发现用户的<strong>年龄变更</strong>了</td>\n<td></td>\n</tr>\n<tr>\n<td>T6</td>\n<td>…</td>\n<td></td>\n</tr>\n<tr>\n<td>T7</td>\n<td>提交事务</td>\n<td></td>\n</tr>\n</tbody></table>\n<h5 id=\"幻读\"><a href=\"#幻读\" class=\"headerlink\" title=\"幻读\"></a>幻读</h5><blockquote>\n<p>一个事务按相同的查询条件重新读取以前检索过的数据，却发现其它事务插入了满足其查询条件的新数据。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>时间</th>\n<th>事务A</th>\n<th>事务B</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>T1</td>\n<td>开启事务</td>\n<td>开启事务</td>\n</tr>\n<tr>\n<td>T2</td>\n<td>select * from user where age=18 假设得到两条记录</td>\n<td></td>\n</tr>\n<tr>\n<td>T3</td>\n<td></td>\n<td>向user表插入一条age=18的新记录</td>\n</tr>\n<tr>\n<td>T4</td>\n<td></td>\n<td>提交事务</td>\n</tr>\n<tr>\n<td>T5</td>\n<td><strong>再次查询得到三条记录</strong></td>\n<td></td>\n</tr>\n<tr>\n<td>T6</td>\n<td>..</td>\n<td></td>\n</tr>\n<tr>\n<td>T7</td>\n<td>提交事务</td>\n<td></td>\n</tr>\n</tbody></table>\n<h5 id=\"幻读和不可重复读的区别\"><a href=\"#幻读和不可重复读的区别\" class=\"headerlink\" title=\"幻读和不可重复读的区别\"></a>幻读和不可重复读的区别</h5><ul>\n<li>不可重复读的重点是修改：在同一事务中，相同的条件，第一次和第二次读到的数据不一致（中间有其它事务提交了修改）。</li>\n<li>幻读的重点是新增或者删除：在同一事务中，相同的条件，第一次和第二次读到的记录数不一样（中间有其它事务提交了新增或者删除）。</li>\n</ul>\n<h3 id=\"LOCK\"><a href=\"#LOCK\" class=\"headerlink\" title=\"LOCK\"></a>LOCK</h3><blockquote>\n<p>这很重要不管是面试工作，还是排查异常，出现问题的时候需要发现、定位、解决能力。也是开发人员必须掌握的一项能力。</p>\n</blockquote>\n<h4 id=\"理解下锁几种维度\"><a href=\"#理解下锁几种维度\" class=\"headerlink\" title=\"理解下锁几种维度\"></a>理解下锁几种维度</h4><h5 id=\"类型维度\"><a href=\"#类型维度\" class=\"headerlink\" title=\"类型维度\"></a>类型维度</h5><ul>\n<li><p>共享锁（读锁 / S 锁）</p>\n</li>\n<li><p>排它锁（写锁 / X 锁）类型细分：</p>\n<ul>\n<li><p>意向共享锁</p>\n</li>\n<li><p>意向排他（互斥）锁</p>\n</li>\n</ul>\n</li>\n<li><p>悲观锁（使用锁，即 for update）</p>\n</li>\n<li><p>乐观锁（使用版本号字段，类似 CAS 机制，即用户自己控制。缺点：并发很高的时候，多了很多无用的重试）</p>\n</li>\n</ul>\n<h5 id=\"锁的粒度（粒度维度）\"><a href=\"#锁的粒度（粒度维度）\" class=\"headerlink\" title=\"锁的粒度（粒度维度）\"></a>锁的粒度（粒度维度）</h5><ul>\n<li>表锁</li>\n<li>页锁（Mysql BerkeleyDB 引擎）</li>\n<li>行锁（InnoDB）</li>\n<li>全剧锁 （锁的是整个 <code>database</code>）全库备份的时候时全局锁</li>\n</ul>\n<h5 id=\"锁的算法（算法维度）\"><a href=\"#锁的算法（算法维度）\" class=\"headerlink\" title=\"锁的算法（算法维度）\"></a>锁的算法（算法维度）</h5><ul>\n<li>Record Lock（单行记录）</li>\n<li>Gap Lock（间隙锁，锁定一个范围，但不包含锁定记录）</li>\n<li>Next-Key Lock（Record Lock + Gap Lock，锁定一个范围，并且锁定记录本身， MySql 防止幻读，就是使用此锁实现）</li>\n</ul>\n<h5 id=\"Record-Lock\"><a href=\"#Record-Lock\" class=\"headerlink\" title=\"Record Lock\"></a>Record Lock</h5><blockquote>\n<p><strong>对单个记录加锁</strong>,行锁只有在事务结束的时候才会释放。也就时两阶段协议完成后。</p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## 对id=3的记录加S型Record Lock S锁</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">FROM</span> <span class=\"string\">`usr_info`</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">id</span> = <span class=\"number\">3</span> <span class=\"keyword\">LOCK</span> <span class=\"keyword\">IN</span> <span class=\"keyword\">SHARE</span> <span class=\"keyword\">MODE</span>;</span><br><span class=\"line\"><span class=\"comment\">## 对id=3的记录加S型Record Lock x锁</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">FROM</span> <span class=\"string\">`usr_info`</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">id</span> = <span class=\"number\">3</span> <span class=\"keyword\">FOR</span> <span class=\"keyword\">UPDATE</span>;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"Gap-Lock\"><a href=\"#Gap-Lock\" class=\"headerlink\" title=\"Gap Lock\"></a>Gap Lock</h5><blockquote>\n<p><strong>锁住记录前面的间隙，不允许插入记录</strong></p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">##不允许别的事务在id=3的记录前面的间隙插入新记录，即id值在(1, 3)这个区间内的记录是不允许立即插入的。直到加间隙锁的事务提交后，id值在(1, 3)这个区间中的记录才可以被提交。</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">FROM</span> <span class=\"string\">`usr_info`</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">id</span> &lt; <span class=\"number\">3</span> <span class=\"keyword\">AND</span> <span class=\"keyword\">id</span> &gt; <span class=\"number\">1</span> <span class=\"keyword\">LOCK</span> <span class=\"keyword\">IN</span> <span class=\"keyword\">SHARE</span> <span class=\"keyword\">MODE</span>;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"Next-Key-Lock\"><a href=\"#Next-Key-Lock\" class=\"headerlink\" title=\"Next-Key Lock\"></a>Next-Key Lock</h5><blockquote>\n<p><strong>同时锁住数据和数据前面的间隙，即数据和数据前面的间隙都不允许插入记录</strong></p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 对id=3的聚集索引记录加S型Record Lock</span></span><br><span class=\"line\"><span class=\"comment\">-- 对id&gt;1的所有聚集索引记录加S型Next-key Lock（包括Supremum伪记录）</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">FROM</span> <span class=\"string\">`usr_info`</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">id</span> &lt;= <span class=\"number\">3</span> <span class=\"keyword\">AND</span> <span class=\"keyword\">id</span> &gt; <span class=\"number\">1</span> <span class=\"keyword\">LOCK</span> <span class=\"keyword\">IN</span> <span class=\"keyword\">SHARE</span> <span class=\"keyword\">MODE</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>未加索引的字段</li>\n</ul>\n<blockquote>\n<p>存储引擎只能给表中所有的记录都加上锁。</p>\n</blockquote>\n<h5 id=\"乐观锁与悲观锁\"><a href=\"#乐观锁与悲观锁\" class=\"headerlink\" title=\"乐观锁与悲观锁\"></a>乐观锁与悲观锁</h5><blockquote>\n<p>数据库通过锁机制来解决并发场景-共享锁（读锁）和排他锁（写锁）。读锁是不阻塞的，多个客户端可以在同一时刻读取同一个资源。写锁是排他的，并且会阻塞其他的读锁和写锁。简单提下乐观锁和悲观锁。</p>\n</blockquote>\n<ul>\n<li><p><strong>悲观锁</strong>：假定会发生并发冲突，屏蔽一切可能违反数据完整性的操作。</p>\n<ul>\n<li><strong>表锁</strong>，锁定整张表，开销最小，但是会加剧锁竞争。</li>\n<li><strong>行锁</strong>，锁定行级别，开销最大，但是可以最大程度的支持并发。</li>\n<li>共享锁（多个事物共享）共享锁也叫读锁或 S 锁。</li>\n<li>排它锁（单个事物占有）排它锁也独占锁、写锁或 X 锁</li>\n</ul>\n</li>\n<li><p><strong>乐观锁</strong>：假设不会发生并发冲突，只在提交操作时检查是否违反数据完整性。</p>\n<ul>\n<li>不过通过数据库的版本机制实现，通过版本号字段或者时间戳字段来实现。</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"死锁\"><a href=\"#死锁\" class=\"headerlink\" title=\"死锁\"></a>死锁</h5><blockquote>\n<p>在并发系统中出现不同线程循环依赖资源，涉及的线程都在等待其他线程释放资源，就会导致相关线程进入无限等待的状态，简称死锁。</p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">ERROR 1213 (40001): Deadlock found when trying to get <span class=\"keyword\">lock</span>; try restarting transaction</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>设置超时时间，防止线程事务一直等待。<code>innodb_lock_wait_timeout</code>设置超时时间，该值默认的时间时<code>50s</code>。</li>\n<li>主动回滚相关线程中某个事物，手动释放资源。</li>\n</ul>\n<h4 id=\"InnoDB引擎的行锁的实现方式\"><a href=\"#InnoDB引擎的行锁的实现方式\" class=\"headerlink\" title=\"InnoDB引擎的行锁的实现方式\"></a>InnoDB引擎的行锁的实现方式</h4><blockquote>\n<p>InnoDB是基于索引来完成行锁</p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 例:  --</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> tab_with_index <span class=\"keyword\">where</span> <span class=\"keyword\">id</span> = <span class=\"number\">1</span> <span class=\"keyword\">for</span> <span class=\"keyword\">update</span>;</span><br><span class=\"line\"><span class=\"comment\">-- for update 可以根据条件来完成行锁锁定,并且 id 是有索引键的列-- </span></span><br><span class=\"line\"><span class=\"comment\">-- 如果 id 不是索引键那么InnoDB将完成表锁,并发将无从谈起--</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"InnDb架构\"><a href=\"#InnDb架构\" class=\"headerlink\" title=\"InnDb架构\"></a>InnDb架构</h3><ul>\n<li>这是官方文档中的架构图</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/mysql/innodb-architecture.png\" alt=\"innodb-architecture\"></p>\n<h4 id=\"Buffer-Pool\"><a href=\"#Buffer-Pool\" class=\"headerlink\" title=\"Buffer Pool\"></a>Buffer Pool</h4><blockquote>\n<p>在使用InnoDB的时候，索引都是以页的形式存在在<code>表空间</code>中的，本质上是存储在硬盘上的。设计<code>InnoDB</code>的大叔为了缓存磁盘中的页，在<code>MySQL</code>服务器启动的时候就向操作系统申请了一片连续的内存，他们给这片内存起了个名，叫做<code>Buffer Pool</code>（中文名是<code>缓冲池</code>）</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[server]</span><br><span class=\"line\">innodb_buffer_pool_size &#x3D; 268435456</span><br><span class=\"line\">-- 268435456的单位是字节，也就是我指定Buffer Pool的大小为256M。需要注意的是，Buffer Pool也不能太小。--</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Mysql-log\"><a href=\"#Mysql-log\" class=\"headerlink\" title=\"Mysql log\"></a>Mysql log</h4><blockquote>\n<p>日志是mysql中非常重要的组成部分，记录着数据库运行期间的各种状态信息。Mysql的日志主要包括<code>错误日志</code>、<code>查询日志</code>、<code>慢查询日志</code>、<code>事物日志</code>、二进制日志大类。</p>\n</blockquote>\n<h5 id=\"错误日志-Error-Log\"><a href=\"#错误日志-Error-Log\" class=\"headerlink\" title=\"错误日志 Error Log\"></a>错误日志 Error Log</h5><ul>\n<li>记录出错信息，也记录一些警告信息或者正确的信息。默认开启。</li>\n<li><code> show vaiables like &#39;%log_err%&#39;</code></li>\n</ul>\n<h5 id=\"查询日志-General-query-log\"><a href=\"#查询日志-General-query-log\" class=\"headerlink\" title=\"查询日志 General query log\"></a>查询日志 General query log</h5><ul>\n<li>记录所有对数据库请求的信息，不论这些请求是否得到了正确的执行。</li>\n<li><code> show vaiables like &#39;%general%&#39;</code></li>\n</ul>\n<h5 id=\"慢查询日志-Show-query-log\"><a href=\"#慢查询日志-Show-query-log\" class=\"headerlink\" title=\"慢查询日志 Show query log\"></a>慢查询日志 Show query log</h5><ul>\n<li>设置一个阈值，将运行时间超过该值的所有SQL语句都记录到慢查询的日志文件中。</li>\n<li><code>show variables  like &#39;%slow_query_log%&#39;</code> </li>\n<li><code>show variables  like &#39;%slow_query_time%&#39;</code> 慢查询日志记录执行时间阀值 </li>\n</ul>\n<h5 id=\"二进制日志-binary-log\"><a href=\"#二进制日志-binary-log\" class=\"headerlink\" title=\"二进制日志 binary log\"></a>二进制日志 binary log</h5><ul>\n<li>记录对数据库执行更改的所有操作。主要数据库的恢复、主从数据库复制同步。</li>\n<li><code> show vaiables like &#39;%log_bin%&#39;</code></li>\n</ul>\n<h5 id=\"中继日志\"><a href=\"#中继日志\" class=\"headerlink\" title=\"中继日志\"></a>中继日志</h5><ul>\n<li>中继日志也是二进制日志，用来给slave 库恢复</li>\n</ul>\n<h5 id=\"事物日志\"><a href=\"#事物日志\" class=\"headerlink\" title=\"事物日志\"></a>事物日志</h5><ul>\n<li><p>重做日志redo和回滚日志undo</p>\n</li>\n<li><p>事务日志是通过redo和innodb的存储引擎日志缓冲（Innodb log buffer）来实现的，当开始一个事务的时候，会记录该事务的lsn(log sequence number)号; 当事务执行时，会往InnoDB存储引擎的日志的日志缓存里面插入事务日志；当事务提交时，必须将存储引擎的日志缓冲写入磁盘（通过innodb_flush_log_at_trx_commit来控制），也就是写数据前，需要先写日志。这种方式称为“预写日志方式”。</p>\n</li>\n</ul>\n<h4 id=\"binlog\"><a href=\"#binlog\" class=\"headerlink\" title=\"binlog\"></a>binlog</h4><p><code>binlog</code>用于记录数据库执行的写入性操作（不包括查询）的信息、以二进制的信息保保存在磁盘中，<code>binlog</code>是Mysql的逻辑日志，又<code>server</code>层进行记录。使用任何的存储引擎都会进行记录。<code>binlog</code>是通过追加的方式写入，当文件达到一定大小值以后，会生成全新文件来保存日志。</p>\n<ul>\n<li><p>逻辑日志：记录sql语句的日志。</p>\n</li>\n<li><p>物理日志：<code>mysql innodb</code>数据是保存在数据页中，物理记录的就是数据页变更。</p>\n</li>\n<li><p>主从复制：Master端开启<code>binlog</code>，然后将<code>binlog</code>发送到<code>Slave</code>端，<code>Slave</code>端通过重放<code>binlog</code>达到数据一致。</p>\n</li>\n<li><p>数据恢复：通过<code>mysqlbinlog</code>工具来恢复数据库。</p>\n</li>\n</ul>\n<h5 id=\"日志格式\"><a href=\"#日志格式\" class=\"headerlink\" title=\"日志格式\"></a>日志格式</h5><blockquote>\n<p>在 <code>MySQL 5.7.7</code> 之前，默认的格式是 <code>STATEMENT</code> ， <code>MySQL 5.7.7</code> 之后，默认值是 <code>ROW</code>。日志格式通过 <code>binlog-format</code> 指定。</p>\n</blockquote>\n<ul>\n<li><code>STATMENT</code>：基于<code>SQL</code> 语句的复制( <code>statement-based replication, SBR</code> )，每一条会修改数据的sql语句会记录到<code>binlog</code> 中  。</li>\n<li><ul>\n<li>优点：不需要记录每一行的变化，减少了 binlog 日志量，节约了 IO  , 从而提高了性能；</li>\n<li>缺点：在某些情况下会导致主从数据不一致，比如执行sysdate() 、  slepp()  等 。</li>\n</ul>\n</li>\n<li><code>ROW</code>：基于行的复制(<code>row-based replication, RBR</code> )，不记录每条sql语句的上下文信息，仅需记录哪条数据被修改了 。</li>\n<li><ul>\n<li>优点：不会出现某些特定情况下的存储过程、或function、或trigger的调用和触发无法被正确复制的问题 ；</li>\n<li>缺点：会产生大量的日志，尤其是<code>alter table</code> 的时候会让日志暴涨</li>\n</ul>\n</li>\n<li><code>MIXED</code>：基于<code>STATMENT</code> 和 <code>ROW</code> 两种模式的混合复制(<code>mixed-based replication, MBR</code> )，一般的复制使用<code>STATEMENT</code> 模式保存 <code>binlog</code> ，对于 <code>STATEMENT</code> 模式无法复制的操作使用 <code>ROW</code> 模式保存 <code>binlog</code></li>\n</ul>\n<h6 id=\"statement\"><a href=\"#statement\" class=\"headerlink\" title=\"statement\"></a>statement</h6><blockquote>\n<p>每一条会修改数据的sql都会记录在binlog中。</p>\n</blockquote>\n<ul>\n<li><p><strong>优点</strong>：不需要记录每一行的变化，减少了binlog日志量，节约了IO，提高性能。(相比row能节约多少性能 与日志量，这个取决于应用的SQL情况，正常同一条记录修改或者插入row格式所产生的日志量还小于Statement产生的日志量，但是考虑到如果带条 件的update操作，以及整表删除，alter表等操作，ROW格式会产生大量日志，因此在考虑是否使用ROW格式日志时应该跟据应用的实际情况，其所 产生的日志量会增加多少，以及带来的IO性能问题。)</p>\n</li>\n<li><p><strong>缺点</strong>：由于记录的只是执行语句，为了这些语句能在slave上正确运行，因此还必须记录每条语句在执行的时候的 一些相关信息，以保证所有语句能在slave得到和在master端执行时候相同 的结果。另外mysql 的复制,像一些特定函数功能，slave可与master上要保持一致会有很多相关问题(如sleep()函数， last_insert_id()，以及user-defined functions(udf)会出现问题)。</p>\n</li>\n</ul>\n<p><strong>使用以下函数的语句也无法被复制</strong>：</p>\n<ul>\n<li>LOAD_FILE()</li>\n<li>UUID()</li>\n<li>USER()</li>\n<li>FOUND_ROWS()</li>\n<li>SYSDATE() (除非启动时启用了 –sysdate-is-now 选项)</li>\n</ul>\n<p>同时在INSERT …SELECT 会产生比 RBR 更多的行级锁</p>\n<h6 id=\"row\"><a href=\"#row\" class=\"headerlink\" title=\"row\"></a>row</h6><blockquote>\n<p>不记录sql语句上下文相关信息，仅保存哪条记录被修改。</p>\n</blockquote>\n<ul>\n<li><strong>优点</strong>： binlog中可以不记录执行的sql语句的上下文相关的信息，仅需要记录那一条记录被修改成什么了。所以rowlevel的日志内容会非常清楚的记录下 每一行数据修改的细节。而且不会出现某些特定情况下的存储过程，或function，以及trigger的调用和触发无法被正确复制的问题</li>\n<li><strong>缺点</strong>:所有的执行的语句当记录到日志中的时候，都将以每行记录的修改来记录，这样可能会产生大量的日志内容,比 如一条update语句，修改多条记录，则binlog中每一条修改都会有记录，这样造成binlog日志量会很大，特别是当执行alter table之类的语句的时候，由于表结构修改，每条记录都发生改变，那么该表每一条记录都会记录到日志中。</li>\n</ul>\n<h6 id=\"mixedlevel\"><a href=\"#mixedlevel\" class=\"headerlink\" title=\"mixedlevel\"></a>mixedlevel</h6><ul>\n<li>Mixed是以上两种level的混合使用，一般的语句修改使用statment格式保存binlog，如一些函数，statement无法完成主从复制的操作，则 采用row格式保存binlog,MySQL会根据执行的每一条具体的sql语句来区分对待记录的日志形式，也就是在Statement和Row之间选择 一种.新版本的MySQL中队row level模式也被做了优化，并不是所有的修改都会以row level来记录，像遇到表结构变更的时候就会以statement模式来记录。至于update或者delete等修改数据的语句，还是会记录所有行的变更。</li>\n</ul>\n<h5 id=\"2PC两阶段提交\"><a href=\"#2PC两阶段提交\" class=\"headerlink\" title=\"2PC两阶段提交\"></a>2PC两阶段提交</h5><blockquote>\n<p>mysql中在server层级别有个binlog日志，归档日志，用于备份，主从同步复制，如果采用一主多从架构，主备切换，那就必须用到binlog进行主从同步。</p>\n</blockquote>\n<ul>\n<li>事务提交就必须保证redolog与binlog的一致性，一般情况没有开启binlog日志，事务提交不会两阶段提交，若需要主从同步就必须开启binlog使用两阶段提交保证数据一致性。</li>\n<li><strong>Prepare 阶段</strong>：InnoDB 将回滚段undolog设置为 prepare 状态；将 redolog 写文件并刷盘；先写redolog，事务进入prepare状态）</li>\n<li><strong>Commit 阶段</strong>：Binlog 写入文件；binlog 刷盘；InnoDB commit；</li>\n</ul>\n<h5 id=\"刷盘机制\"><a href=\"#刷盘机制\" class=\"headerlink\" title=\"刷盘机制\"></a>刷盘机制</h5><blockquote>\n<p><code>Innodb下只有在事物提交的情况下才会记录binlog</code>，此时记录还在内存中。mysql通过<code>sync_binlog</code>参数控制<code>binlog</code>刷盘时机。取值范围0-n</p>\n</blockquote>\n<ul>\n<li>0：不去强制要求，由系统自行判断何时写入磁盘；</li>\n<li>1：每次 <code>commit</code> 的时候都要将 <code>binlog</code> 写入磁盘；</li>\n<li>N：每N个事务，才会将 <code>binlog</code> 写入磁盘。</li>\n</ul>\n<h4 id=\"redo-Log\"><a href=\"#redo-Log\" class=\"headerlink\" title=\"redo Log\"></a>redo Log</h4><blockquote>\n<p>事务的四大特性里面有一个是 <strong>持久性</strong> ，具体来说就是<strong>只要事务提交成功，那么对数据库做的修改就被永久保存下来了，不可能因为任何原因再回到原来的状态</strong> 。</p>\n</blockquote>\n<h5 id=\"保持一致性\"><a href=\"#保持一致性\" class=\"headerlink\" title=\"保持一致性\"></a>保持一致性</h5><blockquote>\n<p>最简单的做法是在每次事务提交的时候，将该事务涉及修改的数据页全部刷新到磁盘中。但是这么做会有严重的性能问题，<code>redo log</code> 包含两个部分，一个是内存中的日志缓冲 <code>redo log buffer</code> , 另一个是磁盘上的日志文件<code>redo logfile</code> </p>\n</blockquote>\n<ul>\n<li><p><code>Innodb</code> 是以 <code>页</code> 为单位进行磁盘交互的，而一个事务很可能只修改一个数据页里面的几个字节，这个时候将完整的数据页刷到磁盘的话，太消耗资源了。</p>\n</li>\n<li><p>一个事务可能涉及修改多个数据页，并且这些数据页在物理上并不连续，使用随机IO写入性能太差！</p>\n<ul>\n<li>mysql 每执行一条<code>DML</code>语句，先将记录写入<code>redo log buffer</code>,后续某个时间点再一次性将多个操作写到 <code>redo log file</code>。这种先写日志，再写磁盘的技术就是<code>Mysql</code>里经常说到的<code>WAL (write-ahead Logging)</code>技术。 <strong>具体来说就是只记录事务对数据页做了哪些修改</strong>，这样就能完美地解决性能问题了(相对而言文件更小并且是顺序IO)。</li>\n</ul>\n</li>\n<li><p>在计算机中，用户的空间<code>user space</code>下的缓冲区一般情况下是不能直接写入磁盘，中间需要经过系统内核空间<code> kerne space</code>缓冲区<code>Os Buffer</code>，因此<code>redo log buffer</code>写入<code>redo logfile</code>实际上是写入<code>Os Buffer</code>，然后再通过系统调用<code>fsunc()</code>将数据刷入<code>redo log file</code></p>\n</li>\n</ul>\n<h5 id=\"刷盘机制-1\"><a href=\"#刷盘机制-1\" class=\"headerlink\" title=\"刷盘机制\"></a>刷盘机制</h5><blockquote>\n<p>mysql 支持三种将<code>redo log buffer</code>写入<code>redo log file</code>的机制，可以通过<code>innodb_flush_log_at_trx_commit</code>配置</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>innodb_flush_log_at_trx_commit</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>0</td>\n<td>事物提交不将<code>redo log buffer</code>只日志写入<code>os buffer</code>，而是每秒写入<code>os buffer</code>并调用<code>fsync()</code>写入<code>redo log file</code>中，也就是说设置0时，大概每秒刷新一次进入磁盘，如果系统出现故障，会丢失1秒的数据。</td>\n</tr>\n<tr>\n<td>1</td>\n<td>每次提交事物都将<code>redo log buufer</code> 写入 <code>os buffer</code>并调用<code>fsync()</code>。这种情况系统故障也不会丢失数据，<code>io</code>性能太差。</td>\n</tr>\n<tr>\n<td>2</td>\n<td>每次提交事物都将<code>redo log buufer</code> 写入 <code>os buffer</code>，每秒调用<code>fsync()</code>将<code>os buffer</code>中日志写入<code>redo log file</code></td>\n</tr>\n</tbody></table>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211020211536.png\"></p>\n<h4 id=\"undo-Log\"><a href=\"#undo-Log\" class=\"headerlink\" title=\"undo Log\"></a>undo Log</h4><blockquote>\n<p>数据库事务四大特性中有一个是 <strong>原子性</strong> ，具体来说就是 <strong>原子性是指对数据库的一系列操作，要么全部成功，要么全部失败，不可能出现部分成功的情况</strong>。</p>\n</blockquote>\n<ul>\n<li><strong>原子性</strong> 底层就是通过 <code>undo log</code> 实现的。<code>undo log</code>主要记录了数据的逻辑变化，比如一条 <code>INSERT</code> 语句，对应一条<code>DELETE</code> 的 <code>undo log</code> ，对于每个 <code>UPDATE</code> 语句，对应一条相反的 <code>UPDATE</code> 的 <code>undo log</code> ，这样在发生错误时，就能回滚到事务之前的数据状态。</li>\n<li><code>undo log</code> 也是 <code>MVCC</code>(多版本并发控制)实现的关键。在事物提交之前Undo Log保存了未提交的版本数据,Undo log 中的数据可以作为数据旧版本提供快照读，且为其他事物提供快照读。读取顺序是Undo buffer 中查找数据，未找到就从Undo log file 中查找数据。</li>\n</ul>\n<h4 id=\"Redolog与Binlog\"><a href=\"#Redolog与Binlog\" class=\"headerlink\" title=\"Redolog与Binlog\"></a>Redolog与Binlog</h4><ul>\n<li>Redo Log时属于InnoDB引擎功能，Binlog时属于Mysql Server的功能，且以二进制文件记录。</li>\n<li>Redo Log属于物理日志,记录数据叶更新状态内容。binLog时逻辑日志，记录更新过程。</li>\n<li>Redo Log日志循环写入，日志大小空间时固定的，binLog追加写入日志，不会覆盖写入。</li>\n<li>Redo Log在服务器异常之后可以自动恢复使用，binLog可以作为主从和数据恢复使用。binLog没有自动crash-safe能力。</li>\n</ul>\n<h3 id=\"MVCC\"><a href=\"#MVCC\" class=\"headerlink\" title=\"MVCC\"></a>MVCC</h3><blockquote>\n<p>MySQL InnoDB存储引擎，实现的是基于多版本的并发控制协议——MVCC (Multi-Version Concurrency Control) 与MVCC相对的，是基于锁的并发控制，Lock-Based Concurrency Control 基于多版本的并发控制协议</p>\n</blockquote>\n<ul>\n<li>通过 MVCC 我们可以解决以下几个问题：</li>\n</ul>\n<ol>\n<li>读写之间阻塞的问题，通过 MVCC 可以让读写互相不阻塞，即读不阻塞写，写不阻塞读，这样就可以提升事务并发处理能力。</li>\n<li>降低了死锁的概率。这是因为 MVCC 采用了乐观锁的方式，读取数据时并不需要加锁，对于写操作，也只锁定必要的行。</li>\n<li>解决一致性读的问题。一致性读也被称为快照读，当我们查询数据库在某个时间点的快照时，只能看到这个时间点之前事务提交更新的结果，而不能看到这个时间点之后事务提交的更新结果。</li>\n</ol>\n<h4 id=\"隐藏字段\"><a href=\"#隐藏字段\" class=\"headerlink\" title=\"隐藏字段\"></a>隐藏字段</h4><blockquote>\n<p>InnoDB存储引擎，每一行记录都有两个隐藏列<strong>trx_id</strong>、<strong>roll_pointer</strong>，如果表中没有主键和非NULL唯一键时，则还会有第三个隐藏的主键列<strong>row_id</strong>。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th align=\"left\">列名</th>\n<th align=\"left\">是否必须</th>\n<th align=\"left\">描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">row_id</td>\n<td align=\"left\">否</td>\n<td align=\"left\">单调递增的行ID，不是必需的，占用6个字节。</td>\n</tr>\n<tr>\n<td align=\"left\">trx_id</td>\n<td align=\"left\">是</td>\n<td align=\"left\">记录操作该数据事务的事务ID</td>\n</tr>\n<tr>\n<td align=\"left\">roll_pointer</td>\n<td align=\"left\">是</td>\n<td align=\"left\">这个隐藏列就相当于一个指针，指向回滚段的undo日志</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p>LBCC：：Lock-Based Concurrency Control，基于锁的并发控制 </p>\n</li>\n<li><p>MVCC：：Multi-Version Concurrency Control  基于多版本的并发控制协议。纯粹基于锁的并发机制并发量低，MVCC是在基于锁的并发控制上的改进，主要是在读操作上提⾼了并发量。 MVCC最⼤的好处：读不加锁，读写不冲突。在读多写少的OLTP应⽤中，读写不冲突是⾮常重要的，极⼤的增加了系统的并发性 能，现阶段⼏乎所有的RDBMS，都⽀持了MVCC。 </p>\n</li>\n</ul>\n<ul>\n<li>在MVCC并发控制中，读操作可以分成两类<ul>\n<li>快照读 (snapshot read)：读取的是记录的可⻅版本 (有可能是历史版本)，不⽤加锁（共享读锁s锁也不加，所以不会阻塞其他事务的写） 。</li>\n<li>当前读 (current read)：读取的是记录的最新版本，并且，当前读返回的记录，都会加上锁，保证其他事务不会再并发修改这条记录。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"快照读与当前读区别\"><a href=\"#快照读与当前读区别\" class=\"headerlink\" title=\"快照读与当前读区别\"></a>快照读与当前读区别</h4><ul>\n<li><p>快照读读取的是快照数据。不加锁的简单的 SELECT 都属于快照读，比如这样：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">FROM</span> player_users <span class=\"keyword\">WHERE</span> ...</span><br></pre></td></tr></table></figure>\n\n<p>当前读就是读取最新数据，而不是历史版本的数据。加锁的 SELECT，或者对数据进行增删改都会进行当前读，比如：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 这里加的是读锁。 update/insert/delete语句</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">FROM</span> player_users <span class=\"keyword\">LOCK</span> <span class=\"keyword\">IN</span> <span class=\"keyword\">SHARE</span> <span class=\"keyword\">MODE</span>;</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> * <span class=\"keyword\">FROM</span> player_users <span class=\"keyword\">FOR</span> <span class=\"keyword\">UPDATE</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h4 id=\"Read-View\"><a href=\"#Read-View\" class=\"headerlink\" title=\"Read View\"></a>Read View</h4><blockquote>\n<p>每次开启事务的时候都会生成一个ReadView，ReadView保存了当前事务开启时候所有活跃（还未提交的事务）事务列表。</p>\n</blockquote>\n<ul>\n<li>读已提交<ul>\n<li>一个事务中每一次SELECT查询都会获取一次ReadView</li>\n</ul>\n</li>\n<li>可重复读<ul>\n<li>一个事务第一次查询SELECT时会获取一次ReadView,此后的SELECT查询都会复用这个ReadView</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"MVVC如何查询记录\"><a href=\"#MVVC如何查询记录\" class=\"headerlink\" title=\"MVVC如何查询记录\"></a>MVVC如何查询记录</h4><blockquote>\n<p>MVCC 的核心就是 Undo Log+ Read View，“MV”就是通过 Undo Log 来保存数据的历史版本，实现多版本的管理，“CC”是通过 Read View 来实现管理，通过 Read View 原则来决定数据是否显示。同时针对不同的隔离级别，Read View 的生成策略不同，也就实现了不同的隔离级别。</p>\n</blockquote>\n<ol>\n<li>获取事务自己的版本号，即事务ID</li>\n<li>获取Read View</li>\n<li>查询得到的数据，然后Read View中的事务版本号进行比较。</li>\n<li>如果不符合Read View的可见性规则， 即就需要Undo log中历史快照;</li>\n<li>最后返回符合规则的数据</li>\n</ol>\n<h4 id=\"如何解决幻读\"><a href=\"#如何解决幻读\" class=\"headerlink\" title=\"如何解决幻读\"></a>如何解决幻读</h4><ul>\n<li>Next  key锁+MVVC避免幻读。</li>\n</ul>\n<h3 id=\"SQL语句的执行顺序\"><a href=\"#SQL语句的执行顺序\" class=\"headerlink\" title=\"SQL语句的执行顺序\"></a>SQL语句的执行顺序</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/SQL%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F.png\"></p>\n<blockquote>\n<p>我们在编写一个查询语句的时候</p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"keyword\">DISTINCT</span></span><br><span class=\"line\">    &lt; select_list &gt;</span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">    &lt; left_table &gt; &lt; join_type &gt;</span><br><span class=\"line\"><span class=\"keyword\">JOIN</span> &lt; right_table &gt; <span class=\"keyword\">ON</span> &lt; join_condition &gt;</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span></span><br><span class=\"line\">    &lt; where_condition &gt;</span><br><span class=\"line\"><span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span></span><br><span class=\"line\">    &lt; group_by_list &gt;</span><br><span class=\"line\"><span class=\"keyword\">HAVING</span></span><br><span class=\"line\">    &lt; having_condition &gt;</span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span></span><br><span class=\"line\">    &lt; order_by_condition &gt;</span><br><span class=\"line\"><span class=\"keyword\">LIMIT</span> &lt; limit_number &gt;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"FROM\"><a href=\"#FROM\" class=\"headerlink\" title=\"FROM\"></a>FROM</h4><ul>\n<li>首先，对 SELECT 语句执行查询时，对<code>FROM</code> 关键字两边的表执行连接，会形成<code>笛卡尔积</code>，这时候会产生一个<code>虚表VT1(virtual table)</code></li>\n</ul>\n<blockquote>\n<p>首先先来解释一下什么是<code>笛卡尔积</code></p>\n<p>现在我们有两个集合 A = {0,1} , B = {2,3,4}</p>\n<p>那么，集合 A * B 得到的结果就是</p>\n<p>A * B = {(0,2)、(1,2)、(0,3)、(1,3)、(0,4)、(1,4)};</p>\n<p>B * A = {(2,0)、{2,1}、{3,0}、{3,1}、{4,0}、(4,1)};</p>\n<p>上面 A * B 和 B * A 的结果就可以称为两个集合相乘的 <code>笛卡尔积</code></p>\n<p>我们可以得出结论，A 集合和 B 集合相乘，包含了集合 A 中的元素和集合 B 中元素之和，也就是 A 元素的个数 * B 元素的个数</p>\n</blockquote>\n<h4 id=\"ON\"><a href=\"#ON\" class=\"headerlink\" title=\"ON\"></a>ON</h4><ul>\n<li>然后对 FROM 连接的结果进行 ON 筛选，创建 VT2，把符合记录的条件存在 VT2 中。</li>\n</ul>\n<h4 id=\"JOIN\"><a href=\"#JOIN\" class=\"headerlink\" title=\"JOIN\"></a>JOIN</h4><p>第三步，如果是 <code>OUTER JOIN(left join、right join)</code> ，那么这一步就将添加外部行，如果是 left join 就把 ON 过滤条件的左表添加进来，如果是 right join ，就把右表添加进来，从而生成新的虚拟表 VT3。</p>\n<h4 id=\"WHERE\"><a href=\"#WHERE\" class=\"headerlink\" title=\"WHERE\"></a>WHERE</h4><ul>\n<li><p>第四步，是执行 WHERE 过滤器，对上一步生产的虚拟表引用 WHERE 筛选，生成虚拟表 VT4。</p>\n</li>\n<li><p>WHERE 和 ON 的区别</p>\n<ul>\n<li>如果有外部列，ON 针对过滤的是关联表，主表(保留表)会返回所有的列;</li>\n<li>如果没有添加外部列，两者的效果是一样的;</li>\n</ul>\n</li>\n<li><p>应用</p>\n<ul>\n<li>对主表的过滤应该使用 WHERE;</li>\n<li>对于关联表，先条件查询后连接则用 ON，先连接后条件查询则用 WHERE;</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"GROUP-BY\"><a href=\"#GROUP-BY\" class=\"headerlink\" title=\"GROUP BY\"></a>GROUP BY</h4><ul>\n<li>根据 group by 字句中的列，会对 VT4 中的记录进行分组操作，产生虚拟机表 VT5。果应用了group by，那么后面的所有步骤都只能得到的 VT5 的列或者是聚合函数（count、sum、avg等）。</li>\n</ul>\n<h4 id=\"HAVING\"><a href=\"#HAVING\" class=\"headerlink\" title=\"HAVING\"></a>HAVING</h4><ul>\n<li>紧跟着 GROUP BY 字句后面的是 HAVING，使用 HAVING 过滤，会把符合条件的放在 VT6</li>\n</ul>\n<h4 id=\"SELECT\"><a href=\"#SELECT\" class=\"headerlink\" title=\"SELECT\"></a>SELECT</h4><ul>\n<li>第七步才会执行 SELECT 语句，将 VT6 中的结果按照 SELECT 进行刷选，生成 VT7</li>\n</ul>\n<h4 id=\"DISTINCT\"><a href=\"#DISTINCT\" class=\"headerlink\" title=\"DISTINCT\"></a>DISTINCT</h4><ul>\n<li>在第八步中，会对 TV7 生成的记录进行去重操作，生成 VT8。事实上如果应用了 group by 子句那么 distinct 是多余的，原因同样在于，分组的时候是将列中唯一的值分成一组，同时只为每一组返回一行记录，那么所以的记录都将是不相同的。</li>\n</ul>\n<h4 id=\"ORDER-BY\"><a href=\"#ORDER-BY\" class=\"headerlink\" title=\"ORDER BY\"></a>ORDER BY</h4><ul>\n<li>应用 order by 子句。按照 order_by_condition 排序 VT8，此时返回的一个游标，而不是虚拟表。sql 是基于集合的理论的，集合不会预先对他的行排序，它只是成员的逻辑集合，成员的顺序是无关紧要的。</li>\n</ul>\n<h5 id=\"ORDER-BY注意事项\"><a href=\"#ORDER-BY注意事项\" class=\"headerlink\" title=\"ORDER BY注意事项\"></a>ORDER BY注意事项</h5><ul>\n<li><p>排序的列名：ORDER BY 后面可以有一个或多个列名，如果是多个列名进行排序，会按照后面第一个列先进行排序，当第一列的值相同的时候，再按照第二列进行排序，以此类推。</p>\n</li>\n<li><p>排序的顺序：ORDER BY 后面可以注明排序规则，ASC 代表递增排序，DESC 代表递减排序。如果没有注明排序规则，默认情况下是按照 ASC 递增排序。我们很容易理解 ORDER BY 对数值类型字段的排序规则，但如果排序字段类型为文本数据，就需要参考数据库的设置方式了，这样才能判断 A 是在 B 之前，还是在 B 之后。比如使用 MySQL 在创建字段的时候设置为 BINARY 属性，就代表区分大小写。</p>\n</li>\n<li><p>非选择列排序：ORDER BY 可以使用非选择列进行排序，所以即使在 SELECT 后面没有这个列名，你同样可以放到 ORDER BY 后面进行排序。</p>\n</li>\n<li><p>ORDER BY 的位置：ORDER BY 通常位于 SELECT 语句的最后一条子句，否则会报错。</p>\n</li>\n</ul>\n<h3 id=\"查询优化-1\"><a href=\"#查询优化-1\" class=\"headerlink\" title=\"查询优化\"></a>查询优化</h3><ul>\n<li><p>避免使用 select * 而是查询需要的字段，这样可以提升速度，以及减少网络传输的带宽压力。</p>\n</li>\n<li><p>尽量使用 Join 语句来替代子查询，因为子查询是嵌套查询，而嵌套查询会新创建一张临时表，而临时表的创建与销毁会占用一定的系统资源以及花费一定的时间，但 Join 语句并不会创建临时表，因此性能会更高。</p>\n</li>\n<li><p>尽量使用覆盖查询。通过创建联合主键的方式减少回表操作。</p>\n</li>\n<li><p>不要在列上进行运算操作</p>\n</li>\n<li><p>适当增加冗余字段，防止多度连表查询，通常不建议join超过三张表。</p>\n</li>\n<li><p>最小数据长度，一般说来数据库的表越小，那么它的查询速度就越快，因此为了提高表的效率</p>\n</li>\n<li><p>使用最简单数据类型，能使用 int 类型就不要使用 varchar 类型，因为 int 类型比 varchar 类型的查询效率更高。</p>\n</li>\n<li><p>尽量少定义 text 类型，text 类型的查询效率很低，如果必须要使用 text 定义字段，可以把此字段分离成子表，需要查询此字段时使用联合查询，这样可以提高主表的查询效率。</p>\n</li>\n<li><p>适当分表、分库策略，分表和分库方案也是我们经常说的垂直分隔（分表）和水平分隔（分库）。</p>\n<p>分表是指当一张表中的字段更多时，可以尝试将一张大表拆分为多张子表，把使用比较高频的主信息放入主表中，其他的放入子表，这样我们大部分查询只需要查询字段更少的主表就可以完成了，从而有效的提高了查询的效率。</p>\n<p>分库是指将一个数据库分为多个数据库。比如我们把一个数据库拆分为了多个数据库，一个主数据库用于写入和修改数据，其他的用于同步主数据并提供给客户端查询，这样就把一个库的读和写的压力，分摊给了多个库，从而提高了数据库整体的运行效率。</p>\n</li>\n</ul>\n<h4 id=\"SQL优化explain\"><a href=\"#SQL优化explain\" class=\"headerlink\" title=\"SQL优化explain\"></a>SQL优化explain</h4><ul>\n<li>explain出来的各种item的意义；</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">select_type</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>表示查询中每个select子句的类型，有几种值：simple（表示简单的select，没有union和子查询），primary（有子查询，最外面的select查询就是primary），union（union中的第二个或随后的select查询，不依赖外部查询结果），dependent union（union中的第二个或随后的select查询，依赖外部查询结果）</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">type</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>表示MySQL在表中找到所需行的方式，又称“访问类型”，有几种值：system（表仅有一行（=系统表），这是const连接类型的一个特例），const（常量查询）, ref(非唯一索引访问，只有普通索引)，eq_ref（使用唯一索引或组件查询），all（全表查询），index（根据索引查询全表），range（范围查询）</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">possible_keys</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>指出MySQL能使用哪个索引在表中找到行，查询涉及到的字段上若存在索引，则该索引将被列出，但不一定被查询使用</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">key</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>显示MySQL在查询中实际使用的索引，若没有使用索引，显示为NULL</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">key_len</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">ref</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">Extra</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>包含不适合在其他列中显示但十分重要的额外信息</p>\n</li>\n<li><p>profile的意义以及使用场景；</p>\n</li>\n</ul>\n<blockquote>\n<p>查询到 SQL 会执行多少时间, 并看出 CPU/Memory 使用量, 执行过程中 Systemlock, Table lock 花多少时间等等。</p>\n</blockquote>\n<h4 id=\"innodb的读写参数优化\"><a href=\"#innodb的读写参数优化\" class=\"headerlink\" title=\"innodb的读写参数优化\"></a>innodb的读写参数优化</h4><ul>\n<li>读取参数</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">global buffer pool以及 local buffer；</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>写入参数；</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">innodb_flush_log_at_trx_commit</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_buffer_pool_size</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>与IO相关的参数；</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">innodb_write_io_threads = 8</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_read_io_threads = 8</span><br><span class=\"line\"></span><br><span class=\"line\">innodb_thread_concurrency = 0</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"SQL-优化的经验\"><a href=\"#SQL-优化的经验\" class=\"headerlink\" title=\"SQL 优化的经验\"></a>SQL 优化的经验</h4><ul>\n<li>查询语句无论是使用哪种判断条件 <strong>等于、小于、大于</strong>， <code>WHERE</code> 左侧的条件查询字段不要使用函数或者表达式</li>\n<li>使用 <code>EXPLAIN</code> 命令优化你的 SELECT 查询，对于复杂、效率低的 sql 语句，我们通常是使用 explain sql 来分析这条 sql 语句，这样方便我们分析，进行优化。</li>\n<li>当你的 SELECT 查询语句只需要使用一条记录时，要使用 <code>LIMIT 1</code></li>\n<li>不要直接使用 <code>SELECT *</code>，而应该使用具体需要查询的表字段，因为使用 EXPLAIN 进行分析时，SELECT * 使用的是全表扫描，也就是 <code>type = all</code>。</li>\n<li>为每一张表设置一个 ID 属性</li>\n<li>避免在 <code>WHERE</code> 字句中对字段进行 <code>NULL</code> 判断</li>\n<li>避免在 <code>WHERE</code> 中使用 <code>!=</code> 或 <code>&lt;&gt;</code> 操作符</li>\n<li>使用 <code>BETWEEN AND</code> 替代 <code>IN</code></li>\n<li>为搜索字段创建索引,大字段类型不要建立索引。</li>\n<li>选择正确的存储引擎，InnoDB 、MyISAM 、MEMORY 等</li>\n<li>使用 <code>LIKE %abc%</code> 不会走索引，而使用 <code>LIKE abc%</code> 会走索引</li>\n<li>对于枚举类型的字段(即有固定罗列值的字段)，建议使用<code>ENUM</code>而不是<code>VARCHAR</code>，如性别、星期、类型、类别等</li>\n<li>拆分大的 DELETE 或 INSERT 语句</li>\n<li>选择合适的字段类型，选择标准是 <strong>尽可能小、尽可能定长、尽可能使用整数</strong>。</li>\n<li>字段设计尽可能使用 <code>NOT NULL</code></li>\n<li>进行水平切割或者垂直分割</li>\n</ul>\n<h3 id=\"视图\"><a href=\"#视图\" class=\"headerlink\" title=\"视图\"></a>视图</h3><ul>\n<li>视图是一种虚拟的表，具有和物理表相同的功能。可以对视图进行增，改，查，操作，试图通常是有一个表或者多个表的行或列的子集。对视图的修改不影响基本表。它使得我们获取数据更容易，相比多表查询。</li>\n<li>只暴露部分字段给访问者，所以就建一个虚表，就是视图。</li>\n<li>查询的数据来源于不同的表，而查询者希望以统一的方式查询，这样也可以建立一个视图，把多个表查询结果联合起来，查询者只需要直接从视图中获取数据，不必考虑数据来源于不同表所带来的差异。</li>\n</ul>\n<h3 id=\"存储过程\"><a href=\"#存储过程\" class=\"headerlink\" title=\"存储过程\"></a>存储过程</h3><p>存储过程是一些预编译的SQL语句。</p>\n<ul>\n<li>更加直白的理解：存储过程可以说是一个记录集，它是由一些T-SQL语句组成的代码块，这些T-SQL语句代码像一个方法一样实现一些功能（对单表或多表的增删改查），然后再给这个代码块取一个名字，在用到这个功能的时候调用他就行了。</li>\n<li>存储过程是一个预编译的代码块，执行效率比较高,一个存储过程替代大量T_SQL语句 ，可以降低网络通信量，提高通信速率,可以一定程度上确保数据安全。</li>\n</ul>\n<h3 id=\"Mysql-Master-slave-的原理\"><a href=\"#Mysql-Master-slave-的原理\" class=\"headerlink\" title=\"Mysql Master slave 的原理\"></a>Mysql Master slave 的原理</h3><ul>\n<li><p><strong>主</strong>：binlog线程——记录下所有改变了数据库数据的语句，放进master上的binlog中；</p>\n</li>\n<li><p><strong>从</strong>：io线程——在使用start slave 之后，负责从master上拉取 binlog 内容，放进 自己的relay log中；</p>\n</li>\n<li><p><strong>从</strong>：sql执行线程——执行relay log中的语句；</p>\n</li>\n</ul>\n<h3 id=\"备份\"><a href=\"#备份\" class=\"headerlink\" title=\"备份\"></a>备份</h3><h4 id=\"备份计划，mysqldump以及xtranbackup的实现原理\"><a href=\"#备份计划，mysqldump以及xtranbackup的实现原理\" class=\"headerlink\" title=\"备份计划，mysqldump以及xtranbackup的实现原理\"></a>备份计划，mysqldump以及xtranbackup的实现原理</h4><ul>\n<li><p>备份计划</p>\n<ul>\n<li>这里每个公司都不一样</li>\n</ul>\n</li>\n<li><p>备份恢复时间,这里跟机器，尤其是硬盘的速率有关系，以下列举几个仅供参考</p>\n<ul>\n<li><p>20G的2分钟（mysqldump）</p>\n</li>\n<li><p>80G的30分钟(mysqldump)</p>\n</li>\n<li><p>111G的30分钟（mysqldump)</p>\n</li>\n<li><p>288G的3小时（xtra)</p>\n</li>\n<li><p>3T的4小时（xtra)</p>\n</li>\n<li><p>逻辑导入时间一般是备份时间的5倍以上</p>\n</li>\n</ul>\n</li>\n<li><p>xtrabackup实现原理</p>\n<ul>\n<li>在InnoDB内部会维护一个redo日志文件，我们也可以叫做事务日志文件。事务日志会存储每一个InnoDB表数据的记录修改。当InnoDB启动时，InnoDB会检查数据文件和事务日志，并执行两个步骤：它应用（前滚）已经提交的事务日志到数据文件，并将修改过但没有提交的数据进行回滚操作。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"mysqldump中备份出来的sql，如果我想sql文件中，一行只有一个insert…-value-的话，怎么办？如果备份需要带上master的复制点信息怎么办？\"><a href=\"#mysqldump中备份出来的sql，如果我想sql文件中，一行只有一个insert…-value-的话，怎么办？如果备份需要带上master的复制点信息怎么办？\" class=\"headerlink\" title=\"mysqldump中备份出来的sql，如果我想sql文件中，一行只有一个insert….value()的话，怎么办？如果备份需要带上master的复制点信息怎么办？\"></a>mysqldump中备份出来的sql，如果我想sql文件中，一行只有一个insert….value()的话，怎么办？如果备份需要带上master的复制点信息怎么办？</h4><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--skip-extended-insert</span></span><br><span class=\"line\"></span><br><span class=\"line\">[root@helei-zhuanshu ~]<span class=\"comment\"># mysqldump -uroot -p helei --skip-extended-insert</span></span><br><span class=\"line\"></span><br><span class=\"line\">Enter password:</span><br><span class=\"line\"></span><br><span class=\"line\">KEY `idx_c1` (`c1`),</span><br><span class=\"line\"></span><br><span class=\"line\">KEY `idx_c2` (`c2`)</span><br><span class=\"line\"></span><br><span class=\"line\">) ENGINE=InnoDB AUTO_INCREMENT=51 DEFAULT CHARSET=latin1;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- Dumping data for table `helei`</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">LOCK</span> <span class=\"keyword\">TABLES</span> <span class=\"string\">`helei`</span> WRITE;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*!40000 ALTER TABLE `helei` DISABLE KEYS */</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`helei`</span> <span class=\"keyword\">VALUES</span> (<span class=\"number\">1</span>,<span class=\"number\">32</span>,<span class=\"number\">37</span>,<span class=\"number\">38</span>,<span class=\"string\">'2016-10-18 06:19:24'</span>,<span class=\"string\">'susususususususususususu'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`helei`</span> <span class=\"keyword\">VALUES</span> (<span class=\"number\">2</span>,<span class=\"number\">37</span>,<span class=\"number\">46</span>,<span class=\"number\">21</span>,<span class=\"string\">'2016-10-18 06:19:24'</span>,<span class=\"string\">'susususususu'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`helei`</span> <span class=\"keyword\">VALUES</span> (<span class=\"number\">3</span>,<span class=\"number\">21</span>,<span class=\"number\">5</span>,<span class=\"number\">14</span>,<span class=\"string\">'2016-10-18 06:19:24'</span>,<span class=\"string\">'susu'</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h3><h4 id=\"大表连表查询\"><a href=\"#大表连表查询\" class=\"headerlink\" title=\"大表连表查询\"></a>大表连表查询</h4><p>一个6亿的表a，一个3亿的表b，通过外间tid关联，你如何最快的查询出满足条件的第50000到第50200中的这200条数据记录。</p>\n<ul>\n<li>1、如果A表TID是自增长,并且是连续的,B表的ID为索引</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> a,b <span class=\"keyword\">where</span> a.tid = b.id <span class=\"keyword\">and</span> a.tid&gt;<span class=\"number\">500000</span> <span class=\"keyword\">limit</span> <span class=\"number\">200</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>2、如果A表的TID不是连续的,那么就需要使用覆盖索引.TID要么是主键,要么是辅助索引,B表ID也需要有索引。</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> * <span class=\"keyword\">from</span> b , (<span class=\"keyword\">select</span> tid <span class=\"keyword\">from</span> a <span class=\"keyword\">limit</span> <span class=\"number\">50000</span>,<span class=\"number\">200</span>) a <span class=\"keyword\">where</span> b.id = a .tid;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"数据库的三范式是什么\"><a href=\"#数据库的三范式是什么\" class=\"headerlink\" title=\"数据库的三范式是什么\"></a>数据库的三范式是什么</h4><blockquote>\n<ul>\n<li>第一范式：列不可再分，字段具备单一职责</li>\n<li>第二范式：行可以唯一区分，主键约束</li>\n<li>第三范式：表的非主属性不能依赖与其他表的非主属性 外键约束</li>\n</ul>\n</blockquote>\n<ul>\n<li>第一范式（1NF）：数据库表中的字段都是单一属性的，不可再分。这个单一属性由基本类型构成，包括整型、实数、字符型、逻辑型、日期型等。</li>\n<li>第二范式（2NF）：数据库表中不存在非关键字段对任一候选关键字段的部分函数依赖（部分函数依赖指的是存在组合关键字中的某些字段决定非关键字段的情况），也即所有非关键字段都完全依赖于任意一组候选关键字。</li>\n<li>第三范式（3NF）：在第二范式的基础上，数据表中如果不存在非关键字段对任一候选关键字段的传递函数依赖则符合第三范式。所谓传递函数依赖，指的是如 果存在”A → B → C”的决定关系，则C传递函数依赖于A。因此，满足第三范式的数据库表应该不存在如下依赖关系： 关键字段 → 非关键字段 x → 非关键字段y</li>\n<li>且三大范式是一级一级依赖的，第二范式建立在第一范式上，第三范式建立第一第二范式上。</li>\n</ul>\n<h4 id=\"Mysql-大小写问题\"><a href=\"#Mysql-大小写问题\" class=\"headerlink\" title=\"Mysql 大小写问题\"></a>Mysql 大小写问题</h4><ul>\n<li>表名、表别名、字段名、字段别名都小写。SQL保留字段、函数名、绑定变量名都大写。</li>\n</ul>\n<h4 id=\"DDL设计数据表的原则\"><a href=\"#DDL设计数据表的原则\" class=\"headerlink\" title=\"DDL设计数据表的原则\"></a>DDL设计数据表的原则</h4><ol>\n<li>数据表越少越好</li>\n<li>数据表中的字段越少越好</li>\n<li>数据表中联合主键的字段越少越好</li>\n<li>使用主键和外键越多越好</li>\n</ol>\n<h4 id=\"varchar与char的区别以及varchar-50-中的50代表的涵义\"><a href=\"#varchar与char的区别以及varchar-50-中的50代表的涵义\" class=\"headerlink\" title=\"varchar与char的区别以及varchar(50)中的50代表的涵义\"></a>varchar与char的区别以及varchar(50)中的50代表的涵义</h4><ul>\n<li>varchar与char的区别<ul>\n<li>CHAR和VARCHAR类型在存储和检索方面有所不同，CHAR是一种固定长度的类型，VARCHAR则是一种可变长度的类型。</li>\n<li>CHAR列长度固定为创建表时声明的长度，长度值范围是1到255当CHAR值被存储时，它们被用空格填充到特定长度，检索CHAR值时需删除尾随空格。</li>\n</ul>\n</li>\n<li>varchar(50)中50的涵义<ul>\n<li>最多存放50个字符，varchar(50)和(200)存储hello所占空间一样，但后者在排序时会消耗更多内存，因为order by col采用fixed_length计算col长度(memory引擎也一样)</li>\n</ul>\n</li>\n<li>int（20）中20的涵义<ul>\n<li>是指显示字符的长度但要加参数的，最大为255，比如它是记录行数的id,插入10笔资料，它就显示00000000001 <del>~</del>00000000010，当字符的位数超过11,它也只显示11位，如果你没有加那个让它未满11位就前面加0的参数，它不会在前面加0</li>\n<li>20表示最大显示宽度为20，但仍占4字节存储，存储范围不变。</li>\n</ul>\n</li>\n<li>mysql为什么这么设计<ul>\n<li>对大多数应用没有意义，只是规定一些工具用来显示字符的个数；int(1)和int(20)存储和计算均一样。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"表中有大字段X-例如：text类型-，且字段X不会经常更新，以读为为主。如何拆分\"><a href=\"#表中有大字段X-例如：text类型-，且字段X不会经常更新，以读为为主。如何拆分\" class=\"headerlink\" title=\"表中有大字段X(例如：text类型)，且字段X不会经常更新，以读为为主。如何拆分\"></a>表中有大字段X(例如：text类型)，且字段X不会经常更新，以读为为主。如何拆分</h4><blockquote>\n<p>拆带来的问题：连接消耗 + 存储拆分空间；不拆可能带来的问题：查询性能；</p>\n</blockquote>\n<ul>\n<li>1、如果能容忍拆分带来的空间问题,拆的话最好和经常要查询的表的主键在物理结构上放置在一起(分区) 顺序IO,减少连接消耗,最后这是一个文本列再加上一个全文索引来尽量抵消连接消耗</li>\n<li>2、如果能容忍不拆分带来的查询性能损失的话:上面的方案在某个极致条件下肯定会出现问题,那么不拆就是最好的选择。</li>\n</ul>\n<h4 id=\"什么是临时表，何时删除临时表\"><a href=\"#什么是临时表，何时删除临时表\" class=\"headerlink\" title=\"什么是临时表，何时删除临时表\"></a>什么是临时表，何时删除临时表</h4><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">在 MySQL 中，有三种类型的表</span><br><span class=\"line\">一种是&#96;永久表&#96;，永久表就是创建以后用来长期保存数据的表</span><br><span class=\"line\">一种是&#96;临时表&#96;，临时表也有两类，一种是和永久表一样，只保存临时数据，但是能够长久存在的；还有一种是临时创建的，SQL 语句执行完成就会删除。</span><br><span class=\"line\">一种是&#96;虚表&#96;，虚表其实就是&#96;视图&#96;，数据可能会来自多张表的执行结果。</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>MySQL 会在下面这几种情况产生临时表<ul>\n<li>使用 UNION 查询：UNION 有两种，一种是<code>UNION</code> ，一种是 <code>UNION ALL</code> ，它们都用于联合查询；区别是 使用 UNION 会去掉两个表中的重复数据，相当于对结果集做了一下<code>去重(distinct)</code>。使用 UNION ALL，则不会排重，返回所有的行。使用 UNION 查询会产生临时表。</li>\n<li>使用 <code>TEMPTABLE 算法</code>或者是 UNION 查询中的视图。TEMPTABLE 算法是一种创建临时表的算法，它是将结果放置到临时表中，意味这要 MySQL 要先创建好一个临时表，然后将结果放到临时表中去，然后再使用这个临时表进行相应的查询。</li>\n<li>ORDER BY 和 GROUP BY 的子句不一样时也会产生临时表。</li>\n<li>DISTINCT 查询并且加上 ORDER BY 时；</li>\n<li>SQL 用到 SQL_SMALL_RESULT 选项时；如果查询结果比较小的时候，可以加上 SQL_SMALL_RESULT 来优化，产生临时表</li>\n<li>FROM 中的子查询；</li>\n<li>EXPLAIN 查看执行计划结果的 Extra 列中，如果使用 <code>Using Temporary</code> 就表示会用到临时表。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"Exists与in\"><a href=\"#Exists与in\" class=\"headerlink\" title=\"Exists与in\"></a>Exists与in</h4><ul>\n<li>将设A、B两表，走索引的情况下。根据A、B表的大小比较，如果A表大于B表那么IN的查询效率比EXISTS高。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">SELECT * FROM A WHERE cc IN (SELECT cc FROM B)</span><br><span class=\"line\"></span><br><span class=\"line\">SELECT * FROM A WHERE EXISTS (SELECT cc FROM B WHERE B.cc&#x3D;A.cc)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"测试环境打开profiling\"><a href=\"#测试环境打开profiling\" class=\"headerlink\" title=\"测试环境打开profiling\"></a>测试环境打开profiling</h4><ul>\n<li>首先我们需要看下 profiling 是否开启，开启它可以让 MySQL 收集在 SQL 执行时所使用的资源情况，命令如下：</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; select @@profiling;</span><br><span class=\"line\"># profiling&#x3D;0 代表关闭，我们需要把 profiling 打开，即设置为 1：</span><br><span class=\"line\">mysql&gt; set profiling&#x3D;1;</span><br><span class=\"line\"># 然后我们执行一个 SQL 查询（你可以执行任何一个 SQL 查询）：</span><br><span class=\"line\">mysql&gt; select * from wucai.heros;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"去除重复行\"><a href=\"#去除重复行\" class=\"headerlink\" title=\"去除重复行\"></a>去除重复行</h4><ol>\n<li>DISTINCT 需要放到所有列名的前面</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 这么写会报错</span><br><span class=\"line\">SELECT name, DISTINCT age FROM us</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>DISTINCT 其实是对后面所有列名的组合进行去重。</li>\n</ol>\n<h4 id=\"drop、delete与truncate\"><a href=\"#drop、delete与truncate\" class=\"headerlink\" title=\"drop、delete与truncate\"></a>drop、delete与truncate</h4><blockquote>\n<p>SQL中的drop、delete、truncate都表示删除，但是三者有一些差别</p>\n</blockquote>\n<ul>\n<li><p>delete和truncate只删除表的数据不删除表的结构</p>\n</li>\n<li><p>速度,一般来说: drop&gt; truncate &gt;delete</p>\n</li>\n<li><p>delete语句是dml,这个操作会放到rollback segement中,事务提交之后才生效;</p>\n</li>\n<li><p>如果有相应的trigger,执行的时候将被触发. truncate,drop是ddl, 操作立即生效,原数据不放到rollback segment中,不能回滚. 操作不触发trigger。</p>\n</li>\n<li><p>不再需要一张表的时候，用drop</p>\n</li>\n<li><p>想删除部分数据行时候，用delete，并且带上where子句</p>\n</li>\n<li><p>保留表而删除所有数据的时候用truncate</p>\n</li>\n</ul>\n<h4 id=\"in-not-in-exists-not-exists-它们有什么区别，效率如何？\"><a href=\"#in-not-in-exists-not-exists-它们有什么区别，效率如何？\" class=\"headerlink\" title=\"in, not in , exists , not exists 它们有什么区别，效率如何？\"></a>in, not in , exists , not exists 它们有什么区别，效率如何？</h4><ul>\n<li><a href=\"https://segmentfault.com/a/1190000023825926\" target=\"_blank\" rel=\"noopener\">参考文献</a></li>\n</ul>\n<h4 id=\"你是否做过主从一致性校验，如果有，怎么做的，如果没有，你打算怎么做？\"><a href=\"#你是否做过主从一致性校验，如果有，怎么做的，如果没有，你打算怎么做？\" class=\"headerlink\" title=\"你是否做过主从一致性校验，如果有，怎么做的，如果没有，你打算怎么做？\"></a>你是否做过主从一致性校验，如果有，怎么做的，如果没有，你打算怎么做？</h4><ul>\n<li>主从一致性校验有多种工具 例如checksum、mysqldiff、pt-table-checksum等。</li>\n</ul>\n<h4 id=\"你们数据库是否支持emoji表情，如果不支持，如何操作？\"><a href=\"#你们数据库是否支持emoji表情，如果不支持，如何操作？\" class=\"headerlink\" title=\"你们数据库是否支持emoji表情，如果不支持，如何操作？\"></a>你们数据库是否支持emoji表情，如果不支持，如何操作？</h4><ul>\n<li>如果是utf8字符集的话，需要升级至utf8_mb4方可支持。</li>\n</ul>\n<h4 id=\"Too-many-connections\"><a href=\"#Too-many-connections\" class=\"headerlink\" title=\"Too many connections\"></a>Too many connections</h4><blockquote>\n<p>连接数超出 Mysql 的最大连接限制</p>\n</blockquote>\n<ul>\n<li><p>解决方法：</p>\n</li>\n<li><ul>\n<li>1、在 my.cnf 配置文件里面增加连接数，然后重启 MySQL 服务。max_connections = 10000</li>\n<li>2、临时修改最大连接数，重启后不生效。需要在 my.cnf 里面修改配置文件，下次重启生效。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"MySQL数据库cpu飙升到100-的话怎么处理？\"><a href=\"#MySQL数据库cpu飙升到100-的话怎么处理？\" class=\"headerlink\" title=\"MySQL数据库cpu飙升到100%的话怎么处理？\"></a>MySQL数据库cpu飙升到100%的话怎么处理？</h4><ul>\n<li>列出所有进程 show processlist,观察所有进程 ,多秒没有状态变化的(干掉)</li>\n<li>查看超时日志或者错误日志 (一般会是查询以及大批量的插入会导致cpu与i/o上涨,当然不排除网络状态突然断了,导致一个请求服务器只接受到一半，比如where子句或分页子句没有发送,,当然的一次被坑经历)。</li>\n</ul>\n<h3 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h3><p><a href=\"https://mp.weixin.qq.com/s/lnLSOPQkjTkr957ds_4ZPA\" target=\"_blank\" rel=\"noopener\">https://mp.weixin.qq.com/s/lnLSOPQkjTkr957ds_4ZPA</a></p>\n","categories":["查缺补漏"],"tags":["Mysql"]},{"title":"查缺补漏-JavaCore","url":"/posts/4202610895/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h3 id=\"面向对象思想\"><a href=\"#面向对象思想\" class=\"headerlink\" title=\"面向对象思想\"></a>面向对象思想</h3><ul>\n<li>面向对象是一个思想，时间万物皆可以被看做一个对象。</li>\n</ul>\n<h4 id=\"封装\"><a href=\"#封装\" class=\"headerlink\" title=\"封装\"></a>封装</h4><ul>\n<li>隐藏对象的属性和实现的具体细节，只对外暴露公共访问方式。</li>\n</ul>\n<h4 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h4><ul>\n<li>当多个类出现相同代码逻辑时，我们通常将相同的代码重构到一个类中，如果是绑定关系就可以使用继承。</li>\n<li>Java中类是单继承。</li>\n</ul>\n<h4 id=\"多态\"><a href=\"#多态\" class=\"headerlink\" title=\"多态\"></a>多态</h4><ul>\n<li>一个事物的的多种状态，比如女人、男人都是人的性别。人的性别就分为女人、男人。</li>\n</ul>\n<h4 id=\"抽象\"><a href=\"#抽象\" class=\"headerlink\" title=\"抽象\"></a>抽象</h4><ul>\n<li>在逻辑上看似相关的，想要把他们联系起来。这样可以提高效率。矩形、圆形，都可以具有周长和面积两个方法，但是计算的方式完全不同，矩形和圆形之间肯定不能构成子父类的关系，那么只能是同时去继承一个父类。这时，就引出了抽象的概念。</li>\n</ul>\n<h3 id=\"重写和重载\"><a href=\"#重写和重载\" class=\"headerlink\" title=\"重写和重载\"></a>重写和重载</h3><ul>\n<li>重载：同一个类中，方法名相同，参数个数或者类型不相同，返回类型可以不相同。</li>\n<li>重写：类的继承关系中体现，子类重写父类的方法。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>区别点</th>\n<th>重载方法</th>\n<th>重写方法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>发生范围</td>\n<td>同一个类</td>\n<td>子类</td>\n</tr>\n<tr>\n<td>参数列表</td>\n<td>必须修改</td>\n<td>一定不能修改</td>\n</tr>\n<tr>\n<td>返回类型</td>\n<td>可修改</td>\n<td>子类方法返回值类型应比父类方法返回值类型更小或相等</td>\n</tr>\n<tr>\n<td>异常</td>\n<td>可修改</td>\n<td>子类方法声明抛出的异常类应比父类方法声明抛出的异常类更小或相等；</td>\n</tr>\n<tr>\n<td>访问修饰符</td>\n<td>可修改</td>\n<td>一定不能做更严格的限制（可以降低限制）</td>\n</tr>\n<tr>\n<td>发生阶段</td>\n<td>编译期</td>\n<td>运行期</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p>重写(override) </p>\n<ul>\n<li>存在父类和子类之间。</li>\n<li>方法名、参数、返回值相同。</li>\n<li>方法被<code>final</code>修饰不能被重写。</li>\n<li>子类重写父类方法后，不能抛出比父类方法的异常。子类不能缩写父类的方法<code>访问权限</code>。</li>\n</ul>\n</li>\n<li><p>重载(overload)</p>\n<ul>\n<li>参数类型、个数、顺序至少有一个不相同。</li>\n<li>不能重载只有返回值不同的方法名。</li>\n<li>存在于父类和子类、同类中。</li>\n</ul>\n</li>\n<li><p>Constructor 不能被 override（重写）,但是可以 overload（重载）,所以你可以看到⼀个类中有多个构造函数的情况。</p>\n</li>\n</ul>\n<h3 id=\"介绍下-Java-基本数据类型\"><a href=\"#介绍下-Java-基本数据类型\" class=\"headerlink\" title=\"介绍下 Java 基本数据类型\"></a>介绍下 Java 基本数据类型</h3><ul>\n<li>Java中存在8个原生数据类型，同时又分成四种：整形、浮点型、char、Boolean。它们之间存在自动类型转换，规则是从小到大。并且都存在自动装箱拆箱特性，但是这种操作是隐式操作而且在某些情况会导致CG压力增大。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">类型</th>\n<th align=\"center\">存储需求</th>\n<th align=\"center\">取值范围</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">int</td>\n<td align=\"center\">4字节</td>\n<td align=\"center\">-2 147 483 638 ～ 2 147 483 637</td>\n</tr>\n<tr>\n<td align=\"center\">short</td>\n<td align=\"center\">2字节</td>\n<td align=\"center\">-32 768 ～ 32 767</td>\n</tr>\n<tr>\n<td align=\"center\">long</td>\n<td align=\"center\">8字节</td>\n<td align=\"center\">-9 223 372 036 854 775 808 ～ 9 223 372 036 854 775 807</td>\n</tr>\n<tr>\n<td align=\"center\">byte</td>\n<td align=\"center\">1字节</td>\n<td align=\"center\">- 128 ～ 127</td>\n</tr>\n</tbody></table>\n<ul>\n<li>整型的范围与运行Java运行的硬件没有关系，所有的数据类型所占的字节数量与平台无关。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th align=\"center\">类型</th>\n<th align=\"center\">存储需求</th>\n<th align=\"center\">取值范围</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">float</td>\n<td align=\"center\">4字节</td>\n<td align=\"center\">大约 $\\pm$ 3.402 823 37F + 38F (有效位数为7～8位)</td>\n</tr>\n<tr>\n<td align=\"center\">double</td>\n<td align=\"center\">8字节</td>\n<td align=\"center\">大约 $\\pm$ 1.797 693 134 862 315 70E + 308 （有效位数为15位）</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p>double这种类型的精度是float的两倍。</p>\n</li>\n<li><p>所有浮点数值计算都遵循IEEE 754规范，下面是溢出和出错的情况的三种特殊的浮点数值。</p>\n<ul>\n<li>正无穷大</li>\n<li>负无穷大</li>\n<li>NaN ( 不是一个数字 )</li>\n<li>一个整整数除以0的结果为正无穷大，计算0/0或者负数的平方根结果为NaN。</li>\n</ul>\n</li>\n<li><p>char类型</p>\n<ul>\n<li>char类型表示单个字符，属于Unicode编码表。因为历史原因，不建议在程序中使用。除非确实要对UTF-16代码单元进行操作。</li>\n<li>char字节大小<ul>\n<li>Java中无论是汉字还是英文字母都是用Unicode编码来表示的，一个Unicode是16位，每字节是8位，所以一个Unicode码占两字节。但是英文字母比较特殊，源自于8位（1字节）的ASCII吗，于是在Unicode码仅使用了低8位（1字节）就可以表示。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>boolean类型</p>\n<ul>\n<li>布尔类型，只有两个值false、true。基本用于判定条件。</li>\n<li>boolean字节大小<ul>\n<li>Java规范中并未明确规定boolean类型的大小。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><p>自动类型转换</p>\n<ul>\n<li><p><strong>整型、实型（常量）、字符型数据可以混合运算。运算中，不同类型的数据先转化为同一类型，然后进行运算。</strong></p>\n<p>转换从低级到高级。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">byte</span>,<span class=\"keyword\">short</span>,<span class=\"keyword\">char</span>—&gt; <span class=\"keyword\">int</span> —&gt; <span class=\"keyword\">long</span>—&gt; <span class=\"keyword\">float</span> —&gt; <span class=\"keyword\">double</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>不能对boolean进行类型转换、不能把对象类型转换成不相关的对象、把大容量的对象转换成小容量对象时需要强制类型转换、转换过程中间可能出现精度损失。</p>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"装箱和拆箱boxing-or-unboxing\"><a href=\"#装箱和拆箱boxing-or-unboxing\" class=\"headerlink\" title=\"装箱和拆箱boxing or unboxing\"></a>装箱和拆箱<strong>boxing or unboxing</strong></h4><blockquote>\n<p>装箱：将基础类型用它们对应类型包装起来</p>\n<p>拆箱：将包装类型转换成基本数据类型</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th align=\"center\">原语</th>\n<th align=\"center\">对应的JDK类</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">int</td>\n<td align=\"center\">java.lang.Integer</td>\n</tr>\n<tr>\n<td align=\"center\">short</td>\n<td align=\"center\">java.lang.Short</td>\n</tr>\n<tr>\n<td align=\"center\">long</td>\n<td align=\"center\">java.lang.Long</td>\n</tr>\n<tr>\n<td align=\"center\">byte</td>\n<td align=\"center\">java.lang.Byte</td>\n</tr>\n<tr>\n<td align=\"center\">char</td>\n<td align=\"center\">java.lang.Character</td>\n</tr>\n<tr>\n<td align=\"center\">double</td>\n<td align=\"center\">java.lang.Double</td>\n</tr>\n<tr>\n<td align=\"center\">float</td>\n<td align=\"center\">java.lang.Float</td>\n</tr>\n<tr>\n<td align=\"center\">boolean</td>\n<td align=\"center\">java.lang.Boolean</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p>Java中只有原生数据类型是特殊的，它们不是对象。其它的都是对象。那么就一个尴尬的问题，集合类都是存放的对象，JDK5之后考虑到这个问题就自动进行逆行拆箱装箱的操作。</p>\n  <figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//比如所在泛型中是不能存放原生数据类型的，如要要存放原生数据类型的数据，需要装箱。</span></span><br><span class=\"line\">Collection&lt;<span class=\"keyword\">int</span>&gt; c = <span class=\"keyword\">new</span> ArrayList&lt;<span class=\"keyword\">int</span>&gt;(); <span class=\"comment\">//这是无法编译成功的。</span></span><br><span class=\"line\">Collection&lt;Integer&gt; cc = <span class=\"keyword\">new</span> ArrayList&lt;Integer&gt;(); <span class=\"comment\">//这样才行。</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>每个 JDK 类都提供了相应方法来解析它的内部表示，并将其转换为相应的原语类型。</p>\n</li>\n<li><p>但是注意装箱拆箱操作其实是非常消耗内存的举动，在该过程中可能会生成生成无用对象增加GC压力。所以尽量避免这中操作。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">Integer sum = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> index  = <span class=\"number\">1000</span>; index &lt; <span class=\"number\">5000</span>; index ++)&#123;</span><br><span class=\"line\"> sum+=index;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>  比如这种，每次sum都需要自动拆箱。</p>\n</li>\n</ul>\n<ul>\n<li><p>默认情况下整数的类型都是int、浮点型的数都是double。</p>\n   <figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">float</span> d = <span class=\"number\">1.1f</span>; <span class=\"comment\">//在后面添加f,大小写不区分。隐式强制类型转换</span></span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"int-和-Integer-有什么区别。\"><a href=\"#int-和-Integer-有什么区别。\" class=\"headerlink\" title=\"int 和 Integer 有什么区别。\"></a>int 和 Integer 有什么区别。</h3><ul>\n<li>Integer是int的包装类，它有一个int类型字段存储数据，并提供了基础的操作。关于Integer的缓存值，jdk5之后引入了一个静态工厂方法<code>valueOf</code>，在调用它的时候会有明显的性能提升，内部是一个缓存机制<code>IntegerCache</code>默认的长度是-128~127之间。<ul>\n<li>这种缓存行为不仅适用于Integer对象。我们针对所有整数类型的类都有类似的缓存机制。<ul>\n<li>有 ByteCache 用于缓存 Byte 对象。</li>\n<li>有 ShortCache 用于缓存 Short 对象。</li>\n<li>有 LongCache 用于缓存 Long 对象。</li>\n<li>有 CharacterCache 用于缓存 Character 对象。</li>\n<li>Byte，Short，Long 有固定范围: -128 到 127。对于 Character, 范围是 0 到 127。除了 Integer 可以通过参数改变范围外，其它的都不行。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Java中访问类型\"><a href=\"#Java中访问类型\" class=\"headerlink\" title=\"Java中访问类型\"></a>Java中访问类型</h3><table>\n<thead>\n<tr>\n<th>访问类型</th>\n<th>同一个类</th>\n<th>同一个包</th>\n<th>不同包的子类</th>\n<th>不同包的非子类</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>public</td>\n<td>Y</td>\n<td>Y</td>\n<td>Y</td>\n<td>Y</td>\n</tr>\n<tr>\n<td>protected</td>\n<td>Y</td>\n<td>Y</td>\n<td>Y</td>\n<td></td>\n</tr>\n<tr>\n<td>default</td>\n<td>Y</td>\n<td>Y</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>private</td>\n<td>Y</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<h3 id=\"instanceof-关键字\"><a href=\"#instanceof-关键字\" class=\"headerlink\" title=\"instanceof 关键字\"></a><strong>instanceof</strong> <strong>关键字</strong></h3><ul>\n<li>instanceof 严格来说是Java中的一个双目运算符，用来测试一个对象是否为一个类的实例，用法为：</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">boolean</span> result = obj <span class=\"keyword\">instanceof</span> Class</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>其中 obj 为一个对象，Class 表示一个类或者一个接口，当 obj 为 Class 的对象，或者是其直接或间接子类，或者是其接口的实现类，结果result 都返回 true，否则返回false。</p>\n</li>\n<li><p>注意：编译器会检查 obj 是否能转换成右边的class类型，如果不能转换则直接报错，如果不能确定类型，则通过编译，具体看运行时定。</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">System.out.println(i <span class=\"keyword\">instanceof</span> Integer);<span class=\"comment\">//编译不通过 i必须是引用类型，不能是基本类型 </span></span><br><span class=\"line\">System.out.println(i <span class=\"keyword\">instanceof</span> Object);<span class=\"comment\">//编译不通过</span></span><br><span class=\"line\"></span><br><span class=\"line\">Integer integer = <span class=\"keyword\">new</span> Integer(<span class=\"number\">1</span>); </span><br><span class=\"line\">System.out.println(integer <span class=\"keyword\">instanceof</span> Integer);<span class=\"comment\">//true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//false ,在 JavaSE规范 中对 instanceof 运算符的规定就是：如果 obj 为 null，那么将返回 false。</span></span><br><span class=\"line\">System.out.println(<span class=\"keyword\">null</span> <span class=\"keyword\">instanceof</span> Object);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"声明一个Double变量赋值-0-001会编译错误吗-？\"><a href=\"#声明一个Double变量赋值-0-001会编译错误吗-？\" class=\"headerlink\" title=\"声明一个Double变量赋值 0.001会编译错误吗 ？\"></a>声明一个Double变量赋值 0.001会编译错误吗 ？</h3><ul>\n<li>不会，double 数据类型是双精度、64 位、标准的浮点数。</li>\n</ul>\n<h3 id=\"Java是纯粹的面向对象语言吗？\"><a href=\"#Java是纯粹的面向对象语言吗？\" class=\"headerlink\" title=\"Java是纯粹的面向对象语言吗？\"></a>Java是纯粹的面向对象语言吗？</h3><ul>\n<li>Java不是存粹的面向对象语言，因为它包含了原生数据类型，比如int 、double。</li>\n</ul>\n<h3 id=\"String、StringBuffer、StringBuilder的区别\"><a href=\"#String、StringBuffer、StringBuilder的区别\" class=\"headerlink\" title=\"String、StringBuffer、StringBuilder的区别\"></a>String、StringBuffer、StringBuilder的区别</h3><ul>\n<li>可变性<ul>\n<li>String 是不可变的，StringBuffer、StringBuilder是可变的。</li>\n<li>String 类中使用 final 关键字字符数组保存字符串，<code>private　final　char　value[]</code>，所以 String 对象是不可变的。而StringBuilder 与 StringBuffer 都继承自 AbstractStringBuilder 类，在 AbstractStringBuilder 中也是使用字符数组保存字符串<code>char[]value</code> 但是没有用 final 关键字修饰，所以这两种对象都是可变的。</li>\n</ul>\n</li>\n<li>线程安全方面<ul>\n<li>String 中的对象是不可变的，也就可以理解为常量，线程安全。<code>AbstractStringBuilder</code> 是 <code>StringBuilder</code> 与 <code>StringBuffer</code> 的公共父类，但是StringBuffer 对方法加了同步锁或者对调用的方法加了同步锁，所以是线程安全的。StringBuilder 并没有对方法进行加同步锁，所以是非线程安全的。 </li>\n</ul>\n</li>\n<li>性能<ul>\n<li>操作少量的数据 = String</li>\n<li>单线程操作字符串缓冲区下操作大量数据 = StringBuilder</li>\n<li>多线程操作字符串缓冲区下操作大量数据 = StringBuffer</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"为什么-String-类型要用-final-修饰？\"><a href=\"#为什么-String-类型要用-final-修饰？\" class=\"headerlink\" title=\"为什么 String 类型要用 final 修饰？\"></a>为什么 String 类型要用 final 修饰？</h3><blockquote>\n<p> 使用 final 修饰的第一个好处是安全；第二个好处是高效，以 JVM 中的字符串常量池来举例，如下两个变量：</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Test</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">      String s1 = <span class=\"string\">\"java\"</span>;</span><br><span class=\"line\">\t\t  String s2 = <span class=\"string\">\"java\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 以上两个局部变量都存在了常量池中</span></span><br><span class=\"line\">        System.out.println(s1 == s2); <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// new出来的对象不会放到常量池中,内存地址是不同的</span></span><br><span class=\"line\">        String s3 = <span class=\"keyword\">new</span> String();</span><br><span class=\"line\">        String s4 = <span class=\"keyword\">new</span> String();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     \t* 字符串的比较不可以使用双等号,这样会比较内存地址</span></span><br><span class=\"line\"><span class=\"comment\">     \t* 字符串比较应当用equals,可见String重写了equals</span></span><br><span class=\"line\"><span class=\"comment\">     \t*/</span></span><br><span class=\"line\">        System.out.println(s3 == s4); <span class=\"comment\">// false</span></span><br><span class=\"line\">        System.out.println(s3.equals(s4)); <span class=\"comment\">// true</span></span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>只有字符串是不可变时，我们才能实现字符串常量池，字符串常量池可以为我们缓存字符串，提高程序的运行效率，如下图所示：</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/String%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0.png\"></p>\n<ul>\n<li><strong>工作原理</strong></li>\n</ul>\n<p>　　当代码中出现字面量形式创建字符串对象时，JVM首先会对这个字面量进行检查，如果字符串常量池中存在相同内容的字符串对象的引用，则将这个引用返回，否则新的字符串对象被创建，然后将这个引用放入字符串常量池，并返回该引用。</p>\n<h3 id=\"为什么-char-数组比-Java-中的-String-更适合存储密码\"><a href=\"#为什么-char-数组比-Java-中的-String-更适合存储密码\" class=\"headerlink\" title=\"为什么 char 数组比 Java 中的 String 更适合存储密码\"></a>为什么 char 数组比 Java 中的 String 更适合存储密码</h3><ul>\n<li>字符串在 Java 中是不可变的，如果你将密码存储为纯文本，它将在内存中可用，直到垃圾收集器清除它. 并且为了可重用性，会存在 String 在字符串池中, 它很可能会保留在内存中持续很长时间，从而构成安全威胁。</li>\n<li>由于字符串是不可变的，所以不能更改字符串的内容，因为任何更改都会产生新的字符串，而如果你使用char[]，你就可以将所有元素设置为空白或零。因此，在字符数组中存储密码可以明显降低窃取密码的安全风险。</li>\n</ul>\n<h3 id=\"和-equals-与-compareTo\"><a href=\"#和-equals-与-compareTo\" class=\"headerlink\" title=\"== 和 equals 与 compareTo\"></a>== 和 equals 与 compareTo</h3><ul>\n<li><strong>==</strong> : 它的作用是判断两个对象的地址是不是相等。即，判断两个对象是不是同一个对象。(基本数据类型==比较的是值，引用数据类型==比较的是内存地址)</li>\n<li><strong>equals()</strong> : 它的作用也是判断两个对象是否相等。但它一般有两种使用情况：<ul>\n<li>情况1：类没有覆盖 equals() 方法。则通过 equals() 比较该类的两个对象时，等价于通过“==”比较这两个对象。</li>\n<li>情况2：类覆盖了 equals() 方法。一般，我们都覆盖 equals() 方法来两个对象的内容相等；若它们的内容相等，则返回 true (即，认为这两个对象相等)。</li>\n<li>String 中的 equals 方法是被重写过的，因为 object 的 equals 方法是比较的对象的内存地址，而 String 的 equals 方法比较的是对象的值。</li>\n<li>当创建 String 类型的对象时，虚拟机会在常量池中查找有没有已经存在的值和要创建的值相同的对象，如果有就把它赋给当前引用。如果没有就在常量池中重新创建一个 String 对象。</li>\n</ul>\n</li>\n<li><strong>compareTo()</strong> 方法用于比较两个字符串，返回的结果为 int 类型的值。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">compareTo</span><span class=\"params\">(String anotherString)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> len1 = value.length;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> len2 = anotherString.value.length;</span><br><span class=\"line\">    <span class=\"comment\">// 获取到两个字符串长度最短的那个 int 值</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> lim = Math.min(len1, len2);</span><br><span class=\"line\">    <span class=\"keyword\">char</span> v1[] = value;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> v2[] = anotherString.value;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> k = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 对比每一个字符</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> (k &lt; lim) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">char</span> c1 = v1[k];</span><br><span class=\"line\">        <span class=\"keyword\">char</span> c2 = v2[k];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c1 != c2) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 有字符不相等就返回差值</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> c1 - c2;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        k++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> len1 - len2;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>equals() 可以接收一个 Object 类型的参数，而 compareTo() 只能接收一个 String 类型的参数；</p>\n</li>\n<li><p>equals() 返回值为 Boolean，而 compareTo() 的返回值则为 int。</p>\n</li>\n<li><p>它们都可以用于两个字符串的比较，当 equals() 方法返回 true 时，或者是 compareTo() 方法返回 0 时，则表示两个字符串完全相同。</p>\n</li>\n</ul>\n<h3 id=\"为什么要重写equals和hashcode方法\"><a href=\"#为什么要重写equals和hashcode方法\" class=\"headerlink\" title=\"为什么要重写equals和hashcode方法\"></a>为什么要重写equals和hashcode方法</h3><ul>\n<li>equals是Object的成员方法，默认不重写（<em>override</em>）情况下判断等价性。<ul>\n<li>类没有覆盖 equals() 方法。则通过 equals() 比较该类的两个对象时，等价于通过“==”比较这两个对象。</li>\n<li>类覆盖了 equals() 方法。一般，我们都覆盖 equals() 方法来两个对象的内容相等；若它们的内容相等，则返回 true (即，认为这两个对象相等)。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">test</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        String a = <span class=\"keyword\">new</span> String(<span class=\"string\">\"ab\"</span>); <span class=\"comment\">// a 为一个引用</span></span><br><span class=\"line\">        String b = <span class=\"keyword\">new</span> String(<span class=\"string\">\"ab\"</span>); <span class=\"comment\">// b为另一个引用,对象的内容一样</span></span><br><span class=\"line\">        String aa = <span class=\"string\">\"ab\"</span>; <span class=\"comment\">// 放在常量池中</span></span><br><span class=\"line\">        String bb = <span class=\"string\">\"ab\"</span>; <span class=\"comment\">// 从常量池中查找</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (aa == bb) <span class=\"comment\">// true</span></span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"aa==bb\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (a == b) <span class=\"comment\">// false，非同一对象</span></span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"a==b\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (a.equals(b)) <span class=\"comment\">// true</span></span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"aEQb\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"number\">42</span> == <span class=\"number\">42.0</span>) &#123; <span class=\"comment\">// true</span></span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"true\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>hashCode() 的作用是获取哈希码，也称为散列码；它实际上是返回一个int整数。这个哈希码的作用是确定该对象在哈希表中的索引位置。hashCode() 定义在JDK的Object.java中，这就意味着Java中的任何类都包含有hashCode() 函数。</p>\n<ul>\n<li>集合中使用场景。<ul>\n<li>将对象放入到集合中时，首先判断要放入对象的 hashCode 值与集合中的任意一个元素的 hashCode 值是否相等，如果不相等直接将该对象放入集合中。</li>\n<li>如果 hashCode 值相等，然后再通过 equals 方法判断要放入对象与集合中的任意一个对象是否相等，如果 equals 判断不相等，直接将该元素放入到集合中，否则不放入。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>hashCode（）与equals（）的相关规定</p>\n<ol>\n<li>如果两个对象相等，则hashcode一定也是相同的。</li>\n<li>两个对象相等,对两个对象分别调用equals方法都返回true。</li>\n<li>两个对象有相同的hashcode值，它们也不一定是相等的。</li>\n<li><strong>因此，equals 方法被覆盖过，则 hashCode 方法也必须被覆盖</strong>。</li>\n<li>hashCode() 的默认行为是对堆上的对象产生独特值。如果没有重写 hashCode()，则该 class 的两个对象无论如何都不会相等（即使这两个对象指向相同的数据）。</li>\n</ol>\n</li>\n<li><p>总结</p>\n<ul>\n<li>如果在 Java 运行期间对同一个对象调用 hashCode 方法后，无论调用多少次，都应该返回相同的 hashCode，但是在不同的 Java 程序中，执行 hashCode 方法返回的值可能不一致。</li>\n<li>如果两个对象的 equals 相等，那么 hashCode 必须相同。</li>\n<li>如果两个对象 equals 不相等，那么 hashCode 也有可能相同，所以需要重写 hashCode 方法，因为你不知道 hashCode 的底层构造（反正我是不知道，有大牛可以传授传授），所以你需要重写 hashCode 方法，来为不同的对象生成不同的 hashCode 值，这样能够提高不同对象的访问速度。</li>\n<li>hashCode 通常是将地址转换为整数来实现的。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"i-和-i有什么区别\"><a href=\"#i-和-i有什么区别\" class=\"headerlink\" title=\"i++和++i有什么区别\"></a>i++和++i有什么区别</h3><ul>\n<li>i++ 是在程序执行完毕后进行自增，而 ++i 是在程序开始执行前进行自增。<ul>\n<li><strong>i++ 的操作分三步</strong><ul>\n<li>栈中取出 i</li>\n<li>i 自增 1</li>\n<li>将 i 存到栈</li>\n<li>三个阶段：内存到寄存器，寄存器自增，写回内存（这三个阶段中间都可以被中断分离开）</li>\n<li>所以 i++ 不是原子操作，上面的三个步骤中任何一个步骤同时操作，都可能导致 i 的值不正确自增。</li>\n</ul>\n</li>\n<li><strong>++i</strong><ul>\n<li>在多核的机器上，CPU 在读取内存 i 时也会可能发生同时读取到同一值，这就导致两次自增，实际只增加了一次。</li>\n<li>i++ 和 ++i 都不是原子操作。</li>\n</ul>\n</li>\n<li><strong>原子性</strong>：指的是一个操作是不可中断的。即使是在多个线程一起执行的时候，一个操作一旦开始，就不会被其他线程打断。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"如何保证多线程下i-结果正确\"><a href=\"#如何保证多线程下i-结果正确\" class=\"headerlink\" title=\"如何保证多线程下i++ 结果正确\"></a>如何保证多线程下i++ 结果正确</h4><ul>\n<li>使用循环CAS,比如AtomicInteger</li>\n<li>使用锁机制</li>\n<li>使用synchronized</li>\n</ul>\n<h3 id=\"Java值传递和引用传递的区别\"><a href=\"#Java值传递和引用传递的区别\" class=\"headerlink\" title=\"Java值传递和引用传递的区别\"></a>Java值传递和引用传递的区别</h3><blockquote>\n<p>Java 程序设计语言总是采用按值调用。也就是说，方法得到的是所有参数值的一个拷贝，也就是说，方法不能修改传递给它的任何参数变量的内容。按值调用(call by value)表示方法接收的是调用者提供的值</p>\n</blockquote>\n<ul>\n<li><p>其实只有传值</p>\n<ul>\n<li>值传递(call by value)，对于基本型变量，传递的是该变量的副本，改变副本不影响变量。</li>\n<li>传递引用(call by reference)，对于对象型变量，传递的该对象的地址的一个副本，并不是原对象本身。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Java的四种引用，强弱软虚\"><a href=\"#Java的四种引用，强弱软虚\" class=\"headerlink\" title=\"Java的四种引用，强弱软虚\"></a>Java的四种引用，强弱软虚</h3><ul>\n<li><p>强引用</p>\n<ul>\n<li>强引用是平常中使用最多的引用，强引用在程序内存不足（OOM）的时候也不会被回收，使用方式：</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">String str = <span class=\"keyword\">new</span> String(<span class=\"string\">\"str\"</span>);</span><br><span class=\"line\"><span class=\"comment\">// 强引用 str != null;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>当<strong>内存空间不足</strong>时，<code>Java</code>虚拟机宁愿抛出<code>OutOfMemoryError</code>错误，使程序<strong>异常终止</strong>，也不会靠随意<strong>回收</strong>具有<strong>强引用</strong>的<strong>对象</strong>来解决内存不足的问题。 如果强引用对象<strong>不使用时</strong>，需要弱化从而使<code>GC</code>能够回收。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">str = <span class=\"keyword\">null</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>显示的将str对象设置成null，这样就脱离的对象的生命周期，具体什么时候取决当前的gc。</li>\n</ul>\n</li>\n<li><p>软引用</p>\n<ul>\n<li>软引用在程序内存不足时，会被回收，使用方式：</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 注意：wrf这个引用也是强引用，它是指向SoftReference这个对象的， </span></span><br><span class=\"line\"><span class=\"comment\">// 这里的软引用指的是指向new String(\"str\")的引用，也就是SoftReference类中T </span></span><br><span class=\"line\">SoftReference&lt;String&gt; wrf = <span class=\"keyword\">new</span> SoftReference&lt;String&gt;(<span class=\"keyword\">new</span> String(<span class=\"string\">\"str\"</span>));</span><br><span class=\"line\"><span class=\"comment\">// 创建缓存的时候，创建的对象放进缓存中，当内存不足时，JVM就会回收早先创建的对象。</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>弱引用</p>\n<ul>\n<li>弱引用就是只要JVM垃圾回收器发现了它，就会将之回收，使用方式：</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">WeakReference&lt;String&gt; wrf = <span class=\"keyword\">new</span> WeakReference&lt;String&gt;(str);</span><br><span class=\"line\"><span class=\"comment\">// Java源码中的 java.util.WeakHashMap 中的 key 就是使用弱引用</span></span><br><span class=\"line\"><span class=\"comment\">// 不需要某个引用，JVM会自动帮我处理它，这样我就不需要做其它操作</span></span><br><span class=\"line\"><span class=\"comment\">// 弱引用 wrf = null; 无法在获取对象</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>虚引用</p>\n<p>虚引用的回收机制跟弱引用差不多，但是它被回收之前，会被放入 ReferenceQueue 中。其它引用是被JVM回收后才被传入 ReferenceQueue 中的。由于这个机制，所以虚引用大多被用于引用销毁前的处理工作。还有就是，虚引用创建的时候，必须带有 ReferenceQueue ，使用。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">PhantomReference&lt;String&gt; prf = <span class=\"keyword\">new</span> PhantomReference&lt;String&gt;(<span class=\"keyword\">new</span> String(<span class=\"string\">\"str\"</span>), <span class=\"keyword\">new</span> ReferenceQueue&lt;&gt;());</span><br><span class=\"line\"><span class=\"comment\">// 对象销毁前的一些操作，比如说资源释放等。Object.finalize() 虽然也可以做这类动作，但是这个方式即不安全又低效</span></span><br><span class=\"line\"><span class=\"comment\">// prf = null ; 无法在获取对象</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Java中4种引用的级别和强度由高到低依次为：强引用 -&gt; 软引用 -&gt; 弱引用 -&gt; 虚引用</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>回收时间</th>\n<th>用途</th>\n<th>生存时间</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>强引用</td>\n<td>从来不会</td>\n<td>对象的一般状态</td>\n<td>JVM停止运行时终止</td>\n</tr>\n<tr>\n<td>软饮用</td>\n<td>当内存不足时</td>\n<td>对象缓存</td>\n<td>内存不足时终止</td>\n</tr>\n<tr>\n<td>弱饮用</td>\n<td>正常垃圾回收时</td>\n<td>对象缓存</td>\n<td>垃圾回收后终止</td>\n</tr>\n<tr>\n<td>虚饮用</td>\n<td>正常垃圾回收时</td>\n<td>跟踪对象的垃圾回收</td>\n<td>垃圾回收后终止</td>\n</tr>\n</tbody></table>\n<h3 id=\"描述下final-与-finally、finalize的区别。\"><a href=\"#描述下final-与-finally、finalize的区别。\" class=\"headerlink\" title=\"描述下final 与 finally、finalize的区别。\"></a>描述下final 与 finally、finalize的区别。</h3><ul>\n<li><p><code>final</code> ，是修饰符关键字。</p>\n<ul>\n<li><p>如果一个类被声明为final，意味着它不能再派生出新的子类，不能作为父类被继承。因此一个类不能既被声明为 abstract的，又被声明为final的。将变量或方法声明为final，可以保证它们在使用中不被改变。被声明为final的变量必须在new一个对象时初始化（即只能在声明变量或构造器或代码块内初始化），而在以后的引用中只能读取，不可修改。被声明为final的方法也同样只能使用，不能覆盖(重写)。</p>\n<ul>\n<li><p>父类的private成员方法是不能被子类覆盖的，因为被private修饰的方法默认是final类型的。</p>\n</li>\n<li><p>final类</p>\n<ul>\n<li>final类不能被继承，因此final类的成员方法没有机会被覆盖，默认都是final的。如果这个类不需要有子类，类的实现细节不允许改变，并且确信这个类不会载被扩展，那么就设计为final类。</li>\n</ul>\n</li>\n<li><p>final方法</p>\n<ul>\n<li>如果一个类不允许其子类覆盖某个方法，则可以把这个方法声明为final方法。</li>\n</ul>\n</li>\n<li><p>final变量（常量）</p>\n<ul>\n<li>用final修饰的成员变量表示常量，值一旦给定就无法改变！</li>\n<li>final修饰的变量有三种：静态变量、实例变量和局部变量，分别表示三种类型的常量。</li>\n<li>final变量定义的时候，可以先声明，而不给初值，这中变量也称为final空白，无论什么情况，编译器都确保空白final在使用之前必须被初始化。类中的final数据成员就可以根据依赖对象而有所不同，并保持其恒定不变的特征。</li>\n</ul>\n</li>\n<li><p>final参数</p>\n<ul>\n<li>当函数参数为final类型时，你可以读取使用该参数，但是无法改变该参数的值。</li>\n</ul>\n</li>\n<li><p><strong>注意final 不是immutable的</strong></p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p><code>finally</code>在异常处理时提供 <code>finally</code> 块来执行任何清除操作。如果抛出一个异常，那么相匹配的 <code>catch</code> 子句就会执行，然后控制就会进入 <code>finally</code> 块（如果有的话）。</p>\n<ul>\n<li>在异常处理时提供 finally 块来执行任何清除操作。只有在与 finally 相对应的 try 语句块得到执行的情况下，finally 语句块才会执行。如果抛出一个异常，那么相匹配的 catch 子句就会执行，然后控制就会进入 finally 块（如果有的话）。</li>\n<li>finally 语句块可能是要执行的。<ul>\n<li>当try流程中出现程序中断情况是不会在执行finally语句的。也就是说一个线程在执行 try 语句块或者 catch 语句块时被打断（interrupted）或者被终止（killed），与其相对应的 finally 语句块可能不会执行。还有更极端的情况，就是在线程运行 try 语句块或者 catch 语句块时，突然死机或者断电，finally 语句块肯定不会执行了。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p><code>finalize</code> ，是方法名。</p>\n<ul>\n<li>Java 允许使用 <code>#finalize()</code> 方法，在垃圾收集器将对象从内存中清除出去之前做必要的清理工作。这个方法是由垃圾收集器在确定这个对象没有被引用时对这个对象调用的。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"finally对应的try-catch语句流程\"><a href=\"#finally对应的try-catch语句流程\" class=\"headerlink\" title=\"finally对应的try catch语句流程\"></a>finally对应的try catch语句流程</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span>  </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;  </span><br><span class=\"line\">           System.out.println(<span class=\"string\">\"try block\"</span>);  </span><br><span class=\"line\">           <span class=\"keyword\">return</span> ;  </span><br><span class=\"line\">       &#125; <span class=\"keyword\">finally</span> &#123;  </span><br><span class=\"line\">           System.out.println(<span class=\"string\">\"finally block\"</span>);  </span><br><span class=\"line\">       &#125;  </span><br><span class=\"line\">    &#125; </span><br><span class=\"line\"><span class=\"comment\">//运行结果</span></span><br><span class=\"line\"><span class=\"comment\">//try block </span></span><br><span class=\"line\"><span class=\"comment\">//finally block</span></span><br></pre></td></tr></table></figure>\n\n<p>从结果看finally语句会在return之前执行。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span>  </span>&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"return value of test(): \"</span> + test()); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">test</span><span class=\"params\">()</span> </span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = <span class=\"number\">1</span>;</span><br><span class=\"line\"> <span class=\"keyword\">try</span> &#123;  </span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"try block\"</span>);</span><br><span class=\"line\">        i = <span class=\"number\">1</span> / <span class=\"number\">0</span>; <span class=\"comment\">//抛一个异常进catch</span></span><br><span class=\"line\">     <span class=\"keyword\">return</span> i;  </span><br><span class=\"line\"> &#125;<span class=\"keyword\">catch</span> (Exception e)&#123; </span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"exception block\"</span>); </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">2</span>; </span><br><span class=\"line\"> &#125;<span class=\"keyword\">finally</span> &#123;  </span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"finally block\"</span>);  </span><br><span class=\"line\"> &#125; </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"><span class=\"comment\">//运行结果</span></span><br><span class=\"line\"><span class=\"comment\">//try block</span></span><br><span class=\"line\"><span class=\"comment\">//exception block</span></span><br><span class=\"line\"><span class=\"comment\">//finally block</span></span><br><span class=\"line\"><span class=\"comment\">//return value of test(): 2</span></span><br></pre></td></tr></table></figure>\n\n<p> 从结果看finally 语句块在 catch 语句块中的 return 语句之前执行。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span>  </span>&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"return value of test(): \"</span> + test()); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"finally\"</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">test</span><span class=\"params\">()</span> </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; </span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123; </span><br><span class=\"line\">         i = <span class=\"number\">4</span>; </span><br><span class=\"line\">         <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">finally</span> &#123; </span><br><span class=\"line\">         i++; </span><br><span class=\"line\">         <span class=\"keyword\">return</span> i; </span><br><span class=\"line\">      &#125;  </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"comment\">//运行结果</span></span><br><span class=\"line\"><span class=\"comment\">//return value of test(): 5</span></span><br></pre></td></tr></table></figure>\n\n<p>从结果看 finally 语句块中如果出现return那么该流程就结束了。其实是finally块中的return语句会覆盖try块中的return返回。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span>  </span>&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"return value of test3(): \"</span> + test()); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">test3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">int</span> b = <span class=\"number\">20</span>;</span><br><span class=\"line\">     <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"try block\"</span>);</span><br><span class=\"line\">        b += <span class=\"number\">80</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> b; </span><br><span class=\"line\">     &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"catch block\"</span>);</span><br><span class=\"line\">     &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"finally block\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (b &gt; <span class=\"number\">25</span>) &#123;</span><br><span class=\"line\">           b += <span class=\"number\">100</span>;</span><br><span class=\"line\">           System.out.println(<span class=\"string\">\"b&gt;25 and b = \"</span> + b);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> b;</span><br><span class=\"line\"> &#125; </span><br><span class=\"line\"><span class=\"comment\">// 运行结果</span></span><br><span class=\"line\"><span class=\"comment\">//try block</span></span><br><span class=\"line\"><span class=\"comment\">//finally block</span></span><br><span class=\"line\"><span class=\"comment\">//b&gt;25 and b = 200</span></span><br><span class=\"line\"><span class=\"comment\">//return value of test(): 100</span></span><br></pre></td></tr></table></figure>\n\n<p>从结果看:weary:为什么不返回200！为什么finally里面的修改没有效果？因为finally语句中没有return语句覆盖返回值，那么原来的返回值可能因为finally里的修改而改变也可能不变。那什么情况下会改变呢？</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span>  </span>&#123;</span><br><span class=\"line\">   System.out.println(<span class=\"string\">\"return value of test3(): \"</span> + test()); </span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">test3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">int</span> b = <span class=\"number\">20</span>;</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           System.out.println(<span class=\"string\">\"try block\"</span>);</span><br><span class=\"line\">           b += <span class=\"number\">80</span>;</span><br><span class=\"line\">           b = b / <span class=\"number\">0</span>; <span class=\"comment\">//抛异常</span></span><br><span class=\"line\">           <span class=\"keyword\">return</span> b; </span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">           System.out.println(<span class=\"string\">\"catch block\"</span>);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">           System.out.println(<span class=\"string\">\"finally block\"</span>);</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (b &gt; <span class=\"number\">25</span>) &#123;</span><br><span class=\"line\">            b += <span class=\"number\">100</span>;</span><br><span class=\"line\">               System.out.println(<span class=\"string\">\"b&gt;25 and b = \"</span> + b);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> b;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//运行结果</span></span><br><span class=\"line\"><span class=\"comment\">//try block</span></span><br><span class=\"line\"><span class=\"comment\">//catch block</span></span><br><span class=\"line\"><span class=\"comment\">//finally block</span></span><br><span class=\"line\"><span class=\"comment\">//b&gt;25 and b = 200</span></span><br><span class=\"line\"><span class=\"comment\">//return value of test(): 200</span></span><br></pre></td></tr></table></figure>\n\n<p>从结果看finally里面的修改启效果了，因为抛出了异常所以没有执行try代码块里面的return。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span>  </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"return value of test3(): \"</span> + test()); </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">test3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">int</span> b = <span class=\"number\">20</span>;</span><br><span class=\"line\">         <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">             System.out.println(<span class=\"string\">\"try block\"</span>);</span><br><span class=\"line\">             b += <span class=\"number\">80</span>;</span><br><span class=\"line\">             b = b / <span class=\"number\">0</span>;</span><br><span class=\"line\">             <span class=\"keyword\">return</span> b; </span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">         <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">             System.out.println(<span class=\"string\">\"catch block\"</span>);</span><br><span class=\"line\">             <span class=\"keyword\">return</span> b += <span class=\"number\">10</span>;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">         <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">             System.out.println(<span class=\"string\">\"finally block\"</span>);</span><br><span class=\"line\">             <span class=\"keyword\">if</span> (b &gt; <span class=\"number\">25</span>) &#123;</span><br><span class=\"line\">                b += <span class=\"number\">100</span>;</span><br><span class=\"line\">                 System.out.println(<span class=\"string\">\"b&gt;25 and b = \"</span> + b);</span><br><span class=\"line\">             &#125;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"><span class=\"comment\">// 运行结果</span></span><br><span class=\"line\"><span class=\"comment\">// try block</span></span><br><span class=\"line\"><span class=\"comment\">// catch block</span></span><br><span class=\"line\"><span class=\"comment\">// finally block</span></span><br><span class=\"line\"><span class=\"comment\">// b&gt;25 and b = 210</span></span><br><span class=\"line\"><span class=\"comment\">// return value of test(): 110</span></span><br><span class=\"line\"><span class=\"comment\">// 从结果来看，抛出异常后return 方法执行之前，也运行了finally代码块，但是并未影响catch代码块中的返回值。</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>finally块的语句在try或catch中的return语句执行之后返回之前执行，finally里的修改语句可能影响也可能不影响try或catch中 return已经确定的返回值，若finally里也有return语句则覆盖try或catch中的return语句直接返回。没有进入try代码块就不会执行finally代码块。</li>\n</ul>\n<h3 id=\"static-this-super-关键字总结\"><a href=\"#static-this-super-关键字总结\" class=\"headerlink\" title=\"static,this,super 关键字总结\"></a>static,this,super 关键字总结</h3><h4 id=\"static-关键字\"><a href=\"#static-关键字\" class=\"headerlink\" title=\"static 关键字\"></a>static 关键字</h4><blockquote>\n<p>static 关键字主要有以下四种使用场景</p>\n</blockquote>\n<ul>\n<li><p><strong>修饰成员变量和成员方法:</strong> 被 static 修饰的成员属于类，不属于单个这个类的某个对象，被类中所有对象共享，可以并且建议通过类名调用。被static 声明的成员变量属于静态成员变量，静态变量 存放在 Java 内存区域的方法区。调用格式：<code>类名.静态变量名</code> <code>类名.静态方法名()</code></p>\n</li>\n<li><p><strong>静态代码块:</strong> 静态代码块定义在类中方法外, 静态代码块在非静态代码块之前执行(静态代码块—&gt;非静态代码块—&gt;构造方法)。 该类不管创建多少对象，静态代码块只执行一次.</p>\n</li>\n<li><p><strong>静态内部类（static修饰类的话只能修饰内部类）：</strong> 静态内部类与非静态内部类之间存在一个最大的区别: 非静态内部类在编译完成之后会隐含地保存着一个引用，该引用是指向创建它的外围类，但是静态内部类却没有。没有这个引用就意味着：1. 它的创建是不需要依赖外围类的创建。2. 它不能使用任何外围类的非static成员变量和方法。</p>\n</li>\n<li><p><strong>静态导包(用来导入类中的静态资源，1.5之后的新特性):</strong> 格式为：<code>import static</code> 这两个关键字连用可以指定导入某个类中的指定静态资源，并且不需要使用类名调用类中静态成员，可以直接使用类中静态成员变量和成员方法。</p>\n</li>\n</ul>\n<h5 id=\"修饰成员变量和成员方法-常用\"><a href=\"#修饰成员变量和成员方法-常用\" class=\"headerlink\" title=\"修饰成员变量和成员方法(常用)\"></a>修饰成员变量和成员方法(常用)</h5><ul>\n<li><p>被 static 修饰的成员属于类，不属于单个这个类的某个对象，被类中所有对象共享，可以并且建议通过类名调用。被static 声明的成员变量属于静态成员变量，静态变量 存放在 Java 内存区域的方法区。</p>\n</li>\n<li><p>方法区与 Java 堆一样，是各个线程共享的内存区域，它用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。虽然Java虚拟机规范把方法区描述为堆的一个逻辑部分，但是它却有一个别名叫做 Non-Heap（非堆），目的应该是与 Java 堆区分开来。</p>\n</li>\n<li><p>HotSpot 虚拟机中方法区也常被称为 “永久代”，本质上两者并不等价。仅仅是因为 HotSpot 虚拟机设计团队用永久代来实现方法区而已，这样 HotSpot 虚拟机的垃圾收集器就可以像管理 Java 堆一样管理这部分内存了。但是这并不是一个好主意，因为这样更容易遇到内存溢出问题。</p>\n</li>\n<li><p>调用格式：</p>\n<ul>\n<li><code>类名.静态变量名</code></li>\n<li><code>类名.静态方法名()</code></li>\n</ul>\n</li>\n<li><p>如果变量或者方法被 private 则代表该属性或者该方法只能在类的内部被访问而不能在类的外部被访问。</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StaticBean</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    String name;</span><br><span class=\"line\">    <span class=\"comment\">//静态变量</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">StaticBean</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//静态方法</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">SayHello</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Hello i am java\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"StaticBean&#123;\"</span>+</span><br><span class=\"line\">                <span class=\"string\">\"name=\"</span> + name + <span class=\"string\">\",age=\"</span> + age +</span><br><span class=\"line\">                <span class=\"string\">\"&#125;\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StaticDemo</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        StaticBean staticBean = <span class=\"keyword\">new</span> StaticBean(<span class=\"string\">\"1\"</span>);</span><br><span class=\"line\">        StaticBean staticBean2 = <span class=\"keyword\">new</span> StaticBean(<span class=\"string\">\"2\"</span>);</span><br><span class=\"line\">        StaticBean staticBean3 = <span class=\"keyword\">new</span> StaticBean(<span class=\"string\">\"3\"</span>);</span><br><span class=\"line\">        StaticBean staticBean4 = <span class=\"keyword\">new</span> StaticBean(<span class=\"string\">\"4\"</span>);</span><br><span class=\"line\">        StaticBean.age = <span class=\"number\">33</span>;</span><br><span class=\"line\">        System.out.println(staticBean + <span class=\"string\">\" \"</span> + staticBean2 + <span class=\"string\">\" \"</span> + staticBean3 + <span class=\"string\">\" \"</span> + staticBean4);</span><br><span class=\"line\">        <span class=\"comment\">//StaticBean&#123;name=1,age=33&#125; StaticBean&#123;name=2,age=33&#125; StaticBean&#123;name=3,age=33&#125; StaticBean&#123;name=4,age=33&#125;</span></span><br><span class=\"line\">        StaticBean.SayHello();<span class=\"comment\">//Hello i am java</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"静态代码块\"><a href=\"#静态代码块\" class=\"headerlink\" title=\"静态代码块\"></a>静态代码块</h5><ul>\n<li>静态代码块定义在类中方法外, 静态代码块在非静态代码块之前执行(静态代码块—非静态代码块—构造方法)。 该类不管创建多少对象，静态代码块只执行一次.</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> &#123;    </span><br><span class=\"line\">语句体;   </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>一个类中的静态代码块可以有多个，位置可以随便放，它不在任何的方法体内，JVM加载类时会执行这些静态的代码块，如果静态代码块有多个，JVM将按照它们在类中出现的先后顺序依次执行它们，每个代码块只会被执行一次。</li>\n</ul>\n<h5 id=\"静态内部类\"><a href=\"#静态内部类\" class=\"headerlink\" title=\"静态内部类\"></a>静态内部类</h5><ul>\n<li>静态内部类与非静态内部类之间存在一个最大的区别，我们知道非静态内部类在编译完成之后会隐含地保存着一个引用，该引用是指向创建它的外围类，但是静态内部类却没有。没有这个引用就意味着：</li>\n</ul>\n<ol>\n<li>它的创建是不需要依赖外围类的创建。</li>\n<li>它不能使用任何外围类的非static成员变量和方法。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//声明为 private 避免调用默认构造方法创建对象</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">   <span class=\"comment\">// 声明为 private 表明静态内部该类只能在该 Singleton 类中被访问</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SingletonHolder</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Singleton INSTANCE = <span class=\"keyword\">new</span> Singleton();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton <span class=\"title\">getUniqueInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> SingletonHolder.INSTANCE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>当 Singleton 类加载时，静态内部类 SingletonHolder 没有被加载进内存。只有当调用 <code>getUniqueInstance() </code>方法从而触发 <code>SingletonHolder.INSTANCE</code> 时 SingletonHolder 才会被加载，此时初始化 INSTANCE 实例，并且 JVM 能确保 INSTANCE 只被实例化一次。</p>\n</li>\n<li><p>这种方式不仅具有延迟初始化的好处，而且由 JVM 提供了对线程安全的支持。</p>\n</li>\n</ul>\n<h5 id=\"静态导包\"><a href=\"#静态导包\" class=\"headerlink\" title=\"静态导包\"></a>静态导包</h5><ul>\n<li><p>格式为：import static</p>\n</li>\n<li><p>这两个关键字连用可以指定导入某个类中的指定静态资源，并且不需要使用类名调用类中静态成员，可以直接使用类中静态成员变量和成员方法</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">//将Math中的所有静态资源导入，这时候可以直接使用里面的静态方法，而不用通过类名进行调用</span></span><br><span class=\"line\"> <span class=\"comment\">//如果只想导入单一某个静态方法，只需要将换成对应的方法名即可</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"keyword\">static</span> java.lang.Math.*;<span class=\"comment\">//换成import static java.lang.Math.max;具有一样的效果</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">int</span> max = max(<span class=\"number\">1</span>,<span class=\"number\">2</span>);</span><br><span class=\"line\">    System.out.println(max);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"静态方法与非静态方法\"><a href=\"#静态方法与非静态方法\" class=\"headerlink\" title=\"静态方法与非静态方法\"></a>静态方法与非静态方法</h5><ul>\n<li>静态方法属于类本身，非静态方法属于从该类生成的每个对象。 如果您的方法执行的操作不依赖于其类的各个变量和方法，请将其设置为静态（这将使程序的占用空间更小）。 否则，它应该是非静态的。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Foo</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Foo</span><span class=\"params\">(<span class=\"keyword\">int</span> i)</span> </span>&#123; </span><br><span class=\"line\">       <span class=\"keyword\">this</span>.i = i;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">method1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"string\">\"An example string that doesn't depend on i (an instance variable)\"</span>;</span><br><span class=\"line\">       </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">method2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.i + <span class=\"number\">1</span>;  <span class=\"comment\">//Depends on i</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>你可以像这样调用静态方法：<code>Foo.method1()</code>。 如果您尝试使用这种方法调用 method2 将失败。 但这样可行：<code>Foo bar = new Foo(1);bar.method2();</code></li>\n</ul>\n<p>总结：</p>\n<ul>\n<li>在外部调用静态方法时，可以使用”类名.方法名”的方式，也可以使用”对象名.方法名”的方式。而实例方法只有后面这种方式。也就是说，调用静态方法可以无需创建对象。</li>\n<li>静态方法在访问本类的成员时，只允许访问静态成员（即静态成员变量和静态方法），而不允许访问实例成员变量和实例方法；实例方法则无此限制</li>\n</ul>\n<h5 id=\"static-静态代码块与-非静态代码块-构造代码块\"><a href=\"#static-静态代码块与-非静态代码块-构造代码块\" class=\"headerlink\" title=\"static{}静态代码块与{}非静态代码块(构造代码块)\"></a><code>static{}</code>静态代码块与<code>{}</code>非静态代码块(构造代码块)</h5><ul>\n<li><p>相同点： 都是在JVM加载类时且在构造方法执行之前执行，在类中都可以定义多个，定义多个时按定义的顺序执行，一般在代码块中对一些static变量进行赋值。</p>\n</li>\n<li><p>不同点： 静态代码块在非静态代码块之前执行(静态代码块—非静态代码块—构造方法)。静态代码块只在第一次new执行一次，之后不再执行，而非静态代码块在每new一次就执行一次。 非静态代码块可在普通方法中定义(不过作用不大)；而静态代码块不行。</p>\n</li>\n<li><p>一般情况下,如果有些代码比如一些项目最常用的变量或对象必须在项目启动的时候就执行的时候,需要使用静态代码块,这种代码是主动执行的。如果我们想要设计不需要创建对象就可以调用类中的方法，例如：Arrays类，Character类，String类等，就需要使用静态方法, 两者的区别是 静态代码块是自动执行的而静态方法是被调用的时候才执行的.</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Test</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Test</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.print(<span class=\"string\">\"默认构造方法！--\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//非静态代码块</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        System.out.print(<span class=\"string\">\"非静态代码块！--\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//静态代码块</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        System.out.print(<span class=\"string\">\"静态代码块！--\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.print(<span class=\"string\">\"静态方法中的内容! --\"</span>);</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            System.out.print(<span class=\"string\">\"静态方法中的代码块！--\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        Test test = <span class=\"keyword\">new</span> Test();</span><br><span class=\"line\">        Test.test();<span class=\"comment\">//静态代码块！--静态方法中的内容! --静态方法中的代码块！--</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>上述代码输出：</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">静态代码块！--非静态代码块！--默认构造方法！--静态方法中的内容! --静态方法中的代码块！--</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>当只执行 <code>Test.test();</code> 时输出：</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">静态代码块！--静态方法中的内容! --静态方法中的代码块！--</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>当只执行 <code>Test test = new Test();</code> 时输出：</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">静态代码块！--非静态代码块！--默认构造方法！--</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>非静态代码块与构造函数的区别是： 非静态代码块是给所有对象进行统一初始化，而构造函数是给对应的对象初始化，因为构造函数是可以多个的，运行哪个构造函数就会建立什么样的对象，但无论建立哪个对象，都会先执行相同的构造代码块。也就是说，构造代码块中定义的是不同对象共性的初始化内容。</li>\n</ul>\n<h4 id=\"this-关键字\"><a href=\"#this-关键字\" class=\"headerlink\" title=\"this 关键字\"></a>this 关键字</h4><p>this关键字用于引用类的当前实例。 例如：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Manager</span> </span>&#123;</span><br><span class=\"line\">    Employees[] employees;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">manageEmployees</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> totalEmp = <span class=\"keyword\">this</span>.employees.length;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Total employees: \"</span> + totalEmp);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.report();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">report</span><span class=\"params\">()</span> </span>&#123; &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在上面的示例中，this关键字用于两个地方：</p>\n<ul>\n<li>this.employees.length：访问类Manager的当前实例的变量。</li>\n<li>this.report（）：调用类Manager的当前实例的方法。</li>\n</ul>\n<p>此关键字是可选的，这意味着如果上面的示例在不使用此关键字的情况下表现相同。 但是，使用此关键字可能会使代码更易读或易懂。</p>\n<h4 id=\"super-关键字\"><a href=\"#super-关键字\" class=\"headerlink\" title=\"super 关键字\"></a>super 关键字</h4><p>super关键字用于从子类访问父类的变量和方法。 例如：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Super</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"keyword\">int</span> number;</span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"title\">showNumber</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"number = \"</span> + number);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Sub</span> <span class=\"keyword\">extends</span> <span class=\"title\">Super</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">bar</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.number = <span class=\"number\">10</span>;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.showNumber();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在上面的例子中，Sub 类访问父类成员变量 number 并调用其其父类 Super 的 <code>showNumber（）</code> 方法。</p>\n<h3 id=\"使用-this-和-super-要注意的问题\"><a href=\"#使用-this-和-super-要注意的问题\" class=\"headerlink\" title=\"使用 this 和 super 要注意的问题\"></a>使用 this 和 super 要注意的问题</h3><ul>\n<li>在构造器中使用 <code>super（）</code> 调用父类中的其他构造方法时，该语句必须处于构造器的首行，否则编译器会报错。另外，this 调用本类中的其他构造方法时，也要放在首行。</li>\n<li>this、super不能用在static方法中。</li>\n</ul>\n<p><strong>简单解释一下：</strong></p>\n<ul>\n<li>被 static 修饰的成员属于类，不属于单个这个类的某个对象，被类中所有对象共享。而 this 代表对本类对象的引用，指向本类对象；而 super 代表对父类对象的引用，指向父类对象；所以， <strong>this和super是属于对象范畴的东西，而静态方法是属于类范畴的东西</strong>。</li>\n</ul>\n<h3 id=\"Java程序初始化的顺序是怎么样的\"><a href=\"#Java程序初始化的顺序是怎么样的\" class=\"headerlink\" title=\"Java程序初始化的顺序是怎么样的\"></a>Java程序初始化的顺序是怎么样的</h3><p>　在 Java 语言中，当实例化对象时，对象所在类的所有成员变量首先要进行初始化，只有当所有类成员完成初始化后，才会调用对象所在类的构造函数创建象。</p>\n<p><strong>初始化一般遵循3个原则：</strong></p>\n<ul>\n<li>静态对象（变量）优先于非静态对象（变量）初始化，静态对象（变量）只初始化一次，而非静态对象（变量）可能会初始化多次；</li>\n<li>父类优先于子类进行初始化；</li>\n<li>按照成员变量的定义顺序进行初始化。 即使变量定义散布于方法定义之中，它们依然在任何方法（包括构造函数）被调用之前先初始化；</li>\n</ul>\n<p><strong>加载顺序</strong></p>\n<ul>\n<li>父类（静态变量、静态语句块）</li>\n<li>子类（静态变量、静态语句块）</li>\n<li>父类（实例变量、普通语句块）</li>\n<li>父类（构造函数）</li>\n<li>子类（实例变量、普通语句块）</li>\n<li>子类（构造函数）</li>\n</ul>\n<p><strong>实例</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Base</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 1.父类静态代码块</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Base static block!\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 3.父类非静态代码块</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Base block\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 4.父类构造器</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Base</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Base constructor!\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Derived</span> <span class=\"keyword\">extends</span> <span class=\"title\">Base</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.子类静态代码块</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Derived static block!\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 5.子类非静态代码块</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Derived block!\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 6.子类构造器</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Derived</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Derived constructor!\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> Derived();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>结果是：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">Base <span class=\"keyword\">static</span> block!</span><br><span class=\"line\">Derived <span class=\"keyword\">static</span> block!</span><br><span class=\"line\">Base block</span><br><span class=\"line\">Base constructor!</span><br><span class=\"line\">Derived block!</span><br><span class=\"line\">Derived constructor!</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"介绍下异常类型\"><a href=\"#介绍下异常类型\" class=\"headerlink\" title=\"介绍下异常类型\"></a>介绍下异常类型</h3><ul>\n<li>Throwable <ul>\n<li>Error</li>\n<li>Exception<ul>\n<li>RuntimeException</li>\n<li>IOException</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>超类Throwable ，有两个子类Error和Exception，分别表示错误和异常。<ul>\n<li>Error是程序无法处理的错误，比如OutOfMemoryError等。这些异常发生时，Java虚拟机（JVM）一般会选择线程终止。</li>\n<li>Exception是程序本身可以处理的异常，这种异常分两大类运行时异常和非运行时异常。程序中应当尽可能去处理这些异常。<ul>\n<li>运行时异常(RuntimeException)和非运行时异常也称之为不检查异常（Unchecked Exception）和检查异常（Checked Exception）,这两种异常有很大的区别。</li>\n<li>RuntimeException(运行时异常)，表示无法让程序恢复的异常，导致的原因通常是因为执行了错误的操作，建议终止逻辑，因此，编译器不检查这些异常。</li>\n<li>CheckedException(受检查异常)，是表示程序可以处理的异常，也即表示程序可以修复（由程序自己接受异常并且做出处理），所以称之为受检查异常。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>常见的异常<ul>\n<li>NullPointerException: 空指针异常。</li>\n<li>NoSuchMethodException：找不到方法。</li>\n<li>IllegalArgumentException：不合法的参数异常。</li>\n<li>IndexOutOfBoundException: 数组下标越界异常。</li>\n<li>IOException：由于文件未找到、未打开或者 I/O 操作不能进行而引起异常。</li>\n<li>ClassNotFoundException ：找不到文件所抛出的异常。</li>\n<li>NumberFormatException： 字符的 UTF 代码数据格式有错引起异常。</li>\n<li>InterruptedException： 线程中断抛出的异常。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"Throw-和-throws-的区别\"><a href=\"#Throw-和-throws-的区别\" class=\"headerlink\" title=\"Throw 和 throws 的区别\"></a><strong>Throw 和 throws 的区别</strong></h4><ul>\n<li><p><code>throw</code> ，用于在程序中显式地抛出一个异常。</p>\n</li>\n<li><p><code>throws</code> ，用于指出在该方法中没有处理的异常。<strong>每个方法必须显式指明哪些异常没有处理，以便该方法的调用者可以预防可能发生的异常</strong>。最后，多个异常用逗号分隔。</p>\n</li>\n<li><p><strong>位置不同</strong></p>\n<ul>\n<li>throws 用在函数上，后面跟的是异常类，可以跟多个；而 throw 用在函数内，后面跟的是异常对象。</li>\n</ul>\n</li>\n<li><p><strong>功能不同</strong></p>\n<ul>\n<li>throws 用来声明异常，让调用者只知道该功能可能出现的问题，可以给出预先的处理方式；throw 抛出具体的问题对象，执行到 throw，功能就已经结束了，跳转到调用者，并将具体的问题对象抛给调用者。也就是说 throw 语句独立存在时，下面不要定义其他语句，因为执行不到。</li>\n<li>throws 表示出现异常的一种可能性，并不一定会发生这些异常；throw 则是抛出了异常，执行 throw 则一定抛出了某种异常对象。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"常见的异常处理方式\"><a href=\"#常见的异常处理方式\" class=\"headerlink\" title=\"常见的异常处理方式\"></a>常见的异常处理方式</h4><ul>\n<li>使用System.out.println是高代价的，这这做会降低系统吞吐量。</li>\n<li>在生成环境中避免使用printStackTrace()方法，printStackTrace默认会把调用的堆栈打印到控制台上，在生产环境中访问控制台是不现实的。</li>\n<li>如果不能处理异常，就不要捕获该异常。</li>\n<li>如果要捕获异常，应在最近的地方捕获它。</li>\n<li>不要吃掉你的捕捉的异常信息，就是捕获了啥也不做，建议LOG记录。</li>\n<li>不要将异常处理用于正常的控制流（设计良好的 API 不应该强迫它的调用者为了正常的控制流而使用异常）。</li>\n<li>对可以恢复的情况使用受检异常，对编程错误使用运行时异常。</li>\n<li>避免不必要的使用受检异常（可以通过一些状态检测手段来避免异常的发生）。</li>\n<li>优先使用标准的异常。</li>\n<li>每个方法抛出的异常都要有文档。</li>\n<li>保持异常的原子性</li>\n<li>不要在 <code>catch</code> 中忽略掉捕获到的异常。</li>\n</ul>\n<h3 id=\"如何正确的在一个循环中删除ArrayList中的元素。\"><a href=\"#如何正确的在一个循环中删除ArrayList中的元素。\" class=\"headerlink\" title=\"如何正确的在一个循环中删除ArrayList中的元素。\"></a>如何正确的在一个循环中删除ArrayList中的元素。</h3><ul>\n<li><p>如果使用普通for循环直接删除会出现IndexOutOfBoundsException异常，非法索引。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">ArrayList&lt;String&gt; list = <span class=\"keyword\">new</span> ArrayList&lt;String&gt;();</span><br><span class=\"line\">list.add(<span class=\"string\">\"1\"</span>);</span><br><span class=\"line\">list.add(<span class=\"string\">\"2\"</span>);</span><br><span class=\"line\">list.add(<span class=\"string\">\"2\"</span>);</span><br><span class=\"line\">list.add(<span class=\"string\">\"2\"</span>);</span><br><span class=\"line\">list.add(<span class=\"string\">\"3\"</span>);</span><br><span class=\"line\">list.add(<span class=\"string\">\"4\"</span>);</span><br><span class=\"line\">list.add(<span class=\"string\">\"5\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 这样做肯定抛异常，非法访问数据越界</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> len = list.size();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\"> <span class=\"keyword\">if</span>(<span class=\"string\">\"1\"</span>.equals(list.get(i)))&#123;</span><br><span class=\"line\">    list.remove(i);</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Exception in thread \"main\" java.lang.IndexOutOfBoundsException: Index: 4, Size: 4</span></span><br><span class=\"line\"><span class=\"comment\">//改进后,删除元素后更新List长度，更新循环下标。但是这样的可读性很差。而且不适用于多线程场景</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> len = list.size();</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\"> <span class=\"keyword\">if</span>(<span class=\"string\">\"1\"</span>.equals(list.get(i)))&#123;</span><br><span class=\"line\">    list.remove(i);</span><br><span class=\"line\">    --len;</span><br><span class=\"line\">    --i;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//另外一种方式，这种看起来好读多了。。。</span></span><br><span class=\"line\">Iterator&lt;String&gt; sListIterator = list.iterator();  </span><br><span class=\"line\"><span class=\"keyword\">while</span>(sListIterator.hasNext())&#123;  </span><br><span class=\"line\">  String e = sListIterator.next();  <span class=\"comment\">//注意了</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(e.equals(<span class=\"string\">\"1\"</span>))&#123;  </span><br><span class=\"line\">  sListIterator.remove();  </span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h3 id=\"Java序列化\"><a href=\"#Java序列化\" class=\"headerlink\" title=\"Java序列化\"></a>Java序列化</h3><ul>\n<li>序列化就是一种用来处理对象流的机制，所谓对象流也就是将对象的内容进行流化。</li>\n<li>反序列化的过程，则是和序列化相反的过程。</li>\n<li>对于不想进行序列化的变量，使用transient关键字修饰。<ul>\n<li>transient关键字的作用是：阻止实例中那些用此关键字修饰的的变量序列化；当对象被反序列化时，被transient修饰的变量值不会被持久化和恢复。transient只能修饰变量，不能修饰类和方法。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Java反射\"><a href=\"#Java反射\" class=\"headerlink\" title=\"Java反射\"></a>Java反射</h3><ul>\n<li><p>反射(Reflection)是 Java 程序开发语言的特征之一，它允许运行中的 Java 程序获取自身的信息，并且可以操作类或对象的内部属性。</p>\n</li>\n<li><p>通过反射，可以在程序运行时访问Java对象的成员变量、方法、构造方法。</p>\n</li>\n<li><p>反射的缺点</p>\n<ul>\n<li><strong>性能开销</strong> - 由于反射涉及动态解析的类型，因此无法执行某些 Java 虚拟机优化。因此，反射操作的性能要比非反射操作的性能要差，应该在性能敏感的应用程序中频繁调用的代码段中避免。</li>\n<li><strong>破坏封装性</strong> - 反射调用方法时可以忽略权限检查，因此可能会破坏封装性而导致安全问题。</li>\n<li><strong>内部曝光</strong> - 由于反射允许代码执行在非反射代码中非法的操作，例如访问私有字段和方法，所以反射的使用可能会导致意想不到的副作用，这可能会导致代码功能失常并可能破坏可移植性。反射代码打破了抽象，因此可能会随着平台的升级而改变行为。</li>\n</ul>\n</li>\n<li><p><strong>反射的实现方式：</strong></p>\n</li>\n<li><p>第一步：获取Class对象，有4中方法：</p>\n<ul>\n<li>1）Class.forName(“类的路径”)； </li>\n<li>2）类名.class</li>\n<li>3）对象名.getClass()</li>\n<li>4）基本类型的包装类，可以调用包装类的Type属性来获得该包装类的Class对象</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Java多线程\"><a href=\"#Java多线程\" class=\"headerlink\" title=\"Java多线程\"></a>Java多线程</h3><h4 id=\"Java中的主线程\"><a href=\"#Java中的主线程\" class=\"headerlink\" title=\"Java中的主线程\"></a>Java中的主线程</h4><blockquote>\n<p>Java为多线程编程提供内置支持。多线程程序包含两个或多个可以并发运行的部分。这样的程序的每个部分称为线程，每个线程定义一个单独的执行路径。当Java程序启动时，一个线程立即开始运行。这通常被称为我们程序的<em>主</em>线程，因为它是我们程序开始时执行的那个。</p>\n</blockquote>\n<ul>\n<li>它是生产启动其它<code>子</code>线程的线程。</li>\n<li>它负责程序结束时候的收尾工作。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E4%B8%BB%E7%BA%BF%E7%A8%8B.svg\"></p>\n<blockquote>\n<p>上面简单画图出一个主线程和子线程以及后台线程的关系。</p>\n</blockquote>\n<p>在主线程中，这可以通过调用Thread类中的<em>currentThread（）</em>方法来完成。此方法返回对其调用的线程的引用。主线程的默认优先级为5，对于所有剩余的用户线程，优先级将从父级继承到子级。同时虚拟机会启动其它的线程，比如垃圾回收器GC。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.java.test.thread;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ChildThread</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ChildThread</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span> ; i++) &#123;</span><br><span class=\"line\">            System.out.println(Thread.currentThread().getName() + <span class=\"string\">\":  \"</span> + i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.java.test.thread;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MasterThread</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        Thread master = Thread.currentThread();</span><br><span class=\"line\">        <span class=\"comment\">// getting name of Main thread</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Current thread: \"</span> + master.getName());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// changing the name of Main thread</span></span><br><span class=\"line\">        master.setName(<span class=\"string\">\"Master\"</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"After name change: \"</span> + master.getName());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// getting priority of Main thread</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Main thread priority: \"</span>+ master.getPriority());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// setting priority of Main thread to MAX(10)</span></span><br><span class=\"line\">        master.setPriority(Thread.MAX_PRIORITY);</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Main thread new priority: \"</span>+ master.getPriority());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"MasterThread \"</span> + i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        ChildThread childThread1 = <span class=\"keyword\">new</span> ChildThread(<span class=\"string\">\"childThread1\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">// getting priority of child thread</span></span><br><span class=\"line\">        <span class=\"comment\">// which will be inherited from Main thread</span></span><br><span class=\"line\">        <span class=\"comment\">// as it is created by Main thread</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Child1 thread priority: \"</span>+ childThread1.getPriority());</span><br><span class=\"line\">        <span class=\"comment\">// setting priority of Main thread to MIN(1)</span></span><br><span class=\"line\">        childThread1.setPriority(Thread.MIN_PRIORITY);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Child1 thread new priority: \"</span>+ childThread1.getPriority());</span><br><span class=\"line\"></span><br><span class=\"line\">        ChildThread childThread2 = <span class=\"keyword\">new</span> ChildThread(<span class=\"string\">\"childThread2\"</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Child2 thread priority: \"</span>+ childThread2.getPriority());</span><br><span class=\"line\">        childThread2.setPriority(Thread.NORM_PRIORITY);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Child2 thread new priority: \"</span>+ childThread2.getPriority());</span><br><span class=\"line\">        <span class=\"comment\">// starting child thread</span></span><br><span class=\"line\">        childThread1.start();</span><br><span class=\"line\">        childThread2.start();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">   </span><br><span class=\"line\">输出</span><br><span class=\"line\">Current thread: main</span><br><span class=\"line\">After name change: Master</span><br><span class=\"line\">Main thread priority: <span class=\"number\">5</span></span><br><span class=\"line\">Main thread <span class=\"keyword\">new</span> priority: <span class=\"number\">10</span></span><br><span class=\"line\">MasterThread <span class=\"number\">0</span></span><br><span class=\"line\">MasterThread <span class=\"number\">1</span></span><br><span class=\"line\">MasterThread <span class=\"number\">2</span></span><br><span class=\"line\">Child1 thread priority: <span class=\"number\">10</span></span><br><span class=\"line\">Child1 thread <span class=\"keyword\">new</span> priority: <span class=\"number\">1</span></span><br><span class=\"line\">Child2 thread priority: <span class=\"number\">10</span></span><br><span class=\"line\">Child2 thread <span class=\"keyword\">new</span> priority: <span class=\"number\">5</span></span><br><span class=\"line\">childThread1:  <span class=\"number\">0</span></span><br><span class=\"line\">childThread1:  <span class=\"number\">1</span></span><br><span class=\"line\">childThread1:  <span class=\"number\">2</span></span><br><span class=\"line\">childThread2:  <span class=\"number\">0</span></span><br><span class=\"line\">childThread2:  <span class=\"number\">1</span></span><br><span class=\"line\">childThread2:  <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n<p>主线程默认优先级是5经过修改为10，启动的子线程就继承了主线程的级别。</p>\n<h4 id=\"什么是进程\"><a href=\"#什么是进程\" class=\"headerlink\" title=\"什么是进程\"></a>什么是进程</h4><ul>\n<li><p>进程是程序运行和资源分配的基本单位，一个程序至少一个进程，一个进程至少一个线程。</p>\n</li>\n<li><p>多个进程的*<code>内部数据和状态是完全独立的</code>*，<code>而多个线程是共享一个内存空间和一组系统资源，有可能互相影响</code>。</p>\n</li>\n</ul>\n<hr>\n<h4 id=\"什么是线程\"><a href=\"#什么是线程\" class=\"headerlink\" title=\"什么是线程\"></a>什么是线程</h4><ul>\n<li>线程是程序内部的控制流，<code>只能使用分配给线程 的资源和环境</code>。</li>\n<li><code>线程本身的数据通常只有寄存器数据，以及一个程序执行时使用的堆栈</code>，所以线程的切换比进程切换负担要小。</li>\n<li>线程是进程的一个实体，是cpu调度和分派的基本单位，是比程序更小能独立运行的基本单位。</li>\n</ul>\n<hr>\n<h4 id=\"多线程编程的目的\"><a href=\"#多线程编程的目的\" class=\"headerlink\" title=\"多线程编程的目的\"></a>多线程编程的目的</h4><blockquote>\n<p>充分的利用 CPU 和 I/O 的利用率</p>\n</blockquote>\n<ul>\n<li>多线程编程的目的，就是 最大限度地利用CPU资源，当某一线程的处理不需要占用CPC而和I/O等资源打交道时，让需要占用CPU资源的其他线程有机会获得CPU资源，从根本上，这就是多线程编程的最终目的。</li>\n<li>线程(Thread)也是程序的最小单元，它依托进程而存在。</li>\n<li>多个线程可以共享一块内存空间和一组系统资源因此线程之前的切换更加节省资源、更加轻量化，也因此被称为轻量级的进程。</li>\n</ul>\n<h4 id=\"多线程概念介绍\"><a href=\"#多线程概念介绍\" class=\"headerlink\" title=\"多线程概念介绍\"></a>多线程概念介绍</h4><ul>\n<li>一个进程可以包含多个线程。</li>\n<li>一个程序实现多个代码同时交替运行就需要产生多个线程。</li>\n<li>CPU随机的抽出时间，让我们的程序一会做这件事情，一会做另外一件事情。</li>\n<li>同期其他大多数编程语言不同，Java内置支持多线程编程(multithreaded progranmming)。多线程程序包包含两个或两条以上并发运作的部分，吧程序中每个这种的部分都叫做一个线程（thread)，每个线程都独立的执行路经，因此多线程是多任务处理的一种特殊形式。</li>\n<li>多任务处理被所有的现代操作系统所支持。然后，多任务处理有两种截然不同的类型，基于进程和基于线程。<ul>\n<li>基于进程<ul>\n<li>基于进程的多任务处理是更熟悉的形式，进程（process）本质上是一个执行的程序。因此基于进程的多线程任务处理的特点是允许你的计算机同时运行两个或更多的程序。</li>\n</ul>\n</li>\n<li>基于线程<ul>\n<li>基于线程（thread-based)的多任务处理环境中，线程是最小的执行单位。这意味着一个程序可以执行两个或则多个任务的功能。</li>\n</ul>\n</li>\n<li>多线程程序比多进程程序需要更少的管理资源。<ul>\n<li>进程是重量级的任务，需要分配给他们的独立空间地址。进程之间通信是昂贵和受限的。进程之间的转换也是很需要花费的。另一方面，线程是轻量级的选手，它们共享相同的地址空间并且共享同一进程，线程之间通信是轻量级的，线程的转换也是轻量级的。</li>\n</ul>\n</li>\n<li>线程的实现<ul>\n<li>1.两种方法均需要执行线程start方法作为线程分配必须的系统资源、调度线程运行并执行线程的run方法。</li>\n<li>2.在具体应用中，采用哪种方法来构造线程体要试情况而定。通常，当一个线程继承了另一个类，应该应该使用第二种方法，即使实现runnable接口。</li>\n<li>3.线程的消亡不能通过调用一个Trread.stop方法，而是让线程自然消亡。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"线程的生命周期\"><a href=\"#线程的生命周期\" class=\"headerlink\" title=\"线程的生命周期\"></a>线程的生命周期</h4><blockquote>\n<p>一个线程的消亡过程。</p>\n</blockquote>\n<ul>\n<li><h4 id=\"新建（New）\"><a href=\"#新建（New）\" class=\"headerlink\" title=\"新建（New）\"></a>新建（New）</h4><ul>\n<li>创建后尚未启动。</li>\n</ul>\n</li>\n<li><h4 id=\"可运行（Runnable）\"><a href=\"#可运行（Runnable）\" class=\"headerlink\" title=\"可运行（Runnable）\"></a>可运行（Runnable）</h4><ul>\n<li>可能正在运行，也可能正在等待 CPU 时间片。</li>\n<li>包含了操作系统线程状态中的 运行（Running ） 和 就绪（Ready）。</li>\n</ul>\n</li>\n<li><h4 id=\"无限期等待（Waiting）\"><a href=\"#无限期等待（Waiting）\" class=\"headerlink\" title=\"无限期等待（Waiting）\"></a>无限期等待（Waiting）</h4><ul>\n<li><p>等待其它线程显式地唤醒，否则不会被分配 CPU 时间片。</p>\n<table>\n<thead>\n<tr>\n<th>进入方法</th>\n<th>退出方法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>没有设置 Timeout 参数的 Object.wait() 方法</td>\n<td>Object.notify() / Object.notifyAll()</td>\n</tr>\n<tr>\n<td>没有设置 Timeout 参数的 Thread.join() 方法</td>\n<td>被调用的线程执行完毕</td>\n</tr>\n<tr>\n<td>LockSupport.park() 方法</td>\n<td>-</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n</li>\n<li><h4 id=\"限期等待（Timed-Waiting）\"><a href=\"#限期等待（Timed-Waiting）\" class=\"headerlink\" title=\"限期等待（Timed Waiting）\"></a>限期等待（Timed Waiting）</h4><ul>\n<li><p>无需等待其它线程显式地唤醒，在一定时间之后会被系统自动唤醒。</p>\n</li>\n<li><p>调用 Thread.sleep() 方法使线程进入限期等待状态时，常常用 “<strong>使一个线程睡眠</strong>” 进行描述。</p>\n</li>\n<li><p>调用 Object.wait() 方法使线程进入限期等待或者无限期等待时，常常用 “<strong>挂起一个线程</strong>” 进行描述。</p>\n</li>\n<li><p><strong>睡眠和挂起</strong>是用来描述<strong>行为</strong>，而<strong>阻塞</strong>和等待用来描述<strong>状态</strong>。</p>\n</li>\n<li><p>阻塞和等待的区别在于，阻塞是被动的，它是在等待获取一个排它锁。而等待是主动的，通过调用 Thread.sleep() 和 Object.wait() 等方法进入。</p>\n<table>\n<thead>\n<tr>\n<th>进入方法</th>\n<th>退出方法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Thread.sleep() 方法</td>\n<td>时间结束</td>\n</tr>\n<tr>\n<td>设置了 Timeout 参数的 Object.wait() 方法</td>\n<td>时间结束 / Object.notify() / Object.notifyAll()</td>\n</tr>\n<tr>\n<td>设置了 Timeout 参数的 Thread.join() 方法</td>\n<td>时间结束 / 被调用的线程执行完毕</td>\n</tr>\n<tr>\n<td>LockSupport.parkNanos() 方法</td>\n<td>-</td>\n</tr>\n<tr>\n<td>LockSupport.parkUntil() 方法</td>\n<td>-</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n</li>\n<li><h4 id=\"阻塞（Blocking）\"><a href=\"#阻塞（Blocking）\" class=\"headerlink\" title=\"阻塞（Blocking）\"></a>阻塞（Blocking）</h4><ul>\n<li>这个状态下，是在多个线程有同步操作的场景，比如正在等待另一个线程的 synchronized 块的执行释放，或者可重入的 synchronized 块里别人调用 wait() 方法，也就是线程在等待进入临界区。</li>\n<li>阻塞可以分为：等待阻塞，同步阻塞，其他阻塞</li>\n</ul>\n</li>\n<li><h4 id=\"死亡（Terminated）\"><a href=\"#死亡（Terminated）\" class=\"headerlink\" title=\"死亡（Terminated）\"></a>死亡（Terminated）</h4><ul>\n<li>线程因为 run 方法正常退出而自然死亡。</li>\n<li>因为一个没有捕获的异常终止了 run 方法而意外死亡。</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81.png\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/%E5%A4%9A%E7%BA%BF%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%8A%B6%E6%80%81.svg\" alt=\"线程的状态\"></p>\n<h4 id=\"线程的基本方法\"><a href=\"#线程的基本方法\" class=\"headerlink\" title=\"线程的基本方法\"></a>线程的基本方法</h4><ul>\n<li><p>wait线程等待</p>\n<ul>\n<li>调用该方法的线程进入 WAITING 状态，只有等待另外线程的通知或被中断才会返回，需要注意的是调用 wait()方法后，会释放对象的锁。因此，wait 方法一般用在同步方法或同步代码块中。</li>\n</ul>\n</li>\n<li><p>sleep线程睡眠</p>\n<ul>\n<li>sleep 导致当前线程休眠，与 wait 方法不同的是 sleep 不会释放当前占有的锁,sleep(long)会导致线程进入 TIMED-WATING 状态，而 wait()方法会导致当前线程进入 WATING 状态。</li>\n</ul>\n</li>\n<li><p>yield线程让步</p>\n<ul>\n<li>yield 会使当前线程让出 CPU 执行时间片，与其他线程一起重新竞争 CPU 时间片。一般情况下，优先级高的线程有更大的可能性成功竞争得到 CPU 时间片，但这又不是绝对的，有的操作系统对线程优先级并不敏感。</li>\n</ul>\n</li>\n<li><p>interrupt线程中断</p>\n<ul>\n<li><p>中断一个线程，其本意是给这个线程一个通知信号，会影响这个线程内部的一个中断标识位。这个线程本身并不会因此而改变状态(如阻塞，终止等)。</p>\n<ul>\n<li><p>调用 interrupt()方法并不会中断一个正在运行的线程。也就是说处于 Running 状态的线程并不会因为被中断而被终止，仅仅改变了内部维护的中断标识位而已。</p>\n</li>\n<li><p>若调用 sleep()而使线程处于 TIMED-WATING 状态，这时调用 interrupt()方法，会抛出InterruptedException,从而使线程提前结束 TIMED-WATING 状态。</p>\n<p>许多声明抛出 InterruptedException 的方法(如 Thread.sleep(long mills 方法))，抛出异常前，都会清除中断标识位，所以抛出异常后，调用 isInterrupted()方法将会返回 false。</p>\n</li>\n<li><p>中断状态是线程固有的一个标识位，可以通过此标识位安全的终止线程。比如,你想终止一个线程 thread 的时候，可以调用 thread.interrupt()方法，在线程的 run 方法内部可以根据 thread.isInterrupted()的值来优雅的终止线程。</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>join等待其它线程终止</p>\n<ul>\n<li>join() 方法，等待其他线程终止，在当前线程中调用一个线程的 join() 方法，则当前线程转为阻塞状态，回到另一个线程结束，当前线程再由阻塞状态变为就绪状态，等待 cpu 的宠幸。</li>\n<li>很多情况下，主线程生成并启动了子线程，需要用到子线程返回的结果，也就是需要主线程需要在子线程结束后再结束，这时候就要用到 join() 方法。</li>\n</ul>\n</li>\n<li><p>notify线程唤醒</p>\n<ul>\n<li>Object 类中的 notify() 方法，唤醒在此对象监视器上等待的单个线程，如果所有线程都在此对象上等待，则会选择唤醒其中一个线程，选择是任意的，并在对实现做出决定时发生，线程通过调用其中一个 wait() 方法，在对象的监视器上等待，直到当前的线程放弃此对象上的锁定，才能继续执行被唤醒的线程，被唤醒的线程将以常规方式与在该对象上主动同步的其他所有线程进行竞争。类似的方法还有 notifyAll() ，唤醒再次监视器上等待的所有线程。</li>\n</ul>\n</li>\n<li><p>其它方法</p>\n<ul>\n<li>isAlive()： 判断一个线程是否存活。</li>\n<li>activeCount()： 程序中活跃的线程数。</li>\n<li>enumerate()： 枚举程序中的线程。</li>\n<li>currentThread()： 得到当前线程。</li>\n<li>isDaemon()： 一个线程是否为守护线程。</li>\n<li>setDaemon()： 设置一个线程为守护线程。(用户线程和守护线程的区别在于，是否等待主线程依赖于主线程结束而结束) </li>\n<li>setName()： 为线程设置一个名称。</li>\n<li>setPriority()： 设置一个线程的优先级。</li>\n<li>getPriority():：获得一个线程的优先级。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"线程优先级\"><a href=\"#线程优先级\" class=\"headerlink\" title=\"线程优先级\"></a>线程优先级</h4><ul>\n<li><p>设置优先级是为了在多线程环境中便于系统对线程调度，优先级高的线程将优先执行。</p>\n<ul>\n<li>一个线程的优先级遵从以下原则。<ul>\n<li>线程创建时，子继承父的优先级。</li>\n<li>线程创建后，可用过调用setPriority()方法改变优先级。</li>\n<li>线程的优先级是1-10之间的正整数。<ul>\n<li>1   -  MIN_PRIORITY</li>\n<li>10 -  MAX_PRIORITY</li>\n<li>5   -  NORM_PRIORITY</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>线程的优先级策略</p>\n<ul>\n<li>线程调度器选择优先级最高的线程运行.但是,如果发生以下情况,就会终止线程的运行.<ul>\n<li>线程体中调用了yieid()方法,让出了对CPU的占用权。</li>\n<li>线程体中调用sleep()方法，使线程进入了睡眠状态。</li>\n<li>线程由I/O操作而受阻塞。</li>\n<li>另一个更高优先级的线程出现。</li>\n<li>在支持时间片段系统中，该线程的时间片用完。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"上下文切换\"><a href=\"#上下文切换\" class=\"headerlink\" title=\"上下文切换\"></a>上下文切换</h4><ul>\n<li><p>是指某一时间点 CPU 寄存器和程序计数器的内容。</p>\n<ul>\n<li>寄存器<ul>\n<li>是 CPU 内部的数量较少但是速度很快的内存（与之对应的是 CPU 外部相对较慢的 RAM 主内存）。寄存器通过对常用值（通常是运算的中间值）的快速访问来提高计算机程序运行的速度。</li>\n</ul>\n</li>\n<li>程序计数器<ul>\n<li>是一个专用的寄存器，用于表明指令序列中 CPU 正在执行的位置，存的值为正在执行的指令的位置或者下一个将要被执行的指令的位置，具体依赖于特定的系统。</li>\n</ul>\n</li>\n<li>上下文切换的活动</li>\n</ul>\n<ol>\n<li>挂起一个进程，将这个进程在 CPU 中的状态（上下文）存储于内存中的某处。</li>\n<li>在内存中检索下一个进程的上下文并将其在 CPU 的寄存器中恢复。</li>\n<li>跳转到程序计数器所指向的位置（即跳转到进程被中断时的代码行），以恢复该进程在程序中。</li>\n</ol>\n<ul>\n<li><strong>引起线程上下文切换的原因</strong></li>\n</ul>\n<ol>\n<li>当前执行任务的时间片用完之后，系统 CPU 正常调度下一个任务。</li>\n<li>当前执行任务碰到 IO 阻塞，调度器将此任务挂起，继续下一任务。</li>\n<li>多个任务抢占锁资源，当前任务没有抢到锁资源，被调度器挂起，继续下一任务。</li>\n<li>用户代码挂起当前任务，让出 CPU 时间。</li>\n<li>硬件中断。</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"线程的同步\"><a href=\"#线程的同步\" class=\"headerlink\" title=\"线程的同步\"></a>线程的同步</h4><ul>\n<li>在多线程环境中，可能会出现两个甚至多个线程试图同时访问一个有限的资源。必须对这种潜在的资源冲突进行预防。<ul>\n<li>解决方案：在线程使用一个资源时为其加锁即可。访问资源的第一个线程为其上锁以后，其他线程比便不能在使用那个资源。除非被解锁。</li>\n</ul>\n</li>\n<li>在线程环境中，关于成员变量与局部变量；如果一个变量是成员变量，那么多个线程对同一个对象的成员变量进行操作时候，他们对该成员变量是彼此影响到（也就是说一个线程对成员变量的改变会影响另一个到另一线程）。</li>\n<li>不能依靠线程优先级来决定线程的执行。</li>\n<li>同步到实现方式<ul>\n<li>synchronized 关键字；当synchronized关键字修饰一个方法的时候，该方法叫做同步方法。</li>\n<li>Java中方锁。<ul>\n<li>java中每个对象都有一个锁(lock)或者叫监视器(monitor)，当访问一个对象synchronized方法时，表示将该对象上锁，此时其他任何线程在去访问该synchronized方法了，直到之前那个线程执行方法完毕后（或者抛出异常），那么该对象的锁释放掉。其他线程才有可能再去访问synchronized方法。</li>\n<li>如果一个对象中有多个synchronized方法，某一时刻某个线程进入了该对象中的synchronized方法，那么在该方法没有执行完成之前或者抛出异常之前，其他线程是无法访问该对象的任何synchronized方法。</li>\n<li>被synchronized保护的变量应该是private修饰的。</li>\n<li>如果某个synchronized方法被static修饰的，那么当线程访问该方法时候，它锁定并不是对象（实例），而是synchronized方法所以在对象所对应的Class对象，因为Java中无论一个类有多少个对象，这些对象都会对应唯一一个Class对象，因此当线程分别访问一个类的两个对象的两个static synchronized方法时，他们的执行顺序是顺序的，也就是说一个线程先执行方法，执行完毕后另一个线程才开始执行。</li>\n<li>synchronized方法是一个粗粒度的控制，某一个时刻只能有一个方法执行synchronized方法；sysnchronized块则是一种细粒度的控制方；只会将代码块同步。位于方法内、synchronized块之外的代码是可以被多个线程同时访问的。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"线程如何工作的？\"><a href=\"#线程如何工作的？\" class=\"headerlink\" title=\"线程如何工作的？\"></a>线程如何工作的？</h4><ul>\n<li><p>线程的状态在枚举的方式被定义在 Thread 的源码中，它总共包含以下 6 个状态：</p>\n<ul>\n<li>NEW，新建状态，线程被创建出来，但尚未启动时的线程状态；</li>\n<li>RUNNABLE，就绪状态，表示可以运行的线程状态，它可能正在运行，或者是在排队等待操作系统给它分配 CPU 资源；</li>\n<li>BLOCKED，阻塞等待锁的线程状态，表示处于阻塞状态的线程正在等待监视器锁，比如等待执行 synchronized 代码块或者使用 synchronized 标记的方法；</li>\n<li>WAITING，等待状态，一个处于等待状态的线程正在等待另一个线程执行某个特定的动作，比如，一个线程调用了 Object.wait() 方法，那它就在等待另一个线程调用 Object.notify() 或 Object.notifyAll() 方法；</li>\n<li>TIMED_WAITING，计时等待状态，和等待状态（WAITING）类似，它只是多了超时时间，比如调用了有超时时间设置的方法 Object.wait(long timeout) 和 Thread.join(long timeout) 等这些方法时，它才会进入此状态；</li>\n<li>TERMINATED，终止状态，表示线程已经执行完成。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"线程的执行流程\"><a href=\"#线程的执行流程\" class=\"headerlink\" title=\"线程的执行流程\"></a>线程的执行流程</h4><ul>\n<li>首先先要创建线程并指定线程需要执行的业务方法，然后再调用线程的 start() 方法，此时线程就从 NEW（新建）状态变成了 RUNNABLE（就绪）状态，此时线程会判断要执行的方法中有没有 synchronized 同步代码块，如果有并且其他线程也在使用此锁，那么线程就会变为 BLOCKED（阻塞等待）状态，当其他线程使用完此锁之后，线程会继续执行剩余的方法。当遇到 Object.wait() 或 Thread.join() 方法时，线程会变为 WAITING（等待状态）状态，如果是带了超时时间的等待方法，那么线程会进入 TIMED_WAITING（计时等待）状态，当有其他线程执行了 notify() 或 notifyAll() 方法之后，线程被唤醒继续执行剩余的业务方法，直到方法执行完成为止，此时整个线程的流程就执行完了</li>\n</ul>\n<h4 id=\"Java实现多线程的方式\"><a href=\"#Java实现多线程的方式\" class=\"headerlink\" title=\"Java实现多线程的方式\"></a>Java实现多线程的方式</h4><p>有三种使用线程的方法：</p>\n<ul>\n<li>实现 Runnable 接口；</li>\n<li>实现 Callable 接口；</li>\n<li>继承 Thread 类。</li>\n</ul>\n<p>实现 Runnable 和 Callable 接口的类只能当做一个可以在线程中运行的任务，不是真正意义上的线程，因此最后还需要通过 Thread 来调用。可以说任务是通过线程驱动从而执行的。</p>\n<h5 id=\"1-实现-Runnable-接口\"><a href=\"#1-实现-Runnable-接口\" class=\"headerlink\" title=\"1.实现 Runnable 接口\"></a>1.实现 Runnable 接口</h5><p>需要实现 run() 方法。</p>\n<p>通过 Thread 调用 start() 方法来启动线程。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyRunnable</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">    MyRunnable instance = <span class=\"keyword\">new</span> MyRunnable();</span><br><span class=\"line\">    Thread thread = <span class=\"keyword\">new</span> Thread(instance);</span><br><span class=\"line\">    thread.start();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"2-实现-Callable-接口\"><a href=\"#2-实现-Callable-接口\" class=\"headerlink\" title=\"2.实现 Callable 接口\"></a>2.实现 Callable 接口</h5><p>与 Runnable 相比，Callable 可以有返回值，返回值通过 FutureTask 进行封装。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyCallable</span> <span class=\"keyword\">implements</span> <span class=\"title\">Callable</span>&lt;<span class=\"title\">Integer</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">call</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">123</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class=\"line\">    MyCallable mc = <span class=\"keyword\">new</span> MyCallable();</span><br><span class=\"line\">    FutureTask&lt;Integer&gt; ft = <span class=\"keyword\">new</span> FutureTask&lt;&gt;(mc);</span><br><span class=\"line\">    Thread thread = <span class=\"keyword\">new</span> Thread(ft);</span><br><span class=\"line\">    thread.start();</span><br><span class=\"line\">    System.out.println(ft.get());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"3-继承-Thread-类\"><a href=\"#3-继承-Thread-类\" class=\"headerlink\" title=\"3.继承 Thread 类\"></a>3.继承 Thread 类</h5><p>同样也是需要实现 run() 方法，因为 Thread 类也实现了 Runable 接口。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyThread</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">    MyThread mt = <span class=\"keyword\">new</span> MyThread();</span><br><span class=\"line\">    mt.start();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-Runnable-VS-Thread\"><a href=\"#4-Runnable-VS-Thread\" class=\"headerlink\" title=\"4.Runnable VS  Thread\"></a>4.Runnable VS  Thread</h5><p>实现接口会更好一些，因为：</p>\n<ul>\n<li>Java 不支持多重继承，因此继承了 Thread 类就无法继承其它类，但是可以实现多个接口；</li>\n<li>类可能只要求可执行就行，继承整个 Thread 类开销过大。</li>\n</ul>\n<h5 id=\"5-三种方式的区别\"><a href=\"#5-三种方式的区别\" class=\"headerlink\" title=\"5.三种方式的区别\"></a>5.三种方式的区别</h5><ul>\n<li>实现 Runnable 接口可以避免 Java 单继承特性而带来的局限；增强程序的健壮性，代码能够被多个线程共享，代码与数据是独立的；适合多个相同程序代码的线程区处理同一资源的情况。</li>\n<li>继承 Thread 类和实现 Runnable 方法启动线程都是使用 start() 方法，然后 JVM 虚拟机将此线程放到就绪队列中，如果有处理机可用，则执行 run() 方法。</li>\n<li>实现 Callable 接口要实现 call() 方法，并且线程执行完毕后会有返回值。其他的两种都是重写 run() 方法，没有返回值。</li>\n</ul>\n<h4 id=\"BLOCKED（阻塞等待）和-WAITING（等待）有什么区别？\"><a href=\"#BLOCKED（阻塞等待）和-WAITING（等待）有什么区别？\" class=\"headerlink\" title=\"BLOCKED（阻塞等待）和 WAITING（等待）有什么区别？\"></a>BLOCKED（阻塞等待）和 WAITING（等待）有什么区别？</h4><ul>\n<li>虽然 BLOCKED 和 WAITING 都有等待的含义，但二者有着本质的区别，首先它们状态形成的调用方法不同，其次 BLOCKED 可以理解为当前线程还处于活跃状态，只是在阻塞等待其他线程使用完某个锁资源；而 WAITING 则是因为自身调用了 Object.wait() 或着是 Thread.join() 又或者是 LockSupport.park() 而进入等待状态，只能等待其他线程执行某个特定的动作才能被继续唤醒，比如当线程因为调用了 Object.wait() 而进入 WAITING 状态之后，则需要等待另一个线程执行 Object.notify() 或 Object.notifyAll() 才能被唤醒。</li>\n</ul>\n<h4 id=\"start-方法和-run-方法有什么区别？\"><a href=\"#start-方法和-run-方法有什么区别？\" class=\"headerlink\" title=\"start() 方法和 run() 方法有什么区别？\"></a>start() 方法和 run() 方法有什么区别？</h4><blockquote>\n<p> Thread 源码来看，start() 方法属于 Thread 自身的方法，并且使用了 synchronized 来保证线程安全，源码如下</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">start</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 状态验证，不等于 NEW 的状态会抛出异常</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (threadStatus != <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalThreadStateException();</span><br><span class=\"line\">    <span class=\"comment\">// 通知线程组，此线程即将启动</span></span><br><span class=\"line\"></span><br><span class=\"line\">    group.add(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> started = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        start0();</span><br><span class=\"line\">        started = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!started) &#123;</span><br><span class=\"line\">                group.threadStartFailed(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable ignore) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 不处理任何异常，如果 start0 抛出异常，则它将被传递到调用堆栈上</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>run() 方法为 Runnable 的抽象方法，必须由调用类重写此方法，重写的 run() 方法其实就是此线程要执行的业务方法，源码如下：</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Thread</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</span><br><span class=\"line\"> <span class=\"comment\">// 忽略其他方法......</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> Runnable target;</span><br><span class=\"line\">  <span class=\"meta\">@Override</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (target != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">          target.run();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">@FunctionalInterface</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Runnable</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>从执行的效果来说，start() 方法可以开启多线程，让线程从 NEW 状态转换成 RUNNABLE 状态，而 run() 方法只是一个普通的方法。</p>\n<p>其次，它们可调用的次数不同，start() 方法不能被多次调用，否则会抛出 java.lang.IllegalStateException；而 run() 方法可以进行多次调用，因为它只是一个普通的方法而已。</p>\n</blockquote>\n<h4 id=\"线程的优先级有什么用？该如何设置？\"><a href=\"#线程的优先级有什么用？该如何设置？\" class=\"headerlink\" title=\"线程的优先级有什么用？该如何设置？\"></a>线程的优先级有什么用？该如何设置？</h4><blockquote>\n<p>在 Thread 源码中和线程优先级相关的属性有 3 个：</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 线程可以拥有的最小优先级</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> MIN_PRIORITY = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 线程默认优先级</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> NORM_PRIORITY = <span class=\"number\">5</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 线程可以拥有的最大优先级</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> MAX_PRIORITY = <span class=\"number\">10</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>线程的优先级可以理解为线程抢占 CPU 时间片的概率，优先级越高的线程优先执行的概率就越大，但并不能保证优先级高的线程一定先执行。</p>\n<p>在程序中我们可以通过 Thread.setPriority() 来设置优先级，setPriority() 源码如下：</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">setPriority</span><span class=\"params\">(<span class=\"keyword\">int</span> newPriority)</span> </span>&#123;</span><br><span class=\"line\">    ThreadGroup g;</span><br><span class=\"line\">    checkAccess();</span><br><span class=\"line\">    <span class=\"comment\">// 先验证优先级的合理性</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (newPriority &gt; MAX_PRIORITY || newPriority &lt; MIN_PRIORITY) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>((g = getThreadGroup()) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 优先级如果超过线程组的最高优先级，则把优先级设置为线程组的最高优先级</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newPriority &gt; g.getMaxPriority()) &#123;</span><br><span class=\"line\">            newPriority = g.getMaxPriority();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        setPriority0(priority = newPriority);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"sleep-和wait-的区别\"><a href=\"#sleep-和wait-的区别\" class=\"headerlink\" title=\"sleep() 和wait()的区别\"></a>sleep() 和wait()的区别</h4><ul>\n<li><p>sleep是Thread的成员方法，睡眠时保持对象锁，仍然占有该锁。</p>\n<ul>\n<li>sleep()使当前线程进入停滞状态（阻塞当前线程），让出CUP的使用、目的是不让当前线程独自霸占该进程所获的CPU资源，以留一定时间给其他线程执行的机会;sleep()是Thread类的Static(静态)的方法；因此他不能改变对象的机锁，所以当在一个Synchronized块中调用Sleep()方法是，线程虽然休眠了，但是对象的机锁并木有被释放，其他线程无法访问这个对象（即使睡着也持有对象锁）。在sleep()休眠时间期满后，该线程不一定会立即执行，这是因为其它线程可能正在运行而且没有被调度为放弃执行，除非此线程具有更高的优先级。 </li>\n</ul>\n</li>\n<li><p>wait是Object的成员方法睡眠时，释放对象锁。</p>\n<ul>\n<li>wait()方法是Object类里的方法；当一个线程执行到wait()方法时，它就进入到一个和该对象相关的等待池中，同时失去（释放）了对象的机锁（暂时失去机锁，wait(long timeout)超时时间到后还需要返还对象锁）；其他线程可以访问；wait()使用notify或者notifyAlll或者指定睡眠时间来唤醒当前等待池中的线程。wiat()必须放在synchronized block中，否则会在program runtime时扔出”java.lang.IllegalMonitorStateException“异常。</li>\n</ul>\n</li>\n<li><p>两者最主要的区别在于：<strong>sleep</strong> ⽅法没有释放锁，⽽ <strong>wait</strong> ⽅法释放了锁 。</p>\n</li>\n<li><p>wait 通常被⽤于线程间交互/通信，sleep 通常被⽤于暂停执⾏。</p>\n</li>\n<li><p>wait() ⽅法被调⽤后，线程不会⾃动苏醒，需要别的线程调⽤同⼀个对象上的 notify() 或者notifyAll() ⽅法。sleep() ⽅法执⾏完成后，线程会⾃动苏醒。或者可以使⽤ wait(longtimeout)超时后线程会⾃动苏醒。</p>\n</li>\n<li><p>wait只能在synchronize代码块中，<strong>sleep</strong>不需要。</p>\n</li>\n</ul>\n<h4 id=\"为什么我们调⽤-start-⽅法时会执⾏-run-⽅法，为什么我们不能直接调⽤run-⽅法？\"><a href=\"#为什么我们调⽤-start-⽅法时会执⾏-run-⽅法，为什么我们不能直接调⽤run-⽅法？\" class=\"headerlink\" title=\"为什么我们调⽤ start() ⽅法时会执⾏ run() ⽅法，为什么我们不能直接调⽤run() ⽅法？\"></a>为什么我们调⽤ start() ⽅法时会执⾏ run() ⽅法，为什么我们不能直接调⽤run() ⽅法？</h4><ul>\n<li>new ⼀个 Thread，线程进⼊了新建状态;调⽤ start() ⽅法，会启动⼀个线程并使线程进⼊了就绪状态，当分配到时间⽚后就可以开始运⾏了。 start() 会执⾏线程的相应准备⼯作，然后⾃动执⾏run() ⽅法的内容，这是真正的多线程⼯作。 ⽽直接执⾏ run() ⽅法，会把 run ⽅法当成⼀个 main线程下的普通⽅法去执⾏，并不会在某个线程中执⾏它，所以这并不是多线程⼯作。</li>\n<li>总结： 调⽤ <strong>start</strong> ⽅法⽅可启动线程并使线程进⼊就绪状态，⽽ <strong>run</strong> ⽅法只是 <strong>thread</strong> 的⼀个普通⽅法调⽤，还是在主线程⾥执⾏。</li>\n</ul>\n<h4 id=\"notify与notifyAll的区别\"><a href=\"#notify与notifyAll的区别\" class=\"headerlink\" title=\"notify与notifyAll的区别\"></a>notify与notifyAll的区别</h4><blockquote>\n<p>尽量使用notifyAll。</p>\n</blockquote>\n<ul>\n<li>调用 notify() 方法导致解除阻塞的线程是从因调用该对象的 wait() 方法而阻塞的线程中随机选取的，我们无法预料哪一个线程将会被选择，所以编程时要特别小心，避免因这种不确定性而产生问题。</li>\n<li>notifyAll() 也可起到类似作用，唯一的区别在于，调用 notifyAll() 方法将把因调用该对象的 wait() 方法而阻塞的所有线程一次性全部解除阻塞。当然，只有获得锁的那一个线程才能进入可执行状态。</li>\n<li>两者最⼤的区别：<ul>\n<li><strong>notifyAll</strong>使所有原来在该对象上等待被notify的线程统统退出wait的状态，变成等待该对象上的锁，⼀旦该对象被解锁，他们就会去竞争。</li>\n<li>notify他只是选择⼀个wait状态线程进⾏通知，并使它获得该对象上的锁，但不惊动其他同样在等待被该对象notify的线程们，当第⼀个线程运⾏完毕以后释放对象上的锁，此时如果该对象没有再次使⽤notify语句，即便该对象已经空闲，其他wait状态等待的线程由于没有得到该对象的通知，继续处在wait状态，直到这个对象发出⼀个notify或notifyAll，它们等待的是被notify或notifyAll，⽽不是锁。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"有三个线程T1-T2-T3-如何保证顺序执行？\"><a href=\"#有三个线程T1-T2-T3-如何保证顺序执行？\" class=\"headerlink\" title=\"有三个线程T1,T2,T3,如何保证顺序执行？\"></a>有三个线程T1,T2,T3,如何保证顺序执行？</h4><blockquote>\n<p>在多线程中有多种方法让线程按特定顺序执行，你可以用线程类的join()方法在一个线程中启动另一个</p>\n<p>线程，另外一个线程完成该线程继续执行。为了确保三个线程的顺序你应该先启动最后一个(T3调用</p>\n<p>T2，T2调用T1)，这样T1就会先完成而T3最后完成。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JoinTest2</span> </span>&#123; </span><br><span class=\"line\"><span class=\"comment\">// 1.现在有T1、T2、T3三个线程，你怎样保证T2在T1执行完后执行，T3在T2执行完后执行 </span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Thread t1 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">      <span class=\"meta\">@Override</span></span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"t1\"</span>);</span><br><span class=\"line\">      &#125; &#125;); </span><br><span class=\"line\">    <span class=\"keyword\">final</span> Thread t2 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">      <span class=\"meta\">@Override</span> </span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">// 引用t1线程，等待t1线程执行完 </span></span><br><span class=\"line\">          t1.join(); </span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">          e.printStackTrace(); </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"t2\"</span>); </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      &#125;); </span><br><span class=\"line\">    Thread t3 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">      <span class=\"meta\">@Override</span> </span><br><span class=\"line\">      <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">// 引用t2线程，等待t2线程执行完 </span></span><br><span class=\"line\">          t2.join(); </span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">          e.printStackTrace(); </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"t3\"</span>); </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      &#125;); </span><br><span class=\"line\">    t3.start();</span><br><span class=\"line\">    <span class=\"comment\">//这里三个线程的启动顺序可以任意，大家可以试下！ </span></span><br><span class=\"line\">    t2.start(); </span><br><span class=\"line\">    t1.start(); </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"在多线程中，什么是上下文切换-context-switching-？\"><a href=\"#在多线程中，什么是上下文切换-context-switching-？\" class=\"headerlink\" title=\"在多线程中，什么是上下文切换(context-switching)？\"></a><strong>在多线程中，什么是上下文切换(context-switching)？</strong></h4><ul>\n<li>上下文切换是存储和恢复CPU状态的过程，它使得线程执行能够从中断点恢复执行。上下文切换是多任务操作系统和多线程环境的基本特征。</li>\n<li>多线程编程中⼀般线程的个数都⼤于 CPU 核⼼的个数，⽽⼀个 CPU 核⼼在任意时刻只能被⼀个线程使⽤，为了让这些线程都能得到有效执⾏，CPU 采取的策略是为每个线程分配时间⽚并轮转的形式。当⼀个线程的时间⽚⽤完的时候就会重新处于就绪状态让给其他线程使⽤，这个过程就属于⼀次上下⽂切换。</li>\n<li>概括来说就是：当前任务在执⾏完 CPU 时间⽚切换到另⼀个任务之前会先保存⾃⼰的状态，以便下次再切换回这个任务时，可以再加载这个任务的状态。任务从保存到再加载的过程就是⼀次上下⽂切换。上下⽂切换通常是计算密集型的。也就是说，它需要相当可观的处理器时间，在每秒⼏⼗上百次的切换中，每次切换都需要纳秒量级的时间。所以，上下⽂切换对系统来说意味着消耗⼤量的 CPU 时间，事实上，可能是操作系统中时间消耗最⼤的操作。</li>\n<li>Linux 相⽐与其他操作系统（包括其他类 Unix 系统）有很多的优点，其中有⼀项就是，其上下⽂切换和模式切换的时间消耗⾮常少。</li>\n</ul>\n<h4 id=\"为什么线程通信的方法wait-notify-和notifyAll-被定义在Object类里？\"><a href=\"#为什么线程通信的方法wait-notify-和notifyAll-被定义在Object类里？\" class=\"headerlink\" title=\"为什么线程通信的方法wait(), notify()和notifyAll()被定义在Object类里？\"></a><strong>为什么线程通信的方法wait(), notify()和notifyAll()被定义在Object类里</strong>？</h4><ul>\n<li>Java的每个对象中都有一个锁(monitor，也可以成为监视器) 并且wait()，notify()等方法用于等待对象的锁或者通知其他线程对象的监视器可用。在Java的线程中并没有可供任何对象使用的锁和同步器。这就是为什么这些方法是Object类的一部分，这样Java的每一个类都有用于线程间通信的基本方法。</li>\n</ul>\n<h4 id=\"为什么wait-notify-和notifyAll-必须在同步方法或者同步块中被调用？\"><a href=\"#为什么wait-notify-和notifyAll-必须在同步方法或者同步块中被调用？\" class=\"headerlink\" title=\"为什么wait(), notify()和notifyAll()必须在同步方法或者同步块中被调用？\"></a><strong>为什么wait(), notify()和notifyAll()必须在同步方法或者同步块中被调用？</strong></h4><ul>\n<li>当一个线程需要调用对象的wait()方法的时候，这个线程必须拥有该对象的锁，接着它就会释放这个对象锁并进入等待状态直到其他线程调用这个对象上的notify()方法。同样的，当一个线程需要调用对象的notify()方法时，它会释放这个对象的锁，以便其他在等待的线程就可以得到这个对象锁。由于所有的这些方法都需要线程持有对象的锁，这样就只能通过同步来实现，所以他们只能在同步方法或者同步块中被调用。</li>\n</ul>\n<h4 id=\"为什么Thread类的sleep-和yield-方法是静态的？\"><a href=\"#为什么Thread类的sleep-和yield-方法是静态的？\" class=\"headerlink\" title=\"为什么Thread类的sleep()和yield()方法是静态的？\"></a><strong>为什么Thread类的sleep()和yield()方法是静态的？</strong></h4><ul>\n<li>Thread类的sleep()和yield()方法将在当前正在执行的线程上运行。所以在其他处于等待状态的线程上调用这些方法是没有意义的。这就是为什么这些方法是静态的。它们可以在当前正在执行的线程中工作，并避免程序员错误的认为可以在其他非运行线程调用这些方法。</li>\n</ul>\n<h4 id=\"interrupted和isInterrupted⽅法的区别\"><a href=\"#interrupted和isInterrupted⽅法的区别\" class=\"headerlink\" title=\"interrupted和isInterrupted⽅法的区别?\"></a>interrupted和isInterrupted⽅法的区别?</h4><ul>\n<li><p>interrupted() :会将中断状态清除，Java多线程的中断机制是⽤内部标识来实现的，调⽤Thread.interrupt()来中断⼀个线程就会设置中断标识为true。当中断线程调⽤静态⽅法Thread.interrupted()来检查中断状态时，中断状态会被清零。</p>\n</li>\n<li><p>isInterruptedd : 不会将中断状态清除，⾮静态⽅法isInterrupted()⽤来查询其它线程的中断状态且不会改变中断状态标识。</p>\n</li>\n<li><p>任何抛出InterruptedException异常的⽅法都会将中断状态清零。⽆论如何，⼀个线程的中断状态有有可能被其它线程调⽤中断来改变。</p>\n</li>\n</ul>\n<h3 id=\"synchronized关键字\"><a href=\"#synchronized关键字\" class=\"headerlink\" title=\"synchronized关键字\"></a>synchronized关键字</h3><blockquote>\n<p>synchronized关键字解决的是多个线程之间访问资源的同步性，synchronized关键字可以保证被它修饰的⽅法或者代码块在任意时刻只能有⼀个线程执⾏。</p>\n</blockquote>\n<ul>\n<li>synchronized作用于<strong>「方法」</strong>或者<strong>「代码块」</strong>，保证被修饰的代码在同一时间只能被一个线程访问。</li>\n<li>synchronized修饰代码块时，JVM采用<strong>「monitorenter、monitorexit」</strong>两个指令来实现同步</li>\n<li>synchronized修饰同步方法时，JVM采用<strong>「ACC_SYNCHRONIZED」</strong>标记符来实现同步</li>\n<li>monitorenter、monitorexit或者ACC_SYNCHRONIZED都是<strong>「基于Monitor实现」</strong>的</li>\n<li>实例对象里有对象头，对象头里面有Mark Word，Mark Word指针指向了<strong>「monitor」</strong></li>\n<li>Monitor其实是一种<strong>「同步工具」</strong>，也可以说是一种<strong>「同步机制」</strong>。</li>\n<li>在Java虚拟机（HotSpot）中，Monitor是由<strong>「ObjectMonitor实现」</strong>的。ObjectMonitor体现出Monitor的工作原理~</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"code\"><pre><span class=\"line\">ObjectMonitor() &#123;</span><br><span class=\"line\">    _header       = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    _count        = <span class=\"number\">0</span>; <span class=\"comment\">// 记录线程获取锁的次数</span></span><br><span class=\"line\">    _waiters      = <span class=\"number\">0</span>,</span><br><span class=\"line\">    _recursions   = <span class=\"number\">0</span>;  <span class=\"comment\">//锁的重入次数</span></span><br><span class=\"line\">    _object       = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    _owner        = <span class=\"literal\">NULL</span>;  <span class=\"comment\">// 指向持有ObjectMonitor对象的线程</span></span><br><span class=\"line\">    _WaitSet      = <span class=\"literal\">NULL</span>;  <span class=\"comment\">// 处于wait状态的线程，会被加入到_WaitSet</span></span><br><span class=\"line\">    _WaitSetLock  = <span class=\"number\">0</span> ;</span><br><span class=\"line\">    _Responsible  = <span class=\"literal\">NULL</span> ;</span><br><span class=\"line\">    _succ         = <span class=\"literal\">NULL</span> ;</span><br><span class=\"line\">    _cxq          = <span class=\"literal\">NULL</span> ;</span><br><span class=\"line\">    FreeNext      = <span class=\"literal\">NULL</span> ;</span><br><span class=\"line\">    _EntryList    = <span class=\"literal\">NULL</span> ;  <span class=\"comment\">// 处于等待锁block状态的线程，会被加入到该列表</span></span><br><span class=\"line\">    _SpinFreq     = <span class=\"number\">0</span> ;</span><br><span class=\"line\">    _SpinClock    = <span class=\"number\">0</span> ;</span><br><span class=\"line\">    OwnerIsThread = <span class=\"number\">0</span> ;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<ul>\n<li>synchronized 关键字加到 static 静态⽅法和 synchronized(class)代码块上都是是给 Class类上锁。</li>\n<li>synchronized 关键字加到实例⽅法上是给对象实例上锁。尽量不要使⽤synchronized(String a) 因为JVM中，字符串常量池具有缓存功能！</li>\n</ul>\n<h4 id=\"常用场景\"><a href=\"#常用场景\" class=\"headerlink\" title=\"常用场景\"></a>常用场景</h4><h5 id=\"同步一个代码块\"><a href=\"#同步一个代码块\" class=\"headerlink\" title=\"同步一个代码块\"></a><strong>同步一个代码块</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (<span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>它只作用于同一个对象，如果调用两个对象上的同步代码块，就不会进行同步。</p>\n<p>对于以下代码，使用 ExecutorService 执行了两个线程，由于调用的是同一个对象的同步代码块，因此这两个线程会进行同步，当一个线程进入同步语句块时，另一个线程就必须等待。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SynchronizedExample</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">func1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (<span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">                System.out.print(i + <span class=\"string\">\" \"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">    SynchronizedExample e1 = <span class=\"keyword\">new</span> SynchronizedExample();</span><br><span class=\"line\">    ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class=\"line\">    executorService.execute(() -&gt; e1.func1());</span><br><span class=\"line\">    executorService.execute(() -&gt; e1.func1());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">0</span> <span class=\"number\">1</span> <span class=\"number\">2</span> <span class=\"number\">3</span> <span class=\"number\">4</span> <span class=\"number\">5</span> <span class=\"number\">6</span> <span class=\"number\">7</span> <span class=\"number\">8</span> <span class=\"number\">9</span> <span class=\"number\">0</span> <span class=\"number\">1</span> <span class=\"number\">2</span> <span class=\"number\">3</span> <span class=\"number\">4</span> <span class=\"number\">5</span> <span class=\"number\">6</span> <span class=\"number\">7</span> <span class=\"number\">8</span> <span class=\"number\">9</span></span><br></pre></td></tr></table></figure>\n\n<p>对于以下代码，两个线程调用了不同对象的同步代码块，因此这两个线程就不需要同步。从输出结果可以看出，两个线程交叉执行。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">    SynchronizedExample e1 = <span class=\"keyword\">new</span> SynchronizedExample();</span><br><span class=\"line\">    SynchronizedExample e2 = <span class=\"keyword\">new</span> SynchronizedExample();</span><br><span class=\"line\">    ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class=\"line\">    executorService.execute(() -&gt; e1.func1());</span><br><span class=\"line\">    executorService.execute(() -&gt; e2.func1());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">1</span> <span class=\"number\">1</span> <span class=\"number\">2</span> <span class=\"number\">2</span> <span class=\"number\">3</span> <span class=\"number\">3</span> <span class=\"number\">4</span> <span class=\"number\">4</span> <span class=\"number\">5</span> <span class=\"number\">5</span> <span class=\"number\">6</span> <span class=\"number\">6</span> <span class=\"number\">7</span> <span class=\"number\">7</span> <span class=\"number\">8</span> <span class=\"number\">8</span> <span class=\"number\">9</span> <span class=\"number\">9</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"同步一个方法\"><a href=\"#同步一个方法\" class=\"headerlink\" title=\"同步一个方法\"></a><strong>同步一个方法</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">func</span> <span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>它和同步代码块一样，作用于同一个对象。</p>\n<h5 id=\"同步一个类\"><a href=\"#同步一个类\" class=\"headerlink\" title=\"同步一个类\"></a><strong>同步一个类</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (SynchronizedExample<span class=\"class\">.<span class=\"keyword\">class</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>作用于整个类，也就是说两个线程调用同一个类的不同对象上的这种同步语句，也会进行同步。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SynchronizedExample</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">func2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (SynchronizedExample<span class=\"class\">.<span class=\"keyword\">class</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">                System.out.print(i + <span class=\"string\">\" \"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">    SynchronizedExample e1 = <span class=\"keyword\">new</span> SynchronizedExample();</span><br><span class=\"line\">    SynchronizedExample e2 = <span class=\"keyword\">new</span> SynchronizedExample();</span><br><span class=\"line\">    ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class=\"line\">    executorService.execute(() -&gt; e1.func2());</span><br><span class=\"line\">    executorService.execute(() -&gt; e2.func2());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">0</span> <span class=\"number\">1</span> <span class=\"number\">2</span> <span class=\"number\">3</span> <span class=\"number\">4</span> <span class=\"number\">5</span> <span class=\"number\">6</span> <span class=\"number\">7</span> <span class=\"number\">8</span> <span class=\"number\">9</span> <span class=\"number\">0</span> <span class=\"number\">1</span> <span class=\"number\">2</span> <span class=\"number\">3</span> <span class=\"number\">4</span> <span class=\"number\">5</span> <span class=\"number\">6</span> <span class=\"number\">7</span> <span class=\"number\">8</span> <span class=\"number\">9</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"同步一个静态方法\"><a href=\"#同步一个静态方法\" class=\"headerlink\" title=\"同步一个静态方法\"></a><strong>同步一个静态方法</strong></h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">fun</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>作用于整个类。</p>\n<h5 id=\"synchronized-关键字和-volatile-关键字的区别\"><a href=\"#synchronized-关键字和-volatile-关键字的区别\" class=\"headerlink\" title=\"synchronized 关键字和 volatile 关键字的区别\"></a>synchronized 关键字和 volatile 关键字的区别</h5><ul>\n<li><p><strong>volatile</strong>关键字是线程同步的轻量级实现，所以<strong>volatile</strong>性能肯定⽐<strong>synchronized</strong>关键字要好。但是<strong>volatile</strong>关键字只能⽤于变量⽽<strong>synchronized</strong>关键字可以修饰⽅法以及代码块。synchronized关键字在JavaSE1.6之后进⾏了主要包括为了减少获得锁和释放锁带来的性能消耗⽽引⼊的偏向锁和轻量级锁以及其它各种优化之后执⾏效率有了显著提升，实际开发中使⽤<strong>synchronized</strong> 关键字的场景还是更多⼀些。</p>\n</li>\n<li><p>多线程访问<strong>volatile</strong>关键字不会发⽣阻塞，⽽<strong>synchronized</strong>关键字可能会发⽣阻塞。</p>\n</li>\n<li><p><strong>volatile</strong>关键字能保证数据的可⻅性，但不能保证数据的原⼦性。<strong>synchronized</strong>关键字两者都能保证。</p>\n</li>\n<li><p><strong>volatile</strong>关键字主要⽤于解决变量在多个线程之间的可⻅性，⽽ <strong>synchronized</strong>关键字解决的是多个线程之间访问资源的同步性。</p>\n</li>\n</ul>\n<h3 id=\"ThreadLocal\"><a href=\"#ThreadLocal\" class=\"headerlink\" title=\"ThreadLocal\"></a><strong>ThreadLocal</strong></h3><blockquote>\n<p>主要解决每个线程绑定自己的值，存储每个线程的私有变量。</p>\n</blockquote>\n<ul>\n<li>ThreadLocal用于创建线程的本地变量，我们知道一个对象的所有线程会共享它的全局变量，所以这些变量不是线程安全的，我们可以使用同步技术。但是当我们不想使用同步的时候，我们可以选择ThreadLocal变量。</li>\n<li>每个线程都会拥有他们自己的Thread变量，它们可以使用get()set()方法去获取他们的默认值或者在线程内部改变他们的值。ThreadLocal实例通常是希望它们同线程状态关联起来是private static属性。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>方法声明</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>ThreadLocal()</td>\n<td>创建ThreadLocal对象</td>\n</tr>\n<tr>\n<td>public void set(T value)</td>\n<td>设置当前线程绑定的局部变量</td>\n</tr>\n<tr>\n<td>public T get()</td>\n<td>获取当前线程绑定的局部变量</td>\n</tr>\n<tr>\n<td>public void remove()</td>\n<td>移除当前线程绑定的局部变量</td>\n</tr>\n</tbody></table>\n<h4 id=\"ThreadLocal为什么会内存泄漏\"><a href=\"#ThreadLocal为什么会内存泄漏\" class=\"headerlink\" title=\"ThreadLocal为什么会内存泄漏\"></a>ThreadLocal为什么会内存泄漏</h4><blockquote>\n<p>ThreadLocal为每一线程创建一块小的堆工作空间</p>\n</blockquote>\n<ul>\n<li>ThreadLocal中含有一个叫做ThreadLocalMap的内部类，该类为一个采用线性探测法实现的HashMap。它的key为ThreadLocal对象而且还使用了WeakReference，ThreadLocalMap正是用来存储变量副本的。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * ThreadLocalMap is a customized hash map suitable only for</span></span><br><span class=\"line\"><span class=\"comment\">   * maintaining thread local values. No operations are exported</span></span><br><span class=\"line\"><span class=\"comment\">   * outside of the ThreadLocal class. The class is package private to</span></span><br><span class=\"line\"><span class=\"comment\">   * allow declaration of fields in class Thread.  To help deal with</span></span><br><span class=\"line\"><span class=\"comment\">   * very large and long-lived usages, the hash table entries use</span></span><br><span class=\"line\"><span class=\"comment\">   * WeakReferences for keys. However, since reference queues are not</span></span><br><span class=\"line\"><span class=\"comment\">   * used, stale entries are guaranteed to be removed only when</span></span><br><span class=\"line\"><span class=\"comment\">   * the table starts running out of space.</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadLocalMap</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">       * The entries in this hash map extend WeakReference, using</span></span><br><span class=\"line\"><span class=\"comment\">       * its main ref field as the key (which is always a</span></span><br><span class=\"line\"><span class=\"comment\">       * ThreadLocal object).  Note that null keys (i.e. entry.get()</span></span><br><span class=\"line\"><span class=\"comment\">       * == null) mean that the key is no longer referenced, so the</span></span><br><span class=\"line\"><span class=\"comment\">       * entry can be expunged from table.  Such entries are referred to</span></span><br><span class=\"line\"><span class=\"comment\">       * as \"stale entries\" in the code that follows.</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">      <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Entry</span> <span class=\"keyword\">extends</span> <span class=\"title\">WeakReference</span>&lt;<span class=\"title\">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;</span><br><span class=\"line\">          <span class=\"comment\">/** The value associated with this ThreadLocal. */</span></span><br><span class=\"line\">          Object value;</span><br><span class=\"line\"></span><br><span class=\"line\">          Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">super</span>(k);</span><br><span class=\"line\">              value = v;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      ....</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>如果ThreadLocal被设置为null后，而且没有任何强引用指向它，根据垃圾回收的可达性分析算法，ThreadLocal将会被回收。但是对应的value不会被回收掉直到线程结束才会被回收。如果当前线程一直处于运行中，那么这些Entry对象中的value就可能一直无法回收，就会发生内存泄露。<strong>为了安全地使用ThreadLocal，必须要像每次使用完锁就解锁一样，在每次使用完ThreadLocal后都要调用remove()来清理无用的Entry。</strong></li>\n</ul>\n<h4 id=\"ThreadLocal与Synchronized\"><a href=\"#ThreadLocal与Synchronized\" class=\"headerlink\" title=\"ThreadLocal与Synchronized\"></a>ThreadLocal与Synchronized</h4><blockquote>\n<p>ThreadLocal模式与Synchronized关键字都用于处理多线程并发访问变量的问题，处理问题的角度和思路不同。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>原理</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>ThreadLocal</td>\n<td>空间换时间，为每一份线程提供一份变量副本，完成线程私有变量访问，多线程之间数据互相隔离。</td>\n</tr>\n<tr>\n<td>Synchronized</td>\n<td>时间换空间，只提供一份变量副本，让线程排队访问。多线程之间访问数据同步。</td>\n</tr>\n</tbody></table>\n<h3 id=\"volatile关键字\"><a href=\"#volatile关键字\" class=\"headerlink\" title=\"volatile关键字\"></a>volatile关键字</h3><blockquote>\n<p><strong>volatile</strong> 关键字的主要作⽤就是保证变量的可⻅性然后还有⼀个作⽤是防⽌指令重排序。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/volatile%E5%86%85%E5%AD%98.png\"></p>\n<h4 id=\"特性\"><a href=\"#特性\" class=\"headerlink\" title=\"特性\"></a>特性</h4><ul>\n<li><p>原⼦性 : ⼀个的操作或者多次操作，要么所有的操作全部都得到执⾏并且不会收到任何因素的⼲扰⽽中断，要么所有的操作都执⾏，要么都不执⾏。 synchronized 可以保证代码⽚段的原⼦性。</p>\n</li>\n<li><p>可⻅性 ：当⼀个变量对共享变量进⾏了修改，那么另外的线程都是⽴即可以看到修改后的最新值。 volatile 关键字可以保证共享变量的可⻅性。</p>\n</li>\n<li><p>有序性 ：代码在执⾏的过程中的先后顺序，Java 在编译器以及运⾏期间的优化，代码的执⾏顺序未必就是编写代码时候的顺序。 volatile 关键字可以禁⽌指令进⾏重排序优化。</p>\n</li>\n<li><p>内存屏蔽：加入volatile会多出一个lock前缀指令，lock前缀指令相当于一个内存屏障（也称内存栅栏）。</p>\n</li>\n<li><p>禁止重排序：volatile 禁止了指令重排。</p>\n</li>\n</ul>\n<h4 id=\"使用场景\"><a href=\"#使用场景\" class=\"headerlink\" title=\"使用场景\"></a>使用场景</h4><ul>\n<li><p>读写锁</p>\n<ul>\n<li>如果需要实现一个读写锁，每次只能一个线程去写数据，但是有多个线程来读数据，就synchronize同步锁来对set方法加锁，get方法不加锁， 使用volatile来修饰变量，保证内存可见性，不然多个线程可能会在变量修改后还读到一个旧值。</li>\n</ul>\n</li>\n<li><p>状态位</p>\n<ul>\n<li><p>用于做状态位标志，如果多个线程去需要根据一个状态位来执行一些操作，使用volatile修饰可以保证内存可见性。</p>\n<p>用于单例模式用于保证内存可见性，以及防止指令重排序。 </p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"线程池\"><a href=\"#线程池\" class=\"headerlink\" title=\"线程池\"></a>线程池</h3><blockquote>\n<p>为避免线程频繁创建和销毁带来的性能问题，而池化的一种方案。</p>\n</blockquote>\n<ul>\n<li><p>利用线程池管理并复用线程、控制最大并发数等。</p>\n</li>\n<li><p>实现任务线程队列缓存策略和拒绝机制。</p>\n</li>\n<li><p>实现某些与时间相关的功能，如定时执行、周期执行等。</p>\n</li>\n<li><p>隔离线程环境。比如，交易服务和搜索服务在同一台服务器上，分别开启两个线程池，交易线程的资源消耗明显要大；因此，通过配置独立的线程池将较慢的交易服务与搜索服务隔离开，避免各服务线程相互影响。</p>\n</li>\n</ul>\n<blockquote>\n<p>这里直接参考阿里巴巴的手册。线程池不允许使用 Executors 去创建，而是通过 ThreadPoolExecutor 的方式，这样的处理方式让写的读者更加明确线程池的运行规则，规避资源耗尽的风险。</p>\n</blockquote>\n<h4 id=\"ExecutorService\"><a href=\"#ExecutorService\" class=\"headerlink\" title=\"ExecutorService\"></a>ExecutorService</h4><blockquote>\n<p> 阿里开发手册建议使用ThreadPoolExecutor 这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。</p>\n</blockquote>\n<ul>\n<li>Executors.newSingleThreadPool()</li>\n<li>newFixedThreadPool()</li>\n<li>newcachedTheadPool()</li>\n<li>newScheduledThreadPool()</li>\n</ul>\n<h5 id=\"Executors返回的线程池对象的弊端\"><a href=\"#Executors返回的线程池对象的弊端\" class=\"headerlink\" title=\"Executors返回的线程池对象的弊端\"></a>Executors返回的线程池对象的弊端</h5><blockquote>\n<p>查看 Executors 的源码会发现，Executors.newFixedThreadPool()、Executors.newSingleThreadExecutor() 和 Executors.newCachedThreadPool() 等方法的底层都是通过 ThreadPoolExecutor 实现的。</p>\n</blockquote>\n<ul>\n<li>FixedThreadPool 和 SingleThreadPool：允许的请求队列长度为 Integer.MAX_VALUE，可能会堆积大量的请求，从而导致 OOM。</li>\n<li>CachedThreadPool 和 ScheduledThreadPool：允许的创建线程数量为 Integer.MAX_VALUE，可能会创建大量的线程，从而导致 OOM。</li>\n</ul>\n<h4 id=\"ThreadPoolExecutor的核心参数\"><a href=\"#ThreadPoolExecutor的核心参数\" class=\"headerlink\" title=\"ThreadPoolExecutor的核心参数\"></a>ThreadPoolExecutor的核心参数</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ThreadPoolExecutor</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          <span class=\"keyword\">int</span> maximumPoolSize,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          <span class=\"keyword\">long</span> keepAliveTime,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          TimeUnit unit,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          ThreadFactory threadFactory,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (corePoolSize &lt; <span class=\"number\">0</span> ||</span><br><span class=\"line\">        maximumPoolSize &lt;= <span class=\"number\">0</span> ||</span><br><span class=\"line\">        maximumPoolSize &lt; corePoolSize ||</span><br><span class=\"line\">        keepAliveTime &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (workQueue == <span class=\"keyword\">null</span> || threadFactory == <span class=\"keyword\">null</span> || handler == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.acc = System.getSecurityManager() == <span class=\"keyword\">null</span> ?</span><br><span class=\"line\">            <span class=\"keyword\">null</span> :</span><br><span class=\"line\">            AccessController.getContext();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.corePoolSize = corePoolSize;  <span class=\"comment\">// 常驻核心线程数</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.maximumPoolSize = maximumPoolSize; <span class=\"comment\">// maximumPoolSize 必须大于 0，且必须大于 corePoolSize</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.workQueue = workQueue;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.keepAliveTime = unit.toNanos(keepAliveTime); <span class=\"comment\">// 线程的存活时间</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.threadFactory = threadFactory; <span class=\"comment\">// 线程的创建工厂</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.handler = handler; <span class=\"comment\">// 线程的创建工厂</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>第 1 个参数：corePoolSize 表示线程池的常驻核心线程数。如果设置为 0，则表示在没有任何任务时，销毁线程池；如果大于 0，即使没有任务时也会保证线程池的线程数量等于此值。但需要注意，此值如果设置的比较小，则会频繁的创建和销毁线程（创建和销毁的原因会在本课时的下半部分讲到）；如果设置的比较大，则会浪费系统资源，所以开发者需要根据自己的实际业务来调整此值。</li>\n<li>第 2 个参数：maximumPoolSize 表示线程池在任务最多时，最大可以创建的线程数。官方规定此值必须大于 0，也必须大于等于 corePoolSize，此值只有在任务比较多，且不能存放在任务队列时，才会用到。</li>\n<li>第 3 个参数：keepAliveTime 表示线程的存活时间，当线程池空闲时并且超过了此时间，多余的线程就会销毁，直到线程池中的线程数量销毁的等于 corePoolSize 为止，如果 maximumPoolSize 等于 corePoolSize，那么线程池在空闲的时候也不会销毁任何线程。</li>\n<li>第 4 个参数：unit 表示存活时间的单位，它是配合 keepAliveTime 参数共同使用的。</li>\n<li>第 5 个参数：workQueue 表示线程池执行的任务队列，当线程池的所有线程都在处理任务时，如果来了新任务就会缓存到此任务队列中排队等待执行。</li>\n<li>第 6 个参数：threadFactory 表示线程的创建工厂，此参数一般用的比较少，我们通常在创建线程池时不指定此参数，它会使用默认的线程创建工厂的方法来创建线程。</li>\n<li>第 7 个参数：RejectedExecutionHandler 表示指定c，当线程池的任务已经在缓存队列 workQueue 中存储满了之后，并且不能创建新的线程来执行此任务时，就会用到此拒绝策略，它属于一种限流保护的机制。</li>\n<li>原理<ul>\n<li>如果当前池⼤⼩ poolSize &lt; corePoolSize，则创建新线程执⾏任务。</li>\n<li>如果当前池⼤⼩ poolSize &gt; corePoolSize，且等待队列未满，则进⼊等待队列。</li>\n<li>如果当前池⼤⼩ poolSize &gt; corePoolSize 且⼩于 maximumPoolSize ，且等待队列已满，则创建新线程执⾏任务。</li>\n<li>如果当前池⼤⼩ poolSize &gt; corePoolSize 且⼤于 maximumPoolSize ，且等待队列已满，则调⽤拒绝策略来处理该任务。<ul>\n<li>线程池⾥的每个线程执⾏完任务后不会⽴刻退出，⽽是会去检查下等待队列⾥是否还有线程任务需要执⾏，如果在 keepAliveTime ⾥等不到新的任务了，那么线程就会退出。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong><code>ThreadPoolExecutor</code> 3 个最重要的参数：</strong><ul>\n<li><strong><code>corePoolSize</code> :</strong> 核心线程数线程数定义了最小可以同时运行的线程数量。</li>\n<li><strong><code>maximumPoolSize</code> :</strong> 当队列中存放的任务达到队列容量的时候，当前可以同时运行的线程数量变为最大线程数。</li>\n<li><strong><code>workQueue</code>:</strong> 当新任务来的时候会先判断当前运行的线程数量是否达到核心线程数，如果达到的话，新任务就会被存放在队列中。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"线程池任务执行的主要流程\"><a href=\"#线程池任务执行的主要流程\" class=\"headerlink\" title=\"线程池任务执行的主要流程\"></a>线程池任务执行的主要流程</h4><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%BB%E8%A6%81%E6%B5%81%E7%A8%8B.png\"></p>\n<h4 id=\"execute-VS-submit\"><a href=\"#execute-VS-submit\" class=\"headerlink\" title=\"execute() VS submit()\"></a>execute() VS submit()</h4><blockquote>\n<p>execute() 和 submit() 都是用来执行线程池任务的，它们最主要的区别是，submit() 方法可以接收线程池执行的返回值，而 execute() 不能接收返回值。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">ThreadPoolExecutor executor = <span class=\"keyword\">new</span> ThreadPoolExecutor(<span class=\"number\">2</span>, <span class=\"number\">10</span>, <span class=\"number\">10L</span>,</span><br><span class=\"line\">        TimeUnit.SECONDS, <span class=\"keyword\">new</span> LinkedBlockingQueue(<span class=\"number\">20</span>));</span><br><span class=\"line\"><span class=\"comment\">// execute 使用</span></span><br><span class=\"line\">executor.execute(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Hello, execute.\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// submit 使用</span></span><br><span class=\"line\">Future&lt;String&gt; future = executor.submit(<span class=\"keyword\">new</span> Callable&lt;String&gt;() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Hello, submit.\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Success\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">System.out.println(future.get());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 执行结果</span></span><br><span class=\"line\"><span class=\"comment\">//Hello, submit.</span></span><br><span class=\"line\"><span class=\"comment\">//Hello, execute.</span></span><br><span class=\"line\"><span class=\"comment\">//Success</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"线程池的拒绝策略\"><a href=\"#线程池的拒绝策略\" class=\"headerlink\" title=\"线程池的拒绝策略\"></a>线程池的拒绝策略</h4><blockquote>\n<p>当线程池中的任务队列已经被存满，再有任务添加时会先判断当前线程池中的线程数是否大于等于线程池的最大值，如果是，则会触发线程池的拒绝策略。</p>\n</blockquote>\n<ul>\n<li><p>Java 自带的拒绝策略有 4 种：</p>\n<ul>\n<li>AbortPolicy，终止策略，线程池会抛出异常并终止执行，它是默认的拒绝策略。</li>\n<li>CallerRunsPolicy，把任务交给当前线程来执行。</li>\n<li>DiscardPolicy，忽略此任务（最新的任务）。</li>\n<li>DiscardOldestPolicy，忽略最早的任务（最先加入队列的任务）。</li>\n</ul>\n</li>\n<li><p>演示AbortPolicy</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">ThreadPoolExecutor executor = <span class=\"keyword\">new</span> ThreadPoolExecutor(<span class=\"number\">1</span>, <span class=\"number\">3</span>, <span class=\"number\">10</span>,</span><br><span class=\"line\">        TimeUnit.SECONDS, <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;&gt;(<span class=\"number\">2</span>),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> ThreadPoolExecutor.AbortPolicy()); <span class=\"comment\">// 添加 AbortPolicy 拒绝策略</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">6</span>; i++) &#123;</span><br><span class=\"line\">    executor.execute(() -&gt; &#123;</span><br><span class=\"line\">        System.out.println(Thread.currentThread().getName());</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>结果</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">pool-1-thread-1</span><br><span class=\"line\">pool-1-thread-1</span><br><span class=\"line\">pool-1-thread-1</span><br><span class=\"line\">pool-1-thread-3</span><br><span class=\"line\">pool-1-thread-2</span><br><span class=\"line\">Exception in thread &quot;main&quot; java.util.concurrent.RejectedExecutionException: Task com.lagou.interview.ThreadPoolExample$$Lambda$1&#x2F;1096979270@448139f0 rejected from java.util.concurrent.ThreadPoolExecutor@7cca494b[Running, pool size &#x3D; 3, active threads &#x3D; 3, queued tasks &#x3D; 2, completed tasks &#x3D; 0]</span><br><span class=\"line\"> at java.util.concurrent.ThreadPoolExecutor$AbortPolicy.rejectedExecution(ThreadPoolExecutor.java:2063)</span><br><span class=\"line\"> at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:830)</span><br><span class=\"line\"> at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1379)</span><br><span class=\"line\"> at com.lagou.interview.ThreadPoolExample.rejected(ThreadPoolExample.java:35)</span><br><span class=\"line\"> at com.lagou.interview.ThreadPoolExample.main(ThreadPoolExample.java:26)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>第 6 个任务来的时候，线程池则执行了 AbortPolicy  拒绝策略，抛出了异常。因为队列最多存储 2 个任务，最大可以创建 3 个线程来执行任务（2+3=5），所以当第 6 个任务来的时候，此线程池就“忙”不过来了。</li>\n</ul>\n<h4 id=\"workQueue\"><a href=\"#workQueue\" class=\"headerlink\" title=\"workQueue\"></a>workQueue</h4><h5 id=\"BlockingQueue\"><a href=\"#BlockingQueue\" class=\"headerlink\" title=\"BlockingQueue\"></a>BlockingQueue</h5><h5 id=\"ArrayBlockingQueue\"><a href=\"#ArrayBlockingQueue\" class=\"headerlink\" title=\"ArrayBlockingQueue\"></a>ArrayBlockingQueue</h5><blockquote>\n<p>⼀个由数组结构组成的有界阻塞队列。</p>\n</blockquote>\n<ul>\n<li>用数组实现的有界阻塞队列。此队列按照先进先出（FIFO）的原则对元素进行排序。默认情况下不保证访问者公平的访问队列，所谓公平访问队列是指阻塞的所有生产者线程或消费者线程，当队列可用时，可以按照阻塞的先后顺序访问队列，即先阻塞的生产者线程，可以先往队列里插入元素，先阻塞的消费者线程，可以先从队列里获取元素。通常情况下为了保证公平性会降低吞吐量。</li>\n</ul>\n<h5 id=\"LinkedBlockingQueue\"><a href=\"#LinkedBlockingQueue\" class=\"headerlink\" title=\"LinkedBlockingQueue\"></a>LinkedBlockingQueue</h5><blockquote>\n<p>⼀个由链表结构组成的有界阻塞队列。</p>\n</blockquote>\n<ul>\n<li>基于链表的阻塞队列，同 ArrayListBlockingQueue 类似，此队列按照先进先出（FIFO）的原则对元素进行排序。而 LinkedBlockingQueue 之所以能够高效的处理并发数据，还因为其对于生产者端和消费者端分别采用了独立的锁来控制数据同步，这也意味着在高并发的情况下生产者和消费者可以并行地操作队列中的数据，以此来提高整个队列的并发性能。LinkedBlockingQueue 会默认一个类似无限大小的容量（Integer.MAX_VALUE）。</li>\n</ul>\n<h5 id=\"PriorityBlockingQueue\"><a href=\"#PriorityBlockingQueue\" class=\"headerlink\" title=\"PriorityBlockingQueue\"></a>PriorityBlockingQueue</h5><blockquote>\n<p>⼀个⽀持优先级排序的⽆界阻塞队列。</p>\n</blockquote>\n<ul>\n<li>是一个支持优先级的无界队列。默认情况下元素采取自然顺序升序排列。可以自定义实现compareTo()方法来指定元素进行排序规则，或者初始化 PriorityBlockingQueue 时，指定构造参数 Comparator 来对元素进行排序。需要注意的是不能保证同优先级元素的顺序。</li>\n</ul>\n<h5 id=\"DelayQueue\"><a href=\"#DelayQueue\" class=\"headerlink\" title=\"DelayQueue\"></a>DelayQueue</h5><blockquote>\n<p>⼀个使⽤优先级队列实现的⽆界阻塞队列。</p>\n</blockquote>\n<ul>\n<li>是一个支持延时获取元素的无界阻塞队列。队列使用 PriorityQueue 来实现。队列中的元素必须实现 Delayed 接口，在创建元素时可以指定多久才能从队列中获取当前元素。只有在延迟期满时才能从队列中提取元素。</li>\n</ul>\n<h5 id=\"SynchronousQueue\"><a href=\"#SynchronousQueue\" class=\"headerlink\" title=\"SynchronousQueue\"></a>SynchronousQueue</h5><blockquote>\n<p>⼀个不存储元素的阻塞队列。</p>\n</blockquote>\n<ul>\n<li>是一个不存储元素的阻塞队列。每一个 put 操作必须等待一个 take 操作，否则不能继续添加元素。SynchronousQueue 可以看成是一个传球手，负责把生产者线程处理的数据直接传递给消费者线程。队列本身并不存储任何元素，非常适合于传递性场景,比如在一个线程中使用的数据，传递给另外一个线程使用， SynchronousQueue 的吞吐量高于LinkedBlockingQueue 和ArrayBlockingQueue。</li>\n</ul>\n<h5 id=\"LinkedTransferQueue\"><a href=\"#LinkedTransferQueue\" class=\"headerlink\" title=\"LinkedTransferQueue\"></a>LinkedTransferQueue</h5><blockquote>\n<p>⼀个由链表结构组成的⽆界阻塞队列。</p>\n</blockquote>\n<ul>\n<li>是一个由链表结构组成的无界阻塞 TransferQueue 队列。相对于其他阻塞队列，LinkedTransferQueue 多了 tryTransfer 和 transfer 方法。<ul>\n<li>transfer 方法：如果当前有消费者正在等待接收元素（消费者使用 take()方法或带时间限制的poll()方法时），transfer 方法可以把生产者传入的元素立刻 transfer（传输）给消费者。如果没有消费者在等待接收元素，transfer 方法会将元素存放在队列的 tail 节点，并等到该元素被消费者消费了才返回。</li>\n<li>tryTransfer 方法。则是用来试探下生产者传入的元素是否能直接传给消费者。如果没有消费者等待接收元素，则返回 false。和 transfer 方法的区别是 tryTransfer 方法无论消费者是否接收，方法立即返回。而 transfer 方法是必须等到消费者消费了才返回。</li>\n</ul>\n</li>\n<li>对于带有时间限制的 tryTransfer(E e, long timeout, TimeUnit unit)方法，则是试图把生产者传入的元素直接传给消费者，但是如果没有消费者消费该元素则等待指定的时间再返回，如果超时还没消费元素，则返回 false，如果在超时时间内消费了元素，则返回 true。</li>\n</ul>\n<h5 id=\"LinkedBlockingDeque\"><a href=\"#LinkedBlockingDeque\" class=\"headerlink\" title=\"LinkedBlockingDeque\"></a>LinkedBlockingDeque</h5><blockquote>\n<p>⼀个由链表结构组成的双向阻塞队列。</p>\n</blockquote>\n<ul>\n<li>是一个由链表结构组成的双向阻塞队列。所谓双向队列指的你可以从队列的两端插入和移出元素。双端队列因为多了一个操作队列的入口，在多线程同时入队时，也就减少了一半的竞争。</li>\n</ul>\n<h5 id=\"BlockingDeque\"><a href=\"#BlockingDeque\" class=\"headerlink\" title=\"BlockingDeque\"></a>BlockingDeque</h5><h5 id=\"LinkedBlockingDeque-1\"><a href=\"#LinkedBlockingDeque-1\" class=\"headerlink\" title=\"LinkedBlockingDeque\"></a>LinkedBlockingDeque</h5><h5 id=\"TransferQueue\"><a href=\"#TransferQueue\" class=\"headerlink\" title=\"TransferQueue\"></a>TransferQueue</h5><h4 id=\"如果你提交任务时，线程池队列已满。会时发会⽣什么？\"><a href=\"#如果你提交任务时，线程池队列已满。会时发会⽣什么？\" class=\"headerlink\" title=\"如果你提交任务时，线程池队列已满。会时发会⽣什么？\"></a>如果你提交任务时，线程池队列已满。会时发会⽣什么？</h4><ul>\n<li>⼀个任务不能被调度执⾏那么ThreadPoolExecutor.submit()⽅法将会抛出⼀个RejectedExecutionException异常。</li>\n</ul>\n<h4 id=\"shutdown-与shutdownNow\"><a href=\"#shutdown-与shutdownNow\" class=\"headerlink\" title=\"shutdown()与shutdownNow()\"></a><code>shutdown()</code>与<code>shutdownNow()</code></h4><ul>\n<li><strong><code>shutdown（）</code></strong> :关闭线程池，线程池的状态变为 <code>SHUTDOWN</code>。线程池不再接受新任务了，但是队列里的任务得执行完毕。</li>\n<li><strong><code>shutdownNow（）</code></strong> :关闭线程池，线程的状态变为 <code>STOP</code>。线程池会终止当前正在运行的任务，并停止处理排队的任务并返回正在等待执行的 List。</li>\n</ul>\n<h4 id=\"isTerminated-与-isShutdown\"><a href=\"#isTerminated-与-isShutdown\" class=\"headerlink\" title=\"isTerminated() 与 isShutdown()\"></a><code>isTerminated()</code> 与 <code>isShutdown()</code></h4><ul>\n<li><strong><code>isShutDown</code></strong> 当调用 <code>shutdown()</code> 方法后返回为 true。</li>\n<li><strong><code>isTerminated</code></strong> 当调用 <code>shutdown()</code> 方法后，并且所有提交的任务完成后返回为 true</li>\n</ul>\n<h4 id=\"如何合理的配置java线程池？\"><a href=\"#如何合理的配置java线程池？\" class=\"headerlink\" title=\"如何合理的配置java线程池？\"></a>如何合理的配置<strong>java</strong>线程池？</h4><blockquote>\n<p><strong>线程等待时间所占比例越高，需要越多线程；线程CPU时间所占比例越高，需要越少线程。</strong></p>\n</blockquote>\n<ul>\n<li><p>如CPU密集型的任务，基本线程池应该配置多⼤？IO密集型的任务，基本线程池应该配置多⼤？⽤有界队列好还是⽆界队列好？任务⾮常多的时候，使⽤什么阻塞队列能获取最好的吞吐量？</p>\n<ul>\n<li>配置线程池时CPU密集型任务可以少配置线程数，⼤概和机器的cpu核数相当，可以使得每个线程都在执⾏任务。</li>\n<li>IO密集型时，⼤部分线程都阻塞，故需要多配置线程数，2*cpu核数</li>\n<li>有界队列和⽆界队列的配置需区分业务场景，⼀般情况下配置有界队列，在⼀些可能会有爆发性增⻓的情况下使⽤⽆界队列。</li>\n<li>任务⾮常多时，使⽤⾮阻塞队列使⽤CAS操作替代锁可以获得好的吞吐量。</li>\n<li>有一个简单并且适用面比较广的公式：<ul>\n<li><strong>CPU 密集型任务(N+1)：</strong> 这种任务消耗的主要是 CPU 资源，可以将线程数设置为 N（CPU 核心数）+1，比 CPU 核心数多出来的一个线程是为了防止线程偶发的缺页中断，或者其它原因导致的任务暂停而带来的影响。一旦任务暂停，CPU 就会处于空闲状态，而在这种情况下多出来的一个线程就可以充分利用 CPU 的空闲时间。</li>\n<li><strong>I/O 密集型任务(2N)：</strong> 这种任务应用起来，系统会用大部分的时间来处理 I/O 交互，而线程在处理 I/O 的时间段内不会占用 CPU 来处理，这时就可以将 CPU 交出给其它线程使用。因此在 I/O 密集型任务的应用中，我们可以多配置一些线程，具体的计算方法是 2N。</li>\n</ul>\n</li>\n<li><strong>如何判断是 CPU 密集任务还是 IO 密集任务？</strong><ul>\n<li>CPU 密集型简单理解就是利用 CPU 计算能力的任务比如你在内存中对大量数据进行排序。单凡涉及到网络读取，文件读取这类都是 IO 密集型，这类任务的特点是 CPU 计算耗费时间相比于等待 IO 操作完成的时间来说很少，大部分时间都花在了等待 IO 操作完成上。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"计算公式\"><a href=\"#计算公式\" class=\"headerlink\" title=\"计算公式\"></a>计算公式</h5><ul>\n<li><p>CPU密集任务</p>\n<ul>\n<li>理论上 <code>线程数量 = CPU 核数（逻辑）</code> 就可以了，但是实际上，数量一般会设置为 <code>CPU 核数（逻辑）+ 1</code></li>\n</ul>\n</li>\n<li><p>IO密集任务</p>\n<ul>\n<li>最佳线程数 =  <code>(1/CPU利用率)</code> = <code>1 + (I/O耗时/CPU耗时)</code></li>\n<li>最佳线程数 = <code>CPU核心数</code> *  <code>(1/CPU利用率)</code> =  <code>CPU核心数</code> * <code>(1 + (I/O耗时/CPU耗时))</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Lock\"><a href=\"#Lock\" class=\"headerlink\" title=\"Lock\"></a>Lock</h3><blockquote>\n<p>Lock对象也可以实现同步，在使用上更加方便。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211018144234.png\"></p>\n<blockquote>\n<p>Java多线程中，可以使用synchronized关键字来实现线程之间同步互斥，但是再jdk1.5以后增加了ReentrantLock类。并且功能更加强大、灵活。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th align=\"left\">锁名称</th>\n<th align=\"left\">应用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">乐观锁</td>\n<td align=\"left\">CAS</td>\n</tr>\n<tr>\n<td align=\"left\">自旋锁</td>\n<td align=\"left\">CAS</td>\n</tr>\n<tr>\n<td align=\"left\">悲观锁</td>\n<td align=\"left\">synchronized、vector、hashtable</td>\n</tr>\n<tr>\n<td align=\"left\">可重入锁</td>\n<td align=\"left\">synchronized、Reentrantlock、Lock</td>\n</tr>\n<tr>\n<td align=\"left\">读写锁</td>\n<td align=\"left\">ReentrantReadWriteLock，CopyOnWriteArrayList、CopyOnWriteArraySet</td>\n</tr>\n<tr>\n<td align=\"left\">公平锁</td>\n<td align=\"left\">Reentrantlock(true)</td>\n</tr>\n<tr>\n<td align=\"left\">非公平锁</td>\n<td align=\"left\">synchronized、reentrantlock(false)</td>\n</tr>\n<tr>\n<td align=\"left\">共享锁</td>\n<td align=\"left\">ReentrantReadWriteLock中读锁</td>\n</tr>\n<tr>\n<td align=\"left\">独占锁</td>\n<td align=\"left\">synchronized、vector、hashtable、ReentrantReadWriteLock中写锁</td>\n</tr>\n<tr>\n<td align=\"left\">重量级锁</td>\n<td align=\"left\">synchronized</td>\n</tr>\n<tr>\n<td align=\"left\">互斥锁</td>\n<td align=\"left\">synchronized</td>\n</tr>\n<tr>\n<td align=\"left\">同步锁</td>\n<td align=\"left\">synchronized</td>\n</tr>\n<tr>\n<td align=\"left\">分段锁</td>\n<td align=\"left\">concurrentHashMap</td>\n</tr>\n<tr>\n<td align=\"left\">死锁</td>\n<td align=\"left\">相互请求对方的资源</td>\n</tr>\n<tr>\n<td align=\"left\">锁粗化</td>\n<td align=\"left\">锁优化技术</td>\n</tr>\n<tr>\n<td align=\"left\">锁消除</td>\n<td align=\"left\">锁优化技术</td>\n</tr>\n<tr>\n<td align=\"left\">轻量级锁</td>\n<td align=\"left\">锁优化技术</td>\n</tr>\n<tr>\n<td align=\"left\">偏向锁</td>\n<td align=\"left\">锁优化技术</td>\n</tr>\n</tbody></table>\n<h4 id=\"AQS-AbstractQueuedSynchronizer\"><a href=\"#AQS-AbstractQueuedSynchronizer\" class=\"headerlink\" title=\"AQS-AbstractQueuedSynchronizer\"></a>AQS-AbstractQueuedSynchronizer</h4><blockquote>\n<p>AQS：AbstractQueuedSynchronizer 抽象队列同步器</p>\n<p>内部实现了一个FIFO列队来管理锁，线程会首先尝试获取锁，如果失败。则将当前线程以及等待信息包装成一个node节点放入同步列队中柱塞，当有锁的线程释放锁的时候，则会唤醒列队中的等待的线程。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211005223255.png\"></p>\n<ul>\n<li><p>AQS 这里只定义了一个接口，具体资源的获取交由自定义同步器去实现了（通过 state 的 get/set/CAS)之所以没有定义成abstract ，是因为独占模式下只用实现 tryAcquire-tryRelease ，而共享模式下只用实现tryAcquireShared-tryReleaseShared。如果都定义成abstract，那么每个模式也要去实现另一模式下的接口。不同的自定义同步器争用共享资源的方式也不同。自定义同步器在实现时只需要实现共享资源 state 的获取与释放方式即可，至于具体线程等待队列的维护（如获取资源失败入队/唤醒出队等）。</p>\n</li>\n<li><p>AQS定义类一个</p>\n</li>\n</ul>\n<h5 id=\"LockSupport\"><a href=\"#LockSupport\" class=\"headerlink\" title=\"LockSupport\"></a>LockSupport</h5><blockquote>\n<p>是用来创建锁和其他同步类的基本线程阻塞原语。</p>\n</blockquote>\n<h5 id=\"CountDownLatch\"><a href=\"#CountDownLatch\" class=\"headerlink\" title=\"CountDownLatch\"></a>CountDownLatch</h5><blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">CounttDownLatch 是 java.util.concurrent(JUC)中的锁，闭锁。利用它可以实现类似计数器的功能。比如有一个任务A，它要等待其他4个任务执行完毕之后才能执行，此时就可以利用CountDownLatch来实现这种功能了。</span><br></pre></td></tr></table></figure>\n</blockquote>\n<h6 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h6><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">oneTest</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">// 计数器10 state = 10</span></span><br><span class=\"line\">       <span class=\"keyword\">int</span> total = <span class=\"number\">10</span>;</span><br><span class=\"line\">       CountDownLatch countDownLatch = <span class=\"keyword\">new</span> CountDownLatch(total);</span><br><span class=\"line\">       <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; total; i++) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">new</span> Thread(() -&gt; &#123;</span><br><span class=\"line\">               log.info(<span class=\"string\">\"running\"</span>);</span><br><span class=\"line\">               countDownLatch.countDown();</span><br><span class=\"line\">           &#125;).start();</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           log.info(<span class=\"string\">\"await\"</span>);</span><br><span class=\"line\">           countDownLatch.await();</span><br><span class=\"line\">       &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">           e.printStackTrace();</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>输出</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">22</span>:<span class=\"number\">53.775</span> [main] INFO cn.z201.java.test.aqs.CountDownLatchTest - await</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">22</span>:<span class=\"number\">53.775</span> [Thread-<span class=\"number\">7</span>] INFO cn.z201.java.test.aqs.CountDownLatchTest - running</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">22</span>:<span class=\"number\">53.775</span> [Thread-<span class=\"number\">1</span>] INFO cn.z201.java.test.aqs.CountDownLatchTest - running</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">22</span>:<span class=\"number\">53.775</span> [Thread-<span class=\"number\">5</span>] INFO cn.z201.java.test.aqs.CountDownLatchTest - running</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">22</span>:<span class=\"number\">53.775</span> [Thread-<span class=\"number\">8</span>] INFO cn.z201.java.test.aqs.CountDownLatchTest - running</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">22</span>:<span class=\"number\">53.775</span> [Thread-<span class=\"number\">2</span>] INFO cn.z201.java.test.aqs.CountDownLatchTest - running</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">22</span>:<span class=\"number\">53.775</span> [Thread-<span class=\"number\">9</span>] INFO cn.z201.java.test.aqs.CountDownLatchTest - running</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">22</span>:<span class=\"number\">53.775</span> [Thread-<span class=\"number\">4</span>] INFO cn.z201.java.test.aqs.CountDownLatchTest - running</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">22</span>:<span class=\"number\">53.775</span> [Thread-<span class=\"number\">6</span>] INFO cn.z201.java.test.aqs.CountDownLatchTest - running</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">22</span>:<span class=\"number\">53.775</span> [Thread-<span class=\"number\">0</span>] INFO cn.z201.java.test.aqs.CountDownLatchTest - running</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">22</span>:<span class=\"number\">53.775</span> [Thread-<span class=\"number\">3</span>] INFO cn.z201.java.test.aqs.CountDownLatchTest - running</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"ReentrantLock\"><a href=\"#ReentrantLock\" class=\"headerlink\" title=\"ReentrantLock\"></a>ReentrantLock</h5><blockquote>\n<p>ReentrantLock 是 java.util.concurrent（J.U.C）包中的锁。和synchronized也是互斥锁，同时可以实现公平和非公平锁。</p>\n</blockquote>\n<h6 id=\"构造方法\"><a href=\"#构造方法\" class=\"headerlink\" title=\"构造方法\"></a>构造方法</h6><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//默认非公平锁</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ReentrantLock</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">     sync = <span class=\"keyword\">new</span> NonfairSync();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//传入true，可以构建公平锁</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ReentrantLock</span><span class=\"params\">(<span class=\"keyword\">boolean</span> fair)</span> </span>&#123;</span><br><span class=\"line\">    sync = fair ? <span class=\"keyword\">new</span> FairSync() : <span class=\"keyword\">new</span> NonfairSync();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"案例-1\"><a href=\"#案例-1\" class=\"headerlink\" title=\"案例\"></a>案例</h6><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LockExample</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Lock lock = <span class=\"keyword\">new</span> ReentrantLock();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">                System.out.print(i + <span class=\"string\">\" \"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            lock.unlock(); <span class=\"comment\">// 确保释放锁，从而避免发生死锁。</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">    LockExample lockExample = <span class=\"keyword\">new</span> LockExample();</span><br><span class=\"line\">    ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class=\"line\">    executorService.execute(() -&gt; lockExample.func());</span><br><span class=\"line\">    executorService.execute(() -&gt; lockExample.func());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 最后输出 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ReentrantLockDemo</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Lock lock = <span class=\"keyword\">new</span> ReentrantLock();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 调用ReentrantLock的lock方法获取锁</span></span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"ThreadName \"</span> + Thread.currentThread().getName() + <span class=\"string\">\" number \"</span> + i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 调用ReentrantLock的lock方法释放锁</span></span><br><span class=\"line\">        lock.unlock();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ReentrantLockThread</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> ReentrantLockDemo reentrantLockDemo;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ReentrantLockThread</span><span class=\"params\">(ReentrantLockDemo reentrantLockDemo)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.reentrantLockDemo = reentrantLockDemo;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        reentrantLockDemo.test();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ReentrantLockTests</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        ReentrantLockDemo reentrantLockDemo = <span class=\"keyword\">new</span> ReentrantLockDemo();</span><br><span class=\"line\">        ReentrantLockThread reentrantLockThread1 = <span class=\"keyword\">new</span> ReentrantLockThread(reentrantLockDemo);</span><br><span class=\"line\">        ReentrantLockThread reentrantLockThread2 = <span class=\"keyword\">new</span> ReentrantLockThread(reentrantLockDemo);</span><br><span class=\"line\">        ReentrantLockThread reentrantLockThread3 = <span class=\"keyword\">new</span> ReentrantLockThread(reentrantLockDemo);</span><br><span class=\"line\">        ReentrantLockThread reentrantLockThread4 = <span class=\"keyword\">new</span> ReentrantLockThread(reentrantLockDemo);</span><br><span class=\"line\">        reentrantLockThread1.start();</span><br><span class=\"line\">        reentrantLockThread2.start();</span><br><span class=\"line\">        reentrantLockThread3.start();</span><br><span class=\"line\">        reentrantLockThread4.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>输出结果</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">ThreadName Thread-<span class=\"number\">0</span> number <span class=\"number\">0</span></span><br><span class=\"line\">ThreadName Thread-<span class=\"number\">0</span> number <span class=\"number\">1</span></span><br><span class=\"line\">ThreadName Thread-<span class=\"number\">0</span> number <span class=\"number\">2</span></span><br><span class=\"line\">ThreadName Thread-<span class=\"number\">2</span> number <span class=\"number\">0</span></span><br><span class=\"line\">ThreadName Thread-<span class=\"number\">2</span> number <span class=\"number\">1</span></span><br><span class=\"line\">ThreadName Thread-<span class=\"number\">2</span> number <span class=\"number\">2</span></span><br><span class=\"line\">ThreadName Thread-<span class=\"number\">3</span> number <span class=\"number\">0</span></span><br><span class=\"line\">ThreadName Thread-<span class=\"number\">3</span> number <span class=\"number\">1</span></span><br><span class=\"line\">ThreadName Thread-<span class=\"number\">3</span> number <span class=\"number\">2</span></span><br><span class=\"line\">ThreadName Thread-<span class=\"number\">1</span> number <span class=\"number\">0</span></span><br><span class=\"line\">ThreadName Thread-<span class=\"number\">1</span> number <span class=\"number\">1</span></span><br><span class=\"line\">ThreadName Thread-<span class=\"number\">1</span> number <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>当前的线程执行完成之后才能执行其他线程，但是其他线程执行的顺序是随机的。</li>\n</ul>\n<h5 id=\"ReentrantReadWriteLock\"><a href=\"#ReentrantReadWriteLock\" class=\"headerlink\" title=\"ReentrantReadWriteLock\"></a>ReentrantReadWriteLock</h5><h5 id=\"Semaphore\"><a href=\"#Semaphore\" class=\"headerlink\" title=\"Semaphore\"></a>Semaphore</h5><blockquote>\n<p> java.util.concurrent(JUC) ,Semaphore翻译成字面意思为 信号量，Semaphore可以控同时访问的线程个数，通过 acquire() 获取一个许可，如果没有就等待，而 release() 释放一个许可。</p>\n</blockquote>\n<h6 id=\"案例-2\"><a href=\"#案例-2\" class=\"headerlink\" title=\"案例\"></a>案例</h6><blockquote>\n<p>这里防止主线程终止，先睡个10s。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">oneTest</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> total = <span class=\"number\">10</span>;</span><br><span class=\"line\">    Semaphore semaphore = <span class=\"keyword\">new</span> Semaphore(<span class=\"number\">5</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; total; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> SemaphoreRunnable(semaphore)).start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Thread.sleep(<span class=\"number\">10000</span>);</span><br><span class=\"line\">    log.info(<span class=\"string\">\"info\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SemaphoreRunnable</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Semaphore semaphore;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">SemaphoreRunnable</span><span class=\"params\">(Semaphore semaphore)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.semaphore = semaphore;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">\"&#123;&#125; acquire\"</span>,Thread.currentThread().getName());</span><br><span class=\"line\">            semaphore.acquire();</span><br><span class=\"line\">            Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//释放信号量</span></span><br><span class=\"line\">            log.info(<span class=\"string\">\"&#123;&#125; release \"</span>,Thread.currentThread().getName());</span><br><span class=\"line\">            semaphore.release();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>输出</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">08.873</span> [Thread-<span class=\"number\">6</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">6</span> acquire</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">08.874</span> [Thread-<span class=\"number\">9</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">9</span> acquire</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">08.874</span> [Thread-<span class=\"number\">5</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">5</span> acquire</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">08.874</span> [Thread-<span class=\"number\">7</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">7</span> acquire</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">08.874</span> [Thread-<span class=\"number\">2</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">2</span> acquire</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">08.874</span> [Thread-<span class=\"number\">4</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">4</span> acquire</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">08.874</span> [Thread-<span class=\"number\">0</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">0</span> acquire</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">08.874</span> [Thread-<span class=\"number\">1</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">1</span> acquire</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">08.874</span> [Thread-<span class=\"number\">8</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">8</span> acquire</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">08.874</span> [Thread-<span class=\"number\">3</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">3</span> acquire</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">09.884</span> [Thread-<span class=\"number\">5</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">5</span> release </span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">09.884</span> [Thread-<span class=\"number\">7</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">7</span> release </span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">09.884</span> [Thread-<span class=\"number\">9</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">9</span> release </span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">09.884</span> [Thread-<span class=\"number\">2</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">2</span> release </span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">09.884</span> [Thread-<span class=\"number\">6</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">6</span> release </span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">10.885</span> [Thread-<span class=\"number\">4</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">4</span> release </span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">10.885</span> [Thread-<span class=\"number\">1</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">1</span> release </span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">10.885</span> [Thread-<span class=\"number\">0</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">0</span> release </span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">10.886</span> [Thread-<span class=\"number\">8</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">8</span> release </span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">10.886</span> [Thread-<span class=\"number\">3</span>] INFO cn.z201.java.test.aqs.SemaphoreTest - Thread-<span class=\"number\">3</span> release </span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">10</span>:<span class=\"number\">18.877</span> [main] INFO cn.z201.java.test.aqs.SemaphoreTest - info</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"CyclicBarrier\"><a href=\"#CyclicBarrier\" class=\"headerlink\" title=\"CyclicBarrier\"></a>CyclicBarrier</h5><blockquote>\n<p>CyclicBarrier 是 java.util.concurrent(JUC)中的锁，栅栏锁。它可以实现让一组线程等待至某个状态之后再全部同时执行。</p>\n</blockquote>\n<h6 id=\"案例-3\"><a href=\"#案例-3\" class=\"headerlink\" title=\"案例\"></a>案例</h6><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">oneTest</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">int</span> total = <span class=\"number\">5</span>;</span><br><span class=\"line\">       CyclicBarrier cyclicBarrier = <span class=\"keyword\">new</span> CyclicBarrier(total);</span><br><span class=\"line\">       ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class=\"line\">       <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; total; i++) &#123;</span><br><span class=\"line\">           executorService.execute(() -&gt; &#123;</span><br><span class=\"line\">               log.info(<span class=\"string\">\"await\"</span>);</span><br><span class=\"line\">               <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                   cyclicBarrier.await();</span><br><span class=\"line\">               &#125; <span class=\"keyword\">catch</span> (InterruptedException</span><br><span class=\"line\">                       | BrokenBarrierException e) &#123;</span><br><span class=\"line\">                   e.printStackTrace();</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               log.info(<span class=\"string\">\"running\"</span>);</span><br><span class=\"line\">           &#125;);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>输出</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">15</span>:<span class=\"number\">06</span>:<span class=\"number\">17.233</span> [pool-<span class=\"number\">1</span>-thread-<span class=\"number\">4</span>] INFO cn.z201.java.test.aqs.CyclicBarrierTest - await</span><br><span class=\"line\"><span class=\"number\">15</span>:<span class=\"number\">06</span>:<span class=\"number\">17.233</span> [pool-<span class=\"number\">1</span>-thread-<span class=\"number\">3</span>] INFO cn.z201.java.test.aqs.CyclicBarrierTest - await</span><br><span class=\"line\"><span class=\"number\">15</span>:<span class=\"number\">06</span>:<span class=\"number\">17.233</span> [pool-<span class=\"number\">1</span>-thread-<span class=\"number\">2</span>] INFO cn.z201.java.test.aqs.CyclicBarrierTest - await</span><br><span class=\"line\"><span class=\"number\">15</span>:<span class=\"number\">06</span>:<span class=\"number\">17.233</span> [pool-<span class=\"number\">1</span>-thread-<span class=\"number\">5</span>] INFO cn.z201.java.test.aqs.CyclicBarrierTest - await</span><br><span class=\"line\"><span class=\"number\">15</span>:<span class=\"number\">06</span>:<span class=\"number\">17.233</span> [pool-<span class=\"number\">1</span>-thread-<span class=\"number\">1</span>] INFO cn.z201.java.test.aqs.CyclicBarrierTest - await</span><br><span class=\"line\"><span class=\"number\">15</span>:<span class=\"number\">06</span>:<span class=\"number\">17.233</span> [main] INFO cn.z201.java.test.aqs.CyclicBarrierTest - main</span><br><span class=\"line\"><span class=\"number\">15</span>:<span class=\"number\">06</span>:<span class=\"number\">17.239</span> [pool-<span class=\"number\">1</span>-thread-<span class=\"number\">1</span>] INFO cn.z201.java.test.aqs.CyclicBarrierTest - running</span><br><span class=\"line\"><span class=\"number\">15</span>:<span class=\"number\">06</span>:<span class=\"number\">17.239</span> [pool-<span class=\"number\">1</span>-thread-<span class=\"number\">2</span>] INFO cn.z201.java.test.aqs.CyclicBarrierTest - running</span><br><span class=\"line\"><span class=\"number\">15</span>:<span class=\"number\">06</span>:<span class=\"number\">17.239</span> [pool-<span class=\"number\">1</span>-thread-<span class=\"number\">5</span>] INFO cn.z201.java.test.aqs.CyclicBarrierTest - running</span><br><span class=\"line\"><span class=\"number\">15</span>:<span class=\"number\">06</span>:<span class=\"number\">17.239</span> [pool-<span class=\"number\">1</span>-thread-<span class=\"number\">3</span>] INFO cn.z201.java.test.aqs.CyclicBarrierTest - running</span><br><span class=\"line\"><span class=\"number\">15</span>:<span class=\"number\">06</span>:<span class=\"number\">17.239</span> [pool-<span class=\"number\">1</span>-thread-<span class=\"number\">4</span>] INFO cn.z201.java.test.aqs.CyclicBarrierTest - running</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"ReentrantReadWriteLock-1\"><a href=\"#ReentrantReadWriteLock-1\" class=\"headerlink\" title=\"ReentrantReadWriteLock\"></a>ReentrantReadWriteLock</h5><blockquote>\n<p>ReentrantReadWriteLock锁 实际也是继承了AQS类来实现锁的功能的</p>\n</blockquote>\n<h6 id=\"案例-4\"><a href=\"#案例-4\" class=\"headerlink\" title=\"案例\"></a>案例</h6><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ReentrantReadWriteLockTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Map&lt;String,String&gt; data = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 读、写锁</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ReentrantReadWriteLock reentrantReadWriteLock = <span class=\"keyword\">new</span> ReentrantReadWriteLock();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 读锁</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Lock readLock = reentrantReadWriteLock.readLock();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 写锁</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Lock writeLock = reentrantReadWriteLock.writeLock();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        put(<span class=\"string\">\"a\"</span>,<span class=\"string\">\"a\"</span>);</span><br><span class=\"line\">        get(<span class=\"string\">\"a\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">get</span><span class=\"params\">(String key)</span></span>&#123;</span><br><span class=\"line\">        readLock.lock();</span><br><span class=\"line\">        log.info(<span class=\"string\">\"读锁\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> data.get(key);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            readLock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">put</span><span class=\"params\">(String key ,String value)</span></span>&#123;</span><br><span class=\"line\">        writeLock.lock();</span><br><span class=\"line\">        log.info(<span class=\"string\">\"写锁\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> data.put(key,value);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            writeLock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">00:25:27.321 [main] INFO cn.z201.java.test.lock.ReentrantReadWriteLockTest - 写锁</span><br><span class=\"line\">00:25:27.325 [main] INFO cn.z201.java.test.lock.ReentrantReadWriteLockTest - 读锁</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"Condition\"><a href=\"#Condition\" class=\"headerlink\" title=\"Condition\"></a>Condition</h4><blockquote>\n<p>synchronized 关键字，它配合 Object 的 wait()、notify() 系列方法可以实现等待/通知模式。对于 Lock，通过 Condition 也可以实现等待/通知模式。Condition 是一个接口。Condition 接口的实现类是 Lock（AQS）中的 ConditionObject。Lock 接口中有个 newCondition() 方法，通过这个方法可以获得 Condition 对象（其实就是 ConditionObject ）。因此，通过 Lock 对象可以获得 Condition 对象。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">Lock lock  = <span class=\"keyword\">new</span> ReentrantLock();</span><br><span class=\"line\">Condition ondition1 = lock.newCondition();</span><br><span class=\"line\">Condition condition2 = lock.newCondition();</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"CountDownLatch与CyclicBarrier\"><a href=\"#CountDownLatch与CyclicBarrier\" class=\"headerlink\" title=\"CountDownLatch与CyclicBarrier\"></a>CountDownLatch与CyclicBarrier</h4><ul>\n<li>CountDownLatch的作用是允许1或N个线程等待其他线程完成执行；而CyclicBarrier则是允许N个线程相互等待</li>\n<li>CountDownLatch的计数器无法被重置；CyclicBarrier的计数器可以被重置后使用，因此它被称为是循环的barrier</li>\n</ul>\n<h4 id=\"CAS-Compare-And-Swap\"><a href=\"#CAS-Compare-And-Swap\" class=\"headerlink\" title=\"CAS Compare-And-Swap\"></a>CAS Compare-And-Swap</h4><blockquote>\n<p>CAS的全称是Compare-And-Swap，它是CPU并发原语。它的功能是判断内存某个位置的值是否为预期值，如果是则更改为新的值，这个过程是原子的，可用于在多线程编程中实现不被打断的数据交换操作，从而避免多线程同时改写某一数据时由于执行顺序不确定性以及中断的不可预知性产生的数据不一致问题。该操作通过将内存中的值与指定数据进行比较，当数值一样时将内存中的数据替换为新的值。其原理是利用<code>sun.misc.Unsafe.java</code> 类通过JNI来调用硬件级别的原子操作来实现CAS(即CAS是借助C来调用CPU底层指令实现的)。</p>\n</blockquote>\n<ul>\n<li><p>CAS = 比较并交换 + 乐观版本锁 + 锁自旋</p>\n</li>\n<li><p>CAS具备原子性，它是cpu硬件指令实现保证原子性。通过JNI调用Native方法由c++编写的硬件级别指令。JDK中通过Unsafe类执行操作。</p>\n</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211007005739.png\"></p>\n<ul>\n<li>非阻塞算法</li>\n<li>非独占锁</li>\n</ul>\n<h5 id=\"ABA问题\"><a href=\"#ABA问题\" class=\"headerlink\" title=\"ABA问题\"></a>ABA问题</h5><blockquote>\n<p>CAS 算法实现一个重要前提需要取出内存中某时刻的数据，而在下时刻比较并替换，那么在这个时间差类会导致数据的变化。</p>\n</blockquote>\n<ul>\n<li>比如说一个线程 t1 从内存位置 V 中取出 A，这时候另一个线程 t2 也从内存中取出 A，并且t2 进行了一些操作变成了 B，然后 t2 又将 V 位置的数据变成 A，这时候线程 t1 进行 CAS 操作发现内存中仍然是 A，然后 t1 操作成功。此时CAS比较值相等，自旋成功。</li>\n<li>部分乐观锁的实现是通过版本号（version）的方式来解决 ABA 问题，乐观锁每次在执行数据的修改操作时，都会带上一个版本号，一旦版本号和数据的版本号一致就可以执行修改操作并对版本号执行+1 操作，否则就执行失败。因为每次操作的版本号都会随之增加，所以不会出现 ABA 问题，因为版本号只会增加不会减少。</li>\n</ul>\n<h4 id=\"synchronized和ReentrantLock-的区别\"><a href=\"#synchronized和ReentrantLock-的区别\" class=\"headerlink\" title=\"synchronized和ReentrantLock 的区别\"></a>synchronized和ReentrantLock 的区别</h4><ul>\n<li><p>两者都是可重⼊锁</p>\n<ul>\n<li>两者都是可重⼊锁。“可重⼊锁”概念是：⾃⼰可以再次获取⾃⼰的内部锁。⽐如⼀个线程获得了某个对象的锁，此时这个对象锁还没有释放，当其再次想要获取这个对象的锁的时候还是可以获取的，如果不可锁重⼊的话，就会造成死锁。同⼀个线程每次获取锁，锁的计数器都⾃增1，所以要等到锁的计数器下降为0时才能释放锁。</li>\n</ul>\n</li>\n<li><p><strong>synchronized</strong> 依赖于 <strong>JVM</strong> ⽽ <strong>ReentrantLock</strong> 依赖于 <strong>API</strong></p>\n<ul>\n<li>synchronized 是依赖于 JVM 实现的，前⾯我们也讲到了 虚拟机团队在 JDK1.6 为 synchronized 关键字进⾏了很多优化，但是这些优化都是在虚拟机层⾯实现的，并没有直接暴露给我们。ReentrantLock 是 JDK 层⾯实现的（也就是 API 层⾯，需要 lock() 和 unlock() ⽅法配合try/finally 语句块来完成），所以我们可以通过查看它的源代码，来看它是如何实现的。</li>\n</ul>\n</li>\n<li><p>synchronized的方式加锁，会让线程在 BLOCKED 状态和 RUNNABLE 状态之间切换，在操作系统上，就会造成用户态和内核态的频繁切换，效率就比较低。</p>\n</li>\n<li><p>相⽐synchronized，ReentrantLock增加了⼀些⾼级功能</p>\n<blockquote>\n<p>除非需要使用 ReentrantLock 的高级功能，否则优先使用 synchronized。这是因为 synchronized 是 JVM 实现的一种锁机制，JVM 原生地支持它，而 ReentrantLock 不是所有的 JDK 版本都支持。并且使用 synchronized 不用担心没有释放锁而导致死锁问题，因为 JVM 会确保锁的释放。</p>\n</blockquote>\n<ul>\n<li><p>等待可中断</p>\n<ul>\n<li><strong>ReentrantLock</strong>提供了⼀种能够中断等待锁的线程的机制，通过lock.lockInterruptibly()来实现这个机制。也就是说正在等待的线程可以选择放弃等待，改为处理其他事情。</li>\n</ul>\n</li>\n<li><p>实现公平锁</p>\n<ul>\n<li><strong>ReentrantLock</strong>可以指定是公平锁还是⾮公平锁。⽽<strong>synchronized</strong>只能是⾮公平锁。所谓的公平锁就是先等待的线程先获得锁。 ReentrantLock默认情况是⾮公平的，可以通过 ReentrantLock类的 ReentrantLock(boolean fair) 构造⽅法来制定是否是公平的。</li>\n</ul>\n</li>\n<li><p>可实现选择性通知</p>\n<ul>\n<li>ReentrantLock类实现等待/通知机制，需要借助于Condition接⼝与newCondition() ⽅法。Condition是JDK1.5之后才有的，它具有很好的灵活性，⽐如可以实现多路通知功能也就是在⼀个Lock对象中可以创建多个Condition实例（即对象监视器），线程对象可以注册在指定的<strong>Condition</strong>中，从⽽可以有选择性的进⾏线程通知，在调度线程上更加灵活。 在使⽤<strong>notify()/notifyAll()**⽅法进⾏通知时，被通知的线程是由 **JVM</strong> 选择的，⽤<strong>ReentrantLock</strong>类结合<strong>Condition</strong>实例可以实现<strong>“</strong>选择性通知<strong>”</strong> ，这个功能⾮常重要，⽽且是Condition接⼝默认提供的。⽽synchronized关键字就相当于整个Lock对象中只有⼀个Condition实例，所有的线程都注册在它⼀个身上。如果执⾏notifyAll()⽅法的话就会通知所有处于等待状态的线程这样会造成很⼤的效率问题，⽽Condition实例的signalAll()⽅法 只会唤醒注册在该Condition实例中的所有等待线程。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"公平锁-非公平锁\"><a href=\"#公平锁-非公平锁\" class=\"headerlink\" title=\"公平锁/非公平锁\"></a>公平锁/非公平锁</h4><blockquote>\n<p>公平读写锁比较简单的一种方式是：用队列把获取锁的线程排队，不管是写线程还是读线程都按照先进先出的原则加锁即可，这样读线程仍然可以并发，也不会出现「饥饿」的现象。</p>\n</blockquote>\n<ul>\n<li>公平锁的含义是线程需要按照请求的顺序来获得锁；而非公平锁则允许“插队”的情况存在，所谓的“插队”指的是，线程在发送请求的同时该锁的状态恰好变成了可用，那么此线程就可以跳过队列中所有排队的线程直接拥有该锁。</li>\n<li>而公平锁由于有挂起和恢复所以存在一定的开销，因此性能不如非公平锁，所以 ReentrantLock 和 synchronized 默认都是非公平锁的实现方式。</li>\n</ul>\n<h4 id=\"可重入锁\"><a href=\"#可重入锁\" class=\"headerlink\" title=\"可重入锁\"></a>可重入锁</h4><ul>\n<li>可重入锁又名递归锁，是指在同一个线程，在外层方法获取锁的时候，在进入内层方法会自动获取锁<strong>。</strong></li>\n<li>可重入锁的一个好处是可一定程度避免死锁。</li>\n</ul>\n<h4 id=\"共享锁-独占锁\"><a href=\"#共享锁-独占锁\" class=\"headerlink\" title=\"共享锁/独占锁\"></a>共享锁/独占锁</h4><ul>\n<li><p>只能被单线程持有的锁叫独占锁，可以被多线程持有的锁叫共享锁。</p>\n<ul>\n<li>独占锁指的是在任何时候最多只能有一个线程持有该锁，比如 synchronized 就是独占锁，而 ReadWriteLock 读写锁允许同一时间内有多个线程进行读操作，它就属于共享锁。</li>\n<li>独占锁可以理解为悲观锁，当每次访问资源时都要加上互斥锁，而共享锁可以理解为乐观锁，它放宽了加锁的条件，允许多线程同时访问该资源。</li>\n</ul>\n</li>\n<li><p><code>共享锁</code>是指锁可被多个线程所持有。如果一个线程对数据加上共享锁后，那么其他线程只能对数据再加共享锁，不能加独占锁。获得共享锁的线程只能读数据，不能修改数据。</p>\n<ul>\n<li>在 JDK 中 <code>ReentrantReadWriteLock</code> 就是一种共享锁。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"互斥锁-读写锁\"><a href=\"#互斥锁-读写锁\" class=\"headerlink\" title=\"互斥锁/读写锁\"></a>互斥锁/读写锁</h4><ul>\n<li>上面讲的独享锁/共享锁就是一种广义的说法，互斥锁/读写锁就是具体的实现。<ul>\n<li>互斥锁在Java中的具体实现就是<code>ReentrantLock</code></li>\n<li>读写锁在Java中的具体实现就是<code>ReadWriteLock</code></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"分段锁\"><a href=\"#分段锁\" class=\"headerlink\" title=\"分段锁\"></a>分段锁</h4><ul>\n<li>分段锁其实是一种锁的设计，并不是具体的一种锁，对于<code>ConcurrentHashMap</code>而言，其并发的实现就是通过分段锁的形式来实现高效的并发操作。</li>\n</ul>\n<h4 id=\"锁升级（无锁-偏向锁-轻量级锁-重量级锁）\"><a href=\"#锁升级（无锁-偏向锁-轻量级锁-重量级锁）\" class=\"headerlink\" title=\"锁升级（无锁|偏向锁|轻量级锁|重量级锁）\"></a>锁升级（无锁|偏向锁|轻量级锁|重量级锁）</h4><ul>\n<li><p><code>无锁</code>状态其实就是上面讲的乐观锁。</p>\n</li>\n<li><p>偏向锁是指一段同步代码一直被一个线程所访问，那么该线程会自动获取锁。降低获取锁的代价。</p>\n<ul>\n<li>当锁对象第一次被线程获取的时候，虚拟机将会把对象头中的标志位设为“01” （可偏向），即偏向模式。同时使用CAS操作把获取到这个锁的线程的ID记录在对象的Mark Word之中，如果CAS操作成功，持有偏向锁的线程以后每次进入这个锁相关的同步块时，虚拟机都可以不再进行任何同步操作。</li>\n<li>当有另外一个线程去尝试获取这个锁时，偏向模式就宣告结束。根据锁对象目前是否处于被锁定的状态，撤销偏向（Revoke Bias）后恢复到未锁定（标志位为“01”，不可偏向）或 轻量级锁定（标志位为“00”）的状态，后续的同步操作就进入轻量级锁的流程。</li>\n</ul>\n</li>\n<li><p>进入到轻量级锁说明不止一个线程尝试获取锁，这个阶段会通过自适应自旋CAS方式获取锁。如果获取失败，则进行锁膨胀，进入重量级锁流程，线程阻塞。</p>\n</li>\n<li><p>重量级锁是通过系统的线程互斥锁来实现的，代价最昂贵</p>\n</li>\n</ul>\n<h4 id=\"自旋锁\"><a href=\"#自旋锁\" class=\"headerlink\" title=\"自旋锁\"></a>自旋锁</h4><ul>\n<li><code>自旋锁</code>是指线程在没有获得锁时不是被直接挂起，而是执行一个忙循环，这个忙循环就是所谓的自旋。<ul>\n<li>如果锁被另一个线程占用的时间比较长，即使自旋了之后当前线程还是会被挂起，忙循环就会变成浪费系统资源的操作，反而降低了整体性能。因此自旋锁是不适应锁占用时间长的并发情况的。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"互斥锁与自旋锁\"><a href=\"#互斥锁与自旋锁\" class=\"headerlink\" title=\"互斥锁与自旋锁\"></a>互斥锁与自旋锁</h4><ul>\n<li><strong>互斥锁</strong>加锁失败后，线程会<strong>释放 CPU</strong> ，给其他线程；<ul>\n<li>互斥锁是一种「独占锁」，比如当线程 A 加锁成功后，此时互斥锁已经被线程 A 独占了，只要线程 A 没有释放手中的锁，线程 B 加锁就会失败，于是就会释放 CPU 让给其他线程，<strong>既然线程 B 释放掉了 CPU，自然线程 B 加锁的代码就会被阻塞</strong>。<ul>\n<li><strong>对于互斥锁加锁失败而阻塞的现象，是由操作系统内核实现的</strong>。当加锁失败时，内核会将线程置为「睡眠」状态，等到锁被释放后，内核会在合适的时机唤醒线程，当这个线程成功获取到锁后，于是就可以继续执行。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong>自旋锁</strong>加锁失败后，线程会<strong>忙等待</strong>，直到它拿到锁；<ul>\n<li>自旋锁是通过 CPU 提供的 <code>CAS</code> 函数（<em>Compare And Swap</em>），在「用户态」完成加锁和解锁操作，不会主动产生线程上下文切换，所以相比互斥锁来说，会快一些，开销也小一些。</li>\n<li>一般加锁的过程，包含两个步骤：<ul>\n<li>第一步，查看锁的状态，如果锁是空闲的，则执行第二步；</li>\n<li>第二步，将锁设置为当前线程持有；</li>\n<li>CAS 函数就把这两个步骤合并成一条硬件级指令，形成<strong>原子指令</strong>，这样就保证了这两个步骤是不可分割的，要么一次性执行完两个步骤，要么两个步骤都不执行。</li>\n<li>使用自旋锁的时候，当发生多线程竞争锁的情况，加锁失败的线程会「忙等待」，直到它拿到锁。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"锁优化技术（锁粗化-锁消除）\"><a href=\"#锁优化技术（锁粗化-锁消除）\" class=\"headerlink\" title=\"锁优化技术（锁粗化|锁消除）\"></a>锁优化技术（锁粗化|锁消除）</h4><ul>\n<li><code>锁粗化</code>就是将多个同步块的数量减少，并将单个同步块的作用范围扩大，本质上就是将多次上锁、解锁的请求合并为一次同步请求。</li>\n<li><code>锁消除</code>是指虚拟机编译器在运行时检测到了共享数据没有竞争的锁，从而将这些锁进行消除。</li>\n</ul>\n<h4 id=\"死锁-Deadlock-？如何分析和避免死锁？\"><a href=\"#死锁-Deadlock-？如何分析和避免死锁？\" class=\"headerlink\" title=\"死锁(Deadlock)？如何分析和避免死锁？\"></a><strong>死锁(Deadlock)？如何分析和避免死锁？</strong></h4><ul>\n<li>死锁是指两个以上的线程永远阻塞的情况，这种情况产生至少需要两个以上的线程和两个以上的资源。</li>\n<li>分析死锁，我们需要查看Java应用程序的线程转储。我们需要找出那些状态为BLOCKED的线程和他们等待的资源。每个资源都有一个唯一的id，用这个id我们可以找出哪些线程已经拥有了它的对象锁。</li>\n<li>避免嵌套锁，只在需要的地方使用锁和避免无限期等待是避免死锁的通常办法。</li>\n</ul>\n<h5 id=\"案例-5\"><a href=\"#案例-5\" class=\"headerlink\" title=\"案例\"></a>案例</h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DeadLockTest</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        Object l1 = <span class=\"keyword\">new</span> Object();</span><br><span class=\"line\">        Object l2 = <span class=\"keyword\">new</span> Object();</span><br><span class=\"line\">        <span class=\"keyword\">new</span> Thread(()-&gt;&#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (l1)&#123;</span><br><span class=\"line\">                log.info(<span class=\"string\">\"&#123;&#125; lock 1 success\"</span>,Thread.currentThread().getName());</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (l2)&#123;</span><br><span class=\"line\">                    log.info(<span class=\"string\">\"&#123;&#125; lock 2 success\"</span>,Thread.currentThread().getName());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;).start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> Thread(()-&gt;&#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (l2)&#123;</span><br><span class=\"line\">                log.info(<span class=\"string\">\"&#123;&#125; lock 2 success\"</span>,Thread.currentThread().getName());</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (l1)&#123;</span><br><span class=\"line\">                    log.info(<span class=\"string\">\"&#123;&#125; lock 1 success\"</span>,Thread.currentThread().getName());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;).start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">53</span>:<span class=\"number\">28.122</span> [Thread-<span class=\"number\">1</span>] INFO cn.z201.java.test.lock.DeadLockTest - Thread-<span class=\"number\">1</span> lock <span class=\"number\">2</span> success</span><br><span class=\"line\"><span class=\"number\">14</span>:<span class=\"number\">53</span>:<span class=\"number\">28.122</span> [Thread-<span class=\"number\">0</span>] INFO cn.z201.java.test.lock.DeadLockTest - Thread-<span class=\"number\">0</span> lock <span class=\"number\">1</span> success</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"如何避免线程死锁\"><a href=\"#如何避免线程死锁\" class=\"headerlink\" title=\"如何避免线程死锁?\"></a>如何避免线程死锁?</h5><ul>\n<li><p>破坏互斥条件 ：这个条件我们没有办法破坏，因为我们⽤锁本来就是想让他们互斥的（临界资源需要互斥访问）。</p>\n</li>\n<li><p>破坏请求与保持条件 ：⼀次性申请所有的资源。</p>\n</li>\n<li><p>破坏不剥夺条件 ：占⽤部分资源的线程进⼀步申请其他资源时，如果申请不到，可以主动释放它占有的资源。</p>\n</li>\n<li><p>破坏循环等待条件 ：靠按序申请资源来预防。按某⼀顺序申请资源，释放资源则反序释放。破坏循环等待条件。</p>\n</li>\n</ul>\n<h3 id=\"Java中常见的线程同步方式\"><a href=\"#Java中常见的线程同步方式\" class=\"headerlink\" title=\"Java中常见的线程同步方式\"></a>Java中常见的线程同步方式</h3><ul>\n<li>Object中wait\\notify\\notifyAll完成对monitor之间的同步。</li>\n<li>synchronized对方法\\对象代码块同步。</li>\n<li>volatile关键字修饰字段实现变量的可见性。</li>\n<li>atomic自增自减。</li>\n<li>ThreadLoacal线程局部变量。</li>\n<li>juc包下工具类\\LinkedBlockingQueue。</li>\n<li>Thread中join\\await方法实现任务顺序执行。</li>\n</ul>\n","categories":["查缺补漏"],"tags":["Java"]},{"title":"源码阅读-HashMap","url":"/posts/307537220/","content":"<blockquote>\n<p>本章属于持续学习、长期更修。</p>\n</blockquote>\n<h2 id=\"HashMap\"><a href=\"#HashMap\" class=\"headerlink\" title=\"HashMap\"></a>HashMap</h2><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/HashMap/HashMap.png\"></p>\n<h3 id=\"特征\"><a href=\"#特征\" class=\"headerlink\" title=\"特征\"></a>特征</h3><ul>\n<li>HashMap 允许<code>null</code>键和<code>null</code>值，null键哈西值为0.</li>\n<li>HashMap 并不是有序的存放。在使用<code>iterate</code>迭代的时候，并不能得到存放顺序。</li>\n<li>HashMap使用它的内部类Node &lt;K，V&gt;来存储映射。</li>\n<li>HashMap将<code>entries</code>存储到多个单链表中，称为存储桶或存储桶。默认的箱数为16，默认负载因子0.75，它的扩展系数为2，当键值对数量大于阈值，则容量扩容到原来的2倍。</li>\n<li>HashMap不是线程安全的，对于多线程环境，您应该使用ConcurrentHashMap类或使用<code>Collections.synchronizedMap()</code>方法获取同步映射。</li>\n<li>底层实现是链表，但是jdk1.8后添加了红黑谁的转换。</li>\n<li>HashMap的Key用存放，所以key默认不允许重复的，如果想重复就重写key的hashcode和equals方法。</li>\n<li>查找方法，根据 hash 值我们能够快速定位到数组的具体下标，但是之后的话，需要顺着链表一个个比较下去才能找到我们需要的，时间复杂度取决于链表的长度，为 O(n)。为了降低这部分的开销，在 Java8 中，当链表中的元素超过了 8 个以后，会将链表转换为红黑树，在这些位置进行查找的时候可以降低时间复杂度为 O(logN)。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/20211005220907.png\"></p>\n<h2 id=\"源码分析\"><a href=\"#源码分析\" class=\"headerlink\" title=\"源码分析\"></a>源码分析</h2><blockquote>\n<p>HashMap中的常量以及变量</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 未指定容量大小的情况下，默认初始化16。容量都是2的幂。第一次扩容大概率情况下是64。</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> DEFAULT_INITIAL_CAPACITY = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">4</span>; <span class=\"comment\">// aka 16</span></span><br><span class=\"line\"><span class=\"comment\">// 容量最大长个数。</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MAXIMUM_CAPACITY = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">30</span>;</span><br><span class=\"line\"><span class=\"comment\">// 默认负载因子，</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">float</span> DEFAULT_LOAD_FACTOR = <span class=\"number\">0.75f</span>;</span><br><span class=\"line\"><span class=\"comment\">// HashMap使用单链表来存储元素，这些元素称为bin或buckets。当我们调用put方法时，key的hashCode用于确定将用于存储映射的存储区。</span></span><br><span class=\"line\"><span class=\"comment\">// 链表转换红黑树的阀值。当某个bin\\buckets的长度大于8的时候进行转换。</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> TREEIFY_THRESHOLD = <span class=\"number\">8</span>;</span><br><span class=\"line\"><span class=\"comment\">// 红黑树转换链表的阀值。当某个bin\\buckets的长度小于8的时候进行转换。</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> UNTREEIFY_THRESHOLD = <span class=\"number\">6</span>;</span><br><span class=\"line\"><span class=\"comment\">// 桶中bin最小hash容量，如果大于这个值会进行resize扩容操作，此值至少是TREEIFY_THRESHOLD的4倍</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MIN_TREEIFY_CAPACITY = <span class=\"number\">64</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 被transient修饰的变量不回被序列化。</span></span><br><span class=\"line\"><span class=\"comment\">// HashMap内部类实现了Map的内部类Entry,用于存储K,V，第一次使用的时候被创建，根据需要可以进行resize。分配长度为2的冥次方</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class=\"line\"><span class=\"comment\">// 当被调用entrySet时被赋值。通过keySet()方法可以得到map key的集合，通过values方法可以得到map value的集合</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// size表示HashMap中存放KV的数量（为链表和树中的KV的总和）。</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> <span class=\"keyword\">int</span> size;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 操作次数，通常用过fail-fast。每次扩容和更改map结构的计数器</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> <span class=\"keyword\">int</span> modCount;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// threshold=capacity*loadFactor threshold表示当HashMap的size大于threshold时会执行resize操作。 </span></span><br><span class=\"line\"><span class=\"keyword\">int</span> threshold;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Load Factor用于确定何时重新散列HashMap并增加存储桶大小。存储桶或容量的默认值为16，负载系数为0.75。通过乘以容量和负载因子来计算重新散列的阈值</span></span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"keyword\">float</span> loadFactor;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Node</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title\">Map</span>.<span class=\"title\">Entry</span>&lt;<span class=\"title\">K</span>,<span class=\"title\">V</span>&gt; </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> hash; <span class=\"comment\">// node哈希值</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> K key;    </span><br><span class=\"line\">        V value;</span><br><span class=\"line\">        Node&lt;K,V&gt; next; <span class=\"comment\">// 下一个node的地址</span></span><br><span class=\"line\"></span><br><span class=\"line\">        Node(<span class=\"keyword\">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.hash = hash;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.key = key;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.value = value;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.next = next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> K <span class=\"title\">getKey</span><span class=\"params\">()</span>        </span>&#123; <span class=\"keyword\">return</span> key; &#125;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> V <span class=\"title\">getValue</span><span class=\"params\">()</span>      </span>&#123; <span class=\"keyword\">return</span> value; &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 这里重写方法，所以map.toString()不是内存地址。</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> String <span class=\"title\">toString</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> key + <span class=\"string\">\"=\"</span> + value; &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">\t\t\t  <span class=\"comment\">// 这里重写了hashCode()方法</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> <span class=\"title\">hashCode</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> V <span class=\"title\">setValue</span><span class=\"params\">(V newValue)</span> </span>&#123;</span><br><span class=\"line\">            V oldValue = value;</span><br><span class=\"line\">            value = newValue;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 这里重写了equals()方法</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">boolean</span> <span class=\"title\">equals</span><span class=\"params\">(Object o)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o == <span class=\"keyword\">this</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            <span class=\"comment\">//Map.Entry 相等的条件：键相等、值相等、个数相等、顺序相等</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o <span class=\"keyword\">instanceof</span> Map.Entry) &#123;</span><br><span class=\"line\">                Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;</span><br><span class=\"line\">                    Objects.equals(value, e.getValue()))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testConstructor</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    log.info(<span class=\"string\">\"Map test\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 1 </span></span><br><span class=\"line\">    Map m = <span class=\"keyword\">new</span> HashMap(); </span><br><span class=\"line\">    <span class=\"comment\">// 2 </span></span><br><span class=\"line\">    Map m1 = <span class=\"keyword\">new</span> HashMap(<span class=\"number\">10</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 3 </span></span><br><span class=\"line\">    Map m2 = <span class=\"keyword\">new</span> HashMap(<span class=\"number\">10</span>,<span class=\"number\">0.75f</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 4 </span></span><br><span class=\"line\">    Map m3 = <span class=\"keyword\">new</span> HashMap(map1);</span><br><span class=\"line\">    <span class=\"comment\">// put </span></span><br><span class=\"line\">    HashMap map = <span class=\"keyword\">new</span> HashMap&lt;String,Object&gt;();</span><br><span class=\"line\">    map.put(<span class=\"string\">\"1\"</span>,<span class=\"string\">\"1\"</span>);</span><br><span class=\"line\">    map.put(<span class=\"string\">\"2\"</span>,<span class=\"string\">\"2\"</span>);</span><br><span class=\"line\">    map.put(<span class=\"string\">\"3\"</span>,<span class=\"string\">\"3\"</span>);</span><br><span class=\"line\">    map.put(<span class=\"string\">\"4\"</span>,<span class=\"string\">\"4\"</span>);</span><br><span class=\"line\">    log.info(<span class=\"string\">\"map &#123;&#125;\"</span>,map);</span><br><span class=\"line\">    map.put(<span class=\"string\">\"1\"</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\">    log.info(<span class=\"string\">\"map &#123;&#125;\"</span>,map);</span><br><span class=\"line\">    map.put(<span class=\"string\">\"1\"</span>,<span class=\"keyword\">null</span>);</span><br><span class=\"line\">    log.info(<span class=\"string\">\"map &#123;&#125;\"</span>,map);</span><br><span class=\"line\">    map.put(<span class=\"keyword\">null</span>,<span class=\"keyword\">null</span>);</span><br><span class=\"line\">    log.info(<span class=\"string\">\"map &#123;&#125;\"</span>,map);</span><br><span class=\"line\">    Set&lt;String&gt; keySet = map.keySet();</span><br><span class=\"line\">    log.info(<span class=\"string\">\"keySet &#123;&#125;\"</span>,keySet);</span><br><span class=\"line\">    Collection&lt;String&gt; list =  map.values();</span><br><span class=\"line\">    log.info(<span class=\"string\">\"list &#123;&#125;\"</span>,list);</span><br><span class=\"line\">    log.info(<span class=\"string\">\"map.get &#123;&#125;\"</span>,map.get(<span class=\"string\">\"1\"</span>));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">16</span>:<span class=\"number\">16</span>:<span class=\"number\">25.020</span> [main] INFO cn.z201.java.test.map.HashMapTest - map &#123;<span class=\"number\">1</span>=<span class=\"number\">1</span>, <span class=\"number\">2</span>=<span class=\"number\">2</span>, <span class=\"number\">3</span>=<span class=\"number\">3</span>, <span class=\"number\">4</span>=<span class=\"number\">4</span>&#125;</span><br><span class=\"line\"><span class=\"number\">16</span>:<span class=\"number\">16</span>:<span class=\"number\">25.023</span> [main] INFO cn.z201.java.test.map.HashMapTest - map &#123;<span class=\"number\">1</span>=<span class=\"number\">3</span>, <span class=\"number\">2</span>=<span class=\"number\">2</span>, <span class=\"number\">3</span>=<span class=\"number\">3</span>, <span class=\"number\">4</span>=<span class=\"number\">4</span>&#125;</span><br><span class=\"line\"><span class=\"number\">16</span>:<span class=\"number\">16</span>:<span class=\"number\">25.023</span> [main] INFO cn.z201.java.test.map.HashMapTest - map &#123;<span class=\"number\">1</span>=<span class=\"keyword\">null</span>, <span class=\"number\">2</span>=<span class=\"number\">2</span>, <span class=\"number\">3</span>=<span class=\"number\">3</span>, <span class=\"number\">4</span>=<span class=\"number\">4</span>&#125;</span><br><span class=\"line\"><span class=\"number\">16</span>:<span class=\"number\">16</span>:<span class=\"number\">25.023</span> [main] INFO cn.z201.java.test.map.HashMapTest - map &#123;<span class=\"keyword\">null</span>=<span class=\"keyword\">null</span>, <span class=\"number\">1</span>=<span class=\"keyword\">null</span>, <span class=\"number\">2</span>=<span class=\"number\">2</span>, <span class=\"number\">3</span>=<span class=\"number\">3</span>, <span class=\"number\">4</span>=<span class=\"number\">4</span>&#125;</span><br><span class=\"line\"><span class=\"number\">16</span>:<span class=\"number\">16</span>:<span class=\"number\">25.023</span> [main] INFO cn.z201.java.test.map.HashMapTest - keySet [<span class=\"keyword\">null</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"><span class=\"number\">16</span>:<span class=\"number\">16</span>:<span class=\"number\">25.023</span> [main] INFO cn.z201.java.test.map.HashMapTest - list [<span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>]</span><br><span class=\"line\"><span class=\"number\">12</span>:<span class=\"number\">37</span>:<span class=\"number\">27.533</span> [main] INFO cn.z201.java.test.map.HashMapTest - map.get <span class=\"keyword\">null</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"源码方法跟踪\"><a href=\"#源码方法跟踪\" class=\"headerlink\" title=\"源码方法跟踪\"></a>源码方法跟踪</h2><ul>\n<li>HashMap 源码中三个重要方法：查询、新增和数据扩容。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 1 构造方法为空，loadFactor 将取默认系数。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">HashMap</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class=\"comment\">// all other fields defaulted</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2 构造方法一个参数, 将指定Capacity的大小。其实调用的是另外的一个构造方法。但是指定了默认的负载因子。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">HashMap</span><span class=\"params\">(<span class=\"keyword\">int</span> initialCapacity)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3 构造方法两个参数, 将指定Capacity的大小，和负载因子。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">HashMap</span><span class=\"params\">(<span class=\"keyword\">int</span> initialCapacity, <span class=\"keyword\">float</span> loadFactor)</span> </span>&#123;</span><br><span class=\"line\">  \t\t\t<span class=\"comment\">// 如果指定的容量大小不合法直接抛出异常。</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (initialCapacity &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">\"Illegal initial capacity: \"</span> +</span><br><span class=\"line\">                                               initialCapacity);</span><br><span class=\"line\">  \t\t\t<span class=\"comment\">// 如果指定的容量大于最大的容量大小限制，则直接赋值为最大。并不抛出异常。</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class=\"line\">            initialCapacity = MAXIMUM_CAPACITY;</span><br><span class=\"line\">  \t\t\t<span class=\"comment\">// 如果指定的负载因子不合法,则直接抛出异常。</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (loadFactor &lt;= <span class=\"number\">0</span> || Float.isNaN(loadFactor))</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">\"Illegal load factor: \"</span> +</span><br><span class=\"line\">                                               loadFactor);</span><br><span class=\"line\">  \t\t\t<span class=\"comment\">// 合法赋值</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.loadFactor = loadFactor;</span><br><span class=\"line\">  \t\t\t<span class=\"comment\">// 计算容量的扩展阀值</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 4 创建一个与指定Map具有相同映射并且指定负载因子系数为0.75的Map</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">HashMap</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class=\"line\">  \t\t\t<span class=\"comment\">// 直接指定默认的负载因子。</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;</span><br><span class=\"line\">        putMapEntries(m, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// tableSizeFor(int) 来根据指定的容量设置阈值，这个方法经过若干次无符号右移、求异运算，得出最接近指定参数 cap 的 2 的 N 次方容量。假如你传入的是 5，返回的初始容量为 8 。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> <span class=\"title\">tableSizeFor</span><span class=\"params\">(<span class=\"keyword\">int</span> cap)</span> </span>&#123;</span><br><span class=\"line\">  \t\t\t<span class=\"comment\">// 其实我没看懂这段位移 😄</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> n = cap - <span class=\"number\">1</span>;</span><br><span class=\"line\">        n |= n &gt;&gt;&gt; <span class=\"number\">1</span>;</span><br><span class=\"line\">        n |= n &gt;&gt;&gt; <span class=\"number\">2</span>;</span><br><span class=\"line\">        n |= n &gt;&gt;&gt; <span class=\"number\">4</span>;</span><br><span class=\"line\">        n |= n &gt;&gt;&gt; <span class=\"number\">8</span>;</span><br><span class=\"line\">        n |= n &gt;&gt;&gt; <span class=\"number\">16</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (n &lt; <span class=\"number\">0</span>) ? <span class=\"number\">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 将目标map的桶插入当前map中</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">putMapEntries</span><span class=\"params\">(Map&lt;? extends K, ? extends V&gt; m, <span class=\"keyword\">boolean</span> evict)</span> </span>&#123;</span><br><span class=\"line\">  \t\t\t<span class=\"comment\">// 获得bin（桶）的长度。</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> s = m.size();</span><br><span class=\"line\">  \t\t\t<span class=\"comment\">// 如果桶长度大0则进行复制，否则什么都不做。</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (s &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          \t<span class=\"comment\">// 如果当前位数的痛数组为空。也就是未初始化</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (table == <span class=\"keyword\">null</span>) &#123; <span class=\"comment\">// pre-size</span></span><br><span class=\"line\">             </span><br><span class=\"line\">                <span class=\"keyword\">float</span> ft = ((<span class=\"keyword\">float</span>)s / loadFactor) + <span class=\"number\">1.0F</span>;</span><br><span class=\"line\">                <span class=\"keyword\">int</span> t = ((ft &lt; (<span class=\"keyword\">float</span>)MAXIMUM_CAPACITY) ?</span><br><span class=\"line\">                         (<span class=\"keyword\">int</span>)ft : MAXIMUM_CAPACITY);</span><br><span class=\"line\">              \t<span class=\"comment\">// 如果 则指定的容量设置阈值</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (t &gt; threshold)</span><br><span class=\"line\">                    threshold = tableSizeFor(t);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//数组不为空，桶数量超过阈值就扩容</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s &gt; threshold)</span><br><span class=\"line\">                resize();</span><br><span class=\"line\">          \t<span class=\"comment\">// 增强循环为当前的table赋值。</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) &#123;</span><br><span class=\"line\">                K key = e.getKey();</span><br><span class=\"line\">                V value = e.getValue();</span><br><span class=\"line\">              \t<span class=\"comment\">// 和put调用的是一个方法。//先经过 hash() 计算位置，然后复制指定 map 的内容</span></span><br><span class=\"line\">                putVal(hash(key), key, value, <span class=\"keyword\">false</span>, evict);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 插入数据</span></span><br><span class=\"line\"><span class=\"comment\">     * Implements Map.put and related methods.</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> hash hash for key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key the key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value the value to put</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> onlyIfAbsent if true, don't change existing value</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> evict if false, the table is in creation mode.</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> previous value, or null if none</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">final</span> V <span class=\"title\">putVal</span><span class=\"params\">(<span class=\"keyword\">int</span> hash, K key, V value, <span class=\"keyword\">boolean</span> onlyIfAbsent,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                   <span class=\"keyword\">boolean</span> evict)</span> </span>&#123;</span><br><span class=\"line\">      \t<span class=\"comment\">// 声明临时变量 table 数组 p链表</span></span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class=\"keyword\">int</span> n, i;</span><br><span class=\"line\">        <span class=\"comment\">// 如果当前的桶是null，长度为0。就扩容一次。</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((tab = table) == <span class=\"keyword\">null</span> || (n = tab.length) == <span class=\"number\">0</span>)</span><br><span class=\"line\">          \t<span class=\"comment\">// 则n 指向最后一个桶的位置</span></span><br><span class=\"line\">            n = (tab = resize()).length;</span><br><span class=\"line\">      \t<span class=\"comment\">// 计算插入的位置有没有node， (n - 1) &amp;hash得到的是key所在的桶的头结点，如果节点不在这个桶。</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((p = tab[i = (n - <span class=\"number\">1</span>) &amp; hash]) == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 此时的i = 0 , 新建个节点并放进去</span></span><br><span class=\"line\">            tab[i] = newNode(hash, key, value, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123; </span><br><span class=\"line\">            <span class=\"comment\">//如果插入的位置有元素,就是p != null 被找到了。开始替换value流程。</span></span><br><span class=\"line\">            <span class=\"comment\">// 临时变量  e 被替换的元素</span></span><br><span class=\"line\">            Node&lt;K,V&gt; e; K k;</span><br><span class=\"line\">            <span class=\"comment\">//p 指向要插入的桶第一个 元素的位置，如果 p 的哈希值、键、值和要添加的一样。</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (p.hash == hash &amp;&amp;</span><br><span class=\"line\">                ((k = p.key) == key || (key != <span class=\"keyword\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                <span class=\"comment\">// e 指向 p</span></span><br><span class=\"line\">                e = p;</span><br><span class=\"line\">            <span class=\"comment\">// //如果key hash不一样，判断是否红黑树</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (p <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                <span class=\"comment\">// 放入树中 红黑树细节待续</span></span><br><span class=\"line\">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class=\"keyword\">this</span>, tab, hash, key, value);</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//否则从链表数组查找、替换。</span></span><br><span class=\"line\">                <span class=\"comment\">// 遍历这个桶所有的元素</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> binCount = <span class=\"number\">0</span>; ; ++binCount) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((e = p.next) == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                        p.next = newNode(hash, key, value, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">                        <span class=\"comment\">//当这个桶内链表个数大于等于 8，就要红黑树树形化</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class=\"number\">1</span>) <span class=\"comment\">// -1 for 1st</span></span><br><span class=\"line\">                            treeifyBin(tab, hash);</span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"comment\">//如果找到要替换的节点，就停止，此时 e 已经指向要被替换的节点</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                        ((k = e.key) == key || (key != <span class=\"keyword\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                        <span class=\"comment\">// 相等则跳出循环</span></span><br><span class=\"line\">                        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                    <span class=\"comment\">// 没找到。</span></span><br><span class=\"line\">                    p = e;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//存在要替换的节点</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (e != <span class=\"keyword\">null</span>) &#123; <span class=\"comment\">// existing mapping for key</span></span><br><span class=\"line\">                V oldValue = e.value;</span><br><span class=\"line\">                <span class=\"comment\">//替换，返回</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!onlyIfAbsent || oldValue == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                    <span class=\"comment\">// 新值 替换 旧值</span></span><br><span class=\"line\">                    e.value = value;</span><br><span class=\"line\">                afterNodeAccess(e);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ++modCount; <span class=\"comment\">// 修改计数器</span></span><br><span class=\"line\">        <span class=\"comment\">// 如果超出阈值，就得扩容</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (++size &gt; threshold)</span><br><span class=\"line\">            resize();</span><br><span class=\"line\">        afterNodeInsertion(evict);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t * 扩容</span></span><br><span class=\"line\"><span class=\"comment\">     * Initializes or doubles table size.  If null, allocates in</span></span><br><span class=\"line\"><span class=\"comment\">     * accord with initial capacity target held in field threshold.</span></span><br><span class=\"line\"><span class=\"comment\">     * Otherwise, because we are using power-of-two expansion, the</span></span><br><span class=\"line\"><span class=\"comment\">     * elements from each bin must either stay at same index, or move</span></span><br><span class=\"line\"><span class=\"comment\">     * with a power of two offset in the new table.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> the table</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取当前的table</span></span><br><span class=\"line\">        Node&lt;K,V&gt;[] oldTab = table;</span><br><span class=\"line\">        <span class=\"comment\">// 获取当前table的容量大小。</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> oldCap = (oldTab == <span class=\"keyword\">null</span>) ? <span class=\"number\">0</span> : oldTab.length;</span><br><span class=\"line\">        <span class=\"comment\">// 获取当前table的扩展阀值</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> oldThr = threshold;</span><br><span class=\"line\">        <span class=\"comment\">// 临时变量 新的容量、阀值。</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> newCap, newThr = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 原容量大于0</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (oldCap &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class=\"line\">                threshold = Integer.MAX_VALUE;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> oldTab;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//新的容量为旧的两倍</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((newCap = oldCap &lt;&lt; <span class=\"number\">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class=\"line\">                     oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class=\"line\">                <span class=\"comment\">//如果旧容量小于等于 16，新的阈值就是旧阈值的两倍</span></span><br><span class=\"line\">                newThr = oldThr &lt;&lt; <span class=\"number\">1</span>; <span class=\"comment\">// double threshold</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// //如果旧容量为 0 ，并且旧阈值&gt;0，说明之前创建了哈希表但没有添加元素</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (oldThr &gt; <span class=\"number\">0</span>) <span class=\"comment\">// initial capacity was placed in threshold</span></span><br><span class=\"line\">            <span class=\"comment\">// 初始化容量等于阈值</span></span><br><span class=\"line\">            newCap = oldThr;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;               <span class=\"comment\">// zero initial threshold signifies using defaults</span></span><br><span class=\"line\">            <span class=\"comment\">//旧容量、旧阈值都是0，说明还没创建哈希表，容量为默认容量，阈值为 容量*加载因子</span></span><br><span class=\"line\">            newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class=\"line\">            newThr = (<span class=\"keyword\">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 如果此时新的阈值为 0 ，就得用 新容量*加载因子 重计算一次</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newThr == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">float</span> ft = (<span class=\"keyword\">float</span>)newCap * loadFactor;</span><br><span class=\"line\">            newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class=\"keyword\">float</span>)MAXIMUM_CAPACITY ?</span><br><span class=\"line\">                      (<span class=\"keyword\">int</span>)ft : Integer.MAX_VALUE);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 覆盖当前扩展阀值</span></span><br><span class=\"line\">        threshold = newThr;</span><br><span class=\"line\">      </span><br><span class=\"line\">        <span class=\"comment\">// 创建新链表数组，容量是原来的两倍。newCap上面已经被赋值了。</span></span><br><span class=\"line\">        <span class=\"meta\">@SuppressWarnings</span>(&#123;<span class=\"string\">\"rawtypes\"</span>,<span class=\"string\">\"unchecked\"</span>&#125;)</span><br><span class=\"line\">        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class=\"keyword\">new</span> Node[newCap];</span><br><span class=\"line\">        table = newTab;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (oldTab != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//遍历复制</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class=\"line\">                Node&lt;K,V&gt; e;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((e = oldTab[j]) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    oldTab[j] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                    <span class=\"comment\">// 如果桶里面只有一个元素，next没有得情况下。</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (e.next == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                        <span class=\"comment\">// 直接放进去</span></span><br><span class=\"line\">                        newTab[e.hash &amp; (newCap - <span class=\"number\">1</span>)] = e;</span><br><span class=\"line\">                    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (e <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                         <span class=\"comment\">//如果是一个红黑树,红黑树相关的操作</span></span><br><span class=\"line\">                        ((TreeNode&lt;K,V&gt;)e).split(<span class=\"keyword\">this</span>, newTab, j, oldCap);</span><br><span class=\"line\">                    <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// preserve order</span></span><br><span class=\"line\">                        <span class=\"comment\">// 如果桶里面有元素。保留旧哈希表桶中链表的顺序</span></span><br><span class=\"line\">                        <span class=\"comment\">// 链表复制，JDK 1.8 扩容优化部分</span></span><br><span class=\"line\">                        Node&lt;K,V&gt; loHead = <span class=\"keyword\">null</span>, loTail = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                        Node&lt;K,V&gt; hiHead = <span class=\"keyword\">null</span>, hiTail = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                        Node&lt;K,V&gt; next;</span><br><span class=\"line\">                        <span class=\"comment\">//do-while 循环赋值给新哈希表</span></span><br><span class=\"line\">                        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                            next = e.next;</span><br><span class=\"line\">                            <span class=\"comment\">// 原索引</span></span><br><span class=\"line\">                            <span class=\"keyword\">if</span> ((e.hash &amp; oldCap) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (loTail == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                                    loHead = e;</span><br><span class=\"line\">                                <span class=\"keyword\">else</span></span><br><span class=\"line\">                                    loTail.next = e;</span><br><span class=\"line\">                                loTail = e;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"comment\">// 原索引 + oldCap</span></span><br><span class=\"line\">                            <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (hiTail == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                                    hiHead = e;</span><br><span class=\"line\">                                <span class=\"keyword\">else</span></span><br><span class=\"line\">                                    hiTail.next = e;</span><br><span class=\"line\">                                hiTail = e;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">while</span> ((e = next) != <span class=\"keyword\">null</span>);</span><br><span class=\"line\">                        <span class=\"comment\">// 将原索引放到哈希桶中</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (loTail != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                            loTail.next = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                            newTab[j] = loHead;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"comment\">// 将原索引 + oldCap 放到哈希桶中</span></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (hiTail != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                            hiTail.next = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                            newTab[j + oldCap] = hiHead;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> newTab;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// 查询</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">(Object key)</span> </span>&#123;</span><br><span class=\"line\">        Node&lt;K,V&gt; e;</span><br><span class=\"line\">        <span class=\"comment\">// 对 key 进行哈希操作</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (e = getNode(hash(key), key)) == <span class=\"keyword\">null</span> ? <span class=\"keyword\">null</span> : e.value;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Implements Map.get and related methods.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> hash hash for key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key the key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> the node, or null if none</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">final</span> Node&lt;K,V&gt; <span class=\"title\">getNode</span><span class=\"params\">(<span class=\"keyword\">int</span> hash, Object key)</span> </span>&#123; </span><br><span class=\"line\">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class=\"keyword\">int</span> n; K k;</span><br><span class=\"line\">        <span class=\"comment\">// tab = table) != null 数组桶不为null ，并赋值给临时桶数组 tab。</span></span><br><span class=\"line\">        <span class=\"comment\">// (n = tab.length) &gt; 0 桶的长度大于0 ，并赋值给临时桶长度 n。</span></span><br><span class=\"line\">        <span class=\"comment\">// (first = tab[(n - 1) &amp; hash]) != null 第一个桶里面有元素。</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((tab = table) != <span class=\"keyword\">null</span> &amp;&amp; (n = tab.length) &gt; <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">            (first = tab[(n - <span class=\"number\">1</span>) &amp; hash]) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 如果桶里面第一个元素key满足匹配条件。则直接返回</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (first.hash == hash &amp;&amp; <span class=\"comment\">// always check first node</span></span><br><span class=\"line\">                ((k = first.key) == key || (key != <span class=\"keyword\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> first;</span><br><span class=\"line\">            <span class=\"comment\">// 下一个节点非空判断</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((e = first.next) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 如果第一节点是树结构，则使用 getTreeNode 直接获取相应的数据</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (first <span class=\"keyword\">instanceof</span> TreeNode)</span><br><span class=\"line\">                    <span class=\"comment\">// 如果第一个元素是红黑树、暂时不深入。</span></span><br><span class=\"line\">                    <span class=\"keyword\">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class=\"line\">                <span class=\"comment\">// do while // 非树结构，循环节点判断 循环便利桶所有的key hash 找到则返回。</span></span><br><span class=\"line\">                <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                     <span class=\"comment\">// hash 相等并且 key 相同，则返回此节点</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (e.hash == hash &amp;&amp;</span><br><span class=\"line\">                        ((k = e.key) == key || (key != <span class=\"keyword\">null</span> &amp;&amp; key.equals(k))))</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> e;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">while</span> ((e = e.next) != <span class=\"keyword\">null</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 没找到。</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n","categories":["源码分析"],"tags":["Java","Java-Collecions-Framework","HashMap"]},{"title":"源码阅读-HashSet","url":"/posts/1743596067/","content":"<blockquote>\n<p>本章属于持续学习、长期更修。</p>\n</blockquote>\n<h2 id=\"HashSet\"><a href=\"#HashSet\" class=\"headerlink\" title=\"HashSet\"></a>HashSet</h2><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/hashSet/HashSet.png\"></p>\n<h3 id=\"特性\"><a href=\"#特性\" class=\"headerlink\" title=\"特性\"></a>特性</h3><ul>\n<li>HashSet不允许重复数据。</li>\n<li>HashSet不允许null，因为null也是可以重复的。</li>\n<li>HashSet不保证数据的插入顺序。</li>\n<li>HashSet不是线程安全的，如果想使用线程的安全的HashSet可以通过<code>Collections.synchronizedSet</code> 来获取线程安全的HashSet。也可以使用<code>CopyOnWriteArraySet</code>。但是性能会有很大的损失。</li>\n<li>HashSet迭代器方法是快速失败的。因此，在创建迭代器之后对集合进行任何结构修改都会抛出ConcurrentModificationException。</li>\n<li>HashSet支持泛型，这是在运行时避免ClassCastException的推荐方法。</li>\n<li>HashSet使用<code>HashMap</code>存储元素，因此对象应该提供hashCode（）和equals（）方法的良好实现，以避免不必要的结果。</li>\n</ul>\n<h3 id=\"源码分析\"><a href=\"#源码分析\" class=\"headerlink\" title=\"源码分析\"></a>源码分析</h3>","categories":["源码分析"],"tags":["Java","Java-Collecions-Framework","HashSet"]},{"title":"面试题-交换两个变量的值","url":"/posts/3370594675/","content":"<blockquote>\n<p>刚去杭州面试的第二家公司，做笔试的时候的时候遇到的。最近几天在整理以前的笔记发现了。简单记录下。</p>\n</blockquote>\n<h3 id=\"互换两个变量的值\"><a href=\"#互换两个变量的值\" class=\"headerlink\" title=\"互换两个变量的值\"></a>互换两个变量的值</h3><blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span> a=<span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> b=<span class=\"number\">12</span>;</span><br><span class=\"line\"><span class=\"comment\">// 通过两个变量之间的运算输出结果 a = 12 b = 10</span></span><br></pre></td></tr></table></figure>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">swapTest1</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> a=<span class=\"number\">10</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> b=<span class=\"number\">12</span>;</span><br><span class=\"line\">\t\ta=a^b; <span class=\"comment\">//a=1010^b=1100;</span></span><br><span class=\"line\">\t\tb=a^b; <span class=\"comment\">//a=0110^b=1100;</span></span><br><span class=\"line\">\t\ta=a^b; <span class=\"comment\">//a=0110^b=1010;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//a=1100=12;b=1010;</span></span><br><span class=\"line\">\t\tSystem.out.println(a);</span><br><span class=\"line\">\t\tSystem.out.println(b);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">swapTest2</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> a = <span class=\"number\">10</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> b = <span class=\"number\">12</span>;</span><br><span class=\"line\">\t\ta = a + b; <span class=\"comment\">// 22 = 10 + 12</span></span><br><span class=\"line\">\t\tb = a - b; <span class=\"comment\">// 10 = 22 - 12</span></span><br><span class=\"line\">\t\ta = a - b; <span class=\"comment\">// 12 = 22 - 10</span></span><br><span class=\"line\">\t\tSystem.out.println(a);</span><br><span class=\"line\">\t\tSystem.out.println(b);</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n","categories":["面试"],"tags":["Java"]},{"title":"Spring-Upgrade-SpringBoot","url":"/posts/3251840774/","content":"<blockquote>\n<p>2018年在公司负责了一段时间老项目改造升级工作。因此记录下折腾的过程。</p>\n</blockquote>\n<ul>\n<li>Spring boot 最近挺火的，之前的工作并没有机会去实战。但是即使不使用Spring boot 也是可以做零配置的。</li>\n</ul>\n<h3 id=\"约定大于配置\"><a href=\"#约定大于配置\" class=\"headerlink\" title=\"约定大于配置\"></a>约定大于配置</h3><ul>\n<li>servlet3.*的规范已经支持不使用web.xml了。</li>\n<li>annotation的配置方式在Spring其实也存在很久了。 </li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"直奔主题\"><a href=\"#直奔主题\" class=\"headerlink\" title=\"直奔主题\"></a>直奔主题</h3><h4 id=\"代码配置web-xml\"><a href=\"#代码配置web-xml\" class=\"headerlink\" title=\"代码配置web.xml\"></a>代码配置web.xml</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">org.springframework.web.WebApplicationInitializer</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>实现这个接口,Override onStartup方法，就拿到钥匙了。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.config;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.FilterRegistration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletRegistration;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.WebApplicationInitializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.context.support.AnnotationConfigWebApplicationContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.filter.CharacterEncodingFilter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.filter.HiddenHttpMethodFilter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.DispatcherServlet;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learn.config.app.WebAppConfig;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 基于代码可以不使用web.xml</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WebProjectConfigInitializer</span>  <span class=\"keyword\">implements</span> <span class=\"title\">WebApplicationInitializer</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String CHARACTER_ENCODING = <span class=\"string\">\"UTF-8\"</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> String DISPATCHER_SERVLET_NAME = <span class=\"string\">\"dispatcher\"</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> String DISPATCHER_SERVLET_MAPPING = <span class=\"string\">\"/\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> String ENCODEING_FILTER_NAME = <span class=\"string\">\"encodefilter\"</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> String ENCODEING_FILTER_MAPPING = <span class=\"string\">\"/*\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onStartup</span><span class=\"params\">(ServletContext servletContext)</span> <span class=\"keyword\">throws</span> ServletException </span>&#123;</span><br><span class=\"line\">\t\tinitializeSpringMVCConfig(servletContext); <span class=\"comment\">//启动spring mvc</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 注册spring mvc</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@param</span> container</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">initializeSpringMVCConfig</span><span class=\"params\">(ServletContext container)</span> <span class=\"keyword\">throws</span> ServletException </span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// 编码过滤器</span></span><br><span class=\"line\">\t\tCharacterEncodingFilter encodingFilter = <span class=\"keyword\">new</span> CharacterEncodingFilter();</span><br><span class=\"line\">\t\tencodingFilter.setForceEncoding(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\tencodingFilter.setEncoding(CHARACTER_ENCODING);</span><br><span class=\"line\">\t\t<span class=\"comment\">//配置Spring提供的字符编码过滤器</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//第一个参数 指定字符编码编码</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//第二个参数 是否强制要求响应包编码与请求包相同，false表示如果响应包设置了自己编码则不强制修改</span></span><br><span class=\"line\">        FilterRegistration.Dynamic filter = container.addFilter(ENCODEING_FILTER_NAME, encodingFilter);</span><br><span class=\"line\">        <span class=\"comment\">// 解决HTTP PUT请求Spring无法获取请求参数的问题</span></span><br><span class=\"line\">        \t\t\t\t\t\t   filter = container.addFilter(<span class=\"string\">\"hiddenHttpMethodFilter\"</span>, <span class=\"keyword\">new</span> HiddenHttpMethodFilter());</span><br><span class=\"line\">        <span class=\"comment\">//配置过滤器的过滤路径</span></span><br><span class=\"line\">        filter.addMappingForUrlPatterns(<span class=\"keyword\">null</span>, <span class=\"keyword\">true</span>, ENCODEING_FILTER_MAPPING);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\">// Create the spring rest servlet's Spring application context</span></span><br><span class=\"line\">\t\tAnnotationConfigWebApplicationContext dispatcherContext = <span class=\"keyword\">new</span> AnnotationConfigWebApplicationContext();</span><br><span class=\"line\">\t\tdispatcherContext.register(WebAppConfig<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Register and map the spring rest servlet</span></span><br><span class=\"line\">\t\tServletRegistration.Dynamic dispatcher = container.addServlet(DISPATCHER_SERVLET_NAME,</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">new</span> DispatcherServlet(dispatcherContext));</span><br><span class=\"line\">\t\t<span class=\"comment\">//启动顺序</span></span><br><span class=\"line\">\t\tdispatcher.setLoadOnStartup(<span class=\"number\">1</span>);</span><br><span class=\"line\">\t\tdispatcher.setAsyncSupported(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">\t\t<span class=\"comment\">//配置映射路径</span></span><br><span class=\"line\">\t\tdispatcher.addMapping(DISPATCHER_SERVLET_MAPPING);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"解决Maven-War提示找不到web-xml编译错误。\"><a href=\"#解决Maven-War提示找不到web-xml编译错误。\" class=\"headerlink\" title=\"解决Maven War提示找不到web.xml编译错误。\"></a>解决Maven War提示找不到web.xml编译错误。</h4><ul>\n<li>注意如果你是Mavan项目,默认情况下war项目是需要找到web.xml的。</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-war-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">\t    <span class=\"comment\">&lt;!-- failOnMissingWebXml false 可以没有web.xml --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">failOnMissingWebXml</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">failOnMissingWebXml</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"comment\">&lt;!-- 暂时不适用其他模板页面</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;overlays&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;overlay&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t&lt;groupId&gt;org.cn.z201.views&lt;/groupId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t&lt;artifactId&gt;ssh-views&lt;/artifactId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t&lt;/overlay&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&lt;/overlays&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>诺，在war打包插件中配置下就好了。</li>\n</ul>\n<h4 id=\"主角WebAppConfig-SpringMVC配置启动类。\"><a href=\"#主角WebAppConfig-SpringMVC配置启动类。\" class=\"headerlink\" title=\"主角WebAppConfig SpringMVC配置启动类。\"></a>主角WebAppConfig SpringMVC配置启动类。</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>继承这个类,里面有很多方法给你重写。这其实跟xml配置非常相似了。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.config.app;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Locale;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.logging.log4j.LogManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.logging.log4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.EnableAspectJAutoProxy;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.i18n.LocaleChangeInterceptor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learn.config.app.support.BeetlConfiguration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learn.config.app.support.DataSourceConfiguration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learn.config.app.support.EhCacheConfiguration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learn.config.app.support.MultipartResolverConfiguration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learn.config.app.support.SchedulingConfiguration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learn.config.app.support.SwaggerConfiguration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learn.config.app.support.ValidatorConfiguration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.z201.learn.core.interceptor.LoginInterceptor;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Import;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.http.MediaType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.scheduling.annotation.EnableScheduling;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  <span class=\"doctag\">@Configuration</span>，用于表示这个类是一个配置类，用于配置Spring的相关信息  </span></span><br><span class=\"line\"><span class=\"comment\"> * \t\t类似于spring配置文件，负责注册bean，对应的提供了<span class=\"doctag\">@Bean</span>注解。</span></span><br><span class=\"line\"><span class=\"comment\"> * \t\t需要org.springframework.web.context.support.AnnotationConfigWebApplicationContext注册到容器中。</span></span><br><span class=\"line\"><span class=\"comment\"> *  <span class=\"doctag\">@EnableWebMvc</span> 启用MVC Java配置（<span class=\"doctag\">@Controller</span>等各种注解）</span></span><br><span class=\"line\"><span class=\"comment\"> *  <span class=\"doctag\">@ComponentScan</span> ： 注解类查找规则定义 &lt;context:component-scan/&gt; 组件扫描，</span></span><br><span class=\"line\"><span class=\"comment\"> * \t\t在basePackages指定的目录下扫描被<span class=\"doctag\">@Controller</span>、<span class=\"doctag\">@Service</span>、<span class=\"doctag\">@Component</span>等注解注册的组件</span></span><br><span class=\"line\"><span class=\"comment\"> *  <span class=\"doctag\">@EnableAsync</span> 注解的意思是可以异步执行，就是开启多线程的意思。</span></span><br><span class=\"line\"><span class=\"comment\"> *\t<span class=\"doctag\">@EnableAspectJAutoProxy</span>，启用切面自动代理，用于AOP 激活Aspect自动代理 &lt;aop:aspectj-autoproxy/&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> *  <span class=\"doctag\">@EnableCaching</span> ：启用缓存注解  &lt;cache:annotation-driven/&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> *  <span class=\"doctag\">@EnableScheduling</span> 启动定时任务注解</span></span><br><span class=\"line\"><span class=\"comment\"> *  <span class=\"doctag\">@EnableTransactionManagement</span> ： 启用注解式事务管理 &lt;tx:annotation-driven /&gt; 启用注解事务，即可以使用<span class=\"doctag\">@Transactional</span>注解来控制事务</span></span><br><span class=\"line\"><span class=\"comment\"> *  <span class=\"doctag\">@EnableWebMvcSecurity</span> ： 启用springSecurity安全验证</span></span><br><span class=\"line\"><span class=\"comment\"> *\t<span class=\"doctag\">@Import</span>、 <span class=\"doctag\">@ImportResource</span> 引入指定的配置类，我们引入了Spring容器配置类和数据源事务配置类</span></span><br><span class=\"line\"><span class=\"comment\"> *\t<span class=\"doctag\">@PropertySource</span>，加载指定的配置文件，配置文件内容会加载入Environment中等待调用</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableWebMvc</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAsync</span></span><br><span class=\"line\"><span class=\"meta\">@EnableScheduling</span></span><br><span class=\"line\"><span class=\"meta\">@EnableTransactionManagement</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAspectJAutoProxy</span>(proxyTargetClass = <span class=\"keyword\">true</span>)</span><br><span class=\"line\"><span class=\"meta\">@Import</span>( &#123; DataSourceConfiguration<span class=\"class\">.<span class=\"keyword\">class</span> ,</span></span><br><span class=\"line\"><span class=\"class\">\t       <span class=\"title\">BeetlConfiguration</span>.<span class=\"title\">class</span>,</span></span><br><span class=\"line\"><span class=\"class\">\t\t   <span class=\"title\">MultipartResolverConfiguration</span>.<span class=\"title\">class</span>,</span></span><br><span class=\"line\"><span class=\"class\">\t\t   <span class=\"title\">SwaggerConfiguration</span>.<span class=\"title\">class</span> ,</span></span><br><span class=\"line\"><span class=\"class\">\t\t   <span class=\"title\">EhCacheConfiguration</span>.<span class=\"title\">class</span> ,</span></span><br><span class=\"line\"><span class=\"class\">\t\t   <span class=\"title\">SchedulingConfiguration</span>.<span class=\"title\">class</span>,</span></span><br><span class=\"line\"><span class=\"class\">\t\t   <span class=\"title\">ValidatorConfiguration</span>.<span class=\"title\">class</span>&#125;)</span></span><br><span class=\"line\"><span class=\"class\">@<span class=\"title\">PropertySource</span>(<span class=\"title\">value</span> </span>= &#123;<span class=\"string\">\"classpath:config.properties\"</span>&#125;,ignoreResourceNotFound = <span class=\"keyword\">true</span>)</span><br><span class=\"line\"><span class=\"meta\">@ComponentScan</span>(basePackages = &#123; <span class=\"string\">\"cn.z201\"</span> &#125;)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WebAppConfig</span> <span class=\"keyword\">extends</span> <span class=\"title\">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger  LOGGER = LogManager.getLogger(WebAppConfig<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">WebAppConfig</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tLOGGER.info(<span class=\"string\">\"[Initialize WebAppConfig]\"</span>);</span><br><span class=\"line\">\t    Locale.setDefault(Locale.US);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t *  静态资源映射</span></span><br><span class=\"line\"><span class=\"comment\">\t * addResourceHandler()方法指定url，该url后连接静态文件，对应着addResourceLoaction()方法目录所对应的静态文件</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addResourceHandlers</span><span class=\"params\">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">super</span>.addResourceHandlers(registry);</span><br><span class=\"line\">    \tLOGGER.info(<span class=\"string\">\"[Initialize addResourceHandlers]\"</span>);</span><br><span class=\"line\">    \tregistry.addResourceHandler(<span class=\"string\">\"/static/**\"</span>)</span><br><span class=\"line\">    \t\t\t.addResourceLocations(<span class=\"string\">\"/static/\"</span>)</span><br><span class=\"line\">    \t\t\t.setCachePeriod(<span class=\"number\">5000</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 将对于静态资源的请求转发到Servlet容器的默认处理静态资源的servlet</span></span><br><span class=\"line\"><span class=\"comment\">     * 因为将spring的拦截模式设置为\"/\"时会对静态资源进行拦截</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">configureDefaultServletHandling</span><span class=\"params\">(DefaultServletHandlerConfigurer configurer)</span> </span>&#123;</span><br><span class=\"line\">        configurer.enable();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 添加拦截器</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addInterceptors</span><span class=\"params\">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 多个拦截器组成一个拦截器链</span></span><br><span class=\"line\">        <span class=\"comment\">// addPathPatterns 用于添加拦截规则</span></span><br><span class=\"line\">        <span class=\"comment\">// excludePathPatterns 用户排除拦截</span></span><br><span class=\"line\">        registry.addInterceptor(<span class=\"keyword\">new</span> LoginInterceptor()).addPathPatterns(<span class=\"string\">\"/**\"</span>).excludePathPatterns(<span class=\"string\">\"/login\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.addInterceptors(registry);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 本地国际化</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"meta\">@Bean</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> LocaleChangeInterceptor <span class=\"title\">localeChangeInterceptor</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tLOGGER.info(<span class=\"string\">\"[Initialize LocaleChangeInterceptor]\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> LocaleChangeInterceptor();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * json、Jsonp消息转换适配器，用于支持RequestBody、ResponseBody</span></span><br><span class=\"line\"><span class=\"comment\">     * Json、Jsonp Message Converter , Support For RequestBody、ResponseBody</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> MappingJackson2HttpMessageConverter <span class=\"title\">mappingJackson2HttpMessageConverter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    \tLOGGER.info(<span class=\"string\">\"[Initialize MappingJackson2HttpMessageConverter]\"</span>);</span><br><span class=\"line\">    \tMappingJackson2HttpMessageConverter mappingJackson2HttpMessageConverter = <span class=\"keyword\">new</span> MappingJackson2HttpMessageConverter();</span><br><span class=\"line\">\t    \tList&lt;MediaType&gt; mediaType = <span class=\"keyword\">new</span> ArrayList&lt;MediaType&gt;();</span><br><span class=\"line\">\t    \tmediaType.add(MediaType.APPLICATION_JSON_UTF8);</span><br><span class=\"line\">\t    \tmappingJackson2HttpMessageConverter.setSupportedMediaTypes(mediaType);</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> mappingJackson2HttpMessageConverter;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>恩，我这里的其他配置是使用其他的Bean单独配置的。一个一个来吧。</li>\n</ul>\n<h4 id=\"其他配置\"><a href=\"#其他配置\" class=\"headerlink\" title=\"其他配置\"></a>其他配置</h4><h5 id=\"1-DataSourceConfiguration-数据源-没有使用ORM框架直接用jdbcTemplate\"><a href=\"#1-DataSourceConfiguration-数据源-没有使用ORM框架直接用jdbcTemplate\" class=\"headerlink\" title=\"1. DataSourceConfiguration 数据源 没有使用ORM框架直接用jdbcTemplate\"></a>1. DataSourceConfiguration 数据源 没有使用ORM框架直接用jdbcTemplate</h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.config.app.support;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.sql.SQLException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.sql.DataSource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.logging.log4j.LogManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.logging.log4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.jdbc.datasource.DataSourceTransactionManager;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DataSourceConfiguration</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger  LOGGER = LogManager.getLogger(DataSourceConfiguration<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.url&#125;\"</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String url;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.username&#125;\"</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String username;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.password&#125;\"</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String password;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.maxActive&#125;\"</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">int</span> maxActive;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.initialSize&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer initialSize;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.minIdle&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer minIdle;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.maxWait&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer maxWait;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.timeBetweenEvictionRunsMillis&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer timeBetweenEvictionRunsMillis;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.minEvictableIdleTimeMillis&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer minEvictableIdleTimeMillis;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.validationQuery&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String validationQuery;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.testWhileIdle&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Boolean testWhileIdle;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.testOnBorrow&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Boolean testOnBorrow;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.testOnReturn&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Boolean testOnReturn;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.poolPreparedStatements&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Boolean poolPreparedStatements;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.maxPoolPreparedStatementPerConnectionSize&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer maxPoolPreparedStatementPerConnectionSize;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;db.filters&#125;\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String filters;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 事务管理器</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> DataSourceTransactionManager <span class=\"title\">dataSourceTransactionManager</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        DataSourceTransactionManager dataSourceTransactionManager = <span class=\"keyword\">new</span> DataSourceTransactionManager();</span><br><span class=\"line\">        dataSourceTransactionManager.setDataSource(dataSource());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dataSourceTransactionManager;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * SpringJDBC Template</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> JdbcTemplate <span class=\"title\">jdbcTemplate</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> JdbcTemplate(dataSource());</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">    </span><br><span class=\"line\">\t<span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> DataSource <span class=\"title\">dataSource</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t\tLOGGER.info(<span class=\"string\">\"[Initialize DataSourceConfiguration]\"</span>);</span><br><span class=\"line\">    \tDruidDataSource dataSource = <span class=\"keyword\">new</span> DruidDataSource();</span><br><span class=\"line\">    \tdataSource.setUsername(<span class=\"keyword\">this</span>.username);</span><br><span class=\"line\">    \tdataSource.setPassword(<span class=\"keyword\">this</span>.password);</span><br><span class=\"line\">    \tdataSource.setUrl(<span class=\"keyword\">this</span>.url);</span><br><span class=\"line\"></span><br><span class=\"line\">        dataSource.setInitialSize(initialSize);     <span class=\"comment\">//定义初始连接数</span></span><br><span class=\"line\">        dataSource.setMinIdle(minIdle);             <span class=\"comment\">//最小空闲</span></span><br><span class=\"line\">        dataSource.setMaxActive(maxActive);         <span class=\"comment\">//定义最大连接数</span></span><br><span class=\"line\">        dataSource.setMaxWait(maxWait);             <span class=\"comment\">//最长等待时间</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span></span><br><span class=\"line\">        dataSource.setTimeBetweenEvictionRunsMillis(timeBetweenEvictionRunsMillis);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 配置一个连接在池中最小生存的时间，单位是毫秒</span></span><br><span class=\"line\">        dataSource.setMinEvictableIdleTimeMillis(minEvictableIdleTimeMillis);</span><br><span class=\"line\">        <span class=\"comment\">// 用来检测连接是否有效的sql，要求是一个查询语句。 如果validationQuery为null，testOnBorrow、testOnReturn、 </span></span><br><span class=\"line\">\t\t<span class=\"comment\">// testWhileIdle都不会其作用。在mysql中通常为select 'x'，在oracle中通常为 select 1 from dual --&gt;</span></span><br><span class=\"line\">        dataSource.setValidationQuery(validationQuery);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// 建议配置为true，不影响性能，并且保证安全性。 申请连接的时候检测，如果空闲时间大于 timeBetweenEvictionRunsMillis， </span></span><br><span class=\"line\">\t\t<span class=\"comment\">// 执行validationQuery检测连接是否有效。</span></span><br><span class=\"line\">        dataSource.setTestWhileIdle(testWhileIdle);</span><br><span class=\"line\">        <span class=\"comment\">// 申请连接时执行validationQuery检测连接是否有效， 做了这个配置会降低性能。</span></span><br><span class=\"line\">        dataSource.setTestOnBorrow(testOnBorrow);</span><br><span class=\"line\">        <span class=\"comment\">//归还连接时执行validationQuery检测连接是否有效， 做了这个配置会降低性能</span></span><br><span class=\"line\">        dataSource.setTestOnReturn(testOnReturn); </span><br><span class=\"line\"></span><br><span class=\"line\">    \t<span class=\"comment\">// 是否缓存preparedStatement，也就是PSCache。 PSCache对支持游标的数据库性能提升巨大，比如说oracle。 </span></span><br><span class=\"line\">\t\t<span class=\"comment\">//在mysql5.5以下的版本中没有PSCache功能，建议关闭掉。 5.5及以上版本有PSCache，建议开启。</span></span><br><span class=\"line\">        dataSource.setPoolPreparedStatements(poolPreparedStatements);</span><br><span class=\"line\">        dataSource.setMaxPoolPreparedStatementPerConnectionSize(maxPoolPreparedStatementPerConnectionSize);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            dataSource.setFilters(filters);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (SQLException e) &#123;</span><br><span class=\"line\">        \tLOGGER.error(<span class=\"string\">\"[Error DataSourceConfiguration ] &#123;&#125;\"</span>,e.getSQLState());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> dataSource;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"2-BeetlConfiguration-页面模板引擎\"><a href=\"#2-BeetlConfiguration-页面模板引擎\" class=\"headerlink\" title=\"2. BeetlConfiguration   页面模板引擎\"></a>2. BeetlConfiguration   页面模板引擎</h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.config.app.support;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.logging.log4j.LogManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.logging.log4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.beetl.ext.spring.BeetlGroupUtilConfiguration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.beetl.ext.spring.BeetlSpringViewResolver;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.core.io.ClassPathResource;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BeetlConfiguration</span></span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger  LOGGER = LogManager.getLogger(BeetlConfiguration<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">-\t * 配置试图模板引擎 </span></span><br><span class=\"line\"><span class=\"comment\">-\t */</span></span><br><span class=\"line\">\t<span class=\"meta\">@Bean</span>(initMethod = <span class=\"string\">\"init\"</span>, name = <span class=\"string\">\"beetlConfig\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> BeetlGroupUtilConfiguration <span class=\"title\">beetlConfig</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tLOGGER.info(<span class=\"string\">\"[Initialize BeetlGroupUtilConfiguration]\"</span>);</span><br><span class=\"line\">        BeetlGroupUtilConfiguration beetlGroupUtilConfiguration = <span class=\"keyword\">new</span> BeetlGroupUtilConfiguration();</span><br><span class=\"line\">        <span class=\"comment\">// 如果需要配置 beetl 相关功能，就传入beetl的配置文件</span></span><br><span class=\"line\">        <span class=\"comment\">// 模板的位置就在 beetl.properties 中配置</span></span><br><span class=\"line\">        beetlGroupUtilConfiguration.setConfigFileResource(<span class=\"keyword\">new</span> ClassPathResource(<span class=\"string\">\"beetl.properties\"</span>));</span><br><span class=\"line\">        <span class=\"comment\">// 或简单的方式就是使用默认配置文件，用下面的代码设置模板位置</span></span><br><span class=\"line\">        beetlGroupUtilConfiguration.setRoot(<span class=\"string\">\"/\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> beetlGroupUtilConfiguration;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">\t<span class=\"meta\">@Bean</span>(name = <span class=\"string\">\"beetlSpringViewResolver\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> BeetlSpringViewResolver <span class=\"title\">beetlViewResolver</span><span class=\"params\">(BeetlGroupUtilConfiguration beetlConfig)</span> </span>&#123;</span><br><span class=\"line\">        BeetlSpringViewResolver beetlSpringViewResolver = <span class=\"keyword\">new</span> BeetlSpringViewResolver();</span><br><span class=\"line\">\t       beetlSpringViewResolver.setContentType(<span class=\"string\">\"text/html;charset=UTF-8\"</span>); <span class=\"comment\">// 设置编码</span></span><br><span class=\"line\">\t       beetlSpringViewResolver.setOrder(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t       beetlSpringViewResolver.setSuffix(<span class=\"string\">\".html\"</span>);</span><br><span class=\"line\">\t       beetlSpringViewResolver.setConfig(beetlConfig);</span><br><span class=\"line\">       <span class=\"keyword\">return</span> beetlSpringViewResolver;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"3-MultipartResolverConfiguration-上传插件\"><a href=\"#3-MultipartResolverConfiguration-上传插件\" class=\"headerlink\" title=\"3.  MultipartResolverConfiguration   上传插件\"></a>3.  MultipartResolverConfiguration   上传插件</h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.config.app.support;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.logging.log4j.LogManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.logging.log4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.multipart.commons.CommonsMultipartResolver;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MultipartResolverConfiguration</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger  LOGGER = LogManager.getLogger(MultipartResolverConfiguration<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span>(name=<span class=\"string\">\"multipartResolver\"</span>)  </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> CommonsMultipartResolver <span class=\"title\">commonsMultipartResolver</span><span class=\"params\">()</span></span>&#123;  </span><br><span class=\"line\">    \tLOGGER.info(<span class=\"string\">\"[Initialize CommonsMultipartResolver]\"</span>);</span><br><span class=\"line\">    \tCommonsMultipartResolver commonsMultipartResolver = <span class=\"keyword\">new</span> CommonsMultipartResolver();</span><br><span class=\"line\">    \t\tcommonsMultipartResolver.setDefaultEncoding(<span class=\"string\">\"utf-8\"</span>);     <span class=\"comment\">//&lt;!--编码为uft-8 --&gt;</span></span><br><span class=\"line\">    \t\tcommonsMultipartResolver.setMaxUploadSize(<span class=\"number\">104666600</span>);     <span class=\"comment\">//&lt;!-- 设置最大上传文件大小为 --&gt;</span></span><br><span class=\"line\">    \t\tcommonsMultipartResolver.setMaxInMemorySize(<span class=\"number\">1046666000</span>);  <span class=\"comment\">//&lt;!-- 设置最大上传文件在内存中的大小 --&gt;</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> commonsMultipartResolver;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"5-SwaggerConfiguration-API\"><a href=\"#5-SwaggerConfiguration-API\" class=\"headerlink\" title=\"5 .SwaggerConfiguration API\"></a>5 .SwaggerConfiguration API</h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.config.app.support;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.logging.log4j.LogManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.logging.log4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.Sets;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.ApiOperation;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.service.ApiInfo;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.service.Contact;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class=\"line\"><span class=\"keyword\">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableSwagger</span>2</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SwaggerConfiguration</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger  LOGGER = LogManager.getLogger(SwaggerConfiguration<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Docket <span class=\"title\">createApi</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tLOGGER.info(<span class=\"string\">\"[Initialize SwaggerConfiguration]\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class=\"line\">        \t\t.produces(Sets.newHashSet(<span class=\"string\">\"application/json\"</span>, <span class=\"string\">\"application/xml\"</span>))</span><br><span class=\"line\">                .consumes(Sets.newHashSet(<span class=\"string\">\"application/json\"</span>, <span class=\"string\">\"application/xml\"</span>))</span><br><span class=\"line\">                .protocols(Sets.newHashSet(<span class=\"string\">\"http\"</span>, <span class=\"string\">\"https\"</span>))</span><br><span class=\"line\">        \t\t.forCodeGeneration(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">                .apiInfo(apiInfo()) </span><br><span class=\"line\">                .select()               <span class=\"comment\">// 选择那些路径和api会生成document</span></span><br><span class=\"line\">                .apis(RequestHandlerSelectors.withMethodAnnotation(ApiOperation<span class=\"class\">.<span class=\"keyword\">class</span>))  //扫描注解</span></span><br><span class=\"line\"><span class=\"class\">//                .<span class=\"title\">apis</span>(<span class=\"title\">RequestHandlerSelectors</span>.<span class=\"title\">basePackage</span>(<span class=\"title\">ApiPackage</span>.<span class=\"title\">class</span>.<span class=\"title\">getPackage</span>().<span class=\"title\">getName</span>().<span class=\"title\">trim</span>())) //扫描包路</span></span><br><span class=\"line\"><span class=\"class\">                .<span class=\"title\">paths</span>(<span class=\"title\">PathSelectors</span>.<span class=\"title\">any</span>()) // 对所有路径进行监控</span></span><br><span class=\"line\"><span class=\"class\">                .<span class=\"title\">build</span>()</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> ApiInfo <span class=\"title\">apiInfo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    \tApiInfo apiInfo= <span class=\"keyword\">new</span> ApiInfoBuilder()</span><br><span class=\"line\">    \t\t\t .title(<span class=\"string\">\"API管理\"</span>)</span><br><span class=\"line\">                 .description(<span class=\"string\">\"https://my.oschina.net/z201/blog\"</span>)</span><br><span class=\"line\">                 .termsOfServiceUrl(<span class=\"string\">\"https://my.oschina.net/z201/blog\"</span>)</span><br><span class=\"line\">                 .contact(<span class=\"keyword\">new</span> Contact(<span class=\"string\">\"自己动手丰衣足食\"</span>,<span class=\"string\">\"\"</span>,<span class=\"string\">\"https://my.oschina.net/z201/blog\"</span>))</span><br><span class=\"line\">                 .version(<span class=\"string\">\"1.0\"</span>)</span><br><span class=\"line\">                 .build();</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> apiInfo;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"6-EhCacheConfiguration-缓存配置\"><a href=\"#6-EhCacheConfiguration-缓存配置\" class=\"headerlink\" title=\"6. EhCacheConfiguration 缓存配置\"></a>6. EhCacheConfiguration 缓存配置</h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.config.app.support;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.cache.ehcache.EhCacheCacheManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.cache.ehcache.EhCacheManagerFactoryBean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.core.io.ClassPathResource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> net.sf.ehcache.CacheManager;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableCaching</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EhCacheConfiguration</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * EhCache的配置</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> EhCacheCacheManager <span class=\"title\">cacheManager</span><span class=\"params\">(CacheManager cacheManager)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> EhCacheCacheManager(cacheManager);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * EhCache的配置</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> EhCacheManagerFactoryBean <span class=\"title\">ehcache</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        EhCacheManagerFactoryBean ehCacheManagerFactoryBean = <span class=\"keyword\">new</span> EhCacheManagerFactoryBean();</span><br><span class=\"line\">        ehCacheManagerFactoryBean.setConfigLocation(<span class=\"keyword\">new</span> ClassPathResource(<span class=\"string\">\"ehcache.xml\"</span>));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ehCacheManagerFactoryBean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"7-SchedulingConfiguration-启动定时任务-Spring-task\"><a href=\"#7-SchedulingConfiguration-启动定时任务-Spring-task\" class=\"headerlink\" title=\"7 . SchedulingConfiguration 启动定时任务 Spring task\"></a>7 . SchedulingConfiguration 启动定时任务 Spring task</h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.config.app.support;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Executors;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.scheduling.annotation.SchedulingConfigurer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.scheduling.config.ScheduledTaskRegistrar;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SchedulingConfiguration</span> <span class=\"keyword\">implements</span> <span class=\"title\">SchedulingConfigurer</span></span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">configureTasks</span><span class=\"params\">(ScheduledTaskRegistrar taskRegistrar)</span> </span>&#123;</span><br><span class=\"line\">\t\ttaskRegistrar.setScheduler(taskExecutor());\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Bean</span>(destroyMethod=<span class=\"string\">\"shutdown\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Executor <span class=\"title\">taskExecutor</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Executors.newScheduledThreadPool(<span class=\"number\">10</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"8-ValidatorConfiguration-验证框架配置\"><a href=\"#8-ValidatorConfiguration-验证框架配置\" class=\"headerlink\" title=\"8 . ValidatorConfiguration 验证框架配置\"></a>8 . ValidatorConfiguration 验证框架配置</h5><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.learn.config.app.support;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.logging.log4j.LogManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.logging.log4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.hibernate.validator.HibernateValidator;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.support.ReloadableResourceBundleMessageSource;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.validation.beanvalidation.LocalValidatorFactoryBean;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ValidatorConfiguration</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger  LOGGER = LogManager.getLogger(ValidatorConfiguration<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">\t   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 支持校验 HibernateValidator</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> ValidatorConfiguration</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span>(<span class=\"string\">\"validator\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> LocalValidatorFactoryBean <span class=\"title\">localValidatorFactoryBean</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    \tLOGGER.info(<span class=\"string\">\"[Initialize ValidatorConfiguration]\"</span>);</span><br><span class=\"line\">    \tLocalValidatorFactoryBean localValidatorFactoryBean = <span class=\"keyword\">new</span> LocalValidatorFactoryBean();</span><br><span class=\"line\">    \tlocalValidatorFactoryBean.setProviderClass(HibernateValidator<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">    \tlocalValidatorFactoryBean.setValidationMessageSource(reloadableResourceBundleMessageSource());</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> LocalValidatorFactoryBean();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@Bean</span>(<span class=\"string\">\"messageSource\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ReloadableResourceBundleMessageSource <span class=\"title\">reloadableResourceBundleMessageSource</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    \tReloadableResourceBundleMessageSource reloadableResourceBundleMessageSource = <span class=\"keyword\">new</span> ReloadableResourceBundleMessageSource();</span><br><span class=\"line\">    \treloadableResourceBundleMessageSource.setBasename(<span class=\"string\">\"classpath:messages\"</span>);</span><br><span class=\"line\">    \treloadableResourceBundleMessageSource.setDefaultEncoding(<span class=\"string\">\"UTF-8\"</span>);</span><br><span class=\"line\">    \treloadableResourceBundleMessageSource.setCacheSeconds(<span class=\"number\">120</span>);</span><br><span class=\"line\">    \t<span class=\"keyword\">return</span> reloadableResourceBundleMessageSource;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"POM文件配置信息\"><a href=\"#POM文件配置信息\" class=\"headerlink\" title=\"POM文件配置信息\"></a>POM文件配置信息</h4><figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 项目框架组合版本号 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">javax.el-api.version</span>&gt;</span>3.0.0<span class=\"tag\">&lt;/<span class=\"name\">javax.el-api.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">javax.servlet-api.version</span>&gt;</span>3.1.0<span class=\"tag\">&lt;/<span class=\"name\">javax.servlet-api.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">spring.version</span>&gt;</span>4.3.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 页面模板引擎ibeetl --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">com.ibeetl.version</span>&gt;</span>2.7.15<span class=\"tag\">&lt;/<span class=\"name\">com.ibeetl.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!--  org.ehcache 2.* --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">org.ehcache.version</span>&gt;</span>2.10.2.2.21<span class=\"tag\">&lt;/<span class=\"name\">org.ehcache.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- LOG框架 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">org.log4j2.version</span>&gt;</span>2.8.1<span class=\"tag\">&lt;/<span class=\"name\">org.log4j2.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- org.hibernate.validator --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">org.hibernate-validator.version</span>&gt;</span>5.2.4.Final<span class=\"tag\">&lt;/<span class=\"name\">org.hibernate-validator.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- jackson框架 组合--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">com.fasterxml.jackson.version</span>&gt;</span>2.8.1<span class=\"tag\">&lt;/<span class=\"name\">com.fasterxml.jackson.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">net.sf.json-lib.version</span>&gt;</span>2.4<span class=\"tag\">&lt;/<span class=\"name\">net.sf.json-lib.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- MYSQL 数据库驱动 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">mysql.driver.version</span>&gt;</span>5.1.28<span class=\"tag\">&lt;/<span class=\"name\">mysql.driver.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- springfox-swagger --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">springfox.swagger.version</span>&gt;</span>2.7.0<span class=\"tag\">&lt;/<span class=\"name\">springfox.swagger.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 阿里巴巴 Druid连接 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">alibaba.druid.version</span>&gt;</span>1.0.31<span class=\"tag\">&lt;/<span class=\"name\">alibaba.druid.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- AOP 组合--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">org.aspectj.version</span>&gt;</span>1.8.8<span class=\"tag\">&lt;/<span class=\"name\">org.aspectj.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">cglib.nodep.version</span>&gt;</span>3.1<span class=\"tag\">&lt;/<span class=\"name\">cglib.nodep.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 上传组件 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">apache.commons.fileupload</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">apache.commons.fileupload</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!--  lang3--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">apache.commons.lang3</span>&gt;</span>3.4<span class=\"tag\">&lt;/<span class=\"name\">apache.commons.lang3</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!--  io--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">apache.commons.io</span>&gt;</span>2.4<span class=\"tag\">&lt;/<span class=\"name\">apache.commons.io</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!--  collections--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">apache.commons.collections</span>&gt;</span>3.2.1<span class=\"tag\">&lt;/<span class=\"name\">apache.commons.collections</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- lombok 语法糖 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">projectlombok.version</span>&gt;</span>1.16.16<span class=\"tag\">&lt;/<span class=\"name\">projectlombok.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 单元测试 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">junit.version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">junit.version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 指定Maven编译项目编译格式 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span>\t</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.z201.web.common<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>web.common <span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;project.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- Spring 4.* --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 排除通用日志 改支持SLF4j --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-logging<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-logging<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 排除通用日志 改支持SLF4j --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-logging<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-logging<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span> </span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-expression<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context-support<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-tx<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aop<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- hibernate validator --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span>  </span><br><span class=\"line\">\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.hibernate<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span>  </span><br><span class=\"line\">\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>hibernate-validator<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span>  </span><br><span class=\"line\">\t    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;org.hibernate-validator.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span>  </span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span> </span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 增强 AOP --&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- quartz配置 --&gt;</span> </span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.quartz-scheduler<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>quartz<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;org.quartz.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                   <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">               <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.aspectj<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>aspectjweaver<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;org.aspectj.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.aspectj<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>aspectjrt<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;org.aspectj.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 待定 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cglib<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>cglib-nodep<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;cglib.nodep.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- AOP end--&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- ibeetl --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.ibeetl<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>beetl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">           \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;com.ibeetl.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/org.ehcache/ehcache --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>net.sf.ehcache<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>ehcache<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;org.ehcache.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- Druid --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>druid<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;alibaba.druid.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- mysql driver --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mysql.driver.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 添加Swagger2依赖  $&#123;springfox.swagger.version&#125;--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span>  </span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.springfox<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>springfox-swagger2<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;springfox.swagger.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span> </span><br><span class=\"line\">\t<span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">\t&lt;dependency&gt;  </span></span><br><span class=\"line\"><span class=\"comment\">\t\t    &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t    &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t    &lt;version&gt;2.7.0&lt;/version&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/dependency&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t--&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.drore.cloud<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>swagger-bootstrap-ui<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span> </span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- Logging配置：Log4j2 --&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- log4j2 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;org.log4j2.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;org.log4j2.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-jcl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;org.log4j2.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-1.2-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;org.log4j2.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-slf4j-impl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;org.log4j2.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;org.log4j2.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">      \t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 待定 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cglib<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>cglib-nodep<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;cglib.nodep.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 使用jsonLayout必须依赖jackson --&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;com.fasterxml.jackson.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-databind<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;com.fasterxml.jackson.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.jaxrs<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-jaxrs-json-provider<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;com.fasterxml.jackson.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!--json-lib --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>net.sf.json-lib<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>json-lib<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;net.sf.json-lib.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">classifier</span>&gt;</span>jdk15<span class=\"tag\">&lt;/<span class=\"name\">classifier</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- Test 单元测试 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;junit.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- 上传 --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-fileupload<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-fileupload<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;apache.commons.fileupload&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- H2 driver</span></span><br><span class=\"line\"><span class=\"comment\">\t&lt;dependency&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&lt;groupId&gt;com.h2database&lt;/groupId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&lt;artifactId&gt;h2&lt;/artifactId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&lt;version&gt;$&#123;h2.database.version&#125;&lt;/version&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t&lt;/dependency&gt;</span></span><br><span class=\"line\"><span class=\"comment\">\t --&gt;</span> </span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- commons --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.commons<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-lang3<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;apache.commons.lang3&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-io<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-io<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;apache.commons.io&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-collections<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-collections<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;apache.commons.collections&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- http://projectlombok.org/  --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;projectlombok.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- WAR相关jar --&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- javax --&gt;</span></span><br><span class=\"line\">\t<span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/javax.el/javax.el-api --&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.el<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.el-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;javax.el-api.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;javax.servlet-api.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">       </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"结束语\"><a href=\"#结束语\" class=\"headerlink\" title=\"结束语\"></a>结束语</h3><p>自己动手丰衣足食</p>\n","categories":["Spring"],"tags":["SpringBoot","Spring"]},{"title":"Mac-Dev","url":"/posts/2549917654/","content":"<blockquote>\n<p>最近开始用mac来开发。记录下环境安装过程方便以后快速恢复熟悉的开发环境。</p>\n</blockquote>\n<p>这里提前修改一下控制台前缀</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[dev mc]$ sudo vim &#x2F;etc&#x2F;bashrc</span><br><span class=\"line\">#修改以下内容</span><br><span class=\"line\">PS1&#x3D;&#39;\\h:\\W \\u\\$ &#39;</span><br><span class=\"line\">#修改成</span><br><span class=\"line\">PS1&#x3D;&#39;[dev \\u]$ &#39;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"好用的工具\"><a href=\"#好用的工具\" class=\"headerlink\" title=\"好用的工具\"></a>好用的工具</h3><ul>\n<li>pages <code>同事推荐的软件</code>暂时用来写周报。</li>\n<li>brew <code>这是一个神器,和linux 上的yum 类似的工具。</code></li>\n<li>sublime text <code>我之前在windows上都是使用notepad++。上App Store上没找到,该用这个了。</code></li>\n</ul>\n<h3 id=\"pages\"><a href=\"#pages\" class=\"headerlink\" title=\"pages\"></a>pages</h3><ul>\n<li>直接在app store安装就好了</li>\n</ul>\n<h3 id=\"brew\"><a href=\"#brew\" class=\"headerlink\" title=\"brew\"></a>brew</h3><ul>\n<li>安装过程使用终端安装。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">#  这里并没有换行，复制的时候请注意。</span><br><span class=\"line\">&#x2F;usr&#x2F;bin&#x2F;ruby -e &quot;$(curl -fsSL https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;Homebrew&#x2F;install&#x2F;master&#x2F;install)&quot;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>基本操作方式</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 更新</span><br><span class=\"line\">brew update </span><br><span class=\"line\"># 安装软件 </span><br><span class=\"line\">brew install xxx（软件名）</span><br><span class=\"line\"></span><br><span class=\"line\">#常见命令整理如下，以下命令都可带上 cask 参数：\t</span><br><span class=\"line\"></span><br><span class=\"line\">brew search name：联网搜索软件是否存在 brew 中</span><br><span class=\"line\">brew install name：安装软件</span><br><span class=\"line\">brew upgrade name：更新软件</span><br><span class=\"line\">brew uninstall name：卸载软件</span><br><span class=\"line\">brew reinstall name：重新安装软件</span><br><span class=\"line\">brew info name：查看软件安装地址</span><br><span class=\"line\">brew cleanup：清理缓存等</span><br><span class=\"line\">brew doctor：查看建议，例如升级等</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"mvnd\"><a href=\"#mvnd\" class=\"headerlink\" title=\"mvnd\"></a>mvnd</h3><blockquote>\n<p>maven-mvnd，可以读作 Maven Daemon，译作 Maven 守护版，旨在为 Maven 提供更快的构建速度，灵感借鉴了 Gradle 和 Takari（Maven 生命周期优化器）。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Windows</span></span><br><span class=\"line\">choco install mvndaemon </span><br><span class=\"line\"><span class=\"comment\"># Linux</span></span><br><span class=\"line\">sdk install mvnd</span><br><span class=\"line\"><span class=\"comment\"># macOS</span></span><br><span class=\"line\">brew install mvndaemon/homebrew-mvnd/mvnd</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"mycli\"><a href=\"#mycli\" class=\"headerlink\" title=\"mycli\"></a>mycli</h3><blockquote>\n<p>python编写的mysql客户单工具</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">brew install mycli</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h3 id=\"最终安装第三方程序如下\"><a href=\"#最终安装第三方程序如下\" class=\"headerlink\" title=\"最终安装第三方程序如下:\"></a>最终安装第三方程序如下:</h3><ul>\n<li>首先进入用户的工作空间，路径<code>/User/{user}/Downloads</code> 这里的user 就是你的电脑用户名称。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[dev mc]$ ls -l</span><br><span class=\"line\">total 2031352</span><br><span class=\"line\">-rw-r--r--@ 1 mc  staff    9987856  6 21 09:40 Typora.dmg</span><br><span class=\"line\">-rw-r--r--@ 1 mc  staff    8958105  6 21 10:43 apache-maven-3.5.3-bin.zip</span><br><span class=\"line\">-rw-r--r--@ 1 mc  staff   31940569  6 21 08:59 git-2.17.1-intel-universal-mavericks.dmg</span><br><span class=\"line\">-rw-r--r--@ 1 mc  staff   69518288  6 12 14:23 googlechrome.dmg</span><br><span class=\"line\">-rw-r--r--@ 1 mc  staff  659753157  6 20 16:55 ideaIU-2018.1.5.dmg</span><br><span class=\"line\">-rw-r--r--@ 1 mc  staff  259882804  6 20 17:00 jdk-8u171-macosx-x64.dmg</span><br><span class=\"line\">-rw-r--r--@ 1 mc  staff   42296521  6 21 13:44 sogou_mac_47e.zip</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>简单介绍下安装的程序：sogou、Typora、maven、git、chrome、idea、jdk、Navicat Premium、gradle。</li>\n</ul>\n<h3 id=\"安装sogou输入法\"><a href=\"#安装sogou输入法\" class=\"headerlink\" title=\"安装sogou输入法\"></a>安装sogou输入法</h3><ul>\n<li>最开始在<code>app store</code>上安装了一个版本，但是不知道配置。从新在官方网站下载一个mac版本的。</li>\n</ul>\n<h3 id=\"安装jdk\"><a href=\"#安装jdk\" class=\"headerlink\" title=\"安装jdk\"></a>安装jdk</h3><ul>\n<li>由于是从官方网站上下载的版本，和windows里面的安装过程类似，这里不多说。主要是安装完成之后java home在什么地方需要注意应该在后面的需要配置相关信息。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">#检查安装效果</span><br><span class=\"line\">[dev mc]$ java -version</span><br><span class=\"line\">java version &quot;1.8.0_171&quot;</span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_171-b11)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit Server VM (build 25.171-b11, mixed mode)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>检查javahome位置。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[dev mc]$ &#x2F;usr&#x2F;libexec&#x2F;java_home -V</span><br><span class=\"line\">Matching Java Virtual Machines (1):</span><br><span class=\"line\">    1.8.0_171, x86_64:  &quot;Java SE 8&quot; &#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_171.jdk&#x2F;Contents&#x2F;Home</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_171.jdk&#x2F;Contents&#x2F;Home</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><a href=\"https://adoptopenjdk.net/archive.html?variant=openjdk8\" target=\"_blank\" rel=\"noopener\">https://adoptopenjdk.net/archive.html?variant=openjdk8</a> 或者直接安装openjdk</li>\n</ul>\n<h3 id=\"安装git\"><a href=\"#安装git\" class=\"headerlink\" title=\"安装git\"></a>安装git</h3><ul>\n<li>git安装也是可视化安装，和windows下流程类似。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">dev mc]$ git --version</span><br><span class=\"line\">git version 2.17.1</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装chrome\"><a href=\"#安装chrome\" class=\"headerlink\" title=\"安装chrome\"></a>安装chrome</h3><ul>\n<li>反正我没在app store找到，也许是我瞎了。</li>\n</ul>\n<h3 id=\"安装idea\"><a href=\"#安装idea\" class=\"headerlink\" title=\"安装idea\"></a>安装idea</h3><ul>\n<li>安装过程可视化，这就不多说。主要是激活需要注意下。我采用修改hosts文件的方式；据说这个方法需要经常激活。</li>\n<li>安装完成之后先不进入idea，先修改hosts文件。并从<code>http://idea.lanyus.com</code>获取激活码。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">＃修改host文件</span><br><span class=\"line\">[dev mc]$ sudo vim &#x2F;etc&#x2F;hosts</span><br><span class=\"line\">#</span><br><span class=\"line\"># Host Database</span><br><span class=\"line\">#</span><br><span class=\"line\"># localhost is used to configure the loopback interface</span><br><span class=\"line\"># when the system is booting.  Do not change this entry.</span><br><span class=\"line\">##</span><br><span class=\"line\">127.0.0.1       localhost</span><br><span class=\"line\">255.255.255.255 broadcasthost</span><br><span class=\"line\">::1             localhost</span><br><span class=\"line\">#这里是追加的内容。</span><br><span class=\"line\">0.0.0.0         account.jetbrains.com</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>这里需要提权操作<code>sudo</code>，保存的时候需要强制保存<code>wq!</code>。</p>\n</blockquote>\n<ul>\n<li>修改完hosts文件,并从网站中获取了激活码就打开idea第一次需要激活。在<code>Activation code</code> 粘贴激活码就ok了。</li>\n</ul>\n<h3 id=\"安装openresty\"><a href=\"#安装openresty\" class=\"headerlink\" title=\"安装openresty\"></a>安装openresty</h3><ul>\n<li>在mac上直接使用brew安装</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">brew install openresty/brew/openresty</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>安装完成之后，默认的安装位置在 /usr/local/Cellar/openresty/xxx (xxx是版本号)</p>\n</li>\n<li><p>设置环境变量</p>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">export PATH=/usr/local/Cellar/openresty/1.19.9.1_2/nginx/sbin:$PATH</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>检查</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">➜  ~ nginx -v</span><br><span class=\"line\">nginx version: openresty/1.19.9.1</span><br><span class=\"line\"></span><br><span class=\"line\">➜  ~ nginx -V</span><br><span class=\"line\">nginx version: openresty/1.19.9.1</span><br><span class=\"line\">built by clang 13.0.0 (clang-1300.0.29.3)</span><br><span class=\"line\">built with OpenSSL 1.1.1l  24 Aug 2021</span><br><span class=\"line\">TLS SNI support enabled</span><br><span class=\"line\">configure arguments: --prefix=/usr/local/Cellar/openresty/1.19.9.1_2/nginx --with-cc-opt='-O2 -I/usr/local/include -I/usr/local/opt/pcre/include -I/usr/local/opt/openresty-openssl111/include' --add-module=../ngx_devel_kit-0.3.1 --add-module=../echo-nginx-module-0.62 --add-module=../xss-nginx-module-0.06 --add-module=../ngx_coolkit-0.2 --add-module=../set-misc-nginx-module-0.32 --add-module=../form-input-nginx-module-0.12 --add-module=../encrypted-session-nginx-module-0.08 --add-module=../srcache-nginx-module-0.32 --add-module=../ngx_lua-0.10.20 --add-module=../ngx_lua_upstream-0.07 --add-module=../headers-more-nginx-module-0.33 --add-module=../array-var-nginx-module-0.05 --add-module=../memc-nginx-module-0.19 --add-module=../redis2-nginx-module-0.15 --add-module=../redis-nginx-module-0.3.7 --add-module=../ngx_stream_lua-0.0.10 --with-ld-opt='-Wl,-rpath,/usr/local/Cellar/openresty/1.19.9.1_2/luajit/lib -L/usr/local/lib -L/usr/local/opt/pcre/lib -L/usr/local/opt/openresty-openssl111/lib' --pid-path=/usr/local/var/run/openresty.pid --lock-path=/usr/local/var/run/openresty.lock --conf-path=/usr/local/etc/openresty/nginx.conf --http-log-path=/usr/local/var/log/nginx/access.log --error-log-path=/usr/local/var/log/nginx/error.log --with-pcre-jit --with-ipv6 --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-http_v2_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module --with-http_addition_module --with-http_auth_request_module --with-http_secure_link_module --with-http_random_index_module --with-http_geoip_module --with-http_gzip_static_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-threads --with-stream --with-http_ssl_module</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装typora\"><a href=\"#安装typora\" class=\"headerlink\" title=\"安装typora\"></a>安装typora</h3><ul>\n<li>我在windows上经常使用这款编辑器、用mac依然使用。不过在写这篇文档的时候发现明显的bug ；还能忍受。</li>\n</ul>\n<h3 id=\"安装maven\"><a href=\"#安装maven\" class=\"headerlink\" title=\"安装maven\"></a>安装maven</h3><ul>\n<li>解压文件，并复制到<code>/Users/{user}/opt</code>文件夹中,我电脑到用户叫<code>mc</code></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[dev mc]$ unzip apache-maven-3.5.3.zip</span><br><span class=\"line\">...</span><br><span class=\"line\">[dev mc]$ mv apache-maven-3.5.3 &#x2F;Users&#x2F;mc&#x2F;opt</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>maven需要配置环境变量，首先检查<code>~/.bash_profile</code>是否存在。如果不存在就创建一个。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">#我这里是没有该文件</span><br><span class=\"line\">[dev mc]$  touch ~&#x2F;.bash_profile</span><br><span class=\"line\">#编辑内容</span><br><span class=\"line\">[dev mc]$  sudo vim ~&#x2F;.bash_profile</span><br><span class=\"line\"></span><br><span class=\"line\"># maven所在的目录  </span><br><span class=\"line\">export M2_HOME&#x3D;&#x2F;Users&#x2F;mc&#x2F;opt&#x2F;apache-maven-3.5.3  </span><br><span class=\"line\"># maven bin所在的目录  </span><br><span class=\"line\">export M2&#x3D;$M2_HOME&#x2F;bin  </span><br><span class=\"line\"># 将maven bin加到PATH变量中  </span><br><span class=\"line\">export PATH&#x3D;$M2:$PATH</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>这里其实和windows上配置一样只不过写入到地方不一样而已。java_home也可以在这里配置。</li>\n<li>强制刷新配置信息<code>[dev mc]$ source ~/.bash_profile</code>。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">＃检查配置信息</span><br><span class=\"line\">dev mc]$ mvn -v</span><br><span class=\"line\">Apache Maven 3.5.3 (3383c37e1f9e9b3bc3df5050c29c8aff9f295297; 2018-02-25T03:49:05+08:00)</span><br><span class=\"line\">Maven home: &#x2F;Users&#x2F;mc&#x2F;opt&#x2F;apache-maven-3.5.3</span><br><span class=\"line\">Java version: 1.8.0_171, vendor: Oracle Corporation</span><br><span class=\"line\">Java home: &#x2F;Library&#x2F;Java&#x2F;JavaVirtualMachines&#x2F;jdk1.8.0_171.jdk&#x2F;Contents&#x2F;Home&#x2F;jre</span><br><span class=\"line\">Default locale: zh_CN, platform encoding: UTF-8</span><br><span class=\"line\">OS name: &quot;mac os x&quot;, version: &quot;10.11.6&quot;, arch: &quot;x86_64&quot;, family: &quot;mac&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装Navicat-Premium\"><a href=\"#安装Navicat-Premium\" class=\"headerlink\" title=\"安装Navicat Premium\"></a>安装Navicat Premium</h3><blockquote>\n<p>安装这个是比较麻烦的，不过总算是安装成功了。单独梳理一下自己的激活成功过程。不过我并不是自己算出的注册码而是使用作者给的。毕竟方便很多。</p>\n</blockquote>\n<p>参考文献：<a href=\"https://www.jianshu.com/p/f3ef78deadaa\" target=\"_blank\" rel=\"noopener\">Navicat Premium for Mac的破解教程</a></p>\n<ul>\n<li>下载安装包 <a href=\"https://pan.baidu.com/s/13ySwHKoMaleBdLs71ACdlA\" target=\"_blank\" rel=\"noopener\">百度网盘</a> 密码 q47u <code>ps : 这个地址可能会失效</code></li>\n<li>加密解密网站 <a href=\"http://tool.chacuo.net/cryptrsaprikey\" target=\"_blank\" rel=\"noopener\">http://tool.chacuo.net/cryptrsaprikey</a></li>\n</ul>\n<p>大概的流程是这样的：</p>\n<ul>\n<li>修改Navicat Premium <code>rpk</code>文件内容，也就是公钥。这里参考文档中的一堆钥。rpk文件地址就在Navicat Premium应用安装位置中<code>Contents/Resources/</code>里面。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 公钥，放在rpk文件中的。</span><br><span class=\"line\">-----BEGIN PUBLIC KEY-----</span><br><span class=\"line\">MIIBITANBgkqhkiG9w0BAQEFAAOCAQ4AMIIBCQKCAQB8vXG0ImYhLHvHhpi5FS3g</span><br><span class=\"line\">d2QhxSQiU6dQ04F1OHB0yRRQ3NXF5py2NNDw962i4WP1zpUOHh94&#x2F;mg&#x2F;KA8KHNJX</span><br><span class=\"line\">HtQVLXMRms+chomsQCwkDi2jbgUa4jRFN&#x2F;6N3QejJ42jHasY3MJfALcnHCY3KDEF</span><br><span class=\"line\">h0N89FV4yGLyDLr+TLqpRecg9pkPnOp++UTSsxz&#x2F;e0ONlPYrra&#x2F;DiaBjsleAESZS</span><br><span class=\"line\">I69sPD9xZRt+EciXVQfybI&#x2F;2SYeAdXMm1B7tHCcFlOxeUgqYV03VEqiC0jVMwRCd</span><br><span class=\"line\">+03NU3wvEmLBvGOmNGudocWIF&#x2F;y3VOqyW1byXFLeZxl7s+Y&#x2F;SthxOYXzu3mF+2&#x2F;p</span><br><span class=\"line\">AgMBAAE&#x3D;</span><br><span class=\"line\">-----END PUBLIC KEY-----</span><br><span class=\"line\"></span><br><span class=\"line\">#私钥，后面激活的时候需要生成离线激活码。</span><br><span class=\"line\">-----BEGIN RSA PRIVATE KEY-----</span><br><span class=\"line\">MIIEogIBAAKCAQB8vXG0ImYhLHvHhpi5FS3gd2QhxSQiU6dQ04F1OHB0yRRQ3NXF</span><br><span class=\"line\">5py2NNDw962i4WP1zpUOHh94&#x2F;mg&#x2F;KA8KHNJXHtQVLXMRms+chomsQCwkDi2jbgUa</span><br><span class=\"line\">4jRFN&#x2F;6N3QejJ42jHasY3MJfALcnHCY3KDEFh0N89FV4yGLyDLr+TLqpRecg9pkP</span><br><span class=\"line\">nOp++UTSsxz&#x2F;e0ONlPYrra&#x2F;DiaBjsleAESZSI69sPD9xZRt+EciXVQfybI&#x2F;2SYeA</span><br><span class=\"line\">dXMm1B7tHCcFlOxeUgqYV03VEqiC0jVMwRCd+03NU3wvEmLBvGOmNGudocWIF&#x2F;y3</span><br><span class=\"line\">VOqyW1byXFLeZxl7s+Y&#x2F;SthxOYXzu3mF+2&#x2F;pAgMBAAECggEAK5qZbYt8wenn1uZg</span><br><span class=\"line\">6onRwJ5bfUaJjApL+YAFx&#x2F;ETtm83z9ByVbx4WWT7CNC7fK1nINy20&#x2F;mJrOTZkgIx</span><br><span class=\"line\">x6otiNC4+DIsACJqol+RLoo8I9pk77Ucybn65ZteOz7hVZIU+8j6LzW0KDt6yowX</span><br><span class=\"line\">e75r7G&#x2F;NEpfibNc3Zz81+oDd2x+bHyGbzc9QcePIVuEzkof6jgpbWrQZU14itx9l</span><br><span class=\"line\">VxEgj&#x2F;fbMccvBx8brR&#x2F;l9ClmDZd9Y6TWsF1rfJpF3+DPeqFkKCiD7PGz3bs4O&#x2F;Zd</span><br><span class=\"line\">ZrfV21ZNVusBW49G6bU63gQVKsOf1qGo3efbAW1HVxgTQ&#x2F;lExVdcMvdenZm+ADKp</span><br><span class=\"line\">L4&#x2F;wUQKBgQDOfBjn3OC2IerUFu18EgCS7pSjTSibXw+TeX3D5zwszLC091G2rGlT</span><br><span class=\"line\">5DihBUhMfesNdpoZynrs4YB6Sz9C3wSGAB8AM&#x2F;tNvPhtSVtbMHmrdT2DEEKCvLkO</span><br><span class=\"line\">RNBnt+8aTu2hGRanw9aL1189gzwrmXK5ZuuURfgLrB9ihrvjo4VznQKBgQCapx13</span><br><span class=\"line\">dEA1MwapBiIa3k8hVBCoGPsEPWqM33RBdUqUsP33f9&#x2F;PCx00j&#x2F;akwmjgQNnBlAJo</span><br><span class=\"line\">Y7LOqPCyiwOkEf40T4IlHdzYntWQQvHhfBwqSgdkTE9tKj43Ddr7JVFRL6yMSbW3</span><br><span class=\"line\">9qAp5UX&#x2F;+VzOLGAlfzJ8CBnkXwGrnKPCVbnZvQKBgQCd+iof80jlcCu3GteVrjxM</span><br><span class=\"line\">LkcAbb8cqG1FWpVTNe4&#x2F;JFgqDHKzPVPUgG6nG2CGTWxxv4UFKHpGE&#x2F;11E28SHYjb</span><br><span class=\"line\">cOpHAH5LqsGy84X2za649JkcVmtclUFMXm&#x2F;Ietxvl2WNdKF1t4rFMQFIEckOXnd8</span><br><span class=\"line\">y&#x2F;Z&#x2F;Wcz+OTFF82l7L5ehrQKBgFXl9m7v6e3ijpN5LZ5A1jDL0Yicf2fmePUP9DGb</span><br><span class=\"line\">ZTZbbGR46SXFpY4ZXEQ9GyVbv9dOT1wN7DXvDeoNXpNVzxzdAIt&#x2F;H7hN2I8NL+4v</span><br><span class=\"line\">EjHG9n4WCJO4v9+yWWvfWWA&#x2F;m5Y8JqusV1+N0iiQJ6T4btrE4JSVp1P6FSJtmWOK</span><br><span class=\"line\">W&#x2F;T9AoGAcMhPMCL+N+AvWcYt4Y4mhelvDG8e&#x2F;Jj4U+lwS3g7YmuQuYx7h5tjrS33</span><br><span class=\"line\">w4o20g&#x2F;3XudPMJHhA3z+d8b3GaVM3ZtcRM3+Rvk+zSOcGSwn3yDy4NYlv9bdUj&#x2F;4</span><br><span class=\"line\">H+aU1Qu1ZYojFM1Gmbe4HeYDOzRsJ5BhNrrV12h27JWkiRJ4F&#x2F;Q&#x3D;</span><br><span class=\"line\">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>\n\n<p><code>替换rpk文件内容后使用注册码</code><em>NAVH-T4PX-WT8W-QBL5</em></p>\n<ul>\n<li>开始激活打开软件会提示激活操作。输入注册码并断网，提示手动激活也就是离线激活。复制请求代码。打开加密解密网站，将私钥填入<code>加密秘钥</code>，然后把<code>请求码</code>复制到待<code>解密区域</code>，计算出明文。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 明文格式如下</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">&quot;K&quot; : &quot;NAVHT4PXWT8WQBL5&quot;,</span><br><span class=\"line\">&quot;P&quot; : &quot;Mac 10.13&quot;,</span><br><span class=\"line\">&quot;DI&quot; : &quot;ODQ2Yjg2ZDBjMTEzMjhh&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>拿到明文，按照固定格式填充下面的待加密内容，就是激活码的明文。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 在加密操作中，请勿换行。替换下面的k、di、t；这个t就是时间戳，n、o随意填。</span><br><span class=\"line\">&#123;&quot;K&quot;:&quot;NAVHT4PXWT8WQBL5&quot;, &quot;N&quot;:&quot;52pojie&quot;, &quot;O&quot;:&quot;52pojie.cn&quot;, &quot;DI&quot;:&quot;ODQ2Yjg2ZDBjMTEzMjhh&quot;, &quot;T&quot;:1516939200&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>拿到激活码的明文，用<code>私钥</code>加密的到激活码，填入激活就ok了。在教程中已经很详细了，所以就不多重复阐述。</li>\n</ul>\n<h3 id=\"安装gradle\"><a href=\"#安装gradle\" class=\"headerlink\" title=\"安装gradle\"></a>安装gradle</h3><blockquote>\n<p>安装有两种方式，第一种是下载解压包，然后配置环境变量。第二种是用brew进行安装。看gradle的官方也是推荐brew的安装方式。下面就简单演示下。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[dev mc]$ brew install gradle</span><br><span class=\"line\">#检查是否安装完成</span><br><span class=\"line\">[dev mc]$ gradle --version</span><br><span class=\"line\">Welcome to Gradle 4.8.1!</span><br><span class=\"line\"></span><br><span class=\"line\">Here are the highlights of this release:</span><br><span class=\"line\"> - Dependency locking</span><br><span class=\"line\"> - Maven Publish and Ivy Publish plugins improved and marked stable</span><br><span class=\"line\"> - Incremental annotation processing enhancements</span><br><span class=\"line\"> - APIs to configure tasks at creation time</span><br><span class=\"line\"></span><br><span class=\"line\">For more details see https:&#x2F;&#x2F;docs.gradle.org&#x2F;4.8.1&#x2F;release-notes.html</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">Gradle 4.8.1</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">Build time:   2018-06-21 07:53:06 UTC</span><br><span class=\"line\">Revision:     0abdea078047b12df42e7750ccba34d69b516a22</span><br><span class=\"line\"></span><br><span class=\"line\">Groovy:       2.4.12</span><br><span class=\"line\">Ant:          Apache Ant(TM) version 1.9.11 compiled on March 23 2018</span><br><span class=\"line\">JVM:          1.8.0_171 (Oracle Corporation 25.171-b11)</span><br><span class=\"line\">OS:           Mac OS X 10.13.5 x86_64</span><br></pre></td></tr></table></figure>\n\n<p><code>这里需要注意的是brew安装的程序都存放在 /usr/local/</code>，这里安装的地址就在<code>/usr/local/Cellar/gradle</code>。</p>\n<ul>\n<li>在设置环境变量，和maven设置方式一样。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 编辑 bash_profile文件添加gradle配置信息</span><br><span class=\"line\">[dev mc]$ sudo vim ~&#x2F;.bash_profile</span><br><span class=\"line\"></span><br><span class=\"line\"># 添加一下内容</span><br><span class=\"line\">#gradle所在文件地址</span><br><span class=\"line\">export GRADLE_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;Cellar&#x2F;gradle</span><br><span class=\"line\">#gradle bin所在的目录</span><br><span class=\"line\">export GRADLE&#x3D;$GRADLE_HOME&#x2F;bin</span><br><span class=\"line\">#将gradle bin加到PATH变量中</span><br><span class=\"line\">export PATH&#x3D;$GRADLE:$PATH </span><br><span class=\"line\"></span><br><span class=\"line\">#强制刷新配置文件</span><br><span class=\"line\">[dev mc]$ source ~&#x2F;.bash_profile</span><br><span class=\"line\"></span><br><span class=\"line\">#再次查检查环境配置</span><br><span class=\"line\">[dev mc]$ gradle --version</span><br><span class=\"line\"></span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\">Gradle 4.8.1</span><br><span class=\"line\">------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\">Build time:   2018-06-21 07:53:06 UTC</span><br><span class=\"line\">Revision:     0abdea078047b12df42e7750ccba34d69b516a22</span><br><span class=\"line\"></span><br><span class=\"line\">Groovy:       2.4.12</span><br><span class=\"line\">Ant:          Apache Ant(TM) version 1.9.11 compiled on March 23 2018</span><br><span class=\"line\">JVM:          1.8.0_171 (Oracle Corporation 25.171-b11)</span><br><span class=\"line\">OS:           Mac OS X 10.13.5 x86_64</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装zsh\"><a href=\"#安装zsh\" class=\"headerlink\" title=\"安装zsh\"></a>安装zsh</h3><blockquote>\n<p>这个比默认自带的控制台强大很多，所以推荐使用。</p>\n</blockquote>\n<ul>\n<li>查看mac默认自带的zsh版本</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">zsh --version</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>mac自带的shell是bash，需要自己修改下。</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">cat /etc/shells   <span class=\"comment\">#查看系统自带的bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># List of acceptable shells for chpass(1).</span></span><br><span class=\"line\"><span class=\"comment\"># Ftpd will not allow users to connect who are not using</span></span><br><span class=\"line\"><span class=\"comment\"># one of these shells.</span></span><br><span class=\"line\"></span><br><span class=\"line\">/bin/bash</span><br><span class=\"line\">/bin/csh</span><br><span class=\"line\">/bin/ksh</span><br><span class=\"line\">/bin/sh</span><br><span class=\"line\">/bin/tcsh</span><br><span class=\"line\">/bin/zsh  <span class=\"comment\"># 这个就是我们要用的。</span></span><br><span class=\"line\"></span><br><span class=\"line\">chsh -s /bin/zsh <span class=\"comment\"># 这是修改默认bash。</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>安装“oh my zsh”</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">sh -c &quot;$(curl -fsSL https:&#x2F;&#x2F;raw.github.com&#x2F;robbyrussell&#x2F;oh-my-zsh&#x2F;master&#x2F;tools&#x2F;install.sh)&quot; #注意脚本</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>注意事项</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">如果之前有在 ~&#x2F;.bash_profile 配备环境变量，请修改~&#x2F;.zshrc，在文件内添加source ~&#x2F;.bash_profile 。不然会出这个错误 zsh: command not found: xxx</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装macvim\"><a href=\"#安装macvim\" class=\"headerlink\" title=\"安装macvim\"></a>安装macvim</h3><blockquote>\n<p>在终端里面的vim不是特别习惯，所以我找了下mac上的vim可视化软件。</p>\n</blockquote>\n<p><a href=\"https://github.com/macvim-dev/macvim\" target=\"_blank\" rel=\"noopener\">https://github.com/macvim-dev/macvim</a></p>\n<h3 id=\"安装asciinema\"><a href=\"#安装asciinema\" class=\"headerlink\" title=\"安装asciinema\"></a>安装asciinema</h3><blockquote>\n<p>终端录制,个人觉的动画比较容易表示清晰。</p>\n</blockquote>\n<ul>\n<li><p>安装命令 <code>brew install asciinema</code></p>\n</li>\n<li><p>使用方法输入 <code>asciinema rec</code> 即可开始录制。完成后按 <code>Ctrl+D</code> 或者<code>exit</code>退出。</p>\n</li>\n</ul>\n<h3 id=\"安装wrk\"><a href=\"#安装wrk\" class=\"headerlink\" title=\"安装wrk\"></a>安装wrk</h3><blockquote>\n<p>HTTP的小工具。</p>\n</blockquote>\n<ul>\n<li>安装命令<code>brew install wrk</code>。</li>\n</ul>\n<h3 id=\"安装Keycastr\"><a href=\"#安装Keycastr\" class=\"headerlink\" title=\"安装Keycastr\"></a>安装Keycastr</h3><blockquote>\n<p>显示按键的小工具（Mac），可以设置要显示的桌面、是否只显示带功能键的键位。开源免费</p>\n</blockquote>\n<ul>\n<li>安装命令 <code>brew cask install keycastr</code>。</li>\n<li>需要在隐私设置中开启。</li>\n<li>项目地址 <a href=\"https://github.com/keycastr/keycastr\" target=\"_blank\" rel=\"noopener\">https://github.com/keycastr/keycastr</a></li>\n</ul>\n<h3 id=\"安装Go\"><a href=\"#安装Go\" class=\"headerlink\" title=\"安装Go\"></a>安装<code>Go</code></h3><blockquote>\n<p>这里偷懒直接在官方网站上下载可安装包,如果偷懒可以使用<code>brew install go</code>来安装，这里演示下源码安装</p>\n</blockquote>\n<ul>\n<li><p><a href=\"https://golang.org/dl/\" target=\"_blank\" rel=\"noopener\">官方地址</a> <a href=\"https://golang.google.cn/dl/\" target=\"_blank\" rel=\"noopener\">国内镜像</a> 下载对应的安装包</p>\n</li>\n<li><p>配置<code>GOPATH</code>  这里和配置java类似。</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim .bash_profile</span><br><span class=\"line\"><span class=\"built_in\">export</span> GOPATH=/usr/<span class=\"built_in\">local</span>/Cellar/go/1.7.6</span><br><span class=\"line\"><span class=\"built_in\">export</span> GOBIN=<span class=\"variable\">$GOPATH</span>/bin</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$PATH</span>:<span class=\"variable\">$GOBIN</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>检查配置<code>go env</code></p>\n</li>\n<li><p>配置<a href=\"https://goproxy.io/\" target=\"_blank\" rel=\"noopener\">goproxy</a>,暂时还不清楚为什么配置未生效。所以在国内下载依赖依然会出超时。</p>\n</li>\n<li><p>当我们使用 <code>import &quot;golang.org/x/tools/go/buildutil&quot;</code> 导入包时，其实导入的是<code>$GOPATH/src/golang.org/x/tools/go/buildutil</code>目录的包。</p>\n</li>\n<li><p>“golang.org/x” 下的包在 “github.com/golang”有镜像库。</p>\n</li>\n<li><p>所以可以从 github.com 上将对应包下载下来放到对应的目录即可</p>\n</li>\n<li><p>先切换到 <code>$GOPATH</code> 的 src 目录，<code>cd $GOPATH/src</code>，然后按需要下载：</p>\n<ol>\n<li><code>git clone --depth 1 https://github.com/golang/tools.git golang.org/x/tools</code></li>\n<li><code>git clone --depth 1 https://github.com/golang/lint.git golang.org/x/lint</code></li>\n<li><code>git clone --depth 1 https://github.com/golang/net.git golang.org/x/net</code></li>\n<li><code>git clone --depth 1 https://github.com/golang/sys.git golang.org/x/sys</code></li>\n<li><code>git clone --depth 1 https://github.com/golang/crypto.git golang.org/x/crypto</code></li>\n<li><code>git clone --depth 1 https://github.com/golang/text.git golang.org/x/text</code></li>\n<li><code>git clone --depth 1 https://github.com/golang/image.git golang.org/x/image</code></li>\n<li><code>git clone --depth 1 https://github.com/golang/oauth2.git golang.org/x/oauth2</code></li>\n</ol>\n</li>\n</ul>\n<ul>\n<li>以前他的依赖以此类推。</li>\n</ul>\n<h3 id=\"安装chromedriver\"><a href=\"#安装chromedriver\" class=\"headerlink\" title=\"安装chromedriver\"></a>安装chromedriver</h3><blockquote>\n<p>使用爬虫的时候需要使用</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 检查是否安装 chromedriver</span></span><br><span class=\"line\">-&gt; chromedriver -v</span><br><span class=\"line\">ChromeDriver 85.0.4183.87 </span><br><span class=\"line\"><span class=\"comment\"># 注意chromedriver 和 chrome 的版本要协同，如果不一致。就都重新安装最新版即可，官网有版本对照表。</span></span><br><span class=\"line\"><span class=\"comment\"># 卸载 chromedriver</span></span><br><span class=\"line\">-&gt; brew uninstall chromedriver</span><br><span class=\"line\"><span class=\"comment\"># 安装 chromedriver</span></span><br><span class=\"line\">-&gt; brew cask install chromedriver</span><br><span class=\"line\"><span class=\"comment\"># 这里可能出现版本不正确，因为chrome经常更新。可以尝试手动安装</span></span><br><span class=\"line\"><span class=\"comment\"># 卸载 chromedriver</span></span><br><span class=\"line\">-&gt; brew uninstall chromedriver</span><br><span class=\"line\"><span class=\"comment\"># 去官方网站下载 https://chromedriver.chromium.org/</span></span><br><span class=\"line\"><span class=\"comment\"># 下载后，将安装包加入到环境变量。以mac系统为例，将chromedriver移至/usr/bin目录下即可</span></span><br><span class=\"line\">-&gt; sudo mv ~/Downloads/chromedriver /usr/bin </span><br><span class=\"line\"><span class=\"comment\">## macOS Catalina cp: /usr/bin/xcpretty: Operation not permitted 权限问题</span></span><br><span class=\"line\"><span class=\"comment\">## macOS Catalina 存在 Rootless机制，不再能够随心所欲的读写很多路径</span></span><br><span class=\"line\"><span class=\"comment\">## 关闭 Rootless，重启按住 Command+R，进入 恢复模式，打开Terminal</span></span><br><span class=\"line\"><span class=\"comment\">## csrutil disable</span></span><br><span class=\"line\"><span class=\"comment\">## 正常启动复制文件</span></span><br><span class=\"line\"><span class=\"comment\">## csrutil enable</span></span><br><span class=\"line\"><span class=\"comment\">## 或者加入本地环境变量</span></span><br><span class=\"line\">-&gt; sudo mv ~/Downloads/chromedriver user/<span class=\"built_in\">local</span>/bin</span><br><span class=\"line\"><span class=\"comment\">## export PATH=$PATH:/usr/local/bin/chromedriver</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Mac下个人工具清单。\"><a href=\"#Mac下个人工具清单。\" class=\"headerlink\" title=\"Mac下个人工具清单。\"></a>Mac下个人工具清单。</h3><h4 id=\"brew-1\"><a href=\"#brew-1\" class=\"headerlink\" title=\"brew\"></a>brew</h4><table>\n<thead>\n<tr>\n<th>Tool name</th>\n<th>Install command</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Wget</td>\n<td>brew install  wget</td>\n<td>下载工具</td>\n</tr>\n<tr>\n<td>Curl</td>\n<td>brew install curl</td>\n<td>下载工具</td>\n</tr>\n<tr>\n<td>Diff</td>\n<td>brew install difftuils</td>\n<td>Gnu 比较工具</td>\n</tr>\n<tr>\n<td>Find</td>\n<td>brew install findtuils</td>\n<td>Gnu 查找工具</td>\n</tr>\n<tr>\n<td>htop</td>\n<td>brew install stop</td>\n<td>代替top</td>\n</tr>\n<tr>\n<td>Axel</td>\n<td>brew install axel</td>\n<td>多线程下载</td>\n</tr>\n<tr>\n<td>Tmux</td>\n<td>brew install tmux</td>\n<td>终端复用</td>\n</tr>\n<tr>\n<td>cloc</td>\n<td>brew install cloc</td>\n<td>代码统计</td>\n</tr>\n<tr>\n<td>Tldr</td>\n<td>brew install tldr</td>\n<td>命令提示行</td>\n</tr>\n<tr>\n<td>Ncdu</td>\n<td>brew install ncdu</td>\n<td>磁盘空间占用成分</td>\n</tr>\n<tr>\n<td>ctop</td>\n<td>brew install stop</td>\n<td>Docker 容器监控工具</td>\n</tr>\n<tr>\n<td>Pstree</td>\n<td>brew install</td>\n<td>进程树查看</td>\n</tr>\n<tr>\n<td>Bash-completion</td>\n<td>brew install</td>\n<td>bash补全</td>\n</tr>\n<tr>\n<td>Graphviz</td>\n<td>brew install</td>\n<td>拓扑图绘制工具</td>\n</tr>\n</tbody></table>\n<h4 id=\"brew-cask\"><a href=\"#brew-cask\" class=\"headerlink\" title=\"brew cask\"></a>brew cask</h4><table>\n<thead>\n<tr>\n<th>Tool name</th>\n<th>Install command</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>cask</td>\n<td>brew tap cask room/cask</td>\n<td>Cask</td>\n</tr>\n<tr>\n<td>Macpass</td>\n<td>brew cask install macpass</td>\n<td>免费密码管理</td>\n</tr>\n<tr>\n<td>docker</td>\n<td>brew cask install docker</td>\n<td>docker 必备</td>\n</tr>\n<tr>\n<td>Fonts</td>\n<td>brew tap cask room/fonts</td>\n<td>字体管理</td>\n</tr>\n<tr>\n<td>licecap</td>\n<td>brew cask install licecap</td>\n<td>录屏软件</td>\n</tr>\n<tr>\n<td>Kap</td>\n<td>brew cask install kap</td>\n<td>视频录屏</td>\n</tr>\n<tr>\n<td>sequel pro</td>\n<td>brew cask install sequel pro</td>\n<td>数据库管理</td>\n</tr>\n</tbody></table>\n<h3 id=\"tencent-lemon（Mac）\"><a href=\"#tencent-lemon（Mac）\" class=\"headerlink\" title=\"tencent-lemon（Mac）\"></a>tencent-lemon（Mac）</h3><ul>\n<li>腾讯柠檬清理，基本对标的就是 CleanMyMac</li>\n</ul>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><ul>\n<li>保不齐那天就又用上了。</li>\n</ul>\n<p>END</p>\n","categories":["Dev"],"tags":["Mac"]},{"title":"log4j入门","url":"/posts/3823874998/","content":"<blockquote>\n<p>本章内容阐述个人理解，以及使用方法。若有不正确的内容欢迎斧正。睡觉之前赶快记录下来免得有忘记了。</p>\n</blockquote>\n<h4 id=\"什么是Log\"><a href=\"#什么是Log\" class=\"headerlink\" title=\"什么是Log?\"></a>什么是Log?</h4><ul>\n<li>日志记录的是什么？市面上流行的软件基本都有日志记录功能，作为开发人员的好帮手。日志可以有效的记录程序运行的状态以及运行的异常，比如说操作系统蓝屏了、手机死机了、软件卡死、程序崩溃、写了BUG等等都会有对应的日志留下。</li>\n</ul>\n<h4 id=\"如何利用log？\"><a href=\"#如何利用log？\" class=\"headerlink\" title=\"如何利用log？\"></a>如何利用log？</h4><ul>\n<li>笔者是一个Java开发人员，本章内容代码部分已Java代码用例。大家都知道日志非常重要，但是经验不足的开发人员往往忽视了这个重要的手段，比如在控制台输出日志，所有输出信息都集中在一起。排除问题非常困难，一旦出现了线上异常信息首先要看的就是日志信息。所以有必要就日志手段多了解下。</li>\n</ul>\n<a id=\"more\"></a>\n\n<h4 id=\"我是如何操作的？\"><a href=\"#我是如何操作的？\" class=\"headerlink\" title=\"我是如何操作的？\"></a>我是如何操作的？</h4><ul>\n<li>最在开发一个客户端应用，并不是GUI那种程序。功能不多但是日志信息却很多，循环监控数据，所以运行期产生的日志也有点多，开发的时候毕竟简单调试还能接受，运行起来日志过于集中眼睛疼，为了方便调试以及排除问题，考虑先将日志经拆分。不同业务或者类型使用不同的log文件来记录。</li>\n</ul>\n<h4 id=\"用例\"><a href=\"#用例\" class=\"headerlink\" title=\"用例\"></a>用例</h4><ul>\n<li><p>这里简单的演示下如何将日志信息拆分到不同的文件中。</p>\n<blockquote>\n<p>添加日志依赖</p>\n</blockquote>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.21<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.21<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.17<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>这里解释下为什么是log4j而不是其他的日志框架，因为依赖的某个基础库是使用log4j我也懒的去折腾就用这个吧。</p>\n</blockquote>\n<ul>\n<li>log4j配置文件<code>Log4j配置文件（Configreation File）就是记录器级别、存放位置、布局等等。通过该配置文件我们可以创建log4j的运行环境</code>下面演示基础的配置信息。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">log4j.debug=<span class=\"keyword\">false</span></span><br><span class=\"line\">## 控制台输出</span><br><span class=\"line\">log4j.appender.stdoutAppender=org.apache.log4j.ConsoleAppender</span><br><span class=\"line\">log4j.appender.stdoutAppender.layout=org.apache.log4j.PatternLayout</span><br><span class=\"line\">log4j.appender.stdoutAppender.layout.ConversionPattern=%d&#123;yyyy-MM-dd HH:mm:ss&#125; %-<span class=\"number\">5</span>p %c&#123;<span class=\"number\">3</span>&#125; - %m%n</span><br><span class=\"line\"></span><br><span class=\"line\">## The log level may be one of OFF, FATAL, ERROR, WARN, INFO,</span><br><span class=\"line\">## DEBUG, or ALL. The default level is defined as the first</span><br><span class=\"line\">## element in the list of values for the log4j.rootLogger</span><br><span class=\"line\">## property.</span><br><span class=\"line\">##</span><br><span class=\"line\"># 指定package</span><br><span class=\"line\">log4j.logger.z201.github.io.code.log.log4j = ALL , stdoutAppender</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>简单的解释下上面的配置信息</p>\n<ul>\n<li><code>log4j.appender.stdoutAppender=org.apache.log4j.ConsoleAppender</code>其中<code>stdoutAppender</code>简单的理解可以理解为日志<strong>Logger</strong> 的标识、<code>ConsoleAppender</code>就是日志的输出地方。</li>\n<li><code>log4j.appender.stdoutAppender.layout=org.apache.log4j.PatternLayout</code>其中layout是布局,使用<code>org.apache.log4j.PatternLayout</code>来做布局。</li>\n<li><code>log4j.appender.stdoutAppender.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss} %-5p %c{3} - %m%n</code>这个就是布局的输出格式了。</li>\n<li><code>log4j.logger.z201.github.io.code.log.log4j = ALL , stdoutAppender</code>指定程序package使用的log，并且指定日志级别ALL全部输出。  </li>\n<li>这里简单介绍下log4j日志级别</li>\n</ul>\n</li>\n<li><p>Java用例代码</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">package z201.github.io.code.log.log4j;</span><br><span class=\"line\"></span><br><span class=\"line\">import org.junit.Test;</span><br><span class=\"line\">import org.slf4j.Logger;</span><br><span class=\"line\">import org.slf4j.LoggerFactory;</span><br><span class=\"line\"></span><br><span class=\"line\">public class TestLog4j &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    private static Logger log &#x3D; LoggerFactory.getLogger(TestLog4j.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    @Test</span><br><span class=\"line\">    public void test01()&#123;</span><br><span class=\"line\">        log.info(&quot;log info&quot;);</span><br><span class=\"line\">        log.error(&quot;log error&quot;);</span><br><span class=\"line\">        log.warn(&quot;log warn&quot;);</span><br><span class=\"line\">        log.trace(&quot;log trace&quot;);</span><br><span class=\"line\">        log.debug(&quot;log debug&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>由于日志级别是<code>ALL</code>所以都会输出。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">2018-06-13 00:05:13 INFO  log.log4j.TestLog4j - log info</span><br><span class=\"line\">2018-06-13 00:05:13 ERROR log.log4j.TestLog4j - log error</span><br><span class=\"line\">2018-06-13 00:05:13 WARN  log.log4j.TestLog4j - log warn</span><br><span class=\"line\">2018-06-13 00:05:13 TRACE log.log4j.TestLog4j - log trace</span><br><span class=\"line\">2018-06-13 00:05:13 DEBUG log.log4j.TestLog4j - log debug</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"尝试改造拆分日志\"><a href=\"#尝试改造拆分日志\" class=\"headerlink\" title=\"尝试改造拆分日志\"></a>尝试改造拆分日志</h4><blockquote>\n<p>不同的日志级别输出到不同的日志文件中。简单介绍下日志级别LEVEL：OFF（关闭）FATAL（致命的） ERROR（错误）WARN（警告） INFO（信息）DEBUG （调试） ALL（所有） 输出日志的策略是由LEVEL决定的。</p>\n</blockquote>\n<ul>\n<li>修改log4j配置文件</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">log4j.debug&#x3D;false</span><br><span class=\"line\">## 控制台输出</span><br><span class=\"line\">log4j.appender.stdoutAppender&#x3D;org.apache.log4j.ConsoleAppender</span><br><span class=\"line\">log4j.appender.stdoutAppender.layout&#x3D;org.apache.log4j.PatternLayout</span><br><span class=\"line\">log4j.appender.stdoutAppender.layout.ConversionPattern&#x3D;%d&#123;yyyy-MM-dd HH:mm:ss&#125; %-5p %c&#123;3&#125; - %m%n</span><br><span class=\"line\"></span><br><span class=\"line\">#info日志信息</span><br><span class=\"line\">log4j.logger.infoFile&#x3D;INFO,infoFile</span><br><span class=\"line\">log4j.appender.infoFile&#x3D;org.apache.log4j.RollingFileAppender</span><br><span class=\"line\">log4j.appender.infoFile.Append&#x3D;true</span><br><span class=\"line\">log4j.appender.infoFile.File&#x3D;logs&#x2F;infoFile.log</span><br><span class=\"line\">log4j.appender.infoFile.encoding&#x3D;UTF-8</span><br><span class=\"line\">log4j.appender.infoFile.maxBackupIndex&#x3D;30</span><br><span class=\"line\">log4j.appender.infoFile.MaxFileSize&#x3D;15MB</span><br><span class=\"line\">log4j.appender.infoFile.Threshold&#x3D;INFO</span><br><span class=\"line\">log4j.appender.infoFile.FILE.DatePattern&#x3D;&#39;.&#39;yyyy-MM-dd-HH-mm&#39;.log&#39;</span><br><span class=\"line\">log4j.appender.infoFile.layout&#x3D;org.apache.log4j.PatternLayout</span><br><span class=\"line\">log4j.appender.infoFile.layout.ConversionPattern&#x3D;%d&#123;yyyy-MM-dd HH:mm:ss&#125; [%5p] - %F(%L) - %m%n</span><br><span class=\"line\"></span><br><span class=\"line\">#error日志信息</span><br><span class=\"line\">log4j.logger.errorFile&#x3D;ERROR,errorFile</span><br><span class=\"line\">log4j.appender.errorFile&#x3D;org.apache.log4j.RollingFileAppender</span><br><span class=\"line\">log4j.appender.errorFile.Append&#x3D;true</span><br><span class=\"line\">log4j.appender.errorFile.File&#x3D;logs&#x2F;errorFile.log</span><br><span class=\"line\">log4j.appender.errorFile.encoding&#x3D;UTF-8</span><br><span class=\"line\">log4j.appender.errorFile.maxBackupIndex&#x3D;30</span><br><span class=\"line\">log4j.appender.errorFile.MaxFileSize&#x3D;15MB</span><br><span class=\"line\">log4j.appender.errorFile.Threshold&#x3D;ERROR</span><br><span class=\"line\">log4j.appender.errorFile.FILE.DatePattern&#x3D;&#39;.&#39;yyyy-MM-dd&#39;.log&#39;</span><br><span class=\"line\">log4j.appender.errorFile.layout&#x3D;org.apache.log4j.PatternLayout</span><br><span class=\"line\">log4j.appender.errorFile.layout.ConversionPattern&#x3D;%d&#123;yyyy-MM-dd HH:mm:ss&#125; [%5p] | %m%n</span><br><span class=\"line\"></span><br><span class=\"line\">## The log level may be one of OFF, FATAL, ERROR, WARN, INFO,</span><br><span class=\"line\">## DEBUG, or ALL. The default level is defined as the first</span><br><span class=\"line\">## element in the list of values for the log4j.rootLogger</span><br><span class=\"line\">## property.</span><br><span class=\"line\">##</span><br><span class=\"line\"># system logs</span><br><span class=\"line\">log4j.logger.z201.github.io.code.log.log4j&#x3D;ALL , infoFile , errorFile ,  stdoutAppender</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>再次简单解释下配置的logger<code>errorFile 和 infoFile</code>这是两个文件输出。<ul>\n<li>Append 是否运行追加内容。</li>\n<li>File 文件存放地址</li>\n<li>encoding 日志编码集</li>\n<li>maxBackupIndex 最大存储文件个数</li>\n<li>MaxFileSize 单个文件最大大小</li>\n<li>Threshold 输出级别</li>\n<li>FILE.DatePattern 切割日志的时候文件名称格式化</li>\n</ul>\n</li>\n<li>依然是运行上面的Java代码，除了控制台会输出日志还会生成两个日志文件 infoFile、errorFile。依次看下日志文件中的内容。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 文件 infoFile.log</span><br><span class=\"line\">2018-06-13 00:12:40 [ INFO] - TestLog4j.java(13) - log info</span><br><span class=\"line\">2018-06-13 00:12:40 [ERROR] - TestLog4j.java(14) - log error</span><br><span class=\"line\">2018-06-13 00:12:40 [ WARN] - TestLog4j.java(15) - log warn</span><br></pre></td></tr></table></figure>\n\n<hr>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 文件 errorFile.log</span><br><span class=\"line\">2018-06-13 00:12:40 [ERROR] | log error</span><br></pre></td></tr></table></figure>\n\n<p>这里有一个疑问为什么infoFile里面输出的内容多点。这依然和日志的LEVEL有关系，由于INFO级别大小的问题，INFO级别的日志会输出别它大的级别日志。也就是设置成INFO的时候会输出 WARN 、ERROR、FATAL。而且log4j建议使用 DEBUG、INFO、WARN、ERROR这四种。</p>\n<h4 id=\"补充一点内容\"><a href=\"#补充一点内容\" class=\"headerlink\" title=\"补充一点内容\"></a>补充一点内容</h4><p>实际上日志的拆分我们已经大概目的了，现在补充下其他的<code>Appenders</code>便于参考业务场景使用。</p>\n<ul>\n<li>org.apache.log4j.ConsoleAppender（控制台） org.apache.log4j.FileAppender（文件） </li>\n<li>org.apache.log4j.DailyRollingFileAppender（每天产生一个日志文件） </li>\n<li>org.apache.log4j.RollingFileAppender（文件大小到达指定尺寸的时候产生一个新的文件） </li>\n<li>org.apache.log4j.WriterAppender（将日志信息以流格式发送到任意指定的地方） </li>\n</ul>\n<p>还有 <code>Layouts</code>的使用，列举下。</p>\n<ul>\n<li>org.apache.log4j.HTMLLayout（以HTML表格形式布局） </li>\n<li>org.apache.log4j.PatternLayout（可以灵活地指定布局模式） </li>\n<li>org.apache.log4j.SimpleLayout（包含日志信息的级别和信息字符串） </li>\n<li>org.apache.log4j.TTCCLayout（包含日志产生的时间、线程、类别等信息） </li>\n</ul>\n<p>简单的拆分日志就到这里了，log4j在日常开发中非常重要。确实不应该忽视它的存在，应该正确的使用。</p>\n<h4 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h4>","categories":["Dev"],"tags":["Java","Log4j"]},{"title":"Modbus入门","url":"/posts/1103815643/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n<p>以下部分超链接需要科学上网。</p>\n</blockquote>\n<h2 id=\"ModBus\"><a href=\"#ModBus\" class=\"headerlink\" title=\"ModBus\"></a>ModBus</h2><p>modbus是一种通讯协议，是Modicon公司1979年为使用可编程逻辑控制器（PLC）通讯而发表。Modbus是工业领域通讯协议的业界标准之一，目前也我国国家标准工业通讯协议中的重要成员之一。</p>\n<h3 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h3><ul>\n<li><p>Modbus采用主从（Master-Salve）通信模式，仅有主设备（Master）能对传输进行初始化，从设备（Slave）根据主设备的请求进行应答。 __在主从关系中，通信总是成对发生。一个设备必须发起请求，然后等待响应 - 并且发起设备（主设备）负责发起每次交互。 通常，主设备是人机界面（HMI）或监控和数据采集（SCADA）系统，从设备是传感器、可编程逻辑控制器（PLC）或可编程自动化控制器（PAC）。 这些请求和响应的内容以及发送这些消息的网络层由协议的不同层来定义__。 </p>\n<ul>\n<li>在串行链路的主从通信中，Modbus主设备可以连接一个或N（最大为247）个从设备，主从设备之间的通信包括单播模式和广播模式。 </li>\n<li>在广播模式中，Modbus主设备可同时向多个从设备发送请求（设备地址0用于广播模式），从设备对广播请求不进行响应。 </li>\n<li>在单播模式中，主设备发送请求至某个特定的从设备（每个Modbus从设备具有唯一地址），请求的消息帧中会包含功能代码和数据，比如功能代码“01”用来读取离散量线圈的状态。从设备接到请求后，进行应答并把消息反馈主设备。 </li>\n<li>__主设备不发送数据，从数据是不会自己发出数据的；即必须是主设备发出查询请求才能建立通讯。 __</li>\n</ul>\n</li>\n<li><p>消息帧校验方式</p>\n<ul>\n<li>ASCII消息帧：<code>LRC（纵向冗长检测）</code></li>\n<li>CRCi消息帧：<code>CRC(循环冗长检测)</code></li>\n</ul>\n</li>\n<li><p>ModBus是OSI模型第七层上即__应用层__报文传输协议。</p>\n</li>\n<li><p>ModBus支持多工业设备、包括<code>PLC</code>、<code>DSC</code>、<code>变频器</code>、智能仪表等都在应用。</p>\n</li>\n<li><p>ModBus支持多种电气接口，如<code>RS-232</code>、<code>RS-485</code>等，还可以在各种介质上传送，如双绞线、光纤、无线。</p>\n</li>\n<li><p>ModBus协议完全免费；<code>帧格式</code>简单，紧凑。</p>\n</li>\n<li><p>ModBus对线缆的要求、长度、波特率，终端电阻，接地，连接器，通信状态的LED指示，都有电气标准。</p>\n</li>\n<li><p>ModBus数据可以分为两大类，分别为Coil和Register，每一种数据，根据读写方式的不同，又可细分为两种（只读，读写）。 </p>\n<ul>\n<li>Coli是位（bit）变量。</li>\n<li>Register是整型（word ,即 16 - bit ）。</li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Primary tabels</th>\n<th>Object Type</th>\n<th>Type Of</th>\n<th>comments</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Discretes Input 离线输入量</td>\n<td>Single bit</td>\n<td>只读</td>\n<td>IO系统提供这种类型的数据</td>\n</tr>\n<tr>\n<td>Coils 线圈</td>\n<td>Single bit</td>\n<td>只写</td>\n<td>通用应用程序改变这种类型的数据</td>\n</tr>\n<tr>\n<td>Input Registers  输入寄存器</td>\n<td>16-bit word</td>\n<td>只读</td>\n<td>IO系统提供这种类型的数据</td>\n</tr>\n<tr>\n<td>Holding Registers 保持寄存器</td>\n<td>16-bit word</td>\n<td>只写</td>\n<td>通用应用程序改变这种类型的数据</td>\n</tr>\n</tbody></table>\n<a id=\"more\"></a>\n\n<h4 id=\"关键字概述\"><a href=\"#关键字概述\" class=\"headerlink\" title=\"关键字概述\"></a>关键字概述</h4><ul>\n<li><p><a href=\"https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B\" target=\"_blank\" rel=\"noopener\">OSI模型</a></p>\n<ul>\n<li>开放式系统互联网通讯参考模型，也就是常说的OSI七层通讯模型。</li>\n</ul>\n</li>\n<li><p><a href=\"https://zh.wikipedia.org/wiki/PLC\" target=\"_blank\" rel=\"noopener\">PLC</a></p>\n<ul>\n<li>这里的PLC是指：<code>可编程逻辑控制器</code>，一种具有微处理器的数位逻辑控制器，用户自动化控制。关于<a href=\"https://zh.wikipedia.org/wiki/%E5%8F%AF%E7%BC%96%E7%A8%8B%E9%80%BB%E8%BE%91%E6%8E%A7%E5%88%B6%E5%99%A8\" target=\"_blank\" rel=\"noopener\">可编程逻辑控制器</a></li>\n</ul>\n</li>\n<li><p><a href=\"https://zh.wikipedia.org/wiki/%E6%95%B0%E5%AD%97%E4%BF%A1%E5%8F%B7%E6%8E%A7%E5%88%B6%E5%99%A8\" target=\"_blank\" rel=\"noopener\">DSC</a></p>\n<ul>\n<li>这里的DSC是之：<code>数字信号控制器</code>，是<code>单片机</code>和<code>数字信号处理</code>的集合(DSPs)的集合。</li>\n</ul>\n</li>\n<li><p><a href=\"https://zh.wikipedia.org/wiki/%E5%8F%98%E9%A2%91%E5%99%A8\" target=\"_blank\" rel=\"noopener\">变频器</a></p>\n</li>\n<li><p><a href=\"https://zh.wikipedia.org/wiki/RS-232\" target=\"_blank\" rel=\"noopener\">RS-232</a></p>\n<ul>\n<li>RS-232是美国EIA定制的串行数据通讯的接口。</li>\n</ul>\n</li>\n<li><p>RS-485</p>\n<ul>\n<li>现在叫EIA-485，电器特性规定双线、双半工、平衡传输线多点通讯的标准；实现此标准的数字通讯网可以在有电子噪声的环境下经行长距离有效的通信，在线性多点总线的配置下，可以在一个网络上有多个接收器，因此适用在工业环境中。</li>\n</ul>\n</li>\n<li><p>帧格式</p>\n<ul>\n<li>ModBus是请求/应答协议，并且提供功能码规定服务<ul>\n<li>ModBus ASCII</li>\n<li>ModBus RTU</li>\n<li>ModBus TCP/IP</li>\n</ul>\n</li>\n<li>RTU是必须支持的，其余可选，ModBus RTU帧最大字节256字节。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ModBus-RTU解析\"><a href=\"#ModBus-RTU解析\" class=\"headerlink\" title=\"ModBus RTU解析\"></a>ModBus RTU解析</h3><blockquote>\n<p>( Remote Terminal Unit )</p>\n</blockquote>\n<ul>\n<li>MODBUS RTU消息是一个简单的16位CRC（<a href=\"https://blog.csdn.net/weixin_38664664/article/details/77949553\" target=\"_blank\" rel=\"noopener\">循环冗余校验和</a>）。这些信息的简单性在于确保可靠性。由于这种简单性，基本的16位MODBUS RTU<a href=\"https://zh.wikipedia.org/zh/%E5%AF%84%E5%AD%98%E5%99%A8\" target=\"_blank\" rel=\"noopener\">寄存器</a>结构可用于打包浮点，表格，ASCII文本，队列和其他无关数据。 </li>\n<li>RTU软件实现上特质<ul>\n<li>默认的通讯<code>波特率</code>9600bps,8位数据位,偶校验,一位停止。</li>\n<li>奇校验和无校验是可选的，系统必须支持默认的配置，并且对配置错误有异常管理。</li>\n</ul>\n</li>\n<li>Modbus 的 RTU 模式规定不同数据帧之间的间隔是3.5个字节通信时间以上。如果在一帧数据完成之前有超过3.5个<code>字节时间的停顿</code>，接收设备将刷新当前的消息并假定下一个字节是一个新的数据帧的开始。同样的，如果一个新消息在小于3.5个字节时间内接着前边一个数据开始，接收设备将会认为它是前一帧数据的延续。这将会导致一个错误，因此大家看 RTU 数据帧最后还有 16bit 的 CRC 校验。 <ul>\n<li><code>起始位</code>和<code>结束符</code>：一个数据帧，前后都至少有3.5个字节的时间间隔，起始位和结束符实际上没有任何数据，T1-T2-T3-T4 代表的是时间间隔3.5个字节以上的时间，而真正有意义的第一个字节是设备地址。</li>\n<li><code>设备地址</code>：在多机通信的时候，数据那么多，依靠这个设备地址字节。每个设备都有一个自己的地址，当设备接收到一帧数据后，程序首先对设备地址字节进行判断比较，如果与自己的地址不同，则对这帧数据直接不予理会，如果与自己的地址相同，就要对这帧数据进行解析，按照之后的功能码执行相应的功能。如果地址是 0x00，则认为是一个广播命令，就是所有的从机设备都要执行的指令。</li>\n<li><code>功能代码</code>：在第二个字节功能代码字节中，Modbus 规定了部分功能代码，此外也保留了一部分功能代码作为备用或者用户自定义，下面有一个ModBus功能码。</li>\n<li><code>数据</code>：跟在功能码后面的是n个8Bit数据。这个n值有多少，取决功能代码决定，不同的功能码后面的数据数据也不同。</li>\n<li><code>CRC校验</code>：CRC校验是一种数据算法，是用来校验数据对错的。__CRC校验函数吧一帧数据除最后两个字节外，前面所有的字节进行特定的算法计算。计算完后生成一个16Bit的数据，作为CRC校验码，添加在一帧数据的最后。接收方接收到数据后，同样会把前边的字节进行 CRC 计算，计算完了再和发过来的 16bit 的 CRC 数据进行比较__，如果相同则认为数据正常，没有出错，如果比较不相同，则说明数据在传输中发生了错误，这帧数据将被丢弃，就像没收到一样，而发送方会在得不到回应后做相应的处理错误处理。 </li>\n</ul>\n</li>\n<li>RTU 模式字节分布<ul>\n<li>1个起始位、8个数据位，最小有效位先发送、1个奇偶校验位（如果无校验则没有这一位）、1位停止位（有校验位时）或者2个停止位（无校验位时）。 </li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>通信帧被称为ADU（Application Data Unit）, 其中功能代码和数据段组合称为协议数据单元PDU（Protocol Data  Unit）</p>\n</blockquote>\n<ul>\n<li>上图是一个标准的RTU帧。<ul>\n<li>起始位 ： <code>T1-T2-T3-T4</code></li>\n<li>地址域(设备地址) ：<code>8Bit</code></li>\n<li>功能代码：<code>8Bit</code> </li>\n<li>数据：<code>n个8Bit</code></li>\n<li>差错校验（CRC校验）: <code>16Bit</code></li>\n<li>结束符：<code>T1-T2-T3-T4</code></li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>START</th>\n<th>ADDR</th>\n<th>CS</th>\n<th>DATA</th>\n<th>CRC</th>\n<th>END</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>初始结构</td>\n<td>地址码</td>\n<td>功能码</td>\n<td>数据区</td>\n<td>错误校验</td>\n<td>结束结构</td>\n</tr>\n<tr>\n<td>延时（相当于4个字节时间）</td>\n<td>1字节</td>\n<td>1字节</td>\n<td>N字节</td>\n<td>2字节</td>\n<td>延时（相当于4个字节时间）</td>\n</tr>\n</tbody></table>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/ModBus/%E5%B8%A7%E7%BB%93%E6%9E%842.jpg\"></p>\n<ul>\n<li>在软件实现上，采用默认的RTU帧结构。<ul>\n<li>发送设备将 Modbus报文构造为带有已知起始和结束标记的帧。这使设备可以在报文的开始接收新帧，并且知道何时报文结束。不完整的报文必须能够被检测到而错误标志必须作为结果被设置。在RTU模式，报文帧由时长至少为 3.5 个字符时间的空闲间隔。</li>\n<li>ModBus采用的是大端模式，就是比如一个16位的电流有效值，是先发送高字节，在发送低字节，但在CRC校验域切记是先发送低字节，在发送高字节，每个字节是先发送低位在发送高位,如下图所示 </li>\n</ul>\n</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/ModBus/%E6%9C%89%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/ModBus/%E6%97%A0%E5%A5%87%E5%81%B6%E6%A0%A1%E9%AA%8C.jpg\"></p>\n<h4 id=\"字节停顿时间\"><a href=\"#字节停顿时间\" class=\"headerlink\" title=\"字节停顿时间\"></a>字节停顿时间</h4><blockquote>\n<p>串口发送    一帧数据的停顿时间如何计算？</p>\n</blockquote>\n<ul>\n<li>波特率：发送二进制数据位的速率，习惯上用 baud 表示，即我们发送一位二进制数据的持续时间=1/baud <ul>\n<li>如果波特率为9600，发送一个位需要的时间为1/9600s=0.0001042s=0.1042ms,这里按数据位为8位，停止位为2位，  加起来就是10位，10个位发送所需的时间为：0.1042<em>10ms = 1.042ms,如果我要发送10个字节的数据，那发送这10个字节数据给接收方需要  的时间为：10</em>1.042ms = 10.42ms，这是算实际的发送10个字节的数据所需要的时间。我们在接收方接收数据时可以  把时间再加宽一些，让它有一点余量。让接收方能稳定的把数据从发送方接手过来，可以加个5ms,或更宽一点10ms,  加上发送10个字节所花的时间，就是15ms或20ms。 其他波特率依此类推。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ModBus功能码\"><a href=\"#ModBus功能码\" class=\"headerlink\" title=\"ModBus功能码\"></a>ModBus功能码</h3><table>\n<thead>\n<tr>\n<th>功能码</th>\n<th>名称</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>01</td>\n<td>读取线圈状态</td>\n<td>取得一组逻辑线圈的当前状态(ON/OFF)</td>\n</tr>\n<tr>\n<td>02</td>\n<td>读取输入状态</td>\n<td>取得一组开关输入的当前状态(ON/OFF)</td>\n</tr>\n<tr>\n<td>03</td>\n<td>读取保持寄存器</td>\n<td>在一个或多个保持寄存器中取得当前的二进制值</td>\n</tr>\n<tr>\n<td>04</td>\n<td>读取输入寄存器</td>\n<td>在一个或多个输入寄存器中取得当前的二进制值</td>\n</tr>\n<tr>\n<td>05</td>\n<td>强置单线圈</td>\n<td>强置一个逻辑线圈的通断状态</td>\n</tr>\n<tr>\n<td>06</td>\n<td>预置单寄存器</td>\n<td>把具体二进值装入一个保持寄存器</td>\n</tr>\n<tr>\n<td>07</td>\n<td>读取异常状态</td>\n<td>取得 8 个内部线圈的通断状态，这 8 个线圈的地址由 控制器决定，用户逻辑可以将这些线圈定义，以说明 从机状态，短报文适宜于迅速读取状态</td>\n</tr>\n<tr>\n<td>08</td>\n<td>回送诊断校验</td>\n<td>把诊断校验报文送从机，以对通信处理进行评鉴</td>\n</tr>\n<tr>\n<td>09</td>\n<td>编程(只用于 484)</td>\n<td>使主机模拟编程器作用，修改 PC 从机逻辑</td>\n</tr>\n<tr>\n<td>10</td>\n<td>控询(只用于 484)</td>\n<td>可使主机与一台正在执行长程序任务从机通信，探询 该从机是否已完成其操作任务，仅在含有功能码 9 的报文发送后，本功能码才发送</td>\n</tr>\n<tr>\n<td>11</td>\n<td>读取事件计数</td>\n<td>可使主机发出单询问，并随即判定操作是否成功，尤 其是该命令或其它应答产生通信错误时</td>\n</tr>\n<tr>\n<td>12</td>\n<td>读取通信事件记录</td>\n<td>可使主机检索每台从机的 ModBus 事务处理通信事件 记录。如果某项事务处理完成，记录会给出有关错误</td>\n</tr>\n<tr>\n<td>13</td>\n<td>编程(184/384 484 584 )</td>\n<td>可使主机模拟编程器功能修改 PC 从机逻辑</td>\n</tr>\n<tr>\n<td>14</td>\n<td>探询(184/384 484 584)</td>\n<td>可使主机与正在执行任务的从机通信，定期控询该从 机是否已完成其程序操作，仅在含有功能 13 的报文 发送后，本功能码才得发送</td>\n</tr>\n<tr>\n<td>15</td>\n<td>强置多线圈</td>\n<td>强置一串连续逻辑线圈的通断</td>\n</tr>\n<tr>\n<td>16</td>\n<td>预置多寄存器</td>\n<td>把具体的二进制值装入一串连续的保持寄存器</td>\n</tr>\n<tr>\n<td>17</td>\n<td>报告从机标识</td>\n<td>可使主机判断编址从机的类型及该从机运行指示灯 的状态</td>\n</tr>\n<tr>\n<td>18</td>\n<td>884 和 MICRO 84</td>\n<td>可使主机模拟编程功能，修改 PC 状态逻辑</td>\n</tr>\n<tr>\n<td>19</td>\n<td>重置通信链路</td>\n<td>发生非可修改错误后，是从机复位于已知状态，可重 置顺序字节</td>\n</tr>\n<tr>\n<td>20</td>\n<td>读取通用参数(584L)</td>\n<td>显示扩展存储器文件中的数据信息</td>\n</tr>\n<tr>\n<td>21</td>\n<td>写入通用参数(584L)</td>\n<td>把通用参数写入扩展存储文件，或修改</td>\n</tr>\n<tr>\n<td>22~64</td>\n<td>保留作扩展功能备用</td>\n<td></td>\n</tr>\n<tr>\n<td>65~72</td>\n<td>保留以备用户功能所用</td>\n<td>留作用户功能的扩展编码</td>\n</tr>\n<tr>\n<td>73~119</td>\n<td>非法功能</td>\n<td></td>\n</tr>\n<tr>\n<td>120~127</td>\n<td>保留</td>\n<td>留作内部作用</td>\n</tr>\n<tr>\n<td>128~255</td>\n<td>保留</td>\n<td>用于异常应答</td>\n</tr>\n</tbody></table>\n<h3 id=\"小试牛刀\"><a href=\"#小试牛刀\" class=\"headerlink\" title=\"小试牛刀\"></a>小试牛刀</h3><blockquote>\n<p>文档看了，用模拟器来测试下。</p>\n</blockquote>\n<p>首先需要模拟一个COM串口。不然怎么测试呢。自行百度VSPD。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/ModBus/VSPD.JPG\"></p>\n<p>然后在测试下上图中<code>COM1、COM2</code>虚拟串口。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/ModBus/%E4%B8%B2%E5%8F%A3%E8%B0%83%E8%AF%95%E5%8A%A9%E6%89%8B.JPG\"></p>\n<p>串口数据测试互通之后就可以使用Modbus测试工具来测试了。</p>\n<p>工具清单</p>\n<ul>\n<li>Modbus poll</li>\n<li>Modbus savel</li>\n</ul>\n<p>下载后自行寻找注册码，开始准备测试。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/ModBus/ModbusTest.jpg\"></p>\n<p>这里是4组测试。ModbusSlave模拟4个设备的数据。ModbusPoll中去分别获取四个设备的数据。测试依据参考Modbus数据类型，读写情况。这里简单的测试4种读。</p>\n<p>这里只做演示，具体使用网上有很多教程解释了。这俩软件挺简单的。</p>\n<h2 id=\"工具下载地址\"><a href=\"#工具下载地址\" class=\"headerlink\" title=\"工具下载地址\"></a>工具下载地址</h2><p><a href=\"http://www.modbustools.com/download.html\" target=\"_blank\" rel=\"noopener\">ModBus Poll And ModBus Slave</a></p>\n<h2 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h2><p><strong><a href=\"http://www.ni.com/white-paper/52134/zhs/\" target=\"_blank\" rel=\"noopener\">Modbus协议深入讲解</a></strong></p>\n<p><strong><a href=\"http://www.modbus.org/docs/Modbus_Application_Protocol_V1_1b3.pdf\" target=\"_blank\" rel=\"noopener\">ModBus Application Protocol</a></strong></p>\n<p><a href=\"https://cloud.tencent.com/developer/article/1089161\" target=\"_blank\" rel=\"noopener\">腾云阁 Modbus那些事</a></p>\n<p><a href=\"https://zh.wikipedia.org/wiki/Modbus\" target=\"_blank\" rel=\"noopener\">维基百科Modbus</a></p>\n<p><a href=\"http://wiki.jikexueyuan.com/project/mcu-tutorial-three/modbus-communication-protocol.html\" target=\"_blank\" rel=\"noopener\">极客学院 Modbus 通信协议介绍</a></p>\n<p><a href=\"http://digital.ni.com/public.nsf/allkb/F716ABC0F75705ED86257AF5002E1451\" target=\"_blank\" rel=\"noopener\">DSC模块之Modbus通讯（以PLC为例）</a></p>\n<p><a href=\"http://www.modbustools.com/modbus.html\" target=\"_blank\" rel=\"noopener\">Mobus协议描述</a></p>\n<p><a href=\"http://www.founderchip.com/?id=65\" target=\"_blank\" rel=\"noopener\">我是ModBus-RTU协议，我有两兄弟</a></p>\n<p><a href=\"https://blog.csdn.net/brucezcg/article/details/70340361\" target=\"_blank\" rel=\"noopener\">ModBus-RTU详解</a></p>\n<p><a href=\"https://www.zhihu.com/question/27707815\" target=\"_blank\" rel=\"noopener\">串行口，spi，RS232，RS485，RJ45口以及Modbus协议，这些的区别和共同点是什么？</a></p>\n<p><a href=\"http://www.cnblogs.com/Dn9x/p/4298146.html\" target=\"_blank\" rel=\"noopener\">Modbus: 1. Java使用Modbus读取Slave端数据(TCP)</a></p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/24134130\" target=\"_blank\" rel=\"noopener\">使用MODBUS通讯协议连接电机及简单调试</a></p>\n<p><a href=\"https://www.jianshu.com/nb/13030496\" target=\"_blank\" rel=\"noopener\">Java Modbus系列</a></p>\n<p><a href=\"http://www.cnblogs.com/luomingui/archive/2013/06/14/Modbus.html\" target=\"_blank\" rel=\"noopener\">Modbus通讯协议学习 - 认识篇</a></p>\n<p><a href=\"http://www.cnblogs.com/koneloong/p/5218136.html\" target=\"_blank\" rel=\"noopener\">Java Modbus CRC16校验</a></p>\n<p><a href=\"https://www.jianshu.com/p/157e14396f3b\" target=\"_blank\" rel=\"noopener\">java实现上位机与下位机串口通信</a></p>\n<p><a href=\"https://blog.csdn.net/tt094534/article/details/54928878?locationNum=11&fps=1\" target=\"_blank\" rel=\"noopener\"> modbus slave和modbus poll使用 </a></p>\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><p><a href=\"http://jlog.org/rxtx-win.html\" target=\"_blank\" rel=\"noopener\">解决windows RXTXcomm.jar 平台问题</a></p>\n","categories":["入门"],"tags":["通讯协议","modbus"]},{"title":"MySQL基础（二）","url":"/posts/985694764/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<ul>\n<li>在 <a href=\"https://z201.cn/2018/04/29/MySQL%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B8%80%EF%BC%89/\">MySQL基础（一）</a> 已经介绍了MYSQL最常用基础的操作，由于篇幅已经很大，所以分开记录。</li>\n</ul>\n<h2 id=\"MySql基础操作\"><a href=\"#MySql基础操作\" class=\"headerlink\" title=\"MySql基础操作\"></a>MySql基础操作</h2><h3 id=\"子查询与连接\"><a href=\"#子查询与连接\" class=\"headerlink\" title=\"子查询与连接\"></a>子查询与连接</h3><blockquote>\n<p>在MYSQL实际操作中，最大的操作就是查询，下面就关于子查询和链接做记录。</p>\n</blockquote>\n<h4 id=\"子查询\"><a href=\"#子查询\" class=\"headerlink\" title=\"子查询\"></a>子查询</h4><ul>\n<li>子查询(SubQuery)是指出现在其它SQL语句中的SELECT子句。比如</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">SELECT * FROM table_1 AS t1 WHERE columns_1 &#x3D; (SELECT columns_2 FROM table_2 AS t2);</span><br><span class=\"line\"># 这里的SELECT * FROM table_1 AS t1 称之为 Outer Query&#x2F;Outer Statement;SELECT columns_2 FROM table_2 AS t2 成为 SubQuery。</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>子查询严格以上是指<code>嵌套在查询内部，且必须始终出现在圆括号内</code></li>\n<li>子查询可以包含多个关键字：<code>DISTINCT</code>、<code>GROUP BY</code>、<code>ORDER BY</code>、<code>LIMIT</code>等函数。</li>\n<li>子查询的外层可以是：<code>INSERT</code>、<code>UPDATE</code>、<code>SELECT </code>、<code>DELETE</code>、<code>SET</code>、<code>DO</code>等操作。</li>\n<li>子查询可以返回结果，这个结果可以是<code>标量</code>、<code>一行</code>、<code>一列</code>，或者子查询。</li>\n<li>子查询的引发条件：<code>这里需要特别注意，并不是显示的才是子查询。</code><ul>\n<li>使用比较运算符的子查询：<code>= , &gt; , &lt; , &gt;= , &lt;= , &lt;&gt; , != , &lt;=&gt; </code></li>\n<li>使用结构语法：operand comparison_operator subquery ，可以使用一下修饰符来配合比较运算符。<ul>\n<li>operand comparison_operator <code>ANY</code>(subquery)</li>\n<li>operand comparison_operator <code>SOME</code>(subquery)</li>\n<li>operand comparison_operator <code>ALL</code>(subquery)</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>运算符\\关键字</th>\n<th>ANY</th>\n<th>SOME</th>\n<th>ALL</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>&gt;</code> 、<code>&gt;=</code></td>\n<td>最大值</td>\n<td>最小值</td>\n<td>最大</td>\n</tr>\n<tr>\n<td><code>&lt;</code>、<code>&lt;=</code></td>\n<td>最大值</td>\n<td>最大值</td>\n<td>最小值</td>\n</tr>\n<tr>\n<td><code>=</code></td>\n<td>任意值</td>\n<td>任意值</td>\n<td></td>\n</tr>\n<tr>\n<td><code>&lt;&gt;</code>、<code>!=</code></td>\n<td></td>\n<td></td>\n<td>任意值</td>\n</tr>\n</tbody></table>\n<a id=\"more\"></a>\n\n<ul>\n<li>首先创建一个测试表，并准备测试数据。我们用最经典商城goods表来做测试。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建测试表t_goods</span><br><span class=\"line\">[root@localhost][Demo]&gt; CREATE TABLE t_goods(</span><br><span class=\"line\">    -&gt; goods_id SMALLINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,</span><br><span class=\"line\">    -&gt; goods_name VARCHAR(150) NOT NULL,</span><br><span class=\"line\">    -&gt; godds_cate VARCHAR(40)  NOT NULL,</span><br><span class=\"line\">    -&gt; goods_price DECIMAL(16,3) UNSIGNED NOT NULL DEFAULT 0,</span><br><span class=\"line\">    -&gt; brand_name VARCHAR(40) NOT NULL,</span><br><span class=\"line\">    -&gt; is_show BOOLEAN NOT NULL DEFAULT 1,</span><br><span class=\"line\">    -&gt; is_saleoff BOOLEAN NOT NULL DEFAULT 0</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.13 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 哎哟写错了字段名字了。。。</span><br><span class=\"line\">[root@localhost][Demo]&gt; ALTER TABLE t_goods CHANGE godds_cate goods_cate VARCHAR(40) NOT NULL;</span><br><span class=\"line\">Query OK, 0 rows affected (0.14 sec)</span><br><span class=\"line\">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\">#检查表结构</span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW COLUMNS FROM t_goods;</span><br><span class=\"line\">+-------------+------------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| Field       | Type                   | Null | Key | Default | Extra          |</span><br><span class=\"line\">+-------------+------------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| goods_id    | smallint(5) unsigned   | NO   | PRI | NULL    | auto_increment |</span><br><span class=\"line\">| goods_name  | varchar(150)           | NO   |     | NULL    |                |</span><br><span class=\"line\">| goods_cate  | varchar(40)            | NO   |     | NULL    |                |</span><br><span class=\"line\">| goods_price | decimal(16,3) unsigned | NO   |     | 0.000   |                |</span><br><span class=\"line\">| brand_name  | varchar(40)            | NO   |     | NULL    |                |</span><br><span class=\"line\">| is_show     | tinyint(1)             | NO   |     | 1       |                |</span><br><span class=\"line\">| is_saleoff  | tinyint(1)             | NO   |     | 0       |                |</span><br><span class=\"line\">+-------------+------------------------+------+-----+---------+----------------+</span><br><span class=\"line\">7 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>这里需要注意的是price价格，并没有使用浮点型，笔者之前公司用的是TINTINT就是存到分。这里用的是DECIMAL定点型，保证金额的准确。</li>\n</ul>\n<!--more-->\n\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 添加测试数据</span><br><span class=\"line\">INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;R510VC 15.6英寸笔记本&#39;,&#39;笔记本&#39;,&#39;华硕&#39;,&#39;3399&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;Y400N 14.0英寸笔记本电脑&#39;,&#39;笔记本&#39;,&#39;联想&#39;,&#39;4899&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;G150TH 15.6英寸游戏本&#39;,&#39;游戏本&#39;,&#39;雷神&#39;,&#39;8499&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;X550CC 15.6英寸笔记本&#39;,&#39;笔记本&#39;,&#39;华硕&#39;,&#39;2799&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;X240(20ALA0EYCD) 12.5英寸超极本&#39;,&#39;超级本&#39;,&#39;联想&#39;,&#39;4999&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;U330P 13.3英寸超极本&#39;,&#39;超级本&#39;,&#39;联想&#39;,&#39;4299&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;SVP13226SCB 13.3英寸触控超极本&#39;,&#39;超级本&#39;,&#39;索尼&#39;,&#39;7999&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;iPad mini MD531CH&#x2F;A 7.9英寸平板电脑&#39;,&#39;平板电脑&#39;,&#39;苹果&#39;,&#39;1998&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;iPad Air MD788CH&#x2F;A 9.7英寸平板电脑 （16G WiFi版）&#39;,&#39;平板电脑&#39;,&#39;苹果&#39;,&#39;3388&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39; iPad mini ME279CH&#x2F;A 配备 Retina 显示屏 7.9英寸平板电脑 （16G WiFi版）&#39;,&#39;平板电脑&#39;,&#39;苹果&#39;,&#39;2788&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;IdeaCentre C340 20英寸一体电脑 &#39;,&#39;台式机&#39;,&#39;联想&#39;,&#39;3499&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;Vostro 3800-R1206 台式电脑&#39;,&#39;台式机&#39;,&#39;戴尔&#39;,&#39;2899&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;iMac ME086CH&#x2F;A 21.5英寸一体电脑&#39;,&#39;台式机&#39;,&#39;苹果&#39;,&#39;9188&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;AT7-7414LP 台式电脑 （i5-3450四核 4G 500G 2G独显 DVD 键鼠 Linux ）&#39;,&#39;台式机&#39;,&#39;宏碁&#39;,&#39;3699&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;Z220SFF F4F06PA工作站&#39;,&#39;服务器&#x2F;工作站&#39;,&#39;惠普&#39;,&#39;4288&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;PowerEdge T110 II服务器&#39;,&#39;服务器&#x2F;工作站&#39;,&#39;戴尔&#39;,&#39;5388&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;Mac Pro MD878CH&#x2F;A 专业级台式电脑&#39;,&#39;服务器&#x2F;工作站&#39;,&#39;苹果&#39;,&#39;28888&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39; HMZ-T3W 头戴显示设备&#39;,&#39;笔记本配件&#39;,&#39;索尼&#39;,&#39;6999&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;商务双肩背包&#39;,&#39;笔记本配件&#39;,&#39;索尼&#39;,&#39;99&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;X3250 M4机架式服务器 2583i14&#39;,&#39;服务器&#x2F;工作站&#39;,&#39;IBM&#39;,&#39;6888&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;玄龙精英版 笔记本散热器&#39;,&#39;笔记本配件&#39;,&#39;九州风神&#39;,&#39;&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39; HMZ-T3W 头戴显示设备&#39;,&#39;笔记本配件&#39;,&#39;索尼&#39;,&#39;6999&#39;,DEFAULT,DEFAULT);</span><br><span class=\"line\"> INSERT t_goods (goods_name,goods_cate,brand_name,goods_price,is_show,is_saleoff) VALUES(&#39;商务双肩背包&#39;,&#39;笔记本配件&#39;,&#39;索尼&#39;,&#39;99&#39;,DEFAULT,DEFAULT);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>我们检查下数据，这里贴图片。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/mysql/t_goods.jpg\"></p>\n<ul>\n<li>当然还另外一种显示方式 <code>SELECT * FROM t_goods \\G:</code></li>\n<li>另外goods_name名称中存在空格，我们使用 <code>TRIM</code>函数处理一下。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 更新goods_name字段。</span><br><span class=\"line\">[root@localhost][Demo]&gt; UPDATE t_goods SET goods_name &#x3D; TRIM(goods_name);</span><br><span class=\"line\">Query OK, 4 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>这里使用一些聚合函数来做测试比如<code>AVG</code>、<code>SUM</code>、<code>MIN</code>、<code>MAX</code>。</li>\n</ul>\n<h5 id=\"使用-运算符-的子查询\"><a href=\"#使用-运算符-的子查询\" class=\"headerlink\" title=\"使用 运算符 的子查询\"></a>使用 运算符 的子查询</h5><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 获取goods_price的平均值。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT AVG(goods_price) FROM t_goods;</span><br><span class=\"line\">+------------------+</span><br><span class=\"line\">| AVG(goods_price) |</span><br><span class=\"line\">+------------------+</span><br><span class=\"line\">|     5636.3636364 |</span><br><span class=\"line\">+------------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 查询价格大于平均值的商品。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT goods_id , goods_name , goods_price FROM t_goods WHERE goods_price &gt;&#x3D; 5636;</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">| goods_id | goods_name                              | goods_price |</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">|        3 | G150TH 15.6英寸游戏本                   |    8499.000 |</span><br><span class=\"line\">|        7 | SVP13226SCB 13.3英寸触控超极本          |    7999.000 |</span><br><span class=\"line\">|       13 | iMac ME086CH&#x2F;A 21.5英寸一体电脑         |    9188.000 |</span><br><span class=\"line\">|       17 | Mac Pro MD878CH&#x2F;A 专业级台式电脑        |   28888.000 |</span><br><span class=\"line\">|       18 | HMZ-T3W 头戴显示设备                    |    6999.000 |</span><br><span class=\"line\">|       20 | X3250 M4机架式服务器 2583i14            |    6888.000 |</span><br><span class=\"line\">|       21 | HMZ-T3W 头戴显示设备                    |    6999.000 |</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">7 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">#那么问题来了，我们想一条SQL语句就完成该怎么处理。使用子查询就可以满足。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT goods_id , goods_name , goods_price FROM t_goods WHERE goods_price &gt;&#x3D; (SELECT AVG(goods_price) FROM t_goods );</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">| goods_id | goods_name                              | goods_price |</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">|        3 | G150TH 15.6英寸游戏本                   |    8499.000 |</span><br><span class=\"line\">|        7 | SVP13226SCB 13.3英寸触控超极本          |    7999.000 |</span><br><span class=\"line\">|       13 | iMac ME086CH&#x2F;A 21.5英寸一体电脑         |    9188.000 |</span><br><span class=\"line\">|       17 | Mac Pro MD878CH&#x2F;A 专业级台式电脑        |   28888.000 |</span><br><span class=\"line\">|       18 | HMZ-T3W 头戴显示设备                    |    6999.000 |</span><br><span class=\"line\">|       20 | X3250 M4机架式服务器 2583i14            |    6888.000 |</span><br><span class=\"line\">|       21 | HMZ-T3W 头戴显示设备                    |    6999.000 |</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">7 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 在来演示下查询 goods_cate 是超级本的商品信息。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT goods_id , goods_name , goods_price , goods_cate FROM t_goods WHERE goods_cate &#x3D; &#39;超级本&#39;;</span><br><span class=\"line\">+----------+---------------------------------------+-------------+------------+</span><br><span class=\"line\">| goods_id | goods_name                            | goods_price | goods_cate |</span><br><span class=\"line\">+----------+---------------------------------------+-------------+------------+</span><br><span class=\"line\">|        5 | X240(20ALA0EYCD) 12.5英寸超极本       |    4999.000 | 超级本     |</span><br><span class=\"line\">|        6 | U330P 13.3英寸超极本                  |    4299.000 | 超级本     |</span><br><span class=\"line\">|        7 | SVP13226SCB 13.3英寸触控超极本        |    7999.000 | 超级本     |</span><br><span class=\"line\">+----------+---------------------------------------+-------------+------------+</span><br><span class=\"line\">3 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 实际上在子查询中，经常会出现返回的值不是一条的问题。如下演示，我们想要查询goods_cate是超极本的商品价格。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT goods_id , goods_name , goods_price FROM t_goods WHERE goods_price &gt;&#x3D; ( SELECT goods_price FROM t_goods WHERE goods_cate &#x3D; &#39;超级本&#39; );</span><br><span class=\"line\">ERROR 1242 (21000): Subquery returns more than 1 row</span><br><span class=\"line\"># 这里会抛出异常，指明返回的结果集超过了一行。</span><br><span class=\"line\"></span><br><span class=\"line\">#上面的列子中，使用了比较运算符，所以可以使用子查询。那配合修饰关键字试试。</span><br><span class=\"line\"># 使用大于等于 &gt;&#x3D; 添加ANY关键字的时候，获取最小的。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT goods_id , goods_name , goods_price FROM t_goods WHERE goods_price &gt;&#x3D; ANY( SELECT goods_price FROM t_goods WHERE goods_cate &#x3D; &#39;超级本&#39; );</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">| goods_id | goods_name                              | goods_price |</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">|        2 | Y400N 14.0英寸笔记本电脑                |    4899.000 |</span><br><span class=\"line\">|        3 | G150TH 15.6英寸游戏本                   |    8499.000 |</span><br><span class=\"line\">|        5 | X240(20ALA0EYCD) 12.5英寸超极本         |    4999.000 |</span><br><span class=\"line\">|        6 | U330P 13.3英寸超极本                    |    4299.000 |</span><br><span class=\"line\">|        7 | SVP13226SCB 13.3英寸触控超极本          |    7999.000 |</span><br><span class=\"line\">|       13 | iMac ME086CH&#x2F;A 21.5英寸一体电脑         |    9188.000 |</span><br><span class=\"line\">|       16 | PowerEdge T110 II服务器                 |    5388.000 |</span><br><span class=\"line\">|       17 | Mac Pro MD878CH&#x2F;A 专业级台式电脑        |   28888.000 |</span><br><span class=\"line\">|       18 | HMZ-T3W 头戴显示设备                    |    6999.000 |</span><br><span class=\"line\">|       20 | X3250 M4机架式服务器 2583i14            |    6888.000 |</span><br><span class=\"line\">|       21 | HMZ-T3W 头戴显示设备                    |    6999.000 |</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">11 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 使用大于等于 &gt;&#x3D; 添加SOME关键字 依然是最小。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT goods_id , goods_name , goods_price FROM t_goods WHERE goods_price &gt;&#x3D; SOME( SELECT goods_price FROM t_goods WHERE goods_cate &#x3D; &#39;超级本&#39; );</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">| goods_id | goods_name                              | goods_price |</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">|        2 | Y400N 14.0英寸笔记本电脑                |    4899.000 |</span><br><span class=\"line\">|        3 | G150TH 15.6英寸游戏本                   |    8499.000 |</span><br><span class=\"line\">|        5 | X240(20ALA0EYCD) 12.5英寸超极本         |    4999.000 |</span><br><span class=\"line\">|        6 | U330P 13.3英寸超极本                    |    4299.000 |</span><br><span class=\"line\">|        7 | SVP13226SCB 13.3英寸触控超极本          |    7999.000 |</span><br><span class=\"line\">|       13 | iMac ME086CH&#x2F;A 21.5英寸一体电脑         |    9188.000 |</span><br><span class=\"line\">|       16 | PowerEdge T110 II服务器                 |    5388.000 |</span><br><span class=\"line\">|       17 | Mac Pro MD878CH&#x2F;A 专业级台式电脑        |   28888.000 |</span><br><span class=\"line\">|       18 | HMZ-T3W 头戴显示设备                    |    6999.000 |</span><br><span class=\"line\">|       20 | X3250 M4机架式服务器 2583i14            |    6888.000 |</span><br><span class=\"line\">|       21 | HMZ-T3W 头戴显示设备                    |    6999.000 |</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">11 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 使用大于等于 &gt;&#x3D; 添加ALL关键字 则是最大。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT goods_id , goods_name , goods_price FROM t_goods WHERE goods_price &gt;&#x3D; ALL( SELECT goods_price FROM t_goods WHERE goods_cate &#x3D; &#39;超级本&#39; );</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">| goods_id | goods_name                              | goods_price |</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">|        3 | G150TH 15.6英寸游戏本                   |    8499.000 |</span><br><span class=\"line\">|        7 | SVP13226SCB 13.3英寸触控超极本          |    7999.000 |</span><br><span class=\"line\">|       13 | iMac ME086CH&#x2F;A 21.5英寸一体电脑         |    9188.000 |</span><br><span class=\"line\">|       17 | Mac Pro MD878CH&#x2F;A 专业级台式电脑        |   28888.000 |</span><br><span class=\"line\">+----------+-----------------------------------------+-------------+</span><br><span class=\"line\">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>通过 &gt;= 配合 <code>ANY</code>、<code>SOME</code> 、<code>ALL</code>关键做了测试，那么其它几种运算符就不演示了。</li>\n</ul>\n<h5 id=\"使用-NOT-IN-的子查询\"><a href=\"#使用-NOT-IN-的子查询\" class=\"headerlink\" title=\"使用 [ NOT ] IN 的子查询\"></a>使用 <code>[ NOT ] IN 的子查询</code></h5><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 这个操作相对比较好理解 IN 包含 NOT IN 不包含</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT goods_id , goods_name , goods_price FROM t_goods WHERE goods_price IN  ( SELECT goods_price FROM t_goods WHERE goods_cate &#x3D; &#39;超级本&#39; );</span><br><span class=\"line\">+----------+---------------------------------------+-------------+</span><br><span class=\"line\">| goods_id | goods_name                            | goods_price |</span><br><span class=\"line\">+----------+---------------------------------------+-------------+</span><br><span class=\"line\">|        5 | X240(20ALA0EYCD) 12.5英寸超极本       |    4999.000 |</span><br><span class=\"line\">|        6 | U330P 13.3英寸超极本                  |    4299.000 |</span><br><span class=\"line\">|        7 | SVP13226SCB 13.3英寸触控超极本        |    7999.000 |</span><br><span class=\"line\">+----------+---------------------------------------+-------------+</span><br><span class=\"line\">3 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 使用NOT IN 就和上面的结果截然相反</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT goods_id, goods_price FROM t_goods WHERE goods_price NOT  IN  ( SELECT goods_price FROM t_goods WHERE goods_cate &#x3D; &#39;超级本&#39; ); </span><br><span class=\"line\">+----------+-------------+</span><br><span class=\"line\">| goods_id | goods_price |</span><br><span class=\"line\">+----------+-------------+</span><br><span class=\"line\">|        1 |    3399.000 |</span><br><span class=\"line\">|        2 |    4899.000 |</span><br><span class=\"line\">|        3 |    8499.000 |</span><br><span class=\"line\">|        4 |    2799.000 |</span><br><span class=\"line\">|        8 |    1998.000 |</span><br><span class=\"line\">|        9 |    3388.000 |</span><br><span class=\"line\">|       10 |    2788.000 |</span><br><span class=\"line\">|       11 |    3499.000 |</span><br><span class=\"line\">|       12 |    2899.000 |</span><br><span class=\"line\">|       13 |    9188.000 |</span><br><span class=\"line\">|       14 |    3699.000 |</span><br><span class=\"line\">|       15 |    4288.000 |</span><br><span class=\"line\">|       16 |    5388.000 |</span><br><span class=\"line\">|       17 |   28888.000 |</span><br><span class=\"line\">|       18 |    6999.000 |</span><br><span class=\"line\">|       19 |      99.000 |</span><br><span class=\"line\">|       20 |    6888.000 |</span><br><span class=\"line\">|       21 |    6999.000 |</span><br><span class=\"line\">|       22 |      99.000 |</span><br><span class=\"line\">+----------+-------------+</span><br><span class=\"line\">19 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"使用-NOT-EXISTS-子查询\"><a href=\"#使用-NOT-EXISTS-子查询\" class=\"headerlink\" title=\"使用[NOT] EXISTS 子查询\"></a>使用<code>[NOT] EXISTS</code> 子查询</h5><ul>\n<li>为了演示该子查询，需要在添加一张表与其配合。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建一张t_goods_cate表存储商品分类信息。</span><br><span class=\"line\">[root@localhost][Demo]&gt; CREATE TABLE IF NOT EXISTS t_goods_cates(</span><br><span class=\"line\">    -&gt; cate_id SMALLINT UNSIGNED PRIMARY KEY AUTO_INCREMENT ,</span><br><span class=\"line\">    -&gt; cate_name VARCHAR(40) NOT NULL</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.07 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW COLUMNS FROM  t_goods_cates;</span><br><span class=\"line\">+-----------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| Field     | Type                 | Null | Key | Default | Extra          |</span><br><span class=\"line\">+-----------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| cate_id   | smallint(5) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class=\"line\">| cate_name | varchar(40)          | NO   |     | NULL    |                |</span><br><span class=\"line\">+-----------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 现在这张表的数据是空的，需要将t_goods 中 goods_cate信息写入进来。</span><br><span class=\"line\"># 先看t_goods 有哪些分类；这里使用GROUP BY 来做分组查询。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT goods_cate FROM t_goods GROUP BY goods_cate;</span><br><span class=\"line\">+---------------------+</span><br><span class=\"line\">| goods_cate          |</span><br><span class=\"line\">+---------------------+</span><br><span class=\"line\">| 台式机              |</span><br><span class=\"line\">| 平板电脑            |</span><br><span class=\"line\">| 服务器&#x2F;工作站       |</span><br><span class=\"line\">| 游戏本              |</span><br><span class=\"line\">| 笔记本              |</span><br><span class=\"line\">| 笔记本配件          |</span><br><span class=\"line\">| 超级本              |</span><br><span class=\"line\">+---------------------+</span><br><span class=\"line\">7 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 使用INSERT...SEKECT 方式来插入数据到t_goods_cates。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT INTO t_goods_cates(cate_name) SELECT goods_cate FROM t_goods GROUP BY goods_cate;</span><br><span class=\"line\">Query OK, 7 rows affected (0.01 sec)</span><br><span class=\"line\">Records: 7  Duplicates: 0  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\"># OK检查下数据是否录入成功。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM t_goods_cates;</span><br><span class=\"line\">+---------+---------------------+</span><br><span class=\"line\">| cate_id | cate_name           |</span><br><span class=\"line\">+---------+---------------------+</span><br><span class=\"line\">|       1 | 台式机              |</span><br><span class=\"line\">|       2 | 平板电脑            |</span><br><span class=\"line\">|       3 | 服务器&#x2F;工作站       |</span><br><span class=\"line\">|       4 | 游戏本              |</span><br><span class=\"line\">|       5 | 笔记本              |</span><br><span class=\"line\">|       6 | 笔记本配件          |</span><br><span class=\"line\">|       7 | 超级本              |</span><br><span class=\"line\">+---------+---------------------+</span><br><span class=\"line\">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>这个时候打算把操作反过来，让t_goods 表中的 goods_cate 存储 t_goods_cates 中的主键信息。而不在存储内容。</li>\n</ul>\n<h4 id=\"连接查询\"><a href=\"#连接查询\" class=\"headerlink\" title=\"连接查询\"></a>连接查询</h4><ul>\n<li>将多张表（至少大于等于2张表）按照某张指定的条件成立进行查询。</li>\n</ul>\n<p><code>table_reference { [INNER | CROSS] JOIN | { LEFT | RIGHT } JOIN} table_reference ON conditional_expr </code></p>\n<ul>\n<li>连接类型<ul>\n<li><code>INNER JOIN</code>内连接</li>\n<li>在Mysql中 <code>JOIN , CROSS JION 和 INNER JOIN </code>是等价的。</li>\n<li><code>LEFT [OUTER] JOIN</code> 左外连接。</li>\n<li><code>RIGHT [OUTER] JOIN</code> 右外连接。</li>\n</ul>\n</li>\n<li>连接条件<ul>\n<li>可以使用ON来设置连接条件，也可以使用WHERE来代替。</li>\n<li>但是通常使用ON关键字来设置条件，WHERE关键进行结果集的过滤。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 使用INNER JOIN 内连接来完成t_goods表中 goods_cate字段记录的更新。</span><br><span class=\"line\">[root@localhost][Demo]&gt; UPDATE t_goods INNER JOIN t_goods_cates ON t_goods.goods_cate &#x3D; t_goods_cates.cate_name SET t_goods.goods_cate &#x3D; t_goods_cates.cate_id;</span><br><span class=\"line\">Query OK, 22 rows affected (0.01 sec)</span><br><span class=\"line\">Rows matched: 22  Changed: 22  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\"># 那我们在检查一下</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT goods_id  , goods_cate FROM t_goods;</span><br><span class=\"line\">+----------+------------+</span><br><span class=\"line\">| goods_id | goods_cate |</span><br><span class=\"line\">+----------+------------+</span><br><span class=\"line\">|        1 | 5          |</span><br><span class=\"line\">|        2 | 5          |</span><br><span class=\"line\">|        3 | 4          |</span><br><span class=\"line\">|        4 | 5          |</span><br><span class=\"line\">|        5 | 7          |</span><br><span class=\"line\">|        6 | 7          |</span><br><span class=\"line\">|        7 | 7          |</span><br><span class=\"line\">|        8 | 2          |</span><br><span class=\"line\">|        9 | 2          |</span><br><span class=\"line\">|       10 | 2          |</span><br><span class=\"line\">|       11 | 1          |</span><br><span class=\"line\">|       12 | 1          |</span><br><span class=\"line\">|       13 | 1          |</span><br><span class=\"line\">|       14 | 1          |</span><br><span class=\"line\">|       15 | 3          |</span><br><span class=\"line\">|       16 | 3          |</span><br><span class=\"line\">|       17 | 3          |</span><br><span class=\"line\">|       18 | 6          |</span><br><span class=\"line\">|       19 | 6          |</span><br><span class=\"line\">|       20 | 3          |</span><br><span class=\"line\">|       21 | 6          |</span><br><span class=\"line\">|       22 | 6          |</span><br><span class=\"line\">+----------+------------+</span><br><span class=\"line\">22 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 这里最好将t_goods 里面 goods_cate 的字段类型修改一下，毕竟已经不是存储字符串了，而是存储关联表主键。</span><br><span class=\"line\"># 将t_goods 表中 goods_cate 修改成 cate_id 类型为 SMALLINT UNSIGNED;</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost][Demo]&gt; ALTER TABLE t_goods MODIFY cate_id SMALLINT UNSIGNED NOT NULL;</span><br><span class=\"line\">Query OK, 0 rows affected (0.22 sec)</span><br><span class=\"line\">Records: 22  Duplicates: 0  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\"># t_goods表中有一个字段 brand_name 在此对表进行改造。这里创建一张品牌表 t_goods_brand。</span><br><span class=\"line\">[root@localhost][Demo]&gt; CREATE TABLE t_goods_brand(</span><br><span class=\"line\">    -&gt; id SMALLINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,</span><br><span class=\"line\">    -&gt; brand_name VARCHAR(40) NOT NULL</span><br><span class=\"line\">    -&gt; )</span><br><span class=\"line\">    -&gt; ;</span><br><span class=\"line\">Query OK, 0 rows affected (0.11 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 检查表结构</span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW COLUMNS FROM t_goods_brand;</span><br><span class=\"line\">+------------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| Field      | Type                 | Null | Key | Default | Extra          |</span><br><span class=\"line\">+------------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| id         | smallint(5) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class=\"line\">| brand_name | varchar(40)          | NO   |     | NULL    |                |</span><br><span class=\"line\">+------------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 将t_goods表中的brand_name 去重后添加到t_goods_brand中。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT t_goods_brand(brand_name) SELECT brand_name FROM t_goods GROUP BY brand_name;</span><br><span class=\"line\">Query OK, 9 rows affected (0.01 sec)</span><br><span class=\"line\">Records: 9  Duplicates: 0  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\"># 查询结果</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM t_goods_brand;</span><br><span class=\"line\">+----+------------+</span><br><span class=\"line\">| id | brand_name |</span><br><span class=\"line\">+----+------------+</span><br><span class=\"line\">|  1 | IBM        |</span><br><span class=\"line\">|  2 | 华硕       |</span><br><span class=\"line\">|  3 | 宏碁       |</span><br><span class=\"line\">|  4 | 惠普       |</span><br><span class=\"line\">|  5 | 戴尔       |</span><br><span class=\"line\">|  6 | 索尼       |</span><br><span class=\"line\">|  7 | 联想       |</span><br><span class=\"line\">|  8 | 苹果       |</span><br><span class=\"line\">|  9 | 雷神       |</span><br><span class=\"line\">+----+------------+</span><br><span class=\"line\">9 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 更新t_goods表中brand_name 字段时期存储t_goods_brand主键信息。</span><br><span class=\"line\">[root@localhost][Demo]&gt; UPDATE t_goods INNER JOIN t_goods_brand ON t_goods.brand_name &#x3D; t_goods_brand.brand_name SET t_goods.braand_name &#x3D; t_goods_brand.id;</span><br><span class=\"line\">Query OK, 22 rows affected (0.01 sec)</span><br><span class=\"line\">Rows matched: 22  Changed: 22  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\"># 检查下效果</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT goods_id , brand_name FROM t_goods;</span><br><span class=\"line\">+----------+------------+</span><br><span class=\"line\">| goods_id | brand_name |</span><br><span class=\"line\">+----------+------------+</span><br><span class=\"line\">|        1 | 2          |</span><br><span class=\"line\">|        2 | 7          |</span><br><span class=\"line\">|        3 | 9          |</span><br><span class=\"line\">|        4 | 2          |</span><br><span class=\"line\">|        5 | 7          |</span><br><span class=\"line\">|        6 | 7          |</span><br><span class=\"line\">|        7 | 6          |</span><br><span class=\"line\">|        8 | 8          |</span><br><span class=\"line\">|        9 | 8          |</span><br><span class=\"line\">|       10 | 8          |</span><br><span class=\"line\">|       11 | 7          |</span><br><span class=\"line\">|       12 | 5          |</span><br><span class=\"line\">|       13 | 8          |</span><br><span class=\"line\">|       14 | 3          |</span><br><span class=\"line\">|       15 | 4          |</span><br><span class=\"line\">|       16 | 5          |</span><br><span class=\"line\">|       17 | 8          |</span><br><span class=\"line\">|       18 | 6          |</span><br><span class=\"line\">|       19 | 6          |</span><br><span class=\"line\">|       20 | 1          |</span><br><span class=\"line\">|       21 | 6          |</span><br><span class=\"line\">|       22 | 6          |</span><br><span class=\"line\">+----------+------------+</span><br><span class=\"line\">22 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># OK 再把t_goods 中 brand_name 字段进行修改。</span><br><span class=\"line\">[root@localhost][Demo]&gt; ALTER TABLE t_goods CHANGE brand_name brand_id SMALLINT UNSIGNED NOT NULL;</span><br><span class=\"line\">Query OK, 22 rows affected (0.22 sec)</span><br><span class=\"line\">Records: 22  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>为什么一定要修改字段的属性，这样做主要是为了做适当调整结构。数字和字符串占用的大小要小的多。</li>\n<li>这里t_goods 表中的 <code>cate_id</code> 和<code>brand_id </code>由于不是物理外键，所以约束机会没有。也就是说哪怕插入t_goods表的时候，<code>cate_id</code> 和 <code>brand_id</code> 在t_goods_cates 和 t_goods_brand表中都不存在，依然是可以插入。但是数据不完整。</li>\n</ul>\n<h5 id=\"内连接\"><a href=\"#内连接\" class=\"headerlink\" title=\"内连接\"></a>内连接</h5><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/mysql/mysql_inner_join.jpg\"></p>\n<ul>\n<li>内连接查询的是相交部分的数据</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/mysql/inner_join.jpg\"></p>\n<h5 id=\"左外连接\"><a href=\"#左外连接\" class=\"headerlink\" title=\"左外连接\"></a>左外连接</h5><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/mysql/mysq_left_join.jpg\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 这里为了演示其效果，我们在t_goods表中添加一个模拟数据，这条数据的cates_id 是不存在与t_goods_cates表中的。</span><br><span class=\"line\">INSERT t_goods(goods_name,cate_id,brand_id,goods_price) VALUES(&#39; LaserJet Pro P1606dn 黑白激光打印机&#39;,&#39;12&#39;,&#39;4&#39;,&#39;1849&#39;);</span><br><span class=\"line\">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>将<code>INNER JOIN 改成 LEFT JOIN </code>看看结果</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/mysql/left_join.jpg\"></p>\n<ul>\n<li>这里可以看低23条记录的cate_name是null。</li>\n</ul>\n<h5 id=\"右外连接\"><a href=\"#右外连接\" class=\"headerlink\" title=\"右外连接\"></a>右外连接</h5><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/mysql/mysql_right_join.jpg\"></p>\n<ul>\n<li>将<code>LEFT JOIN 改成  RIGHT JOIN</code> 试试。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 在 t_goods_cates 表中添加记录</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT t_goods_cates(cate_name) VALUES(&#39;路由器&#39;),(&#39;交换机&#39;),(&#39;网卡&#39;);</span><br><span class=\"line\">Query OK, 3 rows affected (0.01 sec)</span><br><span class=\"line\">Records: 3  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/mysql/right_join.jpg\"></p>\n<ul>\n<li>这里可以看到优先显示t_goods_cates表中的数据。和左外连接刚刚好相反。</li>\n</ul>\n<h5 id=\"多表连接\"><a href=\"#多表连接\" class=\"headerlink\" title=\"多表连接\"></a>多表连接</h5><blockquote>\n<p>现在以及存在t_goods 、 t_goods_cates 、 t_goods_brand 表，这次同时查询一个商品表结果集合。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 内链接三张表查询结果集合。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT g.goods_id , g.goods_name , g.goods_price , gc.cate_name , gb.brand_name FROM t_goods AS g INNER JOIN t_goods_cates AS gc ON g.cate_id &#x3D; gc.cate_id INNER JOIN t_goods_brand AS gb ON g.brand_id &#x3D; gb.id ;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/mysql/%E4%B8%89%E5%BC%A0%E8%A1%A8%E5%86%85%E8%BF%9E%E6%8E%A5%E7%BB%93%E6%9E%9C.jpg\"></p>\n<ul>\n<li>这里只会吧符合内连接条件的数据展示出来。</li>\n</ul>\n<h5 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h5><ul>\n<li><code>t_goods LEFT JOIN t_goods_cates join_condition</code><ul>\n<li>t_goods_cates 表中的结果集依赖 t_goods</li>\n<li>如果使用内连接查找记录在连接数据表中不存在，并且在WHERE 语句中尝试定义了: <code>columns_name IS NULL </code>时（就是这个字段可以为NULL的时候），如果<code>columns_name </code>被定义为<code>NOT NULL</code>（这个字段不能为NULL），Mysql将在找到符合条件的记录后停止搜索更多的行。因为这个操作是冲突的。</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"自连接\"><a href=\"#自连接\" class=\"headerlink\" title=\"自连接\"></a>自连接</h5><blockquote>\n<p>很多情况下，可能会出现一张表自关联，特别是在商城项目的商品类型这种。所以这里在举个例子。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建一张商品类型表t_goods_types</span><br><span class=\"line\">[root@localhost][Demo]&gt; CREATE TABLE t_goods_types(</span><br><span class=\"line\">    -&gt; type_id SMALLINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,</span><br><span class=\"line\">    -&gt; type_name VARCHAR(20) NOT NULL,</span><br><span class=\"line\">    -&gt; parent_id SMALLINT UNSIGNED NOT NULL DEFAULT 0</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.13 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;家用电器&#39;,DEFAULT);</span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;电脑、办公&#39;,DEFAULT);</span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;大家电&#39;,1);</span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;生活电器&#39;,1);</span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;平板电视&#39;,3);</span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;空调&#39;,3);</span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;电风扇&#39;,4);</span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;饮水机&#39;,4);</span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;电脑整机&#39;,2);</span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;电脑配件&#39;,2);</span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;笔记本&#39;,9);</span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;超级本&#39;,9);</span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;游戏本&#39;,9);</span><br><span class=\"line\">  INSERT t_goods_types(type_name,parent_id) VALUES(&#39;CPU&#39;,10);</span><br><span class=\"line\">  INSERT tdb_goods_types(type_name,parent_id) VALUES(&#39;主机&#39;,10);</span><br><span class=\"line\"></span><br><span class=\"line\"># 检查插入数据结果。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM t_goods_types;</span><br><span class=\"line\">+---------+-----------------+-----------+</span><br><span class=\"line\">| type_id | type_name       | parent_id |</span><br><span class=\"line\">+---------+-----------------+-----------+</span><br><span class=\"line\">|       1 | 家用电器        |         0 |</span><br><span class=\"line\">|       2 | 电脑、办公      |         0 |</span><br><span class=\"line\">|       3 | 大家电          |         1 |</span><br><span class=\"line\">|       4 | 生活电器        |         1 |</span><br><span class=\"line\">|       5 | 平板电视        |         3 |</span><br><span class=\"line\">|       6 | 空调            |         3 |</span><br><span class=\"line\">|       7 | 电风扇          |         4 |</span><br><span class=\"line\">|       8 | 饮水机          |         4 |</span><br><span class=\"line\">|       9 | 电脑整机        |         2 |</span><br><span class=\"line\">|      10 | 电脑配件        |         2 |</span><br><span class=\"line\">|      11 | 笔记本          |         9 |</span><br><span class=\"line\">|      12 | 超级本          |         9 |</span><br><span class=\"line\">|      13 | 游戏本          |         9 |</span><br><span class=\"line\">|      14 | CPU             |        10 |</span><br><span class=\"line\">+---------+-----------------+-----------+</span><br><span class=\"line\">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>这里可以看到t_goods_typs中存在一个字段parent_id，如果不是0即表示有上级类别，而上级列表是指type_id。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 尝试查询一次参考子类的信息。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT t.type_id , t.type_name , p.type_name AS parent_name FROM t_goods_types AS t LEFT JOIN t_goods_types AS p ON t.paarent_id &#x3D; p.type_id;</span><br><span class=\"line\">+---------+-----------------+-----------------+</span><br><span class=\"line\">| type_id | type_name       | parent_name     |</span><br><span class=\"line\">+---------+-----------------+-----------------+</span><br><span class=\"line\">|       1 | 家用电器        | NULL            |</span><br><span class=\"line\">|       2 | 电脑、办公      | NULL            |</span><br><span class=\"line\">|       3 | 大家电          | 家用电器        |</span><br><span class=\"line\">|       4 | 生活电器        | 家用电器        |</span><br><span class=\"line\">|       5 | 平板电视        | 大家电          |</span><br><span class=\"line\">|       6 | 空调            | 大家电          |</span><br><span class=\"line\">|       7 | 电风扇          | 生活电器        |</span><br><span class=\"line\">|       8 | 饮水机          | 生活电器        |</span><br><span class=\"line\">|       9 | 电脑整机        | 电脑、办公      |</span><br><span class=\"line\">|      10 | 电脑配件        | 电脑、办公      |</span><br><span class=\"line\">|      11 | 笔记本          | 电脑整机        |</span><br><span class=\"line\">|      12 | 超级本          | 电脑整机        |</span><br><span class=\"line\">|      13 | 游戏本          | 电脑整机        |</span><br><span class=\"line\">|      14 | CPU             | 电脑配件        |</span><br><span class=\"line\">+---------+-----------------+-----------------+</span><br><span class=\"line\">14 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"连接查询小结\"><a href=\"#连接查询小结\" class=\"headerlink\" title=\"连接查询小结\"></a>连接查询小结</h5><blockquote>\n<p>JOIN作为经常使用的关键字之一，使用的是否正确直接影响到查询结果和查询效率。</p>\n</blockquote>\n<p>SQL标准的JOIN类型</p>\n<ul>\n<li>内连接<code>INNER</code></li>\n<li>全外连接<code>FULL OUTER</code> 在mysql中并不能直接使用。</li>\n<li>左外连接<code>LEFT OUTER</code></li>\n<li>右外连接<code>RIGHT OUTER</code></li>\n<li>交叉连接<code>CROSS</code></li>\n</ul>\n","categories":["Mysql"],"tags":["Mysql"]},{"title":"MySQL基础（一）","url":"/posts/181825268/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h2 id=\"Mysql介绍\"><a href=\"#Mysql介绍\" class=\"headerlink\" title=\"Mysql介绍\"></a>Mysql介绍</h2><ul>\n<li>Mysql数据库是一种<code>C\\S</code>结构，就是客户端和服务端。</li>\n<li>关键字<ol>\n<li>DB : <code>DataBase</code> 数据库</li>\n<li>DBMS：<code>Database Management System</code>数据库管理系统</li>\n<li>DBS：<code>Database System = DBMS + DB</code>数据库系统</li>\n<li>DBA：<code>Database Administrator</code> 数据库管理员</li>\n<li>行\\列：二维表中存储的数据。<ol>\n<li>行<code>row\\record</code> （一条记录）。</li>\n<li>列<code>column\\field</code>（一个字段）。</li>\n</ol>\n</li>\n</ol>\n</li>\n<li>SQL</li>\n</ul>\n<blockquote>\n<p>SQL：Structured Query Language，结构化查询语言（数据以查询为主，99% 都是在进行查询操作），SQL是关系型数据库的操作指令，是一种约束，但不强制，类似与W3C，所以不同的关系型数据SQL语句可能会有一定的差异性。</p>\n</blockquote>\n<ul>\n<li>DDL：<code>Data Definition Language</code>数据定义语言，用来维护存储数据的结构（数据库、表），代表指令为<code>create</code>、<code>drop</code>和<code>alter</code>等。</li>\n<li>DML：<code>Data Manipulation Language</code>，数据操作语言，用来对数据进行操作（表中的内容）代表指令为<code>insert</code>、<code>delete</code>和<code>update</code>等，不过在 DML 内部又单独进行了一个分类，即 DQL（Data Query Language），数据查询语言，代表指令为<code>select</code>。</li>\n<li>DCL：<code>Data Control Language</code>，数据控制语言，主要是负责（用户）权限管理，代表指令为<code>grant</code>和<code>revoke</code>等。</li>\n<li>TPL：``,事物控制语言</li>\n</ul>\n<h2 id=\"Mysql基本操作\"><a href=\"#Mysql基本操作\" class=\"headerlink\" title=\"Mysql基本操作\"></a>Mysql基本操作</h2><blockquote>\n<p>本章部分内容在Centos中实现，<a href=\"http://localhost:4000/2018/04/21/Centos7-Mysql5.7%E5%8D%95%E5%AE%9E%E4%BE%8B%E9%83%A8%E7%BD%B2/\" target=\"_blank\" rel=\"noopener\">Centos7-MySql部署记录</a></p>\n</blockquote>\n<h3 id=\"交互方式\"><a href=\"#交互方式\" class=\"headerlink\" title=\"交互方式\"></a>交互方式</h3><a id=\"more\"></a>\n\n<blockquote>\n<p>客户链接认证，即链接服务端，认证 <code>mysql -hPup</code></p>\n</blockquote>\n<ul>\n<li><code>mysql -hPup</code>介绍<ul>\n<li><code>-h</code>  主机地址，本地是localhost或者127.0.0.1，远程为IP地址。</li>\n<li><code>-P</code>端口号，一般默认是3306，所以不指定就是3306。</li>\n<li><code>-u</code>用户名,认证需要用户名。</li>\n<li><code>-p</code>认证用户名，认证用户名对应的密码。</li>\n</ul>\n</li>\n<li>断开链接<ul>\n<li><code>exit</code></li>\n<li><code>quit</code></li>\n<li><code>\\q</code></li>\n</ul>\n</li>\n<li>案例</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ mysql -uroot -pxxxxxxxxxx</span><br></pre></td></tr></table></figure>\n\n<p>xxxx是密码若登陆成功则输出，这里的警告不用太在意，是指登陆没有指定对应的数据库实例。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class=\"line\">Welcome to the MySQL monitor.  Commands end with ; or \\g.</span><br><span class=\"line\">Your MySQL connection id is 2029</span><br><span class=\"line\">Server version: 5.7.22 MySQL Community Server (GPL)</span><br><span class=\"line\"></span><br><span class=\"line\">Copyright (c) 2000, 2018, Oracle and&#x2F;or its affiliates. All rights reserved.</span><br><span class=\"line\"></span><br><span class=\"line\">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class=\"line\">affiliates. Other names may be trademarks of their respective</span><br><span class=\"line\">owners.</span><br><span class=\"line\"></span><br><span class=\"line\">Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement.</span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; \\q；</span><br><span class=\"line\">mysql&gt; exit;</span><br><span class=\"line\">mysql&gt; quit;</span><br></pre></td></tr></table></figure>\n\n<p>这三个指令都是等处操作。</p>\n<h3 id=\"Mysql标识符\"><a href=\"#Mysql标识符\" class=\"headerlink\" title=\"Mysql标识符\"></a>Mysql标识符</h3><blockquote>\n<p>当我们进入mysql命令界面的时候，命令前面会出现一个标识符。我们可以自定义。</p>\n</blockquote>\n<ul>\n<li><code>PROMPT</code>介绍<ul>\n<li>使用<code>PROMPT xxx</code>指定标识符。</li>\n</ul>\n</li>\n<li>案例</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>\\D</td>\n<td>完整的日期</td>\n</tr>\n<tr>\n<td>\\d</td>\n<td>当前数据库</td>\n</tr>\n<tr>\n<td>\\h</td>\n<td>服务器的名称</td>\n</tr>\n<tr>\n<td>\\u</td>\n<td>当前用户名</td>\n</tr>\n</tbody></table>\n<p>我们使用Mysql常用的参数配合<code>PROMPT</code>来自定义提示符信息，默认的刚才我们登陆之后发现默认的提示符是<code>mysql&gt;</code></p>\n<ul>\n<li>这里演示两种使用方式<ol>\n<li>连接客户端的时候通过参数指定。<code>mysql -uroot -pxxxx --prompt xxx</code> xxx分别代表密码和标识符。</li>\n<li>连接客户端之后，通过<code>PROMPT</code>指定。</li>\n<li>通过my.cof配置文件全局设置。</li>\n</ol>\n</li>\n<li>案例</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ mysql -uroot -pxxxxxxxxxx --prpmpt @\\\\h  <span class=\"comment\">#在连接客户端的时候指定需要转义\\h--&gt;\\\\h不然可能出现BUG。</span></span><br></pre></td></tr></table></figure>\n\n<p>输出</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class=\"line\">Welcome to the MySQL monitor.  Commands end with ; or \\g.</span><br><span class=\"line\">Your MySQL connection id is 2029</span><br><span class=\"line\">Server version: 5.7.22 MySQL Community Server (GPL)</span><br><span class=\"line\"></span><br><span class=\"line\">Copyright (c) 2000, 2018, Oracle and&#x2F;or its affiliates. All rights reserved.</span><br><span class=\"line\"></span><br><span class=\"line\">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class=\"line\">affiliates. Other names may be trademarks of their respective</span><br><span class=\"line\">owners.</span><br><span class=\"line\"></span><br><span class=\"line\">Type &#39;help;&#39; or &#39;\\h&#39; for help. Type &#39;\\c&#39; to clear the current input statement.</span><br><span class=\"line\"></span><br><span class=\"line\">@localhost</span><br></pre></td></tr></table></figure>\n\n<p>登陆后再次修改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">@localhost PROMPT \\u@\\h \\d&gt;</span><br><span class=\"line\">PROMPT set to &#39;\\u@\\h \\d&gt;&#39;</span><br><span class=\"line\">root@localhost (none)&gt;</span><br></pre></td></tr></table></figure>\n\n<p>由于没有进入数据库，所以\\d是none。那我们查询下当前的数据库，然后选择一个数据库并进入。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">root@localhost (none)&gt; SHOW DATABASES;</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">| Database           |</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">| information_schema |</span><br><span class=\"line\">| Demo               |</span><br><span class=\"line\">| mysql              |</span><br><span class=\"line\">| performance_schema |</span><br><span class=\"line\">| rbac001            |</span><br><span class=\"line\">| sys                |</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">6 rows in set (0.06 sec)</span><br></pre></td></tr></table></figure>\n\n<p>进入Demo数据库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">root@localhost (none)&gt;USE Demo</span><br><span class=\"line\">Reading table information for completion of table and column names</span><br><span class=\"line\">You can turn off this feature to get a quicker startup with -A</span><br><span class=\"line\"></span><br><span class=\"line\">Database changed</span><br><span class=\"line\">root@localhost Demo&gt;</span><br></pre></td></tr></table></figure>\n\n<p>那么这里mysql的标识符就显示完整了。</p>\n<p>还有一种发发就是在<code>my.cof</code>配置文件中指定全局的。</p>\n<blockquote>\n<p>我用的是linux上的mysql，如果是windows在mysql安装目录中寻找my.cof配置文件并修改相关参数。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">root@localhost Demo&gt; \\q</span><br></pre></td></tr></table></figure>\n\n<p>登出mysql后编辑<code>my.cof</code>文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_115_109_centos ~]<span class=\"comment\"># vim /etc/my.cnf</span></span><br></pre></td></tr></table></figure>\n\n<p>修改文件添加<code>prompt = [\\\\u@\\\\h][\\\\d]&gt;\\\\_</code>这个设置，注意这里\\是需要转义的。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># For advice on how to change settings please see</span><br><span class=\"line\"># http:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F;refman&#x2F;5.7&#x2F;en&#x2F;server-configuration-defaults.html</span><br><span class=\"line\">#</span><br><span class=\"line\">[mysql]</span><br><span class=\"line\">prompt &#x3D; [\\\\u@\\\\h][\\\\d]&gt;\\\\_</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">#</span><br><span class=\"line\"># Remove leading # and set to the amount of RAM for the most important data</span><br><span class=\"line\"># cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.</span><br><span class=\"line\"># innodb_buffer_pool_size &#x3D; 128M</span><br><span class=\"line\">#</span><br><span class=\"line\"># Remove leading # to turn on a very important data integrity option: logging</span><br><span class=\"line\"># changes to the binary log between backups.</span><br><span class=\"line\"># log_bin</span><br><span class=\"line\">#</span><br><span class=\"line\"># Remove leading # to set options mainly useful for reporting servers.</span><br><span class=\"line\"># The server defaults are faster for transactions and fast SELECTs.</span><br><span class=\"line\"># Adjust sizes as needed, experiment to find the optimal values.</span><br><span class=\"line\"># join_buffer_size &#x3D; 128M</span><br><span class=\"line\"># sort_buffer_size &#x3D; 2M</span><br><span class=\"line\"># read_rnd_buffer_size &#x3D; 2M</span><br><span class=\"line\">socket&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock</span><br><span class=\"line\"></span><br><span class=\"line\"># Disabling symbolic-links is recommended to prevent assorted security risks</span><br><span class=\"line\">symbolic-links&#x3D;0</span><br><span class=\"line\"></span><br><span class=\"line\">#设置端口</span><br><span class=\"line\">port&#x3D;3306</span><br><span class=\"line\">#设置mysql数据存放目录</span><br><span class=\"line\">datadir&#x3D;&#x2F;opt&#x2F;db&#x2F;mysql</span><br><span class=\"line\"># 服务端使用的字符集默认为8比特编码的latin1字符集  </span><br><span class=\"line\">character-set-server&#x3D;utf8</span><br><span class=\"line\"># # 创建新表时将使用的默认存储引擎  </span><br><span class=\"line\">default-storage-engine&#x3D;INNODB</span><br><span class=\"line\"></span><br><span class=\"line\">log-error&#x3D;&#x2F;var&#x2F;log&#x2F;mysqld.log</span><br><span class=\"line\">pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid</span><br></pre></td></tr></table></figure>\n\n<p>保存退出并重启mysql。退出VIM ESC键 然后:  在命令行输入wq回车。如果成功保存并退出就重启mysql服务。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_115_109_centos ~]<span class=\"comment\"># systemctl restart mysqld</span></span><br></pre></td></tr></table></figure>\n\n<p>这里是Centos7.3的环境演示。再次登陆mysql。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@VM_115_109_centos ~]<span class=\"comment\"># mysql -uroot -p </span></span><br><span class=\"line\">Enter password: </span><br><span class=\"line\">Welcome to the MySQL monitor.  Commands end with ; or \\g.</span><br><span class=\"line\">Your MySQL connection id is 3</span><br><span class=\"line\">Server version: 5.7.22 MySQL Community Server (GPL)</span><br><span class=\"line\"></span><br><span class=\"line\">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class=\"line\"></span><br><span class=\"line\">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class=\"line\">affiliates. Other names may be trademarks of their respective</span><br><span class=\"line\">owners.</span><br><span class=\"line\"></span><br><span class=\"line\">Type <span class=\"string\">'help;'</span> or <span class=\"string\">'\\h'</span> <span class=\"keyword\">for</span> <span class=\"built_in\">help</span>. Type <span class=\"string\">'\\c'</span> to clear the current input statement.</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost][(none)]&gt;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][(none)]&gt; USE Demo</span><br><span class=\"line\">Reading table information for completion of table and column names</span><br><span class=\"line\">You can turn off this feature to get a quicker startup with -A</span><br><span class=\"line\"></span><br><span class=\"line\">Database changed</span><br><span class=\"line\">[root@localhost][Demo]&gt;</span><br></pre></td></tr></table></figure>\n\n<p>到这里全局设置PROMPT就OK了。</p>\n<h3 id=\"Mysql常用命令\"><a href=\"#Mysql常用命令\" class=\"headerlink\" title=\"Mysql常用命令\"></a>Mysql常用命令</h3><blockquote>\n<p>这里演示一些经常用到的MYSQL常用命令，方便快速了解Mysql。同时接触一些MYSQL语句的规范。</p>\n</blockquote>\n<ol>\n<li>演示语句<ul>\n<li>显示当前服务器的版本：<code>SELECT VERSION();</code></li>\n<li>显示当前日期时间：<code>SELECT NOW();</code></li>\n<li>显示当前的用户：<code>SELECT USER();</code></li>\n</ul>\n</li>\n</ol>\n<p>输出效果</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][Demo]&gt; SELECT VERSION();</span><br><span class=\"line\">+-----------+</span><br><span class=\"line\">| VERSION() |</span><br><span class=\"line\">+-----------+</span><br><span class=\"line\">| 5.7.22    |</span><br><span class=\"line\">+-----------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT NOW();</span><br><span class=\"line\">+---------------------+</span><br><span class=\"line\">| NOW()               |</span><br><span class=\"line\">+---------------------+</span><br><span class=\"line\">| 2018-04-29 04:22:31 |</span><br><span class=\"line\">+---------------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT USER();</span><br><span class=\"line\">+----------------+</span><br><span class=\"line\">| USER()         |</span><br><span class=\"line\">+----------------+</span><br><span class=\"line\">| root@localhost |</span><br><span class=\"line\">+----------------+</span><br><span class=\"line\">1 row in set (0.01 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost][Demo]&gt;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>MYSQL标准的规范<ul>\n<li><code>关键字</code>与<code>函数名</code>称全部大写。</li>\n<li><code>数据库</code>、<code>表名称</code>、<code>字段名称</code>全部<code>小写</code>。</li>\n<li>SQL语句必须<code>分号</code>结尾。</li>\n</ul>\n</li>\n</ol>\n<blockquote>\n<p>在不同的系统中大小写是区分的，如果SQL语句不够规范或者数据库、表名、字段名不规范命名，可能会出现严重的BUG。</p>\n</blockquote>\n<h3 id=\"Mysql数据库的操作\"><a href=\"#Mysql数据库的操作\" class=\"headerlink\" title=\"Mysql数据库的操作\"></a>Mysql数据库的操作</h3><blockquote>\n<p>这里做下记录吧，应该是要专门写一篇关于MySQL数据库结构文章。</p>\n</blockquote>\n<h4 id=\"创建数据库\"><a href=\"#创建数据库\" class=\"headerlink\" title=\"创建数据库\"></a>创建数据库</h4><p><code>CREATE { DATABASES | SCHEMA} [IF NOT EXISTS] db_name [DEFAULT] CHARACTER SET [=] charset_name</code>。</p>\n<ul>\n<li>简单解释下上面的语句，{}花括弧必须要填写的，|是或则 选择其中一个即可。[]中括号可有可无。CHARACTER是库的约束项目，指定数据库的编码集。</li>\n</ul>\n<p>示例</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][Demo]&gt; CREATE DATABASE  db1;</span><br><span class=\"line\">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>这里已经提示我们创建成功了一个数据库db1。检查下当前的数据库列表。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][Demo]&gt; SHOW DATABASES;</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">| Database           |</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">| information_schema |</span><br><span class=\"line\">| Demo               |</span><br><span class=\"line\">| db1                |</span><br><span class=\"line\">| mysql              |</span><br><span class=\"line\">| performance_schema |</span><br><span class=\"line\">| rbac001            |</span><br><span class=\"line\">| sys                |</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>在来看看[IF NOT EXISTS] 这个参数。我们测试下。重复创建<code>db1</code>数据库。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][Demo]&gt; CREATE DATABASE db1;</span><br><span class=\"line\">ERROR 1007 (HY000): Can&#39;t create database &#39;db1&#39;; database exists</span><br></pre></td></tr></table></figure>\n\n<p>这里会警告我们，数据已经存在。在上<code>IF NOT EXISTS</code>在试试。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][Demo]&gt; CREATE DATABASE IF NOT EXISTS db1;</span><br><span class=\"line\">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>这里警告会看不到了，我们能不能查询一下警告信息呢？当然是可以的。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][Demo]&gt; SHOW WARNINGS;</span><br><span class=\"line\">+-------+------+----------------------------------------------+</span><br><span class=\"line\">| Level | Code | Message                                      |</span><br><span class=\"line\">+-------+------+----------------------------------------------+</span><br><span class=\"line\">| Note  | 1007 | Can&#39;t create database &#39;db1&#39;; database exists |</span><br><span class=\"line\">+-------+------+----------------------------------------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>其实，使用IF NOT EXISTS 之后警告依然存在，只不过不会立刻显示出来。</p>\n<h4 id=\"查询数据库\"><a href=\"#查询数据库\" class=\"headerlink\" title=\"查询数据库\"></a>查询数据库</h4><p><code>SHOW {DATABASES | SCHEMAS} [LIKE &#39;pattern&#39; | WHERE expr]</code></p>\n<ul>\n<li>查询全部：<code>SHOW DATABASES;</code></li>\n<li>模糊查询：<code>SHOW DATABASES LIKE &#39;pattern&#39;</code><ul>\n<li>这里的pattern是指匹配模式，<code>%</code>是指匹配多个字符，<code>_</code>是指匹配单个字符。需要注意的是在匹配有带有<code>_</code>下划线的数据库名字时候，需要添加<code>\\</code>反斜杠转义。</li>\n</ul>\n</li>\n</ul>\n<p>创建db1的时候已经使用全局查询了，这里演示下模糊查询。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][Demo]&gt; SHOW DATABASES LIKE &quot;db%&quot;;</span><br><span class=\"line\">+----------------+</span><br><span class=\"line\">| Database (db%) |</span><br><span class=\"line\">+----------------+</span><br><span class=\"line\">| db1            |</span><br><span class=\"line\">+----------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>在检查一下数据库的编码级。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][Demo]&gt; SHOW CREATE DATABASE db1;</span><br><span class=\"line\">+----------+--------------------------------------------------------------+</span><br><span class=\"line\">| Database | Create Database                                              |</span><br><span class=\"line\">+----------+--------------------------------------------------------------+</span><br><span class=\"line\">| db1      | CREATE DATABASE &#96;db1&#96; &#x2F;*!40100 DEFAULT CHARACTER SET utf8 *&#x2F; |</span><br><span class=\"line\">+----------+--------------------------------------------------------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>这里查询出创建数据库的指定编码集。是utf8，这里是应为我在<code>my.cof</code>文件中设置了<code>character-set-server=utf8</code>这个参数，所以即便创建数据库时utf8编码，数据库创建默认就是utf8。</p>\n<p>那么我们创建一个非默认编码的数据库试试。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][Demo]&gt; CREATE DATABASE IF NOT EXISTS db2 CHARACTER SET gbk;</span><br><span class=\"line\">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>我们在检查下db2是不是指定的编码集。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][Demo]&gt; SHOW CREATE DATABASE db2 ;</span><br><span class=\"line\">+----------+-------------------------------------------------------------+</span><br><span class=\"line\">| Database | Create Database                                             |</span><br><span class=\"line\">+----------+-------------------------------------------------------------+</span><br><span class=\"line\">| db2      | CREATE DATABASE &#96;db2&#96; &#x2F;*!40100 DEFAULT CHARACTER SET gbk *&#x2F; |</span><br><span class=\"line\">+----------+-------------------------------------------------------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>当然并不打算使用gbk来做编码集。</p>\n<h4 id=\"修改数据库\"><a href=\"#修改数据库\" class=\"headerlink\" title=\"修改数据库\"></a>修改数据库</h4><p><code>ALTER {DATABASE | SCHEMA } [db_name] [DEFAULT ] CHARACTER SET [=] charset_name</code></p>\n<p>示例</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][Demo]&gt; ALTER DATABASE db2 CHARACTER SET &#x3D; utf8;</span><br><span class=\"line\">Query OK, 1 row affected (0.00 sec)</span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW CREATE DATABASE db2;</span><br><span class=\"line\">+----------+--------------------------------------------------------------+</span><br><span class=\"line\">| Database | Create Database                                              |</span><br><span class=\"line\">+----------+--------------------------------------------------------------+</span><br><span class=\"line\">| db2      | CREATE DATABASE &#96;db2&#96; &#x2F;*!40100 DEFAULT CHARACTER SET utf8 *&#x2F; |</span><br><span class=\"line\">+----------+--------------------------------------------------------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"删除数据库\"><a href=\"#删除数据库\" class=\"headerlink\" title=\"删除数据库\"></a>删除数据库</h4><p><code>DROP {DATABASE| SCHEMA} [IF EXISTS] db_name</code></p>\n<p>示例</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][Demo]&gt; SHOW CREATE DATABASE db2;</span><br><span class=\"line\">+----------+--------------------------------------------------------------+</span><br><span class=\"line\">| Database | Create Database                                              |</span><br><span class=\"line\">+----------+--------------------------------------------------------------+</span><br><span class=\"line\">| db2      | CREATE DATABASE &#96;db2&#96; &#x2F;*!40100 DEFAULT CHARACTER SET utf8 *&#x2F; |</span><br><span class=\"line\">+----------+--------------------------------------------------------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost][Demo]&gt; DROP DATABASE db2;</span><br><span class=\"line\">Query OK, 0 rows affected (0.03 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW DATABASES;</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">| Database           |</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">| information_schema |</span><br><span class=\"line\">| Demo               |</span><br><span class=\"line\">| db1                |</span><br><span class=\"line\">| mysql              |</span><br><span class=\"line\">| performance_schema |</span><br><span class=\"line\">| rbac001            |</span><br><span class=\"line\">| sys                |</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">7 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>\n\n<p><code>注意删除数据库之前记得备份，不然会悲剧。</code></p>\n<h4 id=\"回顾总结。\"><a href=\"#回顾总结。\" class=\"headerlink\" title=\"回顾总结。\"></a>回顾总结。</h4><ol>\n<li>新增：<code>CREATE { DATABASES | SCHEMA} [IF NOT EXISTS] db_name [DEFAULT] CHARACTER SET [=] charset_name</code></li>\n<li>查询：<code>SHOW {DATABASES | SCHEMAS} [LIKE &#39;pattern&#39; | WHERE expr]</code></li>\n<li>修改：<code>ALTER {DATABASE | SCHEMA } [db_name][DEFAULT ] CHARACTER SET [=] charset_name</code></li>\n<li>删除：<code>DROP {DATABASE| SCHEMA} [IF EXISTS] db_name</code></li>\n<li>SQL语句注意大小写。</li>\n<li>数据库操作的语句属于<code>DDL</code>语句。</li>\n</ol>\n<h3 id=\"Mysql数据表操作\"><a href=\"#Mysql数据表操作\" class=\"headerlink\" title=\"Mysql数据表操作\"></a>Mysql数据表操作</h3><blockquote>\n<p>数据表，是数据库中重要的结构之一，是存储数据的基础。在关系型数据库中，实际上表就是一个二维的数据结构。</p>\n</blockquote>\n<h4 id=\"创建数据表\"><a href=\"#创建数据表\" class=\"headerlink\" title=\"创建数据表\"></a>创建数据表</h4><blockquote>\n<p>首先需要进入到某个数据库，上面的操作数据库中已经创建了一个库db1。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 进入db1数据库</span><br><span class=\"line\">[root@localhost][(none)]&gt; USE db1;</span><br><span class=\"line\">Database changed</span><br><span class=\"line\">[root@localhost][db1]&gt; SELECT DATABASE();</span><br><span class=\"line\">+------------+</span><br><span class=\"line\">| DATABASE() |</span><br><span class=\"line\">+------------+</span><br><span class=\"line\">| db1        |</span><br><span class=\"line\">+------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>进入后使用<code>SELECT DATABASE();</code> 来查询当前进入的数据。</p>\n<p><code>CRATE TABLE [IF NOT EXISTS] table_name(</code></p>\n<p><code>column_name data_type</code></p>\n<p><code>)</code></p>\n<blockquote>\n<p>由于是二维表，所以column_name肯定是确认的，根据存储的数据类型在选择合适的data_type。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][db1]&gt; CREATE TABLE emp(</span><br><span class=\"line\">    -&gt; username VARCHAR(20),</span><br><span class=\"line\">    -&gt; age TINYINT UNSIGNED,</span><br><span class=\"line\">    -&gt; salary FLOAT(8,2) UNSIGNED</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.12 sec)</span><br></pre></td></tr></table></figure>\n\n<p>创建一张员工表，存储了名字、年龄、工资。其中年龄和工资采用了无符号。</p>\n<hr>\n<h4 id=\"查看数据表\"><a href=\"#查看数据表\" class=\"headerlink\" title=\"查看数据表\"></a>查看数据表</h4><p><code>SHOW TABLES [FROM db_name] [LIKE &#39;pattern&#39; | WHERE expr] </code></p>\n<ul>\n<li>查询当前数据库全部表：<code>SHOW TABLES ;</code></li>\n<li>查询其他数据库中表：<code>SHOW TABLES FROM mysql</code></li>\n<li>模糊查询当前数据库表：<code>SHOW TABLES LIKE &#39;pattern&#39;</code><ul>\n<li>这里的pattern是指匹配模式，<code>%</code>是指匹配多个字符，<code>_</code>是指匹配单个字符。需要注意的是在匹配有带有<code>_</code>下划线的数据表名字时候，需要添加<code>\\</code>反斜杠转义。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 查询当前数据库中全部表。</span><br><span class=\"line\">[root@localhost][db1]&gt; SHOW TABLES;</span><br><span class=\"line\">+---------------+</span><br><span class=\"line\">| Tables_in_db1 |</span><br><span class=\"line\">+---------------+</span><br><span class=\"line\">| emp           |</span><br><span class=\"line\">+---------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 查询其他数据库中全部表。</span><br><span class=\"line\">[root@localhost][db1]&gt; SHOW TABLES FROM mysql;</span><br><span class=\"line\">+---------------------------+</span><br><span class=\"line\">| Tables_in_mysql           |</span><br><span class=\"line\">+---------------------------+</span><br><span class=\"line\">| columns_priv              |</span><br><span class=\"line\">| db                        |</span><br><span class=\"line\">| engine_cost               |</span><br><span class=\"line\">| event                     |</span><br><span class=\"line\">| func                      |</span><br><span class=\"line\">| general_log               |</span><br><span class=\"line\">| gtid_executed             |</span><br><span class=\"line\">| help_category             |</span><br><span class=\"line\">| help_keyword              |</span><br><span class=\"line\">| help_relation             |</span><br><span class=\"line\">| help_topic                |</span><br><span class=\"line\">| innodb_index_stats        |</span><br><span class=\"line\">| innodb_table_stats        |</span><br><span class=\"line\">| ndb_binlog_index          |</span><br><span class=\"line\">| plugin                    |</span><br><span class=\"line\">| proc                      |</span><br><span class=\"line\">| procs_priv                |</span><br><span class=\"line\">| proxies_priv              |</span><br><span class=\"line\">| server_cost               |</span><br><span class=\"line\">| servers                   |</span><br><span class=\"line\">| slave_master_info         |</span><br><span class=\"line\">| slave_relay_log_info      |</span><br><span class=\"line\">| slave_worker_info         |</span><br><span class=\"line\">| slow_log                  |</span><br><span class=\"line\">| tables_priv               |</span><br><span class=\"line\">| time_zone                 |</span><br><span class=\"line\">| time_zone_leap_second     |</span><br><span class=\"line\">| time_zone_name            |</span><br><span class=\"line\">| time_zone_transition      |</span><br><span class=\"line\">| time_zone_transition_type |</span><br><span class=\"line\">| user                      |</span><br><span class=\"line\">+---------------------------+</span><br><span class=\"line\">31 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 使用 LIKE 做模糊查询</span><br><span class=\"line\">[root@localhost][db1]&gt; SHOW TABLES LIKE &#39;e%&#39;</span><br><span class=\"line\">    -&gt; ;</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">| Tables_in_db1 (e%) |</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">| emp                |</span><br><span class=\"line\">+--------------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"查看表结构\"><a href=\"#查看表结构\" class=\"headerlink\" title=\"查看表结构\"></a>查看表结构</h4><p><code>SHOW COLUMNS FROM table_name</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost][db1]&gt; SHOW COLUMNS FROM emp;</span><br><span class=\"line\">+----------+---------------------+------+-----+---------+-------+</span><br><span class=\"line\">| Field    | Type                | Null | Key | Default | Extra |</span><br><span class=\"line\">+----------+---------------------+------+-----+---------+-------+</span><br><span class=\"line\">| username | varchar(20)         | YES  |     | NULL    |       |</span><br><span class=\"line\">| age      | tinyint(3) unsigned | YES  |     | NULL    |       |</span><br><span class=\"line\">| salary   | float(8,2) unsigned | YES  |     | NULL    |       |</span><br><span class=\"line\">+----------+---------------------+------+-----+---------+-------+</span><br><span class=\"line\">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"修改表结构\"><a href=\"#修改表结构\" class=\"headerlink\" title=\"修改表结构\"></a>修改表结构</h4><blockquote>\n<p>平时用IDE用多了，估计很少会去写SQL修改表结构。</p>\n</blockquote>\n<p>修改表结构分为两种</p>\n<ul>\n<li>修改表本身<ul>\n<li>修改表名 <code>RENAME TBALE ol_table_name TO new_table_name</code></li>\n<li>修改表选项 <code>ALTER TABLE table_name table_option [=] option</code></li>\n</ul>\n</li>\n<li>修改表字段<ul>\n<li>新增字段 <code>ALTER TABLE table_name ADD [colums_name] data_type [data_type] [location]</code></li>\n<li>修改字段 <code>ALTER TABLE table_name MODIFY [columns_name] [data_type] [location]</code> </li>\n<li>重命名字段 <code>ALTER TABLE table_name CHANGE ol_columns_name new_columns_name data_type [columns_type] [location] </code></li>\n<li>删除字段 <code>ALTER TABLE table_name DROP columns_name</code></li>\n</ul>\n</li>\n</ul>\n<hr>\n<h4 id=\"插入表数据（一）\"><a href=\"#插入表数据（一）\" class=\"headerlink\" title=\"插入表数据（一）\"></a>插入表数据（一）</h4><p><code>INSERT [INTO] table_name [(columns_name , ... )] VALUES(value , ...)</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 插入一条模拟数据，默认全部字段都插入。也就没有指定columns的时候所有的字段都需要赋值。</span><br><span class=\"line\">[root@localhost][db1]&gt; INSERT emp VALUE(&#39;Tom&#39;,23,8432.34);</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 插入一条数据，只为部分字段赋值。</span><br><span class=\"line\">[root@localhost][db1]&gt; INSERT emp(username , salary) VALUE(&#39;Jon&#39;,5600.32);</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>实际上插入数据的时候是有约束的。</p>\n</blockquote>\n<p>简单的查询：<code>SELECT expr，.. FROM table_name</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 先做一个简单的演示，使用*标识所有的列。</span><br><span class=\"line\">[root@localhost][db1]&gt; SELECT * FROM emp;</span><br><span class=\"line\">+----------+------+---------+</span><br><span class=\"line\">| username | age  | salary  |</span><br><span class=\"line\">+----------+------+---------+</span><br><span class=\"line\">| Tom      |   23 | 8432.34 |</span><br><span class=\"line\">| Jon      | NULL | 5600.32 |</span><br><span class=\"line\">+----------+------+---------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在插入<code>Jon</code>的时候并没有指定age，实际上一般的业务上会出现数据不能为空的情况。比如说刚才创建emp所有的字段都是可以为空值。</p>\n</blockquote>\n<h5 id=\"列约束：NULL-NOT-NULL\"><a href=\"#列约束：NULL-NOT-NULL\" class=\"headerlink\" title=\"列约束：NULL \\ NOT NULL\"></a>列约束：NULL \\ NOT NULL</h5><blockquote>\n<p><code>NULL</code> ，字段值可以为空；<code>NOT NULL</code>字段值不可为空。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 模拟一条数据，并指定age 为空。</span><br><span class=\"line\">[root@localhost][db1]&gt; INSERT emp(username,age) VALUE(&#39;Zo&#39;,NULL);</span><br><span class=\"line\">Query OK, 1 row affected (0.00 sec)</span><br><span class=\"line\"># 看下存储的结果</span><br><span class=\"line\">[root@localhost][db1]&gt; SELECT * FROM emp;</span><br><span class=\"line\">+----------+------+---------+</span><br><span class=\"line\">| username | age  | salary  |</span><br><span class=\"line\">+----------+------+---------+</span><br><span class=\"line\">| Tom      |   23 | 8432.34 |</span><br><span class=\"line\">| Jon      | NULL | 5600.32 |</span><br><span class=\"line\">| Zo       | NULL |    NULL |</span><br><span class=\"line\">+----------+------+---------+</span><br></pre></td></tr></table></figure>\n\n<p>在创建一张表，并指定部分字段不能为空。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建表emp1 ，指定username 不能为空。</span><br><span class=\"line\">[root@localhost][db1]&gt; CREATE TABLE emp1(</span><br><span class=\"line\">    -&gt; username VARCHAR(20) NOT NULL,</span><br><span class=\"line\">    -&gt; age TINYINT UNSIGNED NULL</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.10 sec)</span><br><span class=\"line\"># 查看下emp1的数据表结构。</span><br><span class=\"line\">[root@localhost][db1]&gt; SHOW COLUMNS FROM emp1;</span><br><span class=\"line\">+----------+---------------------+------+-----+---------+-------+</span><br><span class=\"line\">| Field    | Type                | Null | Key | Default | Extra |</span><br><span class=\"line\">+----------+---------------------+------+-----+---------+-------+</span><br><span class=\"line\">| username | varchar(20)         | NO   |     | NULL    |       |</span><br><span class=\"line\">| age      | tinyint(3) unsigned | YES  |     | NULL    |       |</span><br><span class=\"line\">+----------+---------------------+------+-----+---------+-------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>从emp2结构中看到，此时的username 已经不能为NULL了。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 模拟数据,尝试吧NULL赋值到username。</span><br><span class=\"line\">[root@localhost][db1]&gt; INSERT emp1(username,age) VALUE(NULL,NULL);</span><br><span class=\"line\">ERROR 1048 (23000): Column &#39;username&#39; cannot be null</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"列约束：AUTO-INCREMENT\"><a href=\"#列约束：AUTO-INCREMENT\" class=\"headerlink\" title=\"列约束：AUTO_INCREMENT\"></a>列约束：AUTO_INCREMENT</h5><blockquote>\n<p>AUTO_INCREMENT 自增必须定义成主键使用。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 如果列约束 AUTO_INCREMENT 不配合主键使用会出现下列警告。</span><br><span class=\"line\">[root@localhost][db1]&gt; CREATE TABLE emp2(</span><br><span class=\"line\">    -&gt; id SMALLINT UNSIGNED AUTO_INCREMENT,</span><br><span class=\"line\">    -&gt; username VARCHAR(20)</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">ERROR 1075 (42000): Incorrect table definition; there can be only one auto column and it must be defined as a key</span><br><span class=\"line\"># 修改创建表语句，并指定主键</span><br><span class=\"line\">[root@localhost][db1]&gt; CREATE TABLE emp2(</span><br><span class=\"line\">    -&gt; id SMALLINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,</span><br><span class=\"line\">    -&gt; username VARCHAR(20)</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.09 sec)</span><br><span class=\"line\"># 检查下emp2表结构。</span><br><span class=\"line\">[root@localhost][db1]&gt; SHOW COLUMNS FROM emp2;</span><br><span class=\"line\">+----------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| Field    | Type                 | Null | Key | Default | Extra          |</span><br><span class=\"line\">+----------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| id       | smallint(5) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class=\"line\">| username | varchar(20)          | YES  |     | NULL    |                |</span><br><span class=\"line\">+----------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br><span class=\"line\"># 插入一条数据试试。</span><br><span class=\"line\">[root@localhost][db1]&gt; INSERT emp2(username) VALUE(&#39;Jon&#39;);</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br><span class=\"line\"># 查看结果</span><br><span class=\"line\">[root@localhost][db1]&gt; SELECT * FROM emp2;</span><br><span class=\"line\">+----+----------+</span><br><span class=\"line\">| id | username |</span><br><span class=\"line\">+----+----------+</span><br><span class=\"line\">|  1 | Jon      |</span><br><span class=\"line\">+----+----------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"># 如果插入的时候指定id的值，看看会发生什么？</span><br><span class=\"line\">[root@localhost][db1]&gt; INSERT emp2(id,username) VALUE(10,&#39;Tom&#39;);</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br><span class=\"line\"># 查看结果。</span><br><span class=\"line\">[root@localhost][db1]&gt; SELECT * FROM emp2;</span><br><span class=\"line\">+----+----------+</span><br><span class=\"line\">| id | username |</span><br><span class=\"line\">+----+----------+</span><br><span class=\"line\">|  1 | Jon      |</span><br><span class=\"line\">| 10 | Tom      |</span><br><span class=\"line\">+----+----------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br><span class=\"line\"># 也就是说，如果我们指定插入的值，是可以插入成功的。在插入一条看看</span><br><span class=\"line\">[root@localhost][db1]&gt; INSERT emp2(username) VALUE(&#39;King&#39;);</span><br><span class=\"line\">Query OK, 1 row affected (0.03 sec)</span><br><span class=\"line\"># 再查看</span><br><span class=\"line\">[root@localhost][db1]&gt; SELECT * FROM emp2;</span><br><span class=\"line\">+----+----------+</span><br><span class=\"line\">| id | username |</span><br><span class=\"line\">+----+----------+</span><br><span class=\"line\">|  1 | Jon      |</span><br><span class=\"line\">| 10 | Tom      |</span><br><span class=\"line\">| 11 | King     |</span><br><span class=\"line\">+----+----------+</span><br><span class=\"line\">3 rows in set (0.00 sec)</span><br><span class=\"line\">#  结果可以看到，指定主键后，在此插入若不指定会在最大的id上进行自增。</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"列约束：PRIMARY-KEY\"><a href=\"#列约束：PRIMARY-KEY\" class=\"headerlink\" title=\"列约束：PRIMARY KEY\"></a>列约束：PRIMARY KEY</h5><blockquote>\n<p>PRIMARY KEY 主键约束，上面我们使用了<code>AUTO_INCREMENT</code>而它是必须配合PRIMARY KEY使用。但是PRIMARY KEY 可以单独使用。一张表也只能存在一个主键。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建一个表，并指定PRIMARY KEY 但是不使用AUTO_INCRMENT。</span><br><span class=\"line\">[root@localhost][db1]&gt; CREATE TABLE emp3( </span><br><span class=\"line\">\tid SMALLINT UNSIGNED PRIMARY KEY , </span><br><span class=\"line\">\tusername VARCHAR(20)</span><br><span class=\"line\">);</span><br><span class=\"line\">Query OK, 0 rows affected (0.09 sec)</span><br></pre></td></tr></table></figure>\n\n<p>主键有一个特性就是保证唯一性，所以不可以重复。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 检查下emp3表结构，可以看到NULL列是NO。</span><br><span class=\"line\">[root@localhost][db1]&gt; SHOW COLUMNS FROM emp3;</span><br><span class=\"line\">+----------+----------------------+------+-----+---------+-------+</span><br><span class=\"line\">| Field    | Type                 | Null | Key | Default | Extra |</span><br><span class=\"line\">+----------+----------------------+------+-----+---------+-------+</span><br><span class=\"line\">| id       | smallint(5) unsigned | NO   | PRI | NULL    |       |</span><br><span class=\"line\">| username | varchar(20)          | YES  |     | NULL    |       |</span><br><span class=\"line\">+----------+----------------------+------+-----+---------+-------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br><span class=\"line\"># 我们来模拟一次主键重复的情况。</span><br><span class=\"line\">[root@localhost][db1]&gt; INSERT emp3(id,username) VALUES(1,&#39;Tom&#39;);</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br><span class=\"line\"># 主键重复异常。</span><br><span class=\"line\">[root@localhost][db1]&gt; INSERT emp3(id,username) VALUES(1,&#39;Jon&#39;);</span><br><span class=\"line\">ERROR 1062 (23000): Duplicate entry &#39;1&#39; for key &#39;PRIMARY&#39;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"列约束：UNIQUE-KEY\"><a href=\"#列约束：UNIQUE-KEY\" class=\"headerlink\" title=\"列约束：UNIQUE KEY\"></a>列约束：UNIQUE KEY</h5><blockquote>\n<p>UNIQUE KEY唯一约束，唯一的约束可以保证数据的唯一性，唯一约束的字段可以设置为NULL。每张表可以设置多个唯一约束，这个主键不同。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建一张主键自增并且有唯一约束的表emp4。</span><br><span class=\"line\">[root@localhost][(none)]&gt; CREATE TABLE emp4(</span><br><span class=\"line\">    -&gt; id SMALLINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,</span><br><span class=\"line\">    -&gt; username VARCHAR(20) NOT NULL UNIQUE KEY,</span><br><span class=\"line\">    -&gt; age TINYINT UNSIGNED</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.09 sec)</span><br><span class=\"line\"># 查看下emp4表结构情况。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW COLUMNS FROM emp4;</span><br><span class=\"line\">+----------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| Field    | Type                 | Null | Key | Default | Extra          |</span><br><span class=\"line\">+----------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| id       | smallint(5) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class=\"line\">| username | varchar(20)          | NO   | UNI | NULL    |                |</span><br><span class=\"line\">| age      | tinyint(3) unsigned  | YES  |     | NULL    |                |</span><br><span class=\"line\">+----------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">3 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 插入数据试试</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT emp4(username,age) VALUES(&#39;Tom&#39;,22);</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br><span class=\"line\"># 重复插入Tom试试，这会提示错误。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT emp4(username,age) VALUES(&#39;Tom&#39;,22);</span><br><span class=\"line\">ERROR 1062 (23000): Duplicate entry &#39;Tom&#39; for key &#39;username&#39;</span><br></pre></td></tr></table></figure>\n\n<p>这里其实有一个疑问，为什么QNIQUE KYE可以为NULL，如果为NULL怎么表示唯一呢？</p>\n<h5 id=\"列约束：DEFAULT\"><a href=\"#列约束：DEFAULT\" class=\"headerlink\" title=\"列约束：DEFAULT\"></a>列约束：DEFAULT</h5><blockquote>\n<p>DEFAULT 默认值，如果没有明确字段赋值，则自动赋值为默认值。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建一张表，指定sex DEFAULT 值为 0,如果插入数据的时候不指定，那么这个字段就是0。</span><br><span class=\"line\">[root@localhost][Demo]&gt; CREATE TABLE emp5(</span><br><span class=\"line\">    -&gt; id SMALLINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,</span><br><span class=\"line\">    -&gt; username VARCHAR(20) NOT NULL UNIQUE KEY,</span><br><span class=\"line\">    -&gt; sex TINYINT DEFAULT 0</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.11 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">#检查表emp5结构</span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW COLUMNS FROM emp5;</span><br><span class=\"line\">+----------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| Field    | Type                 | Null | Key | Default | Extra          |</span><br><span class=\"line\">+----------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| id       | smallint(5) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class=\"line\">| username | varchar(20)          | NO   | UNI | NULL    |                |</span><br><span class=\"line\">| sex      | tinyint(4)           | YES  |     | 0       |                |</span><br><span class=\"line\">+----------+----------------------+------+-----+---------+----------------+</span><br><span class=\"line\">3 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 插入模拟数据</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT emp5(username) VALUES(&#39;Tom&#39;);</span><br><span class=\"line\">Query OK, 1 row affected (0.02 sec)</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT emp5(username) VALUES(&#39;Jon&#39;);</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看数据，并没有指定sex的值，就会使用默认值。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM emp5;</span><br><span class=\"line\">+----+----------+------+</span><br><span class=\"line\">| id | username | sex  |</span><br><span class=\"line\">+----+----------+------+</span><br><span class=\"line\">|  1 | Tom      |    0 |</span><br><span class=\"line\">|  2 | Jon      |    0 |</span><br><span class=\"line\">+----+----------+------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"列约束：小结\"><a href=\"#列约束：小结\" class=\"headerlink\" title=\"列约束：小结\"></a>列约束：小结</h5><blockquote>\n<p>列的属性，除了数据类型的约束，就是上面几种列约束。</p>\n</blockquote>\n<ul>\n<li>约束保证数据的完整性。</li>\n<li>约束分为表级约束和列级别约束。</li>\n<li>约束的类型包括<ul>\n<li>NOT NULL <code>非空约束</code></li>\n<li>PRIMARY KEY <code>主键约束</code></li>\n<li>UNIQUE KEY <code>唯一约束</code></li>\n<li>DEFAULT <code>默认约束</code></li>\n<li>FOREIGN KEY <code>外键约束</code></li>\n</ul>\n</li>\n</ul>\n<h5 id=\"插入数据需要注意\"><a href=\"#插入数据需要注意\" class=\"headerlink\" title=\"插入数据需要注意\"></a>插入数据需要注意</h5><blockquote>\n<p>在插入数据的时候也是存在一些需要注意的地方，下面演示下。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建测试表 users</span><br><span class=\"line\">[root@localhost][Demo]&gt; CREATE TABLE users(</span><br><span class=\"line\">    -&gt; id SMALLINT AUTO_INCREMENT PRIMARY KEY,</span><br><span class=\"line\">    -&gt; name VARCHAR(20) UNIQUE KEY,</span><br><span class=\"line\">    -&gt; pwd VARCHAR(30) NOT NULL,</span><br><span class=\"line\">    -&gt; age TINYINT UNSIGNED NOT NULL,</span><br><span class=\"line\">    -&gt; sex TINYINT UNSIGNED DEFAULT 0</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.07 sec)</span><br><span class=\"line\">#看下表的结构。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW COLUMNS FROM users;</span><br><span class=\"line\">+-------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| Field | Type                | Null | Key | Default | Extra          |</span><br><span class=\"line\">+-------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| id    | smallint(6)         | NO   | PRI | NULL    | auto_increment |</span><br><span class=\"line\">| name  | varchar(20)         | YES  | UNI | NULL    |                |</span><br><span class=\"line\">| pwd   | varchar(30)         | NO   |     | NULL    |                |</span><br><span class=\"line\">| age   | tinyint(3) unsigned | NO   |     | NULL    |                |</span><br><span class=\"line\">| sex   | tinyint(3) unsigned | YES  |     | 0       |                |</span><br><span class=\"line\">+-------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">5 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 插入数据模拟数据，不指定插入数据的位置。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT users VALUES(NULL,&#39;Tom&#39;,&#39;_23234awdasdwf&#39;,23,NULL);</span><br><span class=\"line\">Query OK, 1 row affected (0.03 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 再试一次，少插入一个位置的数据。如果省略了列名，就要需要将列数据补全，否则会造成插入失败的情况。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT users VALUES(NULL,&#39;Tom&#39;,&#39;_23234awdasdwf&#39;,23);</span><br><span class=\"line\">ERROR 1136 (21S01): Column count doesn&#39;t match value count at row 1</span><br></pre></td></tr></table></figure>\n\n<p>插入时候使用DEFAULT关键字，同时可以使用表达式作为参数。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 关键子DEFAULT也可以使用，sex字段就有DEFAULT,age 用到了表达式求值</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT users VALUES(NULL,&#39;Rose&#39;,&#39;_23234awdasdwf&#39;, 2*3 + 11,DEFAULT);</span><br><span class=\"line\">Query OK, 1 row affected (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 一次性插入多条数据</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT users VALUES(NULL,&#39;Atom&#39;,&#39;pwd&#39;,21,DEFAULT),(NULL,&#39;Per&#39;,&#39;pwd&#39;,23,DEFAULT);</span><br><span class=\"line\">Query OK, 2 rows affected (0.02 sec)</span><br><span class=\"line\">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  1 | Tom  | _23234awdasdwf |  23 | NULL |</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  17 | NULL |</span><br><span class=\"line\">|  4 | Rose | _23234awdasdwf |  17 |    0 |</span><br><span class=\"line\">|  5 | Atom | pwd            |  21 |    0 |</span><br><span class=\"line\">|  6 | Per  | pwd            |  23 |    0 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"插入表数据（二）\"><a href=\"#插入表数据（二）\" class=\"headerlink\" title=\"插入表数据（二）\"></a>插入表数据（二）</h4><p><code>INSERT [INTO] table_name SET columns_name ={ expr | DEFAULT},...</code></p>\n<ul>\n<li>与第一种插入方式不同的是，此方法可以使用子查询（SubQuery）;而且这方式一次只能插入一条数据。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 模拟一条测试数据。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT users SET name &#x3D; &#39;CoCo&#39;, pwd &#x3D; &#39;pwd&#39;,age &#x3D; 22;</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br><span class=\"line\"># 查询结果。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  1 | Tom  | _23234awdasdwf |  23 | NULL |</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  17 | NULL |</span><br><span class=\"line\">|  4 | Rose | _23234awdasdwf |  17 |    0 |</span><br><span class=\"line\">|  5 | Atom | pwd            |  21 |    0 |</span><br><span class=\"line\">|  6 | Per  | pwd            |  23 |    0 |</span><br><span class=\"line\">|  7 | CoCo | pwd            |  22 |    0 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"插入表数据（三）\"><a href=\"#插入表数据（三）\" class=\"headerlink\" title=\"插入表数据（三）\"></a>插入表数据（三）</h4><p><code>INSERT [INTO] tablle_name [(columns_name,...)] SELECT ...</code></p>\n<ul>\n<li>这种方式，可以将查询结果插入到指定的数据表中。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建一张测试表。只有两个字段，id 和 name。</span><br><span class=\"line\">[root@localhost][Demo]&gt; CREATE TABLE test(</span><br><span class=\"line\">    -&gt; id TINYINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,</span><br><span class=\"line\">    -&gt; name VARCHAR(30) </span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.07 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 尝试将users表中的数据插入到test中。</span><br><span class=\"line\"># 先看看当前users表中的数据。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  1 | Tom  | _23234awdasdwf |  18 |    1 |</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  17 |    1 |</span><br><span class=\"line\">|  4 | Rose | _23234awdasdwf |  17 |    0 |</span><br><span class=\"line\">|  5 | Atom | pwd            |  16 |    0 |</span><br><span class=\"line\">|  6 | Per  | pwd            |  18 |    0 |</span><br><span class=\"line\">|  8 | CoCo | agc            |  17 |    1 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 尝试将 age &gt; 17 的name插入到test中。注意了，插入几个值和查询的值要匹配。这里提示2条成功</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT test(name) SELECT name FROM users WHERE age &gt; 17;</span><br><span class=\"line\">Query OK, 2 rows affected (0.03 sec)</span><br><span class=\"line\">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\">#检查结果，这里可以看到 users 表中 age &gt; 17 的name值插入到test中。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM test;</span><br><span class=\"line\">+----+------+</span><br><span class=\"line\">| id | name |</span><br><span class=\"line\">+----+------+</span><br><span class=\"line\">|  1 | Tom  |</span><br><span class=\"line\">|  2 | Per  |</span><br><span class=\"line\">+----+------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"更新表数据（一）\"><a href=\"#更新表数据（一）\" class=\"headerlink\" title=\"更新表数据（一）\"></a>更新表数据（一）</h4><p><code>UPDATE [LOW_PRIORITY] [IGNORE] tabel_refernce SET columns_name1 = { expre1 | DEFAULT} , columns_name2 = { expre2 | DEFAULT}] ... [WHERE where_condition]  </code></p>\n<ul>\n<li>单表更新，这里需要注意的是，如果不添加where判断条件，会导致该表所有记录都被更新。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 这里使用users表中的数据。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  1 | Tom  | _23234awdasdwf |  23 | NULL |</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  17 | NULL |</span><br><span class=\"line\">|  4 | Rose | _23234awdasdwf |  17 |    0 |</span><br><span class=\"line\">|  5 | Atom | pwd            |  21 |    0 |</span><br><span class=\"line\">|  6 | Per  | pwd            |  23 |    0 |</span><br><span class=\"line\">|  7 | CoCo | pwd            |  22 |    0 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 这条SQL语句表示让这个表中所有的age 都 + 5；</span><br><span class=\"line\">[root@localhost][Demo]&gt; UPDATE users SET age &#x3D; age + 5;</span><br><span class=\"line\">Query OK, 6 rows affected (0.00 sec)</span><br><span class=\"line\">Rows matched: 6  Changed: 6  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看结果，已经全部更新。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  1 | Tom  | _23234awdasdwf |  28 | NULL |</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  22 | NULL |</span><br><span class=\"line\">|  4 | Rose | _23234awdasdwf |  22 |    0 |</span><br><span class=\"line\">|  5 | Atom | pwd            |  26 |    0 |</span><br><span class=\"line\">|  6 | Per  | pwd            |  28 |    0 |</span><br><span class=\"line\">|  7 | CoCo | pwd            |  27 |    0 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 添加where_condition。将age &gt; 25 的记录 age - 5；</span><br><span class=\"line\">[root@localhost][Demo]&gt; UPDATE users SET age &#x3D; age - 5 WHERE age &gt; 25;</span><br><span class=\"line\">Query OK, 4 rows affected (0.01 sec)</span><br><span class=\"line\">Rows matched: 4  Changed: 4  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看结果</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  1 | Tom  | _23234awdasdwf |  23 | NULL |</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  22 | NULL |</span><br><span class=\"line\">|  4 | Rose | _23234awdasdwf |  22 |    0 |</span><br><span class=\"line\">|  5 | Atom | pwd            |  21 |    0 |</span><br><span class=\"line\">|  6 | Per  | pwd            |  23 |    0 |</span><br><span class=\"line\">|  7 | CoCo | pwd            |  22 |    0 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"更新表数据（二）\"><a href=\"#更新表数据（二）\" class=\"headerlink\" title=\"更新表数据（二）\"></a>更新表数据（二）</h4><ul>\n<li>多表更新: <code>UPDATE table_reference SET columns_name = { expr1 | DEFAULT } [ columns_name2 = { expr2 | DEFAULT }]... [WHERE where_condition]</code></li>\n<li>但是呢多表更新实际上是需要使用要连接，这里不做过多的皆是，简单的演示一下。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建一张user_names 表来存储用户的名字，其实没啥意义，就是演示下。</span><br><span class=\"line\">[root@localhost][Demo]&gt; CREATE TABLE user_names(</span><br><span class=\"line\">    -&gt; id TINYINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,</span><br><span class=\"line\">    -&gt; name VARCHAR(40) NOT NULL,</span><br><span class=\"line\">    -&gt; uid TINYINT UNSIGNED NOT NULL</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.07 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 检查下表结构</span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW COLUMNS FROM user_names;</span><br><span class=\"line\">+-------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| Field | Type                | Null | Key | Default | Extra          |</span><br><span class=\"line\">+-------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| id    | tinyint(3) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class=\"line\">| name  | varchar(40)         | NO   |     | NULL    |                |</span><br><span class=\"line\">| uid   | tinyint(3) unsigned | NO   |     | NULL    |                |</span><br><span class=\"line\">+-------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">3 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 我们先吧用户的名字和主键都插入进来。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT INTO user_names(uid,name) SELECT id , name FROM users ;</span><br><span class=\"line\">Query OK, 6 rows affected (0.01 sec)</span><br><span class=\"line\">Records: 6  Duplicates: 0  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM user_names;</span><br><span class=\"line\">+----+------+-----+</span><br><span class=\"line\">| id | name | uid |</span><br><span class=\"line\">+----+------+-----+</span><br><span class=\"line\">|  1 | Atom |   5 |</span><br><span class=\"line\">|  2 | CoCo |   8 |</span><br><span class=\"line\">|  3 | Jon  |   3 |</span><br><span class=\"line\">|  4 | Per  |   6 |</span><br><span class=\"line\">|  5 | Rose |   4 |</span><br><span class=\"line\">|  6 | Tom  |   1 |</span><br><span class=\"line\">+----+------+-----+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 这个时候吧users表中某个用户的名字修改一次，在更新到user_names表中去。</span><br><span class=\"line\">[root@localhost][Demo]&gt; UPDATE users SET name &#x3D; &#39;Misa&#39; WHERE id &#x3D; 1;</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br><span class=\"line\">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\"># 最后演示多表更新</span><br><span class=\"line\">[root@localhost][Demo]&gt; UPDATE user_names AS un INNER JOIN users AS u ON un.uid &#x3D; u.id SET un.name &#x3D; u.name;</span><br><span class=\"line\">Query OK, 1 row affected (0.00 sec)</span><br><span class=\"line\">Rows matched: 6  Changed: 1  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\"># 这里可以看到uid 为 1 的名字已经发生了变化。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM user_names;</span><br><span class=\"line\">+----+------+-----+</span><br><span class=\"line\">| id | name | uid |</span><br><span class=\"line\">+----+------+-----+</span><br><span class=\"line\">|  1 | Atom |   5 |</span><br><span class=\"line\">|  2 | CoCo |   8 |</span><br><span class=\"line\">|  3 | Jon  |   3 |</span><br><span class=\"line\">|  4 | Per  |   6 |</span><br><span class=\"line\">|  5 | Rose |   4 |</span><br><span class=\"line\">|  6 | Misa |   1 |</span><br><span class=\"line\">+----+------+-----+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"删除表数据（一）\"><a href=\"#删除表数据（一）\" class=\"headerlink\" title=\"删除表数据（一）\"></a>删除表数据（一）</h4><p><code>DELETE FROM table_name [WHERE where_condition] </code></p>\n<ul>\n<li>单条删除，如果省略where_condition将删除所有数据。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 删除一条id为7的记录。</span><br><span class=\"line\">[root@localhost][Demo]&gt; DELETE FROM users WHERE id &#x3D; 7;</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 检查结果</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  1 | Misa | _23234awdasdwf |  23 | NULL |</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  22 | NULL |</span><br><span class=\"line\">|  4 | Rose | _23234awdasdwf |  22 |    0 |</span><br><span class=\"line\">|  5 | Atom | pwd            |  21 |    0 |</span><br><span class=\"line\">|  6 | Per  | pwd            |  23 |    0 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<p>这里需要注意的是，如果是自增类型主键，当被删除了最大的主键之后。再次插入数据并不会在现在的最大主键上自增。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 在添加一条测试数据来验证下主键自增的规律。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT users VALUES(NULL,&#39;CoCo&#39;,&#39;agc&#39;,22,1);</span><br><span class=\"line\">Query OK, 1 row affected (0.05 sec)</span><br><span class=\"line\"># 结果发现直接从6到8,而7是刚才被删除的记录。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  1 | Misa | _23234awdasdwf |  23 | NULL |</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  22 | NULL |</span><br><span class=\"line\">|  4 | Rose | _23234awdasdwf |  22 |    0 |</span><br><span class=\"line\">|  5 | Atom | pwd            |  21 |    0 |</span><br><span class=\"line\">|  6 | Per  | pwd            |  23 |    0 |</span><br><span class=\"line\">|  8 | CoCo | agc            |  22 |    1 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"删除表数据（二）\"><a href=\"#删除表数据（二）\" class=\"headerlink\" title=\"删除表数据（二）\"></a>删除表数据（二）</h4><p><code>DELETE table_name[.*] [, table_name[.*]] ... FROM table_referneces [WHERE where_condition]</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 这里使用一张表进行删除。这里吧重复密码的账号进行删除，但是只保留id最小的那一个。实际上这个操作没啥用。</span><br><span class=\"line\">[root@localhost][Demo]&gt; DELETE t1 FROM users AS t1 LEFT JOIN (SELECT id , pwd  FROM users GROUP BY pwd HAVING count(pwd) &gt;&#x3D; 2 ) AS t2 ON t1.pwd  &#x3D; t2.pwd WHERE t1.id &gt; t2.id;</span><br><span class=\"line\">Query OK, 3 rows affected (0.02 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 在检查一下。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  1 | Misa | _23234awdasdwf |  18 |    1 |</span><br><span class=\"line\">|  5 | Atom | pwd            |  16 |    0 |</span><br><span class=\"line\">|  8 | CoCo | agc            |  17 |    1 |</span><br><span class=\"line\">| 10 | Pet  | abc            |  22 |    1 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h4 id=\"查询表数据（一）\"><a href=\"#查询表数据（一）\" class=\"headerlink\" title=\"查询表数据（一）\"></a>查询表数据（一）</h4><blockquote>\n<p>在通常情况下，大部分的SQL都是查询语句，所以查询最后说明。</p>\n</blockquote>\n<p><code>SELECT select_expr[ select_expre ...]</code></p>\n<p><code>[</code></p>\n<p>​    <code>FROM table_reference</code></p>\n<p>​    <code>[WHERE where_condition]</code></p>\n<p>​    <code>[GROUP BY {columns_name | position}] [ASC | DESC] </code>    </p>\n<p>​    <code>[HAVING where_condition]</code></p>\n<p>​    <code>[ORDER BY {columns_name | expre | position}] [ASC | DESC]</code></p>\n<p>​    <code>[LIMIT {[offset] row_count | row_count OFFSET}]</code></p>\n<p><code>]</code></p>\n<h5 id=\"查询表达式-SELECT-EXPR\"><a href=\"#查询表达式-SELECT-EXPR\" class=\"headerlink\" title=\"查询表达式 SELECT_EXPR\"></a>查询表达式 <code>SELECT_EXPR</code></h5><ol>\n<li>每个表达式标识想要的一列，必须至少有一列；多列之间使用逗号分割。* 号表示全部，table_name.* 表示该命名表的所有列。</li>\n<li>查询表达式可以使用[AS] alisa_name 赋予别名。同时别名可用与GROUP BY ,ORDER BY 或者HAVING子句。字段顺序、字段的别名会影响结果集。</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 依然使用users来做测试数据。</span><br><span class=\"line\"># 只查询users表中id 和 name;并且使用使用alisa_name。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT u.id AS uid , u.name AS uname FROM users AS u;</span><br><span class=\"line\">+-----+-------+</span><br><span class=\"line\">| uid | uname |</span><br><span class=\"line\">+-----+-------+</span><br><span class=\"line\">|   5 | Atom  |</span><br><span class=\"line\">|   8 | CoCo  |</span><br><span class=\"line\">|   3 | Jon   |</span><br><span class=\"line\">|   6 | Per   |</span><br><span class=\"line\">|   4 | Rose  |</span><br><span class=\"line\">|   1 | Tom   |</span><br><span class=\"line\">+-----+-------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 使用陷阱,如果使用alisa_name 而没有使用AS 关键就会导致下面的问题。可能是少写了一个逗号，而结果确实一个结果集。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT id name FROM users;</span><br><span class=\"line\">+------+</span><br><span class=\"line\">| name |</span><br><span class=\"line\">+------+</span><br><span class=\"line\">|    5 |</span><br><span class=\"line\">|    8 |</span><br><span class=\"line\">|    3 |</span><br><span class=\"line\">|    6 |</span><br><span class=\"line\">|    4 |</span><br><span class=\"line\">|    1 |</span><br><span class=\"line\">+------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"条件表达式-GROUP-BY\"><a href=\"#条件表达式-GROUP-BY\" class=\"headerlink\" title=\"条件表达式 GROUP BY\"></a>条件表达式 <code>GROUP BY</code></h5><p><code>GROUP BY {columns_name | position} [ASC | DESC],...</code></p>\n<ul>\n<li>如果没有指定WHERE子句，则显示全部数据。在WHERE表达式中，可以使用MYSQL内置函数或者是运算符。</li>\n<li>ASC 是升序、DESC是降序，若存在多个分组条件那就用逗号分割。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 依然使用users表中的测试数据，但是要将sex 为NULL的数据进行修改。</span><br><span class=\"line\">[root@localhost][Demo]&gt; UPDATE users SET sex &#x3D; 1 WHERE sex IS NULL;</span><br><span class=\"line\">Query OK, 2 rows affected (0.01 sec)</span><br><span class=\"line\">Rows matched: 2  Changed: 2  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  1 | Tom  | _23234awdasdwf |  23 |    1 |</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  22 |    1 |</span><br><span class=\"line\">|  4 | Rose | _23234awdasdwf |  22 |    0 |</span><br><span class=\"line\">|  5 | Atom | pwd            |  21 |    0 |</span><br><span class=\"line\">|  6 | Per  | pwd            |  23 |    0 |</span><br><span class=\"line\">|  8 | CoCo | agc            |  22 |    1 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 使用GROUP BY 来做分组。这里分组的结果就是0和1。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT sex FROM users GROUP BY sex;</span><br><span class=\"line\">+------+</span><br><span class=\"line\">| sex  |</span><br><span class=\"line\">+------+</span><br><span class=\"line\">|    0 |</span><br><span class=\"line\">|    1 |</span><br><span class=\"line\">+------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"分组条件-HAVING\"><a href=\"#分组条件-HAVING\" class=\"headerlink\" title=\"分组条件 HAVING \"></a>分组条件 <code>HAVING </code></h5><p><code>[HAVING where_condition]</code></p>\n<ul>\n<li>使用HAVING只对一部分数据来分组。需要注意的是，如果使用HAVING语句，那么在查询结果中就存在对应的字段。并切与函数进行配合。</li>\n</ul>\n<p>这里需改修改一处配置信息，由于本人使用的是MYSQL5.7版本，所以GROUP BY和以往不一样。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 检查当前sql_mode;</span><br><span class=\"line\">select @@sql_mode;</span><br></pre></td></tr></table></figure>\n\n<p>5.7中默认设置了<code>sql_mode=only_full_group_by</code></p>\n<p>修改下my.cof。在<code>[mysqld]</code>下面添加</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">sql_mode&#x3D;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</span><br></pre></td></tr></table></figure>\n\n<p>就是不要only_full_group_by这个。</p>\n<p>简单解释下only_full_group_by是干嘛的。</p>\n<p><code>使用这个就是使用和oracle一样的group 规则, select的列都要在group中,或者本身是聚合列(SUM,AVG,MAX,MIN) 才行</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 回到 HAVING分组条件上。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT sex , age FROM users GROUP BY sex HAVING age &gt; 21;</span><br><span class=\"line\">+------+-----+</span><br><span class=\"line\">| sex  | age |</span><br><span class=\"line\">+------+-----+</span><br><span class=\"line\">|    0 |  22 |</span><br><span class=\"line\">|    1 |  23 |</span><br><span class=\"line\">+------+-----+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"结果排序-ORDER-BY\"><a href=\"#结果排序-ORDER-BY\" class=\"headerlink\" title=\"结果排序 ORDER BY\"></a>结果排序 <code>ORDER BY</code></h5><p><code>ORDER BY {columns_name | expr | position} [ASC | DESC],...</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 使用ORDER BY 来做排序 DESC ，由于默认是ASC升序；所以这里用DESC降序来演示。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users ORDER BY id DESC;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  8 | CoCo | agc            |  22 |    1 |</span><br><span class=\"line\">|  6 | Per  | pwd            |  23 |    0 |</span><br><span class=\"line\">|  5 | Atom | pwd            |  21 |    0 |</span><br><span class=\"line\">|  4 | Rose | _23234awdasdwf |  22 |    0 |</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  22 |    1 |</span><br><span class=\"line\">|  1 | Tom  | _23234awdasdwf |  23 |    1 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 对多个字段进行排序。这里可以看到虽然CoCo 和 Roes 都是22age 但是id采用了降序。所以CoCo排在前面。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users ORDER BY age , id DESC;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  5 | Atom | pwd            |  21 |    0 |</span><br><span class=\"line\">|  8 | CoCo | agc            |  22 |    1 |</span><br><span class=\"line\">|  4 | Rose | _23234awdasdwf |  22 |    0 |</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  22 |    1 |</span><br><span class=\"line\">|  6 | Per  | pwd            |  23 |    0 |</span><br><span class=\"line\">|  1 | Tom  | _23234awdasdwf |  23 |    1 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"限制查询-LIMIT\"><a href=\"#限制查询-LIMIT\" class=\"headerlink\" title=\"限制查询 LIMIT \"></a>限制查询 <code>LIMIT </code></h5><p><code>LIMIT {offset,} row_count | row_count OFFSET offset</code></p>\n<ul>\n<li>限制查询结果的返回集合。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 这会返回第一和第二条数据。这个LIMIT和ID的排序没有一点关系的。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users LIMIT 2;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  1 | Tom  | _23234awdasdwf |  23 |    1 |</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  22 |    1 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\"></span><br><span class=\"line\"># 需要注意的是LIMIT限制查询和其他条件是没有关系的，它仅仅是在结果集中过滤。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users ORDER BY age DESC LIMIT 2;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  1 | Tom  | _23234awdasdwf |  23 |    1 |</span><br><span class=\"line\">|  6 | Per  | pwd            |  23 |    0 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 还有一种情况就是范围。先看看全部数据。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users ORDER BY age DESC;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  1 | Tom  | _23234awdasdwf |  23 |    1 |</span><br><span class=\"line\">|  6 | Per  | pwd            |  23 |    0 |</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  22 |    1 |</span><br><span class=\"line\">|  4 | Rose | _23234awdasdwf |  22 |    0 |</span><br><span class=\"line\">|  8 | CoCo | agc            |  22 |    1 |</span><br><span class=\"line\">|  5 | Atom | pwd            |  21 |    0 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 我们尝试获取结果集中第三条和第四条。这里需要注意的时候结果集的下标是从0开始的。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM users ORDER BY age DESC LIMIT 2 , 2;</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">| id | name | pwd            | age | sex  |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">|  3 | Jon  | _23234awdasdwf |  22 |    1 |</span><br><span class=\"line\">|  4 | Rose | _23234awdasdwf |  22 |    0 |</span><br><span class=\"line\">+----+------+----------------+-----+------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"数据库表操作小结\"><a href=\"#数据库表操作小结\" class=\"headerlink\" title=\"数据库表操作小结\"></a>数据库表操作小结</h4><ul>\n<li><p>插入</p>\n<ul>\n<li><code>INSERT [INTO] table_name [(columns_name , ... )] VALUES(value , ...)</code></li>\n<li><code>INSERT [INTO] table_name SET columns_name ={ expr | DEFAULT},...</code></li>\n<li><code>INSERT [INTO] tablle_name [(columns_name,...)] SELECT ...</code></li>\n</ul>\n</li>\n<li><p>更新</p>\n<ul>\n<li><code>UPDATE [LOW_PRIORITY] [IGNORE] tabel_refernce SET columns_name1 = { expre1 | DEFAULT} , columns_name2 = { expre2 | DEFAULT}] ... [WHERE where_condition]</code></li>\n</ul>\n</li>\n<li><p>删除</p>\n<ul>\n<li><code>DELETE FROM table_name [WHERE where_condition]</code></li>\n</ul>\n</li>\n<li><p>查询</p>\n<ul>\n<li><p><code>SELECT select_expr[ select_expre ...]</code></p>\n<p><code>[</code></p>\n<p>​    <code>FROM table_reference</code></p>\n<p>​    <code>[WHERE where_condition]</code></p>\n<p>​    <code>[GROUP BY {columns_name | position}] [ASC | DESC] </code>    </p>\n<p>​    <code>[HAVING where_condition]</code></p>\n<p>​    <code>[ORDER BY {columns_name | expre | position}] [ASC | DESC]</code></p>\n<p>​    <code>[LIMIT {[offset] row_count | row_count OFFSET}]</code></p>\n<p><code>]</code></p>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h4 id=\"约束\"><a href=\"#约束\" class=\"headerlink\" title=\"约束\"></a>约束</h4><blockquote>\n<p>实际上分为两种，表约束和列约束。列属性的约束上面已经讲述了，现在来讲述下表约束。</p>\n</blockquote>\n<h5 id=\"列约束\"><a href=\"#列约束\" class=\"headerlink\" title=\"列约束\"></a>列约束</h5><ul>\n<li>在之前的<code>插入表数据（一）</code>中已经演示了5种常用的约束，下面主要介绍表之前的约束。</li>\n</ul>\n<h5 id=\"外键约束\"><a href=\"#外键约束\" class=\"headerlink\" title=\"外键约束\"></a>外键约束</h5><ol>\n<li>父表和子表必须使用相同的存储引擎，而且禁止使用临时表。</li>\n<li>数据表的存储引擎只能是InnoDB。</li>\n<li>外键列和参照列必须具有相同的数据类型，其中数字的长度或是否有符号<code>UNSIGNED</code>必须一致；而字符的长度可以不同。</li>\n<li>外键列和参照列必须创建索引，如果没有创建Mysql也会自动创建。</li>\n</ol>\n<p><code>由于本人开发中，使用外键的场景比较少，所以这里最后在补充。</code></p>\n<h5 id=\"数据库存储引擎\"><a href=\"#数据库存储引擎\" class=\"headerlink\" title=\"数据库存储引擎\"></a>数据库存储引擎</h5><p>数据库默认的的存储引擎可以在<code>my.cof</code>中设置。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">default-storage-engine=INNODB</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>Mysql可以将数据以不同的技术存储在文件（内存）中，这种技术就成为存储引擎。</p>\n</li>\n<li><p>每一种存储引擎使用不同的存储机制、索引技巧、锁定水平，最终提供广泛且不同的功能。</p>\n</li>\n<li><p>引擎类型</p>\n<ul>\n<li>MyISAM</li>\n<li>InnoDB</li>\n<li>Memory</li>\n<li>CSV</li>\n<li>Archive</li>\n</ul>\n</li>\n<li><p>而确定使用那种引擎取决与引用场景。</p>\n<ul>\n<li>并发控制：<code>当多个连接对记录经行修改时候，保证数据的一致性和完整性</code></li>\n<li>锁：共享锁（读锁）、排它锁（写锁）。<ul>\n<li><code>读锁</code>同一个时间内，多个用户可以读取同一个资源，读取过程中数据不会发生任何变化。</li>\n<li><code>写锁</code>在任何时候只能有一个用户能写入资源，当其他写锁时会阻塞其他读锁或则写锁操作。</li>\n<li>锁颗粒<ul>\n<li>表锁（开销很小的锁策略）、行锁（开销很大的锁策略）。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>事务（ACID）：<code>保证数据库的完整性</code><ul>\n<li>原子性</li>\n<li>一致性</li>\n<li>隔离性</li>\n<li>持久性</li>\n</ul>\n</li>\n<li>索引</li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>特点</th>\n<th>MyISAM</th>\n<th>InnoDB</th>\n<th>Memory</th>\n<th>Archive</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>存储限制</td>\n<td>256TB</td>\n<td>64TB</td>\n<td>有</td>\n<td>无</td>\n</tr>\n<tr>\n<td>事务安全</td>\n<td>-</td>\n<td>支持</td>\n<td>-</td>\n<td>-</td>\n</tr>\n<tr>\n<td>支持索引</td>\n<td>支持</td>\n<td>支持</td>\n<td>支持</td>\n<td>-</td>\n</tr>\n<tr>\n<td>锁颗粒</td>\n<td>表锁</td>\n<td>行锁</td>\n<td>表锁</td>\n<td>行锁</td>\n</tr>\n<tr>\n<td>数据压缩</td>\n<td>支持</td>\n<td>-</td>\n<td>-</td>\n<td>支持</td>\n</tr>\n<tr>\n<td>支持外键</td>\n<td>-</td>\n<td>支持</td>\n<td>-</td>\n<td>-</td>\n</tr>\n</tbody></table>\n<p>看到这张表很清楚了，这就是为什么InnoDB用的很广泛的原因。</p>\n<h2 id=\"Mysql数据类型\"><a href=\"#Mysql数据类型\" class=\"headerlink\" title=\"Mysql数据类型\"></a>Mysql数据类型</h2><blockquote>\n<p>数据类型是指列、存储过程参数、表达式和局部变量的数据特征，它们决定了数据存储的格式，代表了不同的数据信息类型。我们的计算都是二进制来存储数据的，当然这还牵扯到一个问题就是正数和负数。</p>\n</blockquote>\n<h3 id=\"数据类型思维导图\"><a href=\"#数据类型思维导图\" class=\"headerlink\" title=\"数据类型思维导图\"></a>数据类型思维导图</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"http://on-img.com/chart_image/5ae4f0d5e4b090f6eebc1b16.png?_=1524954928511\"></p>\n<h3 id=\"数据类型存储范围说明\"><a href=\"#数据类型存储范围说明\" class=\"headerlink\" title=\"数据类型存储范围说明\"></a>数据类型存储范围说明</h3><blockquote>\n<p>所谓的无符号就是unsigned，这样会使大小翻倍。</p>\n</blockquote>\n<h4 id=\"整型\"><a href=\"#整型\" class=\"headerlink\" title=\"整型\"></a>整型</h4><ul>\n<li>TINYINT <code>迷你整数型</code><ul>\n<li>字节：<code>1</code></li>\n</ul>\n</li>\n<li>SMALLINT <code>小整型</code><ul>\n<li>字节：<code>2</code></li>\n</ul>\n</li>\n<li>MEDIUMINT <code>中整型</code><ul>\n<li>字节：<code>3</code> </li>\n</ul>\n</li>\n<li>INT <code>标准整型</code><ul>\n<li>字节：<code>4</code></li>\n</ul>\n</li>\n<li>BIGINT <code>大整型</code><ul>\n<li>字节：<code>8</code></li>\n</ul>\n</li>\n</ul>\n<p>用Java代码测试下。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"采用移位运算所以次方所以相比次方的数值会减一\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"TINTITN 有符号 \"</span>+ (-<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">6</span>) + <span class=\"string\">\" 到 \"</span> +((<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">6</span>) - <span class=\"number\">1</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"TINTITN 无符号 0 到 \"</span>+(Math.pow(<span class=\"number\">2L</span>,<span class=\"number\">8</span>) - <span class=\"number\">1</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"SMALLINT 有符号 \"</span>+ (-<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">14</span>) + <span class=\"string\">\" 到 \"</span> +((<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">14</span>) - <span class=\"number\">1</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"SMALLINT 无符号 0 到 \"</span>+((<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">14</span>) - <span class=\"number\">1</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"MEDIUMINT 有符号 \"</span>+ (-<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">22</span>) + <span class=\"string\">\" 到 \"</span> +((<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">22</span>) - <span class=\"number\">1</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"MEDIUMINT 无符号 0 到 \"</span>+((<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">23</span>) - <span class=\"number\">1</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"INT 有符号 \"</span>+ (-<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">30</span>) + <span class=\"string\">\" 到 \"</span> +((<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">30</span>) - <span class=\"number\">1</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"INT 无符号 0 到 \"</span>+((<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">31</span>) - <span class=\"number\">1</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"BIGINT 有符号 \"</span>+ (-<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">62</span>) + <span class=\"string\">\" 到 \"</span> +((<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">62</span>) - <span class=\"number\">1</span>));</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"BIGINT 无符号 0 到 \"</span>+ ((<span class=\"number\">2L</span> &lt;&lt; <span class=\"number\">63</span>) - <span class=\"number\">1</span>));</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出</p>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">采用移位运算所以次方所以相比次方的数值会减一</span><br><span class=\"line\">TINTITN 有符号 -<span class=\"number\">128</span> 到 <span class=\"number\">127</span></span><br><span class=\"line\">TINTITN 无符号 <span class=\"number\">0</span> 到 <span class=\"number\">255.0</span></span><br><span class=\"line\">SMALLINT 有符号 -<span class=\"number\">32768</span> 到 <span class=\"number\">32767</span></span><br><span class=\"line\">SMALLINT 无符号 <span class=\"number\">0</span> 到 <span class=\"number\">32767</span></span><br><span class=\"line\">MEDIUMINT 有符号 -<span class=\"number\">8388608</span> 到 <span class=\"number\">8388607</span></span><br><span class=\"line\">MEDIUMINT 无符号 <span class=\"number\">0</span> 到 <span class=\"number\">16777215</span></span><br><span class=\"line\">INT 有符号 -<span class=\"number\">2147483648</span> 到 <span class=\"number\">2147483647</span></span><br><span class=\"line\">INT 无符号 <span class=\"number\">0</span> 到 <span class=\"number\">4294967295</span></span><br><span class=\"line\">BIGINT 有符号 -<span class=\"number\">9223372036854775808</span> 到 <span class=\"number\">9223372036854775807</span></span><br><span class=\"line\">BIGINT 无符号 <span class=\"number\">0</span> 到-<span class=\"number\">1</span></span><br><span class=\"line\"># 这里可以看到BIGINT 无符号Java long数据类型已经满足不了了。</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在数据优化的原则上，合理的选择存储数据类型。而不是盲目的选择数据类型大。比如我们的年龄用TINTINT 就够了。也就说在指定数据类型的时候，一般是采用从小原则，这样会对MYSQL的效率提高很多。当然做好设计。</p>\n</blockquote>\n<h5 id=\"SQL测试\"><a href=\"#SQL测试\" class=\"headerlink\" title=\"SQL测试\"></a>SQL测试</h5><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建int类型的表看看。</span><br><span class=\"line\">[root@localhost][Demo]&gt; CREATE TABLE test_int(</span><br><span class=\"line\">    -&gt; id TINYINT UNSIGNED PRIMARY KEY AUTO_INCREMENT ,</span><br><span class=\"line\">    -&gt; int_1 TINYINT ,</span><br><span class=\"line\">    -&gt; int_2 SMALLINT ,</span><br><span class=\"line\">    -&gt; int_3 MEDIUMINT ,</span><br><span class=\"line\">    -&gt; int_4 INT ,</span><br><span class=\"line\">    -&gt; int_5 BIGINT</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.07 sec)</span><br><span class=\"line\"># 查看表结构。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW COLUMNS FROM test_int;</span><br><span class=\"line\">+-------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| Field | Type                | Null | Key | Default | Extra          |</span><br><span class=\"line\">+-------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| id    | tinyint(3) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class=\"line\">| int_1 | tinyint(4)          | YES  |     | NULL    |                |</span><br><span class=\"line\">| int_2 | smallint(6)         | YES  |     | NULL    |                |</span><br><span class=\"line\">| int_3 | mediumint(9)        | YES  |     | NULL    |                |</span><br><span class=\"line\">| int_4 | int(11)             | YES  |     | NULL    |                |</span><br><span class=\"line\">| int_5 | bigint(20)          | YES  |     | NULL    |                |</span><br><span class=\"line\">+-------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">#插入测试1，整型插入。成功。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT INTO test_int VALUES(NULL,1,2,3,4,5);</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">#插入测试2,用单引号包裹数字。竟然成功了。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT INTO test_int VALUES(NULL,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;);</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">#插入测试3，用字符串测试。肯定是插入不成功。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT INTO test_int VALUES(NULL,&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;);</span><br><span class=\"line\">ERROR 1366 (HY000): Incorrect integer value: &#39;a&#39; for column &#39;int_1&#39; at row 1</span><br><span class=\"line\"></span><br><span class=\"line\">#测试下有符号的情况，这里提示int_1 超过范围了。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT INTO test_int VALUES(NULL,-200,2,3,4,5);</span><br><span class=\"line\">ERROR 1264 (22003): Out of range value for column &#39;int_1&#39; at row 1</span><br><span class=\"line\"></span><br><span class=\"line\">#修改参数试试，成功了。TINYINT 有符号 是 -128 到 127。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT INTO test_int VALUES(NULL,-128,2,3,4,5);</span><br><span class=\"line\">Query OK, 1 row affected (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">#修改 int_1 的属性 修改成UNSIGNED。无符号。注意在修改字段属性的时候，如果已经存在数据请确认存在的数据是否有不合法的。</span><br><span class=\"line\">[root@localhost][Demo]&gt; ALTER TABLE test_int MODIFY int_1 TINYINT UNSIGNED;</span><br><span class=\"line\">ERROR 1264 (22003): Out of range value for column &#39;int_1&#39; at row 3</span><br><span class=\"line\"></span><br><span class=\"line\">#为了继续测试，删除掉表中数据。</span><br><span class=\"line\">[root@localhost][Demo]&gt; DELETE FROM test_int;</span><br><span class=\"line\">Query OK, 4 rows affected (0.03 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">#重新修改表字段结构。</span><br><span class=\"line\">[root@localhost][Demo]&gt; ALTER TABLE test_int MODIFY int_1 TINYINT UNSIGNED;</span><br><span class=\"line\">Query OK, 0 rows affected (0.13 sec)</span><br><span class=\"line\">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\"># 检查是否修改成功。可以看到 int_1 添加了UNSIGNED属性约束了。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW COLUMNS FROM test_int;</span><br><span class=\"line\">+-------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| Field | Type                | Null | Key | Default | Extra          |</span><br><span class=\"line\">+-------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| id    | tinyint(3) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class=\"line\">| int_1 | tinyint(3) unsigned | YES  |     | NULL    |                |</span><br><span class=\"line\">| int_2 | smallint(6)         | YES  |     | NULL    |                |</span><br><span class=\"line\">| int_3 | mediumint(9)        | YES  |     | NULL    |                |</span><br><span class=\"line\">| int_4 | int(11)             | YES  |     | NULL    |                |</span><br><span class=\"line\">| int_5 | bigint(20)          | YES  |     | NULL    |                |</span><br><span class=\"line\">+-------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br><span class=\"line\"># 插入TINYINT 最大值试试，OK这里是成功的。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT INTO test_int VALUES(NULL,255,2,3,4,5);</span><br><span class=\"line\">Query OK, 1 row affected (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 当超过TINYINT UNSIGNED最大的时候就会抛出异常信息。</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT INTO test_int VALUES(NULL,256,2,3,4,5);</span><br><span class=\"line\">ERROR 1264 (22003): Out of range value for column &#39;int_1&#39; at row 1</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>这里就演示TINYINT存储范围的情况了，实际上其它证书型基本类似。</p>\n</blockquote>\n<p>实际上有一点需要注意就是TYPE中的花括弧中的数字是干嘛的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 这个3个是干嘛的呢？</span><br><span class=\"line\">tinyint(3) unsigned</span><br></pre></td></tr></table></figure>\n\n<p>这实际上是显示宽度的意思。当显示的宽度不够的时候可以使用0来填充，使用<code>zreofuill进行零填充</code>，而且零填充会直接导致该数值变成服务号。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 演示修改表结构,将int_1字段再次修改。</span><br><span class=\"line\">[root@localhost][Demo]&gt; ALTER TABLE test_int MODIFY int_1 TINYINT UNSIGNED ZEROFILL;</span><br><span class=\"line\">Query OK, 0 rows affected (0.02 sec)</span><br><span class=\"line\">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\">#检查表结构是否发生变化</span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW COLUMNS FROM test_int;</span><br><span class=\"line\">+-------+------------------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| Field | Type                         | Null | Key | Default | Extra          |</span><br><span class=\"line\">+-------+------------------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| id    | tinyint(3) unsigned          | NO   | PRI | NULL    | auto_increment |</span><br><span class=\"line\">| int_1 | tinyint(3) unsigned zerofill | YES  |     | NULL    |                |</span><br><span class=\"line\">| int_2 | smallint(6)                  | YES  |     | NULL    |                |</span><br><span class=\"line\">| int_3 | mediumint(9)                 | YES  |     | NULL    |                |</span><br><span class=\"line\">| int_4 | int(11)                      | YES  |     | NULL    |                |</span><br><span class=\"line\">| int_5 | bigint(20)                   | YES  |     | NULL    |                |</span><br><span class=\"line\">+-------+------------------------------+------+-----+---------+----------------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 插入新的数据</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT test_int VALUES(NULL,1,2,3,4,5);</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 刚才插入的int_1位置的值已经发生了变化。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM test_int;</span><br><span class=\"line\">+----+-------+-------+-------+-------+-------+</span><br><span class=\"line\">| id | int_1 | int_2 | int_3 | int_4 | int_5 |</span><br><span class=\"line\">+----+-------+-------+-------+-------+-------+</span><br><span class=\"line\">|  5 |   255 |     2 |     3 |     4 |     5 |</span><br><span class=\"line\">|  6 |   001 |     2 |     3 |     4 |     5 |</span><br><span class=\"line\">+----+-------+-------+-------+-------+-------+</span><br><span class=\"line\">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>填充零的含义更多的就是保证数据的格式。</p>\n</blockquote>\n<h4 id=\"浮点型\"><a href=\"#浮点型\" class=\"headerlink\" title=\"浮点型\"></a>浮点型</h4><ul>\n<li>FLOAT <code>单精度浮点型</code><ul>\n<li>字节：<code>4</code></li>\n</ul>\n</li>\n<li>DOUBLE <code>双精度浮点型</code><ul>\n<li>字节：<code>8</code></li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>在SQL中，将小数型分配两种<code>浮点型</code>和<code>定点型</code>两种。</p>\n</blockquote>\n<ul>\n<li>浮点型使用注意事项，如果直接使用<code>float</code>，则标识没有小数部分，如果用了<code>float(M,D)</code>,其中<code>M</code>代表长度,<code>D</code>代表小数部分长度，<code>M-D</code>则为整数部分长度。</li>\n</ul>\n<h5 id=\"SQL测试-1\"><a href=\"#SQL测试-1\" class=\"headerlink\" title=\"SQL测试\"></a>SQL测试</h5><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建测试表test_float</span><br><span class=\"line\">[root@localhost][Demo]&gt; CREATE TABLE test_float(</span><br><span class=\"line\">    -&gt; id TINYINT UNSIGNED AUTO_INCREMENT PRIMARY KEY ,</span><br><span class=\"line\">    -&gt; float_1 float,</span><br><span class=\"line\">    -&gt; float_2 float(6,2),</span><br><span class=\"line\">    -&gt; float_3 float(4,1)</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.07 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 检查表结构</span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW COLUMNS FROM test_float;</span><br><span class=\"line\">+---------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| Field   | Type                | Null | Key | Default | Extra          |</span><br><span class=\"line\">+---------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">| id      | tinyint(3) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class=\"line\">| float_1 | float               | YES  |     | NULL    |                |</span><br><span class=\"line\">| float_2 | float(6,2)          | YES  |     | NULL    |                |</span><br><span class=\"line\">| float_3 | float(4,1)          | YES  |     | NULL    |                |</span><br><span class=\"line\">+---------+---------------------+------+-----+---------+----------------+</span><br><span class=\"line\">4 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">#插入模拟数据</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT INTO test_float VALUES(NULL,2.1534,11,888.1);</span><br><span class=\"line\">Query OK, 1 row affected (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">#这里需要注意的时候 float(4,2)实际标识的整数位小于4，而不是小于等于。测试下</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT INTO test_float VALUES(NULL,2.1534,11,8888.1);</span><br><span class=\"line\">ERROR 1264 (22003): Out of range value for column &#39;float_3&#39; at row 1</span><br><span class=\"line\"># 结果很明显，8888.1 插入失败。所以插入的时候也需要注意。</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"定点型\"><a href=\"#定点型\" class=\"headerlink\" title=\"定点型\"></a>定点型</h4><ul>\n<li>DECIMAL <code>定点数</code><ul>\n<li>字节：<code>3</code></li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>定点型数据，绝对的保证整数部分不会被四舍五入，也就是说不会损失经度，但是小数部分有可能损失精度，虽然理论上小数部分也不会丢失精度。</p>\n</blockquote>\n<h5 id=\"SQL测试-2\"><a href=\"#SQL测试-2\" class=\"headerlink\" title=\"SQL测试\"></a>SQL测试</h5><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 与float比较，看看是否会四舍五入。</span><br><span class=\"line\">[root@localhost][Demo]&gt; CREATE TABLE test_decimal(</span><br><span class=\"line\">    -&gt; id TINYINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,</span><br><span class=\"line\">    -&gt; float_1 float(10,2),</span><br><span class=\"line\">    -&gt; decimal_1 decimal(10,2)                                                                         </span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.09 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 测试模拟数据</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT test_decimal VALUES(NULL,99999999.99 , 99999999.99);</span><br><span class=\"line\">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 果然啊，float的被四舍五入了，而decimal保留的小数位。</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM test_decimal;</span><br><span class=\"line\">+----+--------------+-------------+</span><br><span class=\"line\">| id | float_1      | decimal_1   |</span><br><span class=\"line\">+----+--------------+-------------+</span><br><span class=\"line\">|  2 | 100000000.00 | 99999999.99 |</span><br><span class=\"line\">+----+--------------+-------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"日期类型\"><a href=\"#日期类型\" class=\"headerlink\" title=\"日期类型\"></a>日期类型</h4><ul>\n<li>YEAR <code>年份</code><ul>\n<li>字节：<code>1</code></li>\n</ul>\n</li>\n<li>TIME <code>时间</code><ul>\n<li>字节：<code>3</code></li>\n</ul>\n</li>\n<li>DATE <code>日期</code><ul>\n<li>字节：<code>3</code></li>\n</ul>\n</li>\n<li>DATETIME <code>日期时间</code><ul>\n<li>字节：<code>8</code></li>\n</ul>\n</li>\n<li>TIMESTAMP  <code>时间戳</code><ul>\n<li>字节：<code>4</code></li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>由于存在跨时区的问题，所以一般都是存数字日期，日期类型用的相对会比较少。</p>\n</blockquote>\n<ul>\n<li>补充类型概况<ul>\n<li><code>DATATIME</code>：日期时间，其格式为<code>yyyy-MM-dd HH:mm:ss</code>，表示的范围是从 1000 年到 9999 年，有零值，即<code>0000-00-00 0000:00</code>；</li>\n<li><code>DATA</code>：日期，就是<code>datetime</code>的<code>date</code>部分；</li>\n<li><code>TIME</code>：时间，或者说是时间段，为指定的某个时间区间之间，包含正负时间；</li>\n<li><code>TIMESTAMP  </code>：时间戳，但并不是真正意义上的时间戳，其是从<code>1970</code>年开始计算的，格式和<code>datetime</code>一致；</li>\n<li><code>YEAR </code>：年份，共有两种格式，分别为<code>year(2)</code>和<code>year(4)</code>.</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"SQL测试-3\"><a href=\"#SQL测试-3\" class=\"headerlink\" title=\"SQL测试\"></a>SQL测试</h5><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建一日期测试表 test_date</span><br><span class=\"line\">[root@localhost][Demo]&gt; CREATE TABLE test_date(</span><br><span class=\"line\">    -&gt; id TINYINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,</span><br><span class=\"line\">    -&gt; date_1 DATETIME,</span><br><span class=\"line\">    -&gt; date_2 DATE,</span><br><span class=\"line\">    -&gt; date_3 TIME,</span><br><span class=\"line\">    -&gt; date_4 YEAR,</span><br><span class=\"line\">    -&gt; date_5 TIMESTAMP</span><br><span class=\"line\">    -&gt; );</span><br><span class=\"line\">Query OK, 0 rows affected (0.04 sec)</span><br><span class=\"line\"></span><br><span class=\"line\">#检查表结构</span><br><span class=\"line\">[root@localhost][Demo]&gt; SHOW COLUMNS FROM test_date;</span><br><span class=\"line\">+--------+---------------------+------+-----+-------------------+-----------------------------+</span><br><span class=\"line\">| Field  | Type                | Null | Key | Default           | Extra                       |</span><br><span class=\"line\">+--------+---------------------+------+-----+-------------------+-----------------------------+</span><br><span class=\"line\">| id     | tinyint(3) unsigned | NO   | PRI | NULL              | auto_increment              |</span><br><span class=\"line\">| date_1 | datetime            | YES  |     | NULL              |                             |</span><br><span class=\"line\">| date_2 | date                | YES  |     | NULL              |                             |</span><br><span class=\"line\">| date_3 | time                | YES  |     | NULL              |                             |</span><br><span class=\"line\">| date_4 | year(4)             | YES  |     | NULL              |                             |</span><br><span class=\"line\">| date_5 | timestamp           | NO   |     | CURRENT_TIMESTAMP | on update CURRENT_TIMESTAMP |</span><br><span class=\"line\">+--------+---------------------+------+-----+-------------------+-----------------------------+</span><br><span class=\"line\">6 rows in set (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 添加测试数据</span><br><span class=\"line\">[root@localhost][Demo]&gt; INSERT INTO test_date VALUES(NULL,&#39;2017-05-06 13:15:00&#39;,&#39;2017-05-06&#39;,&#39;13:15:00&#39;,2018,&#39;2017-05-06 13:15:00&#39;);</span><br><span class=\"line\">Query OK, 1 row affected (0.00 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 检查数据结果</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM test_date;</span><br><span class=\"line\">+----+---------------------+------------+----------+--------+---------------------+</span><br><span class=\"line\">| id | date_1              | date_2     | date_3   | date_4 | date_5              |</span><br><span class=\"line\">+----+---------------------+------------+----------+--------+---------------------+</span><br><span class=\"line\">|  1 | 2017-05-06 13:15:00 | 2017-05-06 | 13:15:00 |   2018 | 2017-05-06 13:15:00 |</span><br><span class=\"line\">+----+---------------------+------------+----------+--------+---------------------+</span><br><span class=\"line\">1 row in set (0.01 sec)</span><br><span class=\"line\"></span><br><span class=\"line\"># 验证下时间戳是否会自动更新。</span><br><span class=\"line\">[root@localhost][Demo]&gt; UPDATE test_date SET date_4 &#x3D; 2017 WHERE id &#x3D; 1;</span><br><span class=\"line\">Query OK, 1 row affected (0.01 sec)</span><br><span class=\"line\">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class=\"line\"></span><br><span class=\"line\"># 检查下结果</span><br><span class=\"line\">[root@localhost][Demo]&gt; SELECT * FROM test_date;</span><br><span class=\"line\">+----+---------------------+------------+----------+--------+---------------------+</span><br><span class=\"line\">| id | date_1              | date_2     | date_3   | date_4 | date_5              |</span><br><span class=\"line\">+----+---------------------+------------+----------+--------+---------------------+</span><br><span class=\"line\">|  1 | 2017-05-06 13:15:00 | 2017-05-06 | 13:15:00 |   2017 | 2018-05-02 04:36:31 |</span><br><span class=\"line\">+----+---------------------+------------+----------+--------+---------------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br><span class=\"line\"># 这里可以看到 date_5 已经发生了变化。</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"字符型\"><a href=\"#字符型\" class=\"headerlink\" title=\"字符型\"></a>字符型</h4><ul>\n<li>CHAR(M)<ul>\n<li>字节：<code>M个字节，0 &lt;= M &lt;= 255</code></li>\n</ul>\n</li>\n<li>VARCHAR(M)<ul>\n<li>字节：<code>L + 1个字节 , 其中L &lt;= M 且 0 &lt;= M &lt;= 65535</code></li>\n</ul>\n</li>\n<li>TINYTEXT<ul>\n<li>字节：<code>L + 1个字节， 其中L &lt; 2^8。</code></li>\n</ul>\n</li>\n<li>TEXT<ul>\n<li>字节：<code>L + 2个字节，其中L &lt; 2^16。</code></li>\n</ul>\n</li>\n<li>MEDIUMTEXT<ul>\n<li>字节：<code>L + 3个字节，其中L &lt; 2^24。</code></li>\n</ul>\n</li>\n<li>LONGTEXT<ul>\n<li>字节：<code>L + 4个字节，其中 L &lt; 2^32。</code></li>\n</ul>\n</li>\n<li>ENMU（’value1’,’value2’）<ul>\n<li>字节：<code>1或者2字节，取决与枚举值的个数（最多65535个值）。</code></li>\n</ul>\n</li>\n<li>SET（’value1’,’value2’）<ul>\n<li>字节：<code>1、2、3、4或者8字节，取决与Set成员的数目（最多64个成员）</code></li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>这里涉及到定长和变长，比如说CHAR（M），如果存储的是ABC但是没有达到指定的长度就会在ABC后面添加空格直至满足长度大小。</p>\n</blockquote>\n<p>字符串分类</p>\n<ul>\n<li>定长：<code>CHAR</code></li>\n<li>变长：<code>VARCHAR</code></li>\n<li>文本：<code>TINYTEXT</code>、<code>TEXT</code>、<code>MEDIUMTEXT</code>、<code>LONGTEXT</code></li>\n<li>枚举：<code>ENMU</code></li>\n<li>集合：<code>SET</code></li>\n</ul>\n","categories":["Mysql"],"tags":["Mysql"]},{"title":"源码阅读-Stack","url":"/posts/340816784/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n<h3 id=\"Stack\"><a href=\"#Stack\" class=\"headerlink\" title=\"Stack\"></a>Stack</h3><ul>\n<li>栈是元素的集合，其包含了两个基本操作：push 操作可以用于将元素压入栈，pop 操作可以将栈顶元素移除。</li>\n<li>遵循后入先出（LIFO）原则。</li>\n<li>时间复杂度:</li>\n<li>索引: <code>O(n)</code></li>\n<li>搜索: <code>O(n)</code></li>\n<li>插入: <code>O(1)</code></li>\n<li>移除: <code>O(1)</code></li>\n</ul>\n</blockquote>\n<h2 id=\"Stack-1\"><a href=\"#Stack-1\" class=\"headerlink\" title=\"Stack\"></a>Stack</h2><blockquote>\n<p>Collection成员之一，继承了Vector，通过重写Vector来实现LIFO（Last-in-First-out 后进先出）特性。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Stack/Stack.png\"></p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><ul>\n<li>Java Stack是LIFO对象。它扩展了Vector类。</li>\n</ul>\n<h2 id=\"源码分析Stack\"><a href=\"#源码分析Stack\" class=\"headerlink\" title=\"源码分析Stack\"></a>源码分析Stack</h2><a id=\"more\"></a>\n\n<blockquote>\n<p>由于方法不多，直接贴整个类代码。Stack只有一个构造方法，也就说维护列队的特性是继承至Vector</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Stack</span>&lt;<span class=\"title\">E</span>&gt; <span class=\"keyword\">extends</span> <span class=\"title\">Vector</span>&lt;<span class=\"title\">E</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Creates an empty Stack.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Stack</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 将对象推到堆叠顶部。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">push</span><span class=\"params\">(E item)</span> </span>&#123;</span><br><span class=\"line\">        addElement(item);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> item;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 删除堆栈顶部的对象，并返回该对象作为此函数的值。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> E <span class=\"title\">pop</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        E       obj;</span><br><span class=\"line\">        <span class=\"keyword\">int</span>     len = size();</span><br><span class=\"line\"></span><br><span class=\"line\">        obj = peek();</span><br><span class=\"line\">        removeElementAt(len - <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 查看堆栈顶部的对象，而不将其从堆栈中移除。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> E <span class=\"title\">peek</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span>     len = size();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (len == <span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> EmptyStackException();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> elementAt(len - <span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 判断Stack是否为空，也就是长度为0的时候。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">empty</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> size() == <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回一个对象在堆栈上的基于1的位置，找不到就返回-1。</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">int</span> <span class=\"title\">search</span><span class=\"params\">(Object o)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> i = lastIndexOf(o);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> size() - i;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/** use serialVersionUID from JDK 1.0.2 for interoperability */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1224463164541339165L</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1、push\"><a href=\"#1、push\" class=\"headerlink\" title=\"1、push\"></a>1、push</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    String[] arr = <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">\"a\"</span>,<span class=\"string\">\"b\"</span>,<span class=\"string\">\"c\"</span>,<span class=\"string\">\"d\"</span>&#125;;</span><br><span class=\"line\">    Stack stack = <span class=\"keyword\">new</span> Stack();</span><br><span class=\"line\">    stack.addAll(Arrays.asList(arr));</span><br><span class=\"line\">    System.out.println(stack);</span><br><span class=\"line\">    stack.push(<span class=\"string\">\"a\"</span>);</span><br><span class=\"line\">    System.out.println(stack);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 输出</span></span><br><span class=\"line\">[a, b, c, d]</span><br><span class=\"line\">[a, b, c, d, a]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、pop\"><a href=\"#2、pop\" class=\"headerlink\" title=\"2、pop\"></a>2、pop</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test1</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    String[] arr = <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">\"a\"</span>,<span class=\"string\">\"b\"</span>,<span class=\"string\">\"c\"</span>,<span class=\"string\">\"d\"</span>&#125;;</span><br><span class=\"line\">    Stack stack = <span class=\"keyword\">new</span> Stack();</span><br><span class=\"line\">    stack.addAll(Arrays.asList(arr));</span><br><span class=\"line\">    System.out.println(stack);</span><br><span class=\"line\">    stack.pop();</span><br><span class=\"line\">    System.out.println(stack);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 输出</span></span><br><span class=\"line\">[a, b, c, d]</span><br><span class=\"line\">[a, b, c]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、peek\"><a href=\"#3、peek\" class=\"headerlink\" title=\"3、peek\"></a>3、peek</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test2</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    String[] arr = <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">\"a\"</span>,<span class=\"string\">\"b\"</span>,<span class=\"string\">\"c\"</span>,<span class=\"string\">\"d\"</span>&#125;;</span><br><span class=\"line\">    Stack&lt;String&gt; stack = <span class=\"keyword\">new</span> Stack();</span><br><span class=\"line\">    stack.addAll(Arrays.asList(arr));</span><br><span class=\"line\">    System.out.println(stack);</span><br><span class=\"line\">    String str = stack.peek();</span><br><span class=\"line\">    System.out.println(str);</span><br><span class=\"line\">    System.out.println(stack);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 输出</span></span><br><span class=\"line\">[a, b, c, d]</span><br><span class=\"line\">d</span><br><span class=\"line\">[a, b, c, d]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4、search\"><a href=\"#4、search\" class=\"headerlink\" title=\"4、search\"></a>4、search</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test3</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">     String[] arr = <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">\"a\"</span>,<span class=\"string\">\"b\"</span>,<span class=\"string\">\"c\"</span>,<span class=\"string\">\"d\"</span>&#125;;</span><br><span class=\"line\">        Stack&lt;String&gt; stack = <span class=\"keyword\">new</span> Stack();</span><br><span class=\"line\">        stack.addAll(Arrays.asList(arr));</span><br><span class=\"line\">        System.out.println(stack);</span><br><span class=\"line\">        Integer index = stack.search(<span class=\"string\">\"a\"</span>);</span><br><span class=\"line\">        System.out.println(index);</span><br><span class=\"line\">        index = stack.search(<span class=\"string\">\"b\"</span>);</span><br><span class=\"line\">        System.out.println(index);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//输出</span></span><br><span class=\"line\">[a, b, c, d]</span><br><span class=\"line\"><span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">3</span></span><br></pre></td></tr></table></figure>","categories":["源码分析"],"tags":["Java","Java-Collecions-Framework","Stack"]},{"title":"深入浅出Vector","url":"/posts/1064381917/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<h2 id=\"Vector\"><a href=\"#Vector\" class=\"headerlink\" title=\"Vector\"></a>Vector</h2><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Vector/Vector.png\"></p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><ul>\n<li>Vector是Java Collection Franmework成员。</li>\n<li>列队允许添加重复元素</li>\n<li>列队允许null的存在</li>\n<li>列队从0开始，也就是列队头部的下标是0。</li>\n<li>列队支持泛型，这样可以避免<code>ClassCastException</code>异常。</li>\n</ul>\n<h2 id=\"与ArrayList的区别\"><a href=\"#与ArrayList的区别\" class=\"headerlink\" title=\"与ArrayList的区别\"></a>与ArrayList的区别</h2><a id=\"more\"></a>\n\n<ul>\n<li>Vector和ArrayList几乎完全项目，几个不相同的特征分别是。<ul>\n<li>Vector是同步的，自带的方法大多被synchronized修饰。所以开销比ArrayList大很多。</li>\n<li>Vector默认每次扩容大小，ArrayList 是1.5倍；Vector是2倍。</li>\n<li>可以指定扩容系数，不指定就是2倍。</li>\n</ul>\n</li>\n<li>相对与ArrayList，Vector牺牲了性能换取同步，但是实际上可以通过<code>Collections.synchronizedList(new ArrayList&lt;&gt;());</code>来返回一个线程安全的List,可以可以使用<code>concurrent</code>包下CopyOnWriteArrayList类。</li>\n<li>所以一般不建议使用Vector。</li>\n</ul>\n<h2 id=\"源码分析下Vector\"><a href=\"#源码分析下Vector\" class=\"headerlink\" title=\"源码分析下Vector\"></a>源码分析下Vector</h2><blockquote>\n<p>Vector中常量以及变量</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 集合中的数组元素</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span> Object[] elementData;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 集合中数组大小，这里不是用size。</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">int</span> elementCount;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 扩容的时候增长数量，如果是0或者负数就是2倍。</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">int</span> capacityIncrement;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 容器的最大容量</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class=\"number\">8</span>;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1、如何创建Vector\"><a href=\"#1、如何创建Vector\" class=\"headerlink\" title=\"1、如何创建Vector\"></a>1、如何创建Vector</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    String[] arr = <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">\"a\"</span> , <span class=\"string\">\"b\"</span> , <span class=\"string\">\"c\"</span> , <span class=\"string\">\"d\"</span>&#125;;</span><br><span class=\"line\">        Vector list = <span class=\"keyword\">new</span> Vector(<span class=\"number\">1</span> , <span class=\"number\">10</span>);</span><br><span class=\"line\">        list.addAll(Arrays.asList(arr));</span><br><span class=\"line\">        System.out.println(list);</span><br><span class=\"line\"></span><br><span class=\"line\">        Vector list1 = <span class=\"keyword\">new</span> Vector(<span class=\"number\">10</span>);</span><br><span class=\"line\">        list1.addAll(Arrays.asList(arr));</span><br><span class=\"line\">        System.out.println(list1);</span><br><span class=\"line\"></span><br><span class=\"line\">        Vector list2 = <span class=\"keyword\">new</span> Vector();</span><br><span class=\"line\">        list2.addAll(Arrays.asList(arr));</span><br><span class=\"line\">        System.out.println(list2);</span><br><span class=\"line\"></span><br><span class=\"line\">        Vector list3 = <span class=\"keyword\">new</span> Vector(Arrays.asList(arr));</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(list3);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[a, b, c, d]</span><br><span class=\"line\">[a, b, c, d]</span><br><span class=\"line\">[a, b, c, d]</span><br><span class=\"line\">[a, b, c, d]</span><br></pre></td></tr></table></figure>\n\n<p>这里分别使用了Vectro四个构造方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//list</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Vector</span><span class=\"params\">(<span class=\"keyword\">int</span> initialCapacity, <span class=\"keyword\">int</span> capacityIncrement)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>();</span><br><span class=\"line\">        <span class=\"comment\">//指定容器初始化大小和扩容系数。</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (initialCapacity &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">\"Illegal Capacity: \"</span>+</span><br><span class=\"line\">                                               initialCapacity);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.elementData = <span class=\"keyword\">new</span> Object[initialCapacity];</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.capacityIncrement = capacityIncrement;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//list1    </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Vector</span><span class=\"params\">(<span class=\"keyword\">int</span> initialCapacity)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//指定容器的初始化大小。默认扩容系数0。</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>(initialCapacity, <span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;    </span><br><span class=\"line\"><span class=\"comment\">//list2    </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Vector</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 指定容器的初始化大小为10。</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>(<span class=\"number\">10</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//list2</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Vector</span><span class=\"params\">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">//将一个Collection容器的元素都复制进来</span></span><br><span class=\"line\">        elementData = c.toArray();</span><br><span class=\"line\">        elementCount = elementData.length;</span><br><span class=\"line\">        <span class=\"comment\">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (elementData.getClass() != Object[]<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\">            <span class=\"title\">elementData</span> </span>= Arrays.copyOf(elementData, elementCount, Object[]<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1、看下扩容代码\"><a href=\"#1、看下扩容代码\" class=\"headerlink\" title=\"1、看下扩容代码\"></a>1、看下扩容代码</h3><blockquote>\n<p>由于Vector的方法和ArrayList的方法太多相似，这里看看如何扩容的。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 从add方法入口看</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">boolean</span> <span class=\"title\">add</span><span class=\"params\">(E e)</span> </span>&#123;</span><br><span class=\"line\">        modCount++;</span><br><span class=\"line\">        ensureCapacityHelper(elementCount + <span class=\"number\">1</span>);  <span class=\"comment\">//判断扩容</span></span><br><span class=\"line\">        elementData[elementCount++] = e;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">ensureCapacityHelper</span><span class=\"params\">(<span class=\"keyword\">int</span> minCapacity)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// overflow-conscious code</span></span><br><span class=\"line\">        <span class=\"comment\">// 如果最小容量不够用了就扩容</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (minCapacity - elementData.length &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            grow(minCapacity);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">grow</span><span class=\"params\">(<span class=\"keyword\">int</span> minCapacity)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// overflow-conscious code</span></span><br><span class=\"line\">        <span class=\"comment\">// 容器原始大小</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> oldCapacity = elementData.length;</span><br><span class=\"line\">        <span class=\"comment\">// 如果capacityIncrement &gt; 0 新大小 就等于oldCapacity + capacityIncrement 反之就等于 oldCapacity + oldCapacity 相对与2倍了。</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> newCapacity = oldCapacity + ((capacityIncrement &gt; <span class=\"number\">0</span>) ?</span><br><span class=\"line\">                                         capacityIncrement : oldCapacity);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newCapacity - minCapacity &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            newCapacity = minCapacity;</span><br><span class=\"line\">        <span class=\"comment\">// 判断新大小是否超过大限制</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            newCapacity = hugeCapacity(minCapacity);</span><br><span class=\"line\">        <span class=\"comment\">// 复制生成新的数组</span></span><br><span class=\"line\">        elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">hugeCapacity</span><span class=\"params\">(<span class=\"keyword\">int</span> minCapacity)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (minCapacity &lt; <span class=\"number\">0</span>) <span class=\"comment\">// overflow</span></span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> OutOfMemoryError();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class=\"line\">            Integer.MAX_VALUE :</span><br><span class=\"line\">            MAX_ARRAY_SIZE;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","categories":["源码分析"],"tags":["Java","Java-Collecions-Framework","Vector"]},{"title":"Centos7-RabbitMQ-Deploy","url":"/posts/4038168856/","content":"<h1 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h1><ul>\n<li><a href=\"https://segmentfault.com/a/1190000010693696\" target=\"_blank\" rel=\"noopener\">CentOs7.3 搭建 RabbitMQ 3.6 单机服务与使用</a>   </li>\n</ul>\n<h2 id=\"RabbitMQ介绍\"><a href=\"#RabbitMQ介绍\" class=\"headerlink\" title=\"RabbitMQ介绍\"></a>RabbitMQ介绍</h2><blockquote>\n<p>RabbitMQ 是一个由 Erlang 语言开发的 AMQP 的开源实现。<br>AMQP ：Advanced Message Queue，高级消息队列协议。它是应用层协议的一个开放标准，为面向消息的中间件设计，基于此协议的客户端与消息中间件可传递消息，并不受产品、开发语言等条件的限制。</p>\n</blockquote>\n<h3 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h3><blockquote>\n<p>RabbitMQ 是流行的开源消息队列系统，是 AMQP（Advanced Message Queuing Protocol 高级消息队列协议）的标准实现，用 erlang 语言开发。RabbitMQ 具有良好的性能和时效性，同时还能够非常好的支持集群和负载部署，非常适合在较大规模的分布式系统中使用。</p>\n</blockquote>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><blockquote>\n<p>RabbitMQ 基于erlang。需要先安装erlang环境。</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<h3 id=\"一、安装-erlang\"><a href=\"#一、安装-erlang\" class=\"headerlink\" title=\"一、安装 erlang\"></a>一、安装 erlang</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">// 下载</span><br><span class=\"line\">[root@localhost backup]#  rpm -Uvh http://download.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-8.noarch.rpm</span><br><span class=\"line\">// 安装</span><br><span class=\"line\">[root@localhost backup]#  yum install erlang</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"二、安装RabbitMQ\"><a href=\"#二、安装RabbitMQ\" class=\"headerlink\" title=\"二、安装RabbitMQ\"></a>二、安装RabbitMQ</h3><ul>\n<li>下载rpm</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost backup]# wget http://www.rabbitmq.com/releases/rabbitmq-server/v3.6.6/rabbitmq-server-3.6.6-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>安装</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost backup]# yum install rabbitmq-server-3.6.6-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>启动</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost backup]# systemctl status rabbitmq-server.service</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>添加配置文件 </li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost backup]# /etc/rabbitmq/rabbitmq.config</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>编辑配置文件rabbitmq.config，如果不清楚位置可以查看状态信息。</p>\n<ul>\n<li>创建rabbitmq.config</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost backup]# cd /etc/rabbitmq/</span><br><span class=\"line\">[root@localhost rabbitmq]# vi rabbitmq.config</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>编辑一下内容</li>\n</ul>\n<figure class=\"highlight erlang\"><table><tr><td class=\"code\"><pre><span class=\"line\">[&#123;rabbit, [&#123;loopback_users, []&#125;]&#125;].</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>这里的意思是开放使用，rabbitmq默认创建的用户guest，密码也是guest，这个用户默认只能是本机访问，localhost或者127.0.0.1，如果需要从外部访问需要添加上面的配置。</li>\n</ul>\n</li>\n<li><p>重启服务</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">service rabbitmq-server restart</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/rabbitmq/success1.png\"></p>\n<ul>\n<li>上图说明启动成功。</li>\n<li>开启UI管理。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost rabbitmq]# &#x2F;sbin&#x2F;rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/rabbitmq/ui1.png\"></p>\n<ul>\n<li>重启之后访问  <a href=\"http://ip/\" target=\"_blank\" rel=\"noopener\">http://ip</a>:15672 可以看到界面了。帐号密码都是guest</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/rabbitmq/login.png\"></p>\n<h2 id=\"异常处理\"><a href=\"#异常处理\" class=\"headerlink\" title=\"异常处理\"></a>异常处理</h2><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost rabbitmq]# systemctl status rabbitmq-server.service</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Failed to start RabbitMQ broker 错误信息。</li>\n</ul>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/rabbitmq/failed1.png\"></p>\n","categories":["Dev"],"tags":["Centos7","Linux","RabbitMQ"]},{"title":"Centos7-Redis-Deploy","url":"/posts/809784495/","content":"<h1 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h1><blockquote>\n<p>Redis全称：Remote Dictionary Server(远程数据服务)。Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p>\n</blockquote>\n<h2 id=\"单实例安装\"><a href=\"#单实例安装\" class=\"headerlink\" title=\"单实例安装\"></a>单实例安装</h2><blockquote>\n<p>只是学习使用使用yum 方式安装比较快。而且centos自带官方源。</p>\n</blockquote>\n<h3 id=\"yum安装\"><a href=\"#yum安装\" class=\"headerlink\" title=\"yum安装\"></a>yum安装</h3><ul>\n<li>yum install epel-release    –下载fedora的epel仓库</li>\n<li>yum install redis    – 安装redis数据库</li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"Redis数据库配置\"><a href=\"#Redis数据库配置\" class=\"headerlink\" title=\"Redis数据库配置\"></a>Redis数据库配置</h3><ul>\n<li>如果要想配置<code>Redis</code>数据库，主要的配置文件就是<strong>redis.conf</strong>，所有的配置项一定要在此处完成。</li>\n</ul>\n<ul>\n<li><code>Redis</code>作为一个具备有持久化功能的缓存数据库，所以其一定会有一个用于数据存储的目录，那么一般在 <code>Redis</code> 处理的时候会有三类文件需要做保存：<code>Redis</code>运行时的<code>pid</code>、<code>Redis</code>相关处理日志、<code>Redis</code>的数据文件，所以建立一个目录用于存放这些数据：</li>\n<li>在一个目录同时创建多个文件夹</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost bin]# mkdir -p /opt/redis/&#123;run,logs,dbcache&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>检查redis安装位置；使用whereis命令只能用于程序名的搜索。</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost bin]# whereis redis</span><br><span class=\"line\">redis: /etc/redis.conf</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改<strong>redis.conf</strong>的配置文件：<code>vim /etc/redis.conf</code><ul>\n<li>配置<code>Redis</code>运行端口：<code>port 6379</code></li>\n<li>配置<code>Redis</code>是否为后台运行：<code>daemonize yes</code></li>\n<li>设置进程保存路径：<code>pidfile &quot;/opt/redis/run/redis_6379.pid&quot;</code></li>\n<li>设置日志保存目录：<code>logfile &quot;/opt/redis/logs/redis.log&quot;</code></li>\n<li>该<code>Redis</code>支持的数据库个数：<code>databases 16</code></li>\n<li>保存数据文件目录：<code>dir /opt/redis/dbcache</code></li>\n</ul>\n</li>\n</ul>\n<p>3.启动Redis服务：<code>/usr/bin/redis-server /etc/redis.conf</code></p>\n<ul>\n<li>如果要启动<code>Redis-Server</code>就必须明确的指明要使用的<code>redis.conf</code>配置文件；</li>\n</ul>\n<p>4.<code>Redis</code>启动会占用<code>6379</code>的端口，所以查看端口：<code>netstat -nptl</code>；</p>\n<ul>\n<li>此时发现Redis运行的时候是在6379本机下才可以执行，所以无法对外提供服务；</li>\n</ul>\n<h3 id=\"安全設置\"><a href=\"#安全設置\" class=\"headerlink\" title=\"安全設置\"></a>安全設置</h3><p>Redis的配置文件默认在<code>/etc/redis.conf</code>，找到如下行：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#requirepass foobared</span></span><br></pre></td></tr></table></figure>\n\n<p>去掉前面的注释，并修改为所需要的密码：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">requirepass myPassword （其中myPassword就是要设置的密码）</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"WARNING\"><a href=\"#WARNING\" class=\"headerlink\" title=\"WARNING\"></a>WARNING</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/redis/WARNING1.png\"></p>\n<ul>\n<li>它是 内存分配策略；可选值：0、1、2。</li>\n<li>0， 表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则，内存申请失败，并把错误返回给应用进程。</li>\n</ul>\n<ul>\n<li>1， 表示内核允许分配所有的物理内存，而不管当前的内存状态如何。</li>\n<li>2， 表示内核允许分配超过所有物理内存和交换空间总和的内存</li>\n</ul>\n<p><strong>解决方法：</strong></p>\n<blockquote>\n<p>很简单，按提示的操作（将vm.overcommit_memory 设为1 即可；有三种方式修改内核参数，但要有root权限：</p>\n</blockquote>\n<ul>\n<li>编辑/etc/sysctl.conf ，改vm.overcommit_memory=1，然后sysctl -p 使配置文件生效</li>\n<li>sysctl vm.overcommit_memory=1</li>\n<li>echo 1 &gt; /proc/sys/vm/overcommit_memory</li>\n</ul>\n<p>第一种永久有效。</p>\n<h2 id=\"基本操作\"><a href=\"#基本操作\" class=\"headerlink\" title=\"基本操作\"></a>基本操作</h2><ul>\n<li>开启方式</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost bin]# redis-server /etc/redis.conf</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>开启后台启动 # 在redis.conf  设置  daemonize yes</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">daemonize on</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>查看redis是否开启</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost bin]# ps -ef | grep redis</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>进入redis服务</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost bin]# redis-cli</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>关闭redis服务</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost bin]# redis-cli  shutdown</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>在设置认证密码之后关闭需要先认证</p>\n<ul>\n<li>若不认证会抛出Redis (error) NOAUTH Authentication required。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost bin]# redis-cli</span><br><span class=\"line\">&gt; auth &quot;password&quot;</span><br><span class=\"line\">OK </span><br><span class=\"line\">&gt; shutdown</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>显示OK 表示认证成功。</li>\n</ul>\n","categories":["Dev"],"tags":["Redis","Centos7","Linux"]},{"title":"Centos7-Mongodb-Deploy","url":"/posts/1440395111/","content":"<blockquote>\n<p>mongodb的安装方式比较简单，下面演示在CentOS7上用yum方式安装。</p>\n</blockquote>\n<h2 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h2><ul>\n<li>下载地址 <a href=\"https://www.mongodb.com/download-center#community\" target=\"_blank\" rel=\"noopener\">https://www.mongodb.com/download-center#community</a></li>\n<li>在线文档 <a href=\"https://docs.mongodb.com/manual/introduction/\" target=\"_blank\" rel=\"noopener\">https://docs.mongodb.com/manual/introduction/</a></li>\n</ul>\n<h2 id=\"使用yum方式安装\"><a href=\"#使用yum方式安装\" class=\"headerlink\" title=\"使用yum方式安装\"></a>使用yum方式安装</h2><blockquote>\n<p>仅供学习参考，若在生产环境中部署请注意修改安全配置。</p>\n</blockquote>\n<ul>\n<li>整个mongodb（社区版）包含如下软件</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>软件名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>mongodb-org-server</td>\n<td>包含mongod守护程序和关联的配置和init脚本</td>\n</tr>\n<tr>\n<td>mongodb-org-mongos</td>\n<td>包含mongos守护程序</td>\n</tr>\n<tr>\n<td>mongodb-org-shell</td>\n<td>包含mongo shell，它是一个连接mongodb的命令行客户端，允许用户直接输入nosql语法管理数据库。</td>\n</tr>\n<tr>\n<td>mongodb-org-tools</td>\n<td>包含以下工具的MongoDB：数据导入、导出、备份、恢复等等</td>\n</tr>\n</tbody></table>\n<ul>\n<li>创建yum源文件</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/yum.repos.d/mongodb-org-3.4.repo1</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<ul>\n<li>把下面的内容复制到上面的文件中</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[mongodb-org-3.4]</span><br><span class=\"line\">name=MongoDB Repository</span><br><span class=\"line\">baseurl=https://repo.mongodb.org/yum/redhat/<span class=\"variable\">$releasever</span>/mongodb-org/3.4/x86_64/</span><br><span class=\"line\">gpgcheck=1</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgkey=https://www.mongodb.org/static/pgp/server-3.4.asc123456</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>启动yum命令开始安装</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum install -y mongodb-org1</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>如果使用SELinux，则必须配置SELinux，以允许在基于Red Hat Linux的系统（Red Hat Enterprise Linux或CentOS Linux）上启动MongoDB。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/selinux/config</span><br><span class=\"line\"><span class=\"comment\">#在打开的文件中将值设置为disabled</span></span><br><span class=\"line\">SELINUX=disabled</span><br></pre></td></tr></table></figure>\n<h2 id=\"关闭THP\"><a href=\"#关闭THP\" class=\"headerlink\" title=\"关闭THP\"></a>关闭THP</h2><blockquote>\n<p>自CentOS6版本开始引入了Transparent Huge Pages(THP)，从CentOS7版本开始，该特性默认就会启用。尽管THP的本意是为提升内存的性能，不过某些数据库厂商还是建议直接关闭THP(比如说Oracle、MariaDB、MongoDB等)，否则可能会导致性能出现下降。</p>\n</blockquote>\n<p>首先检查THP的启用状态：不关闭mongo启动的时候会警告。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">// 检查THP状态</span><br><span class=\"line\">cat /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class=\"line\">[always] madvise never</span><br><span class=\"line\">cat /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class=\"line\">[always] madvise never</span><br><span class=\"line\">这个状态就说明都是启用的。</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">//禁用THP,编辑rc.local文件</span><br><span class=\"line\">vim /etc/rc.d/rc.local</span><br><span class=\"line\">增加下列内容：</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">test</span> -f /sys/kernel/mm/transparent_hugepage/enabled; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">test</span> -f /sys/kernel/mm/transparent_hugepage/defrag; <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n\n<p>  编辑完了需要重启服务器才能生效。</p>\n<h2 id=\"配置信息\"><a href=\"#配置信息\" class=\"headerlink\" title=\"配置信息\"></a>配置信息</h2><h3 id=\"mongo配置文件操作\"><a href=\"#mongo配置文件操作\" class=\"headerlink\" title=\"mongo配置文件操作\"></a>mongo配置文件操作</h3><ul>\n<li><p>安装完后寻找相关配置信息</p>\n</li>\n<li><p>whereis mongd</p>\n</li>\n<li><pre><code class=\"bash\">mongod: /usr/bin/mongod /etc/mongod.conf /usr/share/man/man1/mongod.1\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- mongd.conf 就是配置文件。</span><br><span class=\"line\"></span><br><span class=\"line\">- 打开就可以看到相关配置信息。</span><br><span class=\"line\"></span><br><span class=\"line\">### mongdb权限操作配置信息</span><br><span class=\"line\"></span><br><span class=\"line\">#### Built-In Roles（内置角色）：</span><br><span class=\"line\"></span><br><span class=\"line\">- 数据库用户角色：</span><br><span class=\"line\">  - read、readWrite;</span><br><span class=\"line\">- 数据库管理角色：</span><br><span class=\"line\">  - dbAdmin、dbOwner、userAdmin；</span><br><span class=\"line\">- 集群管理角色：</span><br><span class=\"line\">  - clusterAdmin、clusterManager、clusterMonitor、hostManager；</span><br><span class=\"line\">- 备份恢复角色：</span><br><span class=\"line\">  - backup、restore；</span><br><span class=\"line\">- 所有数据库角色：</span><br><span class=\"line\">  - readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</span><br><span class=\"line\">- 超级用户角色：</span><br><span class=\"line\">  - root  </span><br><span class=\"line\">    - 这里还有几个角色间接或直接提供了系统超级用户的访问（dbOwner 、userAdmin、userAdminAnyDatabase）</span><br><span class=\"line\">- 内部角色：</span><br><span class=\"line\">  - __system</span><br><span class=\"line\"></span><br><span class=\"line\">#### 具体角色：</span><br><span class=\"line\"></span><br><span class=\"line\">- Read：</span><br><span class=\"line\">  - 允许用户读取指定数据库。</span><br><span class=\"line\">- readWrite：</span><br><span class=\"line\">  - 允许用户读写指定数据库。</span><br><span class=\"line\">- dbAdmin：</span><br><span class=\"line\">  - 允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile。</span><br><span class=\"line\">- userAdmin：</span><br><span class=\"line\">  - 允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户。</span><br><span class=\"line\">- clusterAdmin：</span><br><span class=\"line\">  - 只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。</span><br><span class=\"line\">- readAnyDatabase：</span><br><span class=\"line\">  - 只在admin数据库中可用，赋予用户所有数据库的读权限。</span><br><span class=\"line\">- readWriteAnyDatabase：</span><br><span class=\"line\">  - 只在admin数据库中可用，赋予用户所有数据库的读写权限。</span><br><span class=\"line\">- userAdminAnyDatabase：</span><br><span class=\"line\">  - 只在admin数据库中可用，赋予用户所有数据库的userAdmin权限。</span><br><span class=\"line\">- dbAdminAnyDatabase：</span><br><span class=\"line\">  - 只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。</span><br><span class=\"line\">- root：</span><br><span class=\"line\">  - 只在admin数据库中可用。超级账号，超级权限。</span><br><span class=\"line\"></span><br><span class=\"line\">### 开启用户权限</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; 提示：即便设置了账号密码依然可以不通过密码链接，需要在mongo 启动的时候开启认证。</span><br><span class=\"line\"></span><br><span class=\"line\">- 创建用户</span><br><span class=\"line\">  - 注意读写用户的权限请使用readWrite。</span><br><span class=\"line\"></span><br><span class=\"line\">&#96;&#96;&#96;json</span><br><span class=\"line\">show dbs; </span><br><span class=\"line\">&#x2F;&#x2F;显示数据库列表</span><br><span class=\"line\"></span><br><span class=\"line\">use admin; </span><br><span class=\"line\"> &#x2F;&#x2F;进入admin collections</span><br><span class=\"line\"></span><br><span class=\"line\">db.createUser(&#123;&quot;user&quot;:&quot;root&quot;,&quot;pwd&quot;:&quot;z201.com&quot;,&quot;roles&quot;:[&#123;&quot;role&quot;:&quot;root&quot;,&quot;db&quot;:&quot;admin&quot;&#125;]&#125;) </span><br><span class=\"line\">&#x2F;&#x2F;创建超级管理员root库管理账号</span><br><span class=\"line\"></span><br><span class=\"line\">db.auth(&quot;root&quot;,&quot;eoner.com&quot;)</span><br><span class=\"line\">&#x2F;&#x2F;校验账号是否匹配</span><br><span class=\"line\">1 </span><br><span class=\"line\">&#x2F;&#x2F;显示1表示匹配成功</span><br><span class=\"line\"></span><br><span class=\"line\">user yisheng; </span><br><span class=\"line\">&#x2F;&#x2F;进入yisheng collections,如果没有该数据库会自己创建一个；但是如果不在里面插入数据是不显示出来的。</span><br><span class=\"line\"></span><br><span class=\"line\">db.createUser(&#123;&quot;user&quot;:&quot;yisheng&quot;,&quot;pwd&quot;:&quot;z201.com&quot;,&quot;roles&quot;:[&#123;&quot;role&quot;:&quot;readWrite&quot;,&quot;db&quot;:&quot;yisheng&quot;&#125;]&#125;)</span><br><span class=\"line\">&#x2F;&#x2F;创建数据库管理员</span><br><span class=\"line\"></span><br><span class=\"line\">db.auth(&quot;yisheng&quot;,&quot;z201.com&quot;)</span><br><span class=\"line\">1 </span><br><span class=\"line\">&#x2F;&#x2F;显示1表示匹配成功</span><br></pre></td></tr></table></figure></code></pre>\n</li>\n<li><p>修改密码</p>\n</li>\n</ul>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">db.changeUserPassword('root','z201.com');</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>数据库开启认证，注意请进入数据库中在执行。</li>\n</ul>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">security:</span><br><span class=\"line\">    authorization:true</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"基础操作\"><a href=\"#基础操作\" class=\"headerlink\" title=\"基础操作\"></a>基础操作</h2><p>启动</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl start mongod</span><br></pre></td></tr></table></figure>\n\n<p>重启</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl restart mongod</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>如果无效</p>\n<ul>\n<li>use admin</li>\n<li>db.shutdownServer();</li>\n</ul>\n</li>\n</ul>\n<p>停止</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl stop mongod</span><br></pre></td></tr></table></figure>\n\n<p>认证模式启动</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nohup mongod --auth --port 27017 --dbpath /var/lib/mongo/ &amp;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>/var/bin/mongd 可以在mongod.conf中查看。</li>\n</ul>\n<h2 id=\"客户端连接失败问题：\"><a href=\"#客户端连接失败问题：\" class=\"headerlink\" title=\"客户端连接失败问题：\"></a>客户端连接失败问题：</h2><blockquote>\n<p><code>SCRAM-SHA-1 authentication failed ``for</code> <code>root</code></p>\n</blockquote>\n<ul>\n<li><p>mongodb加入了SCRAM-SHA-1校验方式，需要第三方工具配合进行验证。如果直接用代码连接会出问题。</p>\n</li>\n<li><p>如果客户端没有SCRAM-SHA-1的校验方式，可以选择将authverison 版本降低；不使用该认证方式，同时工具连接的时候需要手动修改默认的认证方式。</p>\n</li>\n<li><p>参考文献</p>\n<ul>\n<li><a href=\"https://yq.aliyun.com/articles/16919\" target=\"_blank\" rel=\"noopener\">MongoDB中使用的SCRAM-SHA1认证机制</a></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"CURD\"><a href=\"#CURD\" class=\"headerlink\" title=\"CURD\"></a>CURD</h3><ul>\n<li>插入</li>\n</ul>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">db.ops_dev.insert(&#123;title: 'MongoDB ', </span><br><span class=\"line\">    description: 'MongoDB 是一个 Nosql 数据库',</span><br><span class=\"line\">    tags: ['mongodb', 'database', 'NoSQL']</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"其他注意事项\"><a href=\"#其他注意事项\" class=\"headerlink\" title=\"其他注意事项\"></a>其他注意事项</h2><h3 id=\"mongodb进程莫名退出\"><a href=\"#mongodb进程莫名退出\" class=\"headerlink\" title=\"mongodb进程莫名退出\"></a>mongodb进程莫名退出</h3><blockquote>\n<p>每天早上到公司发现Mongo都会自己关闭掉。</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">2018-01-03T18:21:03.135+0800 I CONTROL  [signalProcessingThread] got signal 1 (Hangup), will terminate after current cmd ends</span><br><span class=\"line\">2018-01-03T18:21:03.136+0800 I NETWORK  [signalProcessingThread] shutdown: going to close listening sockets...</span><br><span class=\"line\">2018-01-03T18:21:03.136+0800 I NETWORK  [signalProcessingThread] closing listening socket: 6</span><br><span class=\"line\">2018-01-03T18:21:03.136+0800 I NETWORK  [signalProcessingThread] closing listening socket: 7</span><br><span class=\"line\">2018-01-03T18:21:03.136+0800 I NETWORK  [signalProcessingThread] removing socket file: /tmp/mongodb-27017.sock</span><br><span class=\"line\">2018-01-03T18:21:03.136+0800 I NETWORK  [signalProcessingThread] shutdown: going to flush diaglog...</span><br><span class=\"line\">2018-01-03T18:21:03.136+0800 I FTDC     [signalProcessingThread] Shutting down full-time diagnostic data capture</span><br><span class=\"line\">2018-01-03T18:21:03.138+0800 I STORAGE  [signalProcessingThread] WiredTigerKVEngine shutting down</span><br><span class=\"line\">2018-01-03T18:21:03.366+0800 I STORAGE  [signalProcessingThread] shutdown: removing fs lock...</span><br><span class=\"line\">2018-01-03T18:21:03.366+0800 I CONTROL  [signalProcessingThread] now exiting</span><br><span class=\"line\">2018-01-03T18:21:03.366+0800 I CONTROL  [signalProcessingThread] shutting down with code:0</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>天啦噜有人发送了Hangup。。。好比<code>kill -1 pid</code>,但可以确认的是没有人手动信号给mongodb进程。</li>\n<li>然后网上找了很久发现了这篇文档 <a href=\"https://www.gnu.org/software/bash/manual/html_node/Signals.html\" target=\"_blank\" rel=\"noopener\">Signals</a></li>\n</ul>\n<blockquote>\n<p>Bash resends a SIGHUP to all jobs if it receives a SIGHUP itself; this would include mongod.<br>Also, if you happen to have huponexit turned on, every job will receive a SIGHUP when bash exits. </p>\n</blockquote>\n<p>​    shell登进之后启动了mongo,然后退出shell使用的方式是直接关掉窗口,linux认为这是一起异常退出,这样一来这个shell进程就会收到SIGHUP信号,为了保证状态一致性,从而给它的所有子进程发送SIGHUP信号.而使用命令exit退出就不会有这种问题,因为linux会认为这是一种正常的退出。<br>​    mongodb官方文档会发现mongo有–-fork这样的一个参数,使用该参数启动mongo时,会自动将其挂到init进程(pid为1)下启动,而不加的话ppid(父进程id)就是当前的shell进程。</p>\n<ul>\n<li>如果使用了 fork 参数就必须添加 logpath</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">mongod --fork --auth --port 27017 --dbpath /var/lib/mongo/ --logpath /opt/mongod/mongod.log</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安全的推出方式\"><a href=\"#安全的推出方式\" class=\"headerlink\" title=\"安全的推出方式\"></a>安全的推出方式</h2><blockquote>\n<p>一定要以命令方式关闭</p>\n</blockquote>\n<p>关闭服务时，一定要注意，用–shutdown命令关闭，既方便又安全。</p>\n","categories":["Dev"],"tags":["Centos7","Linux","Mongodb"]},{"title":"Linux-Base-Command","url":"/posts/1254138214/","content":"<blockquote>\n<p>linux作为个人工作经常使用的系统、做下简单的记录方便以后工作参考。</p>\n</blockquote>\n<h2 id=\"ps\"><a href=\"#ps\" class=\"headerlink\" title=\"ps\"></a><a href=\"http://man.linuxde.net/ps\" target=\"_blank\" rel=\"noopener\">ps</a></h2><blockquote>\n<p>ps命令用于报告系统某个时间内进程的情况</p>\n</blockquote>\n<ul>\n<li>参数</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">-A : 所有的进程均显示出来</span><br><span class=\"line\">-a : 不与terminal有关的所有进程</span><br><span class=\"line\">-u : 有效用户的相关进程</span><br><span class=\"line\">-x : 一般与a参数一起使用，可以列出比较完整的信息。</span><br><span class=\"line\">-l : 较详细地将PID的信息列出。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h3><p>查询某程序的情况</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> [root@VM_115_109_centos ~]<span class=\"comment\"># ps -ef | grep mysqld</span></span></span><br><span class=\"line\">root      8013 17307  0 05:34 pts/0    00:00:00 grep --color=auto mysqld</span><br><span class=\"line\">mysql    28882     1  0 Apr02 ?        00:07:03 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br></pre></td></tr></table></figure>\n\n<p>UID      PID   PPID     C STIME   TTY    TIME     CMD (类目描述)</p>\n<ul>\n<li>UID 程序被该 UID 所拥有</li>\n<li>PID 就是这个程序的 ID </li>\n<li>PPID 则是其上级父程序的ID</li>\n<li>C CPU 使用的资源百分比</li>\n<li>STIME 系统启动时间</li>\n<li>TTY 登入者的终端机位置</li>\n<li>TIME 使用掉的 CPU 时间。</li>\n<li>CMD 所下达的指令</li>\n</ul>\n<p>查看内存占用前1的进程</p>\n<ul>\n<li>ps auxw | head -1;ps auxw|sort -rn -k4|head -1  </li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\">  ps auxw | head -1;ps auxw|sort -rn -k4|head -1</span></span><br><span class=\"line\">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class=\"line\">mysql    28882  0.0 10.9 1143416 205484 ?      Sl   Apr02   7:20 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>内存的单位是kb，VSZ是虚拟内存的占用，RSS是真实的内存的占用。</li>\n</ul>\n<ul>\n<li>命令分解：</li>\n<li>ps auxw显示系统资源占用情况；</li>\n<li>head -1表示显示第一列，即标题列；</li>\n<li>sort -r 表示反向排序，-n表示按数字排序，-k4表示列的第4个字符。</li>\n</ul>\n<p>查看CPU占用前1的进程</p>\n<ul>\n<li>ps auxw|head -1;ps auxw|sort -rn -k3|head -1</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> ps auxw|head -1;ps auxw|sort -rn -k3|head -5</span></span><br><span class=\"line\">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class=\"line\">root      1690  0.1  0.6 536692 12436 ?        Sl   Apr10  29:58 barad_agent</span><br><span class=\"line\">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class=\"line\">root         9  0.0  0.0      0     0 ?        R    Mar08   1:45 [rcu_sched]</span><br><span class=\"line\">root       884  0.0  0.0 110044   808 ttyS0    Ss+  Mar08   0:00 /sbin/agetty --keep-baud 115200 38400 9600 ttyS0 vt220</span><br><span class=\"line\">root       883  0.0  0.0 110044   788 tty1     Ss+  Mar08   0:00 /sbin/agetty --noclear tty1 linux</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h2 id=\"free\"><a href=\"#free\" class=\"headerlink\" title=\"free\"></a><a href=\"http://man.linuxde.net/free\" target=\"_blank\" rel=\"noopener\">free</a></h2><blockquote>\n<p>在系统维护的过程中，随时可能有需要查看 CPU和内存的使用率，并根据相应信息分析系统状况的需求。</p>\n</blockquote>\n<ul>\n<li>参数</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">-b：以Byte为单位显示内存使用情况；</span><br><span class=\"line\">-k：以KB为单位显示内存使用情况；</span><br><span class=\"line\">-m：以MB为单位显示内存使用情况；</span><br><span class=\"line\">-o：不显示缓冲区调节列；</span><br><span class=\"line\">-s&lt;间隔秒数&gt;：持续观察内存使用状况；</span><br><span class=\"line\">-t：显示内存总和列；</span><br><span class=\"line\">-V：显示版本信息。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例-1\"><a href=\"#案例-1\" class=\"headerlink\" title=\"案例\"></a>案例</h3><figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span><span class=\"bash\"> free</span></span><br><span class=\"line\">              total        used        free      shared  buff/cache   available</span><br><span class=\"line\">Mem:       16200512     5593928     4748604        9048     5857980    10196852</span><br><span class=\"line\">Swap:       8191996           0     8191996</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>free命令默认是以kb为单位显示的，可以用free -m 用Mb单位来显示。</li>\n<li>Mem行 ：   total = used  + free    其中buffers和cached虽然计算在used内， 但其实为可用内存。</li>\n<li>Mem下一行：used为真实已占内存，free为真实可用内存。</li>\n<li>Swap：内存交换区的使用情况。</li>\n</ul>\n<h2 id=\"top\"><a href=\"#top\" class=\"headerlink\" title=\"top\"></a><a href=\"http://man.linuxde.net/top\" target=\"_blank\" rel=\"noopener\">top</a></h2><blockquote>\n<p>显示系统整体负载</p>\n</blockquote>\n<ul>\n<li>参数</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">-b：以批处理模式操作；</span><br><span class=\"line\">-c：显示完整的治命令；</span><br><span class=\"line\">-d：屏幕刷新间隔时间；</span><br><span class=\"line\">-I：忽略失效过程；</span><br><span class=\"line\">-s：保密模式；</span><br><span class=\"line\">-S：累积模式；</span><br><span class=\"line\">-i&lt;时间&gt;：设置间隔时间；</span><br><span class=\"line\">-u&lt;用户名&gt;：指定用户名；</span><br><span class=\"line\">-p&lt;进程号&gt;：指定进程；</span><br><span class=\"line\">-n&lt;次数&gt;：循环显示的次数。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例-2\"><a href=\"#案例-2\" class=\"headerlink\" title=\"案例\"></a>案例</h3><p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/linux/1.png\"> </p>\n<ul>\n<li>第一行： 系统时间  + 系统运行时间 + 几个用户 + 1/5/15分钟系统平均负载</li>\n<li>第二行：进程总数(total) + 正在运行进程数(running) + 睡眠进程数(sleeping) + 停止的进程数(stopped)+ 僵尸进程数(zombie)</li>\n<li>第三行：用户空间CPU占比(us) + 内核空间CPU占比(sy)+ CPU空置率(id)</li>\n<li>注解<ul>\n<li>PID ：进程ID</li>\n<li>USER ：用户名</li>\n<li>PR ：优先级</li>\n<li>NI ：负值表示高优先级，正值表示低优先级。</li>\n<li>VIRT ：虚拟内存</li>\n<li>RES ： 真实内存</li>\n<li>SHR ：共享内存</li>\n<li>S ：进程状态 D=不可中断的睡眠状态； R=运行； S=睡眠 ；T=跟踪/停止； Z=僵尸进程</li>\n<li>参数：<ul>\n<li>top -d 2 ：每隔2秒显式所有进程的资源占用情况</li>\n<li>top -c  ：每隔5秒显式进程的资源占用情况，并显示进程的命令行参数(默认只有进程名)</li>\n<li>top -p 12345 -p 6789：每隔5秒显示pid是12345和pid是6789的两个进程的资源占用情况</li>\n<li>top -d 2 -c -p 123456 ：每隔2秒显示pid是12345的进程的资源使用情况，并显式该进程启动的命令行参数</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"env\"><a href=\"#env\" class=\"headerlink\" title=\"env\"></a>env</h2><blockquote>\n<p>查看环境变量；这个用的相对较少了。所以也不用太在意。</p>\n</blockquote>\n<h2 id=\"last\"><a href=\"#last\" class=\"headerlink\" title=\"last\"></a>last</h2><blockquote>\n<p>查看用户登录日志</p>\n</blockquote>\n<ul>\n<li>参数</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">-a : 把从何处登录系统的主机名或Ip地址，显示在最后一行。</span><br><span class=\"line\">-d : 将Ip地址转换成主机名称。</span><br><span class=\"line\">-f  : 指定记录文件</span><br><span class=\"line\">-n : 设置列出名单的显示列数。</span><br><span class=\"line\">-R : 不显示登录系统主机名称或Ip地址。</span><br><span class=\"line\">-x  : 显示系统关机，重新开机，以及执行等级的改变信息。</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"rpm\"><a href=\"#rpm\" class=\"headerlink\" title=\"rpm\"></a>rpm</h2><blockquote>\n<p>一般用rpm -qa | grep xxx 查看所有程序的软件包,如果不做筛选的话会吧所有已经安装的程序列出来。</p>\n</blockquote>\n<ul>\n<li>参数</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">-a：查询所有套件；</span><br><span class=\"line\">-b&lt;完成阶段&gt;&lt;套件档&gt;+或-t &lt;完成阶段&gt;&lt;套件档&gt;+：设置包装套件的完成阶段，并指定套件档的文件名称；</span><br><span class=\"line\">-c：只列出组态配置文件，本参数需配合<span class=\"string\">\"-l\"</span>参数使用；</span><br><span class=\"line\">-d：只列出文本文件，本参数需配合<span class=\"string\">\"-l\"</span>参数使用；</span><br><span class=\"line\">-e&lt;套件档&gt;或--erase&lt;套件档&gt;：删除指定的套件；</span><br><span class=\"line\">-f&lt;文件&gt;+：查询拥有指定文件的套件；</span><br><span class=\"line\">-h或--<span class=\"built_in\">hash</span>：套件安装时列出标记；</span><br><span class=\"line\">-i：显示套件的相关信息；</span><br><span class=\"line\">-i&lt;套件档&gt;或--install&lt;套件档&gt;：安装指定的套件档；</span><br><span class=\"line\">-l：显示套件的文件列表；</span><br><span class=\"line\">-p&lt;套件档&gt;+：查询指定的RPM套件档；</span><br><span class=\"line\">-q：使用询问模式，当遇到任何问题时，rpm指令会先询问用户；</span><br><span class=\"line\">-R：显示套件的关联性信息；</span><br><span class=\"line\">-s：显示文件状态，本参数需配合<span class=\"string\">\"-l\"</span>参数使用；</span><br><span class=\"line\">-U&lt;套件档&gt;或--upgrade&lt;套件档&gt;：升级指定的套件档；</span><br><span class=\"line\">-v：显示指令执行过程；</span><br><span class=\"line\">-vv：详细显示指令执行过程，便于排错。</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"mv\"><a href=\"#mv\" class=\"headerlink\" title=\"mv\"></a>mv</h2><blockquote>\n<p>该命名用于移动文件、目录或更名，move之意，它的常用参数如下：</p>\n</blockquote>\n<ul>\n<li>参数</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">-f  : force强制的意思，如果目标文件已经存在，不会询问而直接覆盖。</span><br><span class=\"line\">-i   : 若目标文件存在，则询问是否覆盖。</span><br><span class=\"line\">-u  : 若目标文件已经存在，且比目标新文件新，才会更新。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例-3\"><a href=\"#案例-3\" class=\"headerlink\" title=\"案例\"></a>案例</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"string\">\"hello world\"</span> &gt;&gt; newfile.txt <span class=\"comment\">#创建一个有内容的文本。</span></span><br><span class=\"line\">$ midir 001  \t\t\t\t\t  <span class=\"comment\">#创建一个文件夹</span></span><br><span class=\"line\">$ ehco <span class=\"string\">\"are you ok\"</span> &gt;&gt; 001/newfile.txt  <span class=\"comment\">#创建一个有内容的文本并放置在001文件夹中。</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>mv -i</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ mv -i  newfile.txt 001/newfile.txt</span><br><span class=\"line\"><span class=\"comment\"># mv : overwite '001/newfile.txt'? </span></span><br><span class=\"line\"><span class=\"comment\"># 填 yes 或者 y都可以。</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>mv -u</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ mv -u newfile.txt 001/newfile.txt</span><br><span class=\"line\"><span class=\"comment\"># mv : overwite '001/newfile.txt'? </span></span><br><span class=\"line\"><span class=\"comment\"># 填 yes 或者 y都可以。</span></span><br></pre></td></tr></table></figure>\n\n<p> 注意如果目标文件创建时间比当前文件新，会移动失败。</p>\n<ul>\n<li>mv -f </li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ mv -f newfile.txt 001/newfile.txt</span><br></pre></td></tr></table></figure>\n\n<p>注意了，这里并不会提示什么，会直接覆盖掉目标文件。前提是你有足够的权限。</p>\n<h2 id=\"rm\"><a href=\"#rm\" class=\"headerlink\" title=\"rm\"></a>rm</h2><ul>\n<li>参数</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">-d：直接把欲删除的目录的硬连接数据删除成0，删除该目录；</span><br><span class=\"line\">-f：强制删除文件或目录；</span><br><span class=\"line\">-i：删除已有文件或目录之前先询问用户；</span><br><span class=\"line\">-r或-R：递归处理，将指定目录下的所有文件与子目录一并处理；</span><br><span class=\"line\">--preserve-root：不对根目录进行递归操作；</span><br><span class=\"line\">-v：显示指令的详细执行过程。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例-4\"><a href=\"#案例-4\" class=\"headerlink\" title=\"案例\"></a>案例</h3><p>删除当前目录下的 log.txt文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ rm log.txt</span><br></pre></td></tr></table></figure>\n\n<p> 删除当前目录下所有.txt后缀的文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ rm *.txt</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>使用 rm 命令删除时，会提示你是否确定删除，输入 y 即删除，输入 n 则取消</p>\n<p>rm: remove regular file `log.txt’? y</p>\n</blockquote>\n<p>删除当前目录下所有以 doubi开头的文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ rm doubi*</span><br></pre></td></tr></table></figure>\n\n<p>删除当前目录下所有以 doubi开头 以.txt后缀结尾的文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ rm doubi*.txt</span><br></pre></td></tr></table></figure>\n\n<p>当你用 rm 删除目录的时候会发现提示这不是一个文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ rm bash</span><br><span class=\"line\">rm: cannot remove `bash<span class=\"string\">': Is a directory</span></span><br></pre></td></tr></table></figure>\n\n<p>可以加上 -r 来归递删除目录及其目录下的内容</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$  rm -r bash</span><br></pre></td></tr></table></figure>\n\n<p> 因为为了避免手误删除错误，所以 rm默认是加上了 -i 的参数，也就是每一次删除文件/目录都会提示，如果觉得烦可以用 -rf 参数</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ rm -rf bash</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>rm -rf 这个命令请慎重使用，而且千万不要使用 rm -rf / 或者 rm -rf /* 之类的命令(系统自杀)，可能会让你系统爆炸，所以使用请慎重</p>\n</blockquote>\n<p>更多的命令可以用 rm –help 查看。</p>\n<h2 id=\"du\"><a href=\"#du\" class=\"headerlink\" title=\"du\"></a>du</h2><blockquote>\n<p>查看 文件/文件夹 占用磁盘空间的大小</p>\n</blockquote>\n<ul>\n<li>参数</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">-h ：以人类易读的方式显示</span><br><span class=\"line\">-a ：显示 目录占用的磁盘空间大小，并显示其下目录和文件占用磁盘空间的大小</span><br><span class=\"line\">-s ：显示 目录占用的磁盘空间大小，但不显示其下子目录和文件占用的磁盘空间大小</span><br><span class=\"line\">-c ：显示几个目录或文件占用的磁盘空间大小，还要统计它们的总和</span><br><span class=\"line\">--apparent-size：显示目录或文件自身的大小</span><br><span class=\"line\">-l ：统计硬链接占用磁盘空间的大小</span><br><span class=\"line\">-L ：统计符号链接所指向的文件占用的磁盘空间大小</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例-5\"><a href=\"#案例-5\" class=\"headerlink\" title=\"案例\"></a>案例</h3><p>显示 /root 文件夹的大小，但不显示其子目录和文件的大小</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ du -sh</span><br><span class=\"line\">190M\t.</span><br></pre></td></tr></table></figure>\n\n<p>显示 /root 文件夹的大小，并显示其子目录和文件的大小</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ du -ah</span><br><span class=\"line\">182M\t./jdk-8u161-linux-x64.tar.gz</span><br><span class=\"line\">8.5M\t./apache-maven-3.5.3-bin.tar.gz</span><br><span class=\"line\">28K\t./mysql57-community-release-el7-11.noarch.rpm</span><br><span class=\"line\">190M\t.</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"chmod\"><a href=\"#chmod\" class=\"headerlink\" title=\"chmod\"></a>chmod</h2><blockquote>\n<p>修改 文件|文件夹权限，linux里面的东西都是文件形式存放的。所以经常会设计到权限问题。</p>\n</blockquote>\n<ul>\n<li>参数</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">-c :只输出被改变权限的文件信息</span><br><span class=\"line\">-f :当chmod不能改变文件模式时，不通知文件的用户</span><br><span class=\"line\">-R :可递归遍历子目录，把修改应到目录下所有文件和子目录</span><br><span class=\"line\">-v :无论修改是否成功，输出每个文件的信息</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 操作符号：</span></span><br><span class=\"line\"> </span><br><span class=\"line\">+ :添加某个权限。</span><br><span class=\"line\">- :取消某个权限。</span><br><span class=\"line\">= :赋予给定权限并取消其他所有权限（如果有的话）。</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 权限设置字母：</span></span><br><span class=\"line\"> </span><br><span class=\"line\">r :可读</span><br><span class=\"line\">w :可写</span><br><span class=\"line\">x :可执行</span><br><span class=\"line\">X :只有目标文件对某些用户是可执行的或该目标文件是目录时才追加x 属性</span><br><span class=\"line\">s :在文件执行时把进程的属主或组ID置为该文件的文件属主。方式“u＋s”设置文件的用户ID位，“g＋s”设置组ID位</span><br><span class=\"line\">t :保存程序的文本到交换设备上</span><br><span class=\"line\">u :当前用户的权限</span><br><span class=\"line\">g :当前用户同组的权限</span><br><span class=\"line\">o :其他用户的权限</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 权限设定数字：</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 数字表示的属性含义：</span></span><br><span class=\"line\">0 ：表示没有权限</span><br><span class=\"line\">1 ：表示可执行权限</span><br><span class=\"line\">2 ：表示可写权限</span><br><span class=\"line\">4 ：表示可读权限</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 然后将其相加，所以数字属性的格式应为3个从0到7的八进制数，其顺序是（u）（g）（o）。</span></span><br><span class=\"line\"><span class=\"comment\"># 如果想让某个文件的属主有“读/写”二种权限，需要把4（可读）+2（可写）＝6（读/写）。</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例-6\"><a href=\"#案例-6\" class=\"headerlink\" title=\"案例\"></a>案例</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 比如要运行sh脚本来启动jar程序，可能就需要修改*.sh的权限</span></span><br><span class=\"line\">chmod +x start.sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 赋予 start.sh 文件可读权限</span></span><br><span class=\"line\">chmod 444 start.sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 赋予 start.sh 可读、可写权限</span></span><br><span class=\"line\">chmod 666 start.sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 赋予 start.sh 可读、可写、可执行权限</span></span><br><span class=\"line\">chmod 777 start.sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 赋予 opt/ 文件夹以及其子目录和文件 可读、可写、可执行权限。</span></span><br><span class=\"line\">chmod -R 777 start.sh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"yum\"><a href=\"#yum\" class=\"headerlink\" title=\"yum\"></a>yum</h2><blockquote>\n<p>这个命令经常使用是Centos 系统中快速安装和下载的工具，当然并不是Centos专属的命令。</p>\n</blockquote>\n<ul>\n<li>参数</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 命令：</span></span><br><span class=\"line\"> </span><br><span class=\"line\">update - 检索 新的包列表</span><br><span class=\"line\">upgrade - 升级 软件包</span><br><span class=\"line\">search - 搜索 软件包</span><br><span class=\"line\">install - 安装 软件包</span><br><span class=\"line\">list - 列出 软件包或者软件包组</span><br><span class=\"line\">info - 显示软件包或者软件包组的详细信息</span><br><span class=\"line\">erase - 删除 软件包（这两个命令一样）</span><br><span class=\"line\">remove - 删除 软件包（这两个命令一样）</span><br><span class=\"line\">groupinfo - 显示 有关包组的详细信息</span><br><span class=\"line\">groupinstall - 安装 软件包组（就像一种软件合集）</span><br><span class=\"line\">grouplist - 列出 可用的软件包组</span><br><span class=\"line\">groupremove - 删除 软件包组</span><br><span class=\"line\">check - 检查 软件包</span><br><span class=\"line\">check-update - 检查 可更新的软件包</span><br><span class=\"line\">clean - 清除 缓存目录内的软件包</span><br><span class=\"line\">deplist - 列出 一个包的依赖关系</span><br><span class=\"line\">distribution-synchronization - 同步 已安装的软件包到最新的版本</span><br><span class=\"line\">downgrad - 降级 一个软件包</span><br><span class=\"line\">reinstall - 重新安装 软件包（自动删除重装）</span><br><span class=\"line\">repolist - 显示 配置的软件包仓库</span><br><span class=\"line\">resolvedep - 确定 软件包需要的依赖关系</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 选项：</span></span><br><span class=\"line\">-t ：容忍错误</span><br><span class=\"line\">-C ：完全从系统缓存运行，不要更新缓存</span><br><span class=\"line\">-R 分钟 ：最大命令等待时间</span><br><span class=\"line\">-q ：安静的操作</span><br><span class=\"line\">-y ：对于所有问题回答是</span><br><span class=\"line\">--nogpgcheck ：禁用gpg签名检查</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例-7\"><a href=\"#案例-7\" class=\"headerlink\" title=\"案例\"></a>案例</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 检索 新的包列表</span></span><br><span class=\"line\">yum update</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 安装 Nginx 软件包</span></span><br><span class=\"line\">yum install nginx</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 安装 Development Tools 软件包组（这个软件包组中包含了编译所需的软件）</span></span><br><span class=\"line\"><span class=\"comment\"># 注意：当软件包或者软件包组的名字中包含空格的时候，请把 软件包或软件包组 加上双引号！</span></span><br><span class=\"line\">yum groupinstall <span class=\"string\">\"Development Tools\"</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 卸载 Nginx 软件包</span></span><br><span class=\"line\">yum erase nginx / yum remove nginx</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 卸载 Development Tools 软件包组</span></span><br><span class=\"line\">yum groupremove <span class=\"string\">\"Development Tools\"</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 升级 所有可更新的软件包</span></span><br><span class=\"line\">yum upgrade</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 升级 Nginx 可更新的软件包</span></span><br><span class=\"line\">yum upgrade nginx</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 在安装软件和卸载的时候，为了避免误操作，都会询问是否继续，每次都要输入 y 来确定会很麻烦，可以加上 -y 参数</span></span><br><span class=\"line\"><span class=\"comment\"># 安装 Nginx 软件包 并不显示确定提示</span></span><br><span class=\"line\">yum install nginx -y</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 卸载 Nginx 软件包 并不显示确定提示</span></span><br><span class=\"line\">yum erase nginx -y / yum remove nginx -y</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 搜索 Nginx 软件包是否存着</span></span><br><span class=\"line\">yum search nginx</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 列出 可用的软件包</span></span><br><span class=\"line\">yum list</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 列出 可用的软件包组</span></span><br><span class=\"line\">yum grouplist</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 清除 缓存目录中的所有软件包</span></span><br><span class=\"line\">yum clean</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 清除 缓存目录中的 Nginx 软件包</span></span><br><span class=\"line\">yum clean nginx</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 重装 Nginx 软件包</span></span><br><span class=\"line\">yum reinstall nginx</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"head\"><a href=\"#head\" class=\"headerlink\" title=\"head\"></a>head</h2><blockquote>\n<p>这个命令主要用于查询文件头部内容，就是正查询。</p>\n</blockquote>\n<ul>\n<li>参数</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">-c 数字：显示指定文件的前 xx 字节的内容（bytes）</span><br><span class=\"line\">-n 数字：显示指定文件的前 xx 行的内容</span><br><span class=\"line\">-q ：不显示包含指定文件名的文件头（当使用 head打开多个文件的时候，会去在每个文件输出结果的顶部添加一个包含文件名的文件头用于区分）</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 更多的命令可以用 head --help 来查看。</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例-8\"><a href=\"#案例-8\" class=\"headerlink\" title=\"案例\"></a>案例</h3><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建一个文件，里面的内容如下</span><br><span class=\"line\">$ touch demo.txt #在编辑内容添加数据</span><br><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看 demo.txt文件的全部内容</span></span><br><span class=\"line\">head log.txt</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 查看 demo.txt文件的前 4字节的内容</span></span><br><span class=\"line\">head -c 4 demo.txt</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 输出示例</span></span><br><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 查看 demo.txt文件的前 3行的内容</span></span><br><span class=\"line\">head -n 3 demo.txt</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 输出示例</span></span><br><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看 demo.txt文件的从倒数第3行到行首的内容</span></span><br><span class=\"line\">head -n -3 demo.txt</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 输出示例</span></span><br><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"tail\"><a href=\"#tail\" class=\"headerlink\" title=\"tail\"></a>tail</h2><blockquote>\n<p>一般用来查看文件尾部内容，比如要持续观察一个log输出的时候。</p>\n</blockquote>\n<ul>\n<li>参数</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">-c 数字：如果数字为正数(例如 -c +5)，显示指定文件从行首第 xx 字节到最后的内容；如果数字为负数(例如 -c -5)，显示指定文件从行尾第 xx 字节到最后内容。</span><br><span class=\"line\">-n 数字：如果数字为正数(例如 -c +3)，显示指定文件从行首第 xx 行到最后的内容；如果数字为负数(例如 -c -3)，显示指定文件从行尾第 xx 行到最后的内容。</span><br><span class=\"line\">-f ：即时输出文件变化后增加的内容，也就是监视一个文件的内容变化（常用于监视日志输出），使用 Ctrl＋C 终止</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"案例-9\"><a href=\"#案例-9\" class=\"headerlink\" title=\"案例\"></a>案例</h3><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 创建一个文件，里面的内容如下</span><br><span class=\"line\">$ touch demo.txt #在编辑内容添加数据</span><br><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看 demo.txt文件的全部内容</span></span><br><span class=\"line\">tail demo.txt</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 查看 demo.txt文件从行首 第6字节到最后的内容</span></span><br><span class=\"line\">tail -c +25 demo.txt</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 输出示例</span></span><br><span class=\"line\"></span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 查看 demo.txt文件从行尾 第2字节到最前面的内容</span></span><br><span class=\"line\">tail -c -2 demo.txt</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 输出示例</span></span><br><span class=\"line\">5</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 查看 demo.txt文件的从第2行到最后一行的内容</span></span><br><span class=\"line\">tail -n +2 log.txt</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 输出示例</span></span><br><span class=\"line\">doubi2</span><br><span class=\"line\">doubi3</span><br><span class=\"line\">doubi4</span><br><span class=\"line\">doubi5</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 查看 demo.txt文件的后 2行的内容</span></span><br><span class=\"line\">tail -n -2 demo.txt</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 输出示例</span></span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"comment\"># 持续查看（监视） log.txt文件的变化内容（新增加的内容），使用 Ctrl＋C 终止</span></span><br><span class=\"line\">tail -f demo.txt</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"tar-gz-zip\"><a href=\"#tar-gz-zip\" class=\"headerlink\" title=\"tar gz zip\"></a>tar gz zip</h2><blockquote>\n<p>这几个是用来解压文件的，在源码安装或者是解压的时候需要用到。</p>\n</blockquote>\n<h3 id=\"案例-10\"><a href=\"#案例-10\" class=\"headerlink\" title=\"案例\"></a>案例</h3><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 解压后缀为 .tar 的压缩包</span></span><br><span class=\"line\">tar -xf log.tar</span><br><span class=\"line\">————————————————————————————————————————————————————————————————————————————</span><br><span class=\"line\"><span class=\"comment\"># 解压后缀为 .tar.xz 的压缩包</span></span><br><span class=\"line\">tar -xJf log.tar.xz</span><br><span class=\"line\">————————————————————————————————————————————————————————————————————————————</span><br><span class=\"line\"><span class=\"comment\"># 解压后缀为 .tar.gz 的压缩包，有两个方法</span></span><br><span class=\"line\">tar -xzf log.tar.gz</span><br><span class=\"line\">————————————————————————————————————————————————————————————————————————————</span><br><span class=\"line\"><span class=\"comment\"># 解压后缀为 .gz 的压缩包，有两个方法，如提示命令不存在，请安装 yum install gzip -y / apt-get install gzip -y</span></span><br><span class=\"line\">gzip -d log.gz</span><br><span class=\"line\">gunzip log.gz</span><br><span class=\"line\">————————————————————————————————————————————————————————————————————————————</span><br><span class=\"line\"><span class=\"comment\"># 解压后缀为 .bz / .bz2 / tar.bz2 的压缩包，有两个方法</span></span><br><span class=\"line\">bzip2 -d log.bz</span><br><span class=\"line\">bunzip2 log.bz</span><br><span class=\"line\">tar -jxf log.tar.bz</span><br><span class=\"line\"> </span><br><span class=\"line\">bzip2 -d log.bz2</span><br><span class=\"line\">bunzip2 log.bz2</span><br><span class=\"line\">tar -jxf log.tar.bz2</span><br><span class=\"line\">————————————————————————————————————————————————————————————————————————————</span><br><span class=\"line\"><span class=\"comment\"># 解压后缀为 .Z / tar.Z 的压缩包，有两个方法</span></span><br><span class=\"line\">uncompress log.Z log.txt</span><br><span class=\"line\">uncompress log.Z <span class=\"built_in\">log</span></span><br><span class=\"line\">————————————————————————————————————————————————————————————————————————————</span><br><span class=\"line\">tar xZf log.tar.Z log.txt</span><br><span class=\"line\">tar xZf log.tar.Z <span class=\"built_in\">log</span></span><br><span class=\"line\">————————————————————————————————————————————————————————————————————————————</span><br><span class=\"line\"><span class=\"comment\"># 解压后缀为 .rar 的压缩包，如提示命令不存在，请安装 yum install unrar -y / apt-get install unrar -y ，注意 rar 和 unrar 是分开的</span></span><br><span class=\"line\">unrar x log.rar</span><br><span class=\"line\">————————————————————————————————————————————————————————————————————————————</span><br><span class=\"line\"><span class=\"comment\"># 解压后缀为 .zip 的压缩包，如提示命令不存在，请安装 yum install unzip -y / apt-get install unzip -y，注意 zip 和 unzip 是分开的</span></span><br><span class=\"line\">unzip log.zip</span><br></pre></td></tr></table></figure>\n\n","categories":["Dev"],"tags":["Linux","Dev"]},{"title":"2014-10-10-十堰实习的日子","url":"/posts/543698596/","content":"<blockquote>\n<p>2014-10-10出发实习，职场萌新第一次去大型野外工地浪。长期在小城市里面突然跑到野外，关键还没啥人。放飞自我。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/NWP_121016_0001-min.jpg\"></p>\n<a id=\"more\"></a>\n\n<p>这玩意是测量仪器差不多十万吧，每天带着满山跑。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/NWP_121016_0005-min.jpg\"></p>\n<p>第一次接触大型机械，在离地面二十多米高的梁板上面。吓尿~，架桥机，听说要2000W，一天租金8000。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000165-min.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000174-min.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000175-min.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000176-min.jpg\"></p>\n<p>测量小队的专车，我们小队就4个人。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000192-min.jpg\"></p>\n<p>站远点，炸山了。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000195-min.jpg\"></p>\n<p>项目部的汪汪，对我长期不友好。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000251-min.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000339-min.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000340-min.jpg\"></p>\n<p>护坡</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000341-min.jpg\"></p>\n<p>公司的高速养护基地</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000344-min.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000345-min.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000374-min.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000381-min.jpg\"></p>\n<p>一开始不理解为什么生锈了还可以用，后来知道施工的时候会二次处理。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000400-min.jpg\"></p>\n<p>抽样检查</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E5%8D%81%E5%A0%B0%E5%AE%9E%E4%B9%A0%E7%9A%84%E6%97%A5%E5%AD%90/WP_000429-min.jpg\"></p>\n","categories":["随记"],"tags":["随记"]},{"title":"Eureka-Zookeeper","url":"/posts/596045077/","content":"<blockquote>\n<p>服务注册中心，给客户端提供可供调用的服务列表，客户端在进行远程服务调用时，根据服务列表然后选择服务提供方的服务地址进行服务调用。服务注册中心在分布式系统中大量应用，是分布式系统中不可或缺的组件，例如rocketmq的name server，hdfs中的namenode，dubbo中的zk注册中心，spring cloud中的服务注册中心eureka。  在spring cloud中，除了可以使用eureka作为注册中心外，还可以通过配置的方式使用zookeeper作为注册中心。既然这样，我们该如何选择注册中心的实现呢？</p>\n</blockquote>\n<h3 id=\"CAP定理\"><a href=\"#CAP定理\" class=\"headerlink\" title=\"CAP定理\"></a>CAP定理</h3><blockquote>\n<p>又被称作布鲁尔定理（Eric Brewer）它指出对于一个分布式计算系统来说，不可能同时满足以下三点：</p>\n</blockquote>\n<ol>\n<li>强一致性（Consistency）：系统在执行某项操作后数据状态仍然处于一致，例如在分布式系统中，更新操作执行成功后所有的用户都应该读取到最新的值，这样的系统被认为具有强一致性。</li>\n<li>可用性（Availability）：每一个操作总是能够在一定的时间内返回结果</li>\n<li>分区容错性（Partition tolerance）：单个节点故障不应导致整个系统崩溃，也就是说尽管网络在节点之间丢弃（或延迟）任意数量的消息，但是系统继续操作。</li>\n</ol>\n<blockquote>\n<p>根据CAP原理将数据库分成了满足CA原则、满足CP原则和满足AP原则三大类</p>\n</blockquote>\n<ol>\n<li>CA：单点集群，满足一致性，可用性，通常在可扩展性上不太强大，比如RDB。</li>\n<li>CP：满足一致性和分区容错性，通常性能不是特别高，如分布式数据库。</li>\n<li>AP：满足可用性和分区容错性，通常可能对一致性要求低一些，如大多数的NoSQL。</li>\n</ol>\n<h3 id=\"BASE（Basically-Available，Soft-state，Eventual-consistency）\"><a href=\"#BASE（Basically-Available，Soft-state，Eventual-consistency）\" class=\"headerlink\" title=\"BASE（Basically Available，Soft-state，Eventual consistency）\"></a>BASE（Basically Available，Soft-state，Eventual consistency）</h3><blockquote>\n<p>eBay的架构师Dan Pritchett源于对大规模分布式系统的实践总结，在ACM上发表文章提出BASE理论，BASE理论是对CAP理论的延伸，核心思想是即使无法做到强一致性（Strong Consistency，CAP的一致性就是强一致性），但应用可以采用适合的方式达到最终一致性（Eventual Consitency）。</p>\n</blockquote>\n<ol>\n<li>基本可用（Basically Available）：系统能够基本运行并一直提供服务。</li>\n<li>软状态（Soft-state）：系统不要求一直保持强一致状态。</li>\n<li>最终一致性（Eventual consistency）：系统需要在某一时刻后达到一致性要求。</li>\n</ol>\n<h3 id=\"Zookeeper保证CP\"><a href=\"#Zookeeper保证CP\" class=\"headerlink\" title=\"Zookeeper保证CP\"></a><strong>Zookeeper保证CP</strong></h3><ul>\n<li>当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的注册信息，但不能接受服务直接down掉不可用。也就是说，服务注册功能对可用性的要求要高于一致性。但是zk会出现这样一种情况，当master节点因为网络故障与其他节点失去联系时，剩余节点会重新进行leader选举。问题在于，选举leader的时间太长，30 ~ 120s, 且选举期间整个zk集群都是不可用的，这就导致在选举期间注册服务瘫痪。在云部署的环境下，因网络问题使得zk集群失去master节点是较大概率会发生的事，虽然服务能够最终恢复，但是漫长的选举时间导致的注册长期不可用是不能容忍的。</li>\n</ul>\n<h3 id=\"Eureka保证AP\"><a href=\"#Eureka保证AP\" class=\"headerlink\" title=\"Eureka保证AP\"></a>Eureka保证AP</h3><ul>\n<li><p>Eureka各个节点都是平等的，几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。而Eureka的客户端在向某个Eureka注册或如果发现连接失败，则会自动切换至其它节点，只要有一台Eureka还在，就能保证注册服务可用(保证可用性)，只不过查到的信息可能不是最新的(不保证强一致性)。除此之外，Eureka还有一种自我保护机制，如果在15分钟内超过85%的节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现了网络故障，此时会出现以下几种情况： </p>\n<ol>\n<li>Eureka不再从注册列表中移除因为长时间没收到心跳而应该过期的服务 </li>\n<li>Eureka仍然能够接受新服务的注册和查询请求，但是不会被同步到其它节点上(即保证当前节点依然可用) </li>\n<li>当网络稳定时，当前实例新的注册信息会被同步到其它节点中</li>\n</ol>\n</li>\n<li><p>因此， Eureka可以很好的应对因网络故障导致部分节点失去联系的情况，而不会像zookeeper那样使整个注册服务瘫痪。</p>\n</li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"Eureka注册发现流程\"><a href=\"#Eureka注册发现流程\" class=\"headerlink\" title=\"Eureka注册发现流程\"></a>Eureka注册发现流程</h3><ol>\n<li>启动Eureka Server。</li>\n<li>Eureka Client服务提供者启动时候将服务注册到Eureka Server。</li>\n<li>Eureka Client服务提供者每30秒（默认配置）向Eureka Server发送http请求（心跳）服务续约。</li>\n<li>Eureka Server 90秒没有收到某Eureka Client的心跳请求，则统计15分钟是否存在85%的Eureka Client没有心跳，如果是则自我保护，如果不是则剔除该服务实例。</li>\n<li>Eureka Client通过定时任务向Eureka Server获取服务列表更新本地的列表缓存。</li>\n<li>Eureka Client远程调用的时候，先从本地查找，如果发现服务则发起请求，如果没有找到则向Eureka Server获取服务列表并更新换地缓存列表。</li>\n<li>Eureka Client应用关闭的时候会向Eureka Server发送关闭请求，Eureka Server受理后会剔除该服务实例。</li>\n</ol>\n<h3 id=\"Eureka集群高可用\"><a href=\"#Eureka集群高可用\" class=\"headerlink\" title=\"Eureka集群高可用\"></a>Eureka集群高可用</h3><ul>\n<li>Eureka Server集群当中每个节点都是用过 <code>Replicate</code>复制来同步数据。没有主从之分，节点的数据都保持最终一致。假设其中一个节点宕机了，并不影响Eureka Client的工作。</li>\n</ul>\n<h3 id=\"Zookeeper注册发现流程\"><a href=\"#Zookeeper注册发现流程\" class=\"headerlink\" title=\"Zookeeper注册发现流程\"></a>Zookeeper注册发现流程</h3><ol>\n<li>启动Zookeeper。</li>\n<li>服务提供者启动的时候注册到Zk注册中心。</li>\n<li>Zk注册中心和服务提供者建立一个Socket长连接，ZK注册中心定时向每个服务提供发送数据，如果服务提供没响应，则剔除该服务实例。将更新后的服务列表发送给所有的消费者（长连接）。</li>\n<li>服务消费者启动从ZK中获取一份服务列表并缓存到本地。</li>\n<li>服务消费者调用原创服务的时候先从本地缓存查找，如果找到则直接发起服务调用。如果没有找到则到ZK注册中心获取列表缓存到本地在调用。</li>\n<li>当一个服务提供者宕机或者正常关闭的时候，ZK会剔除该节点，并通知所有消费者服务更新本地缓存。</li>\n</ol>\n","categories":["Dev"],"tags":["微服务","Zookeeper","Java","Eureka","注册中心"]},{"title":"Centos7-Mysql-Deploy","url":"/posts/4159264015/","content":"<blockquote>\n<p>Centos7的yum源中默认是没有mysql,因为现在已经用mariaDB代替mysql了。</p>\n</blockquote>\n<h2 id=\"安装前检查\"><a href=\"#安装前检查\" class=\"headerlink\" title=\"安装前检查\"></a>安装前检查</h2><h3 id=\"检查linux系统版本\"><a href=\"#检查linux系统版本\" class=\"headerlink\" title=\"检查linux系统版本\"></a>检查linux系统版本</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost backup]<span class=\"comment\"># cat /etc/system-release</span></span><br><span class=\"line\">CentOS Linux release 7.4.1708 (Core)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"检查是否已经安装mysql\"><a href=\"#检查是否已经安装mysql\" class=\"headerlink\" title=\"检查是否已经安装mysql\"></a>检查是否已经安装mysql</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost backup]<span class=\"comment\"># rpm -qa | grep mysql</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>如果存在Mysql可以考虑卸载</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">rpm -e --nodeps mysql-connector-odbc-x.x.x-x.el7.x86_64</span><br></pre></td></tr></table></figure>\n\n<p>将/var/lib/mysql文件夹下的所有文件都删除干净。</p>\n</li>\n</ul>\n<h3 id=\"检查是否安装mariaDB\"><a href=\"#检查是否安装mariaDB\" class=\"headerlink\" title=\"检查是否安装mariaDB\"></a>检查是否安装mariaDB</h3><a id=\"more\"></a>s\n\n<blockquote>\n<p>如果是最小安装是没有的，如果不是默认会安装这个数据库。</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost backup]<span class=\"comment\"># rpm -qa | grep mariadb</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>如果已经安装就卸载干净</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">systemctl stop mariadb</span><br><span class=\"line\">　　　　　　　　rpm -qa | grep mariadb</span><br><span class=\"line\">　　　　　　　　rpm -e --nodeps mariadb-x.x.x-1.el7.x86_64</span><br><span class=\"line\">　　　　　　　　rpm -e --nodeps mariadb-server-x.x.x-1.el7.x86_64</span><br><span class=\"line\">　　　　　　　　rpm -e --nodeps mariadb-libs-x.x.x-1.el7.x86_64</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"下载5-7源\"><a href=\"#下载5-7源\" class=\"headerlink\" title=\"下载5.7源\"></a>下载5.7源</h2><ul>\n<li><a href=\"https://dev.mysql.com/downloads/repo/yum/\" target=\"_blank\" rel=\"noopener\">下载页面</a></li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">//下载mysql rpm包</span><br><span class=\"line\"><span class=\"comment\"># wget http://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm</span></span><br><span class=\"line\"> </span><br><span class=\"line\">//安装mysql rpm包</span><br><span class=\"line\"><span class=\"comment\"># rpm -ivh mysql57-community-release-el7-11.noarch.rpm</span></span><br><span class=\"line\"> </span><br><span class=\"line\">//安装mysql</span><br><span class=\"line\"><span class=\"comment\"># yum install mysql-community-server</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"检查一下是否安装成功\"><a href=\"#检查一下是否安装成功\" class=\"headerlink\" title=\"检查一下是否安装成功\"></a>检查一下是否安装成功</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost backup]<span class=\"comment\"># systemctl status mysqld</span></span><br><span class=\"line\">● mysqld.service - MySQL Server</span><br><span class=\"line\">   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)</span><br><span class=\"line\">   Active: inactive (dead)</span><br><span class=\"line\">     Docs: man:mysqld(8)</span><br><span class=\"line\">           http://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class=\"line\">[root@localhost backup]<span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>成功但是没有启动</li>\n</ul>\n<h3 id=\"修改配置默认配置文件-my-cnf\"><a href=\"#修改配置默认配置文件-my-cnf\" class=\"headerlink\" title=\"修改配置默认配置文件[my.cnf]\"></a>修改配置默认配置文件[my.cnf]</h3><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[mysql]  </span><br><span class=\"line\"># 设置mysql客户端默认字符集  </span><br><span class=\"line\">default-character-set&#x3D;utf8   </span><br><span class=\"line\">socket&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock  </span><br><span class=\"line\">[mysqld]  </span><br><span class=\"line\">#skip-name-resolve  </span><br><span class=\"line\">#设置3306端口  </span><br><span class=\"line\">port &#x3D; 3306   </span><br><span class=\"line\">socket&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock  </span><br><span class=\"line\"># 设置mysql的安装目录 </span><br><span class=\"line\">basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql  </span><br><span class=\"line\"># 设置mysql数据库的数据的存放目录  </span><br><span class=\"line\">datadir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data  </span><br><span class=\"line\"># 允许最大连接数  </span><br><span class=\"line\">max_connections&#x3D;200  </span><br><span class=\"line\"># 服务端使用的字符集默认为8比特编码的latin1字符集  </span><br><span class=\"line\">character-set-server&#x3D;utf8  </span><br><span class=\"line\"># 创建新表时将使用的默认存储引擎  </span><br><span class=\"line\">default-storage-engine&#x3D;INNODB  </span><br><span class=\"line\">#lower_case_table_name&#x3D;1  </span><br><span class=\"line\">max_allowed_packet&#x3D;16M</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装成功后需要重启mysql服务。\"><a href=\"#安装成功后需要重启mysql服务。\" class=\"headerlink\" title=\"安装成功后需要重启mysql服务。\"></a>安装成功后需要重启mysql服务。</h3><figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">service mysqld restart</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>刚开始安装的Mysql5.7是会随机生成一个root密码的，我们要先找到这个随机密码，然后改新密码。我们可以通过grep命令查找随机root密码。在mysql.log文件中可以找到密码。</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">grep <span class=\"string\">\"password\"</span> /var/<span class=\"built_in\">log</span>/mysqld.log</span><br><span class=\"line\">... password is generated <span class=\"keyword\">for</span> root@localhost: 8A3xwbk8_P1A</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"登录Mysql\"><a href=\"#登录Mysql\" class=\"headerlink\" title=\"登录Mysql\"></a>登录Mysql</h3><blockquote>\n<p>8A3xwbk8_P1A 这个密码第一次登录之后必须修改。</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql -uroot -p //登录</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"修复默认密码\"><a href=\"#修复默认密码\" class=\"headerlink\" title=\"修复默认密码\"></a>修复默认密码</h3><ul>\n<li>默认情况下mysql第一次登录的时候需要修改密码，不然会抛出异常。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>如果只是修改简单的密码又会报错。</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt;  ALTER USER USER() IDENTIFIED BY &#39;12345678&#39;;</span><br><span class=\"line\">ERROR 1819 (HY000): Your password does not satisfy the current policy requirements</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>这个其实与validate_password_policy的值有关。</li>\n<li>validate_password_policy有以下取值：</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Policy</th>\n<th>Tests Performed</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>0</code> or <code>LOW</code></td>\n<td>Length</td>\n</tr>\n<tr>\n<td><code>1</code> or <code>MEDIUM</code></td>\n<td>Length; numeric, lowercase/uppercase, and special characters</td>\n</tr>\n<tr>\n<td><code>2</code> or <code>STRONG</code></td>\n<td>Length; numeric, lowercase/uppercase, and special characters; dictionary file</td>\n</tr>\n</tbody></table>\n<ul>\n<li>默认是1，即MEDIUM，所以刚开始设置的密码必须符合长度，且必须含有数字，小写或大写字母，特殊字符。</li>\n<li>有时候，只是为了自己测试，不想密码设置得那么复杂，譬如说，我只想设置root的密码为123456。</li>\n<li>必须修改两个全局参数：</li>\n<li>首先，修改validate_password_policy参数的值</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; set global validate_password_policy&#x3D;0;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>刷新权限</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>推出再次登录</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">exit;</span><br><span class=\"line\">mysql -uroot -p &#x2F;&#x2F;登录，用修改的密码。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"开启远程访问\"><a href=\"#开启远程访问\" class=\"headerlink\" title=\"开启远程访问\"></a>开启远程访问</h3><blockquote>\n<p>正式环境不要把root权限开发出去了，当然这里只是测试。</p>\n</blockquote>\n<ul>\n<li>查看用户信息</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; select host,user,plugin,authentication_string from mysql.user;</span><br><span class=\"line\">+-----------+-----------+-----------------------+-------------------------------------------+</span><br><span class=\"line\">| host      | user      | plugin                | authentication_string                     |</span><br><span class=\"line\">+-----------+-----------+-----------------------+-------------------------------------------+</span><br><span class=\"line\">| localhost | root      | mysql_native_password | *84AAC12F54AB666ECFC2A83C676908C8BBC381B1 |</span><br><span class=\"line\">| localhost | mysql.sys | mysql_native_password | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |</span><br><span class=\"line\">| %         | root      | mysql_native_password | *6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 |</span><br><span class=\"line\">+-----------+-----------+-----------------------+-------------------------------------------+</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改加密方式</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ALTER USER <span class=\"string\">'root'</span>@<span class=\"string\">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class=\"string\">'123456'</span>;  <span class=\"comment\">### 123456 mysql的登录密码</span></span><br><span class=\"line\">flush privileges;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>重启服务</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">service mysqld restart</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>检查下防火墙是不是开了，然后远程登录试试。</p>\n</blockquote>\n<h2 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h2><blockquote>\n<p>关于密码校验插件validate_password，这个是mysql5.7默认安装的。</p>\n</blockquote>\n<p>检查validate_password插件是否安装。</p>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql&gt; SHOW VARIABLES LIKE 'validate_password%';</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">+--------------------------------------+--------+</span><br><span class=\"line\">| Variable_name                        | Value  |</span><br><span class=\"line\">+--------------------------------------+--------+</span><br><span class=\"line\">| validate_password_check_user_name    | OFF    |</span><br><span class=\"line\">| validate_password_dictionary_file    |        |</span><br><span class=\"line\">| validate_password_length             | 8      |</span><br><span class=\"line\">| validate_password_mixed_case_count   | 1      |</span><br><span class=\"line\">| validate_password_number_count       | 1      |</span><br><span class=\"line\">| validate_password_policy             | MEDIUM |</span><br><span class=\"line\">| validate_password_special_char_count | 1      |</span><br><span class=\"line\">+--------------------------------------+--------+</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>5.6之后的版本开启log日志参数名修改。</p>\n</blockquote>\n<ul>\n<li>编辑my.cnf (不同的操作系统位置该文件路径不同，名字可能也不一样。)</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">[ERROR] /usr/sbin/mysqld: ambiguous option '--log=/opt/log/mysql/mysql.log' (log-bin, log_slave_updates)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>目前log参数弃用，改用</li>\n</ul>\n<ul>\n<li>explicit_defaults_for_timestamp</li>\n<li>general-log=ON  </li>\n<li>general-log_file=/var/log/mysql/general.log</li>\n<li>slow_query_log=ON</li>\n<li>slow_query_log_file=/var/log/mysql/general_slow.log</li>\n<li>long_query_time=ON</li>\n<li>log_queries_not_using_indexes =1</li>\n</ul>\n","categories":["Dev"],"tags":["Mysql","Centos7","Linux"]},{"title":"Git-Branch","url":"/posts/3837017068/","content":"<blockquote>\n<p>​    使用git进行合并分支说难也不难，因为就使用一下那几个命令而已！但是不小心操作总会有一些难以预料的问题出现、但是coder们总是会做出奇怪的举动。</p>\n<p>​    合并分支的时候O(∩_∩)O</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/git/hbfz.gif\" alt=\"合并分支\">   </p>\n<h2 id=\"快速了解下分支流程。\"><a href=\"#快速了解下分支流程。\" class=\"headerlink\" title=\"快速了解下分支流程。\"></a>快速了解下分支流程。</h2><a id=\"more\"></a>\n\n<blockquote>\n<p>​    分支类似科幻电影里面经常出现的平行宇宙，只是分支之间还能合并。    </p>\n<p>​    git默认的是master分支，如果所有的开发都在master分支，这其实非常操蛋。这么吊的工具怎么可能没有好的分支策略。</p>\n</blockquote>\n<ul>\n<li><p>正常分支</p>\n<ul>\n<li><strong>origin/master：主分支</strong></li>\n<li><strong>origin/develop：开发分支</strong>  <blockquote>\n<p>em 首先代码库默认有一个，且只有一个主分支Master，这个分支是仓库初始化的时候默认创建的。但实际上还有另一主分支  develop（开发主分支）、只是很多开发并不会启用develop分支。当develop分支上代码达到一定稳定的时候，所有的改动就会被合并到master中。并用一个发行版来标记它。所以每当被合并到master中就意味着一次release版本发布。这个时候才会使用(hook script)钩子去自动构建我们的项目、并部署正式服务器。</p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li><p>临时分支</p>\n<ul>\n<li>feature：功能分支（特征分支）</li>\n<li>release：预发布分支（发行分支）</li>\n<li>fixbug：修补bug分支（热补丁分支）  <blockquote>\n<p>为什么会有临时分支这种东西，上面说到主分支是用来管理重大版本发布的。日常的开发应该是在另外一条分支上进行develop，而临时分支是在develop分离出来做迭代以及bug修复的。达到阶段目标在合并到develop分支当中。</p>\n</blockquote>\n</li>\n</ul>\n</li>\n</ul>\n<hr>\n<p><code>这张图很久以前看到的，源地址忘记了，若发现侵权请联系本人删除。</code></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/git/fz.png\">   </p>\n<ul>\n<li>Git创建Develop分支的命令：</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git checkout -b develop master</span><br></pre></td></tr></table></figure>\n\n<p>将Develop分支发布到Master分支的命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 切换到Master分支</span></span><br><span class=\"line\">git checkout master</span><br><span class=\"line\"><span class=\"comment\"># 对Develop分支进行合并</span></span><br><span class=\"line\">git merge develop</span><br></pre></td></tr></table></figure>\n\n<p><code>基本上只有会是develop分支合并到master中。由于master是必须使用的就不在多介绍，下面说下其它分支。</code></p>\n<p><strong>Feature</strong> </p>\n<blockquote>\n<p>​    这个分支一般来说是不会存在原始仓库的。而是存在开发人员的仓库中。</p>\n</blockquote>\n<ul>\n<li>当开始开发一个新功能时，从 <strong>develop</strong> 分支分离出来。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 从 develop中分离出一个分支</span></span><br><span class=\"line\">git checkout -b myfeature develop</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>合并一条已经完成的 Feature 分支到 develop 分支</li>\n</ul>\n<blockquote>\n<p> 完成了的功能需要合并到 <strong>develop</strong> 分支，以确切把其添加到下一个要发行的版本中。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 切换到develop分支中</span></span><br><span class=\"line\">git checkout develop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 对myfeature分支进行合并</span></span><br><span class=\"line\">git merge myfeature</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除myfeature分支 合并完一定要删除。</span></span><br><span class=\"line\">git branch -d myfeature</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 推送至develop分支。</span></span><br><span class=\"line\">git push origin develop</span><br></pre></td></tr></table></figure>\n\n<p><strong>Release</strong> </p>\n<blockquote>\n<p>​    不要认为这是从master中分出来，这实际上是从develop分支中发布的。当我们需要迭代一个稳定版本的时候我们就会从develop中分离一个分支名字用于展示指定的新版本号。</p>\n</blockquote>\n<ul>\n<li>创建一条 Release 分支</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 从develop中分离出release-1.2</span></span><br><span class=\"line\">git checkout -b release-1.0 develop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 推送到本地仓库中。</span></span><br><span class=\"line\">git commit -a -m <span class=\"string\">\"create version number to 1.0\"</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>release 可能会存在一段时间、等待bug修复。不要在这个分支在加大功能，这非常扯蛋。当确定没问题之后合并到master中。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/git/bjgn.gif\">  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 切换到master主分支</span></span><br><span class=\"line\">git checkout master</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 合并分支</span></span><br><span class=\"line\">git merge release-1.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 打标签。</span></span><br><span class=\"line\">git tag -a 1.2</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意不光要合并到master、develop分支也要合并。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 切换到develop主分支</span></span><br><span class=\"line\">git checkout develop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 合并分支</span></span><br><span class=\"line\">git merge release-1.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 合并完 master 、develop分支可以删除release了。</span></span><br><span class=\"line\">git branch -d release-1.0</span><br></pre></td></tr></table></figure>\n\n<p><strong>Hotfix</strong> </p>\n<blockquote>\n<p>​    这个分支就是来修复bug的。其实和release分支很相似，只不过生命周期更短，可能需要合并多次。</p>\n<p>从master分离出来之后合并时候需要合并两次。 </p>\n</blockquote>\n<ul>\n<li>创建一条 Hotfix 分支</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 从master中分离出hotfix-1.0.1</span></span><br><span class=\"line\">git checkou -b hotfix-1.0.1 master</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  推送到本地仓库</span></span><br><span class=\"line\">git commit -a -m <span class=\"string\">\"create hotfix-1.0.1\"</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>​    改玩bug了就可以合并到master 、 develop中了。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 切换到master</span></span><br><span class=\"line\">git checkout master</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将hotfix合并到master中。</span></span><br><span class=\"line\">git merge hotfix-1.0.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 打标签</span></span><br><span class=\"line\">git tag -a 1.3</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>​    在把改动的代码合并到develop中。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 切换到develop</span></span><br><span class=\"line\">git checkout develop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 将hotfix合并到develop中。</span></span><br><span class=\"line\">git merge  hotfix-1.0.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除hotfix。</span></span><br><span class=\"line\">git branch -d hotfix-1.0.1</span><br></pre></td></tr></table></figure>\n\n<p>合并分支操作并没有那么简单，分支流程大致是这样的。</p>\n<h2 id=\"规范代码开发流程\"><a href=\"#规范代码开发流程\" class=\"headerlink\" title=\"规范代码开发流程\"></a>规范代码开发流程</h2><blockquote>\n<p>git 分支分为集成分支、功能分支和修复分支，分别命名为 develop、feature 和 hotfix，均为单数。不可使用 features、future、hotfixes、hotfixs 等错误名称。</p>\n</blockquote>\n<p>1.git主分支(master)。它是自动建立，用于发布重大版本更新（github 现在默认是是main 因种族歧视问题）<br>2.git开发主分支(develop)。日常开发在此分支上进行<br>3.git临时性分支：用于应对一些特定目的的版本开发(验证OK后，应该删除此分支)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">- 功能（feature）分支：它是为了开发某种特定功能，从Develop分支上面分出来的。开发完成后，要再并入Develop。可以采用feature-的形式命名。</span><br><span class=\"line\">- 预发布（release）分支：指发布正式版本之前（即合并到Master分支之前），我们可能需要有一个预发布的版本进行测试。预发布分支是从Develop分支上面分出来的，预发布结束以后，</span><br><span class=\"line\">必须合并进Develop和Master分支。它的命名，可以采用release-的形式。</span><br><span class=\"line\">- 修补bug（hotfix）分支：软件正式发布以后，难免会出现bug。这时就需要创建一个分支，进行bug修补。修补bug分支是从Master或Develop分支上面分出来的。修补结束以后，</span><br><span class=\"line\">再合并进Master和Develop分支。它的命名，可以采用hotfix-***的形式。</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"开发流程\"><a href=\"#开发流程\" class=\"headerlink\" title=\"开发流程\"></a>开发流程</h2><blockquote>\n<p>暂定临时分支feature、hotfix两种启用。暂不启用RP、code review。</p>\n</blockquote>\n<p>1.基于develop生成新临时开发分支。<br>2.测试、正式环境上线通过。<br>3.合并至develop分支，并生成对应的tag版本。<br>4.完成特定功能开发后(验证OK后，应该删除此分支)。<br>5.README.md文档中记录tag版本生成时间以及具体的功能名称。</p>\n<p>修复bug流程</p>\n<blockquote>\n<p>根据最新已经上线的分支代码创建hotfix分支。</p>\n</blockquote>\n<p>1.基于develop或者上个tag版本(根据实际情况而定)生成新临时开发分支。<br>2.测试、正式环境上线通过。<br>3.合并至develop分支，并生成对应的tag版本。<br>4.<code>若存在临时开发分支</code>-完成特定功能开发后(验证OK后，应该删除此分支)。<br>5.<code>若存在临时开发分支</code>-临时开发分支合并已经修复bug的develop代码。<br>6.<code>若存在临时开发分支</code>-临时开发分支完成特定功能开发后(验证OK后，应该删除此分支)。<br>7.README.md文档中记录tag版本生成时间以及具体的功能名称。</p>\n<h2 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h2><blockquote>\n<p>开发需求</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">git checkout develop // 切换开发分支，git pull origin develop 并同步最新的develop分支代码。（强制）</span><br><span class=\"line\">git checkout -b feature-sizeGroup //基于develop分支创建新的开发分支（强制）</span><br><span class=\"line\">git checkout develop // feature-sizeGroup完成上线后develop分支准备合并分支（强制）</span><br><span class=\"line\">git merge feature-sizeGroup // 合并开发功能分支（强制）</span><br><span class=\"line\">git tag -a v1.4 -m <span class=\"string\">\"my version 1.4\"</span> // 合并完成创建标签备注中简单说明开发功能（强制）</span><br><span class=\"line\">git push origin v1.4 // 推送tag标签到远程仓库（强制）</span><br><span class=\"line\">git branch -d feature-sizeGroup //删除本地的临时开发分支(非强制)</span><br><span class=\"line\">git push origin --delete feature-sizeGroup // 删除远程的临时开发分支（强制）</span><br><span class=\"line\">vim README.md // 保存新增tag版本记录（强制）</span><br><span class=\"line\">git add README.md // 追踪README.md文件。（强制）</span><br><span class=\"line\">git commit -m <span class=\"string\">\"发布新的tag\"</span> // 将暂存区里的改动给提交到本地的版本库（强制）</span><br><span class=\"line\">git push origin develop // 推送改动后的develop（强制）</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"master-合并周期\"><a href=\"#master-合并周期\" class=\"headerlink\" title=\"master 合并周期\"></a>master 合并周期</h3><blockquote>\n<p>每月月底最后几个工作日完成对master 对develop分支的合并。</p>\n</blockquote>\n<h3 id=\"tag-版本命名\"><a href=\"#tag-版本命名\" class=\"headerlink\" title=\"tag 版本命名\"></a>tag 版本命名</h3><blockquote>\n<p>版本命名规范</p>\n</blockquote>\n<ul>\n<li>版本: v1.1.1 ( Build 101001 )</li>\n<li>版本格式 bigVersion.middleVersion.smallVersion</li>\n<li>bigVersion 大版本(年度或者重大更新（强制更新，老版本存在不兼容等情况）) 取值范围 1-99</li>\n<li>middleVersion 迭代版本 取值范围 1-99</li>\n<li>smallVersion bug修复增强发布。 取值范围 1-999</li>\n<li>Build为版本纯数字格式化。</li>\n</ul>\n<h3 id=\"git帮助文档\"><a href=\"#git帮助文档\" class=\"headerlink\" title=\"git帮助文档\"></a>git帮助文档</h3><p><a href=\"https://gitee.com/all-about-git\" target=\"_blank\" rel=\"noopener\">git 大全</a></p>\n","categories":["Git"],"tags":["Git","工作流程"]},{"title":"Centos7-Java-Dev","url":"/posts/2084976761/","content":"<ul>\n<li>本章内容为早期笔记迁移。</li>\n<li>阅读提醒,权限root.操作流程并位遵循安全规则；线上环境请勿模仿。</li>\n</ul>\n<h2 id=\"文件存放位置。\"><a href=\"#文件存放位置。\" class=\"headerlink\" title=\"文件存放位置。\"></a>文件存放位置。</h2><ul>\n<li>opt<ul>\n<li>backup </li>\n<li>javahome </li>\n<li>mavenhome</li>\n<li>gradlehome</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">mkdir -p /opt/&#123;backup,javahome,mavenhome,gradlehome&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"相关基础程序安装\"><a href=\"#相关基础程序安装\" class=\"headerlink\" title=\"相关基础程序安装\"></a>相关基础程序安装</h2><a id=\"more\"></a>\n\n<ul>\n<li>安装wget</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum -y install wget</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"基础环境安装\"><a href=\"#基础环境安装\" class=\"headerlink\" title=\"基础环境安装\"></a>基础环境安装</h2><ul>\n<li>安装jdk</li>\n<li>安装maven</li>\n<li>安装git</li>\n<li>安装gradle</li>\n</ul>\n<h3 id=\"安装Jdk\"><a href=\"#安装Jdk\" class=\"headerlink\" title=\"安装Jdk\"></a>安装Jdk</h3><ul>\n<li>检查系统是否已安装JDK环境</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">java -version</span><br><span class=\"line\">rpm -qa | grep java</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>下载Jdk安装包 <a href=\"http://www.oracle.com/technetwork/java/javase/downloads/index.html\" target=\"_blank\" rel=\"noopener\">下载地址</a></li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/backup  //切换目录</span><br><span class=\"line\">wget -c xxx //下载如果没有安装 wget 自行安装 yum install -y wget</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>解压jdk</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">tar -zxvf jdk-8u151-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>移动解压文件</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">mv ./jdk1.8.0_151/ javahome/</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>打开profile配置文件</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">vi /etc/profile</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>添加内容</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">export JAVA_HOME=/opt/javahome/jdk1.8.0_151</span><br><span class=\"line\">export PATH=$JAVA_HOME/bin:$PATH</span><br><span class=\"line\">export CLASSPATH=.:$JAVA_HOME/lib/tools.jar</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>刷新配置信息</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">source /etc/profile</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>检查环境是否配置成功</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">java -version</span><br><span class=\"line\"></span><br><span class=\"line\">java version \"1.8.0_151\"</span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_151-b12)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit Server VM (build 25.151-b12, mixed mode)</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>出现以上内容说明环境基本安装成功。</li>\n</ul>\n<h3 id=\"安装Maven\"><a href=\"#安装Maven\" class=\"headerlink\" title=\"安装Maven\"></a>安装Maven</h3><ul>\n<li>下载Mavan安装包 <a href=\"https://maven.apache.org/download.cgi\" target=\"_blank\" rel=\"noopener\">下载地址</a></li>\n</ul>\n<blockquote>\n<p>不要源代碼，下载编译之后的。Binary tar.gz archive</p>\n<p>解压发现带pom文件那个是源代码。</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/backup  //切换目录</span><br><span class=\"line\">wget -c xxx</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>解压Maven</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">tar -zxvf apache-maven-3.5.0-bin.tar.gz</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>移动文件</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">mv .&#x2F;apache-maven-3.5.0&#x2F; mavenhome&#x2F;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置环境变量</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">export MAVEN_HOME=/opt/mavenhome/apache-maven-3.5.0</span><br><span class=\"line\">export PATH=$&#123;PATH&#125;:$&#123;MAVEN_HOME&#125;/bin</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>刷新配置信息</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">. /etc/profile</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>检查是否安装成功</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">mvn -version</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装git\"><a href=\"#安装git\" class=\"headerlink\" title=\"安装git\"></a>安装git</h3><ul>\n<li>源安装</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum -y install git</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>检查安装</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# git version</span><br><span class=\"line\">git version 1.8.3.1</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>看到版本说明安装成功</li>\n</ul>\n<h3 id=\"安裝Gradle\"><a href=\"#安裝Gradle\" class=\"headerlink\" title=\"安裝Gradle\"></a>安裝Gradle</h3><blockquote>\n<p>在语法上是基于Groovy语言的（<a href=\"https://link.jianshu.com/?t=http://www.groovy-lang.org/\" target=\"_blank\" rel=\"noopener\">Groovy</a> 是一种基于JVM的敏捷开发语言，可以简单的理解为强类型语言java的弱类型版本），在项目管理上是基于Ant和Maven概念的项目自动化建构工具</p>\n</blockquote>\n<ul>\n<li>下载</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /opt/backup  //切换目录</span><br><span class=\"line\">wget -c https://downloads.gradle.org/distributions/gradle-4.0.1-all.zip</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>解压</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">unzip -d gradle-4.0.1-all.zip</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>如果没有unzip 安装下</p>\n</blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">yum -y install unzip</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>移动文件</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">mv .&#x2F;gradle-4.0.1&#x2F; gradlehome&#x2F;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>配置环境变量</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/profile</span><br><span class=\"line\">//添加</span><br><span class=\"line\"><span class=\"built_in\">export</span> GRADLE_HOME=/opt/gradlehome/gradle-4.0.1</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$&#123;PATH&#125;</span>:<span class=\"variable\">$&#123;GRADLE_HOME&#125;</span>/bin</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>刷新配置使其生效</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>检查是否安装成功</li>\n</ul>\n<figure class=\"highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">gradle -v</span><br></pre></td></tr></table></figure>\n\n<p>显示版本信息则标识环境配置成功。</p>\n<h2 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h2>","categories":["Dev"],"tags":["Centos7","Linux","Maven","Gradle"]},{"title":"源码阅读-LinkedList","url":"/posts/3730783701/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n<h3 id=\"Linked-List\"><a href=\"#Linked-List\" class=\"headerlink\" title=\"Linked List\"></a>Linked List</h3><ul>\n<li>链表即是由节点（Node）组成的线性集合，每个节点可以利用指针指向其他节点。它是一种包含了多个节点的、能够用于表示序列的数据结构。</li>\n<li><strong>单向链表</strong>: 链表中的节点仅指向下一个节点，并且最后一个节点指向空。</li>\n<li><strong>双向链表</strong>: 其中每个节点具有两个指针 p、n，使得 p 指向先前节点并且 n 指向下一个节点；最后一个节点的 n 指针指向 null。</li>\n<li><strong>循环链表</strong>：每个节点指向下一个节点并且最后一个节点指向第一个节点的链表。</li>\n<li>时间复杂度:<ul>\n<li>索引: <code>O(n)</code></li>\n<li>搜索: <code>O(n)</code></li>\n<li>插入: <code>O(1)</code></li>\n<li>移除: <code>O(1)</code></li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<p>LinkedList 是是一个有序的集合，是Collection的实现类之一。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Collection/Collection-LinkedList.JPG\"></p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><ul>\n<li>双链表  LinkedList 是 Java Collecion Framework成员之一。  </li>\n<li>双链表  是List和Deque的接口的实现。</li>\n<li>在内部，它是使用双链表数据结构实现的。</li>\n<li>它支持重复的元素。它没有实现RandomAccess接口。所以我们只能按顺序访问元素。它不支持随机访问元素。</li>\n<li>相对与ArrayList它 删除 和添加 速度会快很多。但是遍历就要慢一些。</li>\n<li>它以插入顺序存储或维护它的元素。</li>\n</ul>\n<h3 id=\"链表\"><a href=\"#链表\" class=\"headerlink\" title=\"链表\"></a>链表</h3><a id=\"more\"></a>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span>&lt;<span class=\"title\">E</span>&gt; </span>&#123;</span><br><span class=\"line\">    E item;</span><br><span class=\"line\">    Node&lt;E&gt; next;</span><br><span class=\"line\">    Node&lt;E&gt; prev;</span><br><span class=\"line\"></span><br><span class=\"line\">    Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.item = element;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.next = next;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.prev = prev;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>链表维护的最基本结构。在JVM中LinkedList存储并不会像数组一样按顺序来，存储的位置是随机的。</p>\n<p>链接表结构</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    LinkedList list = <span class=\"keyword\">new</span> LinkedList();</span><br><span class=\"line\">    list.add(<span class=\"string\">\"a\"</span>);</span><br><span class=\"line\">    list.add(<span class=\"string\">\"b\"</span>);</span><br><span class=\"line\">    list.add(<span class=\"string\">\"c\"</span>);</span><br><span class=\"line\">    list.add(<span class=\"string\">\"d\"</span>);</span><br><span class=\"line\">    System.out.println(list.toString());</span><br><span class=\"line\">    System.out.println(list.getFirst()); <span class=\"comment\">// 第一个元素。</span></span><br><span class=\"line\">    System.out.println(list.getLast());  <span class=\"comment\">// 最后一个元素</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">[a, b, c, d]</span><br><span class=\"line\">a</span><br><span class=\"line\">d</span><br></pre></td></tr></table></figure>\n\n<p>linkedList的first ==  a next -&gt; b next -&gt; c next -&gt; d next </p>\n<h3 id=\"案例-遍历LinkedList\"><a href=\"#案例-遍历LinkedList\" class=\"headerlink\" title=\"案例-遍历LinkedList\"></a>案例-遍历LinkedList</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test1</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    LinkedList list = <span class=\"keyword\">new</span> LinkedList();</span><br><span class=\"line\">    list.add(<span class=\"string\">\"a\"</span>);</span><br><span class=\"line\">    list.add(<span class=\"string\">\"b\"</span>);</span><br><span class=\"line\">    list.add(<span class=\"string\">\"c\"</span>);</span><br><span class=\"line\">    list.add(<span class=\"string\">\"d\"</span>);</span><br><span class=\"line\">    System.out.println(list.toString());</span><br><span class=\"line\">    Iterator&lt;String&gt; itr = list.iterator();</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (itr.hasNext())&#123;</span><br><span class=\"line\">        System.out.println(itr.next());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[a, b, c, d]</span><br><span class=\"line\">a</span><br><span class=\"line\">b</span><br><span class=\"line\">c</span><br><span class=\"line\">d</span><br></pre></td></tr></table></figure>\n\n<p>都是Collection家族的使用迭代器进行遍历。</p>\n<h2 id=\"源码分析下linkedList\"><a href=\"#源码分析下linkedList\" class=\"headerlink\" title=\"源码分析下linkedList\"></a>源码分析下linkedList</h2><p>LinkedList中的常量和变量</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 容器大小</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> <span class=\"keyword\">int</span> size = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">// 头部节点引用</span></span><br><span class=\"line\">   <span class=\"keyword\">transient</span> Node&lt;E&gt; first;</span><br><span class=\"line\"></span><br><span class=\"line\"> \t<span class=\"comment\">// 尾部节点引用</span></span><br><span class=\"line\">   <span class=\"keyword\">transient</span> Node&lt;E&gt; last;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1、如何创建一个LinkedList实例。\"><a href=\"#1、如何创建一个LinkedList实例。\" class=\"headerlink\" title=\"1、如何创建一个LinkedList实例。\"></a>1、如何创建一个LinkedList实例。</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test2</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    LinkedList list = <span class=\"keyword\">new</span> LinkedList();</span><br><span class=\"line\">    list.add(<span class=\"string\">\"a\"</span>);</span><br><span class=\"line\">    list.add(<span class=\"string\">\"b\"</span>);</span><br><span class=\"line\">    list.add(<span class=\"string\">\"c\"</span>);</span><br><span class=\"line\">    list.add(<span class=\"string\">\"d\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    String[] arr = <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">\"a\"</span>,<span class=\"string\">\"b\"</span>,<span class=\"string\">\"c\"</span>,<span class=\"string\">\"d\"</span>&#125;;</span><br><span class=\"line\">    LinkedList list1 = <span class=\"keyword\">new</span> LinkedList(Arrays.asList(arr));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建LinkedList的实例的方式有两种。LinkedList在这点上就与ArrayList不同，不需要指定大小。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//空构造方法 list1</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">LinkedList</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// list2</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">LinkedList</span><span class=\"params\">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>();</span><br><span class=\"line\">    <span class=\"comment\">// 将c Collection容器的元素都复制进来。</span></span><br><span class=\"line\">    addAll(c);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、add-方法\"><a href=\"#2、add-方法\" class=\"headerlink\" title=\"2、add 方法\"></a>2、add 方法</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 添加成功则返回true</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">add</span><span class=\"params\">(E e)</span> </span>&#123;</span><br><span class=\"line\">    linkLast(e);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">linkLast</span><span class=\"params\">(E e)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">final</span> Node&lt;E&gt; l = last; </span><br><span class=\"line\">     <span class=\"comment\">// 创建一个新的link last为头 prev为null</span></span><br><span class=\"line\">\t<span class=\"keyword\">final</span> Node&lt;E&gt; newNode = <span class=\"keyword\">new</span> Node&lt;&gt;(l, e, <span class=\"keyword\">null</span>); </span><br><span class=\"line\">\tlast = newNode;</span><br><span class=\"line\">    <span class=\"comment\">// 如果last是null,将e设置为first 反之放到尾部</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (l == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">\t\tfirst = newNode;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tl.next = newNode;</span><br><span class=\"line\">\tsize++;</span><br><span class=\"line\">\tmodCount++;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 将容器c的元素添加到当前容器中。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">addAll</span><span class=\"params\">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 把当前容器sezi 和 c传入</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> addAll(size, c);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">addAll</span><span class=\"params\">(<span class=\"keyword\">int</span> index, Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class=\"line\">        checkPositionIndex(index); <span class=\"comment\">//检查索引是否越界</span></span><br><span class=\"line\"></span><br><span class=\"line\">        Object[] a = c.toArray();  <span class=\"comment\">//将c 转换成数组</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> numNew = a.length;     <span class=\"comment\">//根据数组长度得到需要添加的数量</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (numNew == <span class=\"number\">0</span>)\t\t  <span class=\"comment\">//如果添加长度为0 就返回false.</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        Node&lt;E&gt; pred, succ;        <span class=\"comment\">// 声明两个Link这其实是两个临时节点。</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index == size) &#123;\t   <span class=\"comment\">// 从Index开始添加，如果index的位置等于当前容器的长度，则从last开始添加元素。</span></span><br><span class=\"line\">            succ = <span class=\"keyword\">null</span>;\t\t   </span><br><span class=\"line\">            pred = last;\t\t   <span class=\"comment\">// 容器last指向 pred</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;\t\t\t\t  <span class=\"comment\">// 从某一个link开始生成。</span></span><br><span class=\"line\">            succ = node(index);\t    <span class=\"comment\">// 获取index下标的元素。</span></span><br><span class=\"line\">            pred = succ.prev;       <span class=\"comment\">// 将succ.prev 指向 pred。</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">        <span class=\"comment\">// 遍历数组中的元素，并按照顺序关系生成link</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Object o : a) &#123;</span><br><span class=\"line\">            <span class=\"meta\">@SuppressWarnings</span>(<span class=\"string\">\"unchecked\"</span>) E e = (E) o;</span><br><span class=\"line\">            Node&lt;E&gt; newNode = <span class=\"keyword\">new</span> Node&lt;&gt;(pred, e, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (pred == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                first = newNode;</span><br><span class=\"line\">            <span class=\"keyword\">else</span></span><br><span class=\"line\">                pred.next = newNode;</span><br><span class=\"line\">            pred = newNode;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 与现有的链表进行连接</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (succ == <span class=\"keyword\">null</span>) &#123;  <span class=\"comment\">//从last开始添加元素的时候。</span></span><br><span class=\"line\">            last = pred;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;\t\t    <span class=\"comment\">//从某个元素开始添加元素。</span></span><br><span class=\"line\">            pred.next = succ;</span><br><span class=\"line\">            succ.prev = pred;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        size += numNew; <span class=\"comment\">//更新size大小。</span></span><br><span class=\"line\">        modCount++;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<p>addAll方法会稍微麻烦点，举个栗子。</p>\n<blockquote>\n<p>addAll 方法有两种情况，1、当前容器没有元素存在。2、当前容器已经存在元素。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    String[] arr = <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">\"a\"</span> , <span class=\"string\">\"b\"</span>&#125;;</span><br><span class=\"line\">    LinkedList list = <span class=\"keyword\">new</span> LinkedList(Arrays.asList(arr));  <span class=\"comment\">//情况一</span></span><br><span class=\"line\">    arr = <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">\"c\"</span> , <span class=\"string\">\"d\"</span>&#125;;</span><br><span class=\"line\">    list.addAll(Arrays.asList(arr));  <span class=\"comment\">// 情况二</span></span><br><span class=\"line\">    System.out.println(list);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>第二次没有每次都展示出来，不过这图画的啰嗦点。其实上debug会直接点。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test5</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    String[] arr = <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">\"a\"</span> , <span class=\"string\">\"b\"</span> , <span class=\"string\">\"c\"</span> , <span class=\"string\">\"d\"</span>&#125;;</span><br><span class=\"line\">    LinkedList list = <span class=\"keyword\">new</span> LinkedList(Arrays.asList(arr));</span><br><span class=\"line\">    list.add(<span class=\"number\">1</span>,<span class=\"string\">\"w\"</span>); <span class=\"comment\">// 在下标1的位置插入w</span></span><br><span class=\"line\">    System.out.println(list);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">[a, w, b, c, d]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"linkBefore\"><a href=\"#linkBefore\" class=\"headerlink\" title=\"linkBefore\"></a>linkBefore</h4><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在指定索引位置添加元素。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> index, E element)</span> </span>&#123;</span><br><span class=\"line\">    checkPositionIndex(index); <span class=\"comment\">// 检查下标是否越界</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index == size)\t\t<span class=\"comment\">//如果插入的位置是与长度相等，就吧当前last给他。</span></span><br><span class=\"line\">        linkLast(element);</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        linkBefore(element, node(index));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Inserts element e before non-null Node succ.</span></span><br><span class=\"line\"><span class=\"comment\"> * 在succ 的前面插入e.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">linkBefore</span><span class=\"params\">(E e, Node&lt;E&gt; succ)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert succ != null;</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; pred = succ.prev;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> Node&lt;E&gt; newNode = <span class=\"keyword\">new</span> Node&lt;&gt;(pred, e, succ);</span><br><span class=\"line\">    succ.prev = newNode;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pred == <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        first = newNode;</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        pred.next = newNode;</span><br><span class=\"line\">    size++;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、remove\"><a href=\"#3、remove\" class=\"headerlink\" title=\"3、remove\"></a>3、remove</h3><blockquote>\n<p>这里只介绍两个带参数的remove方法。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test4</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    String[] arr = <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">\"a\"</span>,<span class=\"string\">\"b\"</span>,<span class=\"string\">\"c\"</span>,<span class=\"string\">\"d\"</span>&#125;;</span><br><span class=\"line\">    LinkedList list = <span class=\"keyword\">new</span> LinkedList(Arrays.asList(arr));</span><br><span class=\"line\">    System.out.println(list.remove(<span class=\"string\">\"a\"</span>));</span><br><span class=\"line\">    System.out.println(list);</span><br><span class=\"line\">    System.out.println(list.remove(<span class=\"number\">1</span>));</span><br><span class=\"line\">    System.out.println(list);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">true</span></span><br><span class=\"line\">[b, c, d]</span><br><span class=\"line\">c</span><br><span class=\"line\">[b, d]</span><br></pre></td></tr></table></figure>\n\n\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 删除目标对象，若果删除成功就返回true反之返回false。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">remove</span><span class=\"params\">(Object o)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (o == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = first; x != <span class=\"keyword\">null</span>; x = x.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (x.item == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                unlink(x);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 遍历链表</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Node&lt;E&gt; x = first; x != <span class=\"keyword\">null</span>; x = x.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o.equals(x.item)) &#123;</span><br><span class=\"line\">                unlink(x);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 删除下标位置的元素，若删除成功返回</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">remove</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</span><br><span class=\"line\">    checkElementIndex(index); <span class=\"comment\">//检查下标是否越界</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> unlink(node(index)); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 根据下标寻找元素，找到并返回。</span></span><br><span class=\"line\"><span class=\"function\">Node&lt;E&gt; <span class=\"title\">node</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// assert isElementIndex(index);</span></span><br><span class=\"line\">\t<span class=\"comment\">// size &gt;&gt; 1 移位运算 相当于*0.5，根据索引下标的位置判断在集合前段还是后端前端就从first开始遍历反之从last开始遍历。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &lt; (size &gt;&gt; <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">        Node&lt;E&gt; x = first;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; index; i++)</span><br><span class=\"line\">            x = x.next;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        Node&lt;E&gt; x = last;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = size - <span class=\"number\">1</span>; i &gt; index; i--)</span><br><span class=\"line\">            x = x.prev;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Unlinks non-null node x.</span></span><br><span class=\"line\"><span class=\"comment\">     * 卸载指定节点的链接</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\">E <span class=\"title\">unlink</span><span class=\"params\">(Node&lt;E&gt; x)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// assert x != null;</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> E element = x.item;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> Node&lt;E&gt; next = x.next;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> Node&lt;E&gt; prev = x.prev;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (prev == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            first = next;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            prev.next = next;</span><br><span class=\"line\">            x.prev = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (next == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            last = prev;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            next.prev = prev;</span><br><span class=\"line\">            x.next = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        x.item = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        size--;</span><br><span class=\"line\">        modCount++;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> element;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"unlink\"><a href=\"#unlink\" class=\"headerlink\" title=\"unlink\"></a>unlink</h4><h3 id=\"4、poll方法\"><a href=\"#4、poll方法\" class=\"headerlink\" title=\"4、poll方法\"></a>4、poll方法</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 获取当前链表frist元素，如果不存在就返回null,存在该元素并删除。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">poll</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> Node&lt;E&gt; f = first;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (f == <span class=\"keyword\">null</span>) ? <span class=\"keyword\">null</span> : unlinkFirst(f);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","categories":["源码分析"],"tags":["Java","Java-Collecions-Framework","LinkedList"]},{"title":"源码阅读-ArrayList","url":"/posts/3941296488/","content":"<blockquote>\n<p>本章是整理知识内容，为强化知识长期更新。</p>\n</blockquote>\n<p>List 是是一个有序的集合，是Collection的实现类之一。</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/JavaNote/Collection/Collection-ArrayList.JPG\"></p>\n<h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><ul>\n<li>list接口是Java Collection Framework的成员。</li>\n<li>列队允许添加重复的元素。</li>\n<li>列队允许null存在。</li>\n<li>列队是从0开始，也就是列队头元素的下标是0。</li>\n<li>列队支持泛型，这样可以避免<code>ClassCastException</code>异常。</li>\n</ul>\n<h3 id=\"数组与数组列表\"><a href=\"#数组与数组列表\" class=\"headerlink\" title=\"数组与数组列表\"></a>数组与数组列表</h3><a id=\"more\"></a>\n\n<p>​    Array(数组)它是在内存中划分出一块连续的地址空间进行元素的存储，由于它直接操作内存，所以性能比其他的集合要高一点点。但是数组也有一个严重的缺陷，就是需要指定初始化大小，并且在后续的操作中不能修改数组的结构，这很不友好。</p>\n<p>​    ArrayList可以很好的进行动态扩容，它会随之元素的不断增加而调整数组大小。它的底层是基于数据实现的，所以也集成了数组的一些特性。比如查找、修改很快，但是新增和删除比较慢。</p>\n<h3 id=\"Array数组\"><a href=\"#Array数组\" class=\"headerlink\" title=\"Array数组\"></a>Array数组</h3><blockquote>\n<p>ArrayList底层是由数组实现的，那么就回顾下Java中数组的特性。</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Array1Test</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        String[] arr = <span class=\"keyword\">new</span> String[<span class=\"number\">5</span>];</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"数组的长度\"</span> + arr.length);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; arr.length ; i++) &#123;</span><br><span class=\"line\">            arr[i] = String.valueOf(i);</span><br><span class=\"line\">            System.out.print(<span class=\"string\">\" \"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(arr[<span class=\"number\">0</span>].toString());</span><br><span class=\"line\">        <span class=\"comment\">// 打印出0 , 数组的下表是从0开始的。</span></span><br><span class=\"line\">        arr[<span class=\"number\">6</span>] = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 强行添加一个元素到6的位置,然后取出来抛出ArrayIndexOutOfBoundsException。数组的大小是不能修改的。</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\">数组的长度5</span><br><span class=\"line\">\t0</span><br><span class=\"line\">java.lang.ArrayIndexOutOfBoundsException: 6</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"List列表\"><a href=\"#List列表\" class=\"headerlink\" title=\"List列表\"></a>List列表</h3><p>Java的List是一个有序的集合，List是Collection接口的扩展接口。</p>\n<h3 id=\"List特性\"><a href=\"#List特性\" class=\"headerlink\" title=\"List特性\"></a>List特性</h3><ul>\n<li>Java List接口是Java Collection Framework的成员。</li>\n<li>列表允许添加重复的元素。</li>\n<li>列表允许有null元素。</li>\n<li>列表索引是从0开始，和数组一样的。</li>\n<li>列表接受泛型，尽量使用它。以免出现<code>ClassCastException</code></li>\n</ul>\n<h2 id=\"源码分析\"><a href=\"#源码分析\" class=\"headerlink\" title=\"源码分析\"></a>源码分析</h2><p>ArrayList中的常量以及变量</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 默认初始化容器的大小</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> DEFAULT_CAPACITY = <span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 空的对象数组。</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 默认的对象数组。</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 被transient修饰不会被序列化，集合中元素个数。</span></span><br><span class=\"line\"><span class=\"keyword\">transient</span> Object[] elementData; <span class=\"comment\">// non-private to simplify nested class access</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 容器中元素的个数</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> size;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 容器的最大容量</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class=\"number\">8</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建ArrayList的实例。\"><a href=\"#创建ArrayList的实例。\" class=\"headerlink\" title=\"创建ArrayList的实例。\"></a>创建ArrayList的实例。</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test3</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    List list1 = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">    List list2 = <span class=\"keyword\">new</span> ArrayList(<span class=\"number\">3</span>);</span><br><span class=\"line\">    String[] vowels = &#123;<span class=\"string\">\"a\"</span>,<span class=\"string\">\"e\"</span>,<span class=\"string\">\"i\"</span>,<span class=\"string\">\"o\"</span>,<span class=\"string\">\"u\"</span>&#125;;</span><br><span class=\"line\">    <span class=\"comment\">// 使用Arrays工具将数组转换成列表。</span></span><br><span class=\"line\">    List&lt;String&gt; vowelsList = Arrays.asList(vowels);</span><br><span class=\"line\">    List list3 = <span class=\"keyword\">new</span> ArrayList(vowelsList);</span><br><span class=\"line\">\t</span><br><span class=\"line\">    System.out.println(list1.toString());</span><br><span class=\"line\">    System.out.println(list2.toString());</span><br><span class=\"line\">    System.out.println(list3.toString());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">[]</span><br><span class=\"line\">[]</span><br><span class=\"line\">[a, e, i, o, u]</span><br></pre></td></tr></table></figure>\n\n<p>这分别使用了ArrayList三个构造方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// list1</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ArrayList</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 参数为空的构造方法，元素是空的数组。</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">// list2</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ArrayList</span><span class=\"params\">(<span class=\"keyword\">int</span> initialCapacity)</span> </span>&#123;</span><br><span class=\"line\">     <span class=\"comment\">// 指定容器的初始化大小。</span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (initialCapacity &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">this</span>.elementData = <span class=\"keyword\">new</span> Object[initialCapacity];</span><br><span class=\"line\">     &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (initialCapacity == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class=\"line\">     &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">         <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalArgumentException(<span class=\"string\">\"Illegal Capacity: \"</span>+</span><br><span class=\"line\">                                            initialCapacity);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\"> <span class=\"comment\">// 对应list3</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ArrayList</span><span class=\"params\">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 将一个Collection容器的元素都复制进来。</span></span><br><span class=\"line\">    elementData = c.toArray();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((size = elementData.length) != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (elementData.getClass() != Object[]<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\">            <span class=\"title\">elementData</span> </span>= Arrays.copyOf(elementData, size, Object[]<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// replace with empty array.</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.elementData = EMPTY_ELEMENTDATA;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这让我想起了面试题目。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test4</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    List list = <span class=\"keyword\">new</span> ArrayList(<span class=\"number\">20</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>题目是：生成list实例需要扩容几次。实际上是0次。因为创建的时候就指定了大小。</p>\n<h3 id=\"add方法\"><a href=\"#add方法\" class=\"headerlink\" title=\"add方法\"></a>add方法</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test4</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    List list = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">    System.out.println(list.add(<span class=\"number\">1</span>));</span><br><span class=\"line\">    list.add(<span class=\"number\">0</span>,<span class=\"number\">2</span>);</span><br><span class=\"line\">    System.out.println(list.toString());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">true</span></span><br><span class=\"line\">[<span class=\"number\">2</span>, <span class=\"number\">1</span>] <span class=\"comment\">// 是不是很神奇，下标0的位置是2，下标1位置值是1。</span></span><br></pre></td></tr></table></figure>\n\n<p>带着上面的疑问我们好好看看，顺便看看经常说ArrayList到底是如何扩容的。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 直接添加元素</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">add</span><span class=\"params\">(E e)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 确保内部容量足够，不够就扩容。 size 是当前容器的数量</span></span><br><span class=\"line\">    ensureCapacityInternal(size + <span class=\"number\">1</span>);  <span class=\"comment\">// Increments modCount!! </span></span><br><span class=\"line\">    <span class=\"comment\">// 将元素添加到数组中</span></span><br><span class=\"line\">    elementData[size++] = e;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 在指定索引的位置添加元素。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">int</span> index, E element)</span> </span>&#123;</span><br><span class=\"line\">    rangeCheckForAdd(index); <span class=\"comment\">//检查索引位置是否越界。</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ensureCapacityInternal(size + <span class=\"number\">1</span>);  <span class=\"comment\">// Increments modCount!!</span></span><br><span class=\"line\">    <span class=\"comment\">// 真相就在这里。</span></span><br><span class=\"line\">    System.arraycopy(elementData, index, elementData, index + <span class=\"number\">1</span>,</span><br><span class=\"line\">                     size - index);</span><br><span class=\"line\">    elementData[index] = element;</span><br><span class=\"line\">    size++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>System.arraycopy 是一个本地静态方法，使用它可以对数组之间进行复制。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">native</span> <span class=\"keyword\">void</span> <span class=\"title\">arraycopy</span><span class=\"params\">(Object src,  <span class=\"keyword\">int</span>  srcPos,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                                    Object dest, <span class=\"keyword\">int</span> destPos,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                                    <span class=\"keyword\">int</span> length)</span></span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>src:源数组；    </li>\n<li>srcPos:源数组要复制的起始位置；<br>   dest:目的数组；<br>   destPos:目的数组放置的起始位置；    </li>\n<li>length:复制的长度。</li>\n</ul>\n<p>上面的操作结果就是将数组中的元素位置进行了移动，当然神奇的地方是这个方法可以自己复制自己。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">ensureCapacityInternal</span><span class=\"params\">(<span class=\"keyword\">int</span> minCapacity)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 当前实际存储的数组是空的的时候</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 最小的数字 就是容量大小。</span></span><br><span class=\"line\">        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ensureExplicitCapacity(minCapacity);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">ensureExplicitCapacity</span><span class=\"params\">(<span class=\"keyword\">int</span> minCapacity)</span> </span>&#123;</span><br><span class=\"line\">        modCount++;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 如果当前数组的长度小于 需要的最小容量大小就扩容。</span></span><br><span class=\"line\">        <span class=\"comment\">// overflow-conscious code</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (minCapacity - elementData.length &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            grow(minCapacity);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">grow</span><span class=\"params\">(<span class=\"keyword\">int</span> minCapacity)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 增加最小扩容，保证元素能添加进容器。</span></span><br><span class=\"line\">        <span class=\"comment\">// overflow-conscious code</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> oldCapacity = elementData.length;</span><br><span class=\"line\">        <span class=\"comment\">// 位运算 ， 新的容量大小 = 当前数组长度 右移动一位  就是 newCapacity = oldCapacity + (oldCapacity / 2) 取整。也就是经常说的扩容1.5倍。</span></span><br><span class=\"line\">        <span class=\"keyword\">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class=\"number\">1</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newCapacity - minCapacity &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            newCapacity = minCapacity;</span><br><span class=\"line\">    \t<span class=\"comment\">// 如果新的容器大小 比 容器最大值还大</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">            newCapacity = hugeCapacity(minCapacity);</span><br><span class=\"line\">        <span class=\"comment\">// minCapacity is usually close to size, so this is a win:</span></span><br><span class=\"line\">        <span class=\"comment\">// 关键的时候来了，通过Arrays.copyOf复制元素并指定新的数组大小。这个方法最终还是调用了System.arraycopy方法，其它参数是由Array.copyOf预设好的。</span></span><br><span class=\"line\">        elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"comment\">// 4 抛出OutOfMemoryError异常咯。内存溢出</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">hugeCapacity</span><span class=\"params\">(<span class=\"keyword\">int</span> minCapacity)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (minCapacity &lt; <span class=\"number\">0</span>) <span class=\"comment\">// overflow</span></span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> OutOfMemoryError();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?</span><br><span class=\"line\">            Integer.MAX_VALUE :</span><br><span class=\"line\">            MAX_ARRAY_SIZE;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>每次扩容都是通过Arrays.copyOf(elementData, newCapacity)的来实现的。</p>\n<h3 id=\"set方法\"><a href=\"#set方法\" class=\"headerlink\" title=\"set方法\"></a>set方法</h3><p>这个方法其实就是更新方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test5</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    List list = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">    list.add(<span class=\"number\">1</span>);</span><br><span class=\"line\">    System.out.println(list.set(<span class=\"number\">0</span>,<span class=\"number\">1</span>));</span><br><span class=\"line\">    System.out.println(list.toString());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1</span></span><br><span class=\"line\">[<span class=\"number\">1</span>]</span><br></pre></td></tr></table></figure>\n\n<p>看下源代码。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">set</span><span class=\"params\">(<span class=\"keyword\">int</span> index, E element)</span> </span>&#123;</span><br><span class=\"line\">    rangeCheck(index); <span class=\"comment\">//检查所以是否越界，这里要注意，该下标没有值会抛出越界异常。</span></span><br><span class=\"line\"></span><br><span class=\"line\">    E oldValue = elementData(index); <span class=\"comment\">// 获取下标原始的值</span></span><br><span class=\"line\">    elementData[index] = element;\t <span class=\"comment\">// 将新值复制给对应的下标</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> oldValue;\t\t\t\t<span class=\"comment\">// 返回原始的值</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"remove方法\"><a href=\"#remove方法\" class=\"headerlink\" title=\"remove方法\"></a>remove方法</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test6</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    List list = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">    list.add(<span class=\"string\">\"a\"</span>);</span><br><span class=\"line\">    list.add(<span class=\"string\">\"b\"</span>);</span><br><span class=\"line\">    list.add(<span class=\"string\">\"b\"</span>);</span><br><span class=\"line\">    list.add(<span class=\"string\">\"c\"</span>);</span><br><span class=\"line\">    list.add(<span class=\"string\">\"d\"</span>);</span><br><span class=\"line\">    System.out.println(list.toString());</span><br><span class=\"line\">    list.remove(<span class=\"string\">\"b\"</span>); <span class=\"comment\">//根据元素匹配删除</span></span><br><span class=\"line\">    System.out.println(list.toString());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">[a, b, b, c, d]</span><br><span class=\"line\">[a, b, c, d] <span class=\"comment\">//会删除匹配到的第一个元素</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 根据下标删除元素。删除成功就返回被删除的元素。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">remove</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</span><br><span class=\"line\">    rangeCheck(index); <span class=\"comment\">// 检查下标是否越界</span></span><br><span class=\"line\"></span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    E oldValue = elementData(index);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> numMoved = size - index - <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 根据索引删除相比对象删除只需要复制一份自己的部分元素。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (numMoved &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        System.arraycopy(elementData, index+<span class=\"number\">1</span>, elementData, index,</span><br><span class=\"line\">                         numMoved);</span><br><span class=\"line\">    elementData[--size] = <span class=\"keyword\">null</span>; <span class=\"comment\">// clear to let GC do its work</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 删除元素，如果删除成功返回true</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">remove</span><span class=\"params\">(Object o)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 这里看到不管待删除的值是啥，都会从头遍历到尾部。直到找到合适值在删除。所以删除这个动作非常大。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (o == <span class=\"keyword\">null</span>) &#123; </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> index = <span class=\"number\">0</span>; index &lt; size; index++)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (elementData[index] == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                fastRemove(index);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> index = <span class=\"number\">0</span>; index &lt; size; index++)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o.equals(elementData[index])) &#123;</span><br><span class=\"line\">                fastRemove(index);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 删除索引上的元素</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">fastRemove</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</span><br><span class=\"line\">    modCount++;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> numMoved = size - index - <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (numMoved &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">        System.arraycopy(elementData, index+<span class=\"number\">1</span>, elementData, index,</span><br><span class=\"line\">                         numMoved);</span><br><span class=\"line\">    elementData[--size] = <span class=\"keyword\">null</span>; <span class=\"comment\">// clear to let GC do its work</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这两个删除方法可以看出，动作都比较大。这种操作会慢很多。</p>\n<h3 id=\"get方法。\"><a href=\"#get方法。\" class=\"headerlink\" title=\"get方法。\"></a>get方法。</h3><p>相比上面3种方法确实轻量级太多了。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> E <span class=\"title\">get</span><span class=\"params\">(<span class=\"keyword\">int</span> index)</span> </span>&#123;</span><br><span class=\"line\">    rangeCheck(index);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> elementData(index);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>平时也就听大家说新增修改删除慢，也就访问速度比较快。看了源码之后才清晰很多。</p>\n<h3 id=\"contains方法\"><a href=\"#contains方法\" class=\"headerlink\" title=\"contains方法\"></a>contains方法</h3><p>这也是一个重量级的方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 判断对象存在与当前集合中。</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">contains</span><span class=\"params\">(Object o)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> indexOf(o) &gt;= <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Returns the index of the first occurrence of the specified element</span></span><br><span class=\"line\"><span class=\"comment\"> * in this list, or -1 if this list does not contain the element.</span></span><br><span class=\"line\"><span class=\"comment\"> * More formally, returns the lowest index &lt;tt&gt;i&lt;/tt&gt; such that</span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;tt&gt;(o==null&amp;nbsp;?&amp;nbsp;get(i)==null&amp;nbsp;:&amp;nbsp;o.equals(get(i)))&lt;/tt&gt;,</span></span><br><span class=\"line\"><span class=\"comment\"> * or -1 if there is no such index.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">indexOf</span><span class=\"params\">(Object o)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 当找不到该对象的时候返回-1，找到了就返回它的下标。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (o == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size; i++)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (elementData[i]==<span class=\"keyword\">null</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size; i++)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o.equals(elementData[i]))</span><br><span class=\"line\">                <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"安全删除\"><a href=\"#安全删除\" class=\"headerlink\" title=\"安全删除\"></a>安全删除</h2><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test2</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//  1、创建一个二维数组</span></span><br><span class=\"line\">        String[] vowels = &#123;<span class=\"string\">\"a\"</span>,<span class=\"string\">\"e\"</span>,<span class=\"string\">\"i\"</span>,<span class=\"string\">\"o\"</span>,<span class=\"string\">\"u\"</span>&#125;;</span><br><span class=\"line\">        <span class=\"comment\">//  2、将二维数组转换成列表,在转换成容器</span></span><br><span class=\"line\">        Collection&lt;String&gt; collection = <span class=\"keyword\">new</span> ArrayList(Arrays.asList(vowels));</span><br><span class=\"line\">        <span class=\"comment\">// 3、获取容器迭代器实例</span></span><br><span class=\"line\">        Iterator&lt;String&gt; itr = collection.iterator();</span><br><span class=\"line\">        <span class=\"comment\">// 4、逻辑判断itr 中下个元素是否存在。</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (itr.hasNext())&#123;</span><br><span class=\"line\">            String <span class=\"keyword\">var</span> = itr.next(); <span class=\"comment\">// 获取将要访问的下一个元素。</span></span><br><span class=\"line\">            <span class=\"comment\">// 5、尝试修改其中的一个元素。</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(<span class=\"keyword\">var</span> == <span class=\"string\">\"a\"</span>)&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 5、删除掉 `a`</span></span><br><span class=\"line\">                itr.remove();</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                System.out.print(<span class=\"keyword\">var</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"线程安全\"><a href=\"#线程安全\" class=\"headerlink\" title=\"线程安全\"></a>线程安全</h2><blockquote>\n<p>由于所有的方法都没有进行同步。所以很直观的认为有线程安全的问题，还是亲自测试下避免迷迷糊糊的。</p>\n</blockquote>\n<h3 id=\"场景一：多线程对一个ArrayList进行操作。\"><a href=\"#场景一：多线程对一个ArrayList进行操作。\" class=\"headerlink\" title=\"场景一：多线程对一个ArrayList进行操作。\"></a>场景一：多线程对一个ArrayList进行操作。</h3><blockquote>\n<p>假设我们需要添加10000个元素进ArrayList</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ArrayListTest2</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 10线程对一个ArrayList进行操作。</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> args</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException </span>&#123;</span><br><span class=\"line\">        List list = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">        ExecutorService executorService = Executors.newFixedThreadPool(<span class=\"number\">20</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> sum = <span class=\"number\">0</span> ; sum &lt; <span class=\"number\">10</span> ; sum ++)&#123;</span><br><span class=\"line\">            executorService.execute(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">\"ThreadId:\"</span> + Thread.currentThread().getId() + <span class=\"string\">\" start!\"</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ; i &lt; <span class=\"number\">1000</span> ; i++ )&#123;</span><br><span class=\"line\">                        list.add(i);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">\"ThreadId:\"</span> + Thread.currentThread().getId() + <span class=\"string\">\" stop!\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        executorService.shutdown();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (!executorService.isTerminated())&#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Thread.sleep(<span class=\"number\">1000</span>*<span class=\"number\">5</span>);  <span class=\"comment\">// 这里睡眠下主线程，不然其它线程还没执行完就被关闭了。</span></span><br><span class=\"line\">            &#125;<span class=\"keyword\">catch</span> (InterruptedException e)&#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"长度\"</span> + list.size());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">ThreadId:12 start!</span><br><span class=\"line\">ThreadId:11 start!</span><br><span class=\"line\">ThreadId:12 stop!</span><br><span class=\"line\">ThreadId:11 stop!</span><br><span class=\"line\">ThreadId:14 start!</span><br><span class=\"line\">ThreadId:14 stop!</span><br><span class=\"line\">ThreadId:15 start!</span><br><span class=\"line\">ThreadId:15 stop!</span><br><span class=\"line\">ThreadId:13 start!</span><br><span class=\"line\">ThreadId:16 start!</span><br><span class=\"line\">ThreadId:16 stop!</span><br><span class=\"line\">ThreadId:17 start!</span><br><span class=\"line\">ThreadId:17 stop!</span><br><span class=\"line\">ThreadId:13 stop!</span><br><span class=\"line\">ThreadId:18 start!</span><br><span class=\"line\">ThreadId:18 stop!</span><br><span class=\"line\">ThreadId:19 start!</span><br><span class=\"line\">ThreadId:19 stop!</span><br><span class=\"line\">ThreadId:20 start!</span><br><span class=\"line\">ThreadId:20 stop!</span><br><span class=\"line\">长度9950</span><br></pre></td></tr></table></figure>\n\n<p>每次的输出结构都不同，偶尔还会抛出越界异常。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 直接添加元素</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">add</span><span class=\"params\">(E e)</span> </span>&#123;</span><br><span class=\"line\">    ensureCapacityInternal(size + <span class=\"number\">1</span>);  <span class=\"comment\">// Increments modCount!! </span></span><br><span class=\"line\">    elementData[size++] = e;   <span class=\"comment\">//应该就是在这里，在多线程的情况下很有可能出现重复添加了元素。</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Fail-Fast场景\"><a href=\"#Fail-Fast场景\" class=\"headerlink\" title=\"Fail-Fast场景\"></a>Fail-Fast场景</h3><p>fail-fast 机制在遍历一个集合时，当集合结构被修改，会抛出 Concurrent Modification Exception。</p>\n<p>fail-fast 会在以下两种情况下抛出 Concurrent Modification Exception</p>\n<p>（1）单线程环境</p>\n<ul>\n<li>集合被创建后，在遍历它的过程中修改了结构。</li>\n<li>注意 remove() 方法会让 expectModcount 和 modcount 相等，所以是不会抛出这个异常。</li>\n</ul>\n<p>（2）多线程环境</p>\n<ul>\n<li>当一个线程在遍历这个集合，而另一个线程对这个集合的结构进行了修改。</li>\n</ul>\n<p>modCount 用来记录 ArrayList 结构发生变化的次数。结构发生变化是指<strong>添加</strong>或者<strong>删除</strong>至少一个元素的所有操作，或者是调整内部数组的大小，仅仅只是设置元素的值不算结构发生变化。</p>\n<p>在进行序列化或者迭代等操作时，需要比较操作前后 modCount 是否改变，如果改变了需要抛出 Concurrent Modification Exception。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">writeObject</span><span class=\"params\">(java.io.ObjectOutputStream s)</span> <span class=\"keyword\">throws</span> java.io.IOException</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Write out element count, and any hidden stuff</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> expectedModCount = modCount;</span><br><span class=\"line\">    s.defaultWriteObject();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Write out size as capacity for behavioural compatibility with clone()</span></span><br><span class=\"line\">    s.writeInt(size);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Write out all elements in the proper order.</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; i&lt;size; i++) &#123;</span><br><span class=\"line\">        s.writeObject(elementData[i]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (modCount != expectedModCount) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ConcurrentModificationException();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","categories":["源码分析"],"tags":["Java","Java-Collecions-Framework","ArrayList"]},{"title":"Spring-Aop-Annotation","url":"/posts/2777111489/","content":"<blockquote>\n<p>刚才学习SpringAop的时候觉得好强大</p>\n</blockquote>\n<h3 id=\"演示代码\"><a href=\"#演示代码\" class=\"headerlink\" title=\"演示代码\"></a><a href=\"https://github.com/z201/code-example/tree/main/Spring-Aop-Annotation\" target=\"_blank\" rel=\"noopener\">演示代码</a></h3><h3 id=\"演示效果\"><a href=\"#演示效果\" class=\"headerlink\" title=\"演示效果\"></a>演示效果</h3><ul>\n<li>启动代码</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">  docker-run curl http://localhost:9003/aop/</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;<span class=\"string\">\"code\"</span>:<span class=\"string\">\"200\"</span>&#125;%</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Console</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">[XNIO-1 task-1] [LogsAspect.java : 50]   annotationAop value index </span><br><span class=\"line\">[XNIO-1 task-1] [LogsAspect.java : 50]   annotationAop value index</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Spring-Aop\"><a href=\"#Spring-Aop\" class=\"headerlink\" title=\"Spring Aop\"></a>Spring Aop</h3><blockquote>\n<p>AOP(Aspect-Oriented Programming:⾯向切⾯编程)能够将那些与业务⽆关，却为业务模块所共同调⽤的逻辑或责任（例如事务处理、⽇志管理、权限控制等）封装起来，便于减少系统的重复代码，降低模块间的耦合度，并有利于未来的可拓展性和可维护性。</p>\n</blockquote>\n<ul>\n<li>Spring Aop是运行时增强。</li>\n<li>Cglib Aop是编译器增强。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Target</span>(ElementType.TYPE)</span><br><span class=\"line\"><span class=\"meta\">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Import</span>(AspectJAutoProxyRegistrar<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">public</span> @<span class=\"title\">interface</span> <span class=\"title\">EnableAspectJAutoProxy</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 是否要创建基于子类 (CGLIB) 的代理，而不是创建标准的基于 Java 接口的代理。 默认值为false 。</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">proxyTargetClass</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"keyword\">false</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * org.springframework.aop.framework.AopContext类进行检索。 默认关闭</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">exposeProxy</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"keyword\">false</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Spring注解\"><a href=\"#Spring注解\" class=\"headerlink\" title=\"Spring注解\"></a>Spring注解</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Aspect</span> <span class=\"comment\">//定义切面：切面由切点和增强（引介）组成(可以包含多个切点和多个增强)，它既包括了横切逻辑的定义，也包括了连接点的定义，SpringAOP就是负责实施切面的框架，它将切面所定义的横切逻辑织入到切面所指定的链接点中。</span></span><br><span class=\"line\"><span class=\"meta\">@Pointcut</span> <span class=\"comment\">//定义切点：切点是一组连接点的集合。AOP通过“切点”定位特定的连接点。通过数据库查询的概念来理解切点和连接点的关系再适合不过了：连接点相当于数据库中的记录，而切点相当于查询条件。</span></span><br><span class=\"line\"><span class=\"meta\">@Before</span> <span class=\"comment\">// 在目标方法被调用之前做增强处理,@Before只需要指定切入点表达式即可。</span></span><br><span class=\"line\"><span class=\"meta\">@AfterReturning</span> <span class=\"comment\">//在目标方法正常完成后做增强,@AfterReturning除了指定切入点表达式后，还可以指定一个返回值形参名returning,代表目标方法的返回值。</span></span><br><span class=\"line\"><span class=\"meta\">@Afterthrowing</span> <span class=\"comment\">//主要用来处理程序中未处理的异常,@AfterThrowing除了指定切入点表达式后，还可以指定一个throwing的返回值形参名,可以通过该形参名来访问目标方法中所抛出的异常对象。</span></span><br><span class=\"line\"><span class=\"meta\">@After</span> <span class=\"comment\">//在目标方法完成之后做增强，无论目标方法时候成功完成。@After可以指定一个切入点表达式。</span></span><br><span class=\"line\"><span class=\"meta\">@Around</span>  <span class=\"comment\">//环绕通知,在目标方法完成前后做增强处理,环绕通知是最重要的通知类型,像事务,日志等都是环绕通知,注意编程中核心是一个ProceedingJoinPoint。</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"pom依赖\"><a href=\"#pom依赖\" class=\"headerlink\" title=\"pom依赖\"></a>pom依赖</h3><figure class=\"highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-aop<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h3><figure class=\"highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.aop;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.ElementType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.Retention;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.annotation.Target;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Target</span>(ElementType.METHOD)</span><br><span class=\"line\"><span class=\"meta\">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> AnnotationAop &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">value</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.aop;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.aspectj.lang.JoinPoint;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.aspectj.lang.annotation.Before;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.aspectj.lang.reflect.MethodSignature;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Method;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@Aspect</span></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LogsAspect</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Pointcut</span>(<span class=\"string\">\"@annotation(cn.z201.aop.AnnotationAop)\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">cutMethod</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 异常通知：目标方法抛出异常时执行</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@AfterThrowing</span>(<span class=\"string\">\"cutMethod()\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterThrowing</span><span class=\"params\">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">\"after throwing\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 环绕通知：灵活自由的在目标方法中切入代码</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Before</span>(<span class=\"string\">\"cutMethod()\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">before</span><span class=\"params\">(JoinPoint joinPoint)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取目标方法的名称</span></span><br><span class=\"line\">        String methodName = joinPoint.getSignature().getName();</span><br><span class=\"line\">        <span class=\"comment\">// 获取方法传入参数</span></span><br><span class=\"line\">        Object[] params = joinPoint.getArgs();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != params &amp;&amp; params.length != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">\" method name &#123;&#125; args &#123;&#125;\"</span>, methodName, params[<span class=\"number\">0</span>]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 执行源方法</span></span><br><span class=\"line\">        AnnotationAop annotationAop = getDeclaredAnnotation(joinPoint);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != annotationAop) &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">\" annotationAop value &#123;&#125; \"</span>, annotationAop.value());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取方法中声明的注解</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> joinPoint</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> NoSuchMethodException</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> AnnotationAop <span class=\"title\">getDeclaredAnnotation</span><span class=\"params\">(JoinPoint joinPoint)</span> <span class=\"keyword\">throws</span> NoSuchMethodException </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取方法名</span></span><br><span class=\"line\">        String methodName = joinPoint.getSignature().getName();</span><br><span class=\"line\">        <span class=\"comment\">// 反射获取目标类</span></span><br><span class=\"line\">        Class&lt;?&gt; targetClass = joinPoint.getTarget().getClass();</span><br><span class=\"line\">        <span class=\"comment\">// 拿到方法对应的参数类型</span></span><br><span class=\"line\">        Class&lt;?&gt;[] parameterTypes = ((MethodSignature) joinPoint.getSignature()).getParameterTypes();</span><br><span class=\"line\">        <span class=\"comment\">// 根据类、方法、参数类型（重载）获取到方法的具体信息</span></span><br><span class=\"line\">        Method objMethod = targetClass.getMethod(methodName, parameterTypes);</span><br><span class=\"line\">        <span class=\"comment\">// 拿到方法定义的注解信息</span></span><br><span class=\"line\">        AnnotationAop annotation = objMethod.getDeclaredAnnotation(AnnotationAop<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 返回</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> annotation;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> cn.z201.aop;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> z201.coding@gmail.com</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppApplicationController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"\"</span>)</span><br><span class=\"line\">    <span class=\"meta\">@AnnotationAop</span>(value = <span class=\"string\">\"index\"</span>)</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">index</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        Map&lt;String, Object&gt; data = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        data.put(<span class=\"string\">\"code\"</span>, <span class=\"string\">\"200\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"END\"><a href=\"#END\" class=\"headerlink\" title=\"END\"></a>END</h3>","categories":["Spring"],"tags":["Java","Spring","Aop"]},{"title":"2016-09-30-成都3日游","url":"/posts/3360184888/","content":"<blockquote>\n<p> 2016年去成都浪的日子。</p>\n</blockquote>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E6%88%90%E9%83%BD/P61001-161916.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E6%88%90%E9%83%BD/P61001-161742.jpg\"></p>\n<a id=\"more\"></a>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E6%88%90%E9%83%BD/P61001-143634.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E6%88%90%E9%83%BD/P61001-141541.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E6%88%90%E9%83%BD/P61001-114624.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E6%88%90%E9%83%BD/P61001-102823.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E6%88%90%E9%83%BD/P61001-100939.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E6%88%90%E9%83%BD/P60930-141425.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E6%88%90%E9%83%BD/P60930-132854.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E6%88%90%E9%83%BD/P60930-131647.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E6%88%90%E9%83%BD/P60930-130811.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E6%88%90%E9%83%BD/P60930-130500.jpg\"></p>\n","categories":["随记"],"tags":["随记","旅游"]},{"title":"2016-10-重庆三峡博物馆","url":"/posts/2257488114/","content":"<blockquote>\n<p>2016年国庆的时候在重庆玩了几天、照片放手机里面好久了。时间有点久了，忘记具体都干啥了。留下照片回忆咯。</p>\n</blockquote>\n<p>嗯晚上到的。  </p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61027-193502.jpg\"></p>\n<p>旅馆  </p>\n<a id=\"more\"></a>\n\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61004-073223.jpg\"></p>\n<p>轨道电车</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-142931.jpg\"></p>\n<p>逛三峡博物馆咯</p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-142048.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-142038.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-141337.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-140149.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-140149.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-135830.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-135756.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-135753.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-135614.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-135555.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-135520.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-135512.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-135414.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-135340.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-135332.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-135213.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-134923.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-134908.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-125522.jpg\"></p>\n<p><img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==\" data-original=\"https://z201.oss-cn-shanghai.aliyuncs.com/%E6%97%85%E6%B8%B8/%E9%87%8D%E5%BA%86/P61003-125236.jpg\"></p>\n<p>看到这里，你的流量在燃烧。</p>\n","categories":["随记"],"tags":["旅游"]}]